/**
 * Sanrok Duotone Image Treatment
 * ================================
 *
 * Implementation of duotone (not halftone) image effects matching Sanrok's aesthetic.
 * Uses CSS blend modes for the primary technique with SVG filter fallback.
 *
 * Usage:
 * <div class="duotone">
 *   <img src="photo.jpg" alt="Description">
 * </div>
 *
 * Variants:
 * - .duotone (default: red/cream Sanrok style)
 * - .duotone--dark (darker, more dramatic)
 * - .duotone--subtle (reduced effect, 70% opacity)
 * - .duotone--hover (effect on hover only)
 * - .duotone--reveal (starts duotone, reveals color on hover)
 *
 * Aspect Ratios:
 * - .duotone--square (1:1)
 * - .duotone--portrait (3:4)
 * - .duotone--landscape (4:3)
 *
 * @author Sub-Agent 3C
 * @version 1.0.0
 */

/* ==========================================================================
   CSS Custom Properties (Design Tokens)
   ========================================================================== */

:root {
  /* Primary Sanrok duotone colors */
  --duotone-shadow: #C25C4E;
  --duotone-highlight: #F5F0E8;

  /* Alternative darker palette */
  --duotone-shadow-dark: #8B3D32;
  --duotone-highlight-dark: #E8E0D0;

  /* Monochrome variant */
  --duotone-shadow-mono: #2A2A2A;
  --duotone-highlight-mono: #F5F5F5;

  /* Transition timing */
  --duotone-transition-duration: 0.4s;
  --duotone-transition-easing: ease;
  --duotone-transition: var(--duotone-transition-duration) var(--duotone-transition-easing);
}

/* ==========================================================================
   Base Duotone Container
   ========================================================================== */

.duotone {
  position: relative;
  display: inline-block;
  overflow: hidden;
  line-height: 0; /* Remove inline spacing from img */
  isolation: isolate; /* Create new stacking context */
}

/**
 * Image Treatment
 * - Grayscale removes original colors
 * - Contrast enhancement improves tonal separation
 * - Slight brightness boost prevents muddy shadows
 */
.duotone img {
  display: block;
  width: 100%;
  height: auto;
  filter: grayscale(100%) contrast(1.1) brightness(1.05);
  transition: filter var(--duotone-transition);
}

/**
 * Shadow Color Layer (::before)
 * - Maps to dark tones in the image
 * - mix-blend-mode: darken keeps darker of overlay vs image
 */
.duotone::before {
  content: "";
  position: absolute;
  inset: 0;
  background-color: var(--duotone-shadow);
  mix-blend-mode: darken;
  pointer-events: none;
  z-index: 1;
  transition: opacity var(--duotone-transition), background-color var(--duotone-transition);
}

/**
 * Highlight Color Layer (::after)
 * - Maps to light tones in the image
 * - mix-blend-mode: lighten keeps lighter of overlay vs image
 */
.duotone::after {
  content: "";
  position: absolute;
  inset: 0;
  background-color: var(--duotone-highlight);
  mix-blend-mode: lighten;
  pointer-events: none;
  z-index: 2;
  transition: opacity var(--duotone-transition), background-color var(--duotone-transition);
}

/* ==========================================================================
   Color Variants
   ========================================================================== */

/**
 * Dark Variant
 * Deeper shadows, more dramatic contrast
 */
.duotone--dark {
  --duotone-shadow: var(--duotone-shadow-dark);
  --duotone-highlight: var(--duotone-highlight-dark);
}

.duotone--dark img {
  filter: grayscale(100%) contrast(1.2) brightness(0.95);
}

/**
 * Monochrome Variant
 * Black and white instead of colored
 */
.duotone--mono {
  --duotone-shadow: var(--duotone-shadow-mono);
  --duotone-highlight: var(--duotone-highlight-mono);
}

/**
 * Custom Color Support
 * Apply inline styles: style="--duotone-shadow: #color1; --duotone-highlight: #color2;"
 */

/* ==========================================================================
   Intensity Variants
   ========================================================================== */

/**
 * Subtle Variant
 * Reduced effect intensity (70% opacity overlays)
 */
.duotone--subtle::before,
.duotone--subtle::after {
  opacity: 0.7;
}

.duotone--subtle img {
  filter: grayscale(80%) contrast(1.05);
}

/**
 * Strong Variant
 * Maximum effect intensity
 */
.duotone--strong img {
  filter: grayscale(100%) contrast(1.3) brightness(1.1);
}

/* ==========================================================================
   Interactive Variants
   ========================================================================== */

/**
 * Hover Variant
 * Starts as normal image, applies duotone on hover
 */
.duotone--hover img {
  filter: none;
}

.duotone--hover::before,
.duotone--hover::after {
  opacity: 0;
}

.duotone--hover:hover img,
.duotone--hover:focus-within img {
  filter: grayscale(100%) contrast(1.1) brightness(1.05);
}

.duotone--hover:hover::before,
.duotone--hover:hover::after,
.duotone--hover:focus-within::before,
.duotone--hover:focus-within::after {
  opacity: 1;
}

/**
 * Reveal Variant
 * Starts as duotone, reveals original colors on hover
 */
.duotone--reveal:hover img,
.duotone--reveal:focus-within img {
  filter: none;
}

.duotone--reveal:hover::before,
.duotone--reveal:hover::after,
.duotone--reveal:focus-within::before,
.duotone--reveal:focus-within::after {
  opacity: 0;
}

/* ==========================================================================
   Aspect Ratio Containers
   ========================================================================== */

.duotone--square {
  aspect-ratio: 1;
}

.duotone--portrait {
  aspect-ratio: 3 / 4;
}

.duotone--landscape {
  aspect-ratio: 4 / 3;
}

.duotone--wide {
  aspect-ratio: 16 / 9;
}

/* Ensure images fill aspect ratio containers */
.duotone--square img,
.duotone--portrait img,
.duotone--landscape img,
.duotone--wide img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* ==========================================================================
   Size Variants
   ========================================================================== */

.duotone--sm {
  max-width: 200px;
}

.duotone--md {
  max-width: 400px;
}

.duotone--lg {
  max-width: 600px;
}

.duotone--full {
  width: 100%;
}

/* ==========================================================================
   Border Radius Variants
   ========================================================================== */

.duotone--rounded {
  border-radius: 8px;
}

.duotone--rounded img {
  border-radius: 8px;
}

.duotone--circle {
  border-radius: 50%;
}

.duotone--circle img {
  border-radius: 50%;
}

/* ==========================================================================
   SVG Filter Alternative
   ========================================================================== */

/**
 * For more precise color control, use SVG filter.
 *
 * Add this hidden SVG to your HTML:
 *
 * <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
 *   <defs>
 *     <filter id="duotone-sanrok">
 *       <feColorMatrix type="matrix"
 *         values="1 0 0 0 0
 *                 1 0 0 0 0
 *                 1 0 0 0 0
 *                 0 0 0 1 0">
 *       </feColorMatrix>
 *       <feComponentTransfer color-interpolation-filters="sRGB">
 *         <feFuncR type="table" tableValues="0.7608 0.9608"></feFuncR>
 *         <feFuncG type="table" tableValues="0.3608 0.9412"></feFuncG>
 *         <feFuncB type="table" tableValues="0.3059 0.9098"></feFuncB>
 *       </feComponentTransfer>
 *     </filter>
 *   </defs>
 * </svg>
 */

.duotone--svg {
  position: relative;
  display: inline-block;
  line-height: 0;
}

/* SVG filter can be applied directly to img - no wrapper pseudo-elements needed */
.duotone--svg img {
  filter: url(#duotone-sanrok);
  transition: filter var(--duotone-transition);
}

/* SVG filter hover variant */
.duotone--svg.duotone--hover img {
  filter: none;
}

.duotone--svg.duotone--hover:hover img {
  filter: url(#duotone-sanrok);
}

/* ==========================================================================
   Browser Fallbacks
   ========================================================================== */

/**
 * Fallback for browsers without mix-blend-mode support
 * Uses filter chain to approximate duotone effect
 */
@supports not (mix-blend-mode: darken) {
  .duotone img {
    /* Sepia + hue-rotate approximation of duotone */
    filter:
      grayscale(100%)
      sepia(100%)
      hue-rotate(-10deg)
      saturate(200%)
      brightness(0.9)
      contrast(1.1);
  }

  .duotone::before,
  .duotone::after {
    display: none;
  }

  /* Hover still works with filter fallback */
  .duotone--hover img {
    filter: none;
  }

  .duotone--hover:hover img {
    filter:
      grayscale(100%)
      sepia(100%)
      hue-rotate(-10deg)
      saturate(200%)
      brightness(0.9);
  }
}

/* ==========================================================================
   Print Styles
   ========================================================================== */

@media print {
  .duotone img {
    filter: grayscale(100%);
  }

  .duotone::before,
  .duotone::after {
    display: none;
  }
}

/* ==========================================================================
   Accessibility - Reduced Motion
   ========================================================================== */

@media (prefers-reduced-motion: reduce) {
  .duotone img,
  .duotone::before,
  .duotone::after,
  .duotone--svg img {
    transition: none;
  }
}

/* ==========================================================================
   Utility: Force GPU Acceleration
   ========================================================================== */

.duotone--accelerated {
  transform: translateZ(0);
  will-change: transform;
}

.duotone--accelerated img {
  will-change: filter;
}

/* ==========================================================================
   Loading State
   ========================================================================== */

.duotone--loading {
  background: linear-gradient(
    90deg,
    var(--duotone-highlight) 0%,
    var(--duotone-shadow) 50%,
    var(--duotone-highlight) 100%
  );
  background-size: 200% 100%;
  animation: duotone-shimmer 1.5s infinite;
}

.duotone--loading img {
  opacity: 0;
}

@keyframes duotone-shimmer {
  0% {
    background-position: 200% 0;
  }
  100% {
    background-position: -200% 0;
  }
}
