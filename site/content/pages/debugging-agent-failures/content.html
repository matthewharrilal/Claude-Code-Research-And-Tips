

<!--
═══════════════════════════════════════════════════════════════════════════════
INLINE THREADING HEADER — Phase 2B
File: docs-spa/content/pages/debugging-agent-failures/content.html
Tier: C | Batch: 11 | Generated: 2026-02-06

1. WHY THIS EXISTS
Rendered HTML content page for the debugging-agent-failures synthesis document.

3. STATUS
ACTIVE

5. BUILT ON
Extracted from synthesis/debugging-agent-failures.md by content extraction scripts.

8. CONSUMED BY
docs-spa/app/(docs)/synthesis/debugging-agent-failures/page.tsx renders this content via dangerouslySetInnerHTML.

═══════════════════════════════════════════════════════════════════════════════
END INLINE THREADING HEADER
═══════════════════════════════════════════════════════════════════════════════
-->

      <!-- Section 1: ESSENCE -->
      <section id="essence" data-activity="essence">
        <div class="essence-box">
          <div class="essence-label">Essence (15 words)</div>
          <div class="essence-text">Agent failures are systematic, not random. OHIV framework: Observe, Hypothesize, Isolate, Verify.</div>
        </div>
      </section>

      <!-- Section 2: CORE ABSTRACTION -->
      <section id="core-abstraction" data-activity="core">
        <h2 class="section-title">
          <span class="section-number">2</span>
          The OHIV Framework
        </h2>

        <div class="core-abstraction">
          <div class="core-philosophy">"Every failure follows a pattern. Understanding the pattern allows you to predict, diagnose, and prevent failures."</div>

          <div class="core-code">
            <button class="copy-btn" onclick="copyCode(this, 'OBSERVE → HYPOTHESIZE → ISOLATE → VERIFY')">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <code>OBSERVE → HYPOTHESIZE → ISOLATE → VERIFY</code>
          </div>

          <div class="core-anchor">That's the debugging workflow. Everything else is application.</div>
        </div>

        <p class="text-text-secondary mb-6">
          <strong>OBSERVE:</strong> Gather all available evidence before making assumptions. What did you expect? What actually happened? When did behavior change?
        </p>

        <p class="text-text-secondary mb-6">
          <strong>HYPOTHESIZE:</strong> Form a specific, testable hypothesis. Good hypotheses are specific ("context exceeded 80%"), testable (verify with one check), and actionable (if true, you know what to do).
        </p>

        <p class="text-text-secondary mb-6">
          <strong>ISOLATE:</strong> Narrow down to the specific failure point. Use binary search (divide timeline), component isolation (test each part), or minimal reproduction (smallest failing case).
        </p>

        <p class="text-text-secondary mb-6">
          <strong>VERIFY:</strong> Confirm the fix actually resolves the issue. Tests pass, types check, behavior correct, no regressions. Only mark resolved when ALL verification passes.
        </p>

        <div class="code-block">
          <button class="copy-btn" onclick="copyCodeBlock(this)">
            <i data-lucide="copy" class="w-3 h-3"></i>
            Copy
          </button>
          <pre><span class="comment"># Quick Diagnosis Checklist</span>
git status                              <span class="comment"># Check git state</span>
git log --oneline -5                    <span class="comment"># Recent changes</span>
git diff HEAD~1                         <span class="comment"># What changed</span>

npm test 2&gt;&amp;1 | tail -20                <span class="comment"># Run verification</span>
<span class="keyword">echo</span> <span class="string">"Exit code: $?"</span>

cat progress.txt | tail -30             <span class="comment"># Check progress state</span>
cat prd.json | jq '.userStories[] | {id, passes}'

grep -i <span class="string">"error\|failed\|exception"</span> output.txt | tail -20</pre>
        </div>
      </section>

      <!-- Section 3: THE FIVE FAILURE CATEGORIES -->
      <section id="category-context" data-activity="decisions">
        <h2 class="section-title">
          <span class="section-number">3</span>
          The Five Failure Categories
        </h2>

        <p class="text-text-secondary mb-6">
          80% of failures come from three sources: context exhaustion, missing verification, and vague instructions. The remaining 20% involves multi-agent coordination, platform bugs, and edge cases.
        </p>

        <div class="decision-box">
          <div class="decision-why">1. CONTEXT FAILURES</div>
          <div class="decision-reasoning">
            Token exhaustion, quality degradation, instruction amnesia, hallucination under pressure. This is the #1 category. Context window (~200K tokens) is the primary constraint.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Monitor context usage. At 60-70%, compact proactively. At 85%+, reset. Quality degrades BEFORE you hit the limit. Use Claude HUD or watch for symptoms: repetition, amnesia, hallucination.
            </div>
          </div>
        </div>

        <div class="decision-box" id="category-state">
          <div class="decision-why">2. STATE FAILURES</div>
          <div class="decision-reasoning">
            Memory not persisting, state divergence, progress overwriting, stale context injection. If it's not in a file, it doesn't exist. Each iteration has fresh context - external state IS memory.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Use progress.txt (append-only), prd.json (task tracking), and git commits as external memory. Never rely on "Claude remembering" something from earlier in the session.
            </div>
          </div>
        </div>

        <div class="decision-box" id="category-coordination">
          <div class="decision-why">3. COORDINATION FAILURES</div>
          <div class="decision-reasoning">
            Role confusion (orchestrator writes code), recursive explosion (workers spawn workers), deadlock between agents, error amplification. Research shows independent agents amplify errors 17.2x vs 4.4x with centralized coordination.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Use worker preambles: "You are a WORKER agent. Do NOT spawn sub-agents." Use hub-and-spoke (CC Mirror) over fully independent. Verify at every handoff point.
            </div>
          </div>
        </div>

        <div class="decision-box" id="category-verification">
          <div class="decision-why">4. VERIFICATION FAILURES</div>
          <div class="decision-reasoning">
            False positive test results, optimistic completion marking, missing integration tests, visual verification gaps. Claude tends to mark features complete without proper testing.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Require explicit verification in acceptance criteria: "npm run typecheck passes", "npm test passes with exit code 0", "Verify at localhost:3000 using browser". Never trust "done" without evidence.
            </div>
          </div>
        </div>

        <div class="decision-box" id="category-resource">
          <div class="decision-why">5. RESOURCE FAILURES</div>
          <div class="decision-reasoning">
            Cost runaway, rate limiting, infinite loops, destructive operations. A multi-agent research tool ran for 11 days without notice, accumulating $47,000 in costs.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Always set MAX_ITERATIONS and timeouts. Block destructive commands (rm -rf, git push --force). Set budget limits in Anthropic console. Monitor costs in real-time.
            </div>
          </div>
        </div>
      </section>

      <!-- Section 4: TOOL SELECTION -->
      <section id="tools" data-activity="tools">
        <h2 class="section-title">
          <span class="section-number">4</span>
          Tool Selection Matrix
        </h2>

        <p class="text-text-secondary mb-6">
          Different failure types require different tools. Match the tool to the symptom for fastest resolution.
        </p>

        <table class="category-table">
          <thead>
            <tr>
              <th>Failure Type</th>
              <th>Primary Tool</th>
              <th>When to Use</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Context overflow</td>
              <td><code>/compact</code>, <code>/reset</code></td>
              <td>Quality degradation, amnesia</td>
            </tr>
            <tr>
              <td>Runaway costs</td>
              <td>Anthropic Dashboard, <code>pkill -f claude</code></td>
              <td>Unexpected bills, long runs</td>
            </tr>
            <tr>
              <td>Test failures</td>
              <td><code>npm test</code>, exit codes</td>
              <td>Code not working</td>
            </tr>
            <tr>
              <td>Type errors</td>
              <td><code>npm run typecheck</code></td>
              <td>Type mismatches</td>
            </tr>
            <tr>
              <td>File corruption</td>
              <td><code>git checkout</code>, <code>git stash</code></td>
              <td>Unexpected changes</td>
            </tr>
            <tr>
              <td>Loop detection</td>
              <td>progress.txt, git log</td>
              <td>No progress for 3+ iterations</td>
            </tr>
            <tr>
              <td>Multi-agent conflicts</td>
              <td><code>git worktree</code></td>
              <td>Parallel agent conflicts</td>
            </tr>
          </tbody>
        </table>

        <h3 class="font-semibold text-lg mb-4 mt-8">Context Management Tools</h3>

        <div class="code-block">
          <button class="copy-btn" onclick="copyCodeBlock(this)">
            <i data-lucide="copy" class="w-3 h-3"></i>
            Copy
          </button>
          <pre><span class="comment"># Context monitoring thresholds</span>
<span class="comment"># 60-70%: Yellow warning - consider compacting</span>
<span class="comment"># 70-85%: Orange warning - compact recommended</span>
<span class="comment"># 85-95%: Red warning - compact required</span>
<span class="comment"># 95%+:   Critical - session degraded</span>

/compact                <span class="comment"># Reduce context without reset</span>
/reset                  <span class="comment"># Full context clear</span>

<span class="comment"># Kill runaway processes</span>
pkill -f claude         <span class="comment"># Graceful</span>
pkill -9 -f claude      <span class="comment"># Force</span></pre>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8">Git Recovery Tools</h3>

        <div class="code-block">
          <button class="copy-btn" onclick="copyCodeBlock(this)">
            <i data-lucide="copy" class="w-3 h-3"></i>
            Copy
          </button>
          <pre><span class="comment"># Check current state</span>
git status
git diff HEAD

<span class="comment"># Discard all unstaged changes</span>
git checkout -- .

<span class="comment"># Discard specific file</span>
git checkout -- path/to/file.ts

<span class="comment"># Save current state for later</span>
git stash push -m <span class="string">"description"</span>

<span class="comment"># Restore saved state</span>
git stash pop

<span class="comment"># Find which commit broke something</span>
git bisect start
git bisect bad              <span class="comment"># Current is broken</span>
git bisect good HEAD~10     <span class="comment"># This was working</span></pre>
        </div>
      </section>

      <!-- Section 5: DECISION TREES -->
      <section id="decision-trees" data-activity="decision-trees">
        <h2 class="section-title">
          <span class="section-number">5</span>
          Decision Trees for Quick Diagnosis
        </h2>

        <p class="text-text-secondary mb-6">
          When something breaks, use these decision trees to quickly identify the root cause and appropriate fix.
        </p>

        <div class="decision-tree">
What's the symptom?
|
+-- Quality degradation, amnesia, hallucinations
|   +-- TOOL: Context management (/compact, /reset, Claude HUD)
|
+-- Unexpected costs, long-running processes
|   +-- TOOL: Cost monitoring (Dashboard, pkill)
|
+-- Tests failing, code broken
|   +-- TOOL: Git tools (diff, checkout, stash)
|
+-- Agent stuck, no progress
|   +-- TOOL: Loop detection (progress.txt, git log)
|
+-- Permission errors, blocked operations
|   +-- TOOL: Permission management (/permissions)
|
+-- Multiple agents conflicting
    +-- TOOL: Git worktree, merge tools
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8">Quick Reference: Symptom to Fix</h3>

        <table class="category-table">
          <thead>
            <tr>
              <th>Error Symptom</th>
              <th>Most Likely Cause</th>
              <th>Quick Fix</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Quality degrading</td>
              <td>Context exhaustion</td>
              <td><code>/compact</code> or <code>/reset</code></td>
            </tr>
            <tr>
              <td>Instructions ignored</td>
              <td>Context pressure</td>
              <td>Restart session</td>
            </tr>
            <tr>
              <td>Files hallucinated</td>
              <td>Context overflow</td>
              <td>Reset session</td>
            </tr>
            <tr>
              <td>Tasks never complete</td>
              <td>No completion criteria</td>
              <td>Add <code>passes</code> tracking</td>
            </tr>
            <tr>
              <td>Same error 3+ times</td>
              <td>Task too complex</td>
              <td>Split into smaller tasks</td>
            </tr>
            <tr>
              <td>Costs spiking</td>
              <td>Runaway loop</td>
              <td><code>pkill -f claude</code></td>
            </tr>
            <tr>
              <td>Workers spawning workers</td>
              <td>Missing preamble</td>
              <td>Add worker restrictions</td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- Section 6: CASE STUDIES -->
      <section id="case-studies" data-activity="case-studies">
        <h2 class="section-title">
          <span class="section-number">6</span>
          Case Studies from Production
        </h2>

        <p class="text-text-secondary mb-6">
          Real failures from production systems. Learn from others' mistakes.
        </p>

        <div class="case-study-box">
          <div class="case-study-title">
            <i data-lucide="alert-triangle" class="w-5 h-5 text-red-500"></i>
            Case Study: The $47,000 Recursive Loop
          </div>
          <div class="case-study-detail">
            <strong>What happened:</strong> A multi-agent research tool slipped into a recursive loop that ran for 11 days before anyone noticed, accumulating $47,000 in API costs.
          </div>
          <div class="case-study-detail">
            <strong>Root cause:</strong> Agents misinterpreted uncertainty as failure, triggering correction attempts that created new uncertainties, forming a self-reinforcing loop with no exit condition.
          </div>
          <div class="case-study-detail">
            <strong>Prevention:</strong> Always set MAX_ITERATIONS=25, budget limits in console, daily cost alerts, stuck detection (exit if no commit for 3+ iterations), and timeouts.
          </div>
        </div>

        <div class="case-study-box">
          <div class="case-study-title">
            <i data-lucide="alert-triangle" class="w-5 h-5 text-red-500"></i>
            Case Study: The Home Directory Deletion
          </div>
          <div class="case-study-detail">
            <strong>What happened:</strong> Claude executed <code>rm -rf tests/ patches/ plan/ ~/</code> - that trailing <code>~/</code> deleted the user's entire home folder.
          </div>
          <div class="case-study-detail">
            <strong>Root cause:</strong> User had --dangerously-skip-permissions enabled with no blocklist for rm -rf patterns.
          </div>
          <div class="case-study-detail">
            <strong>Prevention:</strong> Block destructive commands: rm -rf, rm -r, find . -delete, sudo rm, git push --force, git reset --hard.
          </div>
        </div>

        <div class="case-study-box">
          <div class="case-study-title">
            <i data-lucide="alert-triangle" class="w-5 h-5 text-red-500"></i>
            Case Study: The 3.2 Million Token Circular Revision
          </div>
          <div class="case-study-detail">
            <strong>What happened:</strong> Nine engineers debugged the same auth module for 72 hours. Their Claude agents rewrote the OAuth flow 17 times, each iteration drifting further from the original architecture.
          </div>
          <div class="case-study-detail">
            <strong>Root cause:</strong> Extended session (72 hours) without context reset. Context degradation after ~30 minutes. Later iterations working against earlier iterations.
          </div>
          <div class="case-study-detail">
            <strong>Prevention:</strong> Fresh context each iteration (Ralph pattern). External state that persists correct decisions. Never work &gt;30 minutes without context refresh.
          </div>
        </div>

        <div class="case-study-box">
          <div class="case-study-title">
            <i data-lucide="check-circle" class="w-5 h-5 text-green-500"></i>
            Case Study: Ralph Production - 14 Iterations for 6 Stories
          </div>
          <div class="case-study-detail">
            <strong>What happened:</strong> Ryan Carson ran Ralph with 6 well-defined user stories, max 25 iterations. Completed in 14 iterations, feature complete with minor edge cases.
          </div>
          <div class="case-study-detail">
            <strong>Key learning:</strong> 14 iterations / 6 stories = 2.3 iterations per story average. Don't expect 1:1 story:iteration ratio. Learnings compounded - later stories implemented faster.
          </div>
          <div class="case-study-detail">
            <strong>Quote:</strong> "The bottleneck isn't coding - it's the upfront spec quality: PRD clarity, atomic stories, and verifiable criteria."
          </div>
        </div>
      </section>

      <!-- Section 7: WHAT'S HARD -->
      <section id="hard" data-activity="hard">
        <h2 class="section-title">
          <span class="section-number">7</span>
          What's Hard
        </h2>

        <p class="text-text-secondary mb-6">
          These are fundamental tensions in debugging agent systems, not bugs to fix.
        </p>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            The Invisible Gradient
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Context degrades gradually, then fails suddenly. You won't notice the gradient until you hit the cliff.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> 100% to 90% (40-60K) = subtle drift you won't notice. 90% to 70% = repetition, compression. 70% to 50% = instructions forgotten. 50% to CLIFF = hallucinations, amnesia.</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Monitor context proactively. Compact at 60-70%, not at 95%. Don't wait for symptoms - they arrive too late.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            The Error Cascade
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Each unaddressed error creates 3 new problems. Errors don't stay constant - they multiply.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Iteration 1: 1 error. Iteration 2: 3 errors. Iteration 3: 9 errors. Iteration 5: 81 errors. Cost of fix at iteration 1: 1 unit. At iteration 5: 121 units.</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Stop as soon as you detect an issue. NEVER continue iterating with known problems. Verify after EVERY iteration, not just at the end.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Multi-Agent Coordination Tax
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Multi-agent systems introduce exponentially more failure modes. Specification problems: 41.77%. Coordination failures: 36.94%. Error amplification in independent agents: 17.2x vs 4.4x with centralized coordination.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> "It worked amazingly up to about 200k LOC, and now they've begun savagely overwriting each other's work rather than try to deal with merge conflicts." - Steve Yegge on Gas Town</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Use hub-and-spoke over fully independent. Git worktrees for file isolation. Directory ownership for domain isolation. Merge only at integration points.</div>
        </div>
      </section>

      <!-- Section 8: WHEN TO DEBUG VS RESTART -->
      <section id="when" data-activity="when">
        <h2 class="section-title">
          <span class="section-number">8</span>
          When to Debug vs. Restart
        </h2>

        <div class="when-grid">
          <div class="when-use">
            <div class="when-title">
              <i data-lucide="search" class="w-5 h-5"></i>
              DEBUG WHEN
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Error is deterministic (same inputs = same failure)</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Root cause is identifiable from symptoms</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Context is still healthy (&lt;70%)</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Fix once = fixed forever (configuration, permissions)</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Learning from this failure will prevent future ones</span>
            </div>
          </div>

          <div class="when-not">
            <div class="when-title">
              <i data-lucide="refresh-cw" class="w-5 h-5"></i>
              RESTART WHEN
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Context &gt;85% (quality already degraded)</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Hallucinations or amnesia symptoms</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Same error 3+ times with different approaches</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Circular revisions (add, remove, add back)</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Debugging time exceeds restart + redo time</span>
            </div>
          </div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            The Fresh Context Bias
          </div>
          <div class="gotcha-detail"><strong>Pattern:</strong> Developers under-restart. They try to "push through" problems when a fresh start would be faster.</div>
          <div class="gotcha-detail"><strong>Heuristic:</strong> If you've spent 10 minutes debugging with no progress, a restart is likely faster. Fresh context beats accumulated context.</div>
        </div>

        <div class="path-container">
          <p class="font-semibold mb-4">Recovery Checklist Before Restart:</p>
          <div class="path-step">
            <div class="path-number">1</div>
            <div class="path-content">Save current state: <code>git stash push -m "pre-restart-backup"</code></div>
          </div>
          <div class="path-step">
            <div class="path-number">2</div>
            <div class="path-content">Document what you were working on: <code>echo "Task: [description]" &gt; /tmp/recovery-notes.txt</code></div>
          </div>
          <div class="path-step">
            <div class="path-number">3</div>
            <div class="path-content">Try compaction first (may salvage session): <code>/compact</code></div>
          </div>
          <div class="path-step">
            <div class="path-number">4</div>
            <div class="path-content">If quality doesn't improve, reset: <code>/reset</code></div>
          </div>
          <div class="path-step">
            <div class="path-number">5</div>
            <div class="path-content">If still bad, exit completely and start fresh: <code>exit</code></div>
          </div>
          <div class="path-step">
            <div class="path-number">6</div>
            <div class="path-content">Start new session, restore context from files: <code>git stash pop</code></div>
          </div>
        </div>
      </section>

    