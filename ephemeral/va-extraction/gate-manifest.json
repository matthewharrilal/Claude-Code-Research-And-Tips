{
  "_canonical": "CANONICAL GATE REGISTRY — all other files reference this count. Total: 57 gates (22 REQ + 15 REC + 9 ADV + 2 DIAG + 8 BV + 1 UTIL). If counts differ elsewhere, THIS FILE wins.",
  "version": "4.2.0",
  "date": "2026-02-26",
  "description": "Gate Runner manifest — table of contents for the split gate architecture (Pipeline v4, D2 crack gates)",
  "authority": "Council Verdict (2026-02-23), Wave 3 (2026-02-24), Wave 0-4 (2026-02-25), Pipeline v4 (2026-02-25), D2 Crack Gates (2026-02-26)",

  "files": {
    "core": "gate-runner-core.js",
    "preconditions": "gate-runner-preconditions.md",
    "spec": "gate-runner-spec.md",
    "provenance": "gate-runner-provenance.md",
    "manifest": "gate-manifest.json",
    "monolithic": "artifact-gate-runner-MONOLITHIC.md",
    "orchestrator": "artifact-orchestrator.md"
  },

  "resultSchema": {
    "_comment": "B-03: Every gate result MUST include source field",
    "required": ["gateId", "name", "status", "source", "measured", "threshold"],
    "sourceValues": ["code", "manual", "skip"],
    "statusValues": ["PASS", "FAIL", "WARNING"],
    "example": {
      "gate": "GR-XX",
      "name": "Human-readable gate name",
      "status": "PASS | FAIL",
      "source": "code",
      "measured": {},
      "threshold": {},
      "details": {},
      "evidence": "FACT | OBSERVED | CONFOUNDED | THEORETICAL"
    }
  },

  "tiers": {
    "required": {
      "count": 22,
      "gates": [
        "GR-01", "GR-02", "GR-03", "GR-04", "GR-05",
        "GR-06", "GR-08", "GR-09", "GR-10",
        "GR-11", "GR-13", "GR-14", "GR-15",
        "GR-18",
        "GR-44", "GR-60",
        "GR-61", "GR-62",
        "GR-63", "GR-64",
        "GR-48",
        "GR-79"
      ],
      "verdictImpact": "ANY FAIL blocks verdict. Identity FAIL = RETHINK. Perception FAIL = IMPROVE. GR-18 FAIL = IMPROVE (ghost mechanism detected). GR-63 FAIL = IMPROVE (send to builder). GR-64 FAIL + RELEASE verdict = downgrade to IMPROVE. GR-48 FAIL = INCOMPLETE. GR-61/GR-62 FAIL = BLOCK screenshot capture/PA deployment.",
      "note": "20 gates verified by GR-48 coverage check + GR-48 itself (self-referential, excluded from its own coverage array). GR-18 promoted from RECOMMENDED (SIG-05: ghost mechanisms = #1 proven failure mode)."
    },
    "recommended": {
      "count": 15,
      "gates": [
        "GR-07", "GR-17", "GR-20",
        "GR-43", "GR-45", "GR-49", "GR-51", "GR-52",
        "GR-55",
        "GR-67", "GR-78", "GR-80", "GR-82", "GR-83",
        "GR-84"
      ],
      "verdictImpact": "3+ FAIL = RETHINK. Flagged in report but do not individually block.",
      "note": "GR-18 promoted to REQUIRED (SIG-05). GR-55 promoted from ADVISORY with perceptibility thresholds (SIG-11). GR-84 (IMPROVEMENTS Comment) added (SIG-01). GR-67 (Footer Text Size) Pipeline v4. GR-78 (Builder Residual Artifact) validates RESIDUAL HTML comment. GR-80 (Iteration Log Auto-Fill) populates tracker. GR-82 (Finding Status Map) convergence reframe. GR-83 (INTENT Comment Count) D2 crack gates."
    },
    "advisory": {
      "count": 9,
      "gates": [
        "GR-05b", "GR-19", "GR-21", "GR-22", "GR-46", "GR-50", "GR-53",
        "GR-66", "GR-81"
      ],
      "verdictImpact": "Informational only.",
      "note": "GR-55 promoted to RECOMMENDED (SIG-11). Pipeline v4: GR-66. Convergence reframe: GR-81 (Prediction Suppression) — flags predictive PA-05 language in weaver reports."
    },
    "briefVerification": {
      "count": 8,
      "gates": ["BV-01", "BV-02", "BV-03", "BV-04", "BV-05", "BV-06", "BV-07", "BV-08"],
      "verdictImpact": "BV-01–BV-05: ANY FAIL = return brief to assembler (max 2 revision cycles). BV-06: FAIL = pipeline has regressed, cannot proceed. BV-07: FAIL = builder input too large, compress before spawning. BV-08: FAIL = compression loss detected, flag for IMPROVE builder.",
      "note": "Pipeline v4: BV-05. Convergence reframe: BV-06, BV-07. D2 crack gates: BV-08 (Brief-Output Diff — compares brief spec against HTML/CSS output across 6 dimensions, 80% threshold per dimension)."
    },
    "diagnosticOnly": {
      "count": 2,
      "gates": ["GR-33", "GR-34"],
      "verdictImpact": "Reports mode indicator. Does not block or flag."
    },
    "utility": {
      "count": 1,
      "gates": ["A-03"],
      "verdictImpact": "WARNING only. Does not block or flag.",
      "note": "Pipeline v4: A-03 visible content check. If WARNING, record in execution tracker and consider IMPROVE before PA deployment."
    },
    "iteration": {
      "count": 3,
      "phase": "Post-verdict iteration check (cycle >= 2)",
      "gates": ["GR-78", "GR-79", "GR-80"],
      "procedural": ["GR-65", "GR-70", "GR-75"],
      "note": "GR-65 is orchestrator-procedural: post-Pass-B structure preservation (section count, heading hierarchy, grid-template-columns vs Pass A output). See artifact-orchestrator.md Section 5. GR-70/GR-75 are orchestrator-procedural checks in the iteration decision function (artifact-orchestrator.md Section 7). GR-78/79/80 are code-enforced. GR-78 validates RESIDUAL artifact presence. GR-79 verifies iteration file completeness. GR-80 auto-fills the iteration log."
    }
  },

  "exceptions": {
    "_comment": "B-14: Codified gate exception patterns for known false positives",
    "GR-05": {
      "description": "Monospace code font exemption",
      "pattern": "Elements using JetBrains Mono may have computed colors that trigger cold-blue heuristics in syntax highlighting contexts",
      "action": "If violation is inside a <code> or <pre> element, treat as ADVISORY"
    },
    "GR-08": {
      "description": "DPR tolerance",
      "pattern": "Decorative elements at non-1.0 DPR may report sub-pixel heights",
      "action": "If DPR > 1 and element height < 1px (sub-pixel), skip element"
    },
    "GR-11": {
      "description": "Non-adjacent pairs",
      "pattern": "Previously compared all pairs; now fixed to adjacent-only (B-04)",
      "action": "Only adjacent zone pairs (zone[i] vs zone[i+1]) are compared"
    },
    "GR-15": {
      "description": "Auto centering margins",
      "pattern": "margin-left: auto + margin-right: auto used for horizontal centering",
      "action": "Skip element entirely if margin-left === auto AND margin-right === auto (B-05)"
    },
    "GR-19": {
      "description": "Boundary elements",
      "pattern": "Elements with class matching boundary|divider|separator|zone-break",
      "action": "Skip element pairs involving boundary elements (B-11)"
    }
  },

  "verdictLogic": {
    "RETHINK": "ANY identity gate (GR-01-06, GR-08-10) FAIL, OR 3+ recommended gates FAIL",
    "IMPROVE": "ANY perception gate (GR-11, GR-13-15, GR-18, GR-44, GR-60) FAIL, OR GR-63 FAIL (experiential marker), OR GR-64 FAIL when weaver verdict is RELEASE/POLISH",
    "INCOMPLETE": "GR-48 FAIL (missing required gate results)",
    "BLOCK_SCREENSHOTS": "GR-61 FAIL (DPR not validated — do NOT capture screenshots)",
    "BLOCK_PA_DEPLOYMENT": "GR-62 FAIL (blank/corrupt screenshots — do NOT deploy auditors)",
    "PROCEED_TO_PA": "All required gates PASS and <3 recommended FAIL"
  },

  "executionOrder": [
    {
      "step": 0,
      "phase": "Pipeline startup (Pre-Phase 0)",
      "function": "checkAntiRegressionLanguage(manifestText, orchestratorText)",
      "gates": ["BV-06"],
      "requires": "MANIFEST.md text + artifact-orchestrator.md text",
      "blocking": "If FAIL, pipeline has regressed. Fix spec files before proceeding.",
      "note": "Convergence reframe: BV-06 anti-regression language scan. Runs BEFORE Phase 0."
    },
    {
      "step": 1,
      "phase": "Pre-build (Phase 1)",
      "function": "runBriefVerification(briefText)",
      "gates": ["BV-01", "BV-02", "BV-03", "BV-04", "BV-05"],
      "requires": "Brief text",
      "note": "BV-05 (Recipe Keyword Scan) added in Pipeline v4."
    },
    {
      "step": 1.8,
      "phase": "Post-build brief-output diff (Phase 3A, text-only)",
      "function": "checkBriefOutputDiff(briefText, htmlText)",
      "gates": ["BV-08"],
      "requires": "Brief text + HTML text (file read, no Playwright)",
      "note": "D2 crack dimension: Surfaces what the builder dropped during compression. Runs after build, before Playwright gates. droppedItems array feeds IMPROVE builder. Can run in parallel with Playwright setup."
    },
    {
      "step": 1.9,
      "phase": "Post-build narration check (Phase 3A, text-only)",
      "function": "verifyIntentComments(htmlText)",
      "gates": ["GR-83"],
      "requires": "HTML text (file read, no Playwright)",
      "note": "D2 crack dimension: Verifies builder INTENT comment count (target 17-22) and disposition coverage. RECOMMENDED — under-narration degrades BV-08 accuracy."
    },
    {
      "step": 1.95,
      "phase": "Post-build IMPROVEMENTS comment check (Phase 3A, text-only)",
      "function": "checkImprovementsComment(htmlText)",
      "gates": ["GR-84"],
      "requires": "HTML text (file read, no Playwright)",
      "note": "SIG-01: Validates IMPROVEMENTS comment (>= 5 items, >= 1 HIGH, >= 2 distinct tags). Feeds IMPROVE pass decision. RECOMMENDED."
    },
    {
      "step": 2,
      "phase": "Post-build (Phase 3A) — or use runPhase3Gates(page) wrapper",
      "function": "runGateRunner(page)",
      "gates": ["GR-01", "GR-02", "GR-03", "GR-04", "GR-05", "GR-05b", "GR-06", "GR-07", "GR-08", "GR-09", "GR-10", "GR-11", "GR-13", "GR-14", "GR-15", "GR-60", "GR-44", "GR-43", "GR-63"],
      "requires": "Playwright page at 1440px viewport"
    },
    {
      "step": 2.5,
      "phase": "Pre-screenshot (Phase 3A prep)",
      "function": "checkDPR(page)",
      "gates": ["GR-61"],
      "requires": "Playwright page — run BEFORE any screenshot capture",
      "blocking": "If FAIL, do NOT proceed to screenshot capture."
    },
    {
      "step": 2.7,
      "phase": "Post-screenshot (Phase 3A validation)",
      "function": "checkScreenshotQuality(screenshotDir)",
      "gates": ["GR-62"],
      "requires": "Saved screenshot files in screenshots/ directory (1440/, 1024/, 768/ subdirs)",
      "blocking": "If FAIL, re-capture screenshots. Do NOT deploy PA auditors on blank/corrupt screenshots."
    },
    {
      "step": 2.8,
      "phase": "Post-screenshot (visible content check)",
      "function": "checkVisibleContent(screenshotDir)",
      "gates": ["A-03"],
      "requires": "Screenshot directory",
      "note": "Pipeline v4: A-03 visible content check. WARNING if >= 3 consecutive screenshots < 5KB."
    },
    {
      "step": 3,
      "phase": "Post-build (Phase 3A)",
      "function": "runAntiPatternGates(page)",
      "gates": ["GR-17", "GR-18", "GR-19", "GR-20", "GR-21", "GR-22"],
      "requires": "Playwright page"
    },
    {
      "step": 4,
      "phase": "Post-build (Phase 3A)",
      "function": "runWave2Gates(page)",
      "gates": ["GR-45", "GR-46", "GR-50", "GR-51", "GR-52", "GR-53", "GR-55", "GR-66", "GR-67"],
      "requires": "Playwright page",
      "note": "Pipeline v4: GR-55 (Multi-Coherence), GR-66 (Component Count), GR-67 (Footer Text Size) added."
    },
    {
      "step": 5,
      "phase": "Responsive check",
      "function": "runGateRunner(page) at 768px",
      "gates": ["GR-01 through GR-15 (minus GR-12), GR-60, GR-44, GR-43, GR-63, GR-07 (re-run)"],
      "requires": "Playwright page at 768px viewport"
    },
    {
      "step": 1.5,
      "phase": "Pre-build (Phase 2 prep)",
      "function": "checkBuilderInputVolume(builderInputFiles)",
      "gates": ["BV-07"],
      "requires": "Array of builder-facing file names + line counts",
      "note": "Convergence reframe: BV-07 enforces 2,500-line ceiling on builder input. Run BEFORE spawning builder."
    },
    {
      "step": 5.5,
      "phase": "Post-weaver (Phase 3C validation)",
      "function": "runPostWeaverGates(auditorReports, weaverReport)",
      "gates": ["GR-64", "GR-81"],
      "requires": "All 9 auditor report texts + weaver report text",
      "note": "GR-81 (Prediction Suppression) runs alongside GR-64."
    },
    {
      "step": 5.7,
      "phase": "Post-weaver iteration check (cycle >= 2 only)",
      "function": "checkFindingStatusMap(weaverReport, iterationCycle)",
      "gates": ["GR-82"],
      "requires": "Weaver report text + iteration cycle number",
      "note": "Convergence reframe: GR-82 verifies Finding Status Map in weaver report for iteration cycles >= 2. Skip for cycle 1."
    },
    {
      "step": 5.8,
      "phase": "Post-verdict iteration check (cycle >= 2)",
      "function": "checkResidualArtifact(htmlText)",
      "gates": ["GR-78"],
      "requires": "HTML text of the built page",
      "note": "Convergence reframe: GR-78 validates builder RESIDUAL artifact. Run for cycle >= 2 (IMPROVE builds must include RESIDUAL comment)."
    },
    {
      "step": 5.85,
      "phase": "Post-verdict iteration check (cycle >= 2)",
      "function": "checkImproveCompletion(outputDir, iterationCycle)",
      "gates": ["GR-79"],
      "requires": "Output directory path + iteration cycle number",
      "blocking": "If FAIL, IMPROVE iteration is INCOMPLETE — missing re-audit artifacts.",
      "note": "Convergence reframe: GR-79 verifies all IMPROVE iteration artifacts exist with correct suffix."
    },
    {
      "step": 5.9,
      "phase": "Post-verdict iteration check (cycle >= 2)",
      "function": "checkIterationLogAutoFill(trackerText, iterationCycle, pa05Score, tier5Score, gatePassPercent, fixCount, verdict, decision)",
      "gates": ["GR-80"],
      "requires": "Tracker text + iteration cycle + gate run results",
      "note": "Convergence reframe: GR-80 auto-fills the Iteration Log table. WRITE gate — returns modified tracker text."
    },
    {
      "step": 6,
      "phase": "Meta-verification (AUTOMATIC — no opt-out)",
      "function": "runMetaGates(allResults)",
      "gates": ["GR-48", "GR-49"],
      "requires": "All previous gate results collected",
      "note": "Pipeline v4 B-01: GR-48 runs AUTOMATICALLY inside runMetaGates. No opt-out."
    }
  ],

  "unifiedWrapper": {
    "_comment": "B-01: runAllGates(page, briefText) calls all 4 phases sequentially and returns unified JSON",
    "function": "runAllGates(page, briefText)",
    "phases": [
      "runBriefVerification(briefText) — Phase 1",
      "runPhase3Gates(page) — Phase 3A (all Playwright DOM gates)",
      "runPostWeaverGates(reports, weaver) — Phase 3C (called separately after PA)",
      "runMetaGates(allResults) — Meta (GR-48 + GR-49, automatic)"
    ],
    "returns": "{ results: [], timestamp, gateCount, passed, failed }"
  },

  "gateExecutionManifestTemplate": {
    "_comment": "FIX-100: Template for gate-execution-manifest.json produced after every run",
    "buildId": "<unique-build-identifier>",
    "timestamp": "<ISO-8601>",
    "viewports": ["1440x900", "768x1024"],
    "tiersExecuted": {
      "required": { "executed": 0, "passed": 0, "failed": 0 },
      "recommended": { "executed": 0, "passed": 0, "failed": 0 },
      "advisory": { "executed": 0, "passed": 0, "failed": 0 },
      "briefVerification": { "executed": 0, "passed": 0, "failed": 0 }
    },
    "results": [
      {
        "gateId": "GR-XX",
        "tier": "required|recommended|advisory",
        "status": "PASS|FAIL",
        "source": "code|manual|skip",
        "details": {}
      }
    ],
    "verdict": "PROCEED_TO_PA|IMPROVE|RETHINK|INCOMPLETE|BLOCK_SCREENSHOTS|BLOCK_PA_DEPLOYMENT",
    "coverageStatus": {
      "requiredPresent": "19/19",
      "recommendedPresent": "N/10"
    }
  },

  "totalGateCount": {
    "inGateRunner": 46,
    "inOrchestrator": 8,
    "removed": 14,
    "total": 57,
    "briefVerification": 8,
    "diagnosticOnly": 2,
    "utility": 1,
    "grandTotal": 57,
    "note": "Pipeline v4: +3 GR gates (GR-55, GR-66, GR-67), +1 BV (BV-05), +1 utility (A-03). Convergence reframe: +1 BV (BV-06 anti-regression), +1 BV (BV-07 builder input ceiling), +1 REC (GR-82 finding status map), +1 ADV (GR-81 prediction suppression), +1 REQ (GR-79 IMPROVE file completion), +1 REC (GR-78 builder residual artifact), +1 REC (GR-80 iteration log auto-fill). D2 crack gates: +1 BV (BV-08 brief-output diff), +1 REC (GR-83 INTENT comment count). Gate architecture (SIG): GR-18 promoted RECOMMENDED->REQUIRED, GR-55 promoted ADVISORY->RECOMMENDED with perceptibility thresholds, +1 REC (GR-84 IMPROVEMENTS comment), GR-48 extended with BV coverage. inGateRunner = 46 unique GR-* gate IDs with executable code in core.js. Tiers: 22 REQUIRED + 15 RECOMMENDED + 9 ADVISORY + 2 DIAGNOSTIC + 8 BRIEF + 1 UTILITY = 57. Procedural-only gates (GR-65, GR-70, GR-75) are NOT counted in these totals — they are orchestrator manual checks, not executable code."
  },

  "notes": [
    "GR-16 absorbed into verdict logic (not a standalone gate)",
    "GR-23-28 reclassified to orchestrator Section 7 (Orchestrator Decision Rules) (FIX-094)",
    "GR-29-32 moved to orchestrator verdict logic (Wave 1)",
    "GR-35 moved to PA auditors (not automatable)",
    "GR-36-39 moved to experiment protocol (Wave 1)",
    "GR-40-42 moved to orchestrator process checks (Wave 1)",
    "GR-47 intentionally skipped (BV-01 covers same check per CONFLICT-007)",
    "GR-50 = Conviction Statement (ADVISORY, kept as-is — no collision with GR-55)",
    "GR-51 renumbered from source GR-43 to avoid collision",
    "GR-48 is self-referential: excluded from its own REQUIRED_GATES coverage array (21 gates) but counted in tier total (22). GR-48 also verifies BV-01 through BV-08 coverage (SIG-03).",
    "Wave 0 (2026-02-25): GR-05+GR-07 consolidated, GR-12 absorbed into GR-18, GR-19 demoted to ADVISORY, GR-60 WCAG AA added",
    "Wave 2 (2026-02-25): GR-05b ADVISORY, GR-06 rendered font check",
    "Wave 4 (2026-02-25): GR-61 DPR, GR-62 Screenshot Quality, GR-63 Experiential Marker (REQUIRED), GR-64 Usability Priority (REQUIRED)",
    "Pipeline v4 (2026-02-25): B-01 unified wrapper (runAllGates, runPhase3Gates, runPostWeaverGates, runMetaGates). B-03 source field on all results. B-04 GR-11 adjacent-only. B-05 GR-15 auto-margin exclusion. B-06 GR-55 multi-coherence. B-08 BV evidence details. B-11 GR-19 boundary exemption. B-14 exception patterns. A-03 visible content check. A-05 GR-66 component count. C-03 GR-67 footer text size. C-04 element-level fallback. D-07 BV-05 recipe keyword scan.",
    "Convergence reframe iteration (2026-02-25): GR-78 (Builder Residual Artifact, RECOMMENDED), GR-79 (IMPROVE File Completion, REQUIRED), GR-80 (Iteration Log Auto-Fill, RECOMMENDED). GR-70/GR-75 are procedural-only (embedded in orchestrator decision function, not code-enforced).",
    "D2 crack gates (2026-02-26): BV-08 (Brief-Output Diff, RECOMMENDED BV — 6-dimension comparison of brief spec vs HTML/CSS output, 80% coverage threshold per dimension, droppedItems array feeds IMPROVE builder). GR-83 (INTENT Comment Count, RECOMMENDED — verifies builder narration protocol: count 17-22, disposition coverage, metaphor, deliberate omissions). parseIntentComments() shared utility for BV-08/GR-83.",
    "Gate architecture changes (2026-02-26): SIG-05 GR-18 promoted RECOMMENDED->REQUIRED (ghost mechanisms = #1 proven failure mode). SIG-11 GR-55 promoted ADVISORY->RECOMMENDED with perceptibility thresholds (background >=15 RGB, font-size >=2px, letter-spacing >=0.5px, padding >=8px, border structural, font-family any). SIG-01 GR-84 (IMPROVEMENTS Comment, RECOMMENDED — verifies >=5 items, >=1 HIGH, >=2 distinct tags). SIG-03 GR-48 extended with BV-01 through BV-08 coverage check."
  ]
}
