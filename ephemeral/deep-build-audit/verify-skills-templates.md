# Skill Files + Template Verification Report

**Date:** 2026-02-28
**Agent:** verify-skills-templates
**Task:** Verify all skill files and prompt templates used by the deep-build pipeline

---

## 1. Skill Files

### 1a. Skills Referenced by the Pipeline

| Skill | Path | Exists | Lines | Issues |
|-------|------|--------|-------|--------|
| tension-composition (TC) | `~/.claude/skills/tension-composition/SKILL.md` | YES | 841 | None |
| perceptual-auditing (PA) | `~/.claude/skills/perceptual-auditing/SKILL.md` | YES | 524 | None |
| build-page | `~/.claude/skills/build-page/SKILL.md` | YES | 956 | Not directly invoked by deep-build (separate skill) |

**Notes:**
- TC and PA skills are not invoked as slash commands by the deep-build orchestrator — their content is embedded/referenced via corpus files (`ephemeral/va-extraction/pa-*.md`) and the template system
- The `build-page` skill (956 lines) is the wrapper skill that calls `deep-build`; it exists but is a separate layer
- All 3 skills exist and are populated

---

### 1b. deep-build Skill (The Skill That Invokes the Orchestrator)

| File | Path | Exists | Lines | Issues |
|------|------|--------|-------|--------|
| deep-build SKILL.md | `~/.claude/skills/deep-build/SKILL.md` | YES | 27 | Command path verified — see below |

**Command path in SKILL.md:**
```bash
node /Users/spacewizardmoneygang/Desktop/Claude-Research-And-Tips/tools/deep-build/dist/cli.js --content {CONTENT_PATH}
```

**dist/cli.js status:** EXISTS (215 lines) at exact path referenced in SKILL.md. **Path is correct.**

---

## 2. Template Files (tools/deep-build/templates/)

All 10 template files exist.

| Template | Path | Exists | Lines | Purpose |
|----------|------|--------|-------|---------|
| builder-corpus.md | `templates/builder-corpus.md` | YES | 277 | Phase A builder prompt (main corpus integration builder) |
| content-analysis.md | `templates/content-analysis.md` | YES | 74 | Phase 0 content analysis agent |
| pa-auditor.md | `templates/pa-auditor.md` | YES | 140 | PA cycle individual auditor (one per auditor ID) |
| pa-integrative.md | `templates/pa-integrative.md` | YES | 118 | PA integrative pass (combines auditor outputs) |
| pa-weaver.md | `templates/pa-weaver.md` | YES | 207 | PA weaver/synthesizer agent |
| refine-builder.md | `templates/refine-builder.md` | YES | 199 | Phase A refine builder (post-pass refinement) |
| retrospective.md | `templates/retrospective.md` | YES | 60 | Retrospective/reflection agent |
| tc-derivation.md | `templates/tc-derivation.md` | YES | 62 | TC derivation agent (Phase 0) |
| verifier-corpus.md | `templates/verifier-corpus.md` | YES | 105 | Verifier agent (checks artifact after each pass) |
| world-description.md | `templates/world-description.md` | YES | 13 | Short world description loaded as WORLD_DESCRIPTION var |

**Total template lines:** 1,255

---

## 3. Template Variables — Files Loaded from Disk

The assembler (`src/prompts/assembler.ts`) loads these files to populate template `{VARIABLE}` placeholders.

### 3a. Infrastructure Files (Loaded Every Pass)

| Variable | File Path | Exists | Lines | Notes |
|----------|-----------|--------|-------|-------|
| `{MECHANISM_CATALOG}` | `design-system/compositional-core/grammar/mechanism-catalog.md` | YES | 751 | Loaded every pass |
| `{COMPONENTS_CSS}` | `design-system/compositional-core/components/components.css` | YES | 944 | Loaded every pass |
| `{TOKENS_CSS}` | `design-system/compositional-core/vocabulary/tokens.css` | YES | 183 | Loaded every pass |

### 3b. Static/Fixed Variables

| Variable | File Path | Exists | Lines | Notes |
|----------|-----------|--------|-------|-------|
| `{WORLD_DESCRIPTION}` | `templates/world-description.md` | YES | 13 | Loaded from templates dir |
| `{CASE_STUDY}` | `design-system/compositional-core/case-studies/CD-006/exploration.html` | **NO** | — | **ISSUE — see below** |

### 3c. Run-Time Variables (Generated During Execution)

| Variable | Source | Notes |
|----------|--------|-------|
| `{CONVICTION_BRIEF}` | `<outputDir>/_tc-brief.md` | Generated by TC derivation pass |
| `{CONTENT_MAP}` | `<outputDir>/_content-map.md` | Generated by content analysis pass |
| `{CONTENT_MARKDOWN}` | User-provided content file | Read at CLI invocation |
| `{CURRENT_ARTIFACT}` | `<outputDir>/artifact.html` | Updated each pass |
| `{CORPUS_FILES_CONCATENATED}` | Per-subset corpus files | Assembled at pass time |
| `{CORPUS_LAYER}` / `{CONVICTION_LAYER}` | State/runtime | Assembled dynamically |

### 3d. Corpus Subset Files (Rotated Per Subset)

All 24 unique corpus files verified:

**Subset 1 — Research Foundation**
| File | Exists | Lines |
|------|--------|-------|
| `design-system/research/R3-DENSITY-DIMENSIONS.md` | YES | 553 |
| `design-system/research/R4-AXIS-INNOVATIONS.md` | YES | 990 |
| `design-system/research/R5-COMBINATION-THEORY.md` | YES | 784 |
| `design-system/research/RESEARCH-SYNTHESIS.md` | YES | 383 |
| `design-system/compositional-core/case-studies/DD-006-fractal.md` | YES | 377 |

**Subset 2 — Identity & Perception**
| File | Exists | Lines |
|------|--------|-------|
| `design-system/research/R1-DOCUMENTATION-PATTERNS.md` | YES | 584 |
| `design-system/research/R2-CREATIVE-LAYOUTS.md` | YES | 810 |
| `design-system/compositional-core/case-studies/OD-001-conversational.md` | YES | 297 |
| `design-system/compositional-core/case-studies/OD-004-confidence.md` | YES | 309 |
| `design-system/compositional-core/case-studies/OD-006-creative.md` | YES | 333 |

**Subset 3 — Deep Dives & Structure**
| File | Exists | Lines |
|------|--------|-------|
| `design-system/compositional-core/case-studies/DD-003-islands.md` | YES | 405 |
| `design-system/compositional-core/case-studies/DD-004-layers.md` | YES | 428 |
| `design-system/compositional-core/case-studies/dd-003-islands-visual.md` | YES | 462 |
| `design-system/compositional-core/case-studies/dd-004-layers-visual.md` | YES | 144 |
| `design-system/compositional-core/case-studies/dd-006-fractal-visual.md` | YES | 165 |

**Subset 4 — Composition Case Studies**
| File | Exists | Lines |
|------|--------|-------|
| `design-system/compositional-core/case-studies/CD-001-reasoning-inside-code.md` | YES | 415 |
| `design-system/compositional-core/case-studies/CD-005-multi-axis-transition.md` | YES | 386 |
| `design-system/compositional-core/case-studies/CD-006-pilot-migration.md` | YES | 387 |
| `design-system/compositional-core/case-studies/ANTI-PRESCRIPTION-TEMPLATE.md` | YES | 471 |

**Subset 5 — Identity & Guidelines**
| File | Exists | Lines |
|------|--------|-------|
| `design-system/compositional-core/guidelines/semantic-rules.md` | YES | 529 |
| `design-system/compositional-core/identity/prohibitions.md` | YES | 419 |
| `design-system/compositional-core/identity/soul-constraints.md` | YES | 342 |
| `design-system/compositional-core/case-studies/README.md` | YES | 541 |

**Subset 6 — Pipeline Knowledge (ephemeral/va-extraction/)**
| File | Exists | Lines |
|------|--------|-------|
| `ephemeral/va-extraction/artifact-identity-perception.md` | YES | 556 |
| `ephemeral/va-extraction/artifact-builder-recipe.md` | YES | 827 |
| `ephemeral/va-extraction/artifact-routing.md` | YES | 1,056 |
| `ephemeral/va-extraction/artifact-orchestrator.md` | YES | 755 |
| `ephemeral/va-extraction/artifact-value-tables.md` | YES | 262 |
| `ephemeral/va-extraction/artifact-tc-brief-template.md` | YES | 235 |

**Subset 7 — PA & Evaluation (ephemeral/va-extraction/)**
| File | Exists | Lines |
|------|--------|-------|
| `ephemeral/va-extraction/pa-questions.md` | YES | 456 |
| `ephemeral/va-extraction/pa-deployment.md` | YES | 450 |
| `ephemeral/va-extraction/pa-weaver.md` | YES | 468 |
| `ephemeral/va-extraction/pa-guardrails.md` | YES | 113 |
| `ephemeral/va-extraction/pa-guardrails-weaver.md` | YES | 59 |

---

## 4. Issues Found

### ISSUE 1: MISSING — CD-006/exploration.html (CASE_STUDY variable)

**Severity:** MODERATE — silent failure, not a crash

**What the code does:**
```typescript
vars.set('CASE_STUDY', loadFileOrEmpty(path.join(pr, 'design-system/compositional-core/case-studies/CD-006/exploration.html')));
```

`loadFileOrEmpty()` returns `''` (empty string) when the file is missing — the pipeline does NOT crash. However, `{CASE_STUDY}` will be substituted with an empty string in `builder-corpus.md` and `refine-builder.md`.

**What exists instead:**
- `design-system/compositional-core/case-studies/CD-006-pilot-migration.md` (387 lines) — the markdown case study EXISTS
- `design-system/compositional-core/case-studies/CD-006/` — directory does NOT exist
- No `exploration.html` found anywhere in the project

**Effect:** Builder and refine-builder agents receive no CD-006 HTML reference. This degrades their ability to use the CEILING-tier reference page as a quality benchmark. Silent failure — no error logged.

**Fix options:**
1. If the HTML was never created: update `assembler.ts` to load `CD-006-pilot-migration.md` instead (`vars.set('CASE_STUDY', loadFileOrEmpty(path.join(pr, 'design-system/compositional-core/case-studies/CD-006-pilot-migration.md')))`)
2. If the HTML should exist: create `design-system/compositional-core/case-studies/CD-006/exploration.html` from the CD-006 CEILING artifact

---

### ISSUE 2: R5 Path Discrepancy Between corpus.ts and paths.ts

**Severity:** LOW — paths.ts reference unused in template assembly

**corpus.ts** (used by corpus subset S1):
```
design-system/research/R5-COMBINATION-THEORY.md  ← EXISTS (784 lines)
```

**paths.ts** (exports `resolveProjectPaths().r5`):
```
design-system/research/R5-agent-assisted-design-review.md  ← DOES NOT EXIST
```

The `paths.ts` reference (`r5` field) appears to be a stale/wrong path. However, it is only used in 2 places (`src/pa/pa-orchestrator.ts` lines that pass it to PA agents as a research file), not in the main corpus assembly path.

**Effect:** PA agents that receive `{RESEARCH_FILES}` may receive an empty string for the R5 slot if the stale path is used. Needs confirmation of which code path actually uses `resolveProjectPaths().r5`.

---

### ISSUE 3: Line Count Drift in corpus.ts approximateLines

**Severity:** INFORMATIONAL — approximateLines is advisory, not functional

Several files have drifted significantly from their `approximateLines` estimates in corpus.ts:

| File | corpus.ts estimate | Actual lines | Delta |
|------|--------------------|--------------|-------|
| `artifact-routing.md` | 300 | 1,056 | +756 (+252%) |
| `artifact-builder-recipe.md` | 400 | 827 | +427 (+107%) |
| `pa-questions.md` | 431 | 456 | +25 |
| `pa-weaver.md` | 449 | 468 | +19 |

These values are used for token budget estimation in the trimming logic. Significant underestimates (routing, recipe) could cause the trimmer to underestimate token cost per pass, potentially producing prompts that exceed limits more often than expected.

---

## 5. Summary

| Category | Count | Status |
|----------|-------|--------|
| Skill files (TC, PA, build-page, deep-build) | 4 | All present |
| Template files | 10 | All present |
| Infrastructure corpus files (always loaded) | 3 | All present |
| Corpus subset files (S1-S7) | 35 | All present |
| Static variable files loaded from disk | 5 | 4/5 present; CD-006/exploration.html MISSING |
| dist/cli.js (deep-build SKILL.md target) | 1 | Present, path correct |

**Blocking issues:** 0 (CASE_STUDY silently fails with empty string, not a crash)
**Issues requiring attention:** 2 (CASE_STUDY missing file, R5 path mismatch in paths.ts)
**Informational:** 1 (approximateLines drift in corpus.ts)
