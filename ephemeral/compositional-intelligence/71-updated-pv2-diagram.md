# Pipeline V2 — UPDATED Architecture Diagram (Post-Compositional Intelligence Investigation)

**Reference Document** — This is the updated canonical ASCII visualization of Pipeline V2
after the 30-agent compositional intelligence investigation.
**Generated:** 2026-02-19
**Source:** 30+ Opus agents, ~32 reports in ephemeral/compositional-intelligence/
**Directives:** ALWAYS FLAGSHIP | ALWAYS REMEDIATION-STYLE | FIRE AND FORGET
**Key changes from original PV2:** Transition table as new artifact, enriched TC (~650 lines),
new gates SC-13/SC-14/SC-15, structured build plan, telescope+microscope recipe format,
experiment branch (Recipe vs Principles Brief pending tests)

---

```
╔══════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                                                                                  ║
║              PIPELINE V2 — UPDATED ARCHITECTURE (Post-Compositional Intelligence)                ║
║              ════════════════════════════════════════════════════════════════                      ║
║                                                                                                  ║
║    Directive: ALWAYS FLAGSHIP | ALWAYS REMEDIATION-STYLE | FIRE AND FORGET                       ║
║    Evidence:  30+ Opus agents, 32 reports, 5 scales traced, 6 channels traced,                   ║
║              3 stacks analyzed, 7 design explorations, 4 integrations, 4 metacognitive           ║
║    Delta:    Transition table, enriched TC, 3 new gates, structured build plan,                   ║
║              telescope+microscope recipe, experiment branch                                       ║
║                                                                                                  ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════╝


═══════════════════════════════════════════════════════════════════════════════════════════════════
  USER ENTRY POINT
═══════════════════════════════════════════════════════════════════════════════════════════════════

    USER TYPES:
    ┌─────────────────────────────────────────────┐
    │  /build-page path/to/content.md             │
    └──────────────────────┬──────────────────────┘
                           │
                           ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │  WHAT THIS IS:                                                         │
    │  A single slash command. The user's ONLY interaction with the pipeline. │
    │  Input = any existing markdown file in the project.                     │
    │                                                                        │
    │  WHAT CHANGED (from original PV2):                                     │
    │  - ALWAYS FLAGSHIP hardcoded -- zero tier routing, zero classification  │
    │  - TC skill ENRICHED from 1,878 to ~1,336 lines (542 lines of tier    │
    │    routing removed, replaced with operational compositional content)    │
    │  - NEW ARTIFACT: Transition Table generated by TC planner              │
    │  - NEW ARTIFACT: Structured Build Plan (YAML-parseable, not prose)     │
    │  - NEW GATES: SC-13 (multi-coherence), SC-14 (mass distribution),     │
    │    SC-15 (sub-perceptual prevention)                                   │
    │  - EXPERIMENT BRANCH: Recipe path vs Principles Brief path             │
    │    (both shown, pending 3 cheap experiments to determine winner)        │
    │                                                                        │
    │  COMPOSITIONAL INTELLIGENCE AT THIS STAGE:                             │
    │  None yet. The orchestrator is a ROUTER, not a composer. It reads      │
    │  content.md and invokes TC. All compositional intelligence lives in    │
    │  the TC planner and the artifacts it produces.                          │
    └─────────────────────────────────────────────────────────────────────────┘
                           │
                           │  Orchestrator reads content.md
                           │  Invokes enriched TC skill (~1,336 lines)
                           ▼

═══════════════════════════════════════════════════════════════════════════════════════════════════
  WAVE 0: CONTENT ANALYSIS + COMPOSITIONAL PLANNING  (Enriched TC Planner, Opus, ~30-60 min)
═══════════════════════════════════════════════════════════════════════════════════════════════════

    ┌─────────────────────────────────────────────────────────────────────┐
    │              ENRICHED /tension-composition                          │
    │              Phases 0 → 3.5 + NEW Phase 4T (Transition Table)      │
    │              ~1,336 lines (was 1,878 — 542 lines removed)          │
    └─────────────────────────────────────────────────────────────────────┘
                           │
         ┌─────────────────┼─────────────────┐
         ▼                 ▼                 ▼
    ┌──────────┐    ┌──────────────┐   ┌──────────────┐
    │ Phase 0  │    │  Phase 1     │   │  Phase 2     │
    │ Content  │───▶│  Multi-Axis  │──▶│  Tension     │
    │ Analysis │    │  Questioning │   │  Derivation  │
    │          │    │  (9+ axes)   │   │  + Addition  │
    │ CHANGED: │    │              │   │  Test        │
    │ No tier  │    │  UNCHANGED   │   │              │
    │ routing. │    │  (core       │   │  UNCHANGED   │
    │ Direct   │    │  invocational│   │  (creative   │
    │ to full  │    │  engine,     │   │  engine)     │
    │ pipeline │    │  718 lines)  │   │              │
    └──────────┘    └──────────────┘   └──────┬───────┘
                                              │
                                    ┌─────────┴─────────┐
                                    │  ADDITION TEST    │
                                    │  (Binary Gate)    │
                                    └────┬─────────┬────┘
                              TENSION    │         │  NO TENSION
                              EXISTS     │         │  (low-complexity
                                         ▼         ▼   content)
                                    ┌─────────┐  ┌──────────┐
                                    │ Phase 3 │  │ FLAT     │
                                    │ Metaphor│  │ MODE     │
                                    │ Collapse│  │ (zones + │
                                    └────┬────┘  │ recipe,  │
                                         │       │ no       │
                                         ▼       │ metaphor)│
                                    ┌─────────┐  └────┬─────┘
                                    │Phase 3.5│       │
                                    │ Lock-In │       │
                                    │  Gate   │       │
                                    └────┬────┘       │
                                         │            │
                                         └──────┬─────┘
                                                │
                                                ▼
                               ┌────────────────────────────────┐
                               │  ★ NEW: Phase 4T              │
                               │  TRANSITION TABLE GENERATION   │
                               │                                │
                               │  TC planner computes per-      │
                               │  boundary channel shifts:      │
                               │                                │
                               │  ┌─────────────────────────┐   │
                               │  │ Boundary │ bg   │ font  │   │
                               │  │          │ delta│ size  │   │
                               │  │          │      │ shift │   │
                               │  ├──────────┼──────┼───────┤   │
                               │  │ S1→S2    │ +20  │ same  │   │
                               │  │ S2→S3    │ -15  │ -1px  │   │
                               │  │ S3→S4    │ +25  │ same  │   │
                               │  └─────────────────────────┘   │
                               │                                │
                               │  6 columns: bg, font-size,     │
                               │  font-weight, letter-spacing,  │
                               │  border-left, margin           │
                               │                                │
                               │  RULE: Every row must show     │
                               │  >= 3 columns changing         │
                               │  (multi-coherence requirement) │
                               └──────────────┬─────────────────┘
                                              │
                                              ▼
                                    ┌──────────────────┐
                                    │  _build-plan.md  │
                                    │  (STRUCTURED)    │
                                    │  + _transition-  │
                                    │  table.md (NEW)  │
                                    └──────────────────┘

    ┌─────────────────────────────────────────────────────────────────────────┐
    │  WHAT CHANGED IN WAVE 0 (from original PV2):                          │
    │                                                                        │
    │  1. TC SKILL ENRICHED (-542 tier routing, +operational content)        │
    │     REMOVED: 78 lines Phase 0D tier classification                    │
    │     REMOVED: 12 lines Ceiling context box (now default)               │
    │     REMOVED: 95 lines divergence verification (ALWAYS FLAGSHIP)       │
    │     REMOVED: 42 lines duplicate guardrails                            │
    │     REMOVED: 76 lines stale/redundant content                         │
    │     REMOVED: 239 lines other tier-conditional references              │
    │     REPLACED WITH: Operational CSS patterns, channel shift templates, │
    │     section-level deployment guidance, perceptual self-checks          │
    │                                                                        │
    │  2. NEW ARTIFACT: Transition Table (_transition-table.md)             │
    │     WHY: Reports 02, 03, 12, 17, 18 ALL identified the same gap:     │
    │     the TC planner derives per-boundary compositional decisions but    │
    │     outputs them as prose. The builder must re-derive them. The        │
    │     transition table makes these decisions EXPLICIT and TABULAR.       │
    │     FORMAT: 6-column table (bg, font-size, font-weight, letter-       │
    │     spacing, border-left, margin) x N boundaries                      │
    │     EACH ROW: >= 3 columns must show change (multi-coherence)         │
    │     SEMANTIC DIRECTION: Each column annotated with WHY it changes     │
    │     ("deepening" / "compressing" / "opening" / "same")                │
    │                                                                        │
    │  3. STRUCTURED BUILD PLAN (YAML-parseable)                            │
    │     WHY: Report 15 (YAML gates) found that text-based handoff is      │
    │     unparseable by the orchestrator. Structured format enables         │
    │     programmatic validation at Wave 0.9.                               │
    │     FORMAT:                                                            │
    │       zones: 4                                                         │
    │       sections:                                                        │
    │         - id: S1                                                        │
    │           zone: 1                                                       │
    │           type: NARRATIVE                                               │
    │           bg: "#FEF9F5"                                                │
    │       mechanisms:                                                       │
    │         spatial: [progressive-disclosure, breathing-zones]              │
    │         hierarchy: [border-weight-gradient]                             │
    │         ...                                                            │
    │       transitions:                                                      │
    │         - boundary: S1-S2                                               │
    │           type: SMOOTH                                                  │
    │           channels_shifting: [bg, font-weight, border-left]            │
    │                                                                        │
    │  4. COMPOSITIONAL INTELLIGENCE AT THIS STAGE:                         │
    │     - Content-to-form mapping (WHY these zones, WHY this metaphor)    │
    │     - Per-boundary multi-coherence plan (transition table)             │
    │     - Semantic direction annotations ("deepening", "opening")          │
    │     - Section-level mechanism deployment (not just page-level)         │
    │     - Fractal scale coverage table (5 scales, CSS evidence per)       │
    │     - Navigation-scale design (header/footer/TOC specification)       │
    │                                                                        │
    │  WHAT WAS DIFFERENT FROM OLD PV2:                                     │
    │  Old PV2: TC outputs prose build plan. Builder mentally merges with   │
    │           recipe. Multi-coherence is checked POST-BUILD (Phase 8).     │
    │  New PV2: TC outputs structured plan + transition table. Builder      │
    │           receives pre-computed channel shifts. Multi-coherence is     │
    │           PLANNED (Phase 4T), VALIDATED (Wave 0.9), and VERIFIED      │
    │           (Wave 2 SC-13).                                              │
    │                                                                        │
    │  TIME: ~30-60 minutes (autonomous)                                     │
    └─────────────────────────────────────────────────────────────────────────┘
                                                │
                                                │  Structured build plan + transition table
                                                ▼

═══════════════════════════════════════════════════════════════════════════════════════════════════
  WAVE 0.5: METAPHOR VALIDATION  (Fresh-Eyes Opus, ~5-10 min)
═══════════════════════════════════════════════════════════════════════════════════════════════════

                                    ┌──────────────────────┐
                                    │  Fresh-Eyes Opus     │
                                    │  Agent               │
                                    │                      │
                                    │  Reads: ONLY the     │
                                    │  metaphor description│
                                    │  from _build-plan.md │
                                    │                      │
                                    │  Does NOT read:      │
                                    │  - Content markdown  │
                                    │  - Tension derivation│
                                    │  - Axis questioning  │
                                    │  - Transition table  │
                                    └──────────┬───────────┘
                                               │
                                    ┌──────────┴───────────┐
                                    │  BINARY GATE:        │
                                    │                      │
                                    │  STRUCTURAL?         │
                                    │  (metaphor suggests  │
                                    │   specific CSS forms)│
                                    │         │            │
                                    │    YES  │   NO       │
                                    │    ┌────┘   └────┐   │
                                    │    ▼              ▼   │
                                    │  PASS          FAIL   │
                                    │  (proceed)  (return   │
                                    │             to TC or  │
                                    │             FLAT mode)│
                                    └──────────────────────┘

    ┌─────────────────────────────────────────────────────────────────────────┐
    │  WHAT CHANGED (from original PV2):                                     │
    │  Structurally UNCHANGED. This wave remains a fresh-eyes metaphor       │
    │  validation. Reports 10 (behavioral) and 11 (material) noted that      │
    │  metaphor validation does NOT check behavioral or material channel     │
    │  implications. However, adding channel-specific checks here would      │
    │  violate the fresh-eyes principle (zero context). The behavioral and   │
    │  material gaps are addressed downstream in the transition table        │
    │  (Wave 0 Phase 4T) and the new gates (Wave 2 SC-13/14/15).           │
    │                                                                        │
    │  COMPOSITIONAL INTELLIGENCE AT THIS STAGE:                             │
    │  - Binary STRUCTURAL/ANNOUNCED judgment (same as before)               │
    │  - Prevents wasted 90-150 min build on doomed metaphor (same)         │
    │                                                                        │
    │  TIME: ~5-10 minutes (autonomous)                                      │
    └─────────────────────────────────────────────────────────────────────────┘
                                               │
                                               │  Metaphor validated (or flat mode)
                                               ▼

═══════════════════════════════════════════════════════════════════════════════════════════════════
  WAVE 0.9: HANDOFF VALIDATION GATE  (Programmatic, ~1-2 min) [EXPANDED]
═══════════════════════════════════════════════════════════════════════════════════════════════════

                              ┌────────────────────────────────────┐
                              │  HANDOFF GATE (EXPANDED)           │
                              │  (8 binary checks — was 5)        │
                              │                                    │
                              │  ORIGINAL 5 CHECKS:               │
                              │  [ ] Zone count 2-5?               │
                              │  [ ] BG colors >= 15 RGB delta?    │
                              │  [ ] >= 2 grid layouts?            │
                              │  [ ] Per-category mechs met?       │
                              │      (S/T/M/B/R: 1+ each)        │
                              │  [ ] >= 3 transition types?        │
                              │                                    │
                              │  ★ NEW CHECK 6:                    │
                              │  [ ] Transition table present?     │
                              │      (>= N-1 rows for N zones,    │
                              │      each row shows >= 3 channel   │
                              │      shifts)                       │
                              │                                    │
                              │  ★ NEW CHECK 7:                    │
                              │  [ ] Navigation-scale spec?        │
                              │      (header + footer + TOC        │
                              │      specified in build plan)      │
                              │                                    │
                              │  ★ NEW CHECK 8:                    │
                              │  [ ] Semantic direction declared?  │
                              │      (build plan states overall    │
                              │      direction: "deepening" /      │
                              │      "expanding" / "cycling" /     │
                              │      "converging")                 │
                              │                                    │
                              │  ALL must PASS.                    │
                              │  Any FAIL → return to TC.          │
                              └─────────────┬──────────────────────┘
                                            │
                                       ALL 8 PASS
                                            │
                                            ▼

    ┌─────────────────────────────────────────────────────────────────────────┐
    │  WHAT CHANGED (from original PV2):                                     │
    │                                                                        │
    │  3 NEW CHECKS added based on investigation findings:                   │
    │                                                                        │
    │  CHECK 6 (Transition Table): Reports 02, 03, 12, 17, 18 all found    │
    │  that multi-coherence was checked POST-BUILD but never PRE-PLANNED.   │
    │  The transition table makes multi-coherence a PLANNING artifact.       │
    │  The handoff gate validates it BEFORE the builder starts.              │
    │  WHY: Prevents the flagship failure mode where channels shifted        │
    │  independently (bg by 1-8 RGB, typography uniformly 16px).            │
    │                                                                        │
    │  CHECK 7 (Navigation-Scale): Report 01 found that navigation-scale    │
    │  design (header/footer/TOC) was never planned or checked. The          │
    │  flagship's missing footer was a direct consequence.                    │
    │  WHY: The planner is the ONLY agent that reads the full content.       │
    │  If it doesn't specify navigation chrome, the builder must guess.      │
    │                                                                        │
    │  CHECK 8 (Semantic Direction): Reports 06, 07, 08 (chromatic,         │
    │  typographic, spatial) all found the same gap: thresholds ensure       │
    │  PERCEPTIBILITY but not MEANING. A semantic direction declaration      │
    │  ("this page deepens from surface to bedrock") gives all channels     │
    │  a shared compass.                                                     │
    │  WHY: Without it, SC-09 can pass with random color wandering,         │
    │  SC-11 can pass with static typography, SC-10 can pass with           │
    │  uniform spacing. Semantic direction aligns channels.                   │
    │                                                                        │
    │  STRUCTURED FORMAT: The build plan is now YAML-parseable (Report 15). │
    │  The orchestrator runs checks by PARSING, not by reading prose.        │
    │  This moves handoff from Model A (LLM reads text) to Model B          │
    │  (code parses structured data). Model B cannot be skimmed.            │
    │                                                                        │
    │  COMPOSITIONAL INTELLIGENCE AT THIS STAGE:                             │
    │  - Multi-coherence VALIDATED before build starts                       │
    │  - Navigation-scale design CONFIRMED                                   │
    │  - Semantic direction DECLARED and propagated to builder               │
    │  - All checks programmatic (YAML parsing, not text reading)           │
    │                                                                        │
    │  WHAT WAS DIFFERENT FROM OLD PV2:                                     │
    │  Old: 5 text-based checks, orchestrator text-parses prose plan         │
    │  New: 8 checks, 3 new, YAML-parseable, programmatic validation        │
    │                                                                        │
    │  TIME: ~1-2 minutes (autonomous, programmatic)                         │
    └─────────────────────────────────────────────────────────────────────────┘
                                            │
                                            │  Plan validated. Builder receives:
                                            │
                                            │  ┌─────────────────────────────────────┐
                                            │  │  BRIDGING TISSUE (what crosses      │
                                            │  │  the Wave 0.9 → Wave 1 boundary):  │
                                            │  │                                     │
                                            │  │  1. Structured _build-plan.md       │
                                            │  │     (YAML: zones, sections, mechs)  │
                                            │  │  2. _transition-table.md ★ NEW      │
                                            │  │     (per-boundary channel shifts)    │
                                            │  │  3. operational-recipe.md (~650 ln)  │
                                            │  │     (telescope+microscope format)    │
                                            │  │  4. tokens.css                       │
                                            │  │  5. prohibitions.md                  │
                                            │  │  6. merged-components.css            │
                                            │  │  7. mechanism-catalog.md (FULL)      │
                                            │  │                                     │
                                            │  │  TOTAL: ~1,450 lines (was ~1,150)  │
                                            │  │  +300 lines = transition table      │
                                            │  │  + structured build plan overhead    │
                                            │  └─────────────────────────────────────┘
                                            ▼

═══════════════════════════════════════════════════════════════════════════════════════════════════
  WAVE 1: BUILD EXECUTION  (Single Opus Builder, ~90-150 min)
═══════════════════════════════════════════════════════════════════════════════════════════════════

    ┌─────────────────────────────────────────────────────────────────────┐
    │                         OPUS BUILDER                               │
    │                         Reads 7 files (was 6)                     │
    │                         Executes 9-phase recipe                    │
    │                         ★ With telescope+microscope format        │
    └─────────────────────────────────────────────────────────────────────┘

    ══════════════════════════════════════════════════════════════════════
    ★ EXPERIMENT BRANCH: Two paths pending experimental validation
    ══════════════════════════════════════════════════════════════════════

       ┌──────────────────────────────────────────────────────────────┐
       │  PATH A: RECIPE (9-Phase Sequential)                        │
       │  (Current default. The Middle experiment's winning format.)  │
       │                                                              │
       │  The builder reads operational-recipe.md and follows 9       │
       │  phases in sequence. Each phase has:                         │
       │  - TELESCOPE comment (WHY this phase matters)               │
       │  - RECIPE steps (WHAT to do, in order)                      │
       │  - MICROSCOPE values (EXACT CSS to write)                   │
       │  - Per-phase "Can you SEE?" checks                          │
       │  - Planner approval checkpoint (Phases 0,1,3,4,8)          │
       │                                                              │
       │  ★ NEW: Recipe TEMPLATE merged with build plan              │
       │  (Report 17). Recipe phases contain SLOTS that the          │
       │  orchestrator fills with build-plan-specific values:        │
       │                                                              │
       │  PHASE 3: Zone Backgrounds                                   │
       │    {{build_plan.zones[0].bg}} (from structured build plan)  │
       │    {{build_plan.zones[1].bg}}                               │
       │    Delta check: {{transition_table.row[0].bg_delta}}        │
       │    Semantic: "{{build_plan.semantic_direction}}"             │
       │                                                              │
       │  This eliminates the "mental merge" problem (Report 17)     │
       │  where the builder had to cross-reference recipe + plan.    │
       └──────────────────────────────────────────────────────────────┘

       ┌──────────────────────────────────────────────────────────────┐
       │  PATH B: PRINCIPLES BRIEF (~100 lines) [EXPERIMENTAL]      │
       │  (CD-006's approach formalized. The contrarian's thesis.)   │
       │                                                              │
       │  The builder reads a short principles brief instead of a    │
       │  650-line recipe. The brief contains:                       │
       │  - Soul constraints (22 prohibitions)                       │
       │  - Perception thresholds (80 lines)                         │
       │  - Transition table (from TC planner)                       │
       │  - The single instruction: "Build a page that makes every  │
       │    visual decision serve the content's semantic direction"  │
       │                                                              │
       │  WHY THIS EXISTS (Reports 21, 27, 29, 30):                 │
       │  CD-006 scored 39/40 without a recipe. The anti-scale       │
       │  model says Richness = semantic density x restraint x       │
       │  spatial confidence. Recipes may CAP semantic density by    │
       │  prescribing values that satisfy thresholds but don't       │
       │  maximize meaning. The principles brief trusts Opus to      │
       │  compose while constraining it to produce visible results.  │
       │                                                              │
       │  REQUIRES EXPERIMENT to validate. Not default.              │
       └──────────────────────────────────────────────────────────────┘

    ══════════════════════════════════════════════════════════════════════

    9-PHASE SEQUENTIAL BUILD (PATH A — default):

    ┌──────────────────────────────────────────────────────────────────┐
    │                                                                  │
    │   PHASE 0: Content Analysis + Zone Architecture                  │
    │   ┌────────────────────────────────────────────────────────┐     │
    │   │  Read structured _build-plan.md (YAML).               │     │
    │   │  Read _transition-table.md.                            │     │
    │   │  Map content sections to zones.                        │     │
    │   │  ★ ABSORB semantic direction declaration.             │     │
    │   │  Self-test: "Am I about to build or about to plan?"   │     │
    │   │  ► Planner approval checkpoint                         │     │
    │   └────────────────────────────────────────────────────────┘     │
    │       CHANGED: Builder now reads STRUCTURED plan + transition   │
    │       table. Semantic direction ("deepening"/"expanding"/etc)   │
    │       is absorbed HERE and governs all subsequent phases.       │
    │                          │                                       │
    │                          ▼                                       │
    │   PHASE 1: HTML Skeleton                                         │
    │   ┌────────────────────────────────────────────────────────┐     │
    │   │  Semantic markup. Component library classes (>=10/26). │     │
    │   │  Grid layouts (>= 2). ARIA landmarks (>= 3).          │     │
    │   │  Skip link. <main>, <nav>, <article>, <section>.      │     │
    │   │  ★ Navigation-scale chrome from build plan (header,   │     │
    │   │    footer, TOC structure).                              │     │
    │   │  ► Planner approval checkpoint                         │     │
    │   └────────────────────────────────────────────────────────┘     │
    │       CHANGED: Navigation-scale design (header/footer/TOC)     │
    │       now comes FROM the build plan, not builder invention.     │
    │       Report 01 found navigation-scale was the first loss.     │
    │                          │                                       │
    │                          ▼                                       │
    │   PHASE 2: CSS Reset + Soul + Base Typography                    │
    │   ┌────────────────────────────────────────────────────────┐     │
    │   │  Zero border-radius. Zero box-shadow. No gradients.   │     │
    │   │  Container: max-width 960px, margin: 0 auto.          │     │
    │   │  Base: 16-18px, line-height 1.7+, system fonts.       │     │
    │   │  R >= G >= B for ALL colors.                           │     │
    │   └────────────────────────────────────────────────────────┘     │
    │       UNCHANGED. Soul enforcement is mechanical and adequate.   │
    │                          │                                       │
    │                          ▼                                       │
    │   PHASE 3: Zone Backgrounds                                      │
    │   ┌────────────────────────────────────────────────────────┐     │
    │   │  Apply background colors from build plan.              │     │
    │   │  ★ Use TRANSITION TABLE to verify:                    │     │
    │   │    - Each boundary has >= 15 RGB delta (from table)   │     │
    │   │    - Direction follows semantic declaration            │     │
    │   │  "Can you SEE the zone boundaries without borders?"   │     │
    │   │  ► Planner approval checkpoint                         │     │
    │   └────────────────────────────────────────────────────────┘     │
    │       CHANGED: Background values come PRE-COMPUTED from the    │
    │       transition table with semantic annotations. Builder      │
    │       applies them and verifies, doesn't derive them.          │
    │       Report 06: Chromatic channel now has semantic direction.  │
    │                          │                                       │
    │                          ▼                                       │
    │   PHASE 4: Structural Borders + Dividers + Transitions           │
    │   ┌────────────────────────────────────────────────────────┐     │
    │   │  ★ Read TRANSITION TABLE for per-boundary specs:      │     │
    │   │    - border-left values per section (from table)      │     │
    │   │    - Transition TYPE per boundary (SMOOTH/BRIDGE/     │     │
    │   │      BREATHING) with REASON from build plan           │     │
    │   │  Border-left on callouts/blockquotes (4px solid).      │     │
    │   │  Horizontal rules between major sections.              │     │
    │   │  Callout variants (info, warning, success, neutral).   │     │
    │   │  ► Planner approval checkpoint                         │     │
    │   └────────────────────────────────────────────────────────┘     │
    │       CHANGED: Border weights and transition types come from   │
    │       the transition table with semantic rationale. Builder    │
    │       knows WHY "S2→S3 is HARD CUT because domain changes"   │
    │       (Report 09: structural channel semantic encoding).       │
    │                          │                                       │
    │                          ▼                                       │
    │   PHASE 5: Typography Zones                                      │
    │   ┌────────────────────────────────────────────────────────┐     │
    │   │  3-zone typography arc: display / body / detail.       │     │
    │   │  ★ Read TRANSITION TABLE for per-zone typography:     │     │
    │   │    - Font-size shifts per boundary (from table)        │     │
    │   │    - Letter-spacing shifts per boundary (from table)   │     │
    │   │  MANDATORY: >= 2px font-size delta between zones.      │     │
    │   │  Letter-spacing: >= 0.03em between typographic zones.  │     │
    │   │  ★ Section-level variation: Zone 2's body at 15px/    │     │
    │   │    1.65 lh (compressed) vs Zone 1's at 18px/1.8 lh    │     │
    │   │    (generous) — driven by transition table.            │     │
    │   └────────────────────────────────────────────────────────┘     │
    │       CHANGED: Typography is now SECTION-VARYING, not just     │
    │       PAGE-LEVEL hierarchy. Report 07 found the 3-zone arc    │
    │       was the pipeline's ENTIRE typographic intelligence and   │
    │       it operated at one scale only. The transition table      │
    │       enables per-boundary typographic modulation.             │
    │                          │                                       │
    │                          ▼                                       │
    │   PHASE 6: Element-Level Richness                                │
    │   ┌────────────────────────────────────────────────────────┐     │
    │   │  ★ 3-TYPE CHARACTER TAXONOMY (Report 05):             │     │
    │   │  Type A: INTERACTIVE (always deploy):                  │     │
    │   │    ::selection, a:hover, *:focus-visible, tr:hover     │     │
    │   │  Type B: SEMANTIC (deploy when content requires):      │     │
    │   │    inline-code bg, ::first-letter, labels/meta text    │     │
    │   │  Type C: ATMOSPHERIC (deploy sparingly):               │     │
    │   │    letter-spacing >= 0.03em on labels ONLY             │     │
    │   │  ANTI-TYPE: sub-perceptual (NEVER deploy):             │     │
    │   │    letter-spacing < 0.03em, line-height micro-shifts   │     │
    │   └────────────────────────────────────────────────────────┘     │
    │       CHANGED: Character-scale now has a taxonomy that          │
    │       distinguishes meaningful from wasted CSS. Report 05      │
    │       found flagship wasted 22% of CSS on Type C/anti-type;   │
    │       CD-006 achieved MORE richness with 8x less character CSS. │
    │                          │                                       │
    │                          ▼                                       │
    │   PHASE 7: Accessibility                                         │
    │   ┌────────────────────────────────────────────────────────┐     │
    │   │  Skip link, ARIA landmarks >= 3, Focus styles,         │     │
    │   │  Reduced motion, Responsive breakpoints, Print styles. │     │
    │   │  Target: full WCAG 2.1 AA compliance.                  │     │
    │   └────────────────────────────────────────────────────────┘     │
    │       UNCHANGED. Accessibility is mechanical and adequate.      │
    │                          │                                       │
    │                          ▼                                       │
    │   PHASE 8: Verification + Cascade Value Table                    │
    │   ┌────────────────────────────────────────────────────────┐     │
    │   │  A-D: Self-checks (zone boundaries, typography,        │     │
    │   │       borders, soul constraints)                        │     │
    │   │  E. Cascade Value Table (REQUIRED):                    │     │
    │   │     ★ Compare against TRANSITION TABLE (from TC):     │     │
    │   │     - For each boundary, does actual match plan?       │     │
    │   │     - >= 3 channels shifting at every transition?      │     │
    │   │     - Direction matches semantic declaration?           │     │
    │   │  ★ F. Perception Self-Check (Report 22):              │     │
    │   │     "Can I SEE every zone boundary without a picker?" │     │
    │   │     "Is typography visibly different between zones?"   │     │
    │   │     "Do borders exist on structural elements?"         │     │
    │   │  ► Planner approval checkpoint (FINAL)                 │     │
    │   └────────────────────────────────────────────────────────┘     │
    │       CHANGED: The cascade value table is now compared          │
    │       AGAINST the transition table (plan vs actual). This      │
    │       closes the loop: TC plans channel shifts (Phase 4T),     │
    │       builder executes them (Phases 3-6), builder PROVES       │
    │       execution matched plan (Phase 8E). Report 12 identified  │
    │       this as the critical missing verification.                │
    │                                                                  │
    └──────────────────────────────────────────────────────────────────┘

    ┌─────────────────────────────────────────────────────────────────────────┐
    │  WAVE 1 SUMMARY — WHAT CHANGED:                                       │
    │                                                                        │
    │  1. TRANSITION TABLE as build-time reference                           │
    │     - Builder reads pre-computed per-boundary channel shifts           │
    │     - Eliminates "mental merge" of recipe + plan (Report 17)          │
    │     - Every phase reads the transition table for its channel           │
    │                                                                        │
    │  2. TELESCOPE+MICROSCOPE recipe format (Report 22)                     │
    │     - Every phase opens with WHY (telescope comment)                  │
    │     - Delivers WHAT to do (recipe steps)                              │
    │     - Embeds EXACT values (microscope CSS)                            │
    │     - Pattern extracted from remediation spec (PA-05: +1.0)           │
    │                                                                        │
    │  3. TEMPLATE MERGING (Report 17)                                       │
    │     - Recipe has SLOTS filled by build plan values                    │
    │     - Builder reads ONE document, not two                             │
    │     - Compositional intelligence INLINE with build steps              │
    │                                                                        │
    │  4. EXPERIMENT BRANCH (Reports 21, 27, 29, 30)                        │
    │     - Path A (Recipe) is default until experiments validate            │
    │     - Path B (Principles Brief) tests CD-006's approach               │
    │     - 3 cheap experiments designed (see Wave 4)                        │
    │                                                                        │
    │  5. CHARACTER TAXONOMY (Report 05)                                     │
    │     - 3 types: Interactive (always), Semantic (when needed),          │
    │       Atmospheric (sparingly)                                         │
    │     - Anti-type: sub-perceptual (NEVER)                               │
    │                                                                        │
    │  6. SECTION-LEVEL VARIATION (Reports 03, 07)                          │
    │     - Typography modulates per-section, not just page-level           │
    │     - Spacing varies per-section with semantic rationale              │
    │                                                                        │
    │  BUILDER VISIBILITY: ~1,450 lines (was ~1,150)                        │
    │  Additional ~300 lines = transition table + structured plan           │
    │  But cognitive load DECREASED because information is pre-merged       │
    │  (no mental cross-referencing of separate documents)                   │
    │                                                                        │
    │  TIME: ~90-150 minutes (autonomous)                                    │
    └─────────────────────────────────────────────────────────────────────────┘
                                            │
                                            │  output.html produced
                                            │  cascade value table produced
                                            ▼

═══════════════════════════════════════════════════════════════════════════════════════════════════
  WAVE 2: DUAL-LAYER VERIFICATION  (~30-45 min) [EXPANDED]
═══════════════════════════════════════════════════════════════════════════════════════════════════

    ┌─────────────────────────────────────────────────────────────────────┐
    │  LAYER 1: PROGRAMMATIC GATES  (Playwright + getComputedStyle)      │
    │  ─────────────────────────────────────────────────────────────────  │
    │                                                                     │
    │  15 binary checks. ALL BLOCKING. (was 12 — 3 NEW)                 │
    │                                                                     │
    │  ┌────────┬──────────────────────────────┬───────────────────────┐  │
    │  │  Gate  │  What It Checks              │  Threshold            │  │
    │  ├────────┼──────────────────────────────┼───────────────────────┤  │
    │  │ SC-01  │  Container width             │  940-960px            │  │
    │  │ SC-02  │  Soul properties             │  border-radius: 0    │  │
    │  │        │                              │  box-shadow: none     │  │
    │  │ SC-03  │  Font trinity                │  Only 3 allowed fonts │  │
    │  │ SC-04  │  Warm palette                │  R >= G >= B          │  │
    │  │ SC-05  │  No pure extremes            │  No #000 or #FFF      │  │
    │  │ SC-06  │  ARIA landmarks              │  >= 3                 │  │
    │  │ SC-07  │  Skip link                   │  Present              │  │
    │  │ SC-08  │  Component library           │  Library classes used │  │
    │  │ SC-09  │  Background delta            │  >= 15 RGB adjacent   │  │
    │  │ SC-10  │  Stacked gap                 │  <= 108px total       │  │
    │  │ SC-11  │  Font-size zones             │  >= 2px delta         │  │
    │  │ SC-12  │  Zone count                  │  2-5 zones            │  │
    │  │        │                              │                       │  │
    │  │ ★ SC-13│  Multi-coherence             │  >= 3 channels shift  │  │
    │  │  (NEW) │  at section boundaries       │  at each boundary     │  │
    │  │        │                              │  (measures bg, font-  │  │
    │  │        │                              │  size, font-weight,   │  │
    │  │        │                              │  letter-spacing,      │  │
    │  │        │                              │  border-left, margin) │  │
    │  │        │                              │                       │  │
    │  │ ★ SC-14│  Mass distribution           │  No viewport section  │  │
    │  │  (NEW) │                              │  < 30% content        │  │
    │  │        │                              │  coverage (prevents   │  │
    │  │        │                              │  whitespace voids)    │  │
    │  │        │                              │                       │  │
    │  │ ★ SC-15│  Sub-perceptual prevention   │  No letter-spacing    │  │
    │  │  (NEW) │                              │  below 0.03em; no     │  │
    │  │        │                              │  line-height micro-   │  │
    │  │        │                              │  shifts (< 0.1 diff)  │  │
    │  └────────┴──────────────────────────────┴───────────────────────┘  │
    │                                                                     │
    │  SC-13 HOW IT WORKS:                                                │
    │  gate-runner.js identifies section boundaries via data-zone or      │
    │  <section> elements. At each boundary, it samples getComputedStyle │
    │  from the LAST element of section N and FIRST element of section   │
    │  N+1. Counts channels that differ: bg, font-size, font-weight,    │
    │  letter-spacing, border-left, margin. If < 3 differ → FAIL.      │
    │  ★ NOTE: SC-13 checks EXISTENCE of shifts, not SEMANTIC DIRECTION. │
    │  Semantic direction verification remains perceptual (PA in Layer 2).│
    │                                                                     │
    │  SC-14 HOW IT WORKS:                                                │
    │  gate-runner.js measures element bounding boxes within each zone.  │
    │  If any viewport-height segment has < 30% content coverage (the    │
    │  rest is blank whitespace), → FAIL. This catches the flagship's   │
    │  catastrophic whitespace void (70-80% blank, 9/9 auditors flagged).│
    │                                                                     │
    │  SC-15 HOW IT WORKS:                                                │
    │  gate-runner.js scans ALL computed letter-spacing values. If any   │
    │  element has letter-spacing > 0 and < 0.03em → FAIL. Also scans  │
    │  line-height: if any two adjacent elements differ by < 0.1 in      │
    │  computed line-height → WARNING (not blocking, but logged).       │
    │  This prevents the flagship's 22% CSS budget waste on invisible    │
    │  micro-typography.                                                   │
    │                                                                     │
    │  ★ FIX RECIPE GENERATION (NEW):                                    │
    │  When a gate FAILS, gate-runner.js now generates a FIX RECIPE:     │
    │    { gate: "SC-09", status: "FAIL",                                │
    │      measured: { zones: ["#FEF9F5", "#FEFAF6"], delta: 3 },       │
    │      fix: "Darken zone 2 to at least #EFE9E0 (+15 delta)" }      │
    │  These fix recipes feed directly into Wave 3.                      │
    │                                                                     │
    └─────────────────────────────────────────────────────────────────────┘
                                            │
                                            │  All 15 gates PASS
                                            ▼
    ┌─────────────────────────────────────────────────────────────────────┐
    │  LAYER 2: PERCEPTUAL AUDIT  (Mode 4 — 9 Fresh-Eyes Opus Auditors) │
    │  ─────────────────────────────────────────────────────────────────  │
    │                                                                     │
    │  UNCHANGED from original PV2 except:                                │
    │                                                                     │
    │  ★ PA auditors now receive COMPOSITIONAL QUESTIONS (Report 24):   │
    │                                                                     │
    │  NEW QUESTIONS (added to 48-question set):                         │
    │  - "Do you sense a DIRECTION as you scroll? (warming/cooling,     │
    │     deepening/opening, compressing/expanding)"                     │
    │  - "At each section boundary, do >= 3 visual properties change    │
    │     simultaneously?" (multi-coherence perception check)            │
    │  - "Does the page feel like it has WEIGHT/SUBSTANCE, or does it   │
    │     feel flat/thin?" (material channel perception)                 │
    │  - "Can you identify the compositional pattern WITHOUT reading    │
    │     labels?" (fractal self-similarity check, prevents "announced" │
    │     patterns)                                                       │
    │                                                                     │
    │  STEP 1: Team lead pre-captures ALL screenshots                    │
    │  ┌──────────────────────────────────────────────────────┐          │
    │  │  Cold look at 1440px + 768px                         │          │
    │  │  Full scroll-through at both viewports               │          │
    │  │  Disable animations, wait for fonts.ready            │          │
    │  │  Save ~36-102 screenshots to ephemeral/              │          │
    │  └──────────────────────────────────────────────────────┘          │
    │                                                                     │
    │  STEP 2: 9 independent Opus auditors IN PARALLEL                   │
    │  ┌──────────────────────────────────────────────────────┐          │
    │  │  ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐               │          │
    │  │  │PA1 │ │PA2 │ │PA3 │ │PA4 │ │PA5 │               │          │
    │  │  └──┬─┘ └──┬─┘ └──┬─┘ └──┬─┘ └──┬─┘               │          │
    │  │  ┌────┐ ┌────┐ ┌────┐ ┌────┐                       │          │
    │  │  │PA6 │ │PA7 │ │PA8 │ │PA9 │                       │          │
    │  │  └──┬─┘ └──┬─┘ └──┬─┘ └──┬─┘                       │          │
    │  │  Each: screenshots only, zero build context          │          │
    │  │  ★ Assigned questions include new compositional Qs  │          │
    │  └──────────────────────────────────────────────────────┘          │
    │                                                                     │
    │  STEP 3: PA Weaver synthesizes → PA-05 score + top-3 issues       │
    │                                                                     │
    │  COMPOSITIONAL INTELLIGENCE AT THIS STAGE:                         │
    │  - SC-13 catches multi-coherence violations programmatically       │
    │  - SC-14 catches whitespace voids (the flagship's dominant fail)   │
    │  - SC-15 catches sub-perceptual CSS waste                          │
    │  - PA compositional questions catch SEMANTIC coherence that        │
    │    code cannot (direction, weight, fractal self-similarity)        │
    │  - Together: programmatic gates catch the 80% case, PA catches     │
    │    the 20% that requires perceptual judgment                       │
    │                                                                     │
    └─────────────────────────────────────────────────────────────────────┘
                                            │
                                            │  PA-05 score + top-3 issues
                                            │  + gate-generated fix recipes
                                            ▼

═══════════════════════════════════════════════════════════════════════════════════════════════════
  WAVE 3: FIX INTEGRATION  (max 3 cycles, ~30-60 min) [ENHANCED]
═══════════════════════════════════════════════════════════════════════════════════════════════════

                              ┌──────────────────────┐
                              │   DECISION MATRIX    │
                              └──────────┬───────────┘
                                         │
                         ┌───────────────┼───────────────┐
                         │               │               │
                         ▼               ▼               ▼
              ┌──────────────┐  ┌──────────────┐  ┌──────────────┐
              │ ALL PASS +   │  │ GATES PASS + │  │ ANY FAIL     │
              │ PA-05 >= 3/4 │  │ PA-05 < 3/4  │  │ AFTER 3      │
              │              │  │              │  │ CYCLES       │
              │   ╔═══════╗  │  │  ┌────────┐  │  │  ┌────────┐  │
              │   ║ SHIP  ║  │  │  │ FIX    │  │  │  │ESCALATE│  │
              │   ║       ║  │  │  │ CYCLE  │  │  │  │TO USER │  │
              │   ╚═══════╝  │  │  └───┬────┘  │  │  └────────┘  │
              └──────────────┘  │      │       │  └──────────────┘
                                │      ▼       │
                                │  ┌────────┐  │
                                │  │Builder │  │
                                │  │receives│  │
                                │  │★ GATE  │  │
                                │  │  FIX   │  │
                                │  │RECIPES │  │
                                │  │+ PA    │  │
                                │  │top-3   │  │
                                │  └───┬────┘  │
                                │      │       │
                                │      ▼       │
                                │  ┌────────┐  │
                                │  │Quick   │  │
                                │  │2-PA    │  │
                                │  │re-check│  │
                                │  └───┬────┘  │
                                │      │       │
                                │  Still < 3/4?│
                                │  Cycle <= 3? │
                                │      │       │
                                │   ┌──┴──┐    │
                                │   │LOOP │    │
                                │   └─────┘    │
                                └──────────────┘

    ┌─────────────────────────────────────────────────────────────────────────┐
    │  WHAT CHANGED IN WAVE 3 (from original PV2):                          │
    │                                                                        │
    │  1. GATE-GENERATED FIX RECIPES (NEW)                                  │
    │     When SC-09 fails with delta=3 between zones, the gate runner      │
    │     outputs: "Darken zone 2 to at least #EFE9E0 (+15 delta)."       │
    │     When SC-13 fails with only 2 channels shifting at S2→S3, the     │
    │     gate runner outputs: "Add border-left or font-weight change       │
    │     at S2→S3 boundary to reach >= 3 channel shifts."                 │
    │     The builder receives ACTIONABLE fix instructions, not just         │
    │     "FAIL" status.                                                     │
    │                                                                        │
    │  2. PA COMPOSITIONAL FIX GUIDANCE (NEW)                               │
    │     PA weaver's top-3 issues now include COMPOSITIONAL fixes:         │
    │     - "Multi-coherence insufficient at S3→S4: add typographic shift" │
    │     - "Spatial confidence low in Zone 2: redistribute content"        │
    │     - "Material channel absent: add border-weight modulation"         │
    │     These are CHANNEL-SPECIFIC, not generic ("improve richness").     │
    │                                                                        │
    │  3. TRANSITION TABLE as FIX REFERENCE                                 │
    │     The builder re-reads the transition table during fix cycles.      │
    │     The table serves as the TARGET the builder aims for.              │
    │     Plan vs Actual comparison from Phase 8 shows exactly WHERE        │
    │     the build deviated from plan.                                      │
    │                                                                        │
    │  COMPOSITIONAL INTELLIGENCE AT THIS STAGE:                             │
    │  - Gate-generated fix recipes (programmatic, specific)                │
    │  - PA channel-specific fix guidance (perceptual, compositional)       │
    │  - Transition table as target reference (planned vs actual)           │
    │  - These three together give the builder TELESCOPE (what's wrong),   │
    │    MICROSCOPE (specific CSS to change), and COMPASS (transition       │
    │    table showing where to aim)                                        │
    │                                                                        │
    │  TIME: ~30-60 minutes per fix cycle (autonomous)                       │
    └─────────────────────────────────────────────────────────────────────────┘
                                            │
                                            │  SHIP or ESCALATE
                                            ▼

═══════════════════════════════════════════════════════════════════════════════════════════════════
  OUTPUT
═══════════════════════════════════════════════════════════════════════════════════════════════════

    ┌─────────────────────────────────────────────────────────────────────┐
    │                                                                     │
    │  Four files at deterministic paths (was 3 — 1 NEW):               │
    │                                                                     │
    │  path/to/output.html                                                │
    │  ├── The designed page                                              │
    │  ├── 700-1500 lines CSS                                             │
    │  ├── 500-1000 lines HTML                                            │
    │  ├── Full WCAG 2.1 AA accessibility                                │
    │  ├── Responsive (768px + 1024px breakpoints)                       │
    │  ├── Print stylesheet                                               │
    │  └── Expected PA-05: >= 3/4 (COMPOSED or DESIGNED)                 │
    │                                                                     │
    │  path/to/_pa-report.md                                              │
    │  ├── All 48+ PA questions answered (including new compositional)   │
    │  ├── PA-05 score with rationale                                     │
    │  ├── Convergent findings (6+ auditors agree)                       │
    │  ├── Top issues (resolved or unresolved)                           │
    │  └── Fix cycle history                                              │
    │                                                                     │
    │  path/to/_build-log.md                                              │
    │  ├── TC output (zone count, mechanisms, metaphor)                  │
    │  ├── Gate results (15 PASS/FAIL with values — was 12)             │
    │  ├── Cascade value table (computed CSS at every boundary)          │
    │  ├── ★ Transition table (planned vs actual comparison)            │
    │  ├── Build decisions (why this layout, why these colors)           │
    │  └── Timing (per-wave duration)                                    │
    │                                                                     │
    │  ★ path/to/_transition-table.md (NEW OUTPUT)                       │
    │  ├── TC planner's per-boundary channel shift plan                  │
    │  ├── Builder's actual computed values at each boundary             │
    │  ├── Delta between planned and actual                              │
    │  └── Multi-coherence verification (>= 3 channels per boundary)    │
    │                                                                     │
    └─────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════════════════════════
  COMPLETE FLOW — BIRD'S EYE VIEW (Updated)
═══════════════════════════════════════════════════════════════════════════════════════════════════

  /build-page content.md
         │
         ▼
  ┌──────────────────┐   WAVE 0: Enriched TC Planner (Opus)
  │ Tension          │   30-60 min
  │ Composition      │   Phases 0-3.5 + ★ Phase 4T (Transition Table)
  │ (content → plan  │   Output: structured _build-plan.md
  │  + transition    │           + ★ _transition-table.md
  │  table)          │   Compositional intel: multi-coherence PLANNED,
  └────────┬─────────┘   semantic direction DECLARED, section-level deployment
           │
           ▼
  ┌──────────────────┐   WAVE 0.5: Fresh-Eyes Metaphor Check
  │ Metaphor         │   5-10 min
  │ Validation       │   Binary: STRUCTURAL or ANNOUNCED
  │ (prevents waste) │   Compositional intel: same as original PV2
  └────────┬─────────┘
           │
           ▼
  ┌──────────────────┐   WAVE 0.9: Handoff Gate (EXPANDED)
  │ 8 Binary Checks  │   ~1-2 min (was 5 checks)
  │ (YAML-parseable) │   ★ NEW: transition table check, nav-scale check,
  │                  │   semantic direction check
  │                  │   Compositional intel: multi-coherence VALIDATED,
  └────────┬─────────┘   nav-scale CONFIRMED, direction PROPAGATED
           │
           ▼
  ┌──────────────────┐   WAVE 1: Opus Builder
  │ 9-Phase Recipe   │   90-150 min
  │ Execution        │   ★ Telescope+microscope format
  │ (plan → HTML)    │   ★ Transition table as build-time reference
  │                  │   ★ Template merging (recipe+plan = 1 doc)
  │ ─ OR ─           │   ★ EXPERIMENT: Recipe (Path A) vs
  │ Principles Brief │     Principles Brief (Path B)
  │ (~100 lines)     │   Compositional intel: per-boundary channel shifts
  └────────┬─────────┘   INLINE with build steps, section-level variation
           │
           ▼
  ┌──────────────────┐   WAVE 2: Dual Verification (EXPANDED)
  │ 15 Programmatic  │   30-45 min
  │ Gates (was 12)   │   ★ NEW: SC-13 (multi-coherence),
  │ +                │     SC-14 (mass distribution),
  │ 9 PA Auditors    │     SC-15 (sub-perceptual prevention)
  │ (★ with compo-  │   ★ PA compositional questions
  │  sitional Qs)    │   ★ Gate-generated fix recipes
  └────────┬─────────┘   Compositional intel: programmatic catches 80%,
           │             PA catches semantic 20%
           ▼
  ┌──────────────────┐   WAVE 3: Fix Integration (ENHANCED)
  │ Top-3 Fix Loop   │   30-60 min (max 3 cycles)
  │ (iterative)      │   ★ Gate-generated fix recipes
  │ ★ with fix      │   ★ PA channel-specific guidance
  │   recipes from   │   ★ Transition table as target reference
  │   gates + PA     │   Until PA-05 >= 3/4 or escalate
  └────────┬─────────┘
           │
           ▼
  ┌──────────────────┐
  │   OUTPUT         │   output.html + _pa-report.md + _build-log.md
  │   (4 files)      │   + ★ _transition-table.md (NEW)
  │   ★ was 3 files │   User comes back to finished work
  └──────────────────┘


═══════════════════════════════════════════════════════════════════════════════════════════════════
  COMPOSITIONAL INTELLIGENCE MAP — Where It Lives at Each Stage
═══════════════════════════════════════════════════════════════════════════════════════════════════

  This section addresses the investigation's central question:
  "Where does compositional intelligence get lost?"

  ┌────────────┬────────────────────────────────────────────────────────────┐
  │   STAGE    │  COMPOSITIONAL INTELLIGENCE (what is present/absent)      │
  ├────────────┼────────────────────────────────────────────────────────────┤
  │            │  PRESENT:                                                  │
  │ WAVE 0    │  - Content-to-form mapping (TC Phases 0-3)                │
  │ TC Planner │  - Multi-axis questioning (9+ axes, 718 invocational ln) │
  │            │  - Metaphor derivation (structural, not announced)         │
  │            │  ★ Per-boundary channel shifts (transition table)         │
  │            │  ★ Semantic direction declaration                         │
  │            │  ★ Section-level mechanism deployment                     │
  │            │  ★ Navigation-scale specification (header/footer/TOC)    │
  │            │                                                            │
  │            │  ABSENT (by design):                                       │
  │            │  - Exact CSS values (recipe provides these)               │
  │            │  - Element-level richness (builder's creative domain)     │
  │            │  - Behavioral channel planning (Report 10: still missing) │
  │            │  - Material channel atmosphere (Report 11: still phantom) │
  ├────────────┼────────────────────────────────────────────────────────────┤
  │ WAVE 0.5  │  PRESENT: Metaphor quality check (structural/announced)   │
  │ Metaphor   │  ABSENT: Channel-specific metaphor implications           │
  │ Validation │  (by design — fresh-eyes principle)                       │
  ├────────────┼────────────────────────────────────────────────────────────┤
  │            │  PRESENT:                                                  │
  │ WAVE 0.9  │  ★ Multi-coherence validation (transition table check)   │
  │ Handoff    │  ★ Navigation-scale confirmation                         │
  │ Gate       │  ★ Semantic direction propagation                        │
  │            │  - Zone/mechanism/transition EXISTENCE checks              │
  │            │                                                            │
  │            │  ABSENT:                                                   │
  │            │  - QUALITY of mechanism selection (only checks existence) │
  │            │  - Fractal self-similarity verification (Reports 14, 27) │
  │            │  - Material/behavioral channel coherence                   │
  ├────────────┼────────────────────────────────────────────────────────────┤
  │            │  PRESENT:                                                  │
  │ WAVE 1    │  ★ Transition table as per-phase build reference          │
  │ Builder    │  ★ Telescope+microscope recipe format                    │
  │            │  ★ Template merging (compositional intel INLINE)         │
  │            │  ★ Character taxonomy (3 types + anti-type)              │
  │            │  ★ Section-level typographic modulation                  │
  │            │  - Per-phase perception self-checks                       │
  │            │  - 5 planner approval checkpoints                         │
  │            │                                                            │
  │            │  ABSENT:                                                   │
  │            │  - Anti-scale model (evaluative, not operational)          │
  │            │    (Report 13: appears in 0 builder-visible artifacts)    │
  │            │  - Component-level metaphor expression (Report 04:        │
  │            │    components parameterized for COLOR not STRUCTURE)       │
  │            │  - Behavioral channel planning (Report 10: unplanned)    │
  ├────────────┼────────────────────────────────────────────────────────────┤
  │            │  PRESENT:                                                  │
  │ WAVE 2    │  ★ SC-13: multi-coherence measurement                    │
  │ Verification│ ★ SC-14: whitespace void detection                     │
  │            │  ★ SC-15: sub-perceptual CSS prevention                  │
  │            │  ★ PA compositional questions                            │
  │            │  ★ Gate-generated fix recipes                            │
  │            │  - SC-01 through SC-12 (original gates)                  │
  │            │  - 9 fresh-eyes PA auditors                               │
  │            │                                                            │
  │            │  ABSENT:                                                   │
  │            │  - Semantic direction verification (code can count         │
  │            │    channel shifts but not assess if they "deepen")        │
  │            │  - Fractal self-similarity (code cannot measure)          │
  │            │  - Material atmosphere (perceptual, not programmatic)     │
  ├────────────┼────────────────────────────────────────────────────────────┤
  │            │  PRESENT:                                                  │
  │ WAVE 3    │  ★ Gate-generated fix recipes (specific CSS to change)   │
  │ Fix Loop   │  ★ PA channel-specific fix guidance                      │
  │            │  ★ Transition table as fix TARGET                        │
  │            │  - Top-3 convergent findings from PA weaver               │
  │            │                                                            │
  │            │  ABSENT:                                                   │
  │            │  - Compositional re-derivation (builder applies fixes,    │
  │            │    doesn't re-derive compositional rationale)             │
  │            │  - This is acceptable: fixes are targeted, not redesigns  │
  └────────────┴────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════════════════════════
  NEW ARTIFACTS — What This Investigation Introduced
═══════════════════════════════════════════════════════════════════════════════════════════════════

  ┌─────────────────────────────────────────────────────────────────────────┐
  │  1. TRANSITION TABLE (_transition-table.md)                            │
  │     Generated by: TC planner (Wave 0, Phase 4T)                       │
  │     Consumed by: Handoff gate (Wave 0.9), Builder (Wave 1),           │
  │                  Gate runner (Wave 2 SC-13), Fix loop (Wave 3)        │
  │     Format: 6-column table x N boundaries                              │
  │     Columns: bg_delta, font_size_shift, font_weight_shift,            │
  │              letter_spacing_shift, border_left_change, margin_change   │
  │     Constraint: Every row has >= 3 columns showing change             │
  │     Annotation: Each column has semantic direction label               │
  │     Source reports: 02, 03, 06, 07, 08, 09, 12, 17, 18              │
  │                                                                        │
  │  2. STRUCTURED BUILD PLAN (YAML-parseable _build-plan.md)             │
  │     Generated by: TC planner (Wave 0)                                  │
  │     Consumed by: Handoff gate (Wave 0.9), Builder (Wave 1)            │
  │     Format: YAML with zones, sections, mechanisms, transitions         │
  │     Source reports: 15 (YAML gates), 19 (programmatic enforcement)    │
  │                                                                        │
  │  3. ENRICHED TC SKILL (~1,336 lines, was 1,878)                       │
  │     What changed: 542 lines tier routing REMOVED                       │
  │     What replaced it: Operational CSS patterns, channel shift          │
  │     templates, section-level deployment guidance                       │
  │     Source reports: 23 (TC audit), 41 (ALWAYS FLAGSHIP simplification)│
  │                                                                        │
  │  4. perception-thresholds.md (~80 lines, UNCHANGED but now            │
  │     enforced by SC-13/14/15 in addition to SC-09/10/11)              │
  │                                                                        │
  │  5. GATE-GENERATED FIX RECIPES (new Wave 2/3 artifact)               │
  │     Generated by: gate-runner.js when gates FAIL                       │
  │     Consumed by: Builder during fix cycles (Wave 3)                   │
  │     Format: JSON { gate, status, measured, fix }                      │
  │     Source reports: 15, 19, 20 (operational invocation patterns)      │
  └─────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════════════════════════
  NEW/MODIFIED GATES — SC-13, SC-14, SC-15
═══════════════════════════════════════════════════════════════════════════════════════════════════

  ┌─────────────────────────────────────────────────────────────────────────┐
  │  SC-13: MULTI-COHERENCE GATE (NEW)                                     │
  │  ─────────────────────────────────────────────────────────────────────  │
  │  What: At each section boundary, >= 3 of 6 CSS channels must shift.   │
  │  Why: Report 12 found multi-coherence was the DEFINING property of    │
  │       pages that feel DESIGNED vs STYLED. The flagship had channel     │
  │       shifts but they were INDEPENDENT, not COHERENT.                  │
  │  How: Playwright getComputedStyle on last element of section N and    │
  │       first element of section N+1. Count channels that differ.       │
  │  Channels: bg-color, font-size, font-weight, letter-spacing,         │
  │            border-left, margin-bottom                                  │
  │  Threshold: >= 3 channels shift at EACH boundary                      │
  │  Limitation: Checks EXISTENCE of shifts, not SEMANTIC DIRECTION.      │
  │              A page where bg DARKENS and spacing WIDENS would pass     │
  │              even if those are contradictory directions. Semantic      │
  │              direction remains a PA judgment.                           │
  │  Source: Reports 02, 03, 06, 07, 08, 09, 12                          │
  │                                                                        │
  │  SC-14: MASS DISTRIBUTION GATE (NEW)                                   │
  │  ─────────────────────────────────────────────────────────────────────  │
  │  What: No viewport-height section may have < 30% content coverage.    │
  │  Why: The flagship's catastrophic failure was 70-80% blank whitespace │
  │       (9/9 PA auditors flagged it). SC-10 catches per-property gaps   │
  │       (<=108px) but NOT accumulated voids where content is sparse.    │
  │  How: Playwright measures bounding boxes of all content elements      │
  │       within each viewport-height segment. Computes coverage ratio.   │
  │  Threshold: >= 30% content coverage in every viewport-height segment  │
  │  Source: Mode 4 PA findings, semantic rules Gap 6                      │
  │                                                                        │
  │  SC-15: SUB-PERCEPTUAL PREVENTION GATE (NEW)                          │
  │  ─────────────────────────────────────────────────────────────────────  │
  │  What: Detects invisible CSS that wastes budget.                       │
  │  Why: The flagship spent 22% of CSS (227 lines) on letter-spacing     │
  │       0.001-0.01em = 0.016-0.16px, 5x below perception floor.       │
  │  How: Playwright scans all computed letter-spacing values. Flags      │
  │       any > 0 and < 0.03em. Also flags line-height micro-shifts.     │
  │  Threshold: No letter-spacing in (0, 0.03em) range. No line-height   │
  │             differences < 0.1 between adjacent elements.              │
  │  Source: Reports 05, 07, flagship deallocation manifest               │
  └─────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════════════════════════
  EXPERIMENT BRANCH — Recipe vs Principles Brief
═══════════════════════════════════════════════════════════════════════════════════════════════════

  The investigation surfaced a fundamental unresolved question:
  Does the recipe FORMAT produce better results than minimal constraints + Opus freedom?

  ┌─────────────────────────────────────────────────────────────────────────┐
  │  EVIDENCE FOR RECIPE (Path A — current default):                       │
  │  - Middle experiment: 100-line recipe → PA-05 4/4 DESIGNED            │
  │  - Remediation: 1,025-line spec → PA-05 +1.0 (1.5 → 2.5)           │
  │  - Recipe = success, Checklist = failure (confirmed finding)           │
  │                                                                        │
  │  EVIDENCE AGAINST RECIPE (Path B — experimental):                      │
  │  - CD-006: ZERO recipe → 39/40 (highest score ever)                  │
  │  - Anti-scale model: Richness = semantic density x restraint x        │
  │    spatial confidence. Recipes may CAP semantic density by            │
  │    prescribing values that satisfy thresholds but don't maximize      │
  │    meaning. (Report 13)                                                │
  │  - Report 29 (First Principles): DESIGNED correlates with single     │
  │    builder, Opus model, clear constraints, enough freedom.            │
  │    NOT with more rules.                                                │
  │  - Report 30 (Adversarial): Recipes are "a 1,605-line answer to a   │
  │    question nobody tested with 30 lines."                              │
  │                                                                        │
  │  3 EXPERIMENTS TO RESOLVE (from Report 70):                            │
  │                                                                        │
  │  Experiment 1: THRESHOLDS-ONLY                                         │
  │    Add ONLY perception-thresholds.md to original prompt, re-run.      │
  │    If PA-05 >= 3/4 → thresholds alone fix the flagship failure.      │
  │    Cost: ~4-6 hours. Resolves 3-variable confound.                    │
  │                                                                        │
  │  Experiment 2: PRINCIPLES BRIEF                                        │
  │    Give Opus builder: soul + thresholds + transition table + 100-     │
  │    line brief. NO recipe. Compare PA-05 to recipe path.               │
  │    Cost: ~4-6 hours. Tests CD-006's approach automated.               │
  │                                                                        │
  │  Experiment 3: RECIPE WITH TRANSITION TABLE                            │
  │    Give Opus builder: full 650-line recipe + transition table.        │
  │    The NEW default path. Measure improvement over original PV2.       │
  │    Cost: ~4-6 hours. Validates the investigation's recommendations.   │
  │                                                                        │
  │  Decision: Run all 3, compare PA-05 scores. Winner becomes default.  │
  └─────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════════════════════════
  PERMANENT FILE ARCHITECTURE — WHAT MUST BE WRITTEN (Updated)
═══════════════════════════════════════════════════════════════════════════════════════════════════

  4 NEW FILES (~1,535 lines total — was ~1,235):

  ~/.claude/skills/build-page/SKILL.md .................. ~205 lines
  │  The orchestrator. Fire-and-forget entry point.
  │  ★ Now handles structured YAML build plan parsing.
  │  ★ Handoff gate expanded from 5 to 8 checks.
  │
  design-system/compositional-core/operational-recipe.md . ~650 lines
  │  THE recipe. ★ Now in telescope+microscope format.
  │  ★ Template slots for build-plan-specific values.
  │  ★ Transition table references at each phase.
  │  ★ Character taxonomy (3 types + anti-type).
  │
  design-system/compositional-core/perception-thresholds.md ~80 lines
  │  Canonical threshold table + 6-channel definitions.
  │  UNCHANGED from original PV2 spec.
  │
  design-system/compositional-core/gate-runner.js ........ ~600 lines
     ★ Expanded from ~300 lines. 15 gates (was 12).
     SC-01 through SC-15. All BLOCKING under ALWAYS FLAGSHIP.
     ★ NEW: SC-13 (multi-coherence), SC-14 (mass distribution),
       SC-15 (sub-perceptual prevention).
     ★ NEW: Fix recipe generation on FAIL.

  8 EDITS TO EXISTING FILES (~370 lines — unchanged scope):

  TC SKILL.md ......... ★ ENRICHED: -542 lines tier routing,
                        +operational compositional content,
                        +Phase 4T (transition table generation)
  PA SKILL.md ......... +compositional questions, perception thresholds
  CLAUDE.md ........... Builder CSS recipes, agent communication
  semantic-rules.md ... S-09 stacking at 108px
  tokens.css .......... S-09 stacking at 108px

  TOTAL: ~1,905 permanent lines to write (was ~1,605).
  Delta: +300 lines (expanded gate runner + transition table support).


═══════════════════════════════════════════════════════════════════════════════════════════════════
  COMPARISON: Original PV2 → Updated PV2
═══════════════════════════════════════════════════════════════════════════════════════════════════

  ┌────────────────────┬───────────────────────┬─────────────────────────────┐
  │    DIMENSION       │    ORIGINAL PV2       │    UPDATED PV2              │
  ├────────────────────┼───────────────────────┼─────────────────────────────┤
  │ TC skill size      │ 1,878 lines           │ ~1,336 lines (-542 tier     │
  │                    │                       │ routing, +operational)       │
  ├────────────────────┼───────────────────────┼─────────────────────────────┤
  │ Key new artifact   │ (none)                │ Transition table (per-       │
  │                    │                       │ boundary channel shifts)     │
  ├────────────────────┼───────────────────────┼─────────────────────────────┤
  │ Build plan format  │ Prose markdown        │ YAML-parseable (structured) │
  ├────────────────────┼───────────────────────┼─────────────────────────────┤
  │ Handoff checks     │ 5 text-based          │ 8 programmatic (YAML parse) │
  ├────────────────────┼───────────────────────┼─────────────────────────────┤
  │ Programmatic gates │ 12 (SC-01 to SC-12)   │ 15 (+ SC-13 multi-coher,   │
  │                    │                       │ SC-14 mass dist, SC-15 sub- │
  │                    │                       │ perceptual)                  │
  ├────────────────────┼───────────────────────┼─────────────────────────────┤
  │ Recipe format      │ 9-phase sequential    │ 9-phase telescope+microscope│
  │                    │                       │ with template merging        │
  ├────────────────────┼───────────────────────┼─────────────────────────────┤
  │ Builder input      │ Recipe + prose plan   │ Recipe merged with plan +   │
  │                    │ (mental merge needed) │ transition table (pre-merged)│
  ├────────────────────┼───────────────────────┼─────────────────────────────┤
  │ Multi-coherence    │ Checked POST-BUILD    │ PLANNED (Phase 4T),         │
  │                    │ (Phase 8 only)        │ VALIDATED (Wave 0.9),       │
  │                    │                       │ VERIFIED (SC-13)            │
  ├────────────────────┼───────────────────────┼─────────────────────────────┤
  │ Fix cycle input    │ PA top-3 issues       │ PA top-3 + gate fix recipes │
  │                    │                       │ + transition table target    │
  ├────────────────────┼───────────────────────┼─────────────────────────────┤
  │ PA questions       │ 48 standard           │ 48+ (new compositional Qs:  │
  │                    │                       │ direction, multi-coherence,  │
  │                    │                       │ material, fractal)           │
  ├────────────────────┼───────────────────────┼─────────────────────────────┤
  │ Output files       │ 3                     │ 4 (+ transition table)      │
  ├────────────────────┼───────────────────────┼─────────────────────────────┤
  │ Experiment branch  │ (none — recipe only)  │ Recipe (A) vs Principles    │
  │                    │                       │ Brief (B), pending tests    │
  ├────────────────────┼───────────────────────┼─────────────────────────────┤
  │ Gate runner size   │ ~300 lines            │ ~600 lines (+fix recipes,   │
  │                    │                       │ +SC-13/14/15)               │
  ├────────────────────┼───────────────────────┼─────────────────────────────┤
  │ Total permanent    │ ~1,605 lines          │ ~1,905 lines (+300)         │
  │ lines              │                       │                              │
  └────────────────────┴───────────────────────┴─────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════════════════════════
  KNOWN GAPS — What the Investigation Found But Did NOT Fully Solve
═══════════════════════════════════════════════════════════════════════════════════════════════════

  GAP 1: Anti-Scale Model Not Operational (Report 13)
  ├── "Richness = semantic density x restraint x spatial confidence"
  ├── Appears in ZERO builder-visible artifacts
  ├── The model is EVALUATIVE but not OPERATIONAL
  └── Mitigation: PA questions catch spatial confidence; restraint
      comes from soul constraints; semantic density is the Opus builder's
      creative domain. May be fundamentally un-encodable.

  GAP 2: Behavioral Channel Unplanned (Report 10)
  ├── TC treats behavioral as spatial rhythm, not interactive behavior
  ├── No hover speed, transition character, or animation philosophy planned
  ├── Handoff gate has ZERO behavioral checks
  └── Mitigation: Recipe Phase 6 covers Type A interactive character CSS.
      Behavioral PLANNING (how fast should hovers feel?) remains a builder
      creative decision. May be acceptable as-is.

  GAP 3: Material Channel Phantom (Report 11)
  ├── "Material" named in 6-channel taxonomy but ZERO operational spec
  ├── No "material palette" or "texture arc" in any artifact
  └── Mitigation: Material emerges from chromatic + typographic + structural
      channels working together. The transition table's multi-coherence
      requirement may produce material atmosphere as an EMERGENT property.

  GAP 4: Component-Level Metaphor Expression (Report 04)
  ├── Components parameterized for COLOR but not STRUCTURE
  ├── A callout in "geological strata" looks identical to one in "river delta"
  └── Mitigation: Phase 6 element-level richness + Opus creative judgment.
      May require component CSS custom properties beyond color.

  GAP 5: Fractal Self-Similarity Unverifiable (Report 14)
  ├── TC produces scale coverage table but builder NEVER SEES it
  ├── No programmatic gate can measure "same pattern at every zoom"
  ├── PA can evaluate it perceptually but it's judgment-dependent
  └── Mitigation: New PA question ("Can you identify the pattern WITHOUT
      labels?") catches announced-not-structural fractals. Programmatic
      verification may be permanently impossible.

  GAP 6: Recipe Ceiling at 3/4 (Reports 27, 29, 30)
  ├── Recipe reliably produces COMPOSED (3/4)
  ├── DESIGNED (4/4) may require compositional fluency beyond recipes
  ├── CD-006 achieved 39/40 without recipes
  └── Mitigation: Experiment Branch (Path B: Principles Brief) tests
      whether minimal constraints + Opus freedom outperforms recipes.
      3 experiments designed to resolve.


═══════════════════════════════════════════════════════════════════════════════════════════════════
  NEXT STEP — UNCHANGED FROM ORIGINAL PV2
═══════════════════════════════════════════════════════════════════════════════════════════════════

  ╔═══════════════════════════════════════════════════════════════════════╗
  ║                                                                       ║
  ║          C O D I F Y ,   E X P E R I M E N T ,   B U I L D          ║
  ║                                                                       ║
  ║   1. Write 4 files + 8 edits (~1,905 lines)     [CODIFY]            ║
  ║   2. Run 3 experiments (thresholds-only,          [EXPERIMENT]       ║
  ║      principles brief, recipe+transition table)                      ║
  ║   3. Winner becomes default build path            [BUILD]            ║
  ║   4. Run /build-page on RESEARCH-SYNTHESIS        [VALIDATE]         ║
  ║   5. Measure PA-05, validate end-to-end           [SHIP]             ║
  ║                                                                       ║
  ║   The investigation added EXPERIMENT before BUILD.                   ║
  ║   30 agents say: don't assume the recipe wins.                       ║
  ║   Test it. Then codify the winner.                                   ║
  ║                                                                       ║
  ╚═══════════════════════════════════════════════════════════════════════╝
```
