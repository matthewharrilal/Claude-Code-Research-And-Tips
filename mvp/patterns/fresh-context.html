<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fresh Context Principle | Claude Code Patterns</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <nav class="sidebar" id="sidebar"></nav>

  <main class="content">
    <!-- 1. Header + Metadata -->
    <header class="pattern-header">
      <h1>Fresh Context Principle</h1>
      <div class="pattern-meta">
        <span class="meta-item">Type: Principle</span>
        <span class="meta-item">Problem: Context degradation in long sessions</span>
        <span class="meta-item">Complexity: Level 1-2</span>
        <span class="meta-item">Source: Boris Cherny / Community consensus</span>
      </div>
    </header>

    <!-- 2. Why This Matters -->
    <section class="why-matters">
      <h2>Why This Matters</h2>
      <blockquote>"Context rot: LLMs get stupider with more tokens" &mdash; @mattpocockuk</blockquote>
      <p><strong>Context accumulation is entropy.</strong> Every operation adds tokens. Every token slightly degrades future operations. This compounds until quality collapse.</p>
      <p><strong>Fresh context is regeneration.</strong> A new instance starts at 0% context usage, at peak capability. No accumulated noise, no degraded performance, no context rot.</p>
      <table class="quality-table">
        <tr><th>Context Level</th><th>Quality Impact</th></tr>
        <tr><td>0-50%</td><td>Full capability</td></tr>
        <tr><td>50-70%</td><td>Slight degradation possible</td></tr>
        <tr><td>70-85%</td><td>Noticeable quality loss</td></tr>
        <tr><td>85%+</td><td>Critical: instructions forgotten, hallucinations</td></tr>
      </table>
    </section>

    <!-- 3. Architecture -->
    <section id="architecture">
      <h2>Architecture</h2>
      <pre class="ascii-diagram">
Iteration 1 (fresh instance)
  Read state from files
  Pick task, implement, verify
  Commit if passing
  Update external state
  Exit
        (no memory carried)
Iteration 2 (fresh instance)
  Read updated state
  Repeat...</pre>
      <p>Each iteration spawns a NEW Claude instance with NO memory of previous work. Continuity comes from external state: git history, prd.json, progress.txt.</p>
    </section>

    <!-- 4. How It Works -->
    <section id="how-it-works">
      <h2>How It Works</h2>
      <ol class="how-steps">
        <li><strong>Read state from files</strong> &mdash; PRD, progress log, git history</li>
        <li><strong>Pick highest priority incomplete task</strong> &mdash; One task per iteration</li>
        <li><strong>Implement and verify</strong> &mdash; Run tests, typecheck</li>
        <li><strong>Commit if passing</strong> &mdash; Quality gate enforced</li>
        <li><strong>Update external state</strong> &mdash; Append to progress.txt, update prd.json</li>
        <li><strong>Exit</strong> &mdash; Session ends, context dies, but state persists</li>
      </ol>
      <h3>Signs You Need Fresh Context</h3>
      <ul>
        <li><strong>Repetition</strong> &mdash; Claude echoes earlier statements</li>
        <li><strong>Amnesia</strong> &mdash; Forgets work done 10 minutes ago</li>
        <li><strong>Instruction drift</strong> &mdash; CLAUDE.md directives ignored</li>
        <li><strong>Contradictions</strong> &mdash; Says one thing, then the opposite</li>
        <li><strong>Hallucinations</strong> &mdash; References files that don't exist</li>
      </ul>
    </section>

    <!-- 5. Key Decisions -->
    <section id="key-decisions">
      <h2>Key Decisions</h2>
      <table class="decision-table">
        <tr><th>Decision</th><th>Fresh Context</th><th>Extended Session</th></tr>
        <tr>
          <td>When to use?</td>
          <td>Multi-hour work, overnight runs, quality-critical</td>
          <td>Single small task (&lt;30 min), exploratory work</td>
        </tr>
        <tr>
          <td>Context at 70%?</td>
          <td>Exit and restart</td>
          <td>Try /compact, monitor closely</td>
        </tr>
        <tr>
          <td>State storage?</td>
          <td>Files (prd.json, progress.txt, git)</td>
          <td>In-context (risky)</td>
        </tr>
        <tr>
          <td>Quality over time?</td>
          <td>Constant (each iteration fresh)</td>
          <td>Degrades with token accumulation</td>
        </tr>
      </table>
    </section>

    <!-- 6. Entry Points -->
    <section id="entry-points">
      <h2>Entry Points</h2>
      <ol class="entry-files">
        <li><strong>CLAUDE.md</strong> &mdash; Project context, under 500 tokens</li>
        <li><strong>plans/prd.json</strong> &mdash; Task state with <code>passes: true/false</code></li>
        <li><strong>plans/progress.txt</strong> &mdash; Append-only learning log</li>
        <li><strong>Git history</strong> &mdash; <code>git log --oneline -10</code> for recent context</li>
      </ol>
    </section>

    <!-- 7. Copy-Paste Templates -->
    <section id="copy-paste">
      <h2>Copy-Paste Templates</h2>
      <h3>Ralph Loop Script</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>#!/bin/bash
set -e
MAX_ITERATIONS=${1:-25}

for (( i=1; i<=$MAX_ITERATIONS; i++ )); do
  echo "Iteration $i / $MAX_ITERATIONS"

  claude "Review plans/prd.json and progress.txt.
    Pick ONE task with passes: false.
    Implement it. Run tests.
    If passing, mark passes: true and commit.
    Append learnings to progress.txt.
    If ALL tasks complete, output: <promise>COMPLETE</promise>" | tee output.txt

  if grep -q "<promise>COMPLETE</promise>" output.txt; then
    echo "All tasks complete!"
    break
  fi
done</code></pre>
      </div>
      <h3>Fresh Session Recovery</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># When context is degraded, start fresh:
exit
claude
"Read progress.txt and git log to understand current state"</code></pre>
      </div>
    </section>

    <!-- 8. What's Unusual -->
    <section id="whats-unusual">
      <h2>What's Unusual</h2>
      <div class="unusual-comparison">
        <div class="standard">
          <h4>Standard Approach</h4>
          <p>Keep sessions going as long as possible. Use /compact when context fills. Maximize continuity.</p>
        </div>
        <div class="this-pattern">
          <h4>Fresh Context Principle</h4>
          <p>Kill and restart deliberately. Exit after each task. State lives in files, not context. Compaction is lossy; files are not.</p>
        </div>
      </div>
      <p><strong>The insight:</strong> Fresh context with file state is lossless. Compaction summarizes and loses detail. The "inefficiency" of reading state each time is the feature that prevents rot.</p>
    </section>

    <!-- 9. See Also -->
    <section id="see-also">
      <h2>See Also</h2>
      <ul>
        <li><a href="ralph-loop.html">Ralph Loop Pattern</a> &mdash; Automated fresh context iteration</li>
        <li><a href="external-state.html">External State Principle</a> &mdash; Files over memory</li>
        <li><a href="context-rot.html">Context Rot Prevention</a> &mdash; Warning signs and recovery</li>
      </ul>
    </section>
  </main>

  <script src="../js/navigation.js"></script>
  <script src="../js/copy-code.js"></script>
  <script>
    function copyCode(btn) {
      const code = btn.nextElementSibling.textContent;
      navigator.clipboard.writeText(code);
      btn.textContent = 'Copied!';
      setTimeout(() => btn.textContent = 'Copy', 2000);
    }
  </script>
</body>
</html>
