<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ralph Wiggum Loop | Architectural Gallery</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Geist+Mono:wght@400;500&family=Space+Grotesk:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg: #0a0a0b;
      --surface: #141415;
      --surface-raised: #1c1c1e;
      --border: #2a2a2d;
      --text: #fafafa;
      --text-secondary: #a1a1a6;
      --accent: #3b82f6;
      --accent-dim: #1e3a5f;
      --code-bg: #0d1117;
    }

    html {
      font-size: 16px;
      background: var(--bg);
      color: var(--text);
    }

    body {
      font-family: 'Space Grotesk', -apple-system, sans-serif;
      line-height: 1.6;
      letter-spacing: -0.01em;
      min-height: 100vh;
    }

    /* Navigation */
    nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      background: rgba(10, 10, 11, 0.8);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      padding: 0 2rem;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .nav-brand {
      font-weight: 600;
      font-size: 0.875rem;
      color: var(--text-secondary);
      text-decoration: none;
      letter-spacing: -0.02em;
    }

    .nav-brand:hover { color: var(--text); }

    .nav-pills {
      display: flex;
      gap: 0.5rem;
    }

    .nav-pill {
      padding: 0.375rem 0.75rem;
      font-size: 0.8125rem;
      color: var(--text-secondary);
      text-decoration: none;
      border-radius: 6px;
      transition: background 0.15s, color 0.15s;
    }

    .nav-pill:hover {
      background: var(--surface);
      color: var(--text);
    }

    .nav-pill.active {
      background: var(--surface-raised);
      color: var(--text);
    }

    /* Main Layout */
    main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 7rem 2rem 4rem;
    }

    /* Hero / Header */
    .pattern-hero {
      margin-bottom: 4rem;
    }

    .pattern-type {
      display: inline-block;
      font-size: 0.75rem;
      font-weight: 500;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 1rem;
    }

    .pattern-title {
      font-size: clamp(2.5rem, 5vw, 3.5rem);
      font-weight: 600;
      letter-spacing: -0.03em;
      line-height: 1.1;
      margin-bottom: 1.5rem;
    }

    .pattern-subtitle {
      font-size: 1.25rem;
      color: var(--text-secondary);
      max-width: 600px;
      line-height: 1.5;
    }

    /* The Shape - Architecture Section */
    .architecture {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 2.5rem;
      margin-bottom: 3rem;
    }

    .architecture-label {
      font-size: 0.75rem;
      font-weight: 500;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: var(--text-secondary);
      margin-bottom: 1.5rem;
    }

    .architecture-diagram {
      font-family: 'Geist Mono', 'SF Mono', monospace;
      font-size: 0.875rem;
      line-height: 1.5;
      color: var(--text);
      white-space: pre;
      overflow-x: auto;
      padding: 1.5rem;
      background: var(--code-bg);
      border-radius: 8px;
      border: 1px solid var(--border);
    }

    .architecture-narrative {
      margin-top: 2rem;
      color: var(--text-secondary);
      font-size: 1rem;
      line-height: 1.7;
    }

    /* Content Grid */
    .content-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      margin-bottom: 3rem;
    }

    @media (max-width: 768px) {
      .content-grid { grid-template-columns: 1fr; }
    }

    .content-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
    }

    .content-card h3 {
      font-size: 0.75rem;
      font-weight: 500;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: var(--text-secondary);
      margin-bottom: 1rem;
    }

    .content-card p, .content-card li {
      color: var(--text-secondary);
      font-size: 0.9375rem;
      line-height: 1.6;
    }

    .content-card ul, .content-card ol {
      padding-left: 1.25rem;
    }

    .content-card li {
      margin-bottom: 0.5rem;
    }

    .content-card strong {
      color: var(--text);
      font-weight: 500;
    }

    /* The Core Insight - Quote */
    .insight {
      background: linear-gradient(135deg, var(--accent-dim) 0%, var(--surface) 100%);
      border: 1px solid var(--accent);
      border-radius: 12px;
      padding: 2rem 2.5rem;
      margin-bottom: 3rem;
    }

    .insight blockquote {
      font-size: 1.125rem;
      font-style: italic;
      line-height: 1.6;
      margin-bottom: 1rem;
    }

    .insight cite {
      font-size: 0.875rem;
      color: var(--text-secondary);
      font-style: normal;
    }

    /* Copy-Paste Section */
    .copy-paste {
      margin-bottom: 3rem;
    }

    .copy-paste h2 {
      font-size: 1.5rem;
      font-weight: 600;
      letter-spacing: -0.02em;
      margin-bottom: 1.5rem;
    }

    .code-block {
      position: relative;
      margin-bottom: 1.5rem;
    }

    .code-label {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--surface-raised);
      border: 1px solid var(--border);
      border-bottom: none;
      border-radius: 8px 8px 0 0;
      padding: 0.75rem 1rem;
    }

    .code-label span {
      font-family: 'Geist Mono', monospace;
      font-size: 0.8125rem;
      color: var(--text-secondary);
    }

    .copy-btn {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.75rem;
      font-weight: 500;
      padding: 0.375rem 0.75rem;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 4px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.15s;
    }

    .copy-btn:hover {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
    }

    .code-content {
      font-family: 'Geist Mono', 'SF Mono', monospace;
      font-size: 0.875rem;
      line-height: 1.6;
      background: var(--code-bg);
      border: 1px solid var(--border);
      border-radius: 0 0 8px 8px;
      padding: 1.25rem;
      overflow-x: auto;
      color: #e6edf3;
    }

    /* How It Works */
    .how-it-works {
      margin-bottom: 3rem;
    }

    .how-it-works h2 {
      font-size: 1.5rem;
      font-weight: 600;
      letter-spacing: -0.02em;
      margin-bottom: 1.5rem;
    }

    .steps {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .step {
      display: flex;
      gap: 1rem;
      padding: 1.25rem;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
    }

    .step-number {
      flex-shrink: 0;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--accent-dim);
      border: 1px solid var(--accent);
      border-radius: 6px;
      font-size: 0.8125rem;
      font-weight: 600;
      color: var(--accent);
    }

    .step-content {
      flex: 1;
    }

    .step-content strong {
      display: block;
      margin-bottom: 0.25rem;
    }

    .step-content p {
      color: var(--text-secondary);
      font-size: 0.9375rem;
    }

    /* What's Unusual */
    .unusual {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 3rem;
    }

    .unusual h2 {
      font-size: 1.25rem;
      font-weight: 600;
      letter-spacing: -0.02em;
      margin-bottom: 1.5rem;
    }

    .unusual-grid {
      display: grid;
      gap: 1rem;
    }

    .unusual-item {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 1rem;
      align-items: center;
      padding: 1rem;
      background: var(--bg);
      border-radius: 8px;
    }

    .unusual-standard {
      color: var(--text-secondary);
      font-size: 0.9375rem;
    }

    .unusual-arrow {
      color: var(--accent);
      font-size: 1.25rem;
    }

    .unusual-this {
      font-weight: 500;
      font-size: 0.9375rem;
    }

    /* Related */
    .related {
      border-top: 1px solid var(--border);
      padding-top: 2rem;
    }

    .related h2 {
      font-size: 0.75rem;
      font-weight: 500;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: var(--text-secondary);
      margin-bottom: 1rem;
    }

    .related-links {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .related-link {
      padding: 0.5rem 1rem;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 0.875rem;
      transition: all 0.15s;
    }

    .related-link:hover {
      border-color: var(--accent);
      color: var(--text);
    }
  </style>
</head>
<body>
  <nav>
    <a href="index.html" class="nav-brand">Claude Code Patterns</a>
    <div class="nav-pills">
      <a href="#" class="nav-pill active">Ralph</a>
      <a href="gas-town.html" class="nav-pill">Gas Town</a>
      <a href="cc-mirror.html" class="nav-pill">CC Mirror</a>
      <a href="fresh-context.html" class="nav-pill">Fresh Context</a>
      <a href="claude-md.html" class="nav-pill">CLAUDE.md</a>
    </div>
  </nav>

  <main>
    <!-- Hero -->
    <header class="pattern-hero">
      <span class="pattern-type">Automation Pattern</span>
      <h1 class="pattern-title">Ralph Wiggum Loop</h1>
      <p class="pattern-subtitle">Continuous iteration with fresh context. The agent picks one task, completes it, commits, and exits. A bash loop spawns a fresh instance. Memory lives in files, not context.</p>
    </header>

    <!-- The Shape -->
    <section class="architecture">
      <div class="architecture-label">The Shape</div>
      <pre class="architecture-diagram">
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                     â”‚
                    â”‚   while true; do                    â”‚
                    â”‚     claude --prompt prompt.md       â”‚
                    â”‚   done                              â”‚
                    â”‚                                     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚   FRESH INSTANCE                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚            â”‚    â”‚            â”‚    â”‚            â”‚    â”‚            â”‚  â”‚
â”‚   â”‚  Read      â”‚â”€â”€â”€â–¶â”‚  Pick ONE  â”‚â”€â”€â”€â–¶â”‚  Complete  â”‚â”€â”€â”€â–¶â”‚  Commit    â”‚  â”‚
â”‚   â”‚  prd.json  â”‚    â”‚  task      â”‚    â”‚  + verify  â”‚    â”‚  + exit    â”‚  â”‚
â”‚   â”‚            â”‚    â”‚            â”‚    â”‚            â”‚    â”‚            â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚   State: prd.json, progress.txt, filesystem, git history                 â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ exit
                                   â–¼
                            Loop spawns new
                            fresh instance
      </pre>
      <p class="architecture-narrative">
        The outer bash loop is the orchestrator. Each Claude instance starts freshâ€”zero accumulated context, peak capability. It reads external state (prd.json), picks exactly one task, completes it with verification, commits the work, updates the task file, and exits. The loop catches the exit and spawns another fresh instance. Context rot is impossible because context never accumulates.
      </p>
    </section>

    <!-- Core Insight -->
    <section class="insight">
      <blockquote>
        "Think of the AI agent as an eager but somewhat dim junior developer (Ralph) who never sleeps, happily works on one tiny task at a time, commits often, and tells you when it's truly finished."
      </blockquote>
      <cite>â€” Matt Pocock</cite>
    </section>

    <!-- Why / Problem -->
    <div class="content-grid">
      <div class="content-card">
        <h3>The Problem</h3>
        <p>LLMs degrade with accumulated context. Every token added slightly degrades future operations. Long sessions lead to forgotten instructions, hallucinations, and quality collapse. The standard approachâ€”keep the session goingâ€”fights against the model's nature.</p>
      </div>
      <div class="content-card">
        <h3>The Solution</h3>
        <p>Don't fight context limitsâ€”embrace them. Make each session disposable. Let memory live in files (prd.json, progress.txt) that persist across sessions. The agent reads state, does one thing well, writes state, and dies. Fresh instance, fresh context, full capability.</p>
      </div>
    </div>

    <!-- Copy-Paste -->
    <section class="copy-paste">
      <h2>Copy-Paste Templates</h2>

      <div class="code-block">
        <div class="code-label">
          <span>ralph.sh â€” The Loop</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre class="code-content">#!/bin/bash
# Ralph Wiggum Loop - Continuous iteration with fresh context

while true; do
  echo "ğŸ”„ Starting fresh Claude instance..."

  claude --print-prompt prompt.md

  EXIT_CODE=$?

  if [ $EXIT_CODE -eq 0 ]; then
    echo "âœ… Task completed successfully"
  else
    echo "âš ï¸  Claude exited with code $EXIT_CODE"
  fi

  # Check if all tasks complete
  if grep -q '"status": "done"' prd.json 2>/dev/null; then
    echo "ğŸ‰ All tasks complete!"
    break
  fi

  echo "ğŸ’¤ Sleeping 5s before next iteration..."
  sleep 5
done</pre>
      </div>

      <div class="code-block">
        <div class="code-label">
          <span>prd.json â€” Task State</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre class="code-content">{
  "project": "My Feature",
  "tasks": [
    {
      "id": 1,
      "description": "Create user authentication endpoint",
      "status": "pending",
      "acceptance": "POST /auth/login returns JWT token"
    },
    {
      "id": 2,
      "description": "Add input validation",
      "status": "pending",
      "acceptance": "Invalid inputs return 400 with error details"
    },
    {
      "id": 3,
      "description": "Write integration tests",
      "status": "pending",
      "acceptance": "All auth flows covered, tests pass"
    }
  ]
}</pre>
      </div>

      <div class="code-block">
        <div class="code-label">
          <span>prompt.md â€” Agent Instructions</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre class="code-content"># Your Task

You are an autonomous coding agent. Read `prd.json` to understand the project.

## Rules
1. Pick ONE pending task (lowest ID first)
2. Implement it completely
3. Run tests/typecheck to verify
4. If passing: commit, mark task "done" in prd.json, exit
5. If failing: fix issues, then commit and exit
6. NEVER work on multiple tasks

## On Exit
Update prd.json with your progress. Write to progress.txt what you accomplished.
Then EXIT - a fresh instance will continue the work.</pre>
      </div>
    </section>

    <!-- How It Works -->
    <section class="how-it-works">
      <h2>How It Works</h2>
      <div class="steps">
        <div class="step">
          <div class="step-number">1</div>
          <div class="step-content">
            <strong>Bash loop starts</strong>
            <p>The outer loop runs indefinitely, spawning Claude instances</p>
          </div>
        </div>
        <div class="step">
          <div class="step-number">2</div>
          <div class="step-content">
            <strong>Fresh instance reads state</strong>
            <p>Claude reads prd.json to understand tasks, progress.txt for context</p>
          </div>
        </div>
        <div class="step">
          <div class="step-number">3</div>
          <div class="step-content">
            <strong>Picks ONE task</strong>
            <p>Selects the first pending taskâ€”never multiple, never skipping ahead</p>
          </div>
        </div>
        <div class="step">
          <div class="step-number">4</div>
          <div class="step-content">
            <strong>Implements with verification</strong>
            <p>Writes code, runs tests/typecheck, ensures acceptance criteria met</p>
          </div>
        </div>
        <div class="step">
          <div class="step-number">5</div>
          <div class="step-content">
            <strong>Commits and updates state</strong>
            <p>Git commit, mark task done in prd.json, write to progress.txt</p>
          </div>
        </div>
        <div class="step">
          <div class="step-number">6</div>
          <div class="step-content">
            <strong>Exits cleanly</strong>
            <p>Instance terminates. Loop catches exit, spawns fresh instance. Repeat.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- What's Unusual -->
    <section class="unusual">
      <h2>What's Unusual About This</h2>
      <div class="unusual-grid">
        <div class="unusual-item">
          <span class="unusual-standard">Keep sessions running longer</span>
          <span class="unusual-arrow">â†’</span>
          <span class="unusual-this">Kill sessions deliberately</span>
        </div>
        <div class="unusual-item">
          <span class="unusual-standard">Memory in conversation context</span>
          <span class="unusual-arrow">â†’</span>
          <span class="unusual-this">Memory in external files</span>
        </div>
        <div class="unusual-item">
          <span class="unusual-standard">Agent works until interrupted</span>
          <span class="unusual-arrow">â†’</span>
          <span class="unusual-this">Agent exits after each task</span>
        </div>
        <div class="unusual-item">
          <span class="unusual-standard">Sophisticated orchestration code</span>
          <span class="unusual-arrow">â†’</span>
          <span class="unusual-this">Three-line bash while loop</span>
        </div>
      </div>
    </section>

    <!-- Related -->
    <section class="related">
      <h2>Related Patterns</h2>
      <div class="related-links">
        <a href="gas-town.html" class="related-link">Gas Town â€” Factory-scale orchestration</a>
        <a href="cc-mirror.html" class="related-link">CC Mirror â€” Parallel workers</a>
        <a href="fresh-context.html" class="related-link">Fresh Context â€” The principle behind Ralph</a>
      </div>
    </section>
  </main>

  <script>
    function copyCode(btn) {
      const codeBlock = btn.closest('.code-block');
      const code = codeBlock.querySelector('.code-content').textContent;
      navigator.clipboard.writeText(code).then(() => {
        btn.textContent = 'Copied!';
        setTimeout(() => btn.textContent = 'Copy', 2000);
      });
    }
  </script>
</body>
</html>
