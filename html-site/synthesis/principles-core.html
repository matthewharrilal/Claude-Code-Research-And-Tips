<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Core Principles of Agent Engineering | Claude Code Documentation</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Lucide Icons CDN -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- GSAP for scroll-sync -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

  <!-- Tailwind Config with Design Tokens -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'bg-base': '#ffffff',
            'bg-subtle': '#fafafa',
            'bg-muted': '#f4f4f5',
            'text-primary': '#18181b',
            'text-secondary': '#3f3f46',
            'text-muted': '#71717a',
            'accent': '#0D9373',
            'accent-light': '#10b981',
            'accent-bg': '#ecfdf5',
            'border': '#e4e4e7',
            // Activity Zone content type colors (Original 6)
            'az-invariant': '#3b82f6',    // Blue
            'az-effect': '#f59e0b',       // Amber
            'az-composition': '#8b5cf6',  // Purple
            'az-frontier': '#ef4444',     // Red
            'az-warstory': '#10b981',     // Green
            'az-alternative': '#6b7280',  // Gray
            // Activity Zone generative content types (New 10)
            'az-inversion': '#4f46e5',    // Indigo
            'az-constraint': '#8b5cf6',   // Violet
            'az-gradient': '#f43f5e',     // Rose
            'az-horizon': '#06b6d4',      // Cyan
            'az-violation': '#f97316',    // Orange
            'az-tradeoff': '#f59e0b',     // Amber
            'az-analogy': '#d946ef',      // Fuchsia
            'az-expertise': '#10b981',    // Emerald
            'az-minimal': '#84cc16',      // Lime
            'az-inflection': '#eab308',   // Yellow
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
            mono: ['Fira Code', 'monospace'],
          },
        },
      },
    }
  </script>

  <style>
    /* Base Styles */
    * {
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
      scroll-padding-top: 80px;
    }

    [id] {
      scroll-margin-top: 80px;
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: #ffffff;
      color: #18181b;
      line-height: 1.7;
    }

    /* Three Panel Layout */
    .three-panel-layout {
      min-height: 100vh;
      position: relative;
    }

    /* Header */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 56px;
      background: #ffffff;
      border-bottom: 1px solid #e4e4e7;
      z-index: 100;
      display: flex;
      align-items: center;
      padding: 0 24px;
    }

    /* Left Navigation - 240px fixed */
    .left-nav {
      position: fixed;
      top: 56px;
      left: 0;
      width: 240px;
      height: calc(100vh - 56px);
      border-right: 1px solid #e4e4e7;
      background: #ffffff;
      overflow-y: auto;
      padding: 16px 0;
      z-index: 40;
    }

    .nav-section {
      padding: 0 12px;
      margin-bottom: 8px;
    }

    .nav-section-header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      font-size: 14px;
      font-weight: 500;
      color: #3f3f46;
      cursor: pointer;
      border-radius: 6px;
      transition: background 0.15s;
    }

    .nav-section-header:hover {
      background: #f4f4f5;
    }

    .nav-section-header.active {
      color: #0D9373;
      background: #ecfdf5;
    }

    .nav-item {
      display: block;
      padding: 6px 12px 6px 44px;
      font-size: 14px;
      color: #71717a;
      text-decoration: none;
      border-radius: 6px;
      transition: all 0.15s;
    }

    .nav-item:hover {
      color: #3f3f46;
      background: #f4f4f5;
    }

    .nav-item.active {
      color: #0D9373;
      background: #ecfdf5;
    }

    .nav-children {
      display: none;
      overflow: hidden;
    }

    .nav-children.expanded {
      display: block;
    }

    .nav-chevron {
      transition: transform 0.2s;
    }

    .nav-section.expanded .nav-chevron {
      transform: rotate(90deg);
    }

    /* Main Content - Flexible, margins for fixed sidebars */
    .main-content {
      margin-left: 240px;
      margin-right: 480px;
      margin-top: 56px;
      padding: 48px 48px;
      min-width: 400px;
    }

    /* Activity Zone - 480px fixed (proportional to main, less than main) */
    .activity-zone {
      position: fixed;
      top: 56px;
      right: 0;
      width: 480px;
      height: calc(100vh - 56px);
      border-left: 1px dashed #e4e4e7;
      background: #fafafa;
      overflow-y: auto;
      padding: 24px 20px;
      z-index: 40;
    }

    /* Responsive: Hide Activity Zone below 1400px */
    @media (max-width: 1400px) {
      .activity-zone {
        display: none;
      }
      .main-content {
        margin-right: 0;
        padding: 40px 32px;
      }
    }

    /* Responsive: Hide Left Nav below 768px */
    @media (max-width: 768px) {
      .left-nav {
        display: none;
      }
      .left-nav.open {
        display: block;
        position: fixed;
        top: 56px;
        left: 0;
        right: 0;
        bottom: 0;
        background: #ffffff;
        z-index: 50;
        overflow-y: auto;
      }
      .main-content {
        margin-left: 0;
        padding: 24px 16px;
        min-width: auto;
      }
    }

    /* Resizer - Draggable divider between Main Panel and Activity Zone */
    .resizer {
      position: fixed;
      top: 56px;
      right: 480px;
      width: 6px;
      height: calc(100vh - 56px);
      cursor: col-resize;
      background: transparent;
      z-index: 50;
      transition: background 0.15s ease;
    }

    .resizer:hover {
      background: rgba(13, 147, 115, 0.15);
    }

    .resizer.active {
      background: rgba(13, 147, 115, 0.25);
    }

    /* Prevent text selection during resize */
    body.resizing {
      user-select: none;
      cursor: col-resize !important;
    }

    body.resizing * {
      cursor: col-resize !important;
    }

    /* Hide resizer when Activity Zone is hidden (responsive) */
    @media (max-width: 1400px) {
      .resizer {
        display: none;
      }
    }

    /* Activity Zone Items */
    .activity-item {
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      background: #ffffff;
      border: 1px solid #e4e4e7;
      font-size: 14px;
      line-height: 1.6;
      opacity: 0.5;
      transition: all 0.3s ease;
    }

    .activity-item.active {
      opacity: 1;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .activity-item:hover {
      opacity: 1;
    }

    .activity-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    /* Activity Zone content type borders (Original 6) */
    .activity-item.invariant { border-left: 4px solid #3b82f6; }
    .activity-item.effect { border-left: 4px solid #f59e0b; }
    .activity-item.composition { border-left: 4px solid #8b5cf6; }
    .activity-item.frontier { border-left: 4px solid #ef4444; }
    .activity-item.warstory { border-left: 4px solid #10b981; }
    .activity-item.alternative { border-left: 4px solid #6b7280; }

    /* Activity Zone generative content types (New 10) */
    .activity-item.inversion { border-left: 4px solid #4f46e5; }
    .activity-item.constraint { border-left: 4px solid #8b5cf6; }
    .activity-item.gradient { border-left: 4px solid #f43f5e; }
    .activity-item.horizon { border-left: 4px solid #06b6d4; }
    .activity-item.violation { border-left: 4px solid #f97316; }
    .activity-item.tradeoff { border-left: 4px solid #f59e0b; }
    .activity-item.analogy { border-left: 4px solid #d946ef; }
    .activity-item.expertise { border-left: 4px solid #10b981; }
    .activity-item.minimal { border-left: 4px solid #84cc16; }
    .activity-item.inflection { border-left: 4px solid #eab308; }

    /* Main Content Components */

    /* Section titles with number */
    .section-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      background: #0D9373;
      color: #ffffff;
      font-size: 14px;
      font-weight: 600;
      border-radius: 50%;
      margin-right: 12px;
    }

    .section-title {
      font-size: 24px;
      font-weight: 600;
      color: #18181b;
      margin-bottom: 20px;
      margin-top: 56px;
      display: flex;
      align-items: center;
    }

    .section-title:first-child {
      margin-top: 0;
    }

    /* Essence Box (15 words) */
    .essence-box {
      background: linear-gradient(135deg, #18181b 0%, #27272a 100%);
      border-radius: 12px;
      padding: 32px;
      margin-bottom: 40px;
    }

    .essence-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #10b981;
      margin-bottom: 12px;
    }

    .essence-text {
      font-size: 22px;
      font-weight: 500;
      color: #ffffff;
      line-height: 1.4;
    }

    /* Core Abstraction Box */
    .core-abstraction {
      background: #fafafa;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 40px;
    }

    .core-philosophy {
      font-size: 16px;
      color: #3f3f46;
      margin-bottom: 16px;
      font-style: italic;
    }

    .core-code {
      background: #18181b;
      border-radius: 8px;
      padding: 16px 20px;
      margin-bottom: 16px;
      overflow-x: auto;
    }

    .core-code code {
      font-family: 'Fira Code', monospace;
      font-size: 15px;
      color: #10b981;
      white-space: nowrap;
    }

    .core-anchor {
      font-size: 14px;
      color: #71717a;
      text-align: center;
    }

    /* Decision Box */
    .decision-box {
      background: #ffffff;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
    }

    .decision-why {
      font-size: 16px;
      font-weight: 600;
      color: #0D9373;
      margin-bottom: 12px;
    }

    .decision-reasoning {
      font-size: 14px;
      color: #3f3f46;
      margin-bottom: 16px;
    }

    .decision-implication {
      background: #f4f4f5;
      border-radius: 8px;
      padding: 16px;
    }

    .decision-implication-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      color: #71717a;
      margin-bottom: 8px;
    }

    /* Code Blocks */
    .code-block {
      background: #18181b;
      border-radius: 8px;
      padding: 16px 20px;
      margin-bottom: 24px;
      position: relative;
      overflow-x: auto;
    }

    .code-block pre {
      margin: 0;
      font-family: 'Fira Code', monospace;
      font-size: 13px;
      color: #e4e4e7;
      line-height: 1.6;
    }

    .code-block .comment { color: #6b7280; }
    .code-block .keyword { color: #c084fc; }
    .code-block .string { color: #10b981; }
    .code-block .variable { color: #60a5fa; }

    .copy-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: #3f3f46;
      color: #ffffff;
      border: none;
      border-radius: 4px;
      padding: 6px 10px;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: background 0.15s;
    }

    .copy-btn:hover {
      background: #52525b;
    }

    /* Path Steps */
    .path-container {
      background: #fafafa;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 40px;
    }

    .path-step {
      display: flex;
      gap: 16px;
      margin-bottom: 16px;
    }

    .path-step:last-child {
      margin-bottom: 0;
    }

    .path-number {
      flex-shrink: 0;
      width: 24px;
      height: 24px;
      background: #0D9373;
      color: #ffffff;
      font-size: 12px;
      font-weight: 600;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .path-content {
      flex: 1;
      font-size: 14px;
      color: #3f3f46;
    }

    .path-content code {
      background: #e4e4e7;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 13px;
    }

    /* Gotcha Box */
    .gotcha-box {
      background: #fffbeb;
      border: 1px solid #fcd34d;
      border-left: 4px solid #f59e0b;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .gotcha-title {
      font-weight: 600;
      color: #92400e;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .gotcha-detail {
      font-size: 14px;
      color: #78350f;
      margin-bottom: 8px;
    }

    .gotcha-detail strong {
      color: #92400e;
    }

    /* What's Hard Box */
    .hard-box {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-left: 4px solid #ef4444;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .hard-title {
      font-weight: 600;
      color: #991b1b;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .hard-detail {
      font-size: 14px;
      color: #7f1d1d;
      margin-bottom: 8px;
    }

    /* When To Use Grid */
    .when-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 40px;
    }

    @media (max-width: 900px) {
      .when-grid {
        grid-template-columns: 1fr;
      }
    }

    .when-use {
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      border-radius: 12px;
      padding: 24px;
    }

    .when-not {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: 12px;
      padding: 24px;
    }

    .when-title {
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .when-use .when-title { color: #166534; }
    .when-not .when-title { color: #991b1b; }

    .when-item {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      font-size: 14px;
    }

    .when-use .when-item { color: #166534; }
    .when-not .when-item { color: #991b1b; }

    /* Principle Card */
    .principle-card {
      background: #ffffff;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .principle-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .principle-number {
      width: 32px;
      height: 32px;
      background: #0D9373;
      color: #ffffff;
      font-weight: 600;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .principle-name {
      font-size: 18px;
      font-weight: 600;
      color: #18181b;
    }

    .principle-summary {
      font-size: 14px;
      color: #3f3f46;
      margin-bottom: 16px;
    }

    /* Table Styles */
    .principle-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 24px;
      font-size: 14px;
    }

    .principle-table th {
      background: #f4f4f5;
      padding: 12px 16px;
      text-align: left;
      font-weight: 600;
      color: #3f3f46;
      border-bottom: 2px solid #e4e4e7;
    }

    .principle-table td {
      padding: 12px 16px;
      border-bottom: 1px solid #e4e4e7;
      color: #3f3f46;
    }

    .principle-table code {
      background: #e4e4e7;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 12px;
    }

    /* Hierarchy Diagram */
    .hierarchy-box {
      background: #fafafa;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 32px;
      overflow-x: auto;
    }

    .hierarchy-box pre {
      font-family: 'Fira Code', monospace;
      font-size: 12px;
      line-height: 1.5;
      color: #3f3f46;
      margin: 0;
    }

    /* Mobile Menu Button */
    .mobile-menu-btn {
      display: none;
      padding: 8px;
      background: none;
      border: none;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .mobile-menu-btn {
        display: flex;
      }
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: #fafafa;
    }

    ::-webkit-scrollbar-thumb {
      background: #d4d4d8;
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #a1a1aa;
    }

    /* Keyboard shortcut hint */
    .kbd {
      display: inline-flex;
      align-items: center;
      padding: 2px 6px;
      background: #f4f4f5;
      border: 1px solid #e4e4e7;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 12px;
      color: #71717a;
    }

    /* Quote block */
    .quote-block {
      border-left: 4px solid #0D9373;
      background: #ecfdf5;
      padding: 16px 20px;
      margin: 24px 0;
      border-radius: 0 8px 8px 0;
    }

    .quote-text {
      font-style: italic;
      color: #166534;
      margin-bottom: 8px;
    }

    .quote-author {
      font-size: 13px;
      color: #3f3f46;
    }

    /* Checkpoint box */
    .checkpoint-box {
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      border-left: 4px solid #10b981;
      border-radius: 8px;
      padding: 20px;
      margin: 24px 0;
    }

    .checkpoint-title {
      font-weight: 600;
      color: #166534;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .checkpoint-item {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
      font-size: 14px;
      color: #166534;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle menu">
      <i data-lucide="menu" class="w-5 h-5 text-text-secondary"></i>
    </button>
    <div class="flex items-center gap-3">
      <i data-lucide="terminal" class="w-5 h-5 text-accent"></i>
      <span class="font-semibold text-text-primary">Claude Code</span>
    </div>
    <div class="flex-1 flex justify-center">
      <button class="flex items-center gap-2 px-4 py-2 bg-bg-muted rounded-lg text-text-muted text-sm hover:bg-border transition-colors">
        <i data-lucide="search" class="w-4 h-4"></i>
        <span>Search documentation...</span>
        <span class="kbd">Cmd+K</span>
      </button>
    </div>
    <div class="flex items-center gap-4">
      <a href="#" class="text-sm text-text-muted hover:text-text-primary transition-colors">Support</a>
      <button class="p-2 hover:bg-bg-muted rounded-lg transition-colors" aria-label="Toggle theme">
        <i data-lucide="sun" class="w-4 h-4 text-text-muted"></i>
      </button>
    </div>
  </header>

  <div class="three-panel-layout">
    <!-- Left Navigation -->
    <nav class="left-nav" id="leftNav">
      <div class="px-4 mb-4">
        <span class="text-xs font-semibold text-text-muted uppercase tracking-wider">Core Principles</span>
      </div>

      <!-- Essence -->
      <div class="nav-section expanded" data-section="essence">
        <div class="nav-section-header active" onclick="toggleSection(this)">
          <i data-lucide="zap" class="w-4 h-4"></i>
          <span>Essence</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#essence" class="nav-item active">The 15-Word Summary</a>
        </div>
      </div>

      <!-- Core Abstraction -->
      <div class="nav-section expanded" data-section="core">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="box" class="w-4 h-4"></i>
          <span>Core Abstraction</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#core-abstraction" class="nav-item">The Principle Hierarchy</a>
          <a href="#the-8-principles" class="nav-item">The 8 Principles</a>
        </div>
      </div>

      <!-- Design Decisions -->
      <div class="nav-section expanded" data-section="decisions">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="lightbulb" class="w-4 h-4"></i>
          <span>Design Decisions</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#p1-context" class="nav-item">P1: Context Finite</a>
          <a href="#p2-external" class="nav-item">P2: External State</a>
          <a href="#p3-fresh" class="nav-item">P3: Fresh Context</a>
          <a href="#p4-separation" class="nav-item">P4: Orchestrator/Worker</a>
        </div>
      </div>

      <!-- File Structure (Principles 5-8) -->
      <div class="nav-section" data-section="files">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="folder" class="w-4 h-4"></i>
          <span>More Principles</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#p5-atomic" class="nav-item">P5: Atomic Tasks</a>
          <a href="#p6-gates" class="nav-item">P6: Quality Gates</a>
          <a href="#p7-isolation" class="nav-item">P7: Isolation</a>
          <a href="#p8-explicit" class="nav-item">P8: Explicit Comms</a>
        </div>
      </div>

      <!-- Path of a Task -->
      <div class="nav-section" data-section="path">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="git-branch" class="w-4 h-4"></i>
          <span>Deriving Patterns</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#derivation" class="nav-item">The Derivation Process</a>
        </div>
      </div>

      <!-- Gotchas -->
      <div class="nav-section" data-section="gotchas">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="alert-triangle" class="w-4 h-4"></i>
          <span>Gotchas</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#gotchas" class="nav-item">Common Violations</a>
        </div>
      </div>

      <!-- What's Hard -->
      <div class="nav-section" data-section="hard">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="flame" class="w-4 h-4"></i>
          <span>What's Hard</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#hard" class="nav-item">Fundamental Tensions</a>
        </div>
      </div>

      <!-- When to Use -->
      <div class="nav-section" data-section="when">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="check-circle" class="w-4 h-4"></i>
          <span>Quick Reference</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#when" class="nav-item">Principle Checklist</a>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">

      <!-- Section 1: ESSENCE -->
      <section id="essence" data-activity="essence">
        <div class="essence-box">
          <div class="essence-label">Essence (15 words)</div>
          <div class="essence-text">Eight principles explain WHY every Claude Code pattern works. Physics first, engineering follows.</div>
        </div>
      </section>

      <!-- Section 2: CORE ABSTRACTION + IMPLEMENTATION -->
      <section id="core-abstraction" data-activity="core">
        <h2 class="section-title">
          <span class="section-number">2</span>
          The Core Abstraction
        </h2>

        <div class="core-abstraction">
          <div class="core-philosophy">"Understanding principles enables you to create new patterns, adapt existing ones, and diagnose failures."</div>

          <div class="core-code">
            <button class="copy-btn" onclick="copyCode(this, 'When in doubt: externalize, isolate, verify, restart fresh.')">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <code>When in doubt: externalize, isolate, verify, restart fresh.</code>
          </div>

          <div class="core-anchor">The meta-principle. Everything else derives from it.</div>
        </div>

        <p class="text-text-secondary mb-6">
          These 8 principles are the fundamental WHYs behind every Claude Code pattern. They're not arbitrary rules - they emerge from the physics of LLM context windows, the reality of session boundaries, and the mathematics of compound errors.
        </p>

        <div class="hierarchy-box">
          <pre>                    +----------------------------------+
                    |  PRINCIPLE 1: CONTEXT IS FINITE  |
                    |  (The Primary Constraint)        |
                    +-----------------+----------------+
                                      |
              Everything flows from this limitation
                                      |
        +-----------------------------+-----------------------------+
        |                             |                             |
        v                             v                             v
+-------------------+   +-------------------+   +-------------------+
| PRINCIPLE 2:      |   | PRINCIPLE 3:      |   | PRINCIPLE 4:      |
| External State    |   | Fresh Context     |   | Separation of     |
| > Internal Memory |   | > Extended        |   | Concerns          |
|                   |   |   Sessions        |   | (Orch/Worker)     |
+---------+---------+   +---------+---------+   +---------+---------+
          |                       |                       |
          +-------------------------------------------+
                                  |
                    +-------------+-------------+
                    |                           |
                    v                           v
          +-------------------+      +-------------------+
          | PRINCIPLE 5:      |      | PRINCIPLE 6:      |
          | Atomic, Verifiable|      | Quality Gates     |
          | Task Sizing       |      | Before Commit     |
          +-------------------+      +-------------------+</pre>
        </div>

        <div id="the-8-principles">
          <h3 class="text-lg font-semibold mb-4 mt-8">The Complete Eight</h3>

          <table class="principle-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Principle</th>
                <th>One-Line Summary</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>P1</strong></td>
                <td>Context Is Finite</td>
                <td>All patterns optimize around limited context windows</td>
              </tr>
              <tr>
                <td><strong>P2</strong></td>
                <td>External State > Internal Memory</td>
                <td>Files persist, context evaporates</td>
              </tr>
              <tr>
                <td><strong>P3</strong></td>
                <td>Fresh Context > Extended Sessions</td>
                <td>New instances beat long conversations</td>
              </tr>
              <tr>
                <td><strong>P4</strong></td>
                <td>Separation of Concerns</td>
                <td>Orchestrators coordinate, workers execute</td>
              </tr>
              <tr>
                <td><strong>P5</strong></td>
                <td>Atomic, Verifiable Tasks</td>
                <td>Complete in one iteration, verify before commit</td>
              </tr>
              <tr>
                <td><strong>P6</strong></td>
                <td>Quality Gates Before Commit</td>
                <td>Tests must pass, no broken code inheritance</td>
              </tr>
              <tr>
                <td><strong>P7</strong></td>
                <td>Isolation Prevents Contamination</td>
                <td>Own your space, don't conflict</td>
              </tr>
              <tr>
                <td><strong>P8</strong></td>
                <td>Explicit Communication</td>
                <td>File-based handoffs, not implicit coordination</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Section 3: DESIGN DECISIONS (Principles 1-4) -->
      <section id="p1-context" data-activity="decisions">
        <h2 class="section-title">
          <span class="section-number">3</span>
          Design Decisions (P1-P4)
        </h2>

        <div class="decision-box">
          <div class="decision-why">P1: WHY CONTEXT IS THE PRIMARY CONSTRAINT</div>
          <div class="decision-reasoning">
            LLMs degrade with filled context windows. Claude's ~200K tokens (effective ~100K for quality work) is a hard ceiling. At 70-85% fill, you see instruction drift. At 85%+, hallucinations and amnesia. This is transformer physics, not a bug.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Every pattern, tool, and workflow decision must answer: "How does this affect context consumption?" If it grows unbounded, it will eventually break.
            </div>
          </div>
        </div>

        <div class="quote-block">
          <div class="quote-text">"Context rot: LLMs get stupider with more tokens."</div>
          <div class="quote-author">-- @mattpocockuk</div>
        </div>

        <h4 class="font-semibold mb-3 mt-6">Context Rot Symptoms</h4>
        <table class="principle-table">
          <thead>
            <tr>
              <th>Context Level</th>
              <th>Quality Impact</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>0-50%</td>
              <td>Full capability</td>
            </tr>
            <tr>
              <td>50-70%</td>
              <td>Slight degradation possible</td>
            </tr>
            <tr>
              <td>70-85%</td>
              <td>Noticeable quality loss</td>
            </tr>
            <tr>
              <td>85-95%</td>
              <td>Significant degradation, instructions forgotten</td>
            </tr>
            <tr>
              <td>95%+</td>
              <td>Failure mode - hallucinations, contradictions, amnesia</td>
            </tr>
          </tbody>
        </table>

        <div class="decision-box" id="p2-external">
          <div class="decision-why">P2: WHY EXTERNAL STATE OVER INTERNAL MEMORY</div>
          <div class="decision-reasoning">
            Sessions end. Context clears. Memory evaporates. Any information stored only in the LLM's context will be lost when the session ends, context fills, errors crash, or the user starts fresh. The filesystem IS the memory.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Never trust context for continuity. Write state immediately. If it's not in a file, it doesn't exist. Use the three core files: <code>progress.txt</code> (append-only learnings), <code>prd.json</code> (task state), <code>CLAUDE.md</code> (project context).
            </div>
          </div>
        </div>

        <div class="quote-block">
          <div class="quote-text">"Memory is external. The agent is stateless."</div>
          <div class="quote-author">-- Ryan Carson</div>
        </div>

        <div class="decision-box" id="p3-fresh">
          <div class="decision-why">P3: WHY FRESH CONTEXT OVER EXTENDED SESSIONS</div>
          <div class="decision-reasoning">
            Context accumulation is entropy. Every operation adds tokens. Every token added slightly degrades future operations. This compounds until quality collapse. Fresh context is regeneration - 0% usage, peak capability, no accumulated noise.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Design for iteration, not session. Size work to complete within one context window. Accept startup cost - reading state each time is worth quality preservation. Extended sessions guarantee degradation; fresh context guarantees consistent quality.
            </div>
          </div>
        </div>

        <div class="decision-box" id="p4-separation">
          <div class="decision-why">P4: WHY SEPARATE ORCHESTRATOR FROM WORKER</div>
          <div class="decision-reasoning">
            Mixing coordination with execution causes context pollution (orchestrator fills with execution details) and role confusion (agent oscillates between planning and doing, doing neither well). Clear separation enables parallelization, model selection by role, and failure containment.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Orchestrators: decompose, assign, track, monitor. Workers: execute, report, complete, exit. Use Opus for orchestration (complex reasoning), Sonnet for implementation (following patterns), Haiku for lookups (simple transforms).
            </div>
          </div>
        </div>

        <div class="quote-block">
          <div class="quote-text">"YOU DO NOT WRITE CODE. YOU DO NOT RUN COMMANDS. YOU DO NOT EXPLORE CODEBASES. You are the CONDUCTOR. Your agents play the instruments."</div>
          <div class="quote-author">-- @nummanali (CC Mirror)</div>
        </div>
      </section>

      <!-- Section 4: FILE STRUCTURE (Principles 5-8) -->
      <section id="p5-atomic" data-activity="files">
        <h2 class="section-title">
          <span class="section-number">4</span>
          More Principles (P5-P8)
        </h2>

        <div class="principle-card">
          <div class="principle-header">
            <div class="principle-number">5</div>
            <div class="principle-name">Atomic, Verifiable Task Sizing</div>
          </div>
          <div class="principle-summary">
            Large tasks fail predictably: context overflow, scope creep, unverifiable progress, lost recovery points. Atomic tasks succeed because they fit in one context window, have clear boundaries, can be independently verified, and can be committed atomically.
          </div>

          <h4 class="font-semibold mb-3">The 2-3 Sentence Test</h4>
          <p class="text-text-secondary text-sm mb-4">If you can't describe the task in 2-3 sentences, it's too big.</p>

          <table class="principle-table">
            <thead>
              <tr>
                <th>Size</th>
                <th>Lines</th>
                <th>Files</th>
                <th>Iterations</th>
                <th>Example</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>XS</td>
                <td>1-20</td>
                <td>1</td>
                <td>1</td>
                <td>Add column, fix typo</td>
              </tr>
              <tr>
                <td>S</td>
                <td>20-100</td>
                <td>1-2</td>
                <td>1</td>
                <td>New component, endpoint</td>
              </tr>
              <tr>
                <td>M</td>
                <td>100-300</td>
                <td>2-5</td>
                <td>1-2</td>
                <td>Feature piece, integration</td>
              </tr>
              <tr>
                <td>L</td>
                <td>300-1000</td>
                <td>5-10</td>
                <td>3-5</td>
                <td>Small feature, refactor</td>
              </tr>
              <tr>
                <td>XL</td>
                <td>1000+</td>
                <td>10+</td>
                <td>5+</td>
                <td><strong>MUST DECOMPOSE!</strong></td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="principle-card" id="p6-gates">
          <div class="principle-header">
            <div class="principle-number">6</div>
            <div class="principle-name">Quality Gates Before Commit</div>
          </div>
          <div class="principle-summary">
            Broken code propagates. If iteration N commits broken code, iteration N+1 inherits a broken baseline and must debug first. This compounds. Working code accumulates - if every commit passes tests, every future iteration starts from a working baseline.
          </div>

          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre><span class="comment"># BEFORE ANY COMMIT:</span>
1. Type checking     <span class="keyword">--></span> npm run typecheck
2. Unit tests        <span class="keyword">--></span> npm test
3. Lint              <span class="keyword">--></span> npm run lint
4. Integration tests <span class="keyword">--></span> npm run test:integration

<span class="comment"># ALL PASS? --> Commit allowed</span>
<span class="comment"># ANY FAIL? --> Fix BEFORE commit, retry gates</span></pre>
          </div>
        </div>

        <div class="principle-card" id="p7-isolation">
          <div class="principle-header">
            <div class="principle-number">7</div>
            <div class="principle-name">Isolation Prevents Contamination</div>
          </div>
          <div class="principle-summary">
            Shared state causes conflicts - edits overwrite, merge conflicts arise, partial changes break builds. Isolation enables parallelization - no conflicts possible, parallel execution safe, failures contained, recovery straightforward.
          </div>

          <table class="principle-table">
            <thead>
              <tr>
                <th>Strategy</th>
                <th>Mechanism</th>
                <th>Best For</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Directory isolation</td>
                <td>Each agent owns a directory</td>
                <td>Domain specialization</td>
              </tr>
              <tr>
                <td>Branch isolation</td>
                <td>Each agent on own branch</td>
                <td>Feature parallelism</td>
              </tr>
              <tr>
                <td>Worktree isolation</td>
                <td>Git worktrees share repo</td>
                <td>Heavy parallelism</td>
              </tr>
              <tr>
                <td>Container isolation</td>
                <td>Docker with volume mounts</td>
                <td>Production systems</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="principle-card" id="p8-explicit">
          <div class="principle-header">
            <div class="principle-number">8</div>
            <div class="principle-name">Explicit Communication Over Implicit</div>
          </div>
          <div class="principle-summary">
            LLMs don't share memory. Each agent instance starts with zero knowledge of others. Implicit coordination fails - agents can't sense what others are doing, know if files are being edited elsewhere, or coordinate timing without signals. File-based explicit communication succeeds.
          </div>

          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre><span class="comment">// handoff-agent1-to-agent2.json</span>
{
  <span class="string">"from"</span>: <span class="string">"agent1"</span>,
  <span class="string">"to"</span>: <span class="string">"agent2"</span>,
  <span class="string">"timestamp"</span>: <span class="string">"2026-01-09T10:30:00Z"</span>,
  <span class="string">"context"</span>: {
    <span class="string">"completed"</span>: [<span class="string">"API schema"</span>, <span class="string">"Database models"</span>],
    <span class="string">"next_steps"</span>: [<span class="string">"Implement REST endpoints"</span>],
    <span class="string">"blockers"</span>: [],
    <span class="string">"notes"</span>: <span class="string">"Using FastAPI, see docs in /api/README.md"</span>
  }
}</pre>
          </div>
        </div>
      </section>

      <!-- Section 5: PATH OF A TASK (Deriving Patterns) -->
      <section id="derivation" data-activity="path">
        <h2 class="section-title">
          <span class="section-number">5</span>
          Deriving New Patterns
        </h2>

        <p class="text-text-secondary mb-6">
          The true power of understanding principles is the ability to derive NEW patterns for novel situations.
        </p>

        <div class="path-container">
          <div class="path-step">
            <div class="path-number">1</div>
            <div class="path-content"><strong>Identify the constraint</strong> - What's the primary challenge?</div>
          </div>
          <div class="path-step">
            <div class="path-number">2</div>
            <div class="path-content"><strong>Map to principles</strong> - Which principles apply?</div>
          </div>
          <div class="path-step">
            <div class="path-number">3</div>
            <div class="path-content"><strong>Check for conflicts</strong> - Do any principles conflict in this case?</div>
          </div>
          <div class="path-step">
            <div class="path-number">4</div>
            <div class="path-content"><strong>Combine mechanisms</strong> - What implementations serve multiple principles?</div>
          </div>
          <div class="path-step">
            <div class="path-number">5</div>
            <div class="path-content"><strong>Validate</strong> - Does the derived pattern satisfy the constraints?</div>
          </div>
        </div>

        <h4 class="font-semibold mb-3">Example: Multi-Model Ensemble</h4>
        <p class="text-text-secondary text-sm mb-4">
          <strong>Scenario:</strong> Need to build a complex feature with both architecture decisions AND implementation.
        </p>

        <table class="principle-table">
          <thead>
            <tr>
              <th>Constraint</th>
              <th>Principle</th>
              <th>Implication</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Complex work</td>
              <td>P1 (Context finite)</td>
              <td>Preserve context for complex reasoning</td>
            </tr>
            <tr>
              <td>Planning + execution</td>
              <td>P4 (Separation)</td>
              <td>Separate planning from execution</td>
            </tr>
            <tr>
              <td>Large feature</td>
              <td>P5 (Atomic tasks)</td>
              <td>Break into completable chunks</td>
            </tr>
            <tr>
              <td>Quality requirement</td>
              <td>P6 (Quality gates)</td>
              <td>Each chunk verified before next</td>
            </tr>
          </tbody>
        </table>

        <p class="text-text-secondary text-sm mt-4 mb-4"><strong>Derived Pattern:</strong></p>
        <div class="code-block">
          <pre>1. Opus agent (planning mode) <span class="keyword">--></span> Analyze requirements, produce PRD
2. PRD verified by human
3. Sonnet workers (parallel) <span class="keyword">--></span> Implement each story
4. Each story passes tests before commit
5. Opus agent (review mode) <span class="keyword">--></span> Verify integration</pre>
        </div>

        <h4 class="font-semibold mb-3 mt-8">Principle Compatibility Matrix</h4>
        <table class="principle-table">
          <thead>
            <tr>
              <th>Principle</th>
              <th>Reinforces</th>
              <th>Tension With</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>P1 (Context)</td>
              <td>P3, P2, P5</td>
              <td>Extended sessions</td>
            </tr>
            <tr>
              <td>P2 (External)</td>
              <td>P3, P8</td>
              <td>In-context memory</td>
            </tr>
            <tr>
              <td>P3 (Fresh)</td>
              <td>P1, P2</td>
              <td>Session continuity</td>
            </tr>
            <tr>
              <td>P4 (Separation)</td>
              <td>P1, P7</td>
              <td>Simple single-agent</td>
            </tr>
            <tr>
              <td>P5 (Atomic)</td>
              <td>P6, P3</td>
              <td>Large monolithic tasks</td>
            </tr>
            <tr>
              <td>P6 (Gates)</td>
              <td>P5, P2</td>
              <td>Speed-first development</td>
            </tr>
            <tr>
              <td>P7 (Isolation)</td>
              <td>P4, P8</td>
              <td>Shared state</td>
            </tr>
            <tr>
              <td>P8 (Explicit)</td>
              <td>P7, P2</td>
              <td>Implicit coordination</td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- Section 6: GOTCHAS -->
      <section id="gotchas" data-activity="gotchas">
        <h2 class="section-title">
          <span class="section-number">6</span>
          Gotchas
        </h2>

        <p class="text-text-secondary mb-6">
          Common principle violations and how to diagnose them:
        </p>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Principle violation goes unnoticed until failure
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Pattern works for small tasks but fails catastrophically on larger ones</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Subtle principle violations that only manifest at scale</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Use the principle checklist before any multi-session or multi-agent work</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Fresh context pattern feels inefficient
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Startup overhead each iteration seems wasteful</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Misunderstanding the tradeoff between consistency and speed</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Accept that reading state takes ~5-10 seconds but prevents hours of debugging. Measure: fresh context iterations are MORE efficient over 10+ iterations.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Orchestrator keeps "helping" with implementation
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Orchestrator context fills with code; loses coordination capacity</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Unclear role boundaries or orchestrator prompt too permissive</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Add explicit prohibition: "YOU DO NOT WRITE CODE." Restrict orchestrator tools to: TaskCreate, TaskUpdate, Task, AskUserQuestion, Read (1-2 files max).</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Tasks never seem "atomic" enough
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Tasks keep expanding scope; never complete in one iteration</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Acceptance criteria too vague or task boundaries unclear</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Apply the 2-3 sentence test. If you can't describe it in 2-3 sentences, split it.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Quality gates slow things down
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Tests take too long; tempted to skip them</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Misunderstanding the cost of broken code propagation</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Broken code in iteration N means N+1 must debug first. Debugging spirals can consume 5-10x the time saved by skipping tests.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Isolation prevents necessary coordination
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Agents can't share information; work duplicated</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Over-isolation without handoff mechanism</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Isolation doesn't mean no communication - it means EXPLICIT communication via files. Use <code>handoff-agent1-to-agent2.json</code> pattern.</div>
        </div>
      </section>

      <!-- Section 7: WHAT'S HARD -->
      <section id="hard" data-activity="hard">
        <h2 class="section-title">
          <span class="section-number">7</span>
          What's Hard
        </h2>

        <p class="text-text-secondary mb-6">
          Fundamental tensions between principles that require judgment, not rules:
        </p>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            P1 vs P4: Context Constraint vs Separation Overhead
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Orchestrator/worker separation (P4) adds context overhead - spawning workers, reading results. But context is precious (P1).</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Simple tasks feel over-engineered with full separation. Complex tasks fail without it.</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Use single-agent for simple tasks (< 30 min). Add orchestrator when task graph > 3 nodes. The threshold is judgment, not formula.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            P3 vs P5: Fresh Context vs Task Continuity
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Fresh context (P3) means losing state. Atomic tasks (P5) sometimes need context from the previous step that's hard to externalize.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Multi-step workflows lose subtle context between iterations. Repeating obvious mistakes.</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Invest in better externalization. progress.txt for learnings. Detailed task descriptions that capture implicit knowledge.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            P6 vs Speed: Quality Gates vs Development Velocity
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Running full test suites (P6) takes time. Fast iteration feels productive.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Temptation to skip tests on "small" changes. Debugging spirals when you don't.</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Invest in fast tests. Parallel test execution. Incremental type checking. The answer is faster gates, not no gates.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            P7 vs P8: Isolation vs Communication
          </div>
          <div class="hard-detail"><strong>The tension:</strong> More isolation (P7) means more communication overhead (P8). Less isolation means conflict risk.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Agents duplicating work (over-isolated). Agents conflicting on files (under-isolated).</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Isolation at directory/branch level. Communication at file level. Clear ownership rules. The boundary matters more than the mechanism.</div>
        </div>
      </section>

      <!-- Section 8: WHEN TO USE / QUICK REFERENCE -->
      <section id="when" data-activity="when">
        <h2 class="section-title">
          <span class="section-number">8</span>
          Quick Reference
        </h2>

        <h4 class="font-semibold mb-4">When Things Break, Check Principles</h4>

        <table class="principle-table">
          <thead>
            <tr>
              <th>Symptom</th>
              <th>Likely Violated</th>
              <th>Fix</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Agent forgets previous work</td>
              <td>P2 (External state)</td>
              <td>Externalize to files</td>
            </tr>
            <tr>
              <td>Quality degrades over time</td>
              <td>P1/P3 (Context/Fresh)</td>
              <td>Reset more frequently</td>
            </tr>
            <tr>
              <td>Workers spawn their own agents</td>
              <td>P4 (Separation)</td>
              <td>Explicit worker preamble</td>
            </tr>
            <tr>
              <td>Tasks never complete</td>
              <td>P5 (Atomic sizing)</td>
              <td>Smaller stories</td>
            </tr>
            <tr>
              <td>Broken code accumulates</td>
              <td>P6 (Quality gates)</td>
              <td>Enforce tests before commit</td>
            </tr>
            <tr>
              <td>Agents conflict on files</td>
              <td>P7 (Isolation)</td>
              <td>Worktrees or ownership</td>
            </tr>
            <tr>
              <td>Agents don't coordinate</td>
              <td>P8 (Explicit comms)</td>
              <td>File-based handoffs</td>
            </tr>
          </tbody>
        </table>

        <div class="checkpoint-box">
          <div class="checkpoint-title">
            <i data-lucide="check-circle" class="w-4 h-4"></i>
            The Principle Checklist
          </div>
          <p class="text-sm text-text-secondary mb-3">Before any multi-session or multi-agent work:</p>
          <div class="checkpoint-item">
            <input type="checkbox" class="mr-2">
            <span>Is state externalized to survive session death? (P2)</span>
          </div>
          <div class="checkpoint-item">
            <input type="checkbox" class="mr-2">
            <span>Is each task completable in one context window? (P5)</span>
          </div>
          <div class="checkpoint-item">
            <input type="checkbox" class="mr-2">
            <span>Are quality gates defined and enforced? (P6)</span>
          </div>
          <div class="checkpoint-item">
            <input type="checkbox" class="mr-2">
            <span>Is orchestrator separated from workers? (P4)</span>
          </div>
          <div class="checkpoint-item">
            <input type="checkbox" class="mr-2">
            <span>Are agents isolated from each other? (P7)</span>
          </div>
          <div class="checkpoint-item">
            <input type="checkbox" class="mr-2">
            <span>Is communication explicit via files? (P8)</span>
          </div>
          <div class="checkpoint-item">
            <input type="checkbox" class="mr-2">
            <span>Is fresh context preferred over extended sessions? (P3)</span>
          </div>
          <div class="checkpoint-item">
            <input type="checkbox" class="mr-2">
            <span>Is context budget tracked and respected? (P1)</span>
          </div>
        </div>

        <div class="when-grid">
          <div class="when-use">
            <div class="when-title">
              <i data-lucide="check" class="w-5 h-5"></i>
              APPLY PRINCIPLES WHEN
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Building any multi-session workflow</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Designing multi-agent systems</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Debugging failed patterns</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Creating new patterns for novel situations</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Evaluating tradeoffs in architectural decisions</span>
            </div>
          </div>

          <div class="when-not">
            <div class="when-title">
              <i data-lucide="x" class="w-5 h-5"></i>
              DON'T OVER-APPLY WHEN
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Single small task (< 30 min) - Simple is fine</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Exploratory debugging - Context accumulation helps</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Learning/prototyping - Speed matters more</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>One-off scripts - Don't over-engineer</span>
            </div>
          </div>
        </div>
      </section>

    </main>

    <!-- Resizer between Main Panel and Activity Zone -->
    <div class="resizer" data-resizer="activity-zone" aria-label="Resize activity panel"></div>

    <!-- Activity Zone -->
    <aside class="activity-zone" id="activityZone">
      <div class="text-xs font-semibold text-text-muted uppercase tracking-wider mb-4">Operational Intelligence</div>

      <!-- ESSENCE SECTION -->
      <div class="activity-item minimal" data-section="essence">
        <div class="activity-label" style="color: #84cc16;">
          <i data-lucide="minimize-2" class="w-4 h-4"></i>
          Minimal Pattern
        </div>
        <div class="font-medium text-text-primary mb-2">The irreducible core of all principles</div>
        <div class="text-text-secondary text-sm">
          <code style="background: #f4f4f5; padding: 2px 6px; border-radius: 4px; font-size: 12px;">When in doubt: externalize, isolate, verify, restart fresh.</code><br><br>
          <strong>Essential:</strong> These 4 verbs capture all 8 principles.<br>
          <strong>Everything else:</strong> Implementation detail.
        </div>
      </div>

      <div class="activity-item inversion" data-section="essence">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if you didn't need principles?</div>
        <div class="text-text-secondary text-sm">
          <strong>You'd need:</strong> Infinite context, perfect memory, no session boundaries, zero errors.<br>
          <strong>Why this fails:</strong> LLMs have finite context that degrades. Sessions end. Errors happen.<br>
          <strong>Hidden constraint revealed:</strong> Principles ARE the constraints made explicit.
        </div>
      </div>

      <div class="activity-item analogy" data-section="essence">
        <div class="activity-label" style="color: #d946ef;">
          <i data-lucide="git-compare" class="w-4 h-4"></i>
          Analogical Bridge
        </div>
        <div class="font-medium text-text-primary mb-2">Principles = Physics, Patterns = Engineering</div>
        <div class="text-text-secondary text-sm">
          Newton's laws  Mechanical engineering<br>
          Maxwell's equations  Electrical engineering<br>
          Core principles  Agent engineering<br><br>
          <em>If you've studied any engineering discipline, you understand this relationship.</em>
        </div>
      </div>

      <!-- CORE SECTION -->
      <div class="activity-item constraint" data-section="core">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="link-2" class="w-4 h-4"></i>
          Constraint Chain
        </div>
        <div class="font-medium text-text-primary mb-2">P1 (Context finite) cascades to everything</div>
        <div class="text-text-secondary text-sm">
          <strong>ROOT:</strong> Context finite (200K nominal, ~100K effective)<br>
           P2: State must persist externally (context evaporates)<br>
           P3: Fresh context beats extended (quality degrades)<br>
           P5: Tasks must fit in window (or they overflow)<br>
           P6: Each commit must pass (or errors compound)<br>
           P4: Separate roles (preserve orchestrator context)
        </div>
      </div>

      <div class="activity-item invariant" data-section="core">
        <div class="activity-label" style="color: #3b82f6;">
          <i data-lucide="link" class="w-4 h-4"></i>
          Invariant Connection
        </div>
        <div class="font-medium text-text-primary mb-2">Ralph, Gas Town, CC Mirror all derive from P1-P3</div>
        <div class="text-text-secondary text-sm">
          <strong>WHY THIS MATTERS:</strong> These look like different patterns, but they all solve the same root constraint: context is finite and degrades.<br><br>
          If you understand P1-P3, you understand why all three patterns exist.
        </div>
      </div>

      <div class="activity-item gradient" data-section="core">
        <div class="activity-label" style="color: #f43f5e;">
          <i data-lucide="trending-down" class="w-4 h-4"></i>
          Failure Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">How principle violations compound</div>
        <div class="text-text-secondary text-sm">
          <strong>1 violation:</strong> Slight inefficiency, recoverable<br>
          <strong>2-3 violations:</strong> Degraded quality, requires intervention<br>
          <strong>4+ violations:</strong> Pattern failure, start over<br>
          <strong>Sustained violations:</strong> Technical debt compounds exponentially<br><br>
          <em>Critical: Most failures trace to multiple principle violations.</em>
        </div>
      </div>

      <!-- DECISIONS SECTION (P1-P4) -->
      <div class="activity-item warstory" data-section="decisions">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">Matt Pocock: "Context rot at 80K"</div>
        <div class="text-text-secondary text-sm">
          <strong>CONTEXT:</strong> Extended session, complex refactor<br>
          <strong>OUTCOME:</strong> Quality degraded around 80K tokens. Instructions forgotten. Repetition started.<br>
          <strong>KEY LEARNING:</strong> "LLMs get stupider with more tokens." The threshold is real.
        </div>
      </div>

      <div class="activity-item violation" data-section="decisions">
        <div class="activity-label" style="color: #f97316;">
          <i data-lucide="alert-octagon" class="w-4 h-4"></i>
          Violation Chain: Relying on Memory
        </div>
        <div class="font-medium text-text-primary mb-2">If you skip P2 (external state)</div>
        <div class="text-text-secondary text-sm">
          <strong>IF:</strong> You rely on "Claude remembering" previous work<br>
          <strong>THEN:</strong> Next iteration has no knowledge<br>
          <strong>THEN:</strong> Same mistakes repeated<br>
          <strong>THEN:</strong> No velocity increase over iterations<br>
          <strong>FINALLY:</strong> Iteration 20 is as slow as iteration 1<br><br>
          <em>The fix: "If it's not in a file, it doesn't exist."</em>
        </div>
      </div>

      <div class="activity-item tradeoff" data-section="decisions">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="scale" class="w-4 h-4"></i>
          Trade-Off Tension
        </div>
        <div class="font-medium text-text-primary mb-2">P3: Fresh context vs startup cost</div>
        <div class="text-text-secondary text-sm">
          <strong>Fresh context:</strong> Peak quality, but must read state each time<br>
          <strong>Extended session:</strong> No startup cost, but quality degrades<br><br>
          <strong>WHY NO PERFECT ANSWER:</strong> You're trading time for quality.<br><br>
          <em>Heuristic: Fresh context wins over 10+ iterations. The startup cost is amortized.</em>
        </div>
      </div>

      <div class="activity-item expertise" data-section="decisions">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
          Expertise Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">P4: Orchestrator/Worker understanding</div>
        <div class="text-text-secondary text-sm">
          <strong>BEGINNER:</strong> "What's an orchestrator?"  The coordinator that doesn't write code<br>
          <strong>INTERMEDIATE:</strong> "Why not just one agent?"  Context pollution, role confusion<br>
          <strong>ADVANCED:</strong> "When is separation worth it?"  Task graph > 3 nodes<br>
          <strong>STAFF:</strong> "What model for each?"  Opus orchestration, Sonnet workers<br>
          <strong>EXPERT:</strong> "When to nest orchestrators?"  Domain boundaries, team boundaries
        </div>
      </div>

      <div class="activity-item horizon" data-section="decisions">
        <div class="activity-label" style="color: #06b6d4;">
          <i data-lucide="clock" class="w-4 h-4"></i>
          Time Horizon Shift
        </div>
        <div class="font-medium text-text-primary mb-2">How P2 (external state) perception changes</div>
        <div class="text-text-secondary text-sm">
          <strong>Day 1:</strong> "Writing progress.txt feels like overhead"<br>
          <strong>Week 1:</strong> "Wait, Claude is repeating solved mistakes!"<br>
          <strong>Month 1:</strong> "progress.txt is why late iterations are faster"<br>
          <strong>Month 3:</strong> "This is institutional memory"<br><br>
          <em>Don't judge externalization by day 1.</em>
        </div>
      </div>

      <!-- FILES SECTION (P5-P8) -->
      <div class="activity-item inflection" data-section="files">
        <div class="activity-label" style="color: #eab308;">
          <i data-lucide="activity" class="w-4 h-4"></i>
          Inflection Point
        </div>
        <div class="font-medium text-text-primary mb-2">P5: When task size flips from efficient to risky</div>
        <div class="text-text-secondary text-sm">
          <strong>XS-S tasks:</strong> Pure benefit (low risk, easy verification)<br>
          <strong>M tasks:</strong> Optimal zone (meaningful progress, manageable risk)<br>
          <strong>L tasks:</strong> Diminishing returns (context pressure building)<br>
          <strong>XL tasks:</strong> Net negative (overflow risk, must decompose)<br><br>
          <strong>THE INFLECTION:</strong> ~300 lines, ~5 files<br>
          <em>Detection: If you can't describe it in 2-3 sentences, you've crossed it.</em>
        </div>
      </div>

      <div class="activity-item violation" data-section="files">
        <div class="activity-label" style="color: #f97316;">
          <i data-lucide="alert-octagon" class="w-4 h-4"></i>
          Violation Chain: Skipping P6
        </div>
        <div class="font-medium text-text-primary mb-2">If you skip quality gates</div>
        <div class="text-text-secondary text-sm">
          <strong>IF:</strong> You skip "run tests before commit"<br>
          <strong>THEN:</strong> Broken code enters git<br>
          <strong>THEN:</strong> Future iterations inherit broken baseline<br>
          <strong>THEN:</strong> Each iteration debugs before working<br>
          <strong>FINALLY:</strong> Debugging spirals consume 5-10x saved time<br><br>
          <em>One skipped test at iteration 5  15 iterations on broken foundation</em>
        </div>
      </div>

      <div class="activity-item composition" data-section="files">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="layers" class="w-4 h-4"></i>
          Composition Case
        </div>
        <div class="font-medium text-text-primary mb-2">P7 (Isolation) + P8 (Explicit Comms)</div>
        <div class="text-text-secondary text-sm">
          <strong>WORKS?</strong> Yes, and they're designed to work together<br><br>
          <strong>WHY IT WORKS:</strong> Isolation prevents conflicts. Explicit communication enables coordination. The combination gives you safe parallelism.<br><br>
          <strong>THE DANGER:</strong> Over-isolation without handoffs = duplicated work. Under-isolation = conflicts.<br><br>
          <strong>RECOMMENDATION:</strong> Isolate at directory/branch level. Communicate at file level.
        </div>
      </div>

      <div class="activity-item analogy" data-section="files">
        <div class="activity-label" style="color: #d946ef;">
          <i data-lucide="git-compare" class="w-4 h-4"></i>
          Analogical Bridge
        </div>
        <div class="font-medium text-text-primary mb-2">P7+P8 = Microservices Architecture</div>
        <div class="text-text-secondary text-sm">
          Service isolation  Agent isolation (P7)<br>
          API contracts  File-based handoffs (P8)<br>
          Message queues  handoff-*.json files<br>
          Database per service  Directory per agent<br><br>
          <em>If you've designed microservices, you already understand P7+P8.</em>
        </div>
      </div>

      <!-- PATH SECTION (Derivation) -->
      <div class="activity-item inversion" data-section="path">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if you couldn't derive new patterns?</div>
        <div class="text-text-secondary text-sm">
          <strong>You'd need:</strong> A pattern library for every possible situation<br>
          <strong>Why this fails:</strong> Novel situations arise constantly. No library is complete.<br>
          <strong>Hidden constraint revealed:</strong> Principles enable infinite patterns from finite rules.
        </div>
      </div>

      <div class="activity-item warstory" data-section="path">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">Overnight Migration: 500 Files</div>
        <div class="text-text-secondary text-sm">
          <strong>CONTEXT:</strong> Legacy codebase, 500 files needed pattern migration<br>
          <strong>DERIVED PATTERN:</strong> P1 (can't load all) + P5 (atomic batches) + P3 (fresh per batch) = Ralph loop with batch size 10<br>
          <strong>OUTCOME:</strong> 50 iterations overnight, all migrations complete<br>
          <strong>KEY LEARNING:</strong> Pattern was derived from principles, not found in any guide
        </div>
      </div>

      <div class="activity-item constraint" data-section="path">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="link-2" class="w-4 h-4"></i>
          Constraint Chain
        </div>
        <div class="font-medium text-text-primary mb-2">Derivation process as constraint satisfaction</div>
        <div class="text-text-secondary text-sm">
          <strong>ROOT:</strong> Novel situation with no existing pattern<br>
           Identify primary constraint<br>
           Map to relevant principles<br>
           Check principle conflicts<br>
           Combine mechanisms that serve multiple principles<br>
           Validate against original constraint<br><br>
          <em>The process IS the pattern.</em>
        </div>
      </div>

      <div class="activity-item frontier" data-section="path">
        <div class="activity-label" style="color: #ef4444;">
          <i data-lucide="flask-conical" class="w-4 h-4"></i>
          Research Frontier
        </div>
        <div class="font-medium text-text-primary mb-2">UNSOLVED: Automatic principle selection</div>
        <div class="text-text-secondary text-sm">
          <strong>THE QUESTION:</strong> Can an LLM automatically identify which principles apply to a novel situation?<br><br>
          <strong>WHY IT'S HARD:</strong> Requires understanding the constraint landscape. Principles interact in non-obvious ways.<br><br>
          <strong>CURRENT BEST PRACTICE:</strong> Human judgment selects principles. LLM helps implement.
        </div>
      </div>

      <!-- GOTCHAS SECTION -->
      <div class="activity-item effect" data-section="gotchas">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="bar-chart-2" class="w-4 h-4"></i>
          Second-Order Effect
        </div>
        <div class="font-medium text-text-primary mb-2">At scale, principle violations compound non-linearly</div>
        <div class="text-text-secondary text-sm">
          <strong>IMPLICATION:</strong> One violation at iteration 5 creates 2 problems by iteration 10, 4 by iteration 20. Violations don't add - they multiply.<br><br>
          <strong>THRESHOLD:</strong> >2 violations in first 10 iterations  expect failure by iteration 30<br><br>
          <em>This is why the checklist matters more for longer workflows.</em>
        </div>
      </div>

      <div class="activity-item tradeoff" data-section="gotchas">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="scale" class="w-4 h-4"></i>
          Trade-Off Tension
        </div>
        <div class="font-medium text-text-primary mb-2">The "feels inefficient" trap</div>
        <div class="text-text-secondary text-sm">
          <strong>Startup overhead:</strong> Feels wasteful at iteration 2<br>
          <strong>Quality gates:</strong> Feel slow at iteration 3<br>
          <strong>External state:</strong> Feels like busywork at iteration 4<br><br>
          <strong>WHY NO PERFECT ANSWER:</strong> Short-term efficiency vs long-term reliability<br><br>
          <em>Heuristic: If your workflow is < 5 iterations, optimize for speed. If > 10, optimize for principles.</em>
        </div>
      </div>

      <div class="activity-item expertise" data-section="gotchas">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
          Expertise Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">Recognizing principle violations</div>
        <div class="text-text-secondary text-sm">
          <strong>BEGINNER:</strong> "Something's wrong"  Knows there's a problem<br>
          <strong>INTERMEDIATE:</strong> "This symptom..."  Can identify the symptom<br>
          <strong>ADVANCED:</strong> "P3 is violated"  Can name the principle<br>
          <strong>STAFF:</strong> "P3+P5 together"  Can see compound violations<br>
          <strong>EXPERT:</strong> "This will fail at iteration 20"  Can predict failure timeline
        </div>
      </div>

      <!-- HARD SECTION -->
      <div class="activity-item tradeoff" data-section="hard">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="scale" class="w-4 h-4"></i>
          Trade-Off Tension
        </div>
        <div class="font-medium text-text-primary mb-2">The fundamental P1 vs P4 dilemma</div>
        <div class="text-text-secondary text-sm">
          <strong>THE DILEMMA:</strong><br>
          - Full separation (P4): Clean, but orchestrator overhead eats context (P1)<br>
          - No separation: Efficient, but role confusion and context pollution<br>
          - Partial separation: Middle ground, but where's the line?<br><br>
          <strong>WHY NO PERFECT ANSWER:</strong> Optimal depends on task complexity and context budget.<br><br>
          <em>Heuristic: Task graph > 3 nodes? Separate. Otherwise, don't.</em>
        </div>
      </div>

      <div class="activity-item horizon" data-section="hard">
        <div class="activity-label" style="color: #06b6d4;">
          <i data-lucide="clock" class="w-4 h-4"></i>
          Time Horizon Shift
        </div>
        <div class="font-medium text-text-primary mb-2">How P6 (quality gates) perception changes</div>
        <div class="text-text-secondary text-sm">
          <strong>Day 1:</strong> "Tests slow me down"<br>
          <strong>Week 1:</strong> "Debugging took longer than tests would have"<br>
          <strong>Month 1:</strong> "Tests ARE the speed"<br>
          <strong>Month 3:</strong> "I don't trust work without tests"<br><br>
          <em>The perceived "slowdown" inverts to perceived "speedup."</em>
        </div>
      </div>

      <div class="activity-item warstory" data-section="hard">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">Anthropic: False completion without verification</div>
        <div class="text-text-secondary text-sm">
          <strong>CONTEXT:</strong> Claude agents marking tasks complete without testing<br>
          <strong>OUTCOME:</strong> "Claude's tendency to mark features complete without proper testing"<br>
          <strong>KEY LEARNING:</strong> "Did much better at verifying end-to-end once explicitly prompted to use browser automation tools"<br><br>
          <em>P6 requires explicit enforcement. Agents won't self-verify without instruction.</em>
        </div>
      </div>

      <div class="activity-item inversion" data-section="hard">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if principles didn't conflict?</div>
        <div class="text-text-secondary text-sm">
          <strong>You'd have:</strong> Perfect recipes for every situation. No judgment needed.<br>
          <strong>Why this fails:</strong> Real constraints create real tradeoffs. Physics doesn't compromise.<br>
          <strong>Hidden constraint revealed:</strong> The tensions ARE the interesting problems. Eliminating them would eliminate the need for engineering judgment.
        </div>
      </div>

      <!-- WHEN SECTION (Quick Reference) -->
      <div class="activity-item minimal" data-section="when">
        <div class="activity-label" style="color: #84cc16;">
          <i data-lucide="minimize-2" class="w-4 h-4"></i>
          Minimal Pattern
        </div>
        <div class="font-medium text-text-primary mb-2">The minimal checklist</div>
        <div class="text-text-secondary text-sm">
          Before complex work, ask 3 questions:<br>
          1. Is state externalized? (P2)<br>
          2. Do tasks fit in one window? (P5)<br>
          3. Are there quality gates? (P6)<br><br>
          <em>If yes to all three, you've covered 80% of failure modes.</em>
        </div>
      </div>

      <div class="activity-item alternative" data-section="when">
        <div class="activity-label" style="color: #6b7280;">
          <i data-lucide="arrow-right" class="w-4 h-4"></i>
          Alternative Paths
        </div>
        <div class="font-medium text-text-primary mb-2">Related documents by need</div>
        <div class="text-text-secondary text-sm">
          <strong>Need anti-patterns?</strong><br>
           principles-anti-patterns.md<br><br>
          <strong>Need derivation examples?</strong><br>
           principles-derivation-guide.md<br><br>
          <strong>Need learning loops?</strong><br>
           principles-learning-loops.md<br><br>
          <strong>Need pattern implementations?</strong><br>
           mastery-ralph-complete.md, mastery-context-management.md
        </div>
      </div>

      <div class="activity-item invariant" data-section="when">
        <div class="activity-label" style="color: #3b82f6;">
          <i data-lucide="link" class="w-4 h-4"></i>
          Invariant Connection
        </div>
        <div class="font-medium text-text-primary mb-2">All synthesis documents share the 8 principles</div>
        <div class="text-text-secondary text-sm">
          <strong>WHY THIS MATTERS:</strong> Every document in /synthesis/ is either:<br>
          - Applying these principles (patterns, workflows)<br>
          - Extending these principles (combinations, frontier)<br>
          - Validating these principles (war stories, case studies)<br><br>
          <em>This document is the foundation. Everything else builds on it.</em>
        </div>
      </div>

      <div class="activity-item expertise" data-section="when">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
          Expertise Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">Where are you?</div>
        <div class="text-text-secondary text-sm">
          <strong>BEGINNER:</strong> "Which principle applies here?"<br>
          <strong>INTERMEDIATE:</strong> "These three principles apply"<br>
          <strong>ADVANCED:</strong> "P3 and P5 conflict here, prioritize P5"<br>
          <strong>STAFF:</strong> "I can derive a new pattern from principles"<br>
          <strong>EXPERT:</strong> "I can teach others to derive patterns"<br><br>
          <em>Self-assessment: What's the last pattern you derived?</em>
        </div>
      </div>

    </aside>
  </div>

  <script>
    /**
     * PanelResizer - Handles draggable panel dividers
     */
    class PanelResizer {
      constructor(resizerEl, config = {}) {
        this.resizer = resizerEl;
        this.config = {
          storageKey: 'panel-activity-zone-width',
          minWidth: 280,
          maxWidth: 900,
          defaultWidth: 480,
          ...config
        };

        this.isResizing = false;
        this.startX = 0;
        this.startWidth = 0;

        // Elements
        this.activityZone = document.querySelector('.activity-zone');
        this.mainContent = document.querySelector('.main-content');

        // Bind methods
        this.onMouseDown = this.onMouseDown.bind(this);
        this.onMouseMove = this.onMouseMove.bind(this);
        this.onMouseUp = this.onMouseUp.bind(this);

        this.init();
      }

      init() {
        this.restoreWidth();
        this.resizer.addEventListener('mousedown', this.onMouseDown);
      }

      onMouseDown(e) {
        if (e.button !== 0) return;

        this.isResizing = true;
        this.startX = e.clientX;
        this.startWidth = this.activityZone.offsetWidth;

        this.resizer.classList.add('active');
        document.body.classList.add('resizing');

        document.addEventListener('mousemove', this.onMouseMove);
        document.addEventListener('mouseup', this.onMouseUp);

        e.preventDefault();
      }

      onMouseMove(e) {
        if (!this.isResizing) return;

        const delta = this.startX - e.clientX;
        const newWidth = this.startWidth + delta;

        const constrainedWidth = Math.max(
          this.config.minWidth,
          Math.min(this.config.maxWidth, newWidth)
        );

        this.activityZone.style.width = constrainedWidth + 'px';
        this.mainContent.style.marginRight = constrainedWidth + 'px';
        this.resizer.style.right = constrainedWidth + 'px';
      }

      onMouseUp(e) {
        if (!this.isResizing) return;

        this.isResizing = false;

        this.resizer.classList.remove('active');
        document.body.classList.remove('resizing');

        document.removeEventListener('mousemove', this.onMouseMove);
        document.removeEventListener('mouseup', this.onMouseUp);

        this.saveWidth();
      }

      saveWidth() {
        const width = this.activityZone.offsetWidth;
        localStorage.setItem(this.config.storageKey, JSON.stringify({
          width,
          timestamp: Date.now()
        }));
      }

      restoreWidth() {
        try {
          const stored = localStorage.getItem(this.config.storageKey);
          if (stored) {
            const { width } = JSON.parse(stored);
            if (width >= this.config.minWidth && width <= this.config.maxWidth) {
              this.activityZone.style.width = width + 'px';
              this.mainContent.style.marginRight = width + 'px';
              this.resizer.style.right = width + 'px';
            }
          }
        } catch (e) {
          console.warn('Failed to restore panel width:', e);
        }
      }

      destroy() {
        this.resizer.removeEventListener('mousedown', this.onMouseDown);
        document.removeEventListener('mousemove', this.onMouseMove);
        document.removeEventListener('mouseup', this.onMouseUp);
      }
    }

    // Auto-initialize resizers on DOM ready
    document.addEventListener('DOMContentLoaded', () => {
      const resizers = document.querySelectorAll('[data-resizer]');
      resizers.forEach(resizer => new PanelResizer(resizer));
    });

    // Initialize Lucide icons
    lucide.createIcons();

    // Navigation toggle
    function toggleSection(header) {
      const section = header.closest('.nav-section');
      section.classList.toggle('expanded');
      const children = section.querySelector('.nav-children');
      children.classList.toggle('expanded');
    }

    // Mobile menu toggle
    function toggleMobileMenu() {
      const nav = document.getElementById('leftNav');
      nav.classList.toggle('open');
    }

    // Copy functionality
    function copyCode(btn, text) {
      navigator.clipboard.writeText(text).then(() => {
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i data-lucide="check" class="w-3 h-3"></i> Copied!';
        lucide.createIcons();
        setTimeout(() => {
          btn.innerHTML = originalText;
          lucide.createIcons();
        }, 2000);
      });
    }

    function copyCodeBlock(btn) {
      const codeBlock = btn.closest('.code-block');
      const pre = codeBlock.querySelector('pre');
      const text = pre.textContent;
      copyCode(btn, text);
    }

    // Scroll-sync with GSAP ScrollTrigger
    gsap.registerPlugin(ScrollTrigger);

    // Track which sections are in view
    const sections = document.querySelectorAll('[data-activity]');
    const activityItems = document.querySelectorAll('.activity-item');

    sections.forEach(section => {
      ScrollTrigger.create({
        trigger: section,
        start: 'top 40%',
        end: 'bottom 40%',
        onEnter: () => activateSection(section.dataset.activity),
        onEnterBack: () => activateSection(section.dataset.activity),
      });
    });

    function activateSection(sectionName) {
      activityItems.forEach(item => {
        if (item.dataset.section === sectionName) {
          item.classList.add('active');
          gsap.to(item, {
            opacity: 1,
            y: -2,
            boxShadow: '0 4px 12px rgba(0,0,0,0.08)',
            duration: 0.3,
            ease: 'power2.out'
          });
        } else {
          item.classList.remove('active');
          gsap.to(item, {
            opacity: 0.5,
            y: 0,
            boxShadow: 'none',
            duration: 0.3,
            ease: 'power2.out'
          });
        }
      });

      // Update nav active state
      document.querySelectorAll('.nav-section-header').forEach(header => {
        header.classList.remove('active');
      });
      const activeNav = document.querySelector(`[data-section="${sectionName}"] .nav-section-header`);
      if (activeNav) {
        activeNav.classList.add('active');
      }
    }

    // Initialize first section as active
    activateSection('essence');

    // Smooth scroll for nav links
    document.querySelectorAll('.nav-item').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const target = document.querySelector(link.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          document.querySelectorAll('.nav-item').forEach(l => l.classList.remove('active'));
          link.classList.add('active');
        }
      });
    });

    // Brushing interaction - hover activity item highlights related content
    activityItems.forEach(item => {
      item.addEventListener('mouseenter', () => {
        const sectionName = item.dataset.section;
        const relatedSection = document.querySelector(`[data-activity="${sectionName}"]`);
        if (relatedSection) {
          relatedSection.style.backgroundColor = 'rgba(13, 147, 115, 0.05)';
          relatedSection.style.transition = 'background-color 0.3s ease';
        }
      });

      item.addEventListener('mouseleave', () => {
        const sectionName = item.dataset.section;
        const relatedSection = document.querySelector(`[data-activity="${sectionName}"]`);
        if (relatedSection) {
          relatedSection.style.backgroundColor = '';
        }
      });
    });
  </script>
</body>
</html>
