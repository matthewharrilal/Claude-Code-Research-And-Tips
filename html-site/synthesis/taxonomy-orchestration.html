<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Orchestration Pattern Taxonomy | Claude Code Documentation</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Lucide Icons CDN -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- GSAP for scroll-sync -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

  <!-- Tailwind Config with Design Tokens -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'bg-base': '#ffffff',
            'bg-subtle': '#fafafa',
            'bg-muted': '#f4f4f5',
            'text-primary': '#18181b',
            'text-secondary': '#3f3f46',
            'text-muted': '#71717a',
            'accent': '#0D9373',
            'accent-light': '#10b981',
            'accent-bg': '#ecfdf5',
            'border': '#e4e4e7',
            // Activity Zone content type colors (Original 6)
            'az-invariant': '#3b82f6',    // Blue
            'az-effect': '#f59e0b',       // Amber
            'az-composition': '#8b5cf6',  // Purple
            'az-frontier': '#ef4444',     // Red
            'az-warstory': '#10b981',     // Green
            'az-alternative': '#6b7280',  // Gray
            // Activity Zone generative content types (New 10)
            'az-inversion': '#4f46e5',    // Indigo
            'az-constraint': '#8b5cf6',   // Violet
            'az-gradient': '#f43f5e',     // Rose
            'az-horizon': '#06b6d4',      // Cyan
            'az-violation': '#f97316',    // Orange
            'az-tradeoff': '#f59e0b',     // Amber
            'az-analogy': '#d946ef',      // Fuchsia
            'az-expertise': '#10b981',    // Emerald
            'az-minimal': '#84cc16',      // Lime
            'az-inflection': '#eab308',   // Yellow
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
            mono: ['Fira Code', 'monospace'],
          },
        },
      },
    }
  </script>

  <style>
    /* Base Styles */
    * {
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
      scroll-padding-top: 80px;
    }

    [id] {
      scroll-margin-top: 80px;
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: #ffffff;
      color: #18181b;
      line-height: 1.7;
    }

    /* Three Panel Layout */
    .three-panel-layout {
      min-height: 100vh;
      position: relative;
    }

    /* Header */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 56px;
      background: #ffffff;
      border-bottom: 1px solid #e4e4e7;
      z-index: 100;
      display: flex;
      align-items: center;
      padding: 0 24px;
    }

    /* Left Navigation - 240px fixed */
    .left-nav {
      position: fixed;
      top: 56px;
      left: 0;
      width: 240px;
      height: calc(100vh - 56px);
      border-right: 1px solid #e4e4e7;
      background: #ffffff;
      overflow-y: auto;
      padding: 16px 0;
      z-index: 40;
    }

    .nav-section {
      padding: 0 12px;
      margin-bottom: 8px;
    }

    .nav-section-header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      font-size: 14px;
      font-weight: 500;
      color: #3f3f46;
      cursor: pointer;
      border-radius: 6px;
      transition: background 0.15s;
    }

    .nav-section-header:hover {
      background: #f4f4f5;
    }

    .nav-section-header.active {
      color: #0D9373;
      background: #ecfdf5;
    }

    .nav-item {
      display: block;
      padding: 6px 12px 6px 44px;
      font-size: 14px;
      color: #71717a;
      text-decoration: none;
      border-radius: 6px;
      transition: all 0.15s;
    }

    .nav-item:hover {
      color: #3f3f46;
      background: #f4f4f5;
    }

    .nav-item.active {
      color: #0D9373;
      background: #ecfdf5;
    }

    .nav-children {
      display: none;
      overflow: hidden;
    }

    .nav-children.expanded {
      display: block;
    }

    .nav-chevron {
      transition: transform 0.2s;
    }

    .nav-section.expanded .nav-chevron {
      transform: rotate(90deg);
    }

    /* Main Content - Flexible, margins for fixed sidebars */
    .main-content {
      margin-left: 240px;
      margin-right: 480px;
      margin-top: 56px;
      padding: 48px 48px;
      min-width: 400px;
    }

    /* Activity Zone - 480px fixed */
    .activity-zone {
      position: fixed;
      top: 56px;
      right: 0;
      width: 480px;
      height: calc(100vh - 56px);
      border-left: 1px dashed #e4e4e7;
      background: #fafafa;
      overflow-y: auto;
      padding: 24px 20px;
      z-index: 40;
    }

    /* Responsive: Hide Activity Zone below 1400px */
    @media (max-width: 1400px) {
      .activity-zone {
        display: none;
      }
      .main-content {
        margin-right: 0;
        padding: 40px 32px;
      }
    }

    /* Responsive: Hide Left Nav below 768px */
    @media (max-width: 768px) {
      .left-nav {
        display: none;
      }
      .left-nav.open {
        display: block;
        position: fixed;
        top: 56px;
        left: 0;
        right: 0;
        bottom: 0;
        background: #ffffff;
        z-index: 50;
        overflow-y: auto;
      }
      .main-content {
        margin-left: 0;
        padding: 24px 16px;
        min-width: auto;
      }
    }

    /* Resizer */
    .resizer {
      position: fixed;
      top: 56px;
      right: 480px;
      width: 6px;
      height: calc(100vh - 56px);
      cursor: col-resize;
      background: transparent;
      z-index: 50;
      transition: background 0.15s ease;
    }

    .resizer:hover {
      background: rgba(13, 147, 115, 0.15);
    }

    .resizer.active {
      background: rgba(13, 147, 115, 0.25);
    }

    body.resizing {
      user-select: none;
      cursor: col-resize !important;
    }

    body.resizing * {
      cursor: col-resize !important;
    }

    @media (max-width: 1400px) {
      .resizer {
        display: none;
      }
    }

    /* Activity Zone Items */
    .activity-item {
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      background: #ffffff;
      border: 1px solid #e4e4e7;
      font-size: 14px;
      line-height: 1.6;
      opacity: 0.5;
      transition: all 0.3s ease;
    }

    .activity-item.active {
      opacity: 1;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .activity-item:hover {
      opacity: 1;
    }

    .activity-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    /* Activity Zone content type borders */
    .activity-item.invariant { border-left: 4px solid #3b82f6; }
    .activity-item.effect { border-left: 4px solid #f59e0b; }
    .activity-item.composition { border-left: 4px solid #8b5cf6; }
    .activity-item.frontier { border-left: 4px solid #ef4444; }
    .activity-item.warstory { border-left: 4px solid #10b981; }
    .activity-item.alternative { border-left: 4px solid #6b7280; }
    .activity-item.inversion { border-left: 4px solid #4f46e5; }
    .activity-item.constraint { border-left: 4px solid #8b5cf6; }
    .activity-item.gradient { border-left: 4px solid #f43f5e; }
    .activity-item.horizon { border-left: 4px solid #06b6d4; }
    .activity-item.violation { border-left: 4px solid #f97316; }
    .activity-item.tradeoff { border-left: 4px solid #f59e0b; }
    .activity-item.analogy { border-left: 4px solid #d946ef; }
    .activity-item.expertise { border-left: 4px solid #10b981; }
    .activity-item.minimal { border-left: 4px solid #84cc16; }
    .activity-item.inflection { border-left: 4px solid #eab308; }

    /* Main Content Components */
    .section-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      background: #0D9373;
      color: #ffffff;
      font-size: 14px;
      font-weight: 600;
      border-radius: 50%;
      margin-right: 12px;
    }

    .section-title {
      font-size: 24px;
      font-weight: 600;
      color: #18181b;
      margin-bottom: 20px;
      margin-top: 56px;
      display: flex;
      align-items: center;
    }

    .section-title:first-child {
      margin-top: 0;
    }

    /* Essence Box */
    .essence-box {
      background: linear-gradient(135deg, #18181b 0%, #27272a 100%);
      border-radius: 12px;
      padding: 32px;
      margin-bottom: 40px;
    }

    .essence-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #10b981;
      margin-bottom: 12px;
    }

    .essence-text {
      font-size: 22px;
      font-weight: 500;
      color: #ffffff;
      line-height: 1.4;
    }

    /* Core Abstraction Box */
    .core-abstraction {
      background: #fafafa;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 40px;
    }

    .core-philosophy {
      font-size: 16px;
      color: #3f3f46;
      margin-bottom: 16px;
      font-style: italic;
    }

    .core-code {
      background: #18181b;
      border-radius: 8px;
      padding: 16px 20px;
      margin-bottom: 16px;
      overflow-x: auto;
    }

    .core-code code {
      font-family: 'Fira Code', monospace;
      font-size: 15px;
      color: #10b981;
      white-space: nowrap;
    }

    .core-anchor {
      font-size: 14px;
      color: #71717a;
      text-align: center;
    }

    /* Decision Box */
    .decision-box {
      background: #ffffff;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
    }

    .decision-why {
      font-size: 16px;
      font-weight: 600;
      color: #0D9373;
      margin-bottom: 12px;
    }

    .decision-reasoning {
      font-size: 14px;
      color: #3f3f46;
      margin-bottom: 16px;
    }

    .decision-implication {
      background: #f4f4f5;
      border-radius: 8px;
      padding: 16px;
    }

    .decision-implication-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      color: #71717a;
      margin-bottom: 8px;
    }

    /* Code Blocks */
    .code-block {
      background: #18181b;
      border-radius: 8px;
      padding: 16px 20px;
      margin-bottom: 24px;
      position: relative;
      overflow-x: auto;
    }

    .code-block pre {
      margin: 0;
      font-family: 'Fira Code', monospace;
      font-size: 13px;
      color: #e4e4e7;
      line-height: 1.6;
    }

    .code-block .comment { color: #6b7280; }
    .code-block .keyword { color: #c084fc; }
    .code-block .string { color: #10b981; }
    .code-block .variable { color: #60a5fa; }

    .copy-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: #3f3f46;
      color: #ffffff;
      border: none;
      border-radius: 4px;
      padding: 6px 10px;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: background 0.15s;
    }

    .copy-btn:hover {
      background: #52525b;
    }

    /* Pattern Card */
    .pattern-card {
      background: #ffffff;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
    }

    .pattern-card-title {
      font-size: 18px;
      font-weight: 600;
      color: #18181b;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .pattern-card-source {
      font-size: 12px;
      color: #71717a;
      margin-bottom: 12px;
    }

    .pattern-card-description {
      font-size: 14px;
      color: #3f3f46;
      margin-bottom: 16px;
    }

    .pattern-card-best-for {
      background: #ecfdf5;
      border-radius: 6px;
      padding: 12px;
      font-size: 13px;
      color: #166534;
    }

    /* Taxonomy Table */
    .taxonomy-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 24px;
      font-size: 14px;
    }

    .taxonomy-table th {
      background: #f4f4f5;
      padding: 12px 16px;
      text-align: left;
      font-weight: 600;
      color: #3f3f46;
      border-bottom: 2px solid #e4e4e7;
    }

    .taxonomy-table td {
      padding: 12px 16px;
      border-bottom: 1px solid #e4e4e7;
      color: #3f3f46;
    }

    .taxonomy-table tr:hover {
      background: #fafafa;
    }

    .taxonomy-table code {
      background: #f4f4f5;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 12px;
    }

    /* Path Steps */
    .path-container {
      background: #fafafa;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 40px;
    }

    .path-step {
      display: flex;
      gap: 16px;
      margin-bottom: 16px;
    }

    .path-step:last-child {
      margin-bottom: 0;
    }

    .path-number {
      flex-shrink: 0;
      width: 24px;
      height: 24px;
      background: #0D9373;
      color: #ffffff;
      font-size: 12px;
      font-weight: 600;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .path-content {
      flex: 1;
      font-size: 14px;
      color: #3f3f46;
    }

    .path-content code {
      background: #e4e4e7;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 13px;
    }

    /* Gotcha Box */
    .gotcha-box {
      background: #fffbeb;
      border: 1px solid #fcd34d;
      border-left: 4px solid #f59e0b;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .gotcha-title {
      font-weight: 600;
      color: #92400e;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .gotcha-detail {
      font-size: 14px;
      color: #78350f;
      margin-bottom: 8px;
    }

    .gotcha-detail strong {
      color: #92400e;
    }

    /* What's Hard Box */
    .hard-box {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-left: 4px solid #ef4444;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .hard-title {
      font-weight: 600;
      color: #991b1b;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .hard-detail {
      font-size: 14px;
      color: #7f1d1d;
      margin-bottom: 8px;
    }

    /* When To Use Grid */
    .when-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 40px;
    }

    @media (max-width: 900px) {
      .when-grid {
        grid-template-columns: 1fr;
      }
    }

    .when-use {
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      border-radius: 12px;
      padding: 24px;
    }

    .when-not {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: 12px;
      padding: 24px;
    }

    .when-title {
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .when-use .when-title { color: #166534; }
    .when-not .when-title { color: #991b1b; }

    .when-item {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      font-size: 14px;
    }

    .when-use .when-item { color: #166534; }
    .when-not .when-item { color: #991b1b; }

    /* Architecture Diagram */
    .architecture-diagram {
      background: #18181b;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      overflow-x: auto;
    }

    .architecture-diagram pre {
      margin: 0;
      font-family: 'Fira Code', monospace;
      font-size: 12px;
      color: #a1a1aa;
      line-height: 1.5;
    }

    /* Relationship Map */
    .relationship-box {
      background: #fafafa;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .relationship-title {
      font-size: 16px;
      font-weight: 600;
      color: #18181b;
      margin-bottom: 16px;
    }

    /* Mobile Menu Button */
    .mobile-menu-btn {
      display: none;
      padding: 8px;
      background: none;
      border: none;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .mobile-menu-btn {
        display: flex;
      }
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: #fafafa;
    }

    ::-webkit-scrollbar-thumb {
      background: #d4d4d8;
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #a1a1aa;
    }

    /* Keyboard shortcut hint */
    .kbd {
      display: inline-flex;
      align-items: center;
      padding: 2px 6px;
      background: #f4f4f5;
      border: 1px solid #e4e4e7;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 12px;
      color: #71717a;
    }

    /* Subsection title */
    .subsection-title {
      font-size: 18px;
      font-weight: 600;
      color: #18181b;
      margin-top: 32px;
      margin-bottom: 16px;
      padding-bottom: 8px;
      border-bottom: 1px solid #e4e4e7;
    }

    /* Pattern Badge */
    .pattern-badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 9999px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .pattern-badge.loop { background: #dbeafe; color: #1e40af; }
    .pattern-badge.multi { background: #f3e8ff; color: #7c3aed; }
    .pattern-badge.isolation { background: #dcfce7; color: #166534; }
    .pattern-badge.communication { background: #fef3c7; color: #92400e; }
    .pattern-badge.architecture { background: #fce7f3; color: #9d174d; }
    .pattern-badge.memory { background: #e0e7ff; color: #4338ca; }
    .pattern-badge.verification { background: #ccfbf1; color: #0f766e; }
    .pattern-badge.monitoring { background: #fef9c3; color: #854d0e; }
    .pattern-badge.recovery { background: #fee2e2; color: #991b1b; }
    .pattern-badge.resource { background: #f1f5f9; color: #475569; }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle menu">
      <i data-lucide="menu" class="w-5 h-5 text-text-secondary"></i>
    </button>
    <div class="flex items-center gap-3">
      <i data-lucide="network" class="w-5 h-5 text-accent"></i>
      <span class="font-semibold text-text-primary">Claude Code</span>
    </div>
    <div class="flex-1 flex justify-center">
      <button class="flex items-center gap-2 px-4 py-2 bg-bg-muted rounded-lg text-text-muted text-sm hover:bg-border transition-colors">
        <i data-lucide="search" class="w-4 h-4"></i>
        <span>Search documentation...</span>
        <span class="kbd">Cmd+K</span>
      </button>
    </div>
    <div class="flex items-center gap-4">
      <a href="#" class="text-sm text-text-muted hover:text-text-primary transition-colors">Support</a>
      <button class="p-2 hover:bg-bg-muted rounded-lg transition-colors" aria-label="Toggle theme">
        <i data-lucide="sun" class="w-4 h-4 text-text-muted"></i>
      </button>
    </div>
  </header>

  <div class="three-panel-layout">
    <!-- Left Navigation -->
    <nav class="left-nav" id="leftNav">
      <div class="px-4 mb-4">
        <span class="text-xs font-semibold text-text-muted uppercase tracking-wider">Orchestration Taxonomy</span>
      </div>

      <!-- Essence -->
      <div class="nav-section expanded" data-section="essence">
        <div class="nav-section-header active" onclick="toggleSection(this)">
          <i data-lucide="zap" class="w-4 h-4"></i>
          <span>Essence</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#essence" class="nav-item active">The 15-Word Summary</a>
        </div>
      </div>

      <!-- Core Abstraction -->
      <div class="nav-section expanded" data-section="core">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="box" class="w-4 h-4"></i>
          <span>Core Taxonomy</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#core-abstraction" class="nav-item">The 10 Categories</a>
        </div>
      </div>

      <!-- Loop-Based Patterns -->
      <div class="nav-section expanded" data-section="loops">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="repeat" class="w-4 h-4"></i>
          <span>Loop Patterns</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#ralph-core" class="nav-item">Ralph Wiggum Core</a>
          <a href="#ralph-variants" class="nav-item">6 Ralph Variants</a>
        </div>
      </div>

      <!-- Multi-Agent Patterns -->
      <div class="nav-section" data-section="multiagent">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="users" class="w-4 h-4"></i>
          <span>Multi-Agent</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#panopticon" class="nav-item">Personal Panopticon</a>
          <a href="#cc-mirror" class="nav-item">CC Mirror</a>
          <a href="#gas-town" class="nav-item">Gas Town</a>
        </div>
      </div>

      <!-- Architecture Patterns -->
      <div class="nav-section" data-section="architecture">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="layers" class="w-4 h-4"></i>
          <span>Architecture</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#hub-spoke" class="nav-item">Hub-and-Spoke</a>
          <a href="#peer-to-peer" class="nav-item">Peer-to-Peer</a>
          <a href="#factory" class="nav-item">Factory Pattern</a>
        </div>
      </div>

      <!-- Support Patterns -->
      <div class="nav-section" data-section="support">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="wrench" class="w-4 h-4"></i>
          <span>Support Patterns</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#communication" class="nav-item">Communication</a>
          <a href="#memory" class="nav-item">Memory</a>
          <a href="#verification" class="nav-item">Verification</a>
        </div>
      </div>

      <!-- Gotchas -->
      <div class="nav-section" data-section="gotchas">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="alert-triangle" class="w-4 h-4"></i>
          <span>Gotchas</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#gotchas" class="nav-item">Common Pitfalls</a>
        </div>
      </div>

      <!-- What's Hard -->
      <div class="nav-section" data-section="hard">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="flame" class="w-4 h-4"></i>
          <span>What's Hard</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#hard" class="nav-item">Fundamental Tensions</a>
        </div>
      </div>

      <!-- Pattern Selection -->
      <div class="nav-section" data-section="selection">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="check-circle" class="w-4 h-4"></i>
          <span>Pattern Selection</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#selection" class="nav-item">Decision Guide</a>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">

      <!-- Section 1: ESSENCE -->
      <section id="essence" data-activity="essence">
        <div class="essence-box">
          <div class="essence-label">Essence (15 words)</div>
          <div class="essence-text">Ten pattern categories enable AI orchestration from single loops to factory-scale autonomous systems.</div>
        </div>
      </section>

      <!-- Section 2: CORE TAXONOMY -->
      <section id="core-abstraction" data-activity="core">
        <h2 class="section-title">
          <span class="section-number">2</span>
          The 10-Category Orchestration Taxonomy
        </h2>

        <div class="core-abstraction">
          <div class="core-philosophy">"Every orchestration pattern is a bet on where to put state and who coordinates work."</div>

          <table class="taxonomy-table" style="margin-top: 20px;">
            <thead>
              <tr>
                <th>Category</th>
                <th>Patterns</th>
                <th>Core Concern</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><span class="pattern-badge loop">Loop</span></td>
                <td>Ralph, Compounding Ralph, Dr. Ralph, Lisa, Zeroshot, Kanban</td>
                <td>Fresh context iteration</td>
              </tr>
              <tr>
                <td><span class="pattern-badge multi">Multi-Agent</span></td>
                <td>Panopticon, CC Mirror, Gas Town, Orchestra, AI-Maestro</td>
                <td>Parallel coordination</td>
              </tr>
              <tr>
                <td><span class="pattern-badge isolation">Isolation</span></td>
                <td>Domain isolation, Branch-based, Git worktree, Directory ownership</td>
                <td>Conflict prevention</td>
              </tr>
              <tr>
                <td><span class="pattern-badge communication">Communication</span></td>
                <td>File handoffs, Git handoffs, Docker volumes, MCP Agent Mail, FIFO pipes</td>
                <td>Agent messaging</td>
              </tr>
              <tr>
                <td><span class="pattern-badge architecture">Architecture</span></td>
                <td>Hub-and-Spoke, Peer-to-Peer, Factory</td>
                <td>Structural topology</td>
              </tr>
              <tr>
                <td><span class="pattern-badge memory">Memory</span></td>
                <td>Hierarchical, Dynamic imports, Artifact-based, Agent-specific context</td>
                <td>State persistence</td>
              </tr>
              <tr>
                <td><span class="pattern-badge verification">Verification</span></td>
                <td>CI Green, Browser automation, Multi-phase, Cross-agent</td>
                <td>Quality gates</td>
              </tr>
              <tr>
                <td><span class="pattern-badge monitoring">Monitoring</span></td>
                <td>Claude HUD, rpai, Health metrics, Distributed tracing, Anomaly detection</td>
                <td>Observability</td>
              </tr>
              <tr>
                <td><span class="pattern-badge recovery">Recovery</span></td>
                <td>Checkpointing, Graceful degradation, Dead letter queue, Circuit breaker</td>
                <td>Failure handling</td>
              </tr>
              <tr>
                <td><span class="pattern-badge resource">Resource</span></td>
                <td>Model selection, Task queues, Auto-scaling, Caching, Token tracking</td>
                <td>Cost optimization</td>
              </tr>
            </tbody>
          </table>

          <div class="core-anchor">10 categories. 50+ patterns. One cohesive system for AI orchestration.</div>
        </div>

        <p class="text-text-secondary mb-6">
          This taxonomy organizes every known orchestration pattern into 10 categories based on the problem they solve. Most production systems combine patterns from 3-5 categories. The key insight: patterns in one category often require supporting patterns from others.
        </p>
      </section>

      <!-- Section 3: LOOP-BASED PATTERNS -->
      <section id="ralph-core" data-activity="loops">
        <h2 class="section-title">
          <span class="section-number">3</span>
          Loop-Based Patterns
        </h2>

        <p class="text-text-secondary mb-6">
          Loop patterns run Claude repeatedly with fresh context until a completion condition is met. This is the foundational category—most autonomous systems are loops at their core.
        </p>

        <div class="pattern-card">
          <div class="pattern-card-title">
            <span class="pattern-badge loop">Loop</span>
            Ralph Wiggum (Core Pattern)
          </div>
          <div class="pattern-card-source">Source: Geoffrey Huntley (ghuntley.com/ralph) | Popularized by: @mattpocockuk, @ryancarson</div>
          <div class="pattern-card-description">
            A bash loop that runs Claude Code repeatedly with fresh context until a completion condition is met. Each iteration gets a clean slate but has access to git history and file-based memory.
          </div>

          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre><span class="keyword">for</span> (( i=1; i<=$MAX_ITERATIONS; i++ )); <span class="keyword">do</span>
  claude <span class="string">"Review prd.json... If complete, output PROMISE COMPLETE HERE"</span>
  <span class="keyword">if</span> grep -q <span class="string">"PROMISE COMPLETE HERE"</span> output.txt; <span class="keyword">then</span> <span class="keyword">break</span>; <span class="keyword">fi</span>
<span class="keyword">done</span></pre>
          </div>

          <div class="pattern-card-best-for">
            <strong>Best For:</strong> Overnight feature shipping, autonomous development pipelines, tasks with verifiable completion criteria
          </div>
        </div>

        <h3 class="subsection-title" id="ralph-variants">The 6 Ralph Variants</h3>

        <table class="taxonomy-table">
          <thead>
            <tr>
              <th>Variant</th>
              <th>Source</th>
              <th>Key Enhancement</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Compounding Ralph</strong></td>
              <td>@ryancarson</td>
              <td>References archived PRDs and learnings for cross-session compounding</td>
            </tr>
            <tr>
              <td><strong>Marathon Ralph</strong></td>
              <td>@stephen_rayner</td>
              <td>Extended Ralph for building entire apps with full SDLC methodology</td>
            </tr>
            <tr>
              <td><strong>Dr. Ralph</strong></td>
              <td>@MikeEndale</td>
              <td>Multi-phase with 80%+ confidence thresholds before advancing</td>
            </tr>
            <tr>
              <td><strong>Lisa</strong></td>
              <td>@petruarakiss</td>
              <td>Enhanced logging and progress tracking capabilities</td>
            </tr>
            <tr>
              <td><strong>Zeroshot</strong></td>
              <td>@Eivind1384955</td>
              <td>Streamlined "next gen" execution</td>
            </tr>
            <tr>
              <td><strong>Kanban Loop</strong></td>
              <td>Derived</td>
              <td>Single agent picks from task board until empty</td>
            </tr>
          </tbody>
        </table>

        <div class="decision-box">
          <div class="decision-why">WHY FRESH CONTEXT PER ITERATION?</div>
          <div class="decision-reasoning">
            At 80K tokens, Claude's quality degrades—instructions get lost, contradictions appear. This "context rot" is transformer physics, not a bug. Fresh context beats accumulated context because you get peak quality every iteration.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Accept that each iteration "forgets" the previous. If you need memory, persist it in files (progress.txt, prd.json). If quality drops in late iterations, restart—don't debug.
            </div>
          </div>
        </div>

        <div class="decision-box">
          <div class="decision-why">WHY EXTERNAL STATE (FILES)?</div>
          <div class="decision-reasoning">
            If each iteration is a fresh Claude with no memory, progress must persist externally. Git commits, prd.json (task tracking), and progress.txt (learnings) form the "database" that survives restarts.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              If it's not in a file, it doesn't exist. Every learning must be written to progress.txt. Every status change must update prd.json. Git history is your audit trail.
            </div>
          </div>
        </div>
      </section>

      <!-- Section 4: MULTI-AGENT PATTERNS -->
      <section id="panopticon" data-activity="multiagent">
        <h2 class="section-title">
          <span class="section-number">4</span>
          Multi-Agent Patterns
        </h2>

        <p class="text-text-secondary mb-6">
          Multi-agent patterns coordinate multiple Claude instances working in parallel. This is where orchestration gets interesting—and complex.
        </p>

        <div class="pattern-card">
          <div class="pattern-card-title">
            <span class="pattern-badge multi">Multi</span>
            Personal Panopticon
          </div>
          <div class="pattern-card-source">Source: @mollycantillon</div>
          <div class="pattern-card-description">
            Run 8+ parallel isolated Claude Code instances, each owning a life/work domain. Achieve "self-legibility" across all personal data through domain specialization.
          </div>

          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre><span class="comment"># Each terminal is an isolated domain</span>
~/nox        <span class="comment"># Company/product</span>
~/metrics    <span class="comment"># Analytics/data</span>
~/email      <span class="comment"># Communications</span>
~/growth     <span class="comment"># Marketing/acquisition</span>
~/trades     <span class="comment"># Personal finance</span>
~/health     <span class="comment"># Fitness/wellness</span>
~/writing    <span class="comment"># Content creation</span>
~/personal   <span class="comment"># Life admin</span></pre>
          </div>

          <div class="pattern-card-best-for">
            <strong>Best For:</strong> Managing multiple life domains, founders/solopreneurs, "personal surveillance reversal"
          </div>
        </div>

        <div class="pattern-card" id="cc-mirror">
          <div class="pattern-card-title">
            <span class="pattern-badge multi">Multi</span>
            CC Mirror (Hub-and-Spoke Orchestration)
          </div>
          <div class="pattern-card-source">Source: @nummanali | Repo: github.com/numman-ali/cc-mirror</div>
          <div class="pattern-card-description">
            Central orchestrator that delegates to specialized worker agents, never touching code directly. The orchestrator is the CONDUCTOR—agents play the instruments.
          </div>

          <div class="architecture-diagram">
            <pre>
╔═══════════════════════════════════════════════════════════════╗
║  YOU DO NOT WRITE CODE. YOU DO NOT RUN COMMANDS.              ║
║  YOU DO NOT EXPLORE CODEBASES.                                ║
║  You are the CONDUCTOR. Your agents play the instruments.     ║
╚═══════════════════════════════════════════════════════════════╝

Tool Ownership:
┌─────────────┬─────────────────────────────────────────────────┐
│ Orchestrator│ Read (1-2 files), Task*, AskUserQuestion        │
├─────────────┼─────────────────────────────────────────────────┤
│ Workers     │ Read, Write, Edit, Bash, Glob, Grep, WebFetch   │
└─────────────┴─────────────────────────────────────────────────┘</pre>
          </div>

          <div class="pattern-card-best-for">
            <strong>Best For:</strong> Production apps with dependencies, task dependency management, clear separation of concerns
          </div>
        </div>

        <div class="pattern-card" id="gas-town">
          <div class="pattern-card-title">
            <span class="pattern-badge multi">Multi</span>
            Gas Town (Agent Factory)
          </div>
          <div class="pattern-card-source">Source: @steve_yegge | Repo: github.com/steveyegge/gastown</div>
          <div class="pattern-card-description">
            Not just agents, but an agent FACTORY with specialized roles and town-level coordination. "You just make up features, design them, file the implementation plans, and sling work around to your polecats and crew."
          </div>

          <div class="architecture-diagram">
            <pre>
Gas Town (~/.gt)
├── HQ (town-level management)
├── Rigs (project repos)
│   └── Witness (per-rig observer)
├── Workers
│   ├── Mayor (town coordination)
│   ├── Deacon (monitoring/handshakes)
│   ├── Dogs (quality gates)
│   ├── Refinery (task decomposition)
│   ├── Polecat (named persistent workers)
│   └── Crew (ephemeral workers)
└── Overseer (YOU - human with inbox)</pre>
          </div>

          <table class="taxonomy-table">
            <thead>
              <tr>
                <th>Role</th>
                <th>Purpose</th>
              </tr>
            </thead>
            <tbody>
              <tr><td><strong>Mayor</strong></td><td>Town-wide coordination</td></tr>
              <tr><td><strong>Deacon</strong></td><td>Monitoring and handshakes between agents</td></tr>
              <tr><td><strong>Dogs</strong></td><td>Quality gates and watchdogs</td></tr>
              <tr><td><strong>Refinery</strong></td><td>Task decomposition</td></tr>
              <tr><td><strong>Polecat</strong></td><td>Named persistent workers</td></tr>
              <tr><td><strong>Crew</strong></td><td>Ephemeral workers</td></tr>
            </tbody>
          </table>

          <div class="pattern-card-best-for">
            <strong>Best For:</strong> Massive scale (10+ agents), Stage 7+ dev evolution, significant budget, tmux proficiency
          </div>
        </div>

        <h3 class="subsection-title">Other Multi-Agent Patterns</h3>

        <table class="taxonomy-table">
          <thead>
            <tr>
              <th>Pattern</th>
              <th>Source</th>
              <th>Core Mechanism</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Infinite Orchestra</strong></td>
              <td>@0xSero</td>
              <td>Self-improving orchestrator in Docker with worker profiles</td>
            </tr>
            <tr>
              <td><strong>Parallel Task Executor</strong></td>
              <td>@LLMJunky</td>
              <td>Parse plan, extract tasks, execute in parallel subagents</td>
            </tr>
            <tr>
              <td><strong>AI-Maestro</strong></td>
              <td>Community</td>
              <td>Container-isolated parallelism with shared Docker volumes</td>
            </tr>
            <tr>
              <td><strong>Adversarial Speccing</strong></td>
              <td>CC Mirror derived</td>
              <td>Two subagents debate: Architect proposes, Critic challenges</td>
            </tr>
            <tr>
              <td><strong>AutoGen-Style Group Chat</strong></td>
              <td>Microsoft adapted</td>
              <td>Multiple agents share conversation, taking turns</td>
            </tr>
            <tr>
              <td><strong>LangGraph State Machine</strong></td>
              <td>LangGraph adapted</td>
              <td>Multi-agent workflows as explicit state machines</td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- Section 5: ARCHITECTURE PATTERNS -->
      <section id="hub-spoke" data-activity="architecture">
        <h2 class="section-title">
          <span class="section-number">5</span>
          Architecture Patterns
        </h2>

        <p class="text-text-secondary mb-6">
          Architecture patterns define the structural topology of multi-agent systems. Your choice here determines coordination overhead, failure modes, and scalability limits.
        </p>

        <div class="pattern-card">
          <div class="pattern-card-title">
            <span class="pattern-badge architecture">Architecture</span>
            Hub-and-Spoke
          </div>
          <div class="pattern-card-description">
            Central orchestrator delegates to specialized workers. Clear hierarchy, predictable workflow, centralized monitoring.
          </div>

          <div class="architecture-diagram">
            <pre>
         ┌─────────────────┐
         │   Orchestrator  │
         └────────┬────────┘
                  │
    ┌─────────────┼─────────────┐
    │             │             │
    ▼             ▼             ▼
┌───────┐   ┌───────┐   ┌───────┐
│ Coder │   │ Tester│   │ Docs  │
└───────┘   └───────┘   └───────┘</pre>
          </div>

          <div class="pattern-card-best-for">
            <strong>Best For:</strong> Clear task decomposition, predictable workflow, centralized monitoring<br>
            <strong>Examples:</strong> CC Mirror, Gas Town (Deacon role)
          </div>
        </div>

        <div class="pattern-card" id="peer-to-peer">
          <div class="pattern-card-title">
            <span class="pattern-badge architecture">Architecture</span>
            Peer-to-Peer
          </div>
          <div class="pattern-card-description">
            Agents communicate directly without central coordinator. Emergent collaboration, flexible workflows, resilient to single points of failure.
          </div>

          <div class="architecture-diagram">
            <pre>
┌───────┐     ┌───────┐
│Agent 1│◀───►│Agent 2│
└───────┘     └───────┘
    ▲             ▲
    └──────┬──────┘
           ▼
      ┌───────┐
      │Agent 3│
      └───────┘</pre>
          </div>

          <div class="pattern-card-best-for">
            <strong>Best For:</strong> Emergent collaboration, flexible workflows, resilience<br>
            <strong>Challenges:</strong> Harder to monitor, potential for deadlocks
          </div>
        </div>

        <div class="pattern-card" id="factory">
          <div class="pattern-card-title">
            <span class="pattern-badge architecture">Architecture</span>
            Factory Pattern
          </div>
          <div class="pattern-card-description">
            Not just agents, but an agent FACTORY that produces specialized workers on demand. Named persistent workers (Polecats) + ephemeral workers (Crew) + role-based specialization.
          </div>

          <div class="pattern-card-best-for">
            <strong>Best For:</strong> Massive scale, dynamic workloads, teams that need to spawn agents programmatically<br>
            <strong>Example:</strong> Gas Town
          </div>
        </div>
      </section>

      <!-- Section 6: SUPPORT PATTERNS -->
      <section id="communication" data-activity="support">
        <h2 class="section-title">
          <span class="section-number">6</span>
          Support Patterns
        </h2>

        <p class="text-text-secondary mb-6">
          Support patterns provide the infrastructure for orchestration: how agents communicate, remember, verify, and recover.
        </p>

        <h3 class="subsection-title">Communication Patterns</h3>

        <table class="taxonomy-table">
          <thead>
            <tr>
              <th>Pattern</th>
              <th>Mechanism</th>
              <th>Best For</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>File-Based Handoffs</strong></td>
              <td><code>handoff-agent1-to-agent2.json</code> with context</td>
              <td>Simple async coordination</td>
            </tr>
            <tr>
              <td><strong>Git-Based Handoffs</strong></td>
              <td>progress.txt, prd.json, git commits</td>
              <td>Ralph pattern, audit trail</td>
            </tr>
            <tr>
              <td><strong>Docker Volume Handoffs</strong></td>
              <td>Shared volume for message passing</td>
              <td>Container-isolated agents</td>
            </tr>
            <tr>
              <td><strong>MCP Agent Mail</strong></td>
              <td>Email-like interface for agent collaboration</td>
              <td>Natural "agent village" behavior</td>
            </tr>
            <tr>
              <td><strong>FIFO Pipes</strong></td>
              <td><code>mkfifo</code> for real-time messaging</td>
              <td>Low-latency coordination</td>
            </tr>
            <tr>
              <td><strong>Event Bus</strong></td>
              <td>File-based events: <code>task-complete-*.json</code></td>
              <td>Event-driven architecture</td>
            </tr>
            <tr>
              <td><strong>Consensus Protocol</strong></td>
              <td>Proposals, voting, 66% threshold</td>
              <td>Multi-agent decisions</td>
            </tr>
          </tbody>
        </table>

        <h3 class="subsection-title" id="memory">Memory Patterns</h3>

        <div class="pattern-card">
          <div class="pattern-card-title">
            <span class="pattern-badge memory">Memory</span>
            Hierarchical Memory Architecture
          </div>
          <div class="pattern-card-description">
            4-layer memory hierarchy from enterprise policy down to agent-specific context.
          </div>

          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre><span class="comment"># Layer 1: Enterprise Policy</span>
/Library/Application Support/ClaudeCode/CLAUDE.md
<span class="comment"># Organization-wide security policies, compliance</span>

<span class="comment"># Layer 2: Project Memory</span>
./CLAUDE.md <span class="keyword">or</span> ./.claude/CLAUDE.md
<span class="comment"># Architecture decisions, coding standards</span>

<span class="comment"># Layer 3: Modular Rules</span>
./.claude/rules/*.md
<span class="comment"># Path-specific rules with frontmatter targeting</span>

<span class="comment"># Layer 4: Personal + Local</span>
~/.claude/CLAUDE.md    <span class="comment"># User global</span>
./CLAUDE.local.md      <span class="comment"># Project local, gitignored</span></pre>
          </div>
        </div>

        <h3 class="subsection-title" id="verification">Verification Patterns</h3>

        <table class="taxonomy-table">
          <thead>
            <tr>
              <th>Pattern</th>
              <th>Mechanism</th>
              <th>When to Use</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>CI Green Enforcement</strong></td>
              <td>Tests + types must pass every commit</td>
              <td>Every Ralph iteration</td>
            </tr>
            <tr>
              <td><strong>Browser Automation</strong></td>
              <td>Playwright MCP for UI verification</td>
              <td>UI stories</td>
            </tr>
            <tr>
              <td><strong>Multi-Phase Protocol</strong></td>
              <td>80%+ confidence before advancing phases</td>
              <td>Dr. Ralph variant</td>
            </tr>
            <tr>
              <td><strong>Cross-Agent Verification</strong></td>
              <td>Integration tests after multi-agent merge</td>
              <td>Parallel development</td>
            </tr>
          </tbody>
        </table>

        <h3 class="subsection-title">Monitoring Patterns</h3>

        <table class="taxonomy-table">
          <thead>
            <tr>
              <th>Tool</th>
              <th>Features</th>
              <th>Source</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Claude HUD</strong></td>
              <td>Context remaining, tool execution, subagent status, todo progress</td>
              <td>@jarrodwatts</td>
            </tr>
            <tr>
              <td><strong>rpai</strong></td>
              <td>tmux multi-agent manager with TUI</td>
              <td>@radoslav11</td>
            </tr>
            <tr>
              <td><strong>Agent Health Metrics</strong></td>
              <td>Heartbeat, context usage, tokens, errors, git state</td>
              <td>Advanced patterns</td>
            </tr>
            <tr>
              <td><strong>Distributed Tracing</strong></td>
              <td>Trace context propagation with span tracking</td>
              <td>Advanced patterns</td>
            </tr>
            <tr>
              <td><strong>Anomaly Detection</strong></td>
              <td>Resource, behavioral, coordination anomalies</td>
              <td>Advanced patterns</td>
            </tr>
          </tbody>
        </table>

        <h3 class="subsection-title">Failure Recovery Patterns</h3>

        <table class="taxonomy-table">
          <thead>
            <tr>
              <th>Pattern</th>
              <th>Mechanism</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Checkpointing</strong></td>
              <td>Periodic save of agent state (git state, progress files)</td>
            </tr>
            <tr>
              <td><strong>Graceful Degradation</strong></td>
              <td>Retry → Fallback model → Requeue → Human escalation → Safe shutdown</td>
            </tr>
            <tr>
              <td><strong>Dead Letter Queue</strong></td>
              <td>Tasks failing 3+ times move to human review</td>
            </tr>
            <tr>
              <td><strong>Circuit Breaker</strong></td>
              <td>CLOSED → OPEN (failing fast) → HALF_OPEN (testing recovery)</td>
            </tr>
            <tr>
              <td><strong>Semantic Merge</strong></td>
              <td>Use Claude to resolve conflicts by understanding intent</td>
            </tr>
            <tr>
              <td><strong>Optimistic Locking</strong></td>
              <td>Record expected file version, validate before commit</td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- Section 7: GOTCHAS -->
      <section id="gotchas" data-activity="gotchas">
        <h2 class="section-title">
          <span class="section-number">7</span>
          Gotchas
        </h2>

        <p class="text-text-secondary mb-6">
          Common pitfalls when implementing orchestration patterns, with concrete symptoms and fixes.
        </p>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Ralph Loop Never Completes
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Loop runs to max iterations without outputting "PROMISE COMPLETE"</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Tasks too large, missing completion condition, or stuck on failing tests</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Check <code>prd.json</code> for incomplete tasks. Check <code>progress.txt</code> for repeated failure patterns. Verify tests actually pass. Split oversized tasks.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Orchestrator Context Exhaustion
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> CC Mirror orchestrator loses track of tasks, quality degrades</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Orchestrator doing too much, not delegating properly</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Enable auto-compact. Orchestrator should ONLY use: Read (1-2 files), Task*, AskUserQuestion. Never write code or run commands.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Git Worktree Conflicts
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Cannot create worktree, or worktrees have stale branches</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Branch already checked out elsewhere, or cleanup incomplete</div>
          <div class="gotcha-detail"><strong>Fix:</strong> <code>git worktree list</code> → <code>git worktree prune</code> → <code>git worktree remove</code> → Create with new branch</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Handoff Files Not Being Read
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Agent doesn't see context from other agents</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Wrong file path, timing issue, or JSON format error</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Verify location (<code>ls ~/shared/handoff-*.json</code>). Validate JSON (<code>cat handoff.json | jq .</code>). Add explicit read instruction in prompt.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Anomaly Detection False Positives
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> System flags normal behavior as anomalous</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Thresholds too aggressive, normal patterns not baselined</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Adjust context threshold 90%→95% for complex tasks. Increase circular edit detection window. Baseline normal token consumption. Add task-specific exemptions.</div>
        </div>
      </section>

      <!-- Section 8: WHAT'S HARD -->
      <section id="hard" data-activity="hard">
        <h2 class="section-title">
          <span class="section-number">8</span>
          What's Hard
        </h2>

        <p class="text-text-secondary mb-6">
          Fundamental tensions in orchestration that require judgment, not formulas.
        </p>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Hub-and-Spoke vs. Peer-to-Peer
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Hub-and-spoke provides clear coordination but creates a single point of failure and bottleneck. Peer-to-peer is resilient but hard to monitor and prone to deadlocks.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Hub overloaded with coordination overhead. OR peer agents stepping on each other, no one knowing global state.</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Start with hub-and-spoke until you understand your workflow. Add peer-to-peer elements only for specific, well-bounded interactions. Never go full peer-to-peer without extensive monitoring.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Parallel Efficiency vs. Conflict Risk
          </div>
          <div class="hard-detail"><strong>The tension:</strong> More parallel agents = faster throughput. But more agents = more potential for conflicts, merge hell, and coordination overhead.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Merge conflicts consuming more time than parallelism saves. OR serial execution bottleneck when work is clearly parallelizable.</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Use isolation patterns (git worktrees, directory ownership) to prevent conflicts. Start with 2-3 parallel agents, not 10. Measure conflict rate before adding more.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Fresh Context vs. Accumulated Knowledge
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Fresh context avoids rot but loses learnings. Accumulated context has richer memory but degrades over time. There is no solution that gets both.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Late iterations repeat mistakes (memory loss). OR late iterations produce garbage (context rot).</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Fresh context + progress.txt is the best known tradeoff. Keep progress.txt under 20KB. Accept that some re-learning is the cost of fresh context.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Autonomous Operation vs. Human Oversight
          </div>
          <div class="hard-detail"><strong>The tension:</strong> The whole point is autonomous operation. But fully autonomous systems can compound errors, ship bad code, or run up costs overnight.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Morning reveals 20 bad commits. OR you're intervening so often it's not really autonomous.</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Start with HOTL (Human On The Loop) variants. Add verification layers (CI, browser automation). Graduate to full autonomy only for well-understood, repeatable tasks.</div>
        </div>
      </section>

      <!-- Section 9: PATTERN SELECTION -->
      <section id="selection" data-activity="selection">
        <h2 class="section-title">
          <span class="section-number">9</span>
          Pattern Selection Guide
        </h2>

        <p class="text-text-secondary mb-6">
          Match your scenario to the right pattern. Most production systems combine 3-5 patterns.
        </p>

        <table class="taxonomy-table">
          <thead>
            <tr>
              <th>Scenario</th>
              <th>Recommended Pattern</th>
              <th>Why</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Single feature, overnight</td>
              <td><strong>Ralph Loop</strong></td>
              <td>Fresh context, verifiable completion</td>
            </tr>
            <tr>
              <td>Multiple life domains</td>
              <td><strong>Panopticon</strong></td>
              <td>Isolated directories, no cross-contamination</td>
            </tr>
            <tr>
              <td>Team project, parallel features</td>
              <td><strong>Git worktrees + branch discipline</strong></td>
              <td>Isolation + shared codebase</td>
            </tr>
            <tr>
              <td>Complex architecture work</td>
              <td><strong>Hub-and-spoke with specialized workers</strong></td>
              <td>Clear coordination, expert specialization</td>
            </tr>
            <tr>
              <td>Production app with dependencies</td>
              <td><strong>CC Mirror</strong></td>
              <td>Task dependency management, orchestrator discipline</td>
            </tr>
            <tr>
              <td>Massive scale (10+ agents)</td>
              <td><strong>Gas Town factory</strong></td>
              <td>Named workers, role specialization, town coordination</td>
            </tr>
            <tr>
              <td>High-stakes decisions</td>
              <td><strong>Adversarial Speccing</strong></td>
              <td>Architect + Critic debate improves quality</td>
            </tr>
            <tr>
              <td>Self-improving system</td>
              <td><strong>Infinite Orchestra</strong></td>
              <td>24/7 Docker, self-improvement loop</td>
            </tr>
          </tbody>
        </table>

        <div class="when-grid">
          <div class="when-use">
            <div class="when-title">
              <i data-lucide="check" class="w-5 h-5"></i>
              START WITH ORCHESTRATION WHEN
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Work is clearly parallelizable (multiple independent features)</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>You have verification layers (tests, CI, browser automation)</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Tasks have clear completion criteria</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>You're comfortable with tmux/terminal multiplexing</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>You have budget for higher token usage</span>
            </div>
          </div>

          <div class="when-not">
            <div class="when-title">
              <i data-lucide="x" class="w-5 h-5"></i>
              AVOID ORCHESTRATION WHEN
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Single session can complete the work (don't over-engineer)</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Tight coupling between components (conflicts inevitable)</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>No automated verification (garbage will compound)</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Exploratory work with undefined end (use single session)</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Cost-constrained environment (orchestration burns tokens)</span>
            </div>
          </div>
        </div>

        <h3 class="subsection-title">Task Sizing Guidelines</h3>

        <table class="taxonomy-table">
          <thead>
            <tr>
              <th>Size</th>
              <th>Characteristics</th>
              <th>Example</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Too Small</strong></td>
              <td>Overhead exceeds value</td>
              <td>"Add a comment to line 42"</td>
            </tr>
            <tr>
              <td><strong>Just Right</strong></td>
              <td>One context window, verifiable</td>
              <td>"Implement User model with these fields"</td>
            </tr>
            <tr>
              <td><strong>Too Large</strong></td>
              <td>Context collapse risk</td>
              <td>"Build the entire backend"</td>
            </tr>
          </tbody>
        </table>

        <div class="decision-box">
          <div class="decision-why">TASK SIZE SWEET SPOT</div>
          <div class="decision-reasoning">
            ~100-500 lines of code change. ~1-3 files modified. ~30-60 minutes equivalent human time. Clear success criteria. If the task description is longer than the expected code change, you've decomposed too far.
          </div>
        </div>

        <h3 class="subsection-title">Quick Reference Commands</h3>

        <div class="code-block">
          <button class="copy-btn" onclick="copyCodeBlock(this)">
            <i data-lucide="copy" class="w-3 h-3"></i>
            Copy
          </button>
          <pre><span class="comment"># Ralph Loop</span>
./ralph.sh 25

<span class="comment"># Git Worktree</span>
git worktree add ../feature-branch feature-branch

<span class="comment"># CC Mirror</span>
npx cc-mirror quick --provider mirror --name mclaude

<span class="comment"># Claude HUD</span>
/plugin install claude-hud

<span class="comment"># rpai (tmux manager)</span>
cargo install rpai && rpai

<span class="comment"># Gas Town</span>
go install github.com/steveyegge/gastown/cmd/gt@latest</pre>
        </div>
      </section>

    </main>

    <!-- Resizer -->
    <div class="resizer" data-resizer="activity-zone" aria-label="Resize activity panel"></div>

    <!-- Activity Zone -->
    <aside class="activity-zone" id="activityZone">
      <div class="text-xs font-semibold text-text-muted uppercase tracking-wider mb-4">Operational Intelligence</div>

      <!-- ESSENCE SECTION -->
      <div class="activity-item minimal" data-section="essence">
        <div class="activity-label" style="color: #84cc16;">
          <i data-lucide="minimize-2" class="w-4 h-4"></i>
          Minimal Pattern
        </div>
        <div class="font-medium text-text-primary mb-2">The irreducible orchestration kernel</div>
        <div class="text-text-secondary text-sm">
          <code style="background: #f4f4f5; padding: 2px 6px; border-radius: 4px; font-size: 12px;">while :; do claude task; done</code><br><br>
          <strong>Essential:</strong> Loop + fresh context + external state.<br>
          <strong>Everything else:</strong> Refinement for reliability, parallelism, or coordination.
        </div>
      </div>

      <div class="activity-item constraint" data-section="essence">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="link-2" class="w-4 h-4"></i>
          Constraint Chain
        </div>
        <div class="font-medium text-text-primary mb-2">Why 10 categories, not 3 or 30?</div>
        <div class="text-text-secondary text-sm">
          <strong>ROOT:</strong> AI agents need coordination + state + verification<br>
          → Loop patterns handle iteration<br>
          → Multi-agent handles parallelism<br>
          → Isolation prevents conflicts<br>
          → Communication enables handoffs<br>
          → Architecture defines topology<br>
          → Memory persists state<br>
          → Verification ensures quality<br>
          → Monitoring provides visibility<br>
          → Recovery handles failures<br>
          → Resources manage cost<br><br>
          <em>10 categories = 10 distinct problems.</em>
        </div>
      </div>

      <!-- CORE SECTION -->
      <div class="activity-item invariant" data-section="core">
        <div class="activity-label" style="color: #3b82f6;">
          <i data-lucide="link" class="w-4 h-4"></i>
          Invariant Connection
        </div>
        <div class="font-medium text-text-primary mb-2">INV-003: External state > internal memory</div>
        <div class="text-text-secondary text-sm">
          Ralph, CC Mirror, Gas Town, Panopticon all share this invariant. The same principle forces the same architectural choice: files are the database, git is the audit trail, Claude's internal memory is ephemeral.
        </div>
      </div>

      <div class="activity-item analogy" data-section="core">
        <div class="activity-label" style="color: #d946ef;">
          <i data-lucide="git-compare" class="w-4 h-4"></i>
          Analogical Bridge
        </div>
        <div class="font-medium text-text-primary mb-2">Orchestration Taxonomy = Kubernetes Resources</div>
        <div class="text-text-secondary text-sm">
          Loop patterns → Pods (compute)<br>
          Multi-agent → Deployments (coordination)<br>
          Communication → Services (networking)<br>
          Memory → PersistentVolumes (state)<br>
          Monitoring → Prometheus (observability)<br><br>
          <em>If you've managed k8s, you understand orchestration categories.</em>
        </div>
      </div>

      <div class="activity-item expertise" data-section="core">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
          Expertise Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">How deep is your taxonomy understanding?</div>
        <div class="text-text-secondary text-sm">
          <strong>Beginner:</strong> "What patterns exist?" → This taxonomy<br>
          <strong>Intermediate:</strong> "Which category for my problem?" → Selection guide<br>
          <strong>Advanced:</strong> "How do categories compose?" → 3-5 patterns per system<br>
          <strong>Staff:</strong> "What's missing from the taxonomy?" → Your innovation space<br>
          <strong>Expert:</strong> "When does category X subsume Y?" → Pattern evolution
        </div>
      </div>

      <!-- LOOPS SECTION -->
      <div class="activity-item inversion" data-section="loops">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if loops WEREN'T the base pattern?</div>
        <div class="text-text-secondary text-sm">
          <strong>You'd design:</strong> Pure multi-agent from the start, no iteration concept.<br>
          <strong>Why this fails:</strong> Multi-agent coordination overhead dominates for simple tasks. Loops are the minimal viable orchestration.<br>
          <strong>Hidden insight:</strong> Even Gas Town and CC Mirror use loops internally.
        </div>
      </div>

      <div class="activity-item warstory" data-section="loops">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">Ryan Carson: 14 iterations, ~$10-15</div>
        <div class="text-text-secondary text-sm">
          Untangle Legal Agent. 6 user stories, ran overnight. "Learnings compound. By story 10, Ralph knew our patterns." The progress.txt paid off in later iterations.
        </div>
      </div>

      <div class="activity-item horizon" data-section="loops">
        <div class="activity-label" style="color: #06b6d4;">
          <i data-lucide="clock" class="w-4 h-4"></i>
          Time Horizon Shift
        </div>
        <div class="font-medium text-text-primary mb-2">How Ralph variants evolve with mastery</div>
        <div class="text-text-secondary text-sm">
          <strong>Week 1:</strong> "Ralph Core is enough"<br>
          <strong>Week 3:</strong> "I wish it remembered previous runs" → Compounding Ralph<br>
          <strong>Month 2:</strong> "I need confidence gates" → Dr. Ralph<br>
          <strong>Month 4:</strong> "I need full SDLC" → Marathon Ralph<br><br>
          <em>Most users plateau at Compounding Ralph. That's fine.</em>
        </div>
      </div>

      <div class="activity-item violation" data-section="loops">
        <div class="activity-label" style="color: #f97316;">
          <i data-lucide="alert-octagon" class="w-4 h-4"></i>
          Violation Chain
        </div>
        <div class="font-medium text-text-primary mb-2">If you skip external state (files)</div>
        <div class="text-text-secondary text-sm">
          <strong>IF:</strong> You rely on Claude's memory across iterations<br>
          <strong>THEN:</strong> Next iteration starts with zero knowledge<br>
          <strong>THEN:</strong> Same mistakes repeated<br>
          <strong>THEN:</strong> No velocity increase over time<br>
          <strong>FINALLY:</strong> Iteration 20 is as slow as iteration 1<br><br>
          <em>"If it's not in a file, it doesn't exist."</em>
        </div>
      </div>

      <!-- MULTIAGENT SECTION -->
      <div class="activity-item gradient" data-section="multiagent">
        <div class="activity-label" style="color: #f43f5e;">
          <i data-lucide="trending-down" class="w-4 h-4"></i>
          Failure Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">How multi-agent coordination degrades</div>
        <div class="text-text-secondary text-sm">
          <strong>2-3 agents:</strong> Easy coordination, rare conflicts<br>
          <strong>4-6 agents:</strong> Occasional conflicts, manageable overhead<br>
          <strong>7-10 agents:</strong> Frequent conflicts, coordination dominates<br>
          <strong>10+ agents:</strong> Requires Gas Town-level infrastructure<br><br>
          <em>Critical: Don't add agents assuming linear speedup.</em>
        </div>
      </div>

      <div class="activity-item composition" data-section="multiagent">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="layers" class="w-4 h-4"></i>
          Composition Case
        </div>
        <div class="font-medium text-text-primary mb-2">CC Mirror + Adversarial Speccing</div>
        <div class="text-text-secondary text-sm">
          <strong>Works:</strong> Orchestrator spawns Architect+Critic pair for complex features before implementation begins.<br>
          <strong>Benefit:</strong> Better designs, fewer rework cycles.<br>
          <strong>Danger:</strong> Debate can consume tokens. Time-box it.
        </div>
      </div>

      <div class="activity-item warstory" data-section="multiagent">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">Molly Cantillon: 8 parallel domains</div>
        <div class="text-text-secondary text-sm">
          Personal Panopticon across: nox (company), metrics, email, growth, trades, health, writing, personal. "Self-legibility" achieved through domain isolation. Each agent is a specialist, never cross-contaminated.
        </div>
      </div>

      <div class="activity-item tradeoff" data-section="multiagent">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="scale" class="w-4 h-4"></i>
          Trade-Off Tension
        </div>
        <div class="font-medium text-text-primary mb-2">Panopticon vs. CC Mirror vs. Gas Town</div>
        <div class="text-text-secondary text-sm">
          <strong>Panopticon:</strong> Simple isolation, low coordination, limited interaction<br>
          <strong>CC Mirror:</strong> Task dependencies, moderate overhead, clear orchestrator<br>
          <strong>Gas Town:</strong> Maximum scale, high overhead, requires commitment<br><br>
          <em>Heuristic: Match complexity to team size and budget.</em>
        </div>
      </div>

      <!-- ARCHITECTURE SECTION -->
      <div class="activity-item inversion" data-section="architecture">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if you went full peer-to-peer?</div>
        <div class="text-text-secondary text-sm">
          <strong>You'd design:</strong> No orchestrator, agents coordinate directly, emergent behavior.<br>
          <strong>Why this fails:</strong> No single source of truth. Deadlocks. Race conditions. Who resolves conflicts?<br>
          <strong>Hidden insight:</strong> Even "decentralized" systems need coordination primitives.
        </div>
      </div>

      <div class="activity-item analogy" data-section="architecture">
        <div class="activity-label" style="color: #d946ef;">
          <i data-lucide="git-compare" class="w-4 h-4"></i>
          Analogical Bridge
        </div>
        <div class="font-medium text-text-primary mb-2">Architecture Patterns = Organization Charts</div>
        <div class="text-text-secondary text-sm">
          <strong>Hub-and-Spoke</strong> = Traditional hierarchy (manager + reports)<br>
          <strong>Peer-to-Peer</strong> = Flat org (everyone coordinates directly)<br>
          <strong>Factory</strong> = Startup with contractors (hire specialists on demand)<br><br>
          <em>Same coordination tradeoffs, different context.</em>
        </div>
      </div>

      <div class="activity-item inflection" data-section="architecture">
        <div class="activity-label" style="color: #eab308;">
          <i data-lucide="activity" class="w-4 h-4"></i>
          Inflection Point
        </div>
        <div class="font-medium text-text-primary mb-2">When Hub-and-Spoke becomes bottleneck</div>
        <div class="text-text-secondary text-sm">
          <strong>2-5 workers:</strong> Hub overhead is negligible<br>
          <strong>6-10 workers:</strong> Hub starts queuing work<br>
          <strong>10+ workers:</strong> Hub is the bottleneck<br><br>
          <strong>THE INFLECTION:</strong> ~8 workers<br>
          <strong>BEFORE:</strong> Hub-and-spoke is optimal<br>
          <strong>AFTER:</strong> Need Factory pattern or distributed hubs
        </div>
      </div>

      <!-- SUPPORT SECTION -->
      <div class="activity-item composition" data-section="support">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="layers" class="w-4 h-4"></i>
          Composition Case
        </div>
        <div class="font-medium text-text-primary mb-2">Hierarchical Memory + Multi-Agent</div>
        <div class="text-text-secondary text-sm">
          <strong>Works:</strong> Shared Layer 2 (project CLAUDE.md) + Agent-specific Layer 4 (CLAUDE.local.md per worktree).<br>
          <strong>Benefit:</strong> Shared standards, specialized context.<br>
          <strong>Danger:</strong> Conflicting rules across layers. Layer 4 can't override Layer 2 policy.
        </div>
      </div>

      <div class="activity-item frontier" data-section="support">
        <div class="activity-label" style="color: #ef4444;">
          <i data-lucide="flask-conical" class="w-4 h-4"></i>
          Research Frontier
        </div>
        <div class="font-medium text-text-primary mb-2">UNSOLVED: Optimal checkpointing frequency</div>
        <div class="text-text-secondary text-sm">
          <strong>The question:</strong> Checkpoint every N iterations? Every K tokens? Every T minutes?<br>
          <strong>Why it's hard:</strong> Too frequent = overhead. Too rare = lost progress on crash.<br>
          <strong>Current practice:</strong> Manual checkpointing, or checkpoint on task completion.
        </div>
      </div>

      <div class="activity-item expertise" data-section="support">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
          Expertise Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">Support pattern mastery levels</div>
        <div class="text-text-secondary text-sm">
          <strong>Beginner:</strong> "Use file handoffs" → Single pattern<br>
          <strong>Intermediate:</strong> "Add CI verification" → Two patterns<br>
          <strong>Advanced:</strong> "Add Claude HUD monitoring" → Three patterns<br>
          <strong>Staff:</strong> "Add circuit breaker recovery" → Four patterns<br>
          <strong>Expert:</strong> "Custom anomaly detection" → Pattern invention
        </div>
      </div>

      <div class="activity-item effect" data-section="support">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="bar-chart-2" class="w-4 h-4"></i>
          Second-Order Effect
        </div>
        <div class="font-medium text-text-primary mb-2">Monitoring changes agent behavior</div>
        <div class="text-text-secondary text-sm">
          At high monitoring density, agents spend more tokens reporting status than doing work. The observer effect: measurement changes the system.<br><br>
          <strong>Threshold:</strong> >15% of tokens on status reporting indicates over-monitoring.
        </div>
      </div>

      <!-- GOTCHAS SECTION -->
      <div class="activity-item violation" data-section="gotchas">
        <div class="activity-label" style="color: #f97316;">
          <i data-lucide="alert-octagon" class="w-4 h-4"></i>
          Violation Chain
        </div>
        <div class="font-medium text-text-primary mb-2">If orchestrator writes code (CC Mirror)</div>
        <div class="text-text-secondary text-sm">
          <strong>IF:</strong> Orchestrator starts writing code instead of delegating<br>
          <strong>THEN:</strong> Context fills with implementation details<br>
          <strong>THEN:</strong> Loses track of task dependencies<br>
          <strong>THEN:</strong> Quality degrades, coordination fails<br>
          <strong>FINALLY:</strong> System produces garbage<br><br>
          <em>"You are the CONDUCTOR. Your agents play the instruments."</em>
        </div>
      </div>

      <div class="activity-item inflection" data-section="gotchas">
        <div class="activity-label" style="color: #eab308;">
          <i data-lucide="activity" class="w-4 h-4"></i>
          Inflection Point
        </div>
        <div class="font-medium text-text-primary mb-2">When progress.txt hurts Ralph</div>
        <div class="text-text-secondary text-sm">
          <strong>0-10KB:</strong> Pure benefit (learnings compound)<br>
          <strong>10-20KB:</strong> Diminishing returns<br>
          <strong>20-30KB:</strong> Neutral<br>
          <strong>30KB+:</strong> Net negative (context wasted)<br><br>
          <strong>Detection:</strong> Late iterations worse than early? Check file size.
        </div>
      </div>

      <div class="activity-item alternative" data-section="gotchas">
        <div class="activity-label" style="color: #6b7280;">
          <i data-lucide="arrow-right" class="w-4 h-4"></i>
          Alternative Path
        </div>
        <div class="font-medium text-text-primary mb-2">When gotchas indicate wrong pattern</div>
        <div class="text-text-secondary text-sm">
          <strong>Constant merge conflicts?</strong> → Better isolation (git worktrees)<br>
          <strong>Orchestrator overwhelmed?</strong> → Factory pattern<br>
          <strong>Handoffs lost?</strong> → MCP Agent Mail<br>
          <strong>Quality degrading overnight?</strong> → Add HOTL gates
        </div>
      </div>

      <!-- HARD SECTION -->
      <div class="activity-item tradeoff" data-section="hard">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="scale" class="w-4 h-4"></i>
          Trade-Off Tension
        </div>
        <div class="font-medium text-text-primary mb-2">The Autonomy Gradient</div>
        <div class="text-text-secondary text-sm">
          <strong>Full human review:</strong> Safe, but defeats the point<br>
          <strong>HOTL (Human On The Loop):</strong> Balanced, but requires attention<br>
          <strong>Semi-autonomous:</strong> Fast, but errors compound<br>
          <strong>Full AFK:</strong> Maximum leverage, maximum risk<br><br>
          <em>Match autonomy level to task reversibility.</em>
        </div>
      </div>

      <div class="activity-item inversion" data-section="hard">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if context NEVER degraded?</div>
        <div class="text-text-secondary text-sm">
          <strong>You'd design:</strong> Single infinite session, no orchestration needed.<br>
          <strong>Why this fails:</strong> Context rot is transformer physics. Even with 2M token windows, quality degrades.<br>
          <strong>Hidden insight:</strong> Orchestration exists BECAUSE of context limits. It's the constraint made visible.
        </div>
      </div>

      <div class="activity-item horizon" data-section="hard">
        <div class="activity-label" style="color: #06b6d4;">
          <i data-lucide="clock" class="w-4 h-4"></i>
          Time Horizon Shift
        </div>
        <div class="font-medium text-text-primary mb-2">How "hard" problems evolve with scale</div>
        <div class="text-text-secondary text-sm">
          <strong>Week 1:</strong> "Hub-and-spoke is obvious"<br>
          <strong>Month 1:</strong> "Why is coordination so expensive?"<br>
          <strong>Month 3:</strong> "Maybe peer-to-peer for some interactions"<br>
          <strong>Month 6:</strong> "Hybrid topologies are the answer"<br><br>
          <em>The "hard" problems teach architectural intuition.</em>
        </div>
      </div>

      <!-- SELECTION SECTION -->
      <div class="activity-item analogy" data-section="selection">
        <div class="activity-label" style="color: #d946ef;">
          <i data-lucide="git-compare" class="w-4 h-4"></i>
          Analogical Bridge
        </div>
        <div class="font-medium text-text-primary mb-2">Pattern Selection = Build vs. Buy</div>
        <div class="text-text-secondary text-sm">
          <strong>Single session</strong> = Use off-the-shelf (simple)<br>
          <strong>Ralph loop</strong> = Light customization (moderate)<br>
          <strong>CC Mirror</strong> = Significant customization (complex)<br>
          <strong>Gas Town</strong> = Build from scratch (enterprise)<br><br>
          <em>Match complexity to actual requirements.</em>
        </div>
      </div>

      <div class="activity-item expertise" data-section="selection">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
          Expertise Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">Pattern selection mastery</div>
        <div class="text-text-secondary text-sm">
          <strong>Beginner:</strong> "Which pattern should I use?" → Selection guide<br>
          <strong>Intermediate:</strong> "Why this combination?" → Category composition<br>
          <strong>Advanced:</strong> "What's the minimal setup?" → Remove unnecessary patterns<br>
          <strong>Staff:</strong> "When to invent new patterns?" → Edge cases<br>
          <strong>Expert:</strong> "How do patterns evolve?" → Taxonomy contribution
        </div>
      </div>

      <div class="activity-item effect" data-section="selection">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="bar-chart-2" class="w-4 h-4"></i>
          Second-Order Effect
        </div>
        <div class="font-medium text-text-primary mb-2">Pattern choice shapes team culture</div>
        <div class="text-text-secondary text-sm">
          Teams using Ralph think in iterations. Teams using Gas Town think in roles. Teams using CC Mirror think in dependencies. The pattern shapes how you decompose ALL problems, not just AI tasks.<br><br>
          <strong>Implication:</strong> Choose patterns that match how you want to think.
        </div>
      </div>

      <div class="activity-item alternative" data-section="selection">
        <div class="activity-label" style="color: #6b7280;">
          <i data-lucide="arrow-right" class="w-4 h-4"></i>
          Alternative Paths
        </div>
        <div class="font-medium text-text-primary mb-2">When this taxonomy isn't enough</div>
        <div class="text-text-secondary text-sm">
          <strong>Need depth on Ralph?</strong> → mastery-ralph-complete.md<br>
          <strong>Need Gas Town details?</strong> → mastery-gastown-complete.md<br>
          <strong>Need CC Mirror setup?</strong> → mastery-ccmirror-complete.md<br>
          <strong>Need architectural decisions?</strong> → JUDGMENT-GUIDE.md
        </div>
      </div>

    </aside>
  </div>

  <script>
    /**
     * PanelResizer - Handles draggable panel dividers
     */
    class PanelResizer {
      constructor(resizerEl, config = {}) {
        this.resizer = resizerEl;
        this.config = {
          storageKey: 'panel-activity-zone-width',
          minWidth: 280,
          maxWidth: 900,
          defaultWidth: 480,
          ...config
        };

        this.isResizing = false;
        this.startX = 0;
        this.startWidth = 0;

        this.activityZone = document.querySelector('.activity-zone');
        this.mainContent = document.querySelector('.main-content');

        this.onMouseDown = this.onMouseDown.bind(this);
        this.onMouseMove = this.onMouseMove.bind(this);
        this.onMouseUp = this.onMouseUp.bind(this);

        this.init();
      }

      init() {
        this.restoreWidth();
        this.resizer.addEventListener('mousedown', this.onMouseDown);
      }

      onMouseDown(e) {
        if (e.button !== 0) return;

        this.isResizing = true;
        this.startX = e.clientX;
        this.startWidth = this.activityZone.offsetWidth;

        this.resizer.classList.add('active');
        document.body.classList.add('resizing');

        document.addEventListener('mousemove', this.onMouseMove);
        document.addEventListener('mouseup', this.onMouseUp);

        e.preventDefault();
      }

      onMouseMove(e) {
        if (!this.isResizing) return;

        const delta = this.startX - e.clientX;
        const newWidth = this.startWidth + delta;

        const constrainedWidth = Math.max(
          this.config.minWidth,
          Math.min(this.config.maxWidth, newWidth)
        );

        this.activityZone.style.width = constrainedWidth + 'px';
        this.mainContent.style.marginRight = constrainedWidth + 'px';
        this.resizer.style.right = constrainedWidth + 'px';
      }

      onMouseUp(e) {
        if (!this.isResizing) return;

        this.isResizing = false;

        this.resizer.classList.remove('active');
        document.body.classList.remove('resizing');

        document.removeEventListener('mousemove', this.onMouseMove);
        document.removeEventListener('mouseup', this.onMouseUp);

        this.saveWidth();
      }

      saveWidth() {
        const width = this.activityZone.offsetWidth;
        localStorage.setItem(this.config.storageKey, JSON.stringify({
          width,
          timestamp: Date.now()
        }));
      }

      restoreWidth() {
        try {
          const stored = localStorage.getItem(this.config.storageKey);
          if (stored) {
            const { width } = JSON.parse(stored);
            if (width >= this.config.minWidth && width <= this.config.maxWidth) {
              this.activityZone.style.width = width + 'px';
              this.mainContent.style.marginRight = width + 'px';
              this.resizer.style.right = width + 'px';
            }
          }
        } catch (e) {
          console.warn('Failed to restore panel width:', e);
        }
      }

      destroy() {
        this.resizer.removeEventListener('mousedown', this.onMouseDown);
        document.removeEventListener('mousemove', this.onMouseMove);
        document.removeEventListener('mouseup', this.onMouseUp);
      }
    }

    // Auto-initialize resizers on DOM ready
    document.addEventListener('DOMContentLoaded', () => {
      const resizers = document.querySelectorAll('[data-resizer]');
      resizers.forEach(resizer => new PanelResizer(resizer));
    });

    // Initialize Lucide icons
    lucide.createIcons();

    // Navigation toggle
    function toggleSection(header) {
      const section = header.closest('.nav-section');
      section.classList.toggle('expanded');
      const children = section.querySelector('.nav-children');
      children.classList.toggle('expanded');
    }

    // Mobile menu toggle
    function toggleMobileMenu() {
      const nav = document.getElementById('leftNav');
      nav.classList.toggle('open');
    }

    // Copy functionality
    function copyCode(btn, text) {
      navigator.clipboard.writeText(text).then(() => {
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i data-lucide="check" class="w-3 h-3"></i> Copied!';
        lucide.createIcons();
        setTimeout(() => {
          btn.innerHTML = originalText;
          lucide.createIcons();
        }, 2000);
      });
    }

    function copyCodeBlock(btn) {
      const codeBlock = btn.closest('.code-block');
      const pre = codeBlock.querySelector('pre');
      const text = pre.textContent;
      copyCode(btn, text);
    }

    // Scroll-sync with GSAP ScrollTrigger
    gsap.registerPlugin(ScrollTrigger);

    const sections = document.querySelectorAll('[data-activity]');
    const activityItems = document.querySelectorAll('.activity-item');

    sections.forEach(section => {
      ScrollTrigger.create({
        trigger: section,
        start: 'top 40%',
        end: 'bottom 40%',
        onEnter: () => activateSection(section.dataset.activity),
        onEnterBack: () => activateSection(section.dataset.activity),
      });
    });

    function activateSection(sectionName) {
      activityItems.forEach(item => {
        if (item.dataset.section === sectionName) {
          item.classList.add('active');
          gsap.to(item, {
            opacity: 1,
            y: -2,
            boxShadow: '0 4px 12px rgba(0,0,0,0.08)',
            duration: 0.3,
            ease: 'power2.out'
          });
        } else {
          item.classList.remove('active');
          gsap.to(item, {
            opacity: 0.5,
            y: 0,
            boxShadow: 'none',
            duration: 0.3,
            ease: 'power2.out'
          });
        }
      });

      document.querySelectorAll('.nav-section-header').forEach(header => {
        header.classList.remove('active');
      });
      const activeNav = document.querySelector(`[data-section="${sectionName}"] .nav-section-header`);
      if (activeNav) {
        activeNav.classList.add('active');
      }
    }

    // Initialize first section as active
    activateSection('essence');

    // Smooth scroll for nav links
    document.querySelectorAll('.nav-item').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const target = document.querySelector(link.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          document.querySelectorAll('.nav-item').forEach(l => l.classList.remove('active'));
          link.classList.add('active');
        }
      });
    });

    // Brushing interaction
    activityItems.forEach(item => {
      item.addEventListener('mouseenter', () => {
        const sectionName = item.dataset.section;
        const relatedSection = document.querySelector(`[data-activity="${sectionName}"]`);
        if (relatedSection) {
          relatedSection.style.backgroundColor = 'rgba(13, 147, 115, 0.05)';
          relatedSection.style.transition = 'background-color 0.3s ease';
        }
      });

      item.addEventListener('mouseleave', () => {
        const sectionName = item.dataset.section;
        const relatedSection = document.querySelector(`[data-activity="${sectionName}"]`);
        if (relatedSection) {
          relatedSection.style.backgroundColor = '';
        }
      });
    });
  </script>
</body>
</html>
