<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Context Management Mastery | Claude Code Documentation</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Lucide Icons CDN -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- GSAP for scroll-sync -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

  <!-- Tailwind Config with Design Tokens -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'bg-base': '#ffffff',
            'bg-subtle': '#fafafa',
            'bg-muted': '#f4f4f5',
            'text-primary': '#18181b',
            'text-secondary': '#3f3f46',
            'text-muted': '#71717a',
            'accent': '#0D9373',
            'accent-light': '#10b981',
            'accent-bg': '#ecfdf5',
            'border': '#e4e4e7',
            // Activity Zone content type colors (Original 6)
            'az-invariant': '#3b82f6',    // Blue
            'az-effect': '#f59e0b',       // Amber
            'az-composition': '#8b5cf6',  // Purple
            'az-frontier': '#ef4444',     // Red
            'az-warstory': '#10b981',     // Green
            'az-alternative': '#6b7280',  // Gray
            // Activity Zone generative content types (New 10)
            'az-inversion': '#4f46e5',    // Indigo
            'az-constraint': '#8b5cf6',   // Violet
            'az-gradient': '#f43f5e',     // Rose
            'az-horizon': '#06b6d4',      // Cyan
            'az-violation': '#f97316',    // Orange
            'az-tradeoff': '#f59e0b',     // Amber
            'az-analogy': '#d946ef',      // Fuchsia
            'az-expertise': '#10b981',    // Emerald
            'az-minimal': '#84cc16',      // Lime
            'az-inflection': '#eab308',   // Yellow
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
            mono: ['Fira Code', 'monospace'],
          },
        },
      },
    }
  </script>

  <style>
    /* Base Styles */
    * {
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
      scroll-padding-top: 80px;
    }

    [id] {
      scroll-margin-top: 80px;
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: #ffffff;
      color: #18181b;
      line-height: 1.7;
    }

    /* Three Panel Layout */
    .three-panel-layout {
      min-height: 100vh;
      position: relative;
    }

    /* Header */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 56px;
      background: #ffffff;
      border-bottom: 1px solid #e4e4e7;
      z-index: 100;
      display: flex;
      align-items: center;
      padding: 0 24px;
    }

    /* Left Navigation - 240px fixed */
    .left-nav {
      position: fixed;
      top: 56px;
      left: 0;
      width: 240px;
      height: calc(100vh - 56px);
      border-right: 1px solid #e4e4e7;
      background: #ffffff;
      overflow-y: auto;
      padding: 16px 0;
      z-index: 40;
    }

    .nav-section {
      padding: 0 12px;
      margin-bottom: 8px;
    }

    .nav-section-header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      font-size: 14px;
      font-weight: 500;
      color: #3f3f46;
      cursor: pointer;
      border-radius: 6px;
      transition: background 0.15s;
    }

    .nav-section-header:hover {
      background: #f4f4f5;
    }

    .nav-section-header.active {
      color: #0D9373;
      background: #ecfdf5;
    }

    .nav-item {
      display: block;
      padding: 6px 12px 6px 44px;
      font-size: 14px;
      color: #71717a;
      text-decoration: none;
      border-radius: 6px;
      transition: all 0.15s;
    }

    .nav-item:hover {
      color: #3f3f46;
      background: #f4f4f5;
    }

    .nav-item.active {
      color: #0D9373;
      background: #ecfdf5;
    }

    .nav-children {
      display: none;
      overflow: hidden;
    }

    .nav-children.expanded {
      display: block;
    }

    .nav-chevron {
      transition: transform 0.2s;
    }

    .nav-section.expanded .nav-chevron {
      transform: rotate(90deg);
    }

    /* Main Content - Flexible, margins for fixed sidebars */
    .main-content {
      margin-left: 240px;
      margin-right: 480px;
      margin-top: 56px;
      padding: 48px 48px;
      min-width: 400px;
    }

    /* Activity Zone - 480px fixed */
    .activity-zone {
      position: fixed;
      top: 56px;
      right: 0;
      width: 480px;
      height: calc(100vh - 56px);
      border-left: 1px dashed #e4e4e7;
      background: #fafafa;
      overflow-y: auto;
      padding: 24px 20px;
      z-index: 40;
    }

    /* Responsive: Hide Activity Zone below 1400px */
    @media (max-width: 1400px) {
      .activity-zone {
        display: none;
      }
      .main-content {
        margin-right: 0;
        padding: 40px 32px;
      }
    }

    /* Responsive: Hide Left Nav below 768px */
    @media (max-width: 768px) {
      .left-nav {
        display: none;
      }
      .left-nav.open {
        display: block;
        position: fixed;
        top: 56px;
        left: 0;
        right: 0;
        bottom: 0;
        background: #ffffff;
        z-index: 50;
        overflow-y: auto;
      }
      .main-content {
        margin-left: 0;
        padding: 24px 16px;
        min-width: auto;
      }
    }

    /* Resizer */
    .resizer {
      position: fixed;
      top: 56px;
      right: 480px;
      width: 6px;
      height: calc(100vh - 56px);
      cursor: col-resize;
      background: transparent;
      z-index: 50;
      transition: background 0.15s ease;
    }

    .resizer:hover {
      background: rgba(13, 147, 115, 0.15);
    }

    .resizer.active {
      background: rgba(13, 147, 115, 0.25);
    }

    body.resizing {
      user-select: none;
      cursor: col-resize !important;
    }

    body.resizing * {
      cursor: col-resize !important;
    }

    @media (max-width: 1400px) {
      .resizer {
        display: none;
      }
    }

    /* Activity Zone Items */
    .activity-item {
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      background: #ffffff;
      border: 1px solid #e4e4e7;
      font-size: 14px;
      line-height: 1.6;
      opacity: 0.5;
      transition: all 0.3s ease;
    }

    .activity-item.active {
      opacity: 1;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .activity-item:hover {
      opacity: 1;
    }

    .activity-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    /* Activity Zone content type borders (Original 6) */
    .activity-item.invariant { border-left: 4px solid #3b82f6; }
    .activity-item.effect { border-left: 4px solid #f59e0b; }
    .activity-item.composition { border-left: 4px solid #8b5cf6; }
    .activity-item.frontier { border-left: 4px solid #ef4444; }
    .activity-item.warstory { border-left: 4px solid #10b981; }
    .activity-item.alternative { border-left: 4px solid #6b7280; }

    /* Activity Zone generative content types (New 10) */
    .activity-item.inversion { border-left: 4px solid #4f46e5; }
    .activity-item.constraint { border-left: 4px solid #8b5cf6; }
    .activity-item.gradient { border-left: 4px solid #f43f5e; }
    .activity-item.horizon { border-left: 4px solid #06b6d4; }
    .activity-item.violation { border-left: 4px solid #f97316; }
    .activity-item.tradeoff { border-left: 4px solid #f59e0b; }
    .activity-item.analogy { border-left: 4px solid #d946ef; }
    .activity-item.expertise { border-left: 4px solid #10b981; }
    .activity-item.minimal { border-left: 4px solid #84cc16; }
    .activity-item.inflection { border-left: 4px solid #eab308; }

    /* Main Content Components */

    /* Section titles with number */
    .section-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      background: #0D9373;
      color: #ffffff;
      font-size: 14px;
      font-weight: 600;
      border-radius: 50%;
      margin-right: 12px;
    }

    .section-title {
      font-size: 24px;
      font-weight: 600;
      color: #18181b;
      margin-bottom: 20px;
      margin-top: 56px;
      display: flex;
      align-items: center;
    }

    .section-title:first-child {
      margin-top: 0;
    }

    /* Essence Box (15 words) */
    .essence-box {
      background: linear-gradient(135deg, #18181b 0%, #27272a 100%);
      border-radius: 12px;
      padding: 32px;
      margin-bottom: 40px;
    }

    .essence-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #10b981;
      margin-bottom: 12px;
    }

    .essence-text {
      font-size: 22px;
      font-weight: 500;
      color: #ffffff;
      line-height: 1.4;
    }

    /* Core Abstraction Box */
    .core-abstraction {
      background: #fafafa;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 40px;
    }

    .core-philosophy {
      font-size: 16px;
      color: #3f3f46;
      margin-bottom: 16px;
      font-style: italic;
    }

    .core-code {
      background: #18181b;
      border-radius: 8px;
      padding: 16px 20px;
      margin-bottom: 16px;
      overflow-x: auto;
    }

    .core-code code {
      font-family: 'Fira Code', monospace;
      font-size: 15px;
      color: #10b981;
      white-space: nowrap;
    }

    .core-anchor {
      font-size: 14px;
      color: #71717a;
      text-align: center;
    }

    /* Design Decision Box */
    .decision-box {
      background: #ffffff;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
    }

    .decision-why {
      font-size: 16px;
      font-weight: 600;
      color: #0D9373;
      margin-bottom: 12px;
    }

    .decision-reasoning {
      font-size: 14px;
      color: #3f3f46;
      margin-bottom: 16px;
    }

    .decision-implication {
      background: #f4f4f5;
      border-radius: 8px;
      padding: 16px;
    }

    .decision-implication-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      color: #71717a;
      margin-bottom: 8px;
    }

    /* Code Blocks */
    .code-block {
      background: #18181b;
      border-radius: 8px;
      padding: 16px 20px;
      margin-bottom: 24px;
      position: relative;
      overflow-x: auto;
    }

    .code-block pre {
      margin: 0;
      font-family: 'Fira Code', monospace;
      font-size: 13px;
      color: #e4e4e7;
      line-height: 1.6;
    }

    .code-block .comment { color: #6b7280; }
    .code-block .keyword { color: #c084fc; }
    .code-block .string { color: #10b981; }
    .code-block .variable { color: #60a5fa; }
    .code-block .number { color: #f59e0b; }

    .copy-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: #3f3f46;
      color: #ffffff;
      border: none;
      border-radius: 4px;
      padding: 6px 10px;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: background 0.15s;
    }

    .copy-btn:hover {
      background: #52525b;
    }

    /* Path Steps */
    .path-container {
      background: #fafafa;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 40px;
    }

    .path-step {
      display: flex;
      gap: 16px;
      margin-bottom: 16px;
    }

    .path-step:last-child {
      margin-bottom: 0;
    }

    .path-number {
      flex-shrink: 0;
      width: 24px;
      height: 24px;
      background: #0D9373;
      color: #ffffff;
      font-size: 12px;
      font-weight: 600;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .path-content {
      flex: 1;
      font-size: 14px;
      color: #3f3f46;
    }

    .path-content code {
      background: #e4e4e7;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 13px;
    }

    /* Gotcha Box */
    .gotcha-box {
      background: #fffbeb;
      border: 1px solid #fcd34d;
      border-left: 4px solid #f59e0b;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .gotcha-title {
      font-weight: 600;
      color: #92400e;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .gotcha-detail {
      font-size: 14px;
      color: #78350f;
      margin-bottom: 8px;
    }

    .gotcha-detail strong {
      color: #92400e;
    }

    /* What's Hard Box */
    .hard-box {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-left: 4px solid #ef4444;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .hard-title {
      font-weight: 600;
      color: #991b1b;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .hard-detail {
      font-size: 14px;
      color: #7f1d1d;
      margin-bottom: 8px;
    }

    /* When To Use Grid */
    .when-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 40px;
    }

    @media (max-width: 900px) {
      .when-grid {
        grid-template-columns: 1fr;
      }
    }

    .when-use {
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      border-radius: 12px;
      padding: 24px;
    }

    .when-not {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: 12px;
      padding: 24px;
    }

    .when-title {
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .when-use .when-title { color: #166534; }
    .when-not .when-title { color: #991b1b; }

    .when-item {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      font-size: 14px;
    }

    .when-use .when-item { color: #166534; }
    .when-not .when-item { color: #991b1b; }

    /* Table Styles */
    .context-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 24px;
      font-size: 14px;
    }

    .context-table th {
      background: #f4f4f5;
      padding: 12px 16px;
      text-align: left;
      font-weight: 600;
      color: #3f3f46;
      border-bottom: 2px solid #e4e4e7;
    }

    .context-table td {
      padding: 12px 16px;
      border-bottom: 1px solid #e4e4e7;
      color: #3f3f46;
    }

    .context-table tr:last-child td {
      border-bottom: none;
    }

    .context-table .warning { color: #f59e0b; }
    .context-table .danger { color: #ef4444; }
    .context-table .critical { color: #dc2626; font-weight: 600; }

    /* Strategy Card */
    .strategy-card {
      background: #ffffff;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .strategy-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .strategy-number {
      width: 32px;
      height: 32px;
      background: #0D9373;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 14px;
    }

    .strategy-title {
      font-size: 18px;
      font-weight: 600;
      color: #18181b;
    }

    .strategy-description {
      font-size: 14px;
      color: #3f3f46;
      margin-bottom: 16px;
    }

    /* Budget Box */
    .budget-box {
      background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
      border: 1px solid #bbf7d0;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .budget-title {
      font-weight: 600;
      color: #166534;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .budget-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px dashed #bbf7d0;
      font-size: 14px;
    }

    .budget-item:last-child {
      border-bottom: none;
    }

    .budget-label {
      color: #166534;
    }

    .budget-value {
      font-family: 'Fira Code', monospace;
      color: #15803d;
      font-weight: 500;
    }

    /* Mobile Menu Button */
    .mobile-menu-btn {
      display: none;
      padding: 8px;
      background: none;
      border: none;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .mobile-menu-btn {
        display: flex;
      }
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: #fafafa;
    }

    ::-webkit-scrollbar-thumb {
      background: #d4d4d8;
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #a1a1aa;
    }

    /* Keyboard shortcut hint */
    .kbd {
      display: inline-flex;
      align-items: center;
      padding: 2px 6px;
      background: #f4f4f5;
      border: 1px solid #e4e4e7;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 12px;
      color: #71717a;
    }

    /* Checkpoint Box */
    .checkpoint-box {
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      border-left: 4px solid #22c55e;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 24px;
    }

    .checkpoint-title {
      font-weight: 600;
      color: #166534;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .checkpoint-content {
      font-size: 14px;
      color: #15803d;
    }

    /* Philosophy Stack */
    .philosophy-stack {
      background: linear-gradient(135deg, #18181b 0%, #27272a 100%);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .philosophy-item {
      padding: 16px 0;
      border-bottom: 1px solid #3f3f46;
    }

    .philosophy-item:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }

    .philosophy-level {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #10b981;
      margin-bottom: 8px;
    }

    .philosophy-text {
      font-size: 14px;
      color: #e4e4e7;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle menu">
      <i data-lucide="menu" class="w-5 h-5 text-text-secondary"></i>
    </button>
    <div class="flex items-center gap-3">
      <i data-lucide="terminal" class="w-5 h-5 text-accent"></i>
      <span class="font-semibold text-text-primary">Claude Code</span>
    </div>
    <div class="flex-1 flex justify-center">
      <button class="flex items-center gap-2 px-4 py-2 bg-bg-muted rounded-lg text-text-muted text-sm hover:bg-border transition-colors">
        <i data-lucide="search" class="w-4 h-4"></i>
        <span>Search documentation...</span>
        <span class="kbd">Cmd+K</span>
      </button>
    </div>
    <div class="flex items-center gap-4">
      <a href="#" class="text-sm text-text-muted hover:text-text-primary transition-colors">Support</a>
      <button class="p-2 hover:bg-bg-muted rounded-lg transition-colors" aria-label="Toggle theme">
        <i data-lucide="sun" class="w-4 h-4 text-text-muted"></i>
      </button>
    </div>
  </header>

  <div class="three-panel-layout">
    <!-- Left Navigation -->
    <nav class="left-nav" id="leftNav">
      <div class="px-4 mb-4">
        <span class="text-xs font-semibold text-text-muted uppercase tracking-wider">Context Management</span>
      </div>

      <!-- Essence -->
      <div class="nav-section expanded" data-section="essence">
        <div class="nav-section-header active" onclick="toggleSection(this)">
          <i data-lucide="zap" class="w-4 h-4"></i>
          <span>Essence</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#essence" class="nav-item active">The 15-Word Summary</a>
        </div>
      </div>

      <!-- Core Abstraction -->
      <div class="nav-section expanded" data-section="core">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="box" class="w-4 h-4"></i>
          <span>Core Abstraction</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#core-abstraction" class="nav-item">Philosophy + Code</a>
          <a href="#context-rot" class="nav-item">Context Rot Reality</a>
        </div>
      </div>

      <!-- Design Decisions -->
      <div class="nav-section expanded" data-section="decisions">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="lightbulb" class="w-4 h-4"></i>
          <span>Design Decisions</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#why-fresh-context" class="nav-item">Why Fresh Context?</a>
          <a href="#why-external-state" class="nav-item">Why External State?</a>
          <a href="#why-files" class="nav-item">Why Files Over Memory?</a>
        </div>
      </div>

      <!-- Strategies -->
      <div class="nav-section" data-section="strategies">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="folder" class="w-4 h-4"></i>
          <span>The 5 Strategies</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#strategy-fresh" class="nav-item">1. Fresh Context</a>
          <a href="#strategy-files" class="nav-item">2. File-Based State</a>
          <a href="#strategy-git" class="nav-item">3. Git as Memory</a>
          <a href="#strategy-external" class="nav-item">4. External Memory</a>
          <a href="#strategy-compaction" class="nav-item">5. Compaction</a>
        </div>
      </div>

      <!-- Path -->
      <div class="nav-section" data-section="path">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="git-branch" class="w-4 h-4"></i>
          <span>Decision Flow</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#decision-tree" class="nav-item">Decision Tree</a>
          <a href="#context-budget" class="nav-item">Context Budget</a>
        </div>
      </div>

      <!-- Gotchas -->
      <div class="nav-section" data-section="gotchas">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="alert-triangle" class="w-4 h-4"></i>
          <span>Gotchas</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#gotchas" class="nav-item">Practical Problems</a>
          <a href="#warning-signs" class="nav-item">Warning Signs</a>
        </div>
      </div>

      <!-- What's Hard -->
      <div class="nav-section" data-section="hard">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="flame" class="w-4 h-4"></i>
          <span>What's Hard</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#hard" class="nav-item">Real Complexity</a>
        </div>
      </div>

      <!-- When to Use -->
      <div class="nav-section" data-section="when">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="check-circle" class="w-4 h-4"></i>
          <span>When to Use</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#when" class="nav-item">Strategy Selection</a>
          <a href="#tradeoffs" class="nav-item">Tradeoff Matrix</a>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">

      <!-- Section 1: ESSENCE -->
      <section id="essence" data-activity="essence">
        <div class="essence-box">
          <div class="essence-label">Essence (15 words)</div>
          <div class="essence-text">Context is finite. Fresh context beats extended sessions. External state beats internal memory.</div>
        </div>
      </section>

      <!-- Section 2: CORE ABSTRACTION + IMPLEMENTATION -->
      <section id="core-abstraction" data-activity="core">
        <h2 class="section-title">
          <span class="section-number">2</span>
          The Core Abstraction
        </h2>

        <div class="core-abstraction">
          <div class="core-philosophy">"The agent remembers nothing. The filesystem remembers everything."</div>

          <div class="core-code">
            <button class="copy-btn" onclick="copyCode(this, 'CLAUDE.md + prd.json + progress.txt + git = persistent memory')">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <code>CLAUDE.md + prd.json + progress.txt + git = persistent memory</code>
          </div>

          <div class="core-anchor">This is the complete memory architecture. Claude is stateless; files are the state.</div>
        </div>

        <p class="text-text-secondary mb-6">
          Every optimization pattern in Claude Code ultimately addresses the same fundamental limitation: <strong>context window exhaustion</strong>. Claude's context window (~200K tokens, ~100K effective for quality work) is a hard ceiling that shapes every workflow decision.
        </p>

        <div id="context-rot">
          <h3 class="font-semibold text-lg mb-4">Context Rot: The Brutal Reality</h3>

          <blockquote class="border-l-4 border-accent pl-4 italic text-text-secondary mb-6">
            "Context rot: LLMs get stupider with more tokens"<br>
            <span class="text-sm">-- @mattpocockuk</span>
          </blockquote>

          <table class="context-table">
            <thead>
              <tr>
                <th>Context Level</th>
                <th>Quality Impact</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>0-50%</td>
                <td>Full capability</td>
              </tr>
              <tr>
                <td>50-70%</td>
                <td class="warning">Slight degradation possible</td>
              </tr>
              <tr>
                <td>70-85%</td>
                <td class="danger">Noticeable quality loss</td>
              </tr>
              <tr>
                <td>85-95%</td>
                <td class="danger">Significant degradation, instructions forgotten</td>
              </tr>
              <tr>
                <td>95%+</td>
                <td class="critical">Failure mode - hallucinations, contradictions, amnesia</td>
              </tr>
            </tbody>
          </table>

          <h4 class="font-semibold mb-3">What Context Rot Looks Like</h4>
          <ol class="list-decimal list-inside text-text-secondary mb-6 space-y-2">
            <li><strong>Repetition</strong> - Claude starts repeating earlier statements</li>
            <li><strong>Amnesia</strong> - Forgets work done 10 minutes ago</li>
            <li><strong>Instruction Drift</strong> - CLAUDE.md directives ignored</li>
            <li><strong>Truncation</strong> - Code cut off mid-function</li>
            <li><strong>Hallucination</strong> - References files that don't exist</li>
            <li><strong>False Completion</strong> - Marks tasks done without verification</li>
          </ol>
        </div>
      </section>

      <!-- Section 3: DESIGN DECISIONS -->
      <section id="why-fresh-context" data-activity="decisions">
        <h2 class="section-title">
          <span class="section-number">3</span>
          Design Decisions
        </h2>

        <div class="decision-box">
          <div class="decision-why">WHY FRESH CONTEXT?</div>
          <div class="decision-reasoning">
            At 80K tokens, Claude's quality degrades. Instructions get lost. The model contradicts itself. This is "context rot" - a fundamental limitation of transformer attention mechanisms, not a bug to fix.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              <strong>Kill and restart.</strong> Don't try to extend sessions. Each iteration spawns a NEW Claude instance with NO memory of previous work. Continuity comes from: Git history, prd.json, progress.txt. If iteration 20 produces worse code than iteration 5, your context is rotting. The fix is to restart, not debug.
            </div>
          </div>
        </div>

        <div class="decision-box" id="why-external-state">
          <div class="decision-why">WHY EXTERNAL STATE?</div>
          <div class="decision-reasoning">
            If each iteration is a fresh Claude with no memory, how does progress persist? Through files. Git commits, prd.json (task tracking), progress.txt (learnings). The filesystem IS the memory. Memory is external. The agent is stateless. This isn't a bug - it's the architecture that enables reliability.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Never rely on "Claude remembering" something. <strong>If it's not in a file, it doesn't exist.</strong> progress.txt must be append-only. prd.json must be updated after each task. Every learning must be persisted to be useful.
            </div>
          </div>
        </div>

        <div class="decision-box" id="why-files">
          <div class="decision-why">WHY FILES OVER IN-CONTEXT MEMORY?</div>
          <div class="decision-reasoning">
            Files don't degrade. Files don't get summarized lossy. Files can be queried with <code>jq</code>. Files survive session crashes. Files can be version controlled. In-context memory gets compressed, summarized, forgotten, contradicted.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Every piece of critical state belongs in one of three places: CLAUDE.md (project context), prd.json (task state), or progress.txt (learnings). If you're tempted to "tell Claude something to remember," write it to a file instead.
            </div>
          </div>
        </div>
      </section>

      <!-- Section 4: THE 5 STRATEGIES -->
      <section id="strategies" data-activity="strategies">
        <h2 class="section-title">
          <span class="section-number">4</span>
          The 5 Context Management Strategies
        </h2>

        <div class="strategy-card" id="strategy-fresh">
          <div class="strategy-header">
            <div class="strategy-number">1</div>
            <div class="strategy-title">Fresh Context Per Iteration</div>
          </div>
          <div class="strategy-description">
            Spawn a new agent instance for each task. No memory pollution. Clean slate always. This is the Ralph pattern's core insight.
          </div>

          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre><span class="comment">#!/bin/bash</span>
<span class="keyword">set</span> -e
MAX_ITERATIONS=<span class="variable">${1:-25}</span>

<span class="keyword">for</span> (( i=1; i&lt;=$MAX_ITERATIONS; i++ )); <span class="keyword">do</span>
  <span class="keyword">echo</span> <span class="string">"Iteration $i / $MAX_ITERATIONS"</span>

  claude <span class="string">"Review plans/prd.json and progress.txt.
    Pick ONE task with passes: false.
    Implement it. Run tests.
    If passing, mark passes: true and commit.
    Append learnings to progress.txt.
    If ALL tasks complete, output: &lt;promise&gt;COMPLETE&lt;/promise&gt;"</span> | tee output.txt

  <span class="keyword">if</span> grep -q <span class="string">"&lt;promise&gt;COMPLETE&lt;/promise&gt;"</span> output.txt; <span class="keyword">then</span>
    <span class="keyword">echo</span> <span class="string">"All tasks complete!"</span>
    <span class="keyword">break</span>
  <span class="keyword">fi</span>
<span class="keyword">done</span></pre>
          </div>

          <div class="checkpoint-box">
            <div class="checkpoint-title">
              <i data-lucide="check-circle" class="w-4 h-4"></i>
              Key Rules
            </div>
            <div class="checkpoint-content">
              <ul class="list-disc list-inside space-y-1">
                <li>Set <code>max-iterations</code> as safety limit (never infinite)</li>
                <li>Size tasks to complete in ONE iteration</li>
                <li>Use <code>&lt;promise&gt;COMPLETE&lt;/promise&gt;</code> as termination signal</li>
              </ul>
            </div>
          </div>
        </div>

        <div class="strategy-card" id="strategy-files">
          <div class="strategy-header">
            <div class="strategy-number">2</div>
            <div class="strategy-title">File-Based External State</div>
          </div>
          <div class="strategy-description">
            Store ALL state in files. The agent reconstructs context by reading, not by remembering.
          </div>

          <h4 class="font-semibold mb-3">The Three Core Files</h4>

          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre><span class="comment"># progress.txt - Append-Only Learning Log</span>
<span class="comment"># Purpose: Memory across iterations. Notes for "the next agent."</span>

---

## Iteration 1 (2026-01-09 10:00)
- <span class="keyword">Completed:</span> US-001 - Database schema created
- <span class="keyword">Learned:</span> Use .optional() with Zod for nullable fields
- <span class="keyword">Blocker:</span> None
- <span class="keyword">Next:</span> US-002 priority

---

## Iteration 2 (2026-01-09 10:15)
- <span class="keyword">Completed:</span> US-002 - API endpoint
- <span class="keyword">Learned:</span> Rate limiting needs 60s cooldown
- <span class="keyword">Issue:</span> Had to adjust Zod schema
- <span class="keyword">Pattern discovered:</span> Always test edge cases first</pre>
          </div>

          <div class="gotcha-box">
            <div class="gotcha-title">
              <i data-lucide="alert-triangle" class="w-4 h-4"></i>
              Critical Rule: APPEND ONLY
            </div>
            <div class="gotcha-detail">
              Never edit previous entries in progress.txt. Each iteration adds to history; none modify it.
            </div>
          </div>

          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre><span class="comment">// prd.json - Task State Tracking</span>
<span class="comment">// Purpose: Machine-readable task board with explicit pass/fail status</span>
{
  <span class="string">"project"</span>: <span class="string">"MyFeature"</span>,
  <span class="string">"branchName"</span>: <span class="string">"feature/user-auth"</span>,
  <span class="string">"userStories"</span>: [
    {
      <span class="string">"id"</span>: <span class="string">"US-001"</span>,
      <span class="string">"title"</span>: <span class="string">"Add users table with email and password_hash"</span>,
      <span class="string">"acceptanceCriteria"</span>: [
        <span class="string">"Column 'email' exists with unique constraint"</span>,
        <span class="string">"Column 'password_hash' is not null"</span>,
        <span class="string">"npm run typecheck passes"</span>
      ],
      <span class="string">"priority"</span>: <span class="number">1</span>,
      <span class="string">"passes"</span>: <span class="keyword">true</span>,
      <span class="string">"notes"</span>: <span class="string">"Completed iteration 1"</span>
    },
    {
      <span class="string">"id"</span>: <span class="string">"US-002"</span>,
      <span class="string">"title"</span>: <span class="string">"Create login endpoint"</span>,
      <span class="string">"acceptanceCriteria"</span>: [
        <span class="string">"POST /api/auth/login returns JWT on valid credentials"</span>,
        <span class="string">"Returns 401 on invalid credentials"</span>,
        <span class="string">"npm run test passes"</span>
      ],
      <span class="string">"priority"</span>: <span class="number">2</span>,
      <span class="string">"passes"</span>: <span class="keyword">false</span>
    }
  ]
}</pre>
          </div>

          <p class="text-text-secondary text-sm mb-4">
            <strong>Why JSON over Markdown:</strong> Deterministic parsing, explicit <code>passes: true/false</code> state, can be queried with <code>jq</code>, less ambiguous for LLM updates.
          </p>
        </div>

        <div class="strategy-card" id="strategy-git">
          <div class="strategy-header">
            <div class="strategy-number">3</div>
            <div class="strategy-title">Git as Memory</div>
          </div>
          <div class="strategy-description">
            Git history is the ultimate external memory. Code changes persist across agent resets.
          </div>

          <h4 class="font-semibold mb-3">What Git Provides</h4>
          <ol class="list-decimal list-inside text-text-secondary mb-6 space-y-2">
            <li><strong>Commits as Checkpoints</strong> - Each iteration's work is preserved</li>
            <li><strong>Diff as Context</strong> - Agent can read what changed</li>
            <li><strong>History as Narrative</strong> - Sequence of changes tells the story</li>
            <li><strong>Rollback as Safety</strong> - Bad changes can be reverted</li>
          </ol>

          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre><span class="comment"># Git Worktrees for Parallel Agents</span>
<span class="comment"># When running multiple agents simultaneously:</span>

<span class="comment"># Create isolated worktrees</span>
git worktree add ../wt-backend feature/backend
git worktree add ../wt-frontend feature/frontend

<span class="comment"># Run parallel Ralph loops</span>
(cd ../wt-backend && ./ralph.sh 20) &
(cd ../wt-frontend && ./ralph.sh 20) &
wait

<span class="comment"># Merge results</span>
git merge wt-backend wt-frontend</pre>
          </div>

          <p class="text-text-secondary text-sm">
            <strong>Benefits:</strong> True isolation (no file conflicts), shared git history, can run on separate machines.
          </p>
        </div>

        <div class="strategy-card" id="strategy-external">
          <div class="strategy-header">
            <div class="strategy-number">4</div>
            <div class="strategy-title">External Memory Systems</div>
          </div>
          <div class="strategy-description">
            Database-backed persistent memory that outlives individual sessions. For long-term projects with compound learning.
          </div>

          <h4 class="font-semibold mb-3">Claude-Mem: Semantic Memory Plugin</h4>

          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre><span class="comment"># Installation</span>
/plugin marketplace add thedotmack/claude-mem
/plugin install claude-mem
<span class="comment"># Restart Claude Code</span>

<span class="comment"># Configuration (~/.claude-mem/settings.json)</span>
{
  <span class="string">"ai_model"</span>: <span class="string">"claude-3-opus-20240229"</span>,
  <span class="string">"context_injection_rules"</span>: {
    <span class="string">"auto_inject"</span>: <span class="keyword">true</span>,
    <span class="string">"max_tokens"</span>: <span class="number">5000</span>
  }
}</pre>
          </div>

          <p class="text-text-secondary text-sm mb-4">
            <strong>How It Works:</strong> Lifecycle hooks log all session events to SQLite. Agent-SDK generates semantic summaries (~50-100 tokens per session). 3-layer retrieval system (search, timeline, full details). Auto-inject relevant context into new sessions.
          </p>

          <table class="context-table">
            <thead>
              <tr>
                <th>When External Memory Helps</th>
                <th>When External Memory Hurts</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Long-term projects (compound learning)</td>
                <td>Fresh start needed (stale injection)</td>
              </tr>
              <tr>
                <td>Repetitive patterns ("I've done this before")</td>
                <td>Changed codebase (outdated patterns)</td>
              </tr>
              <tr>
                <td>Complex debugging (remember attempts)</td>
                <td>Different project (cross-contamination)</td>
              </tr>
              <tr>
                <td>Team knowledge (shared learnings)</td>
                <td>Token budget tight (injection costs)</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="strategy-card" id="strategy-compaction">
          <div class="strategy-header">
            <div class="strategy-number">5</div>
            <div class="strategy-title">Compaction and Optimization</div>
          </div>
          <div class="strategy-description">
            Strategically compress context to extend working capacity. Use sparingly - compaction is lossy.
          </div>

          <h4 class="font-semibold mb-3">When Compaction Helps</h4>
          <ul class="list-disc list-inside text-text-secondary mb-4 space-y-1">
            <li><strong>Approaching 60-70% context</strong> - Preemptive cleanup</li>
            <li><strong>Exploratory work</strong> - After browsing many files</li>
            <li><strong>Debugging sessions</strong> - Error messages accumulate</li>
            <li><strong>Long conversations</strong> - Before quality degrades</li>
          </ul>

          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre><span class="comment"># Compaction Commands</span>
/compact              <span class="comment"># Compress current context</span>
/reset                <span class="comment"># Full reset (last resort)</span></pre>
          </div>

          <div class="hard-box">
            <div class="hard-title">
              <i data-lucide="flame" class="w-4 h-4"></i>
              Compaction is LOSSY
            </div>
            <div class="hard-detail">
              Details get summarized. Instructions may be lost. Prefer fresh context via Ralph loops over repeated compaction.
            </div>
          </div>

          <h4 class="font-semibold mb-3 mt-6">Subagent Token Isolation</h4>
          <blockquote class="border-l-4 border-accent pl-4 italic text-text-secondary mb-4">
            "Put costly tools like browser control in subagents to protect your main context window tokens"<br>
            <span class="text-sm">-- @TendiesOfWisdom</span>
          </blockquote>

          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre><span class="comment"># Main agent stays lean</span>
main_agent.delegate(
    task=<span class="string">"Test login flow in browser"</span>,
    subagent=<span class="string">"playwright-worker"</span>,
    return_summary_only=<span class="keyword">True</span>  <span class="comment"># Don't bring full output back</span>
)</pre>
          </div>

          <p class="text-text-secondary text-sm">
            <strong>Key insight:</strong> Subagents have their own context window. Only their summary returns to main context.
          </p>
        </div>
      </section>

      <!-- Section 5: DECISION FLOW -->
      <section id="decision-tree" data-activity="path">
        <h2 class="section-title">
          <span class="section-number">5</span>
          Decision Flow
        </h2>

        <p class="text-text-secondary mb-6">
          Follow this tree to select the right context management strategy:
        </p>

        <div class="path-container">
          <div class="path-step">
            <div class="path-number">1</div>
            <div class="path-content"><strong>START:</strong> "I need to work on X with Claude Code"</div>
          </div>
          <div class="path-step">
            <div class="path-number">2</div>
            <div class="path-content">Is X a single, small task (&lt; 30 min)?<br>
              <span class="text-accent">YES</span> -> Single session, no special context management<br>
              <span class="text-red-500">NO</span> -> Continue
            </div>
          </div>
          <div class="path-step">
            <div class="path-number">3</div>
            <div class="path-content">Will X span multiple sessions?<br>
              <span class="text-accent">YES</span> -> Use file-based state (prd.json + progress.txt)<br>
              <span class="text-red-500">NO</span> -> Consider fresh context per iteration anyway
            </div>
          </div>
          <div class="path-step">
            <div class="path-number">4</div>
            <div class="path-content">Is X truly long-running (hours/overnight)?<br>
              <span class="text-accent">YES</span> -> Full Ralph loop with external state<br>
              <span class="text-red-500">NO</span> -> May not need automation
            </div>
          </div>
          <div class="path-step">
            <div class="path-number">5</div>
            <div class="path-content">Do I need to run multiple agents in parallel?<br>
              <span class="text-accent">YES</span> -> Git worktrees + parallel Ralph loops<br>
              <span class="text-red-500">NO</span> -> Single agent workflow
            </div>
          </div>
          <div class="path-step">
            <div class="path-number">6</div>
            <div class="path-content">Does this project have long-term knowledge to preserve?<br>
              <span class="text-accent">YES</span> -> Consider Claude-Mem or structured archives<br>
              <span class="text-red-500">NO</span> -> Fresh context patterns sufficient
            </div>
          </div>
          <div class="path-step">
            <div class="path-number">7</div>
            <div class="path-content"><strong>END:</strong> Select appropriate strategy</div>
          </div>
        </div>

        <div class="budget-box" id="context-budget">
          <div class="budget-title">
            <i data-lucide="calculator" class="w-4 h-4"></i>
            Recommended Context Budget (~100K Effective)
          </div>
          <div class="budget-item">
            <span class="budget-label">System prompt + CLAUDE.md</span>
            <span class="budget-value">~5K (5%)</span>
          </div>
          <div class="budget-item">
            <span class="budget-label">Codebase context</span>
            <span class="budget-value">~20K (20%)</span>
          </div>
          <div class="budget-item">
            <span class="budget-label">Current task</span>
            <span class="budget-value">~2K (2%)</span>
          </div>
          <div class="budget-item">
            <span class="budget-label">Working memory</span>
            <span class="budget-value">~30K (30%)</span>
          </div>
          <div class="budget-item">
            <span class="budget-label">Tool outputs</span>
            <span class="budget-value">~20K (20%)</span>
          </div>
          <div class="budget-item">
            <span class="budget-label">Code generation</span>
            <span class="budget-value">~15K (15%)</span>
          </div>
          <div class="budget-item">
            <span class="budget-label">Buffer for retries</span>
            <span class="budget-value">~8K (8%)</span>
          </div>
        </div>

        <h4 class="font-semibold mb-3">Per-Activity Token Estimates</h4>
        <table class="context-table">
          <thead>
            <tr>
              <th>Activity</th>
              <th>Tokens</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Read file (50 lines)</td>
              <td>~1K</td>
            </tr>
            <tr>
              <td>Git diff (small)</td>
              <td>~500</td>
            </tr>
            <tr>
              <td>Test output</td>
              <td>~2K</td>
            </tr>
            <tr>
              <td>Error message</td>
              <td>~500</td>
            </tr>
            <tr>
              <td>MCP tool call</td>
              <td>~1K overhead</td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- Section 6: GOTCHAS -->
      <section id="gotchas" data-activity="gotchas">
        <h2 class="section-title">
          <span class="section-number">6</span>
          Gotchas
        </h2>

        <p class="text-text-secondary mb-6">
          Real problems you'll hit, with concrete numbers and fixes:
        </p>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            progress.txt growing unbounded
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> After ~50 iterations, Claude spends more tokens reading than thinking</div>
          <div class="gotcha-detail"><strong>Threshold:</strong> >20KB progress.txt starts degrading quality</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Truncate to last 10 entries between runs. Move permanent learnings to AGENTS.md.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            "APPEND" gets ignored
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> progress.txt keeps getting overwritten, losing learnings</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Model interprets "update" as "replace"</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Use "APPEND" in CAPS in prompt.md. The capitalization matters.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            prd.json in inconsistent state
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Tasks marked done that aren't, passes field not updating</div>
          <div class="gotcha-detail"><strong>Cause:</strong> JSON parsing/writing issues, or agent confusion</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Validate with <code>jq . plans/prd.json</code>, fix manually, or regenerate from git history.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Git history not being used as context
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Agent doesn't know what was already done, repeats work</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Not instructed to read git history</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Add to prompt: "Before starting: 1. Run git log --oneline -10. 2. Run git diff HEAD~3. 3. Don't repeat already-completed work."</div>
        </div>

        <div id="warning-signs">
          <h3 class="font-semibold text-lg mb-4 mt-8">Context Rot Warning Signs</h3>
          <table class="context-table">
            <thead>
              <tr>
                <th>Sign</th>
                <th>Severity</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Repeating earlier statements</td>
                <td class="warning">Medium</td>
                <td>Monitor closely</td>
              </tr>
              <tr>
                <td>Instructions ignored</td>
                <td class="danger">High</td>
                <td>Compact or reset</td>
              </tr>
              <tr>
                <td>Forgetting recent changes</td>
                <td class="danger">High</td>
                <td>Start fresh session</td>
              </tr>
              <tr>
                <td>Contradictory responses</td>
                <td class="critical">Critical</td>
                <td>Reset immediately</td>
              </tr>
              <tr>
                <td>Hallucinated files</td>
                <td class="critical">Critical</td>
                <td>Reset + verify state</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Section 7: WHAT'S HARD -->
      <section id="hard" data-activity="hard">
        <h2 class="section-title">
          <span class="section-number">7</span>
          What's Hard
        </h2>

        <p class="text-text-secondary mb-6">
          These are fundamental tensions, not bugs to fix:
        </p>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Context Rot vs. Memory Loss
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Fresh context avoids rot but loses learnings. progress.txt helps but grows unbounded. No perfect solution exists.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Quality drops in late iterations (rot), OR early iterations repeat mistakes from archived runs (memory loss).</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Keep progress.txt under 20KB. Start fresh runs from AGENTS.md (permanent), not progress.txt (session). Accept that some re-learning is the cost of fresh context.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            The 200K/100K Gap
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Claude has 200K token context window, but quality degrades significantly after 100K. You have half the context you think you have.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> "I thought I had plenty of room" followed by quality collapse.</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Budget for 100K effective. Monitor usage with Claude HUD. Plan compaction or session restart at 60-70%.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Compaction Information Loss
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Compaction frees tokens but loses detail. You can't predict what will be lost.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> After /compact, Claude missing key information you expected it to remember.</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Before compacting, externalize important state to files. Prefer fresh context over compaction when possible.</div>
        </div>

        <div class="philosophy-stack">
          <div class="philosophy-item">
            <div class="philosophy-level">Foundation</div>
            <div class="philosophy-text">Stateless Agent, Stateful Environment - The agent remembers nothing. The filesystem remembers everything.</div>
          </div>
          <div class="philosophy-item">
            <div class="philosophy-level">Architecture</div>
            <div class="philosophy-text">External Memory Over Internal - Git history > conversation history. Files > context window. Commits > compaction.</div>
          </div>
          <div class="philosophy-item">
            <div class="philosophy-level">Operation</div>
            <div class="philosophy-text">Fresh Context Over Extended Sessions - New instances > long conversations. Clean slate > accumulated pollution.</div>
          </div>
          <div class="philosophy-item">
            <div class="philosophy-level">Protection</div>
            <div class="philosophy-text">Monitor and Reset - Track context usage. Compact before degradation. Reset when compromised.</div>
          </div>
        </div>
      </section>

      <!-- Section 8: WHEN TO USE -->
      <section id="when" data-activity="when">
        <h2 class="section-title">
          <span class="section-number">8</span>
          When to Use Each Strategy
        </h2>

        <div class="when-grid">
          <div class="when-use">
            <div class="when-title">
              <i data-lucide="check" class="w-5 h-5"></i>
              USE FRESH CONTEXT WHEN
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Long-running autonomous work (hours/overnight)</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Quality must remain consistent across many tasks</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Tasks can be sized to fit one context window</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>You have verifiable acceptance criteria</span>
            </div>
          </div>

          <div class="when-not">
            <div class="when-title">
              <i data-lucide="x" class="w-5 h-5"></i>
              USE SINGLE SESSION WHEN
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Quick task (&lt;30 minutes)</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Exploratory debugging (need context of attempts)</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Interactive collaboration (human in tight loop)</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Tasks that don't decompose well</span>
            </div>
          </div>
        </div>

        <div id="tradeoffs">
          <h3 class="font-semibold text-lg mb-4">Tradeoff Matrix</h3>
          <table class="context-table">
            <thead>
              <tr>
                <th>Strategy</th>
                <th>Freshness</th>
                <th>Continuity</th>
                <th>Complexity</th>
                <th>Best For</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>Single Session</strong></td>
                <td>High</td>
                <td>None</td>
                <td>Low</td>
                <td>Quick tasks</td>
              </tr>
              <tr>
                <td><strong>Fresh Context / Ralph</strong></td>
                <td>High</td>
                <td>Via files</td>
                <td>Medium</td>
                <td>Features, long work</td>
              </tr>
              <tr>
                <td><strong>File-Based State</strong></td>
                <td>High</td>
                <td>High</td>
                <td>Medium</td>
                <td>Multi-session projects</td>
              </tr>
              <tr>
                <td><strong>Git as Memory</strong></td>
                <td>High</td>
                <td>High</td>
                <td>Low</td>
                <td>All projects</td>
              </tr>
              <tr>
                <td><strong>Claude-Mem</strong></td>
                <td>Medium</td>
                <td>Very High</td>
                <td>High</td>
                <td>Long-term projects</td>
              </tr>
              <tr>
                <td><strong>Compaction</strong></td>
                <td>Medium</td>
                <td>Medium</td>
                <td>Low</td>
                <td>Session extension</td>
              </tr>
              <tr>
                <td><strong>Subagent Delegation</strong></td>
                <td>High</td>
                <td>N/A</td>
                <td>High</td>
                <td>Expensive operations</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="checkpoint-box mt-8">
          <div class="checkpoint-title">
            <i data-lucide="book-open" class="w-4 h-4"></i>
            The 10 Context Management Commandments
          </div>
          <div class="checkpoint-content">
            <ol class="list-decimal list-inside space-y-2">
              <li><strong>Context is finite.</strong> Treat it like a precious resource.</li>
              <li><strong>Fresh > Extended.</strong> New instances beat long sessions.</li>
              <li><strong>Files > Memory.</strong> External state beats internal context.</li>
              <li><strong>Git is your friend.</strong> Commits are checkpoints.</li>
              <li><strong>Size tasks small.</strong> One iteration, one task.</li>
              <li><strong>Monitor always.</strong> Know your context usage.</li>
              <li><strong>Compact early.</strong> 60-70%, not 90%.</li>
              <li><strong>Verify everything.</strong> Tests catch context-rot errors.</li>
              <li><strong>Subagents isolate.</strong> Expensive ops in their own context.</li>
              <li><strong>Archive and learn.</strong> Yesterday's runs teach tomorrow's.</li>
            </ol>
          </div>
        </div>
      </section>

    </main>

    <!-- Resizer between Main Panel and Activity Zone -->
    <div class="resizer" data-resizer="activity-zone" aria-label="Resize activity panel"></div>

    <!-- Activity Zone -->
    <aside class="activity-zone" id="activityZone">
      <div class="text-xs font-semibold text-text-muted uppercase tracking-wider mb-4">Operational Intelligence</div>

      <!-- ESSENCE SECTION -->
      <div class="activity-item inversion" data-section="essence">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if context DIDN'T degrade?</div>
        <div class="text-text-secondary text-sm">
          <strong>You'd design:</strong> One long session per feature, no external files, no restarts, accumulated knowledge building forever.<br>
          <strong>Why this fails:</strong> 80K token context rot is transformer physics, not a bug. Attention degrades.<br>
          <strong>Hidden constraint revealed:</strong> Context management patterns exist BECAUSE degradation is inevitable.
        </div>
      </div>

      <div class="activity-item minimal" data-section="essence">
        <div class="activity-label" style="color: #84cc16;">
          <i data-lucide="minimize-2" class="w-4 h-4"></i>
          Minimal Pattern
        </div>
        <div class="font-medium text-text-primary mb-2">The irreducible core</div>
        <div class="text-text-secondary text-sm">
          <strong>Essential:</strong> Fresh context (kill and restart).<br>
          <strong>Essential:</strong> External state (files persist).<br>
          <strong>Everything else:</strong> Refinement for specific use cases (Claude-Mem, subagents, compaction).
        </div>
      </div>

      <div class="activity-item warstory" data-section="essence">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">Matt Pocock: Context rot awareness</div>
        <div class="text-text-secondary text-sm">
          "Context rot: LLMs get stupider with more tokens." Matt's observation became a rallying cry for the fresh context movement. Led to widespread adoption of iteration-based workflows over extended sessions.
        </div>
      </div>

      <!-- CORE SECTION -->
      <div class="activity-item gradient" data-section="core">
        <div class="activity-label" style="color: #f43f5e;">
          <i data-lucide="trending-down" class="w-4 h-4"></i>
          Failure Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">How context degrades (invisibly)</div>
        <div class="text-text-secondary text-sm">
          <strong>100% -> 90%</strong> (40-60K): Subtle drift, you won't notice<br>
          <strong>90% -> 70%</strong> (60-80K): Repetition, compression beginning<br>
          <strong>70% -> 50%</strong> (80-100K): Instructions forgotten, CLAUDE.md ignored<br>
          <strong>50% -> CLIFF</strong> (100K+): Hallucinations, amnesia, contradictions<br><br>
          <em>Critical: The gradient is invisible until the cliff. By the time you notice, quality is already compromised.</em>
        </div>
      </div>

      <div class="activity-item analogy" data-section="core">
        <div class="activity-label" style="color: #d946ef;">
          <i data-lucide="git-compare" class="w-4 h-4"></i>
          Analogical Bridge
        </div>
        <div class="font-medium text-text-primary mb-2">Context Management = Computer Memory Hierarchy</div>
        <div class="text-text-secondary text-sm">
          <strong>In-context (conversation)</strong> = CPU registers (fast, tiny, volatile)<br>
          <strong>progress.txt</strong> = RAM (fast, medium, session-scoped)<br>
          <strong>CLAUDE.md</strong> = L2 cache (warm start, project-scoped)<br>
          <strong>Git history</strong> = Disk (slow, huge, persistent)<br>
          <strong>Claude-Mem</strong> = Database (queryable, cross-session)<br><br>
          <em>If you've optimized memory hierarchies, you already understand context management.</em>
        </div>
      </div>

      <div class="activity-item invariant" data-section="core">
        <div class="activity-label" style="color: #3b82f6;">
          <i data-lucide="link" class="w-4 h-4"></i>
          Invariant Connection
        </div>
        <div class="font-medium text-text-primary mb-2">INV-003: External state > internal memory</div>
        <div class="text-text-secondary text-sm">
          Ralph, Gas Town, CC Mirror, Personal Panopticon - all share this invariant. The filesystem IS the memory. The agent is stateless. This principle appears in every successful orchestration pattern.
        </div>
      </div>

      <!-- DECISIONS SECTION -->
      <div class="activity-item constraint" data-section="decisions">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="link-2" class="w-4 h-4"></i>
          Constraint Chain
        </div>
        <div class="font-medium text-text-primary mb-2">One constraint -> SEVEN decisions</div>
        <div class="text-text-secondary text-sm">
          <strong>ROOT:</strong> Context finite (200K) -> Quality degrades as context fills<br>
          -> Fresh context beats extended sessions<br>
          -> State must persist externally (files)<br>
          -> Each iteration must be self-contained<br>
          -> Tasks must complete in one context window<br>
          -> Verification must be automatable<br>
          -> Subagents isolate expensive operations<br>
          -> Compaction is emergency, not strategy
        </div>
      </div>

      <div class="activity-item violation" data-section="decisions">
        <div class="activity-label" style="color: #f97316;">
          <i data-lucide="alert-octagon" class="w-4 h-4"></i>
          Violation Chain
        </div>
        <div class="font-medium text-text-primary mb-2">If you rely on "Claude remembering"</div>
        <div class="text-text-secondary text-sm">
          <strong>IF:</strong> You rely on in-context memory instead of files<br>
          <strong>THEN:</strong> Next iteration has no knowledge of previous<br>
          <strong>THEN:</strong> Same mistakes repeated, same questions asked<br>
          <strong>THEN:</strong> No velocity increase over iterations<br>
          <strong>FINALLY:</strong> Iteration 20 is as slow as iteration 1<br><br>
          <em>The fix: "If it's not in a file, it doesn't exist."</em>
        </div>
      </div>

      <div class="activity-item tradeoff" data-section="decisions">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="scale" class="w-4 h-4"></i>
          Trade-Off Tension
        </div>
        <div class="font-medium text-text-primary mb-2">The Context Richness Dilemma</div>
        <div class="text-text-secondary text-sm">
          <strong>Rich context:</strong> More files loaded = better understanding, but context fills faster<br>
          <strong>Lean context:</strong> Less loaded = more room for work, but may miss important context<br>
          <strong>External state:</strong> More in files = less in context, but reading files costs tokens too<br><br>
          <em>Heuristic: Load only what's needed for the current task. .claudeignore aggressively.</em>
        </div>
      </div>

      <!-- STRATEGIES SECTION -->
      <div class="activity-item expertise" data-section="strategies">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
          Expertise Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">How deep is your understanding?</div>
        <div class="text-text-secondary text-sm">
          <strong>Beginner:</strong> "What files do I need?" -> CLAUDE.md, prd.json, progress.txt<br>
          <strong>Intermediate:</strong> "Why these files?" -> Each serves ONE purpose in state management<br>
          <strong>Advanced:</strong> "When to use each strategy?" -> Match strategy to task duration<br>
          <strong>Staff:</strong> "How do strategies compose?" -> Ralph + Git + Claude-Mem layers<br>
          <strong>Expert:</strong> "What's the fundamental constraint?" -> Attention degradation is physics
        </div>
      </div>

      <div class="activity-item composition" data-section="strategies">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="layers" class="w-4 h-4"></i>
          Composition Case
        </div>
        <div class="font-medium text-text-primary mb-2">Fresh Context + Claude-Mem</div>
        <div class="text-text-secondary text-sm">
          <strong>Works?</strong> Yes, complementary.<br>
          <strong>Why:</strong> Fresh context prevents rot. Claude-Mem provides cross-session learning. Best of both worlds.<br>
          <strong>Danger:</strong> Claude-Mem injection consumes tokens. Keep max_tokens low (2000-5000).<br>
          <strong>Recommendation:</strong> Use for long-term projects where compound learning outweighs injection cost.
        </div>
      </div>

      <div class="activity-item composition" data-section="strategies">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="layers" class="w-4 h-4"></i>
          Composition Case
        </div>
        <div class="font-medium text-text-primary mb-2">Subagents + Playwright</div>
        <div class="text-text-secondary text-sm">
          <strong>Works?</strong> Essential combination.<br>
          <strong>Why:</strong> Browser automation generates massive token output. Keeping it in main context would cause rapid exhaustion.<br>
          <strong>Pattern:</strong> delegate(task, subagent, return_summary_only=True)<br>
          <strong>Benefit:</strong> Visual verification without context cost.
        </div>
      </div>

      <div class="activity-item warstory" data-section="strategies">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">Ryan Carson: Overnight development</div>
        <div class="text-text-secondary text-sm">
          Ran Ralph loops overnight for Untangle Legal Agent. Key insight: "Learnings compound. By story 10, Ralph knew our patterns." The progress.txt paid off in later iterations. Fresh context prevented rot; file-based state preserved learnings.
        </div>
      </div>

      <!-- PATH SECTION -->
      <div class="activity-item horizon" data-section="path">
        <div class="activity-label" style="color: #06b6d4;">
          <i data-lucide="clock" class="w-4 h-4"></i>
          Time Horizon Shift
        </div>
        <div class="font-medium text-text-primary mb-2">How strategy choice evolves with project duration</div>
        <div class="text-text-secondary text-sm">
          <strong>30 min task:</strong> "Just use single session, why complicate?"<br>
          <strong>2 hour feature:</strong> "Maybe I should use files..."<br>
          <strong>Overnight run:</strong> "Fresh context essential. Files are memory."<br>
          <strong>Week-long project:</strong> "Claude-Mem + structured archives + git as truth"<br><br>
          <em>Strategy choice is a function of time horizon.</em>
        </div>
      </div>

      <div class="activity-item inversion" data-section="path">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if you used Claude-Mem for everything?</div>
        <div class="text-text-secondary text-sm">
          <strong>You'd get:</strong> Cross-session memory always, compound learning everywhere.<br>
          <strong>Why this fails:</strong> Stale context injection for short tasks. Token cost for simple work. Cross-project contamination. Overhead that doesn't pay off.<br>
          <strong>Hidden constraint revealed:</strong> Complexity has cost. Match strategy to need.
        </div>
      </div>

      <div class="activity-item effect" data-section="path">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="bar-chart-2" class="w-4 h-4"></i>
          Second-Order Effect
        </div>
        <div class="font-medium text-text-primary mb-2">Context monitoring creates its own overhead</div>
        <div class="text-text-secondary text-sm">
          <strong>At scale:</strong> Checking context usage, running Claude HUD, tracking percentages - all consume mental bandwidth.<br>
          <strong>Implication:</strong> For quick tasks, monitoring overhead exceeds benefit. Only monitor for long work.<br>
          <strong>Threshold:</strong> Don't monitor sessions under 30 minutes.
        </div>
      </div>

      <!-- GOTCHAS SECTION -->
      <div class="activity-item inflection" data-section="gotchas">
        <div class="activity-label" style="color: #eab308;">
          <i data-lucide="activity" class="w-4 h-4"></i>
          Inflection Point
        </div>
        <div class="font-medium text-text-primary mb-2">When progress.txt flips from help to hurt</div>
        <div class="text-text-secondary text-sm">
          <strong>0-10KB:</strong> Pure benefit (learnings compound)<br>
          <strong>10-20KB:</strong> Diminishing returns (more to read each iteration)<br>
          <strong>20-30KB:</strong> Neutral (reading cost = thinking benefit)<br>
          <strong>30KB+:</strong> Net negative (context wasted on history)<br><br>
          <strong>THE INFLECTION:</strong> ~20KB<br>
          <em>Detection: Late iterations worse than early? Check progress.txt size.</em>
        </div>
      </div>

      <div class="activity-item violation" data-section="gotchas">
        <div class="activity-label" style="color: #f97316;">
          <i data-lucide="alert-octagon" class="w-4 h-4"></i>
          Violation Chain
        </div>
        <div class="font-medium text-text-primary mb-2">If you skip .claudeignore</div>
        <div class="text-text-secondary text-sm">
          <strong>IF:</strong> No .claudeignore, Claude reads everything<br>
          <strong>THEN:</strong> node_modules, dist, logs all loaded<br>
          <strong>THEN:</strong> Context fills with irrelevant content<br>
          <strong>THEN:</strong> Less room for actual work<br>
          <strong>FINALLY:</strong> Quality degrades faster than necessary<br><br>
          <em>The fix: Aggressive .claudeignore. Every ignored file saves tokens.</em>
        </div>
      </div>

      <div class="activity-item frontier" data-section="gotchas">
        <div class="activity-label" style="color: #ef4444;">
          <i data-lucide="flask-conical" class="w-4 h-4"></i>
          Research Frontier
        </div>
        <div class="font-medium text-text-primary mb-2">UNSOLVED: Optimal compaction timing</div>
        <div class="text-text-secondary text-sm">
          <strong>The question:</strong> When exactly should you compact? At what % context? After what activities?<br>
          <strong>Why it's hard:</strong> Compaction is lossy. Optimal varies by task type. No way to predict what gets lost.<br>
          <strong>Current best practice:</strong> Compact at 60-70%, or prefer fresh session instead.
        </div>
      </div>

      <div class="activity-item gradient" data-section="gotchas">
        <div class="activity-label" style="color: #f43f5e;">
          <i data-lucide="trending-down" class="w-4 h-4"></i>
          Failure Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">CLAUDE.md quality degradation</div>
        <div class="text-text-secondary text-sm">
          <strong>0-200 tokens:</strong> Perfect recall, all directives followed<br>
          <strong>200-400 tokens:</strong> Good recall, occasional misses<br>
          <strong>400-600 tokens:</strong> Important rules sometimes forgotten<br>
          <strong>600+ tokens:</strong> Significant portions ignored<br><br>
          <em>Target: Under 500 tokens. Every token in CLAUDE.md costs context elsewhere.</em>
        </div>
      </div>

      <!-- HARD SECTION -->
      <div class="activity-item tradeoff" data-section="hard">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="scale" class="w-4 h-4"></i>
          Trade-Off Tension
        </div>
        <div class="font-medium text-text-primary mb-2">The 200K/100K Paradox</div>
        <div class="text-text-secondary text-sm">
          <strong>THE DILEMMA:</strong><br>
          Claude advertises 200K context. Reality is 100K effective.<br>
          Users plan for 200K. Quality fails at 100K.<br>
          The gap creates false confidence.<br><br>
          <strong>WHY NO PERFECT ANSWER:</strong><br>
          200K is technically possible. It's just not quality-preserving. The limit is soft, not hard.<br><br>
          <em>Accept: Budget for 100K. Anything beyond is risk.</em>
        </div>
      </div>

      <div class="activity-item expertise" data-section="hard">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
          Expertise Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">Context Management Understanding</div>
        <div class="text-text-secondary text-sm">
          <strong>Beginner:</strong> "Why does Claude keep forgetting?" -> Context limits<br>
          <strong>Intermediate:</strong> "How do I prevent forgetting?" -> Fresh context + files<br>
          <strong>Advanced:</strong> "How do I optimize for my use case?" -> Strategy selection<br>
          <strong>Staff:</strong> "What are the fundamental tradeoffs?" -> Freshness vs continuity<br>
          <strong>Expert:</strong> "What's the physics?" -> Attention mechanism degradation
        </div>
      </div>

      <div class="activity-item warstory" data-section="hard">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">Molly Cantillon: Personal Panopticon</div>
        <div class="text-text-secondary text-sm">
          8 parallel Claude instances managing different life domains. Key architecture: Each instance has its own context, isolated from others. Shared state through external files only. The pattern scales because each agent stays fresh.
        </div>
      </div>

      <!-- WHEN SECTION -->
      <div class="activity-item analogy" data-section="when">
        <div class="activity-label" style="color: #d946ef;">
          <i data-lucide="git-compare" class="w-4 h-4"></i>
          Analogical Bridge
        </div>
        <div class="font-medium text-text-primary mb-2">Strategy Selection = Caching Strategy</div>
        <div class="text-text-secondary text-sm">
          <strong>Single session</strong> = No caching (everything in memory)<br>
          <strong>File-based state</strong> = Write-through cache (always persist)<br>
          <strong>Claude-Mem</strong> = Smart cache with eviction policy<br>
          <strong>Compaction</strong> = Cache compression (lossy)<br><br>
          <em>Match caching strategy to access pattern. Same applies to context.</em>
        </div>
      </div>

      <div class="activity-item alternative" data-section="when">
        <div class="activity-label" style="color: #6b7280;">
          <i data-lucide="arrow-right" class="w-4 h-4"></i>
          Alternative Paths
        </div>
        <div class="font-medium text-text-primary mb-2">If these strategies don't fit</div>
        <div class="text-text-secondary text-sm">
          <strong>Need real-time collaboration?</strong> -> Human-in-tight-loop, skip automation<br>
          <strong>Need cross-agent coordination?</strong> -> CC Mirror pattern<br>
          <strong>Need subjective evaluation?</strong> -> HOTL (Human On The Loop) variants<br>
          <strong>Need massive parallelism?</strong> -> Gas Town factory architecture
        </div>
      </div>

      <div class="activity-item invariant" data-section="when">
        <div class="activity-label" style="color: #3b82f6;">
          <i data-lucide="link" class="w-4 h-4"></i>
          Invariant Connection
        </div>
        <div class="font-medium text-text-primary mb-2">INV-002: Fresh context > extended sessions</div>
        <div class="text-text-secondary text-sm">
          This invariant appears across ALL patterns documented in this knowledge base. Ralph, Gas Town, CC Mirror, Personal Panopticon - they all spawn fresh instances rather than extending sessions. It's not preference; it's physics.
        </div>
      </div>

      <div class="activity-item horizon" data-section="when">
        <div class="activity-label" style="color: #06b6d4;">
          <i data-lucide="clock" class="w-4 h-4"></i>
          Time Horizon Shift
        </div>
        <div class="font-medium text-text-primary mb-2">How judgment about context management evolves</div>
        <div class="text-text-secondary text-sm">
          <strong>Week 1:</strong> "Why all these files? Just use Claude."<br>
          <strong>Week 2:</strong> "Claude keeps forgetting things..."<br>
          <strong>Week 4:</strong> "Files ARE the memory. Claude is just the processor."<br>
          <strong>Month 2:</strong> "I've internalized stateless architecture."<br><br>
          <em>Don't judge file-based state by day 1 overhead.</em>
        </div>
      </div>

      <div class="activity-item effect" data-section="when">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="bar-chart-2" class="w-4 h-4"></i>
          Second-Order Effect
        </div>
        <div class="font-medium text-text-primary mb-2">External state enables reproducibility</div>
        <div class="text-text-secondary text-sm">
          <strong>At scale:</strong> When state is in files (not context), you can: replay runs, share with teammates, debug failures, audit decisions.<br>
          <strong>Implication:</strong> File-based state isn't just about memory - it's about observability.<br>
          <strong>Threshold:</strong> Any project where you might need to explain "what happened" benefits from external state.
        </div>
      </div>

    </aside>
  </div>

  <script>
    /**
     * PanelResizer - Handles draggable panel dividers
     */
    class PanelResizer {
      constructor(resizerEl, config = {}) {
        this.resizer = resizerEl;
        this.config = {
          storageKey: 'panel-activity-zone-width',
          minWidth: 280,
          maxWidth: 900,
          defaultWidth: 480,
          ...config
        };

        this.isResizing = false;
        this.startX = 0;
        this.startWidth = 0;

        this.activityZone = document.querySelector('.activity-zone');
        this.mainContent = document.querySelector('.main-content');

        this.onMouseDown = this.onMouseDown.bind(this);
        this.onMouseMove = this.onMouseMove.bind(this);
        this.onMouseUp = this.onMouseUp.bind(this);

        this.init();
      }

      init() {
        this.restoreWidth();
        this.resizer.addEventListener('mousedown', this.onMouseDown);
      }

      onMouseDown(e) {
        if (e.button !== 0) return;

        this.isResizing = true;
        this.startX = e.clientX;
        this.startWidth = this.activityZone.offsetWidth;

        this.resizer.classList.add('active');
        document.body.classList.add('resizing');

        document.addEventListener('mousemove', this.onMouseMove);
        document.addEventListener('mouseup', this.onMouseUp);

        e.preventDefault();
      }

      onMouseMove(e) {
        if (!this.isResizing) return;

        const delta = this.startX - e.clientX;
        const newWidth = this.startWidth + delta;

        const constrainedWidth = Math.max(
          this.config.minWidth,
          Math.min(this.config.maxWidth, newWidth)
        );

        this.activityZone.style.width = constrainedWidth + 'px';
        this.mainContent.style.marginRight = constrainedWidth + 'px';
        this.resizer.style.right = constrainedWidth + 'px';
      }

      onMouseUp(e) {
        if (!this.isResizing) return;

        this.isResizing = false;

        this.resizer.classList.remove('active');
        document.body.classList.remove('resizing');

        document.removeEventListener('mousemove', this.onMouseMove);
        document.removeEventListener('mouseup', this.onMouseUp);

        this.saveWidth();
      }

      saveWidth() {
        const width = this.activityZone.offsetWidth;
        localStorage.setItem(this.config.storageKey, JSON.stringify({
          width,
          timestamp: Date.now()
        }));
      }

      restoreWidth() {
        try {
          const stored = localStorage.getItem(this.config.storageKey);
          if (stored) {
            const { width } = JSON.parse(stored);
            if (width >= this.config.minWidth && width <= this.config.maxWidth) {
              this.activityZone.style.width = width + 'px';
              this.mainContent.style.marginRight = width + 'px';
              this.resizer.style.right = width + 'px';
            }
          }
        } catch (e) {
          console.warn('Failed to restore panel width:', e);
        }
      }

      destroy() {
        this.resizer.removeEventListener('mousedown', this.onMouseDown);
        document.removeEventListener('mousemove', this.onMouseMove);
        document.removeEventListener('mouseup', this.onMouseUp);
      }
    }

    // Auto-initialize resizers on DOM ready
    document.addEventListener('DOMContentLoaded', () => {
      const resizers = document.querySelectorAll('[data-resizer]');
      resizers.forEach(resizer => new PanelResizer(resizer));
    });

    // Initialize Lucide icons
    lucide.createIcons();

    // Navigation toggle
    function toggleSection(header) {
      const section = header.closest('.nav-section');
      section.classList.toggle('expanded');
      const children = section.querySelector('.nav-children');
      children.classList.toggle('expanded');
    }

    // Mobile menu toggle
    function toggleMobileMenu() {
      const nav = document.getElementById('leftNav');
      nav.classList.toggle('open');
    }

    // Copy functionality
    function copyCode(btn, text) {
      navigator.clipboard.writeText(text).then(() => {
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i data-lucide="check" class="w-3 h-3"></i> Copied!';
        lucide.createIcons();
        setTimeout(() => {
          btn.innerHTML = originalText;
          lucide.createIcons();
        }, 2000);
      });
    }

    function copyCodeBlock(btn) {
      const codeBlock = btn.closest('.code-block');
      const pre = codeBlock.querySelector('pre');
      const text = pre.textContent;
      copyCode(btn, text);
    }

    // Scroll-sync with GSAP ScrollTrigger
    gsap.registerPlugin(ScrollTrigger);

    // Track which sections are in view
    const sections = document.querySelectorAll('[data-activity]');
    const activityItems = document.querySelectorAll('.activity-item');

    sections.forEach(section => {
      ScrollTrigger.create({
        trigger: section,
        start: 'top 40%',
        end: 'bottom 40%',
        onEnter: () => activateSection(section.dataset.activity),
        onEnterBack: () => activateSection(section.dataset.activity),
      });
    });

    function activateSection(sectionName) {
      activityItems.forEach(item => {
        if (item.dataset.section === sectionName) {
          item.classList.add('active');
          gsap.to(item, {
            opacity: 1,
            y: -2,
            boxShadow: '0 4px 12px rgba(0,0,0,0.08)',
            duration: 0.3,
            ease: 'power2.out'
          });
        } else {
          item.classList.remove('active');
          gsap.to(item, {
            opacity: 0.5,
            y: 0,
            boxShadow: 'none',
            duration: 0.3,
            ease: 'power2.out'
          });
        }
      });

      // Update nav active state
      document.querySelectorAll('.nav-section-header').forEach(header => {
        header.classList.remove('active');
      });
      const activeNav = document.querySelector(`[data-section="${sectionName}"] .nav-section-header`);
      if (activeNav) {
        activeNav.classList.add('active');
      }
    }

    // Initialize first section as active
    activateSection('essence');

    // Smooth scroll for nav links
    document.querySelectorAll('.nav-item').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const target = document.querySelector(link.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          document.querySelectorAll('.nav-item').forEach(l => l.classList.remove('active'));
          link.classList.add('active');
        }
      });
    });

    // Brushing interaction - hover activity item highlights related content
    activityItems.forEach(item => {
      item.addEventListener('mouseenter', () => {
        const sectionName = item.dataset.section;
        const relatedSection = document.querySelector(`[data-activity="${sectionName}"]`);
        if (relatedSection) {
          relatedSection.style.backgroundColor = 'rgba(13, 147, 115, 0.05)';
          relatedSection.style.transition = 'background-color 0.3s ease';
        }
      });

      item.addEventListener('mouseleave', () => {
        const sectionName = item.dataset.section;
        const relatedSection = document.querySelector(`[data-activity="${sectionName}"]`);
        if (relatedSection) {
          relatedSection.style.backgroundColor = '';
        }
      });
    });
  </script>
</body>
</html>
