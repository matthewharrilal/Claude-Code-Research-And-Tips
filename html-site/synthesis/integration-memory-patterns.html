<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Memory Integration Patterns | Claude Code Documentation</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Lucide Icons CDN -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- GSAP for scroll-sync -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

  <!-- Tailwind Config with Design Tokens -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'bg-base': '#ffffff',
            'bg-subtle': '#fafafa',
            'bg-muted': '#f4f4f5',
            'text-primary': '#18181b',
            'text-secondary': '#3f3f46',
            'text-muted': '#71717a',
            'accent': '#0D9373',
            'accent-light': '#10b981',
            'accent-bg': '#ecfdf5',
            'border': '#e4e4e7',
            // Activity Zone content type colors (Original 6)
            'az-invariant': '#3b82f6',    // Blue
            'az-effect': '#f59e0b',       // Amber
            'az-composition': '#8b5cf6',  // Purple
            'az-frontier': '#ef4444',     // Red
            'az-warstory': '#10b981',     // Green
            'az-alternative': '#6b7280',  // Gray
            // Activity Zone generative content types (New 10)
            'az-inversion': '#4f46e5',    // Indigo
            'az-constraint': '#8b5cf6',   // Violet
            'az-gradient': '#f43f5e',     // Rose
            'az-horizon': '#06b6d4',      // Cyan
            'az-violation': '#f97316',    // Orange
            'az-tradeoff': '#f59e0b',     // Amber
            'az-analogy': '#d946ef',      // Fuchsia
            'az-expertise': '#10b981',    // Emerald
            'az-minimal': '#84cc16',      // Lime
            'az-inflection': '#eab308',   // Yellow
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
            mono: ['Fira Code', 'monospace'],
          },
        },
      },
    }
  </script>

  <style>
    /* Base Styles */
    * {
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
      scroll-padding-top: 80px;
    }

    [id] {
      scroll-margin-top: 80px;
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: #ffffff;
      color: #18181b;
      line-height: 1.7;
    }

    /* Three Panel Layout */
    .three-panel-layout {
      min-height: 100vh;
      position: relative;
    }

    /* Header */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 56px;
      background: #ffffff;
      border-bottom: 1px solid #e4e4e7;
      z-index: 100;
      display: flex;
      align-items: center;
      padding: 0 24px;
    }

    /* Left Navigation - 240px fixed */
    .left-nav {
      position: fixed;
      top: 56px;
      left: 0;
      width: 240px;
      height: calc(100vh - 56px);
      border-right: 1px solid #e4e4e7;
      background: #ffffff;
      overflow-y: auto;
      padding: 16px 0;
      z-index: 40;
    }

    .nav-section {
      padding: 0 12px;
      margin-bottom: 8px;
    }

    .nav-section-header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      font-size: 14px;
      font-weight: 500;
      color: #3f3f46;
      cursor: pointer;
      border-radius: 6px;
      transition: background 0.15s;
    }

    .nav-section-header:hover {
      background: #f4f4f5;
    }

    .nav-section-header.active {
      color: #0D9373;
      background: #ecfdf5;
    }

    .nav-item {
      display: block;
      padding: 6px 12px 6px 44px;
      font-size: 14px;
      color: #71717a;
      text-decoration: none;
      border-radius: 6px;
      transition: all 0.15s;
    }

    .nav-item:hover {
      color: #3f3f46;
      background: #f4f4f5;
    }

    .nav-item.active {
      color: #0D9373;
      background: #ecfdf5;
    }

    .nav-children {
      display: none;
      overflow: hidden;
    }

    .nav-children.expanded {
      display: block;
    }

    .nav-chevron {
      transition: transform 0.2s;
    }

    .nav-section.expanded .nav-chevron {
      transform: rotate(90deg);
    }

    /* Main Content - Flexible, margins for fixed sidebars */
    .main-content {
      margin-left: 240px;
      margin-right: 480px;
      margin-top: 56px;
      padding: 48px 48px;
      min-width: 400px;
    }

    /* Activity Zone - 480px fixed */
    .activity-zone {
      position: fixed;
      top: 56px;
      right: 0;
      width: 480px;
      height: calc(100vh - 56px);
      border-left: 1px dashed #e4e4e7;
      background: #fafafa;
      overflow-y: auto;
      padding: 24px 20px;
      z-index: 40;
    }

    /* Responsive: Hide Activity Zone below 1400px */
    @media (max-width: 1400px) {
      .activity-zone {
        display: none;
      }
      .main-content {
        margin-right: 0;
        padding: 40px 32px;
      }
    }

    /* Responsive: Hide Left Nav below 768px */
    @media (max-width: 768px) {
      .left-nav {
        display: none;
      }
      .left-nav.open {
        display: block;
        position: fixed;
        top: 56px;
        left: 0;
        right: 0;
        bottom: 0;
        background: #ffffff;
        z-index: 50;
        overflow-y: auto;
      }
      .main-content {
        margin-left: 0;
        padding: 24px 16px;
        min-width: auto;
      }
    }

    /* Resizer */
    .resizer {
      position: fixed;
      top: 56px;
      right: 480px;
      width: 6px;
      height: calc(100vh - 56px);
      cursor: col-resize;
      background: transparent;
      z-index: 50;
      transition: background 0.15s ease;
    }

    .resizer:hover {
      background: rgba(13, 147, 115, 0.15);
    }

    .resizer.active {
      background: rgba(13, 147, 115, 0.25);
    }

    body.resizing {
      user-select: none;
      cursor: col-resize !important;
    }

    body.resizing * {
      cursor: col-resize !important;
    }

    @media (max-width: 1400px) {
      .resizer {
        display: none;
      }
    }

    /* Activity Zone Items */
    .activity-item {
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      background: #ffffff;
      border: 1px solid #e4e4e7;
      font-size: 14px;
      line-height: 1.6;
      opacity: 0.5;
      transition: all 0.3s ease;
    }

    .activity-item.active {
      opacity: 1;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .activity-item:hover {
      opacity: 1;
    }

    .activity-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    /* Activity Zone content type borders */
    .activity-item.invariant { border-left: 4px solid #3b82f6; }
    .activity-item.effect { border-left: 4px solid #f59e0b; }
    .activity-item.composition { border-left: 4px solid #8b5cf6; }
    .activity-item.frontier { border-left: 4px solid #ef4444; }
    .activity-item.warstory { border-left: 4px solid #10b981; }
    .activity-item.alternative { border-left: 4px solid #6b7280; }
    .activity-item.inversion { border-left: 4px solid #4f46e5; }
    .activity-item.constraint { border-left: 4px solid #8b5cf6; }
    .activity-item.gradient { border-left: 4px solid #f43f5e; }
    .activity-item.horizon { border-left: 4px solid #06b6d4; }
    .activity-item.violation { border-left: 4px solid #f97316; }
    .activity-item.tradeoff { border-left: 4px solid #f59e0b; }
    .activity-item.analogy { border-left: 4px solid #d946ef; }
    .activity-item.expertise { border-left: 4px solid #10b981; }
    .activity-item.minimal { border-left: 4px solid #84cc16; }
    .activity-item.inflection { border-left: 4px solid #eab308; }

    /* Main Content Components */
    .section-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      background: #0D9373;
      color: #ffffff;
      font-size: 14px;
      font-weight: 600;
      border-radius: 50%;
      margin-right: 12px;
    }

    .section-title {
      font-size: 24px;
      font-weight: 600;
      color: #18181b;
      margin-bottom: 20px;
      margin-top: 56px;
      display: flex;
      align-items: center;
    }

    .section-title:first-child {
      margin-top: 0;
    }

    /* Essence Box */
    .essence-box {
      background: linear-gradient(135deg, #18181b 0%, #27272a 100%);
      border-radius: 12px;
      padding: 32px;
      margin-bottom: 40px;
    }

    .essence-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #10b981;
      margin-bottom: 12px;
    }

    .essence-text {
      font-size: 22px;
      font-weight: 500;
      color: #ffffff;
      line-height: 1.4;
    }

    /* Core Abstraction Box */
    .core-abstraction {
      background: #fafafa;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 40px;
    }

    .core-philosophy {
      font-size: 16px;
      color: #3f3f46;
      margin-bottom: 16px;
      font-style: italic;
    }

    .core-code {
      background: #18181b;
      border-radius: 8px;
      padding: 16px 20px;
      margin-bottom: 16px;
      overflow-x: auto;
    }

    .core-code code {
      font-family: 'Fira Code', monospace;
      font-size: 15px;
      color: #10b981;
      white-space: nowrap;
    }

    .core-anchor {
      font-size: 14px;
      color: #71717a;
      text-align: center;
    }

    /* Design Decision Box */
    .decision-box {
      background: #ffffff;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
    }

    .decision-why {
      font-size: 16px;
      font-weight: 600;
      color: #0D9373;
      margin-bottom: 12px;
    }

    .decision-reasoning {
      font-size: 14px;
      color: #3f3f46;
      margin-bottom: 16px;
    }

    .decision-implication {
      background: #f4f4f5;
      border-radius: 8px;
      padding: 16px;
    }

    .decision-implication-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      color: #71717a;
      margin-bottom: 8px;
    }

    /* Code Blocks */
    .code-block {
      background: #18181b;
      border-radius: 8px;
      padding: 16px 20px;
      margin-bottom: 24px;
      position: relative;
      overflow-x: auto;
    }

    .code-block pre {
      margin: 0;
      font-family: 'Fira Code', monospace;
      font-size: 13px;
      color: #e4e4e7;
      line-height: 1.6;
    }

    .code-block .comment { color: #6b7280; }
    .code-block .keyword { color: #c084fc; }
    .code-block .string { color: #10b981; }
    .code-block .variable { color: #60a5fa; }

    .copy-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: #3f3f46;
      color: #ffffff;
      border: none;
      border-radius: 4px;
      padding: 6px 10px;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: background 0.15s;
    }

    .copy-btn:hover {
      background: #52525b;
    }

    /* Path Steps */
    .path-container {
      background: #fafafa;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 40px;
    }

    .path-step {
      display: flex;
      gap: 16px;
      margin-bottom: 16px;
    }

    .path-step:last-child {
      margin-bottom: 0;
    }

    .path-number {
      flex-shrink: 0;
      width: 24px;
      height: 24px;
      background: #0D9373;
      color: #ffffff;
      font-size: 12px;
      font-weight: 600;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .path-content {
      flex: 1;
      font-size: 14px;
      color: #3f3f46;
    }

    .path-content code {
      background: #e4e4e7;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 13px;
    }

    /* Gotcha Box */
    .gotcha-box {
      background: #fffbeb;
      border: 1px solid #fcd34d;
      border-left: 4px solid #f59e0b;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .gotcha-title {
      font-weight: 600;
      color: #92400e;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .gotcha-detail {
      font-size: 14px;
      color: #78350f;
      margin-bottom: 8px;
    }

    .gotcha-detail strong {
      color: #92400e;
    }

    /* What's Hard Box */
    .hard-box {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-left: 4px solid #ef4444;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .hard-title {
      font-weight: 600;
      color: #991b1b;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .hard-detail {
      font-size: 14px;
      color: #7f1d1d;
      margin-bottom: 8px;
    }

    /* When To Use Grid */
    .when-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 40px;
    }

    @media (max-width: 900px) {
      .when-grid {
        grid-template-columns: 1fr;
      }
    }

    .when-use {
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      border-radius: 12px;
      padding: 24px;
    }

    .when-not {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: 12px;
      padding: 24px;
    }

    .when-title {
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .when-use .when-title { color: #166534; }
    .when-not .when-title { color: #991b1b; }

    .when-item {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      font-size: 14px;
    }

    .when-use .when-item { color: #166534; }
    .when-not .when-item { color: #991b1b; }

    /* Architecture Diagram */
    .arch-diagram {
      background: #fafafa;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      font-family: 'Fira Code', monospace;
      font-size: 12px;
      line-height: 1.4;
      overflow-x: auto;
    }

    .arch-diagram pre {
      margin: 0;
      white-space: pre;
    }

    /* Memory Tool Card */
    .tool-card {
      background: #ffffff;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
    }

    .tool-card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .tool-card-icon {
      width: 40px;
      height: 40px;
      background: #ecfdf5;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #0D9373;
    }

    .tool-card-title {
      font-size: 18px;
      font-weight: 600;
      color: #18181b;
    }

    .tool-card-subtitle {
      font-size: 14px;
      color: #71717a;
    }

    /* Mobile Menu Button */
    .mobile-menu-btn {
      display: none;
      padding: 8px;
      background: none;
      border: none;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .mobile-menu-btn {
        display: flex;
      }
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: #fafafa;
    }

    ::-webkit-scrollbar-thumb {
      background: #d4d4d8;
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #a1a1aa;
    }

    /* Keyboard shortcut hint */
    .kbd {
      display: inline-flex;
      align-items: center;
      padding: 2px 6px;
      background: #f4f4f5;
      border: 1px solid #e4e4e7;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 12px;
      color: #71717a;
    }

    /* Comparison Table */
    .comparison-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 24px;
      font-size: 14px;
    }

    .comparison-table th {
      background: #f4f4f5;
      padding: 12px 16px;
      text-align: left;
      font-weight: 600;
      border-bottom: 2px solid #e4e4e7;
    }

    .comparison-table td {
      padding: 12px 16px;
      border-bottom: 1px solid #e4e4e7;
    }

    .comparison-table tr:hover {
      background: #fafafa;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle menu">
      <i data-lucide="menu" class="w-5 h-5 text-text-secondary"></i>
    </button>
    <div class="flex items-center gap-3">
      <i data-lucide="terminal" class="w-5 h-5 text-accent"></i>
      <span class="font-semibold text-text-primary">Claude Code</span>
    </div>
    <div class="flex-1 flex justify-center">
      <button class="flex items-center gap-2 px-4 py-2 bg-bg-muted rounded-lg text-text-muted text-sm hover:bg-border transition-colors">
        <i data-lucide="search" class="w-4 h-4"></i>
        <span>Search documentation...</span>
        <span class="kbd">Cmd+K</span>
      </button>
    </div>
    <div class="flex items-center gap-4">
      <a href="#" class="text-sm text-text-muted hover:text-text-primary transition-colors">Support</a>
      <button class="p-2 hover:bg-bg-muted rounded-lg transition-colors" aria-label="Toggle theme">
        <i data-lucide="sun" class="w-4 h-4 text-text-muted"></i>
      </button>
    </div>
  </header>

  <div class="three-panel-layout">
    <!-- Left Navigation -->
    <nav class="left-nav" id="leftNav">
      <div class="px-4 mb-4">
        <span class="text-xs font-semibold text-text-muted uppercase tracking-wider">Memory Integration</span>
      </div>

      <!-- Essence -->
      <div class="nav-section expanded" data-section="essence">
        <div class="nav-section-header active" onclick="toggleSection(this)">
          <i data-lucide="zap" class="w-4 h-4"></i>
          <span>Essence</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#essence" class="nav-item active">The 15-Word Summary</a>
        </div>
      </div>

      <!-- Core Abstraction -->
      <div class="nav-section expanded" data-section="core">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="database" class="w-4 h-4"></i>
          <span>Core Abstraction</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#core-abstraction" class="nav-item">The Memory Pyramid</a>
        </div>
      </div>

      <!-- Design Decisions -->
      <div class="nav-section expanded" data-section="decisions">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="lightbulb" class="w-4 h-4"></i>
          <span>Design Decisions</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#why-external-state" class="nav-item">Why External State?</a>
          <a href="#why-layered" class="nav-item">Why Layered Memory?</a>
          <a href="#why-progressive" class="nav-item">Why Progressive Disclosure?</a>
        </div>
      </div>

      <!-- The Three Pillars -->
      <div class="nav-section" data-section="pillars">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="layers" class="w-4 h-4"></i>
          <span>The Three Pillars</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#claude-mem" class="nav-item">Claude-Mem</a>
          <a href="#beads" class="nav-item">Beads</a>
          <a href="#claude-hud" class="nav-item">Claude HUD</a>
        </div>
      </div>

      <!-- Integration Path -->
      <div class="nav-section" data-section="path">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="git-branch" class="w-4 h-4"></i>
          <span>Integration Path</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#path" class="nav-item">The Flow</a>
        </div>
      </div>

      <!-- Gotchas -->
      <div class="nav-section" data-section="gotchas">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="alert-triangle" class="w-4 h-4"></i>
          <span>Gotchas</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#gotchas" class="nav-item">Practical Problems</a>
        </div>
      </div>

      <!-- What's Hard -->
      <div class="nav-section" data-section="hard">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="flame" class="w-4 h-4"></i>
          <span>What's Hard</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#hard" class="nav-item">Real Complexity</a>
        </div>
      </div>

      <!-- When to Use -->
      <div class="nav-section" data-section="when">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="check-circle" class="w-4 h-4"></i>
          <span>When to Use</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#when" class="nav-item">Decision Criteria</a>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">

      <!-- Section 1: ESSENCE -->
      <section id="essence" data-activity="essence">
        <div class="essence-box">
          <div class="essence-label">Essence (15 words)</div>
          <div class="essence-text">Memory layers persist knowledge across sessions: files for state, vectors for semantics, git for truth.</div>
        </div>
      </section>

      <!-- Section 2: CORE ABSTRACTION + IMPLEMENTATION -->
      <section id="core-abstraction" data-activity="core">
        <h2 class="section-title">
          <span class="section-number">2</span>
          The Core Abstraction
        </h2>

        <div class="core-abstraction">
          <div class="core-philosophy">"LLMs have no memory. Everything they 'remember' comes from files or context injection."</div>

          <div class="core-code">
            <button class="copy-btn" onclick="copyCode(this, 'Session → Capture → Compress → Store → Retrieve → Inject')">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <code>Session -> Capture -> Compress -> Store -> Retrieve -> Inject</code>
          </div>

          <div class="core-anchor">That's the memory pipeline. Everything else is optimization for different access patterns.</div>
        </div>

        <p class="text-text-secondary mb-6">
          Claude starts every session from zero. The "memory" illusion comes from injecting relevant context at session start. The question isn't WHETHER to persist memory, but HOW: hot memory (current session), warm memory (recent sessions), or cold memory (searchable archive).
        </p>

        <div class="arch-diagram">
          <pre>
+=====================================================================+
|                      THE MEMORY PYRAMID                              |
+=====================================================================+
|                                                                       |
|                            /\                                         |
|                           /  \                                        |
|                          /    \                                       |
|                         / HOT  \          Current session             |
|                        / MEMORY \         Full detail available       |
|                       /   5-10   \        Immediate access            |
|                      /   items    \                                   |
|                     +--------------+                                  |
|                    /                \                                 |
|                   /    WARM MEMORY   \     Recent sessions            |
|                  /   Summaries + key  \    Compressed                 |
|                 /    observations      \   Searchable                 |
|                /      ~50 items         \                             |
|               +------------------------+                              |
|              /                          \                             |
|             /       COLD MEMORY          \   All historical           |
|            /     Vector search access     \  Unlimited storage        |
|           /      Full archive              \                          |
|          +------------------------------------+                        |
|                                                                       |
|  KEY INSIGHT: Progressive disclosure moves data UP the pyramid        |
|               only when needed, saving tokens                         |
|                                                                       |
+=====================================================================+
          </pre>
        </div>

        <p class="text-text-secondary mb-6">
          This pyramid mirrors CPU cache hierarchies: L1 (hot) is fast but small, L3 (cold) is slow but huge. Memory tools implement this by storing everything cold and promoting to warm/hot on relevance.
        </p>
      </section>

      <!-- Section 3: DESIGN DECISIONS -->
      <section id="why-external-state" data-activity="decisions">
        <h2 class="section-title">
          <span class="section-number">3</span>
          Design Decisions
        </h2>

        <div class="decision-box">
          <div class="decision-why">WHY EXTERNAL STATE?</div>
          <div class="decision-reasoning">
            LLMs have no built-in persistence. Context windows reset on every session. If knowledge isn't written externally, it vanishes. This isn't a bug - it's the fundamental architecture of transformer models.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              If it's not in a file, it doesn't exist. Never rely on "Claude remembering" anything. Write to progress.txt, prd.json, AGENTS.md, or use claude-mem. The filesystem IS the memory.
            </div>
          </div>
        </div>

        <div class="decision-box" id="why-layered">
          <div class="decision-why">WHY LAYERED MEMORY?</div>
          <div class="decision-reasoning">
            Not all memory has equal retrieval cost. Injecting 50KB of context wastes tokens if you only need 100 bytes. Progressive disclosure loads minimal context first, then fetches details only when needed.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Use the 3-layer retrieval pattern: search() returns IDs only (~50 tokens), timeline() adds context (~500 tokens), get_observations() fetches full details (~1000+ tokens). Never fetch all at once.
            </div>
          </div>
        </div>

        <div class="decision-box" id="why-progressive">
          <div class="decision-why">WHY PROGRESSIVE DISCLOSURE?</div>
          <div class="decision-reasoning">
            Raw tool output can be 10,000+ tokens. Semantic compression reduces this to ~100 tokens per observation. A 95% reduction means ~20x more tool calls before hitting context limits.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Configure claude-mem to capture observations automatically, compress them semantically, and inject only relevant summaries at session start. The savings compound across iterations.
            </div>
          </div>
        </div>
      </section>

      <!-- Section 4: THE THREE PILLARS -->
      <section id="pillars" data-activity="pillars">
        <h2 class="section-title">
          <span class="section-number">4</span>
          The Three Memory Pillars
        </h2>

        <p class="text-text-secondary mb-6">
          The Claude Code memory ecosystem has three complementary tools, each serving a different persistence pattern:
        </p>

        <div class="tool-card" id="claude-mem">
          <div class="tool-card-header">
            <div class="tool-card-icon">
              <i data-lucide="brain" class="w-5 h-5"></i>
            </div>
            <div>
              <div class="tool-card-title">Claude-Mem</div>
              <div class="tool-card-subtitle">Semantic session memory with vector search</div>
            </div>
          </div>
          <p class="text-text-secondary text-sm mb-4">
            <strong>What it does:</strong> Captures tool output, compresses semantically, stores in SQLite + Chroma vector DB, injects relevant context at session start.
          </p>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre><span class="comment"># 3-layer retrieval pattern</span>
search(query=<span class="string">"auth bug"</span>, type=<span class="string">"bugfix"</span>, limit=10)  <span class="comment"># Returns IDs only</span>
timeline(anchorId=<span class="string">"obs-123"</span>, range=5)              <span class="comment"># Surrounding context</span>
get_observations(ids=[123, 456])                   <span class="comment"># Full details</span></pre>
          </div>
          <p class="text-text-secondary text-sm">
            <strong>Best for:</strong> Solo developer, multi-session complex features, token optimization critical.
          </p>
        </div>

        <div class="tool-card" id="beads">
          <div class="tool-card-header">
            <div class="tool-card-icon">
              <i data-lucide="git-branch" class="w-5 h-5"></i>
            </div>
            <div>
              <div class="tool-card-title">Beads</div>
              <div class="tool-card-subtitle">Git-backed multi-agent data plane</div>
            </div>
          </div>
          <p class="text-text-secondary text-sm mb-4">
            <strong>What it does:</strong> Dual-persistence (SQLite for fast queries, JSONL for git truth), three-way merge for collaboration, workflow chemistry (solid/liquid/vapor states).
          </p>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre><span class="comment"># Beads CLI</span>
bd create <span class="string">"Implement auth middleware"</span>    <span class="comment"># Create issue</span>
bd list --status in_progress              <span class="comment"># Filter by status</span>
bd prime                                  <span class="comment"># Get ready work for agent</span>
bd sync --force                           <span class="comment"># Force reimport from JSONL</span></pre>
          </div>
          <p class="text-text-secondary text-sm">
            <strong>Best for:</strong> Multi-agent coordination, Gas Town deployment, dependency tracking, git-native collaboration.
          </p>
        </div>

        <div class="tool-card" id="claude-hud">
          <div class="tool-card-header">
            <div class="tool-card-icon">
              <i data-lucide="activity" class="w-5 h-5"></i>
            </div>
            <div>
              <div class="tool-card-title">Claude HUD</div>
              <div class="tool-card-subtitle">Real-time session observability</div>
            </div>
          </div>
          <p class="text-text-secondary text-sm mb-4">
            <strong>What it does:</strong> Displays context consumption, tool activity, agent status, usage limits. No persistence - pure real-time visibility.
          </p>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre><span class="comment"># HUD display example</span>
[Opus 4.5] <span class="string">########</span><span class="variable">--</span> 78% | myapp | git:(feature/auth) | 12m

<span class="comment"># Shows: model, context %, project, branch, duration</span></pre>
          </div>
          <p class="text-text-secondary text-sm">
            <strong>Best for:</strong> Monitoring long sessions, debugging context overflow, tracking tool execution, observing agent activity.
          </p>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8">Comparison Matrix</h3>

        <table class="comparison-table">
          <thead>
            <tr>
              <th>Feature</th>
              <th>Claude-Mem</th>
              <th>Beads</th>
              <th>Claude HUD</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Primary Purpose</strong></td>
              <td>Session memory</td>
              <td>Work tracking</td>
              <td>Real-time monitoring</td>
            </tr>
            <tr>
              <td><strong>Persistence</strong></td>
              <td>SQLite + Chroma</td>
              <td>Git-backed JSONL</td>
              <td>None (display only)</td>
            </tr>
            <tr>
              <td><strong>Scope</strong></td>
              <td>Single Claude instance</td>
              <td>Multi-agent, multi-machine</td>
              <td>Single session</td>
            </tr>
            <tr>
              <td><strong>Query Type</strong></td>
              <td>Semantic search</td>
              <td>Structured SQL</td>
              <td>Visual display</td>
            </tr>
            <tr>
              <td><strong>Token Cost</strong></td>
              <td>Variable (progressive)</td>
              <td>1-2k (bd prime)</td>
              <td>0 (display only)</td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- Section 5: INTEGRATION PATH -->
      <section id="path" data-activity="path">
        <h2 class="section-title">
          <span class="section-number">5</span>
          The Memory Integration Path
        </h2>

        <p class="text-text-secondary mb-6">
          Follow memory through a Ralph + Claude-Mem integration to see how the pieces connect:
        </p>

        <div class="path-container">
          <div class="path-step">
            <div class="path-number">1</div>
            <div class="path-content">Ralph loop starts fresh Claude instance (zero memory, full context capacity)</div>
          </div>
          <div class="path-step">
            <div class="path-number">2</div>
            <div class="path-content">Claude-Mem hook triggers: <code>SessionStart</code> event captured</div>
          </div>
          <div class="path-step">
            <div class="path-number">3</div>
            <div class="path-content">Worker queries SQLite for relevant observations based on project context</div>
          </div>
          <div class="path-step">
            <div class="path-number">4</div>
            <div class="path-content">Compressed summaries injected into context: <code>&lt;claude-mem-context&gt;...&lt;/claude-mem-context&gt;</code></div>
          </div>
          <div class="path-step">
            <div class="path-number">5</div>
            <div class="path-content">Claude reads <code>prd.json</code> and <code>progress.txt</code> (file-based memory)</div>
          </div>
          <div class="path-step">
            <div class="path-number">6</div>
            <div class="path-content">Claude implements task, generating tool outputs (read, edit, bash)</div>
          </div>
          <div class="path-step">
            <div class="path-number">7</div>
            <div class="path-content">Claude-Mem hook triggers: <code>PostToolUse</code> captures observations</div>
          </div>
          <div class="path-step">
            <div class="path-number">8</div>
            <div class="path-content">Claude Agent SDK compresses raw output into semantic summary (~50-100 tokens)</div>
          </div>
          <div class="path-step">
            <div class="path-number">9</div>
            <div class="path-content">Summary stored in SQLite (structure) and Chroma (vectors) for retrieval</div>
          </div>
          <div class="path-step">
            <div class="path-number">10</div>
            <div class="path-content">Claude updates <code>prd.json</code> and appends to <code>progress.txt</code></div>
          </div>
          <div class="path-step">
            <div class="path-number">11</div>
            <div class="path-content">Claude commits and exits. Ralph restarts loop with fresh context.</div>
          </div>
          <div class="path-step">
            <div class="path-number">12</div>
            <div class="path-content">Next iteration: Steps 2-4 inject prior learnings. Compound knowledge across iterations.</div>
          </div>
        </div>

        <p class="text-text-secondary mb-6">
          <strong>The compound effect:</strong> Iteration 1 knows nothing. Iteration 5 knows patterns from 1-4. Iteration 20 has institutional memory spanning the entire feature development.
        </p>
      </section>

      <!-- Section 6: GOTCHAS -->
      <section id="gotchas" data-activity="gotchas">
        <h2 class="section-title">
          <span class="section-number">6</span>
          Gotchas
        </h2>

        <p class="text-text-secondary mb-6">
          Real problems you'll hit with memory integration:
        </p>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Claude-Mem worker blocks Claude Code startup
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Claude Code hangs on startup. Terminal shows no prompt for 30+ seconds.</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Previous worker process crashed but left port 37777 bound.</div>
          <div class="gotcha-detail"><strong>Fix:</strong> <code>pkill -f "claude-mem-worker" && rm -rf ~/.claude-mem/.version-*</code></div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Chroma RAM usage explodes
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> System becomes unresponsive. Activity Monitor shows claude-mem using 8GB+ RAM.</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Vector DB loading entire index into memory for similarity search.</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Disable Chroma if not using semantic search: <code>{"vector": {"enabled": false}}</code></div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Beads database locked
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> "Database locked" error when running bd commands.</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Daemon crashed while holding write lock on SQLite.</div>
          <div class="gotcha-detail"><strong>Fix:</strong> <code>bd daemons stop && rm .beads/bd.sock && bd sync --force</code></div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Context injection returns empty
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> New sessions show no prior context despite completing multiple iterations.</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Observations not being captured (worker not running, or hook not firing).</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Check <code>curl http://localhost:37777/api/health</code> and verify observation count in web UI.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            JSONL/SQLite divergence in Beads
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> CLI shows different data than what's in git. Team members see different issues.</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Three-way merge failed silently or daemon sync stalled.</div>
          <div class="gotcha-detail"><strong>Fix:</strong> <code>rm .beads/beads.db && bd sync --force</code> to rebuild from JSONL truth.</div>
        </div>
      </section>

      <!-- Section 7: WHAT'S HARD -->
      <section id="hard" data-activity="hard">
        <h2 class="section-title">
          <span class="section-number">7</span>
          What's Hard
        </h2>

        <p class="text-text-secondary mb-6">
          Fundamental tensions with no perfect solutions:
        </p>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Compression vs. Fidelity
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Semantic compression saves tokens but loses nuance. Raw storage preserves everything but explodes context.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Compressed summaries miss critical edge cases. Full observations flood context with irrelevant details.</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Use progressive disclosure. Store full details but retrieve summaries first. Fetch full only when summary indicates relevance. Accept that some information loss is the cost of scalable memory.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Memory Staleness
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Old observations pollute context with outdated patterns. But deleting them loses potentially useful history.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Claude suggests patterns that were refactored weeks ago. Semantic search returns irrelevant old results.</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Weight retrieval by recency. Archive old observations to cold storage. Implement decay scoring. Consider project-scoped memory vs. global memory.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Multi-Agent Memory Coordination
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Agents need shared context but can't share context windows. File-based coordination has race conditions.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Agent A discovers pattern, Agent B repeats same mistake. Handoff files get overwritten.</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Use Beads for multi-agent. Use explicit handoff protocols with timestamps and acknowledgments. Consider message-passing (MCP Agent Mail) over shared state.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Token Budget Allocation
          </div>
          <div class="hard-detail"><strong>The tension:</strong> More context = more knowledge = better decisions. But context has hard limits and marginal costs.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Early iterations excellent, late iterations degraded (context filled with history). OR too aggressive pruning loses useful patterns.</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Monitor context usage (Claude HUD). Set hard limits on observation injection. Reserve token budget for task-specific context. Accept that memory is a limited resource requiring active management.</div>
        </div>
      </section>

      <!-- Section 8: WHEN TO USE -->
      <section id="when" data-activity="when">
        <h2 class="section-title">
          <span class="section-number">8</span>
          When to Use / When Not
        </h2>

        <div class="when-grid">
          <div class="when-use">
            <div class="when-title">
              <i data-lucide="check" class="w-5 h-5"></i>
              USE MEMORY INTEGRATION WHEN
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Multi-session features where learnings compound (Ralph loops)</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Token optimization critical (API key users with cost pressure)</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Multi-agent coordination needed (Gas Town, CC Mirror)</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Long-running autonomous work (overnight, multi-day)</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Team projects where context must transfer between engineers</span>
            </div>
          </div>

          <div class="when-not">
            <div class="when-title">
              <i data-lucide="x" class="w-5 h-5"></i>
              DON'T ADD MEMORY COMPLEXITY WHEN
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>One-off questions or simple tasks (CLAUDE.md is enough)</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Single session completes the work (no persistence needed)</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Max plan with unlimited tokens (token optimization ROI low)</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Debugging sessions where fresh perspective is valuable</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Setup overhead exceeds task duration (small scripts, hotfixes)</span>
            </div>
          </div>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8">Stack Recommendations by Use Case</h3>

        <table class="comparison-table">
          <thead>
            <tr>
              <th>Scenario</th>
              <th>Recommended Stack</th>
              <th>Setup Time</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Solo dev, complex feature</td>
              <td>Claude-Mem + progress.txt</td>
              <td>15 min</td>
            </tr>
            <tr>
              <td>Ralph loop optimization</td>
              <td>Claude-Mem + Claude HUD</td>
              <td>20 min</td>
            </tr>
            <tr>
              <td>Team project, shared issues</td>
              <td>Beads + Claude-Mem</td>
              <td>30 min</td>
            </tr>
            <tr>
              <td>Gas Town deployment</td>
              <td>Beads + Claude-Mem + HUD</td>
              <td>45 min</td>
            </tr>
            <tr>
              <td>Full autonomous operation</td>
              <td>All three + AGENTS.md</td>
              <td>1 hour</td>
            </tr>
          </tbody>
        </table>
      </section>

    </main>

    <!-- Resizer between Main Panel and Activity Zone -->
    <div class="resizer" data-resizer="activity-zone" aria-label="Resize activity panel"></div>

    <!-- Activity Zone -->
    <aside class="activity-zone" id="activityZone">
      <div class="text-xs font-semibold text-text-muted uppercase tracking-wider mb-4">Operational Intelligence</div>

      <!-- ESSENCE SECTION -->
      <div class="activity-item inversion" data-section="essence">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if LLMs HAD built-in memory?</div>
        <div class="text-text-secondary text-sm">
          <strong>You'd design:</strong> Single persistent session per project. No files needed. Context just accumulates.<br>
          <strong>Why this fails:</strong> Context rot at 80K tokens. Quality degrades with size. No cross-instance sharing.<br>
          <strong>Hidden constraint revealed:</strong> Memory layers exist BECAUSE persistence is external to the model.
        </div>
      </div>

      <div class="activity-item minimal" data-section="essence">
        <div class="activity-label" style="color: #84cc16;">
          <i data-lucide="minimize-2" class="w-4 h-4"></i>
          Minimal Pattern
        </div>
        <div class="font-medium text-text-primary mb-2">The irreducible memory stack</div>
        <div class="text-text-secondary text-sm">
          <code style="background: #f4f4f5; padding: 2px 6px; border-radius: 4px; font-size: 12px;">CLAUDE.md + progress.txt</code><br>
          <strong>Essential:</strong> File-based state that persists across sessions.<br>
          <strong>Everything else:</strong> Optimization for scale, search, and coordination.
        </div>
      </div>

      <div class="activity-item warstory" data-section="essence">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">Molly Cantillon: Jmail with 18M users</div>
        <div class="text-text-secondary text-sm">
          Built overnight using Ralph loops with file-based memory (progress.txt + prd.json). Each agent had its own directory. Proof that simple memory patterns scale to production systems.
        </div>
      </div>

      <!-- CORE SECTION -->
      <div class="activity-item analogy" data-section="core">
        <div class="activity-label" style="color: #d946ef;">
          <i data-lucide="git-compare" class="w-4 h-4"></i>
          Analogical Bridge
        </div>
        <div class="font-medium text-text-primary mb-2">Memory Pyramid = CPU Cache Hierarchy</div>
        <div class="text-text-secondary text-sm">
          L1 cache (fast, small) -> Hot memory (current session)<br>
          L2 cache (medium) -> Warm memory (recent summaries)<br>
          L3 cache (slower, larger) -> Cold memory (vector archive)<br>
          RAM/Disk -> Full historical archive<br><br>
          <em>If you understand cache hierarchies, you understand memory layers.</em>
        </div>
      </div>

      <div class="activity-item constraint" data-section="core">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="link-2" class="w-4 h-4"></i>
          Constraint Chain
        </div>
        <div class="font-medium text-text-primary mb-2">One constraint -> Five memory decisions</div>
        <div class="text-text-secondary text-sm">
          <strong>ROOT:</strong> LLMs have no built-in persistence<br>
          -> Memory must be external (files/DBs)<br>
          -> Context injection required at session start<br>
          -> Compression needed to fit limited context<br>
          -> Progressive disclosure to minimize token cost<br>
          -> Retrieval must be relevance-weighted
        </div>
      </div>

      <div class="activity-item gradient" data-section="core">
        <div class="activity-label" style="color: #f43f5e;">
          <i data-lucide="trending-down" class="w-4 h-4"></i>
          Failure Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">How memory injection degrades</div>
        <div class="text-text-secondary text-sm">
          <strong>0-5KB injected:</strong> Pure benefit, relevant context<br>
          <strong>5-15KB injected:</strong> Diminishing returns, some noise<br>
          <strong>15-30KB injected:</strong> Neutral, reading time = benefit<br>
          <strong>30KB+ injected:</strong> Net negative, context pollution<br><br>
          <em>Critical: More memory isn't always better.</em>
        </div>
      </div>

      <!-- DECISIONS SECTION -->
      <div class="activity-item invariant" data-section="decisions">
        <div class="activity-label" style="color: #3b82f6;">
          <i data-lucide="link" class="w-4 h-4"></i>
          Invariant Connection
        </div>
        <div class="font-medium text-text-primary mb-2">INV-003: External state > internal memory</div>
        <div class="text-text-secondary text-sm">
          Ralph, Gas Town, CC Mirror, and all memory tools share this invariant. If state must persist, it must be external. This isn't a preference - it's a constraint of the architecture.
        </div>
      </div>

      <div class="activity-item violation" data-section="decisions">
        <div class="activity-label" style="color: #f97316;">
          <i data-lucide="alert-octagon" class="w-4 h-4"></i>
          Violation Chain
        </div>
        <div class="font-medium text-text-primary mb-2">If you rely on "Claude remembering"</div>
        <div class="text-text-secondary text-sm">
          <strong>IF:</strong> You rely on session memory instead of files<br>
          <strong>THEN:</strong> Next iteration starts with zero knowledge<br>
          <strong>THEN:</strong> Same discoveries repeated<br>
          <strong>THEN:</strong> Same mistakes made<br>
          <strong>FINALLY:</strong> No compound learning across sessions<br><br>
          <em>The fix: If it's not in a file, it doesn't exist.</em>
        </div>
      </div>

      <div class="activity-item tradeoff" data-section="decisions">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="scale" class="w-4 h-4"></i>
          Trade-Off Tension
        </div>
        <div class="font-medium text-text-primary mb-2">Compression Level Dilemma</div>
        <div class="text-text-secondary text-sm">
          - <strong>No compression:</strong> Full fidelity, but context explodes<br>
          - <strong>Light compression:</strong> Most details, but still expensive<br>
          - <strong>Heavy compression:</strong> Token efficient, but lossy<br><br>
          <em>Heuristic: Start with heavy compression. Fetch full details only when summaries indicate relevance.</em>
        </div>
      </div>

      <!-- PILLARS SECTION -->
      <div class="activity-item expertise" data-section="pillars">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
          Expertise Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">Memory tool understanding depth</div>
        <div class="text-text-secondary text-sm">
          <strong>Beginner:</strong> "What tools exist?" -> Claude-Mem, Beads, HUD<br>
          <strong>Intermediate:</strong> "When to use which?" -> See decision tree<br>
          <strong>Advanced:</strong> "How do they combine?" -> Mem + HUD for visibility<br>
          <strong>Staff:</strong> "What's the minimal stack?" -> CLAUDE.md + progress.txt<br>
          <strong>Expert:</strong> "Cross-pattern integration?" -> Beads = Gas Town data plane
        </div>
      </div>

      <div class="activity-item composition" data-section="pillars">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="layers" class="w-4 h-4"></i>
          Composition Case
        </div>
        <div class="font-medium text-text-primary mb-2">Claude-Mem + Claude HUD</div>
        <div class="text-text-secondary text-sm">
          <strong>Works:</strong> Excellent for solo developer visibility. See context consumption while memory handles persistence.<br>
          <strong>Danger:</strong> Both use system resources. On low-memory machines, prefer one or the other.<br>
          <strong>Recommendation:</strong> This is the default single-agent stack.
        </div>
      </div>

      <div class="activity-item composition" data-section="pillars">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="layers" class="w-4 h-4"></i>
          Composition Case
        </div>
        <div class="font-medium text-text-primary mb-2">Beads + Claude-Mem</div>
        <div class="text-text-secondary text-sm">
          <strong>Works:</strong> Shared work tracking (Beads) + per-agent observations (Claude-Mem). Each agent has personal memory plus shared state.<br>
          <strong>Danger:</strong> Two persistence systems to maintain. Potential consistency issues.<br>
          <strong>Recommendation:</strong> Use for Gas Town deployments where coordination matters.
        </div>
      </div>

      <div class="activity-item effect" data-section="pillars">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="bar-chart-2" class="w-4 h-4"></i>
          Second-Order Effect
        </div>
        <div class="font-medium text-text-primary mb-2">Token savings compound exponentially</div>
        <div class="text-text-secondary text-sm">
          Claude-Mem's 90% token savings means:<br>
          - 10 observations costs 1K tokens (not 10K)<br>
          - 100 observations costs 10K tokens (not 100K)<br>
          - At scale, the difference is entire features vs. context overflow<br><br>
          <strong>Threshold:</strong> Savings become critical after ~50 observations.
        </div>
      </div>

      <!-- PATH SECTION -->
      <div class="activity-item horizon" data-section="path">
        <div class="activity-label" style="color: #06b6d4;">
          <i data-lucide="clock" class="w-4 h-4"></i>
          Time Horizon Shift
        </div>
        <div class="font-medium text-text-primary mb-2">Memory ROI over iterations</div>
        <div class="text-text-secondary text-sm">
          <strong>Iteration 1:</strong> "Memory setup feels like overhead"<br>
          <strong>Iteration 5:</strong> "Wait, Claude knew about that bug from iteration 2!"<br>
          <strong>Iteration 15:</strong> "Memory is why late iterations are FASTER"<br>
          <strong>Iteration 30:</strong> "This is institutional knowledge"<br><br>
          <em>Don't judge memory tools by setup time. Judge by iteration 20.</em>
        </div>
      </div>

      <div class="activity-item violation" data-section="path">
        <div class="activity-label" style="color: #f97316;">
          <i data-lucide="alert-octagon" class="w-4 h-4"></i>
          Violation Chain
        </div>
        <div class="font-medium text-text-primary mb-2">If you skip observation capture</div>
        <div class="text-text-secondary text-sm">
          <strong>IF:</strong> Disable claude-mem hooks to "speed up" sessions<br>
          <strong>THEN:</strong> No observations stored<br>
          <strong>THEN:</strong> Next session has no prior context<br>
          <strong>THEN:</strong> Claude repeats same discoveries<br>
          <strong>FINALLY:</strong> No compound learning - every session is groundhog day<br><br>
          <em>The "speedup" is a false economy.</em>
        </div>
      </div>

      <div class="activity-item warstory" data-section="path">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">@thedotmack: 95% token savings</div>
        <div class="text-text-secondary text-sm">
          Creator of Claude-Mem reports 95% fewer tokens per session after implementing progressive disclosure. ~20x more tool calls before hitting limits. Real production numbers, not theory.
        </div>
      </div>

      <!-- GOTCHAS SECTION -->
      <div class="activity-item inflection" data-section="gotchas">
        <div class="activity-label" style="color: #eab308;">
          <i data-lucide="activity" class="w-4 h-4"></i>
          Inflection Point
        </div>
        <div class="font-medium text-text-primary mb-2">When context injection flips from help to hurt</div>
        <div class="text-text-secondary text-sm">
          <strong>0-5KB:</strong> Pure benefit (relevant context)<br>
          <strong>5-15KB:</strong> Diminishing returns (some noise)<br>
          <strong>15-30KB:</strong> Neutral (reading cost = benefit)<br>
          <strong>30KB+:</strong> Net negative (context pollution)<br><br>
          <strong>THE INFLECTION:</strong> ~15KB injected context<br>
          <em>Detection: Late iterations worse than early? Check injection size.</em>
        </div>
      </div>

      <div class="activity-item inversion" data-section="gotchas">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if SQLite didn't lock?</div>
        <div class="text-text-secondary text-sm">
          <strong>You'd design:</strong> Multiple agents writing simultaneously, no daemon needed.<br>
          <strong>Why this fails:</strong> SQLite is single-writer by design. Concurrent writes corrupt data.<br>
          <strong>Hidden constraint revealed:</strong> Beads uses daemon pattern BECAUSE of SQLite's write locking.
        </div>
      </div>

      <div class="activity-item frontier" data-section="gotchas">
        <div class="activity-label" style="color: #ef4444;">
          <i data-lucide="flask-conical" class="w-4 h-4"></i>
          Research Frontier
        </div>
        <div class="font-medium text-text-primary mb-2">UNSOLVED: Optimal observation decay</div>
        <div class="text-text-secondary text-sm">
          When should old observations be archived? After N days? After M observations? Based on access patterns? Optimal varies by project. No automation exists yet. Current best practice: manual archival when retrieval quality degrades.
        </div>
      </div>

      <div class="activity-item frontier" data-section="gotchas">
        <div class="activity-label" style="color: #ef4444;">
          <i data-lucide="flask-conical" class="w-4 h-4"></i>
          Research Frontier
        </div>
        <div class="font-medium text-text-primary mb-2">UNSOLVED: Cross-project memory</div>
        <div class="text-text-secondary text-sm">
          Should learnings from project A transfer to project B? Some patterns are universal, some are project-specific. No good heuristics exist for filtering. Current practice: separate memory per project.
        </div>
      </div>

      <!-- HARD SECTION -->
      <div class="activity-item tradeoff" data-section="hard">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="scale" class="w-4 h-4"></i>
          Trade-Off Tension
        </div>
        <div class="font-medium text-text-primary mb-2">Compression vs. Fidelity</div>
        <div class="text-text-secondary text-sm">
          <strong>THE DILEMMA:</strong><br>
          - Full fidelity: Everything preserved, but context explodes<br>
          - Semantic compression: Token efficient, but nuance lost<br>
          - Hybrid: Complex to implement and debug<br><br>
          <strong>WHY NO PERFECT ANSWER:</strong><br>
          Information theory: compression is inherently lossy. You're choosing WHICH information to lose.<br><br>
          <em>Heuristic: Preserve decisions and gotchas. Compress implementation details.</em>
        </div>
      </div>

      <div class="activity-item expertise" data-section="hard">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
          Expertise Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">Multi-agent memory understanding</div>
        <div class="text-text-secondary text-sm">
          <strong>Beginner:</strong> "Can agents share memory?" -> Not directly<br>
          <strong>Intermediate:</strong> "How to coordinate?" -> Shared files or Beads<br>
          <strong>Advanced:</strong> "Race conditions?" -> Use explicit handoff protocols<br>
          <strong>Staff:</strong> "Message passing vs shared state?" -> MCP Agent Mail exists<br>
          <strong>Expert:</strong> "Distributed consensus?" -> Too complex, use file locking
        </div>
      </div>

      <div class="activity-item analogy" data-section="hard">
        <div class="activity-label" style="color: #d946ef;">
          <i data-lucide="git-compare" class="w-4 h-4"></i>
          Analogical Bridge
        </div>
        <div class="font-medium text-text-primary mb-2">Memory staleness = Cache invalidation</div>
        <div class="text-text-secondary text-sm">
          Old observations polluting search -> Stale cache entries<br>
          TTL-based expiry -> Time-decay scoring<br>
          Cache busting -> Manual archival<br>
          LRU eviction -> Access-pattern based cleanup<br><br>
          <em>"There are only two hard things: cache invalidation and naming things." Memory staleness is cache invalidation.</em>
        </div>
      </div>

      <!-- WHEN SECTION -->
      <div class="activity-item inversion" data-section="when">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if you always added memory?</div>
        <div class="text-text-secondary text-sm">
          - One-off question with 30 min Claude-Mem setup -> Massive overhead<br>
          - Simple hotfix with full Beads stack -> Coordination complexity > fix complexity<br>
          - Debugging session with memory injection -> Old patterns pollute fresh perspective<br><br>
          <strong>Hidden constraint:</strong> Memory has setup cost. Only amortizes over many sessions.
        </div>
      </div>

      <div class="activity-item alternative" data-section="when">
        <div class="activity-label" style="color: #6b7280;">
          <i data-lucide="arrow-right" class="w-4 h-4"></i>
          Alternative Paths
        </div>
        <div class="font-medium text-text-primary mb-2">If memory integration isn't right</div>
        <div class="text-text-secondary text-sm">
          <strong>One-off tasks?</strong><br>
          -> Just use CLAUDE.md (zero setup)<br><br>
          <strong>Single session sufficient?</strong><br>
          -> progress.txt only (manual append)<br><br>
          <strong>Team needs shared context?</strong><br>
          -> Git-based AGENTS.md (no tools needed)<br><br>
          <strong>Debugging, need fresh perspective?</strong><br>
          -> Disable memory injection temporarily
        </div>
      </div>

      <div class="activity-item invariant" data-section="when">
        <div class="activity-label" style="color: #3b82f6;">
          <i data-lucide="link" class="w-4 h-4"></i>
          Invariant Connection
        </div>
        <div class="font-medium text-text-primary mb-2">Memory tools implement the same invariants</div>
        <div class="text-text-secondary text-sm">
          Claude-Mem, Beads, progress.txt all implement:<br>
          - INV-003: External state > internal memory<br>
          - INV-005: Verification enables automation<br>
          - INV-007: Context is finite, manage it<br><br>
          <em>Different implementations, same underlying principles.</em>
        </div>
      </div>

      <div class="activity-item warstory" data-section="when">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">Steve Yegge: Gas Town + Beads</div>
        <div class="text-text-secondary text-sm">
          ~225K lines of Go implementing the full memory stack for multi-agent orchestration. Beads provides git-backed universal data plane. "Stage 7+ infrastructure for factory-scale operations." Proof that memory can scale, but requires significant investment.
        </div>
      </div>

      <div class="activity-item horizon" data-section="when">
        <div class="activity-label" style="color: #06b6d4;">
          <i data-lucide="clock" class="w-4 h-4"></i>
          Time Horizon Shift
        </div>
        <div class="font-medium text-text-primary mb-2">When memory setup is worth it</div>
        <div class="text-text-secondary text-sm">
          <strong>1 session:</strong> Never worth it (setup > benefit)<br>
          <strong>3-5 sessions:</strong> Marginal (break-even zone)<br>
          <strong>10+ sessions:</strong> Clearly worth it (compound returns)<br>
          <strong>50+ sessions:</strong> Essential (institutional memory)<br><br>
          <em>Rule of thumb: If you expect 10+ sessions, invest in memory.</em>
        </div>
      </div>

    </aside>
  </div>

  <script>
    /**
     * PanelResizer - Handles draggable panel dividers
     */
    class PanelResizer {
      constructor(resizerEl, config = {}) {
        this.resizer = resizerEl;
        this.config = {
          storageKey: 'panel-activity-zone-width',
          minWidth: 280,
          maxWidth: 900,
          defaultWidth: 480,
          ...config
        };

        this.isResizing = false;
        this.startX = 0;
        this.startWidth = 0;

        this.activityZone = document.querySelector('.activity-zone');
        this.mainContent = document.querySelector('.main-content');

        this.onMouseDown = this.onMouseDown.bind(this);
        this.onMouseMove = this.onMouseMove.bind(this);
        this.onMouseUp = this.onMouseUp.bind(this);

        this.init();
      }

      init() {
        this.restoreWidth();
        this.resizer.addEventListener('mousedown', this.onMouseDown);
      }

      onMouseDown(e) {
        if (e.button !== 0) return;

        this.isResizing = true;
        this.startX = e.clientX;
        this.startWidth = this.activityZone.offsetWidth;

        this.resizer.classList.add('active');
        document.body.classList.add('resizing');

        document.addEventListener('mousemove', this.onMouseMove);
        document.addEventListener('mouseup', this.onMouseUp);

        e.preventDefault();
      }

      onMouseMove(e) {
        if (!this.isResizing) return;

        const delta = this.startX - e.clientX;
        const newWidth = this.startWidth + delta;

        const constrainedWidth = Math.max(
          this.config.minWidth,
          Math.min(this.config.maxWidth, newWidth)
        );

        this.activityZone.style.width = constrainedWidth + 'px';
        this.mainContent.style.marginRight = constrainedWidth + 'px';
        this.resizer.style.right = constrainedWidth + 'px';
      }

      onMouseUp(e) {
        if (!this.isResizing) return;

        this.isResizing = false;

        this.resizer.classList.remove('active');
        document.body.classList.remove('resizing');

        document.removeEventListener('mousemove', this.onMouseMove);
        document.removeEventListener('mouseup', this.onMouseUp);

        this.saveWidth();
      }

      saveWidth() {
        const width = this.activityZone.offsetWidth;
        localStorage.setItem(this.config.storageKey, JSON.stringify({
          width,
          timestamp: Date.now()
        }));
      }

      restoreWidth() {
        try {
          const stored = localStorage.getItem(this.config.storageKey);
          if (stored) {
            const { width } = JSON.parse(stored);
            if (width >= this.config.minWidth && width <= this.config.maxWidth) {
              this.activityZone.style.width = width + 'px';
              this.mainContent.style.marginRight = width + 'px';
              this.resizer.style.right = width + 'px';
            }
          }
        } catch (e) {
          console.warn('Failed to restore panel width:', e);
        }
      }

      destroy() {
        this.resizer.removeEventListener('mousedown', this.onMouseDown);
        document.removeEventListener('mousemove', this.onMouseMove);
        document.removeEventListener('mouseup', this.onMouseUp);
      }
    }

    // Auto-initialize resizers on DOM ready
    document.addEventListener('DOMContentLoaded', () => {
      const resizers = document.querySelectorAll('[data-resizer]');
      resizers.forEach(resizer => new PanelResizer(resizer));
    });

    // Initialize Lucide icons
    lucide.createIcons();

    // Navigation toggle
    function toggleSection(header) {
      const section = header.closest('.nav-section');
      section.classList.toggle('expanded');
      const children = section.querySelector('.nav-children');
      children.classList.toggle('expanded');
    }

    // Mobile menu toggle
    function toggleMobileMenu() {
      const nav = document.getElementById('leftNav');
      nav.classList.toggle('open');
    }

    // Copy functionality
    function copyCode(btn, text) {
      navigator.clipboard.writeText(text).then(() => {
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i data-lucide="check" class="w-3 h-3"></i> Copied!';
        lucide.createIcons();
        setTimeout(() => {
          btn.innerHTML = originalText;
          lucide.createIcons();
        }, 2000);
      });
    }

    function copyCodeBlock(btn) {
      const codeBlock = btn.closest('.code-block');
      const pre = codeBlock.querySelector('pre');
      const text = pre.textContent;
      copyCode(btn, text);
    }

    // Scroll-sync with GSAP ScrollTrigger
    gsap.registerPlugin(ScrollTrigger);

    const sections = document.querySelectorAll('[data-activity]');
    const activityItems = document.querySelectorAll('.activity-item');

    sections.forEach(section => {
      ScrollTrigger.create({
        trigger: section,
        start: 'top 40%',
        end: 'bottom 40%',
        onEnter: () => activateSection(section.dataset.activity),
        onEnterBack: () => activateSection(section.dataset.activity),
      });
    });

    function activateSection(sectionName) {
      activityItems.forEach(item => {
        if (item.dataset.section === sectionName) {
          item.classList.add('active');
          gsap.to(item, {
            opacity: 1,
            y: -2,
            boxShadow: '0 4px 12px rgba(0,0,0,0.08)',
            duration: 0.3,
            ease: 'power2.out'
          });
        } else {
          item.classList.remove('active');
          gsap.to(item, {
            opacity: 0.5,
            y: 0,
            boxShadow: 'none',
            duration: 0.3,
            ease: 'power2.out'
          });
        }
      });

      document.querySelectorAll('.nav-section-header').forEach(header => {
        header.classList.remove('active');
      });
      const activeNav = document.querySelector(`[data-section="${sectionName}"] .nav-section-header`);
      if (activeNav) {
        activeNav.classList.add('active');
      }
    }

    // Initialize first section as active
    activateSection('essence');

    // Smooth scroll for nav links
    document.querySelectorAll('.nav-item').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const target = document.querySelector(link.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          document.querySelectorAll('.nav-item').forEach(l => l.classList.remove('active'));
          link.classList.add('active');
        }
      });
    });

    // Brushing interaction - hover activity item highlights related content
    activityItems.forEach(item => {
      item.addEventListener('mouseenter', () => {
        const sectionName = item.dataset.section;
        const relatedSection = document.querySelector(`[data-activity="${sectionName}"]`);
        if (relatedSection) {
          relatedSection.style.backgroundColor = 'rgba(13, 147, 115, 0.05)';
          relatedSection.style.transition = 'background-color 0.3s ease';
        }
      });

      item.addEventListener('mouseleave', () => {
        const sectionName = item.dataset.section;
        const relatedSection = document.querySelector(`[data-activity="${sectionName}"]`);
        if (relatedSection) {
          relatedSection.style.backgroundColor = '';
        }
      });
    });
  </script>
</body>
</html>
