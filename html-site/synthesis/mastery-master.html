<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mastery Guides - Claude Code Knowledge Base</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <div class="wide-container">
    <!-- Breadcrumb Navigation -->
    <nav class="nav-breadcrumb">
      <a href="../index.html">Home</a>
      <span>/</span>
      <a href="synthesis-index.html">Synthesis</a>
      <span>/</span>
      <span>Mastery Guides</span>
    </nav>

    <!-- You Are Here Context Box -->
    <div class="you-are-here" style="background: linear-gradient(135deg, #f0ebe3 0%, #fefcf3 100%); border-left: 4px solid #2a7d7d; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
      <h3 style="color: #2a7d7d; margin-top: 0; font-size: 0.9em; text-transform: uppercase; letter-spacing: 0.5px;">You Are Here</h3>
      <p style="margin-bottom: 0;"><strong><span style="font-weight: 700;">Mas</span>tery Guides</strong> - Deep expertise documents for core Claude Code patterns. These are comprehensive references synthesized from 40+ research extractions, covering Context Management, Multi-Agent Architecture, and the Ralph Wiggum pattern.</p>
    </div>

    <h1><span style="font-weight: 700;">Mas</span>tery Guides</h1>

    <p class="conversational-lead">
      Three <span style="font-weight: 700;">def</span>initive references for the most <span style="font-weight: 700;">cri</span>tical Claude Code patterns. Each guide provides complete coverage: mental models, implementation details, troubleshooting, and real-world case studies.
    </p>

    <!-- Table of Contents -->
    <div class="toc">
      <div class="toc-title">Contents</div>
      <ul>
        <li><a href="#context-management">Context Management</a> - The primary constraint and how to work with it</li>
        <li><a href="#multi-agent">Multi-Agent Architecture</a> - Orchestrating multiple Claude instances</li>
        <li><a href="#ralph-complete">Ralph Pattern Complete</a> - Autonomous development loops</li>
      </ul>
    </div>

    <hr class="section-divider">

    <!-- Context Management Section -->
    <section id="context-management">
      <h2><span style="font-weight: 700;">Con</span>text Management: Complete Mastery Guide</h2>

      <div class="problem-statement">
        Context window exhaustion shapes every workflow decision. Claude's ~200K token window (~100K effective) is a hard ceiling that causes quality degradation as it fills. Understanding this constraint is essential for reliable Claude Code usage.
      </div>

      <h3>The Brutal Reality</h3>

      <blockquote>
        "Context rot: LLMs get stupider with more tokens"<br>
        <cite>-- @mattpocockuk</cite>
      </blockquote>

      <table class="comparison-table">
        <thead>
          <tr>
            <th>Context Level</th>
            <th>Quality Impact</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>0-50%</td><td>Full capability</td></tr>
          <tr><td>50-70%</td><td>Slight degradation possible</td></tr>
          <tr><td>70-85%</td><td>Noticeable quality loss</td></tr>
          <tr><td>85-95%</td><td>Significant degradation, instructions forgotten</td></tr>
          <tr><td>95%+</td><td>Failure mode - hallucinations, contradictions, amnesia</td></tr>
        </tbody>
      </table>

      <h3>What Context Rot Looks Like</h3>
      <ol>
        <li><strong>Repetition</strong> - Claude starts repeating earlier statements</li>
        <li><strong>Amnesia</strong> - Forgets work done 10 minutes ago</li>
        <li><strong>Instruction Drift</strong> - CLAUDE.md directives ignored</li>
        <li><strong>Truncation</strong> - Code cut off mid-function</li>
        <li><strong>Hallucination</strong> - References files that don't exist</li>
        <li><strong>False Completion</strong> - Marks tasks done without verification</li>
      </ol>

      <div class="callout callout-insight">
        <div class="callout-title">Fundamental Insight</div>
        <p><strong>Memory is external. The agent is stateless.</strong> This isn't a bug - it's the architecture that enables reliability. Each iteration spawns a NEW instance with NO memory of previous work. Continuity comes from: Git history, prd.json, progress.txt.</p>
      </div>

      <h3>Context Management Strategies</h3>

      <h4>1. Fresh Context Per Iteration</h4>
      <p>Spawn a new agent instance for each task. No memory pollution. Clean slate always.</p>

      <div class="ascii-diagram">
Iteration 1 (fresh Claude instance)
  -> Read state from files (PRD, progress, git)
  -> Pick highest priority incomplete task
  -> Implement + verify
  -> Commit if passing
  -> Update external state
  -> Exit
        |
        | (no memory carried forward)
        v
Iteration 2 (fresh Claude instance)
  -> Read state from files (now updated)
  -> Repeat...
      </div>

      <h4>2. File-Based External State</h4>
      <p>Store ALL state in files. The agent reconstructs context by reading, not by remembering.</p>

      <table>
        <thead>
          <tr><th>File</th><th>Purpose</th><th>Rule</th></tr>
        </thead>
        <tbody>
          <tr><td><code>progress.txt</code></td><td>Memory across iterations</td><td>APPEND ONLY - never edit</td></tr>
          <tr><td><code>prd.json</code></td><td>Task state tracking</td><td>Machine-readable, passes: true/false</td></tr>
          <tr><td><code>CLAUDE.md</code></td><td>Project context</td><td>Under 500 tokens, essential info only</td></tr>
        </tbody>
      </table>

      <h4>3. Git as Memory</h4>
      <p>Git history is the ultimate external memory. Commits are checkpoints, diffs are context, history is narrative.</p>

      <h4>4. Compaction and Optimization</h4>
      <p>Use <code>/compact</code> strategically at 60-70% context. But remember: <strong>compaction is lossy</strong>. Fresh context via Ralph loops is preferred over repeated compaction.</p>

      <!-- Checkpoint Box -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint: After Fresh Context Setup</div>
        <p><strong>Where you are:</strong> You have a Ralph loop script that spawns fresh Claude instances for each task.</p>
        <p><strong>What this enables:</strong> No context degradation. Hours of autonomous work. Quality remains consistent.</p>
        <p><strong>Verify your state:</strong></p>
        <pre><code>ls -la ralph.sh              # Check script exists
jq '.userStories[0]' plans/prd.json  # Check PRD structure
touch plans/progress.txt && ls -la plans/progress.txt</code></pre>
      </div>

      <h3>Context Budget Reference</h3>
      <div class="ascii-diagram">
Total Effective: ~100K tokens
+-- System prompt + CLAUDE.md:   ~5K (5%)
+-- Codebase context:            ~20K (20%)
+-- Current task:                ~2K (2%)
+-- Working memory:              ~30K (30%)
+-- Tool outputs:                ~20K (20%)
+-- Code generation:             ~15K (15%)
+-- Buffer for retries:          ~8K (8%)
      </div>

      <div class="related-pages" style="margin-top: 2rem;">
        <h4>Source Document</h4>
        <p>Full content with troubleshooting: <code>synthesis/mastery-context-management.md</code> (~32K words)</p>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Multi-Agent Section -->
    <section id="multi-agent">
      <h2><span style="font-weight: 700;">Mul</span>ti-Agent Architecture: Complete Mastery Guide</h2>

      <div class="problem-statement">
        Single agents have limits. Multi-agent orchestration enables parallelism, specialization, and scale - but requires understanding the Iron Law of Worker Separation and choosing the right architecture for your needs.
      </div>

      <h3>The Iron Law of Worker Separation</h3>

      <div class="callout callout-warning">
        <div class="callout-title">Critical Rule</div>
        <p><strong>ORCHESTRATORS COORDINATE. WORKERS EXECUTE. NEVER MIX.</strong></p>
        <p>You are the CONDUCTOR. Your agents play the instruments.</p>
      </div>

      <table class="comparison-table">
        <thead>
          <tr><th>Role</th><th>What They Do</th><th>What They DON'T Do</th></tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Orchestrator</strong></td>
            <td>Decompose tasks, assign workers, track progress, synthesize results</td>
            <td>Write code, run commands, explore codebases</td>
          </tr>
          <tr>
            <td><strong>Workers</strong></td>
            <td>Execute specific tasks, use tools directly, report results</td>
            <td>Spawn sub-agents, manage task graphs, make architectural decisions</td>
          </tr>
        </tbody>
      </table>

      <h3>Architecture Comparison</h3>

      <div class="ascii-diagram">
SIMPLE <------------------------------------------> COMPLEX

[Ralph Loop]    [CC Mirror]    [Orchestra]    [Gas Town]
     |               |              |              |
Single agent    Multi-agent    Self-improving  Agent factory
Retry loop      Task-based     Docker-based    Role-based
Bash script     Native CC      Specialized     Full system
      </div>

      <h4>CC Mirror (Hub-and-Spoke)</h4>
      <p><strong>Source:</strong> @nummanali | <strong>Repo:</strong> github.com/numman-ali/cc-mirror</p>
      <p>Unlocks Claude Code's disabled native multi-agent orchestration. Central orchestrator delegates to specialized workers.</p>

      <div class="quick-ref">
        <div class="quick-ref-title">Quick Start</div>
        <pre><code>npx cc-mirror quick --provider mirror --name mclaude
mclaude
"Load the orchestration skill and initiate"</code></pre>
      </div>

      <h4>Gas Town (Agent Factory)</h4>
      <p><strong>Source:</strong> @steve_yegge | <strong>Repo:</strong> github.com/steveyegge/gastown</p>
      <p>A factory for agents. 7 worker roles: Mayor, Deacon, Dogs, Refinery, Polecat, Witness, Crew.</p>

      <div class="callout callout-danger">
        <div class="callout-title">Warning</div>
        <p>"If you're not at Stage 7 (10+ agents, hand-managed), you'll get your face ripped off by superintelligent chimpanzees."</p>
      </div>

      <h4>Ralph Wiggum (Iterative Loop)</h4>
      <p>A bash loop that runs Claude Code repeatedly with fresh context until completion. Named after the simple-minded Simpsons character who persists regardless of obstacles.</p>

      <h4>Parallel Swarms (Worktrees)</h4>
      <p>Running separate Claude instances in isolated git worktrees, each working on independent features.</p>

      <h3>Architecture Selection Guide</h3>

      <table class="comparison-table">
        <thead>
          <tr><th>Factor</th><th>Ralph Loop</th><th>CC Mirror</th><th>Gas Town</th></tr>
        </thead>
        <tbody>
          <tr><td>Setup</td><td>5 min</td><td>5 min</td><td>Days</td></tr>
          <tr><td>Cost/Day</td><td>$</td><td>$$</td><td>$$$$</td></tr>
          <tr><td>Parallelism</td><td>None (serial)</td><td>Native</td><td>Full factory</td></tr>
          <tr><td>Best For</td><td>Overnight builds</td><td>80% of projects</td><td>Stage 7+ scale</td></tr>
        </tbody>
      </table>

      <div class="recommendation">
        <p><strong>Start with CC Mirror</strong> - it covers 80% of use cases with zero effort. Only move to Gas Town when scale demands it.</p>
      </div>

      <div class="related-pages" style="margin-top: 2rem;">
        <h4>Source Document</h4>
        <p>Full content with checkpoints and troubleshooting: <code>synthesis/mastery-multi-agent.md</code> (~46K words)</p>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Ralph Complete Section -->
    <section id="ralph-complete">
      <h2><span style="font-weight: 700;">Ral</span>ph Pattern: Complete Mastery Guide</h2>

      <div class="problem-statement">
        How do you ship features overnight while you sleep? The Ralph Wiggum pattern: a persistence loop that runs Claude Code repeatedly with fresh context until completion, using external file-based memory.
      </div>

      <h3>The Core Mental Model</h3>

      <blockquote>
        "Think of the AI agent as an <strong>eager but somewhat dim junior developer (Ralph)</strong> who never sleeps, happily works on one tiny task at a time, commits often, and tells you when it's truly finished - but needs extremely tight scoping, strong feedback loops, and hard limits to avoid disaster."<br>
        <cite>-- Matt Pocock</cite>
      </blockquote>

      <p>At its absolute core:</p>
      <pre><code>while :; do cat PROMPT.md | claude ; done</code></pre>

      <h3>The Philosophy in Three Principles</h3>

      <ol>
        <li><strong>Fresh Context Beats Accumulated Context</strong> - Each iteration spawns a NEW Claude instance with NO memory. Avoids "context rot".</li>
        <li><strong>Failure Is Data, Not Defeat</strong> - "Deterministically bad" failures are predictable and informative. Each failure refines the next attempt.</li>
        <li><strong>Small + Verifiable = Reliable</strong> - Tasks must fit in one context window. Every task has explicit, testable acceptance criteria.</li>
      </ol>

      <h3>File Structure</h3>

      <div class="file-listing">
        <div class="file-listing-header">Ralph Setup Files</div>
        <div class="file-item">
          <span class="file-name">ralph.sh</span>
          <span class="file-desc">The loop script</span>
        </div>
        <div class="file-item">
          <span class="file-name">prompt.md</span>
          <span class="file-desc">Instructions for each iteration</span>
        </div>
        <div class="file-item">
          <span class="file-name">prd.json</span>
          <span class="file-desc">Task list with user stories (passes: true/false)</span>
        </div>
        <div class="file-item">
          <span class="file-name">progress.txt</span>
          <span class="file-desc">Append-only learnings</span>
        </div>
      </div>

      <h3>Ralph Variants</h3>

      <table>
        <thead>
          <tr><th>Variant</th><th>What It Adds</th><th>Best For</th></tr>
        </thead>
        <tbody>
          <tr><td><strong>Basic Ralph</strong></td><td>Core loop pattern</td><td>Standard feature development</td></tr>
          <tr><td><strong>AFK Ralph</strong></td><td>Full autonomous overnight</td><td>Ship while you sleep</td></tr>
          <tr><td><strong>HOTL Ralph</strong></td><td>Human review between runs</td><td>Security-sensitive code</td></tr>
          <tr><td><strong>Marathon Ralph</strong></td><td>Full SDLC integration</td><td>Complete app builds</td></tr>
          <tr><td><strong>Dr. Ralph</strong></td><td>Confidence thresholds (80%+)</td><td>Complex, uncertain tasks</td></tr>
          <tr><td><strong>Compounding Ralph</strong></td><td>Archives previous runs</td><td>Cross-session learning</td></tr>
          <tr><td><strong>Parallel Ralph</strong></td><td>Multiple worktrees</td><td>Parallel feature development</td></tr>
        </tbody>
      </table>

      <h3>Critical Success Factors</h3>

      <div class="callout callout-success">
        <div class="callout-title">The 2-3 Sentence Rule</div>
        <p>"If you can't describe the task in 2-3 sentences, it's too big." Each task must be completable in ONE iteration (~one context window).</p>
      </div>

      <h4>Right-sized tasks:</h4>
      <ul>
        <li>Add a database column + migration</li>
        <li>Implement one API endpoint</li>
        <li>Create one UI component</li>
        <li>Fix a specific, isolated bug</li>
      </ul>

      <h4>Too big (split these):</h4>
      <ul>
        <li>"Build the entire dashboard"</li>
        <li>"Add authentication"</li>
        <li>"Refactor the API"</li>
      </ul>

      <h3>Acceptance Criteria Must Be Verifiable</h3>

      <div class="tutorial-block">
        <div class="tutorial-header">Good vs Bad Criteria</div>
        <div class="tutorial-content">
          <p><strong>Good (verifiable):</strong></p>
          <pre><code>"acceptanceCriteria": [
  "Column 'investorType' exists with default 'cold'",
  "npm run typecheck passes",
  "npm run test passes"
]</code></pre>
          <p><strong>Bad (vague):</strong></p>
          <pre><code>"acceptanceCriteria": [
  "Works correctly",
  "Good UX",
  "Handles edge cases"
]</code></pre>
        </div>
      </div>

      <h3>The Complete Mental Model</h3>

      <div class="ascii-diagram">
              RALPH MENTAL MODEL
                    |
    +---------------+---------------+
    |                               |
EXTERNAL MEMORY              FRESH CONTEXT
    |                               |
 - Git history                  - No rot
 - prd.json        Continuity   - Clean slate
 - progress.txt  <----------->  - Full capacity
 - File system                      |
    |                               |
    +---------------+---------------+
                    |
          SMALL, VERIFIABLE TASKS
                    |
             - 2-3 sentence rule
             - One context window
             - Clear criteria
                    |
              FEEDBACK LOOPS
                    |
             - Tests must pass
             - Typecheck green
             - CI validates
                    |
            EXPLICIT SIGNALS
                    |
             - &lt;promise&gt;COMPLETE
             - passes: true
             - Max iterations
      </div>

      <!-- Checkpoint -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint: After First Successful Ralph Run</div>
        <p><strong>Where you are:</strong> Ralph has completed at least one iteration successfully.</p>
        <p><strong>What this enables:</strong> Proof that the pattern works in YOUR codebase with YOUR setup.</p>
        <p><strong>Verify your state:</strong></p>
        <pre><code>git log --oneline -5                    # Check for Ralph's commits
jq '.userStories[] | select(.passes == true) | .id' plans/prd.json
tail -20 plans/progress.txt             # Check for entries</code></pre>
        <p><strong>Signs of healthy operation:</strong></p>
        <ul>
          <li>At least one story marked passes: true</li>
          <li>Git commit with feat: US-XXX format</li>
          <li>progress.txt has new entries (appended, not replaced)</li>
        </ul>
      </div>

      <div class="related-pages" style="margin-top: 2rem;">
        <h4>Source Document</h4>
        <p>Full content with all variants and troubleshooting: <code>synthesis/mastery-ralph-complete.md</code> (~54K words)</p>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Milestone -->
    <div class="milestone" style="background: linear-gradient(90deg, #6b9b7a 0%, #2a7d7d 100%); color: white; padding: 1rem 1.5rem; border-radius: 8px; text-align: center; margin: 2rem 0;">
      Master these three patterns and you'll have the foundation for all advanced Claude Code workflows.
    </div>

    <!-- Footer Navigation -->
    <div class="footer-nav">
      <a href="synthesis-index.html">Back to Synthesis Index</a>
      <a href="principles-master.html">Next: Principles</a>
    </div>

  </div>
</body>
</html>
