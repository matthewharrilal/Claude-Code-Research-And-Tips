<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cost Economics Reference | Claude Code Documentation</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Lucide Icons CDN -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- GSAP for scroll-sync -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

  <!-- Tailwind Config with Design Tokens -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'bg-base': '#ffffff',
            'bg-subtle': '#fafafa',
            'bg-muted': '#f4f4f5',
            'text-primary': '#18181b',
            'text-secondary': '#3f3f46',
            'text-muted': '#71717a',
            'accent': '#0D9373',
            'accent-light': '#10b981',
            'accent-bg': '#ecfdf5',
            'border': '#e4e4e7',
            // Activity Zone content type colors (Original 6)
            'az-invariant': '#3b82f6',    // Blue
            'az-effect': '#f59e0b',       // Amber
            'az-composition': '#8b5cf6',  // Purple
            'az-frontier': '#ef4444',     // Red
            'az-warstory': '#10b981',     // Green
            'az-alternative': '#6b7280',  // Gray
            // Activity Zone generative content types (New 10)
            'az-inversion': '#4f46e5',    // Indigo
            'az-constraint': '#8b5cf6',   // Violet
            'az-gradient': '#f43f5e',     // Rose
            'az-horizon': '#06b6d4',      // Cyan
            'az-violation': '#f97316',    // Orange
            'az-tradeoff': '#f59e0b',     // Amber
            'az-analogy': '#d946ef',      // Fuchsia
            'az-expertise': '#10b981',    // Emerald
            'az-minimal': '#84cc16',      // Lime
            'az-inflection': '#eab308',   // Yellow
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
            mono: ['Fira Code', 'monospace'],
          },
        },
      },
    }
  </script>

  <style>
    /* Base Styles */
    * {
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
      scroll-padding-top: 80px;
    }

    [id] {
      scroll-margin-top: 80px;
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: #ffffff;
      color: #18181b;
      line-height: 1.7;
    }

    /* Three Panel Layout */
    .three-panel-layout {
      min-height: 100vh;
      position: relative;
    }

    /* Header */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 56px;
      background: #ffffff;
      border-bottom: 1px solid #e4e4e7;
      z-index: 100;
      display: flex;
      align-items: center;
      padding: 0 24px;
    }

    /* Left Navigation - 240px fixed */
    .left-nav {
      position: fixed;
      top: 56px;
      left: 0;
      width: 240px;
      height: calc(100vh - 56px);
      border-right: 1px solid #e4e4e7;
      background: #ffffff;
      overflow-y: auto;
      padding: 16px 0;
      z-index: 40;
    }

    .nav-section {
      padding: 0 12px;
      margin-bottom: 8px;
    }

    .nav-section-header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      font-size: 14px;
      font-weight: 500;
      color: #3f3f46;
      cursor: pointer;
      border-radius: 6px;
      transition: background 0.15s;
    }

    .nav-section-header:hover {
      background: #f4f4f5;
    }

    .nav-section-header.active {
      color: #0D9373;
      background: #ecfdf5;
    }

    .nav-item {
      display: block;
      padding: 6px 12px 6px 44px;
      font-size: 14px;
      color: #71717a;
      text-decoration: none;
      border-radius: 6px;
      transition: all 0.15s;
    }

    .nav-item:hover {
      color: #3f3f46;
      background: #f4f4f5;
    }

    .nav-item.active {
      color: #0D9373;
      background: #ecfdf5;
    }

    .nav-children {
      display: none;
      overflow: hidden;
    }

    .nav-children.expanded {
      display: block;
    }

    .nav-chevron {
      transition: transform 0.2s;
    }

    .nav-section.expanded .nav-chevron {
      transform: rotate(90deg);
    }

    /* Main Content - Flexible, margins for fixed sidebars */
    .main-content {
      margin-left: 240px;
      margin-right: 480px;
      margin-top: 56px;
      padding: 48px 48px;
      min-width: 400px;
    }

    /* Activity Zone - 480px fixed */
    .activity-zone {
      position: fixed;
      top: 56px;
      right: 0;
      width: 480px;
      height: calc(100vh - 56px);
      border-left: 1px dashed #e4e4e7;
      background: #fafafa;
      overflow-y: auto;
      padding: 24px 20px;
      z-index: 40;
    }

    /* Responsive: Hide Activity Zone below 1400px */
    @media (max-width: 1400px) {
      .activity-zone {
        display: none;
      }
      .main-content {
        margin-right: 0;
        padding: 40px 32px;
      }
    }

    /* Responsive: Hide Left Nav below 768px */
    @media (max-width: 768px) {
      .left-nav {
        display: none;
      }
      .left-nav.open {
        display: block;
        position: fixed;
        top: 56px;
        left: 0;
        right: 0;
        bottom: 0;
        background: #ffffff;
        z-index: 50;
        overflow-y: auto;
      }
      .main-content {
        margin-left: 0;
        padding: 24px 16px;
        min-width: auto;
      }
    }

    /* Resizer */
    .resizer {
      position: fixed;
      top: 56px;
      right: 480px;
      width: 6px;
      height: calc(100vh - 56px);
      cursor: col-resize;
      background: transparent;
      z-index: 50;
      transition: background 0.15s ease;
    }

    .resizer:hover {
      background: rgba(13, 147, 115, 0.15);
    }

    .resizer.active {
      background: rgba(13, 147, 115, 0.25);
    }

    body.resizing {
      user-select: none;
      cursor: col-resize !important;
    }

    body.resizing * {
      cursor: col-resize !important;
    }

    @media (max-width: 1400px) {
      .resizer {
        display: none;
      }
    }

    /* Activity Zone Items */
    .activity-item {
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      background: #ffffff;
      border: 1px solid #e4e4e7;
      font-size: 14px;
      line-height: 1.6;
      opacity: 0.5;
      transition: all 0.3s ease;
    }

    .activity-item.active {
      opacity: 1;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .activity-item:hover {
      opacity: 1;
    }

    .activity-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    /* Activity Zone content type borders */
    .activity-item.invariant { border-left: 4px solid #3b82f6; }
    .activity-item.effect { border-left: 4px solid #f59e0b; }
    .activity-item.composition { border-left: 4px solid #8b5cf6; }
    .activity-item.frontier { border-left: 4px solid #ef4444; }
    .activity-item.warstory { border-left: 4px solid #10b981; }
    .activity-item.alternative { border-left: 4px solid #6b7280; }
    .activity-item.inversion { border-left: 4px solid #4f46e5; }
    .activity-item.constraint { border-left: 4px solid #8b5cf6; }
    .activity-item.gradient { border-left: 4px solid #f43f5e; }
    .activity-item.horizon { border-left: 4px solid #06b6d4; }
    .activity-item.violation { border-left: 4px solid #f97316; }
    .activity-item.tradeoff { border-left: 4px solid #f59e0b; }
    .activity-item.analogy { border-left: 4px solid #d946ef; }
    .activity-item.expertise { border-left: 4px solid #10b981; }
    .activity-item.minimal { border-left: 4px solid #84cc16; }
    .activity-item.inflection { border-left: 4px solid #eab308; }

    /* Main Content Components */

    /* Section titles with number */
    .section-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      background: #0D9373;
      color: #ffffff;
      font-size: 14px;
      font-weight: 600;
      border-radius: 50%;
      margin-right: 12px;
    }

    .section-title {
      font-size: 24px;
      font-weight: 600;
      color: #18181b;
      margin-bottom: 20px;
      margin-top: 56px;
      display: flex;
      align-items: center;
    }

    .section-title:first-child {
      margin-top: 0;
    }

    /* Essence Box */
    .essence-box {
      background: linear-gradient(135deg, #18181b 0%, #27272a 100%);
      border-radius: 12px;
      padding: 32px;
      margin-bottom: 40px;
    }

    .essence-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #10b981;
      margin-bottom: 12px;
    }

    .essence-text {
      font-size: 22px;
      font-weight: 500;
      color: #ffffff;
      line-height: 1.4;
    }

    /* Core Abstraction Box */
    .core-abstraction {
      background: #fafafa;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 40px;
    }

    .core-philosophy {
      font-size: 16px;
      color: #3f3f46;
      margin-bottom: 16px;
      font-style: italic;
    }

    .core-code {
      background: #18181b;
      border-radius: 8px;
      padding: 16px 20px;
      margin-bottom: 16px;
      overflow-x: auto;
    }

    .core-code code {
      font-family: 'Fira Code', monospace;
      font-size: 15px;
      color: #10b981;
      white-space: nowrap;
    }

    .core-anchor {
      font-size: 14px;
      color: #71717a;
      text-align: center;
    }

    /* Design Decision Box */
    .decision-box {
      background: #ffffff;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
    }

    .decision-why {
      font-size: 16px;
      font-weight: 600;
      color: #0D9373;
      margin-bottom: 12px;
    }

    .decision-reasoning {
      font-size: 14px;
      color: #3f3f46;
      margin-bottom: 16px;
    }

    .decision-implication {
      background: #f4f4f5;
      border-radius: 8px;
      padding: 16px;
    }

    .decision-implication-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      color: #71717a;
      margin-bottom: 8px;
    }

    /* Code Blocks */
    .code-block {
      background: #18181b;
      border-radius: 8px;
      padding: 16px 20px;
      margin-bottom: 24px;
      position: relative;
      overflow-x: auto;
    }

    .code-block pre {
      margin: 0;
      font-family: 'Fira Code', monospace;
      font-size: 13px;
      color: #e4e4e7;
      line-height: 1.6;
    }

    .code-block .comment { color: #6b7280; }
    .code-block .keyword { color: #c084fc; }
    .code-block .string { color: #10b981; }
    .code-block .variable { color: #60a5fa; }
    .code-block .number { color: #f59e0b; }

    .copy-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: #3f3f46;
      color: #ffffff;
      border: none;
      border-radius: 4px;
      padding: 6px 10px;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: background 0.15s;
    }

    .copy-btn:hover {
      background: #52525b;
    }

    /* Data Tables */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 24px;
      font-size: 14px;
    }

    .data-table th {
      background: #f4f4f5;
      padding: 12px 16px;
      text-align: left;
      font-weight: 600;
      color: #3f3f46;
      border-bottom: 2px solid #e4e4e7;
    }

    .data-table td {
      padding: 12px 16px;
      border-bottom: 1px solid #e4e4e7;
      color: #3f3f46;
    }

    .data-table tr:hover {
      background: #fafafa;
    }

    .data-table code {
      background: #f4f4f5;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 12px;
    }

    /* Gotcha Box */
    .gotcha-box {
      background: #fffbeb;
      border: 1px solid #fcd34d;
      border-left: 4px solid #f59e0b;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .gotcha-title {
      font-weight: 600;
      color: #92400e;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .gotcha-detail {
      font-size: 14px;
      color: #78350f;
      margin-bottom: 8px;
    }

    .gotcha-detail strong {
      color: #92400e;
    }

    /* What's Hard Box */
    .hard-box {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-left: 4px solid #ef4444;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .hard-title {
      font-weight: 600;
      color: #991b1b;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .hard-detail {
      font-size: 14px;
      color: #7f1d1d;
      margin-bottom: 8px;
    }

    /* When To Use Grid */
    .when-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 40px;
    }

    @media (max-width: 900px) {
      .when-grid {
        grid-template-columns: 1fr;
      }
    }

    .when-use {
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      border-radius: 12px;
      padding: 24px;
    }

    .when-not {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: 12px;
      padding: 24px;
    }

    .when-title {
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .when-use .when-title { color: #166534; }
    .when-not .when-title { color: #991b1b; }

    .when-item {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      font-size: 14px;
    }

    .when-use .when-item { color: #166534; }
    .when-not .when-item { color: #991b1b; }

    /* Checkpoint Box */
    .checkpoint-box {
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      border-left: 4px solid #22c55e;
      border-radius: 8px;
      padding: 20px;
      margin: 32px 0;
    }

    .checkpoint-title {
      font-weight: 600;
      color: #166534;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .checkpoint-item {
      font-size: 14px;
      color: #166534;
      margin-bottom: 8px;
      padding-left: 24px;
      position: relative;
    }

    .checkpoint-item::before {
      content: "[ ]";
      position: absolute;
      left: 0;
      font-family: 'Fira Code', monospace;
      font-size: 12px;
    }

    /* Mobile Menu Button */
    .mobile-menu-btn {
      display: none;
      padding: 8px;
      background: none;
      border: none;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .mobile-menu-btn {
        display: flex;
      }
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: #fafafa;
    }

    ::-webkit-scrollbar-thumb {
      background: #d4d4d8;
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #a1a1aa;
    }

    /* Keyboard shortcut hint */
    .kbd {
      display: inline-flex;
      align-items: center;
      padding: 2px 6px;
      background: #f4f4f5;
      border: 1px solid #e4e4e7;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 12px;
      color: #71717a;
    }

    /* Highlight box */
    .highlight-box {
      background: #ecfdf5;
      border: 1px solid #a7f3d0;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
    }

    .highlight-box strong {
      color: #0D9373;
    }

    /* Formula box */
    .formula-box {
      background: #f0f9ff;
      border: 1px solid #bae6fd;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 24px;
      font-family: 'Fira Code', monospace;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle menu">
      <i data-lucide="menu" class="w-5 h-5 text-text-secondary"></i>
    </button>
    <div class="flex items-center gap-3">
      <i data-lucide="terminal" class="w-5 h-5 text-accent"></i>
      <span class="font-semibold text-text-primary">Claude Code</span>
    </div>
    <div class="flex-1 flex justify-center">
      <button class="flex items-center gap-2 px-4 py-2 bg-bg-muted rounded-lg text-text-muted text-sm hover:bg-border transition-colors">
        <i data-lucide="search" class="w-4 h-4"></i>
        <span>Search documentation...</span>
        <span class="kbd">Cmd+K</span>
      </button>
    </div>
    <div class="flex items-center gap-4">
      <a href="#" class="text-sm text-text-muted hover:text-text-primary transition-colors">Support</a>
      <button class="p-2 hover:bg-bg-muted rounded-lg transition-colors" aria-label="Toggle theme">
        <i data-lucide="sun" class="w-4 h-4 text-text-muted"></i>
      </button>
    </div>
  </header>

  <div class="three-panel-layout">
    <!-- Left Navigation -->
    <nav class="left-nav" id="leftNav">
      <div class="px-4 mb-4">
        <span class="text-xs font-semibold text-text-muted uppercase tracking-wider">Cost Economics</span>
      </div>

      <!-- Essence -->
      <div class="nav-section expanded" data-section="essence">
        <div class="nav-section-header active" onclick="toggleSection(this)">
          <i data-lucide="dollar-sign" class="w-4 h-4"></i>
          <span>Essence</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#essence" class="nav-item active">The 15-Word Summary</a>
        </div>
      </div>

      <!-- Core Abstraction -->
      <div class="nav-section expanded" data-section="core">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="box" class="w-4 h-4"></i>
          <span>Core Abstraction</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#core-abstraction" class="nav-item">The Cost Formula</a>
        </div>
      </div>

      <!-- Design Decisions -->
      <div class="nav-section expanded" data-section="decisions">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="lightbulb" class="w-4 h-4"></i>
          <span>Design Decisions</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#why-model-selection" class="nav-item">Why Model Selection?</a>
          <a href="#why-caching" class="nav-item">Why Caching?</a>
          <a href="#why-subscription" class="nav-item">Why Subscription vs API?</a>
        </div>
      </div>

      <!-- Pricing Tables -->
      <div class="nav-section" data-section="pricing">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="table" class="w-4 h-4"></i>
          <span>Pricing Tables</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#pricing" class="nav-item">Model Pricing</a>
          <a href="#caching-pricing" class="nav-item">Caching Pricing</a>
          <a href="#subscription-pricing" class="nav-item">Subscriptions</a>
        </div>
      </div>

      <!-- Pattern Costs -->
      <div class="nav-section" data-section="patterns">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="git-branch" class="w-4 h-4"></i>
          <span>Pattern Costs</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#patterns" class="nav-item">Cost by Pattern</a>
        </div>
      </div>

      <!-- Gotchas -->
      <div class="nav-section" data-section="gotchas">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="alert-triangle" class="w-4 h-4"></i>
          <span>Gotchas</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#gotchas" class="nav-item">Cost Surprises</a>
        </div>
      </div>

      <!-- What's Hard -->
      <div class="nav-section" data-section="hard">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="flame" class="w-4 h-4"></i>
          <span>What's Hard</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#hard" class="nav-item">Real Complexity</a>
        </div>
      </div>

      <!-- When to Use -->
      <div class="nav-section" data-section="when">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="check-circle" class="w-4 h-4"></i>
          <span>When to Use</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#when" class="nav-item">Decision Criteria</a>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">

      <!-- Section 1: ESSENCE -->
      <section id="essence" data-activity="essence">
        <div class="essence-box">
          <div class="essence-label">Essence (15 words)</div>
          <div class="essence-text">Model selection, caching, and context management determine 80% of your Claude Code costs.</div>
        </div>
      </section>

      <!-- Section 2: CORE ABSTRACTION -->
      <section id="core-abstraction" data-activity="core">
        <h2 class="section-title">
          <span class="section-number">2</span>
          The Core Abstraction
        </h2>

        <div class="core-abstraction">
          <div class="core-philosophy">"Output tokens cost 5x input tokens. Caching cuts input by 90%. Model selection cuts both by 80%."</div>

          <div class="core-code">
            <button class="copy-btn" onclick="copyCode(this, 'Cost = (Input_Tokens * Input_Price) + (Output_Tokens * Output_Price)')">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <code>Cost = (Input_Tokens * Input_Price) + (Output_Tokens * Output_Price)</code>
          </div>

          <div class="core-anchor">Three levers: model, caching, context. Master these and costs become predictable.</div>
        </div>

        <p class="text-text-secondary mb-6">
          Claude Code costs are driven by <strong>tokens</strong>. Input tokens (what you send) cost less than output tokens (what Claude generates). But the real insight is that most input tokens are repeated context that can be cached, and most tasks don't require the most expensive model.
        </p>

        <div class="highlight-box">
          <strong>The 60-80% Savings Formula:</strong> "Haiku for setup, Sonnet for builds, Opus for reviews." Apply this consistently and you've cut costs by 60-80% without losing quality where it matters.
        </div>

        <p class="text-text-secondary mb-6">
          Anthropic's official stats: Average developer costs <strong>$6/day</strong>. 90th percentile: <strong>&lt;$12/day</strong>. Team average: <strong>$100-200/developer/month</strong>. If you're above these numbers, you're doing something wrong.
        </p>
      </section>

      <!-- Section 3: DESIGN DECISIONS -->
      <section id="why-model-selection" data-activity="decisions">
        <h2 class="section-title">
          <span class="section-number">3</span>
          Design Decisions
        </h2>

        <div class="decision-box">
          <div class="decision-why">WHY MODEL SELECTION?</div>
          <div class="decision-reasoning">
            Opus 4.5 costs 5x Haiku 4.5 for input and 5x for output. But Opus isn't 5x better at routine tasks. The quality difference only matters for complex reasoning, architectural decisions, and final reviews.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Use Haiku ($1/$5 per 1M) for: code review, linting, documentation, simple queries.<br>
              Use Sonnet ($3/$15 per 1M) for: daily development, debugging, implementation.<br>
              Use Opus ($5/$25 per 1M) for: complex refactoring, architecture decisions, critical reviews.
            </div>
          </div>
        </div>

        <div class="decision-box" id="why-caching">
          <div class="decision-why">WHY CACHING?</div>
          <div class="decision-reasoning">
            Cache reads cost 0.1x base price. If your system prompt or CLAUDE.md is 10K tokens and you make 50 requests, caching saves $1.35 per session with Sonnet. That's $27/month for one developer.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Structure prompts with static content first. Reuse system prompts across sessions. Batch similar queries together. Use 1-hour cache for long workflows. Target 30:1+ cache read:write ratio.
            </div>
          </div>
        </div>

        <div class="decision-box" id="why-subscription">
          <div class="decision-why">WHY SUBSCRIPTION VS API?</div>
          <div class="decision-reasoning">
            At Anthropic's reported $6/day average, API costs ~$180/month. Max 20x ($200/month) becomes economical for heavy users. But subscriptions hide usage data, making optimization harder.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Predictable high-volume = Subscription (Max 5x or 20x).<br>
              Variable/bursty usage = API pay-per-token.<br>
              Need fine-grained model control = API.<br>
              Multi-agent orchestration = Max 20x or API with separate keys.
            </div>
          </div>
        </div>
      </section>

      <!-- Section 4: PRICING TABLES -->
      <section id="pricing" data-activity="pricing">
        <h2 class="section-title">
          <span class="section-number">4</span>
          Pricing Tables
        </h2>

        <h3 class="font-semibold text-lg mb-4">Model Pricing (January 2026)</h3>

        <table class="data-table">
          <thead>
            <tr>
              <th>Model</th>
              <th>Input (per 1M)</th>
              <th>Output (per 1M)</th>
              <th>Context</th>
              <th>Best For</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Claude Haiku 4.5</strong></td>
              <td>$1.00</td>
              <td>$5.00</td>
              <td>200K</td>
              <td>Speed, volume, simple tasks</td>
            </tr>
            <tr>
              <td><strong>Claude Haiku 3.5</strong></td>
              <td>$0.80</td>
              <td>$4.00</td>
              <td>200K</td>
              <td>Budget batch processing</td>
            </tr>
            <tr>
              <td><strong>Claude Haiku 3</strong></td>
              <td>$0.25</td>
              <td>$1.25</td>
              <td>200K</td>
              <td>Lowest cost option</td>
            </tr>
            <tr>
              <td><strong>Claude Sonnet 4.5</strong></td>
              <td>$3.00</td>
              <td>$15.00</td>
              <td>200K (1M beta)</td>
              <td>Daily development work</td>
            </tr>
            <tr>
              <td><strong>Claude Sonnet 4</strong></td>
              <td>$3.00</td>
              <td>$15.00</td>
              <td>200K (1M beta)</td>
              <td>General-purpose coding</td>
            </tr>
            <tr>
              <td><strong>Claude Opus 4.5</strong></td>
              <td>$5.00</td>
              <td>$25.00</td>
              <td>200K</td>
              <td>Complex reasoning, critical tasks</td>
            </tr>
            <tr>
              <td><strong>Claude Opus 4.1</strong></td>
              <td>$15.00</td>
              <td>$75.00</td>
              <td>200K</td>
              <td>Legacy (higher cost)</td>
            </tr>
          </tbody>
        </table>

        <div class="highlight-box mb-6">
          <strong>Key Insight:</strong> Opus 4.5 represents a <strong>67% price reduction</strong> from Opus 4.1 ($5/$25 vs $15/$75) while maintaining flagship capabilities.
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8" id="caching-pricing">Prompt Caching Pricing</h3>

        <table class="data-table">
          <thead>
            <tr>
              <th>Cache Operation</th>
              <th>Multiplier</th>
              <th>Opus 4.5</th>
              <th>Sonnet 4.5</th>
              <th>Haiku 4.5</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Base Input</td>
              <td>1.0x</td>
              <td>$5.00/MTok</td>
              <td>$3.00/MTok</td>
              <td>$1.00/MTok</td>
            </tr>
            <tr>
              <td>5-min Cache Write</td>
              <td>1.25x</td>
              <td>$6.25/MTok</td>
              <td>$3.75/MTok</td>
              <td>$1.25/MTok</td>
            </tr>
            <tr>
              <td>1-hour Cache Write</td>
              <td>2.0x</td>
              <td>$10.00/MTok</td>
              <td>$6.00/MTok</td>
              <td>$2.00/MTok</td>
            </tr>
            <tr>
              <td>Cache Read/Refresh</td>
              <td>0.1x</td>
              <td>$0.50/MTok</td>
              <td>$0.30/MTok</td>
              <td>$0.10/MTok</td>
            </tr>
          </tbody>
        </table>

        <div class="formula-box">
          <strong>Caching Savings Example (Sonnet 4.5):</strong><br>
          First request:  3,500 tokens x $3.75/M = $0.013 (cache write)<br>
          Next 4 requests: 3,500 tokens x $0.30/M = $0.001 each (cache read)<br>
          Total: $0.017<br><br>
          Without caching: 5 x 3,500 x $3.00/M = $0.053<br>
          <strong>Savings: 68%</strong>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8" id="subscription-pricing">Subscription Plans</h3>

        <table class="data-table">
          <thead>
            <tr>
              <th>Plan</th>
              <th>Monthly Cost</th>
              <th>Usage vs Pro</th>
              <th>Target User</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Free</strong></td>
              <td>$0</td>
              <td>Baseline</td>
              <td>Evaluation</td>
            </tr>
            <tr>
              <td><strong>Pro</strong></td>
              <td>$20</td>
              <td>5x Free</td>
              <td>Regular developers</td>
            </tr>
            <tr>
              <td><strong>Max 5x</strong></td>
              <td>$100</td>
              <td>5x Pro (25x Free)</td>
              <td>Power users</td>
            </tr>
            <tr>
              <td><strong>Max 20x</strong></td>
              <td>$200</td>
              <td>20x Pro (100x Free)</td>
              <td>Heavy automation</td>
            </tr>
            <tr>
              <td><strong>Team</strong></td>
              <td>$30/user/month</td>
              <td>5-seat minimum</td>
              <td>Pooled usage</td>
            </tr>
            <tr>
              <td><strong>Enterprise</strong></td>
              <td>Custom</td>
              <td>Custom limits</td>
              <td>Dedicated support</td>
            </tr>
          </tbody>
        </table>

        <div class="checkpoint-box">
          <div class="checkpoint-title">
            <i data-lucide="check-circle" class="w-4 h-4"></i>
            Checkpoint: Pricing Fundamentals
          </div>
          <div class="checkpoint-item">Current model pricing (Haiku &lt; Sonnet &lt; Opus)</div>
          <div class="checkpoint-item">Prompt caching savings (up to 90% on cached content)</div>
          <div class="checkpoint-item">Batch API discount (50% off)</div>
          <div class="checkpoint-item">Subscription tiers and when each makes sense</div>
        </div>
      </section>

      <!-- Section 5: PATTERN COSTS -->
      <section id="patterns" data-activity="patterns">
        <h2 class="section-title">
          <span class="section-number">5</span>
          Pattern Cost Analysis
        </h2>

        <p class="text-text-secondary mb-6">
          Different patterns have dramatically different cost profiles. Understanding these helps you budget and choose the right approach.
        </p>

        <h3 class="font-semibold text-lg mb-4">Single Session Costs</h3>

        <table class="data-table">
          <thead>
            <tr>
              <th>Session Type</th>
              <th>Token Range</th>
              <th>Cost Range (Sonnet 4.5)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Quick question</td>
              <td>1K-5K</td>
              <td>$0.01-$0.08</td>
            </tr>
            <tr>
              <td>Bug fix session</td>
              <td>10K-30K</td>
              <td>$0.15-$0.50</td>
            </tr>
            <tr>
              <td>Feature implementation</td>
              <td>50K-100K</td>
              <td>$0.75-$1.80</td>
            </tr>
            <tr>
              <td>Heavy refactoring</td>
              <td>100K-200K</td>
              <td>$1.80-$3.60</td>
            </tr>
          </tbody>
        </table>

        <h3 class="font-semibold text-lg mb-4 mt-8">Ralph Loop Costs</h3>

        <table class="data-table">
          <thead>
            <tr>
              <th>Loop Configuration</th>
              <th>Per Iteration</th>
              <th>10 Iterations</th>
              <th>50 Iterations</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Small codebase, focused task</td>
              <td>$0.50-$2</td>
              <td>$5-$20</td>
              <td>$25-$100</td>
            </tr>
            <tr>
              <td>Medium codebase, complex task</td>
              <td>$2-$5</td>
              <td>$20-$50</td>
              <td>$100-$250</td>
            </tr>
            <tr>
              <td>Large codebase, autonomous</td>
              <td>$5-$15</td>
              <td>$50-$150</td>
              <td>$250-$750</td>
            </tr>
          </tbody>
        </table>

        <h3 class="font-semibold text-lg mb-4 mt-8">Multi-Agent Orchestration Costs</h3>

        <table class="data-table">
          <thead>
            <tr>
              <th>Architecture</th>
              <th>Agents</th>
              <th>Per-Session</th>
              <th>Daily Estimate</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Basic orchestrator + 2 workers</td>
              <td>3</td>
              <td>$3-$10</td>
              <td>$15-$50</td>
            </tr>
            <tr>
              <td>Task router + specialists</td>
              <td>4-6</td>
              <td>$10-$30</td>
              <td>$50-$150</td>
            </tr>
            <tr>
              <td>Full Gas Town (Mayor, Deacon, Dogs)</td>
              <td>5-10+</td>
              <td>$30-$100</td>
              <td>$150-$500</td>
            </tr>
            <tr>
              <td>Personal Panopticon (8 domains)</td>
              <td>8+</td>
              <td>$20-$80</td>
              <td>$100-$400</td>
            </tr>
          </tbody>
        </table>

        <div class="highlight-box">
          <strong>Token Savings Techniques:</strong><br>
          - Multi-agent Ralph loop claims <strong>95% token savings</strong> through efficient coordination<br>
          - Claude-Flow reports <strong>32.3% token reduction</strong> through context management<br>
          - Programmatic tool calling: <strong>37% reduction</strong> by keeping intermediate results out of context
        </div>
      </section>

      <!-- Section 6: GOTCHAS -->
      <section id="gotchas" data-activity="gotchas">
        <h2 class="section-title">
          <span class="section-number">6</span>
          Gotchas
        </h2>

        <p class="text-text-secondary mb-6">
          Real cost surprises you'll hit, with concrete numbers and fixes:
        </p>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Unexpected cost spike
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Daily cost jumped from $5 to $50+. Budget consumed unexpectedly fast.</div>
          <div class="gotcha-detail"><strong>Common Causes:</strong></div>
          <div class="gotcha-detail">1. Runaway Ralph loop - No iteration limit, ran overnight</div>
          <div class="gotcha-detail">2. Large file reads - Reading entire codebases into context</div>
          <div class="gotcha-detail">3. Wrong model selection - Using Opus for simple tasks</div>
          <div class="gotcha-detail">4. Cache invalidation - Same prompts re-cached repeatedly</div>
          <div class="gotcha-detail"><strong>Prevention:</strong> Set MAX_ITERATIONS on all loops. Use <code>/context</code> to monitor. Set workspace spending limits.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Hit rate limit unexpectedly
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> "Rate limit exceeded" errors. Session pauses mid-work.</div>
          <div class="gotcha-detail"><strong>Common Causes:</strong></div>
          <div class="gotcha-detail">1. Parallel agents without coordination</div>
          <div class="gotcha-detail">2. Rapid successive requests without delays</div>
          <div class="gotcha-detail">3. Token burst from large file operations</div>
          <div class="gotcha-detail">4. Shared API key across team</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Add <code>sleep 5</code> between iterations. Stagger parallel agents with random delays. Use separate API keys per developer.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Cost unpredictable between sessions
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Same task costs $0.50 one day, $5.00 the next. No pattern.</div>
          <div class="gotcha-detail"><strong>Common Causes:</strong></div>
          <div class="gotcha-detail">1. Context size variation - Different starting conditions</div>
          <div class="gotcha-detail">2. Cache efficiency - Cold cache vs warm cache</div>
          <div class="gotcha-detail">3. Model drift - Claude taking different approaches</div>
          <div class="gotcha-detail">4. Retry loops - Hidden failures triggering retries</div>
          <div class="gotcha-detail"><strong>Tracking:</strong> Log <code>/context</code> at start, <code>/cost</code> at end. Track correlation over time.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Subscription doesn't match usage pattern
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Pro subscription but hitting 5-hour limits. Max subscription feels wasted.</div>
          <div class="gotcha-detail"><strong>Decision Framework:</strong></div>
          <div class="gotcha-detail">&lt;2 hours/day: Pro ($20)</div>
          <div class="gotcha-detail">2-4 hours bursts: Pro + API hybrid</div>
          <div class="gotcha-detail">4-8 hours steady: Team or Max ($100-200)</div>
          <div class="gotcha-detail">Heavy automation: API direct</div>
        </div>
      </section>

      <!-- Section 7: WHAT'S HARD -->
      <section id="hard" data-activity="hard">
        <h2 class="section-title">
          <span class="section-number">7</span>
          What's Hard
        </h2>

        <p class="text-text-secondary mb-6">
          These are fundamental tensions in cost management, not bugs to fix:
        </p>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            The Productivity Paradox
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Individual developer gains don't automatically translate to organizational gains.</div>
          <div class="hard-detail"><strong>The numbers:</strong> +98% PR throughput, but +91% review time. +21% tasks completed, but delivery velocity "largely unchanged."</div>
          <div class="hard-detail"><strong>Root cause:</strong> Bottleneck shifts from production to review. Teams generate more code but create downstream pressure.</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Track quality metrics alongside quantity. Factor review time into ROI calculations. Don't optimize for metrics that shift the bottleneck.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Cost vs. Quality Trade-off
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Cheaper models make more mistakes. But mistakes waste developer time, which is more expensive than tokens.</div>
          <div class="hard-detail"><strong>The dilemma:</strong> Use Haiku and save $4/session but spend 30 minutes fixing its mistakes? Or use Opus and spend the $4 but get it right first time?</div>
          <div class="hard-detail"><strong>Mitigation:</strong> The answer varies by task. Match model to task complexity. "Haiku for setup, Sonnet for builds, Opus for reviews" is the heuristic.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            ROI Measurement Timeline
          </div>
          <div class="hard-detail"><strong>The tension:</strong> ROI takes 6 months to measure meaningfully, but budgets are set quarterly.</div>
          <div class="hard-detail"><strong>The phases:</strong> 2-4 weeks learning curve (productivity drop), 2-3 months pattern stabilization, 6 months ROI confidence.</div>
          <div class="hard-detail"><strong>Warning:</strong> Short-term measurements during learning curves produce misleading negative results. Don't cut costs during the learning phase.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Hidden Token Consumers
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Tools like Playwright MCP, Computer Use, and extended thinking burn tokens invisibly.</div>
          <div class="hard-detail"><strong>The numbers:</strong> Computer Use adds 735 tokens + screenshots per action. Text Editor adds 700 tokens overhead. Web Search costs $10 per 1,000 searches.</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Use community monitoring tools (CC Usage, ccusage.com). Anthropic hides subscription usage stats, so external tracking is essential.</div>
        </div>
      </section>

      <!-- Section 8: WHEN TO USE -->
      <section id="when" data-activity="when">
        <h2 class="section-title">
          <span class="section-number">8</span>
          When to Use / When Not
        </h2>

        <div class="when-grid">
          <div class="when-use">
            <div class="when-title">
              <i data-lucide="check" class="w-5 h-5"></i>
              USE SUBSCRIPTION WHEN
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Predictable daily usage (4+ hours)</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Don't need fine-grained model control</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Team pooled usage makes sense</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Want simplified billing</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Usage would exceed $100-200/month API</span>
            </div>
          </div>

          <div class="when-not">
            <div class="when-title">
              <i data-lucide="x" class="w-5 h-5"></i>
              USE API INSTEAD WHEN
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Variable/bursty usage patterns</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Need model selection per task</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Need Batch API (50% discount)</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Need transparent usage tracking</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Multi-agent orchestration (separate keys)</span>
            </div>
          </div>
        </div>

        <h3 class="font-semibold text-lg mb-4">Quick Reference: Daily Cost Expectations</h3>

        <table class="data-table">
          <thead>
            <tr>
              <th>User Type</th>
              <th>Daily Cost</th>
              <th>Monthly Cost</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Light user</td>
              <td>$1-$3</td>
              <td>$20-$60</td>
            </tr>
            <tr>
              <td>Moderate user</td>
              <td>$3-$6</td>
              <td>$60-$120</td>
            </tr>
            <tr>
              <td>Power user</td>
              <td>$6-$12</td>
              <td>$120-$250</td>
            </tr>
            <tr>
              <td>Heavy automation</td>
              <td>$12-$30+</td>
              <td>$250-$600+</td>
            </tr>
          </tbody>
        </table>

        <h3 class="font-semibold text-lg mb-4 mt-8">Emergency Cost Control</h3>

        <div class="code-block">
          <button class="copy-btn" onclick="copyCodeBlock(this)">
            <i data-lucide="copy" class="w-3 h-3"></i>
            Copy
          </button>
          <pre><span class="comment"># STOP: Kill all running Claude processes immediately</span>
pkill -f <span class="string">"claude"</span>
ps aux | grep claude  <span class="comment"># Verify none running</span>

<span class="comment"># ASSESS: Check what got spent (in a new Claude session)</span>
/cost

<span class="comment"># PREVENT: For Ralph loops, always use:</span>
<span class="variable">MAX_ITERATIONS</span>=<span class="number">10</span>  <span class="comment"># Never unlimited</span>

<span class="comment"># LIMIT: Set workspace limits in Claude Console</span>
<span class="comment"># console.anthropic.com -> Workspaces -> Spending Limits</span>

<span class="comment"># BUDGET: Set daily limits in CLAUDE.md:</span>
<span class="comment">## Cost Guardrails</span>
<span class="comment">- Maximum session cost: $5</span>
<span class="comment">- Check /cost every 30 minutes</span>
<span class="comment">- If >60% of daily budget, switch to Haiku</span></pre>
        </div>

        <div class="checkpoint-box">
          <div class="checkpoint-title">
            <i data-lucide="check-circle" class="w-4 h-4"></i>
            Optimization Checklist
          </div>
          <div class="checkpoint-item">Using appropriate model for task complexity</div>
          <div class="checkpoint-item">Leveraging prompt caching for repeated contexts</div>
          <div class="checkpoint-item">Resetting context before degradation</div>
          <div class="checkpoint-item">Batch processing non-urgent large jobs</div>
          <div class="checkpoint-item">Monitoring with <code>/cost</code> command</div>
          <div class="checkpoint-item">Tracking cache efficiency ratio (target 30:1+)</div>
        </div>
      </section>

    </main>

    <!-- Resizer between Main Panel and Activity Zone -->
    <div class="resizer" data-resizer="activity-zone" aria-label="Resize activity panel"></div>

    <!-- Activity Zone -->
    <aside class="activity-zone" id="activityZone">
      <div class="text-xs font-semibold text-text-muted uppercase tracking-wider mb-4">Operational Intelligence</div>

      <!-- ESSENCE SECTION -->
      <div class="activity-item inversion" data-section="essence">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if cost didn't matter?</div>
        <div class="text-text-secondary text-sm">
          <strong>You'd design:</strong> Use Opus for everything, never compact context, run unlimited iterations.<br>
          <strong>Why this fails:</strong> At $75/MTok output (Opus 4.1), a 50-iteration overnight loop could cost $500+.<br>
          <strong>Hidden constraint revealed:</strong> Cost forces efficiency, which often improves quality through constraint.
        </div>
      </div>

      <div class="activity-item minimal" data-section="essence">
        <div class="activity-label" style="color: #84cc16;">
          <i data-lucide="minimize-2" class="w-4 h-4"></i>
          Minimal Pattern
        </div>
        <div class="font-medium text-text-primary mb-2">The irreducible cost optimization</div>
        <div class="text-text-secondary text-sm">
          <strong>Essential:</strong> Match model to task complexity.<br>
          <strong>Essential:</strong> Enable prompt caching.<br>
          <strong>Everything else:</strong> Refinement for scale. If you do only these two, you've captured 70% of savings.
        </div>
      </div>

      <div class="activity-item warstory" data-section="essence">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">YC Hackathon: 6 repos, $297 total</div>
        <div class="text-text-secondary text-sm">
          Multiple teams ran overnight Ralph loops building 6 repositories. Total cost: $297. Average: ~$50/repo. Proof that autonomous development can be cost-effective when properly constrained.
        </div>
      </div>

      <!-- CORE SECTION -->
      <div class="activity-item gradient" data-section="core">
        <div class="activity-label" style="color: #f43f5e;">
          <i data-lucide="trending-down" class="w-4 h-4"></i>
          Failure Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">How cost optimization fails gradually</div>
        <div class="text-text-secondary text-sm">
          <strong>100% efficiency</strong>: Perfect model selection, warm cache<br>
          <strong>80% efficiency</strong>: Occasional Opus for simple tasks (you won't notice)<br>
          <strong>50% efficiency</strong>: Cold cache, no model switching<br>
          <strong>20% efficiency</strong>: Opus for everything, runaway loops<br>
          <strong>CLIFF</strong>: No limits, overnight surprises<br><br>
          <em>Critical: The gradient feels fine until the monthly bill arrives.</em>
        </div>
      </div>

      <div class="activity-item analogy" data-section="core">
        <div class="activity-label" style="color: #d946ef;">
          <i data-lucide="git-compare" class="w-4 h-4"></i>
          Analogical Bridge
        </div>
        <div class="font-medium text-text-primary mb-2">Token economics = Cloud compute</div>
        <div class="text-text-secondary text-sm">
          <strong>On-demand pricing</strong> = API pay-per-token<br>
          <strong>Reserved instances</strong> = Subscription plans<br>
          <strong>Spot instances</strong> = Batch API (50% discount)<br>
          <strong>Caching layers</strong> = Prompt caching<br>
          <strong>Right-sizing</strong> = Model selection<br><br>
          <em>If you've optimized AWS costs, you already know how to optimize Claude costs.</em>
        </div>
      </div>

      <div class="activity-item constraint" data-section="core">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="link-2" class="w-4 h-4"></i>
          Constraint Chain
        </div>
        <div class="font-medium text-text-primary mb-2">One constraint produces FIVE decisions</div>
        <div class="text-text-secondary text-sm">
          <strong>ROOT:</strong> Output tokens cost 5x input tokens<br>
          --> Prefer concise outputs over verbose explanations<br>
          --> Use structured formats (JSON) over prose<br>
          --> Request code, not explanations of code<br>
          --> Leverage caching for repeated input context<br>
          --> Batch similar tasks to amortize input costs
        </div>
      </div>

      <!-- DECISIONS SECTION -->
      <div class="activity-item tradeoff" data-section="decisions">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="scale" class="w-4 h-4"></i>
          Trade-Off Tension
        </div>
        <div class="font-medium text-text-primary mb-2">The Model Selection Dilemma</div>
        <div class="text-text-secondary text-sm">
          <strong>Haiku:</strong> 80% cheaper, but loses track in long sessions, forgets variable names<br>
          <strong>Sonnet:</strong> Balanced, but occasional hallucinations on edge cases<br>
          <strong>Opus:</strong> Best quality, but too slow/expensive for routine tasks<br><br>
          <strong>WHY NO PERFECT ANSWER:</strong> The "right" model depends on task, codebase, and risk tolerance.<br>
          <strong>HEURISTIC:</strong> If the mistake would cost more to fix than the model difference, use the better model.
        </div>
      </div>

      <div class="activity-item violation" data-section="decisions">
        <div class="activity-label" style="color: #f97316;">
          <i data-lucide="alert-octagon" class="w-4 h-4"></i>
          Violation Chain
        </div>
        <div class="font-medium text-text-primary mb-2">If you ignore caching</div>
        <div class="text-text-secondary text-sm">
          <strong>IF:</strong> You don't enable prompt caching<br>
          <strong>THEN:</strong> Every request pays full price for system prompt<br>
          <strong>THEN:</strong> 10K token context * 50 requests = 500K tokens * $3/MTok = $1.50 wasted<br>
          <strong>THEN:</strong> Per day, that's $1.50. Per month: $30-45<br>
          <strong>FINALLY:</strong> You've paid for a Max 5x subscription in wasted cache hits<br><br>
          <em>The fix: Structure prompts with static content first. Always.</em>
        </div>
      </div>

      <div class="activity-item expertise" data-section="decisions">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
          Expertise Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">Cost optimization understanding</div>
        <div class="text-text-secondary text-sm">
          <strong>Beginner:</strong> "How much does Claude cost?" --> $20-200/month typical<br>
          <strong>Intermediate:</strong> "How do I reduce costs?" --> Model selection + caching<br>
          <strong>Advanced:</strong> "What's my cost per feature?" --> Track /cost per session<br>
          <strong>Staff:</strong> "What's my team's ROI?" --> Cost per commit, cost per PR merged<br>
          <strong>Expert:</strong> "How do I optimize at scale?" --> Batch API, team rate limits, workspace budgets
        </div>
      </div>

      <!-- PRICING SECTION -->
      <div class="activity-item inflection" data-section="pricing">
        <div class="activity-label" style="color: #eab308;">
          <i data-lucide="activity" class="w-4 h-4"></i>
          Inflection Point
        </div>
        <div class="font-medium text-text-primary mb-2">When subscription beats API</div>
        <div class="text-text-secondary text-sm">
          <strong>$0-50/month API:</strong> Pro subscription overkill<br>
          <strong>$50-100/month API:</strong> Pro subscription is good value<br>
          <strong>$100-150/month API:</strong> Max 5x starts making sense<br>
          <strong>$150-200+/month API:</strong> Max 20x clearly wins<br><br>
          <strong>THE INFLECTION:</strong> ~$100/month API spend<br>
          <strong>DETECTION:</strong> Track API spend for 2 weeks, extrapolate to monthly
        </div>
      </div>

      <div class="activity-item horizon" data-section="pricing">
        <div class="activity-label" style="color: #06b6d4;">
          <i data-lucide="clock" class="w-4 h-4"></i>
          Time Horizon Shift
        </div>
        <div class="font-medium text-text-primary mb-2">How pricing perception changes</div>
        <div class="text-text-secondary text-sm">
          <strong>Day 1:</strong> "$6/day feels expensive for a tool"<br>
          <strong>Week 2:</strong> "Wait, I shipped 3x more code"<br>
          <strong>Month 2:</strong> "My effective hourly rate doubled"<br>
          <strong>Month 6:</strong> "I'd pay 10x this for the productivity"<br><br>
          <em>Don't judge Claude costs by tool pricing. Judge by productivity ROI.</em>
        </div>
      </div>

      <div class="activity-item effect" data-section="pricing">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="bar-chart-2" class="w-4 h-4"></i>
          Second-Order Effect
        </div>
        <div class="font-medium text-text-primary mb-2">Opus 4.5 price drop changes everything</div>
        <div class="text-text-secondary text-sm">
          <strong>OLD:</strong> Opus 4.1 at $15/$75 per MTok --> "Only for critical reviews"<br>
          <strong>NEW:</strong> Opus 4.5 at $5/$25 per MTok --> "Use for any complex task"<br><br>
          <strong>IMPLICATION:</strong> The "Haiku/Sonnet/Opus" ladder collapses. Opus 4.5 is now affordable for daily work. The new decision is "Haiku for trivial, Opus 4.5 for everything else."
        </div>
      </div>

      <div class="activity-item invariant" data-section="pricing">
        <div class="activity-label" style="color: #3b82f6;">
          <i data-lucide="link" class="w-4 h-4"></i>
          Invariant Connection
        </div>
        <div class="font-medium text-text-primary mb-2">Output costs 5x input across ALL models</div>
        <div class="text-text-secondary text-sm">
          This ratio is invariant across Haiku, Sonnet, and Opus. It's not a coincidence--it reflects the computational cost of generation vs. understanding.<br><br>
          <strong>Why this matters:</strong> Optimization strategies transfer across models. "Minimize output, maximize cache hits" works universally.
        </div>
      </div>

      <!-- PATTERNS SECTION -->
      <div class="activity-item warstory" data-section="patterns">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">Geoffrey Huntley: 3-month Ralph loop</div>
        <div class="text-text-secondary text-sm">
          Built a programming language using continuous Ralph loops over 3 months. Extensive token usage but ROI-positive--the alternative was hiring a compiler engineer at $200K+/year.
        </div>
      </div>

      <div class="activity-item composition" data-section="patterns">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="layers" class="w-4 h-4"></i>
          Composition Case
        </div>
        <div class="font-medium text-text-primary mb-2">Multi-agent + Batch API</div>
        <div class="text-text-secondary text-sm">
          <strong>WORKS?</strong> Yes, with careful design<br>
          <strong>WHY IT WORKS:</strong> Non-blocking workers can queue to Batch API for 50% savings<br>
          <strong>THE DANGER:</strong> 24-hour Batch turnaround breaks real-time coordination<br>
          <strong>RECOMMENDATION:</strong> Use Batch for background analysis, real-time for coordination
        </div>
      </div>

      <div class="activity-item inversion" data-section="patterns">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if Ralph didn't reset context?</div>
        <div class="text-text-secondary text-sm">
          <strong>You'd expect:</strong> Higher cost (accumulated context)<br>
          <strong>Reality:</strong> Context rot causes MORE cost (retries, failed iterations)<br>
          <strong>Hidden insight:</strong> Fresh context is cheaper because it succeeds more often. The "waste" of reloading state is recouped in reliability.
        </div>
      </div>

      <div class="activity-item constraint" data-section="patterns">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="link-2" class="w-4 h-4"></i>
          Constraint Chain
        </div>
        <div class="font-medium text-text-primary mb-2">Token limits force architecture</div>
        <div class="text-text-secondary text-sm">
          <strong>ROOT:</strong> 200K context window<br>
          --> Can't load entire codebase<br>
          --> Must select relevant files<br>
          --> Need file discovery tools<br>
          --> Grep/Glob become essential<br>
          --> Smart context loading = cost savings
        </div>
      </div>

      <!-- GOTCHAS SECTION -->
      <div class="activity-item violation" data-section="gotchas">
        <div class="activity-label" style="color: #f97316;">
          <i data-lucide="alert-octagon" class="w-4 h-4"></i>
          Violation Chain
        </div>
        <div class="font-medium text-text-primary mb-2">If you run Ralph without MAX_ITERATIONS</div>
        <div class="text-text-secondary text-sm">
          <strong>IF:</strong> No iteration limit on overnight loop<br>
          <strong>THEN:</strong> Loop runs until rate limited or budget exhausted<br>
          <strong>THEN:</strong> 100+ iterations on stuck task<br>
          <strong>THEN:</strong> $200+ surprise bill<br>
          <strong>FINALLY:</strong> Morning reveals no progress + empty budget<br><br>
          <em>The fix: MAX_ITERATIONS=10 is the floor. Never omit it.</em>
        </div>
      </div>

      <div class="activity-item gradient" data-section="gotchas">
        <div class="activity-label" style="color: #f43f5e;">
          <i data-lucide="trending-down" class="w-4 h-4"></i>
          Failure Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">How budget surprises compound</div>
        <div class="text-text-secondary text-sm">
          <strong>Week 1:</strong> $30 spent (expected)<br>
          <strong>Week 2:</strong> $45 spent ("huh, a bit more")<br>
          <strong>Week 3:</strong> $80 spent ("what happened?")<br>
          <strong>Week 4:</strong> $150 spent ("need to investigate")<br>
          <strong>Post-mortem:</strong> Playwright MCP was taking screenshots every action<br><br>
          <em>Critical: The gradient is subtle until you investigate.</em>
        </div>
      </div>

      <div class="activity-item frontier" data-section="gotchas">
        <div class="activity-label" style="color: #ef4444;">
          <i data-lucide="flask-conical" class="w-4 h-4"></i>
          Research Frontier
        </div>
        <div class="font-medium text-text-primary mb-2">UNSOLVED: Optimal budget allocation</div>
        <div class="text-text-secondary text-sm">
          <strong>THE QUESTION:</strong> How should you split budget between models? 50% Haiku / 40% Sonnet / 10% Opus? Or 0% / 80% / 20%?<br>
          <strong>WHY IT'S HARD:</strong> Varies by task type, codebase, team skill<br>
          <strong>CURRENT BEST PRACTICE:</strong> Track cost per task type for 2 weeks, then allocate based on actual patterns
        </div>
      </div>

      <!-- HARD SECTION -->
      <div class="activity-item tradeoff" data-section="hard">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="scale" class="w-4 h-4"></i>
          Trade-Off Tension
        </div>
        <div class="font-medium text-text-primary mb-2">The Productivity Paradox dilemma</div>
        <div class="text-text-secondary text-sm">
          <strong>Individual level:</strong> +98% PR throughput (clear win)<br>
          <strong>Team level:</strong> +91% review time (where did the gain go?)<br>
          <strong>Org level:</strong> Delivery velocity unchanged (wait, what?)<br><br>
          <strong>WHY NO PERFECT ANSWER:</strong> AI shifts the bottleneck, doesn't eliminate it.<br>
          <strong>HEURISTIC:</strong> Measure the whole pipeline, not just the AI-assisted step.
        </div>
      </div>

      <div class="activity-item horizon" data-section="hard">
        <div class="activity-label" style="color: #06b6d4;">
          <i data-lucide="clock" class="w-4 h-4"></i>
          Time Horizon Shift
        </div>
        <div class="font-medium text-text-primary mb-2">ROI perception over time</div>
        <div class="text-text-secondary text-sm">
          <strong>Week 2:</strong> "Productivity dropped, this isn't working"<br>
          <strong>Month 2:</strong> "Starting to see patterns form"<br>
          <strong>Month 4:</strong> "Can't imagine working without it"<br>
          <strong>Month 6:</strong> "ROI is clearly positive"<br><br>
          <em>Warning: Week 2 measurements produce misleading negative results.</em>
        </div>
      </div>

      <div class="activity-item effect" data-section="hard">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="bar-chart-2" class="w-4 h-4"></i>
          Second-Order Effect
        </div>
        <div class="font-medium text-text-primary mb-2">More code = more defects</div>
        <div class="text-text-secondary text-sm">
          <strong>OBSERVED:</strong> +98% PR throughput<br>
          <strong>ALSO OBSERVED:</strong> Higher defect rate in AI-generated code<br>
          <strong>IMPLICATION:</strong> Raw throughput gains are offset by quality issues<br>
          <strong>THRESHOLD:</strong> ~1.5x code requires ~2x review effort<br><br>
          <em>Track quality metrics alongside quantity metrics. Always.</em>
        </div>
      </div>

      <div class="activity-item analogy" data-section="hard">
        <div class="activity-label" style="color: #d946ef;">
          <i data-lucide="git-compare" class="w-4 h-4"></i>
          Analogical Bridge
        </div>
        <div class="font-medium text-text-primary mb-2">Hidden consumers = cloud egress</div>
        <div class="text-text-secondary text-sm">
          <strong>Cloud egress:</strong> Free to upload, expensive to download, often forgotten<br>
          <strong>Claude tools:</strong> Web Search ($10/1K), Computer Use (735 tokens + screenshots), forgotten in estimates<br><br>
          <em>If you've been surprised by AWS egress bills, you'll be surprised by tool token costs.</em>
        </div>
      </div>

      <!-- WHEN SECTION -->
      <div class="activity-item alternative" data-section="when">
        <div class="activity-label" style="color: #6b7280;">
          <i data-lucide="arrow-right" class="w-4 h-4"></i>
          Alternative Paths
        </div>
        <div class="font-medium text-text-primary mb-2">If subscription isn't right</div>
        <div class="text-text-secondary text-sm">
          <strong>Need transparent usage?</strong> --> API with LiteLLM tracking<br>
          <strong>Need per-agent keys?</strong> --> API with separate keys<br>
          <strong>Need batch processing?</strong> --> API Batch (50% discount)<br>
          <strong>Enterprise compliance?</strong> --> Bedrock/Vertex deployment
        </div>
      </div>

      <div class="activity-item expertise" data-section="when">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
          Expertise Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">Subscription decision understanding</div>
        <div class="text-text-secondary text-sm">
          <strong>Beginner:</strong> "Should I get Pro?" --> If you use it daily, yes<br>
          <strong>Intermediate:</strong> "Pro vs Max?" --> Track your 5-hour window usage<br>
          <strong>Advanced:</strong> "Team vs Max 20x?" --> Depends on usage patterns<br>
          <strong>Staff:</strong> "Hybrid approach?" --> Subscription + API for burst<br>
          <strong>Expert:</strong> "Enterprise custom?" --> When compliance/support matter
        </div>
      </div>

      <div class="activity-item invariant" data-section="when">
        <div class="activity-label" style="color: #3b82f6;">
          <i data-lucide="link" class="w-4 h-4"></i>
          Invariant Connection
        </div>
        <div class="font-medium text-text-primary mb-2">Cost optimization = Context management</div>
        <div class="text-text-secondary text-sm">
          INV-004: Context management strategies apply universally to cost optimization. Compact context = fewer tokens. Fewer tokens = lower cost. The same techniques that prevent context rot also minimize spend.
        </div>
      </div>

      <div class="activity-item composition" data-section="when">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="layers" class="w-4 h-4"></i>
          Composition Case
        </div>
        <div class="font-medium text-text-primary mb-2">Subscription + API hybrid</div>
        <div class="text-text-secondary text-sm">
          <strong>WORKS?</strong> Yes, optimal for variable usage<br>
          <strong>PATTERN:</strong> Max subscription for predictable daily work, API for burst automation<br>
          <strong>WHY IT WORKS:</strong> Subscription caps downside, API handles overflow<br>
          <strong>DANGER:</strong> Complexity in tracking two cost streams
        </div>
      </div>

      <div class="activity-item warstory" data-section="when">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">Molly Cantillon: Jmail, 18M users</div>
        <div class="text-text-secondary text-sm">
          Built Jmail (18M users) overnight using Ralph loops. Cost was high but ROI was immediate--the alternative was months of manual development. When velocity matters more than cost, constraints flip.
        </div>
      </div>

      <div class="activity-item inversion" data-section="when">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if you optimized for quality only?</div>
        <div class="text-text-secondary text-sm">
          <strong>You'd design:</strong> Opus for everything, extended think mode always, no cost monitoring<br>
          <strong>Why this might work:</strong> Higher quality = fewer retries = potentially lower total cost<br>
          <strong>Hidden insight:</strong> "Cheap" models that require 3 retries cost more than "expensive" models that succeed first try.
        </div>
      </div>

    </aside>
  </div>

  <script>
    /**
     * PanelResizer - Handles draggable panel dividers
     */
    class PanelResizer {
      constructor(resizerEl, config = {}) {
        this.resizer = resizerEl;
        this.config = {
          storageKey: 'panel-activity-zone-width',
          minWidth: 280,
          maxWidth: 900,
          defaultWidth: 480,
          ...config
        };

        this.isResizing = false;
        this.startX = 0;
        this.startWidth = 0;

        this.activityZone = document.querySelector('.activity-zone');
        this.mainContent = document.querySelector('.main-content');

        this.onMouseDown = this.onMouseDown.bind(this);
        this.onMouseMove = this.onMouseMove.bind(this);
        this.onMouseUp = this.onMouseUp.bind(this);

        this.init();
      }

      init() {
        this.restoreWidth();
        this.resizer.addEventListener('mousedown', this.onMouseDown);
      }

      onMouseDown(e) {
        if (e.button !== 0) return;

        this.isResizing = true;
        this.startX = e.clientX;
        this.startWidth = this.activityZone.offsetWidth;

        this.resizer.classList.add('active');
        document.body.classList.add('resizing');

        document.addEventListener('mousemove', this.onMouseMove);
        document.addEventListener('mouseup', this.onMouseUp);

        e.preventDefault();
      }

      onMouseMove(e) {
        if (!this.isResizing) return;

        const delta = this.startX - e.clientX;
        const newWidth = this.startWidth + delta;

        const constrainedWidth = Math.max(
          this.config.minWidth,
          Math.min(this.config.maxWidth, newWidth)
        );

        this.activityZone.style.width = constrainedWidth + 'px';
        this.mainContent.style.marginRight = constrainedWidth + 'px';
        this.resizer.style.right = constrainedWidth + 'px';
      }

      onMouseUp(e) {
        if (!this.isResizing) return;

        this.isResizing = false;

        this.resizer.classList.remove('active');
        document.body.classList.remove('resizing');

        document.removeEventListener('mousemove', this.onMouseMove);
        document.removeEventListener('mouseup', this.onMouseUp);

        this.saveWidth();
      }

      saveWidth() {
        const width = this.activityZone.offsetWidth;
        localStorage.setItem(this.config.storageKey, JSON.stringify({
          width,
          timestamp: Date.now()
        }));
      }

      restoreWidth() {
        try {
          const stored = localStorage.getItem(this.config.storageKey);
          if (stored) {
            const { width } = JSON.parse(stored);
            if (width >= this.config.minWidth && width <= this.config.maxWidth) {
              this.activityZone.style.width = width + 'px';
              this.mainContent.style.marginRight = width + 'px';
              this.resizer.style.right = width + 'px';
            }
          }
        } catch (e) {
          console.warn('Failed to restore panel width:', e);
        }
      }

      destroy() {
        this.resizer.removeEventListener('mousedown', this.onMouseDown);
        document.removeEventListener('mousemove', this.onMouseMove);
        document.removeEventListener('mouseup', this.onMouseUp);
      }
    }

    // Auto-initialize resizers on DOM ready
    document.addEventListener('DOMContentLoaded', () => {
      const resizers = document.querySelectorAll('[data-resizer]');
      resizers.forEach(resizer => new PanelResizer(resizer));
    });

    // Initialize Lucide icons
    lucide.createIcons();

    // Navigation toggle
    function toggleSection(header) {
      const section = header.closest('.nav-section');
      section.classList.toggle('expanded');
      const children = section.querySelector('.nav-children');
      children.classList.toggle('expanded');
    }

    // Mobile menu toggle
    function toggleMobileMenu() {
      const nav = document.getElementById('leftNav');
      nav.classList.toggle('open');
    }

    // Copy functionality
    function copyCode(btn, text) {
      navigator.clipboard.writeText(text).then(() => {
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i data-lucide="check" class="w-3 h-3"></i> Copied!';
        lucide.createIcons();
        setTimeout(() => {
          btn.innerHTML = originalText;
          lucide.createIcons();
        }, 2000);
      });
    }

    function copyCodeBlock(btn) {
      const codeBlock = btn.closest('.code-block');
      const pre = codeBlock.querySelector('pre');
      const text = pre.textContent;
      copyCode(btn, text);
    }

    // Scroll-sync with GSAP ScrollTrigger
    gsap.registerPlugin(ScrollTrigger);

    const sections = document.querySelectorAll('[data-activity]');
    const activityItems = document.querySelectorAll('.activity-item');

    sections.forEach(section => {
      ScrollTrigger.create({
        trigger: section,
        start: 'top 40%',
        end: 'bottom 40%',
        onEnter: () => activateSection(section.dataset.activity),
        onEnterBack: () => activateSection(section.dataset.activity),
      });
    });

    function activateSection(sectionName) {
      activityItems.forEach(item => {
        if (item.dataset.section === sectionName) {
          item.classList.add('active');
          gsap.to(item, {
            opacity: 1,
            y: -2,
            boxShadow: '0 4px 12px rgba(0,0,0,0.08)',
            duration: 0.3,
            ease: 'power2.out'
          });
        } else {
          item.classList.remove('active');
          gsap.to(item, {
            opacity: 0.5,
            y: 0,
            boxShadow: 'none',
            duration: 0.3,
            ease: 'power2.out'
          });
        }
      });

      document.querySelectorAll('.nav-section-header').forEach(header => {
        header.classList.remove('active');
      });
      const activeNav = document.querySelector(`[data-section="${sectionName}"] .nav-section-header`);
      if (activeNav) {
        activeNav.classList.add('active');
      }
    }

    // Initialize first section as active
    activateSection('essence');

    // Smooth scroll for nav links
    document.querySelectorAll('.nav-item').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const target = document.querySelector(link.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          document.querySelectorAll('.nav-item').forEach(l => l.classList.remove('active'));
          link.classList.add('active');
        }
      });
    });

    // Brushing interaction
    activityItems.forEach(item => {
      item.addEventListener('mouseenter', () => {
        const sectionName = item.dataset.section;
        const relatedSection = document.querySelector(`[data-activity="${sectionName}"]`);
        if (relatedSection) {
          relatedSection.style.backgroundColor = 'rgba(13, 147, 115, 0.05)';
          relatedSection.style.transition = 'background-color 0.3s ease';
        }
      });

      item.addEventListener('mouseleave', () => {
        const sectionName = item.dataset.section;
        const relatedSection = document.querySelector(`[data-activity="${sectionName}"]`);
        if (relatedSection) {
          relatedSection.style.backgroundColor = '';
        }
      });
    });
  </script>
</body>
</html>
