<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent Pattern Grammar | Claude Code Documentation</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Lucide Icons CDN -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- GSAP for scroll-sync -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

  <!-- Tailwind Config with Design Tokens -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'bg-base': '#ffffff',
            'bg-subtle': '#fafafa',
            'bg-muted': '#f4f4f5',
            'text-primary': '#18181b',
            'text-secondary': '#3f3f46',
            'text-muted': '#71717a',
            'accent': '#0D9373',
            'accent-light': '#10b981',
            'accent-bg': '#ecfdf5',
            'border': '#e4e4e7',
            // Activity Zone content type colors (Original 6)
            'az-invariant': '#3b82f6',    // Blue
            'az-effect': '#f59e0b',       // Amber
            'az-composition': '#8b5cf6',  // Purple
            'az-frontier': '#ef4444',     // Red
            'az-warstory': '#10b981',     // Green
            'az-alternative': '#6b7280',  // Gray
            // Activity Zone generative content types (New 10)
            'az-inversion': '#4f46e5',    // Indigo
            'az-constraint': '#8b5cf6',   // Violet
            'az-gradient': '#f43f5e',     // Rose
            'az-horizon': '#06b6d4',      // Cyan
            'az-violation': '#f97316',    // Orange
            'az-tradeoff': '#f59e0b',     // Amber
            'az-analogy': '#d946ef',      // Fuchsia
            'az-expertise': '#10b981',    // Emerald
            'az-minimal': '#84cc16',      // Lime
            'az-inflection': '#eab308',   // Yellow
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
            mono: ['Fira Code', 'monospace'],
          },
        },
      },
    }
  </script>

  <style>
    /* Base Styles */
    * {
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
      scroll-padding-top: 80px;
    }

    [id] {
      scroll-margin-top: 80px;
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: #ffffff;
      color: #18181b;
      line-height: 1.7;
    }

    /* Three Panel Layout */
    .three-panel-layout {
      min-height: 100vh;
      position: relative;
    }

    /* Header */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 56px;
      background: #ffffff;
      border-bottom: 1px solid #e4e4e7;
      z-index: 100;
      display: flex;
      align-items: center;
      padding: 0 24px;
    }

    /* Left Navigation - 240px fixed */
    .left-nav {
      position: fixed;
      top: 56px;
      left: 0;
      width: 240px;
      height: calc(100vh - 56px);
      border-right: 1px solid #e4e4e7;
      background: #ffffff;
      overflow-y: auto;
      padding: 16px 0;
      z-index: 40;
    }

    .nav-section {
      padding: 0 12px;
      margin-bottom: 8px;
    }

    .nav-section-header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      font-size: 14px;
      font-weight: 500;
      color: #3f3f46;
      cursor: pointer;
      border-radius: 6px;
      transition: background 0.15s;
    }

    .nav-section-header:hover {
      background: #f4f4f5;
    }

    .nav-section-header.active {
      color: #0D9373;
      background: #ecfdf5;
    }

    .nav-item {
      display: block;
      padding: 6px 12px 6px 44px;
      font-size: 14px;
      color: #71717a;
      text-decoration: none;
      border-radius: 6px;
      transition: all 0.15s;
    }

    .nav-item:hover {
      color: #3f3f46;
      background: #f4f4f5;
    }

    .nav-item.active {
      color: #0D9373;
      background: #ecfdf5;
    }

    .nav-children {
      display: none;
      overflow: hidden;
    }

    .nav-children.expanded {
      display: block;
    }

    .nav-chevron {
      transition: transform 0.2s;
    }

    .nav-section.expanded .nav-chevron {
      transform: rotate(90deg);
    }

    /* Main Content - Flexible, margins for fixed sidebars */
    .main-content {
      margin-left: 240px;
      margin-right: 480px;
      margin-top: 56px;
      padding: 48px 48px;
      min-width: 400px;
    }

    /* Activity Zone - 480px fixed */
    .activity-zone {
      position: fixed;
      top: 56px;
      right: 0;
      width: 480px;
      height: calc(100vh - 56px);
      border-left: 1px dashed #e4e4e7;
      background: #fafafa;
      overflow-y: auto;
      padding: 24px 20px;
      z-index: 40;
    }

    /* Responsive: Hide Activity Zone below 1400px */
    @media (max-width: 1400px) {
      .activity-zone {
        display: none;
      }
      .main-content {
        margin-right: 0;
        padding: 40px 32px;
      }
    }

    /* Responsive: Hide Left Nav below 768px */
    @media (max-width: 768px) {
      .left-nav {
        display: none;
      }
      .left-nav.open {
        display: block;
        position: fixed;
        top: 56px;
        left: 0;
        right: 0;
        bottom: 0;
        background: #ffffff;
        z-index: 50;
        overflow-y: auto;
      }
      .main-content {
        margin-left: 0;
        padding: 24px 16px;
        min-width: auto;
      }
    }

    /* Resizer */
    .resizer {
      position: fixed;
      top: 56px;
      right: 480px;
      width: 6px;
      height: calc(100vh - 56px);
      cursor: col-resize;
      background: transparent;
      z-index: 50;
      transition: background 0.15s ease;
    }

    .resizer:hover {
      background: rgba(13, 147, 115, 0.15);
    }

    .resizer.active {
      background: rgba(13, 147, 115, 0.25);
    }

    body.resizing {
      user-select: none;
      cursor: col-resize !important;
    }

    body.resizing * {
      cursor: col-resize !important;
    }

    @media (max-width: 1400px) {
      .resizer {
        display: none;
      }
    }

    /* Activity Zone Items */
    .activity-item {
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      background: #ffffff;
      border: 1px solid #e4e4e7;
      font-size: 14px;
      line-height: 1.6;
      opacity: 0.5;
      transition: all 0.3s ease;
    }

    .activity-item.active {
      opacity: 1;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .activity-item:hover {
      opacity: 1;
    }

    .activity-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    /* Activity Zone content type borders */
    .activity-item.invariant { border-left: 4px solid #3b82f6; }
    .activity-item.effect { border-left: 4px solid #f59e0b; }
    .activity-item.composition { border-left: 4px solid #8b5cf6; }
    .activity-item.frontier { border-left: 4px solid #ef4444; }
    .activity-item.warstory { border-left: 4px solid #10b981; }
    .activity-item.alternative { border-left: 4px solid #6b7280; }
    .activity-item.inversion { border-left: 4px solid #4f46e5; }
    .activity-item.constraint { border-left: 4px solid #8b5cf6; }
    .activity-item.gradient { border-left: 4px solid #f43f5e; }
    .activity-item.horizon { border-left: 4px solid #06b6d4; }
    .activity-item.violation { border-left: 4px solid #f97316; }
    .activity-item.tradeoff { border-left: 4px solid #f59e0b; }
    .activity-item.analogy { border-left: 4px solid #d946ef; }
    .activity-item.expertise { border-left: 4px solid #10b981; }
    .activity-item.minimal { border-left: 4px solid #84cc16; }
    .activity-item.inflection { border-left: 4px solid #eab308; }

    /* Main Content Components */

    /* Section titles with number */
    .section-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      background: #0D9373;
      color: #ffffff;
      font-size: 14px;
      font-weight: 600;
      border-radius: 50%;
      margin-right: 12px;
    }

    .section-title {
      font-size: 24px;
      font-weight: 600;
      color: #18181b;
      margin-bottom: 20px;
      margin-top: 56px;
      display: flex;
      align-items: center;
    }

    .section-title:first-child {
      margin-top: 0;
    }

    /* Essence Box (15 words) */
    .essence-box {
      background: linear-gradient(135deg, #18181b 0%, #27272a 100%);
      border-radius: 12px;
      padding: 32px;
      margin-bottom: 40px;
    }

    .essence-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #10b981;
      margin-bottom: 12px;
    }

    .essence-text {
      font-size: 22px;
      font-weight: 500;
      color: #ffffff;
      line-height: 1.4;
    }

    /* Index Card Grid */
    .index-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px;
      margin-bottom: 40px;
    }

    .index-card {
      background: #ffffff;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      transition: all 0.2s ease;
      text-decoration: none;
      display: block;
    }

    .index-card:hover {
      border-color: #0D9373;
      box-shadow: 0 4px 12px rgba(13, 147, 115, 0.1);
      transform: translateY(-2px);
    }

    .card-icon {
      width: 48px;
      height: 48px;
      background: #ecfdf5;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
    }

    .card-icon i {
      color: #0D9373;
    }

    .card-title {
      font-size: 18px;
      font-weight: 600;
      color: #18181b;
      margin-bottom: 8px;
    }

    .card-subtitle {
      font-size: 14px;
      color: #71717a;
      margin-bottom: 12px;
    }

    .card-description {
      font-size: 14px;
      color: #3f3f46;
      line-height: 1.6;
    }

    .card-meta {
      display: flex;
      gap: 12px;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid #e4e4e7;
    }

    .meta-item {
      font-size: 12px;
      color: #71717a;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    /* Overview Section */
    .overview-box {
      background: #fafafa;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 40px;
    }

    .overview-title {
      font-size: 16px;
      font-weight: 600;
      color: #18181b;
      margin-bottom: 16px;
    }

    .overview-diagram {
      background: #18181b;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
      overflow-x: auto;
    }

    .overview-diagram pre {
      margin: 0;
      font-family: 'Fira Code', monospace;
      font-size: 13px;
      color: #e4e4e7;
      line-height: 1.6;
    }

    /* Mobile Menu Button */
    .mobile-menu-btn {
      display: none;
      padding: 8px;
      background: none;
      border: none;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .mobile-menu-btn {
        display: flex;
      }
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: #fafafa;
    }

    ::-webkit-scrollbar-thumb {
      background: #d4d4d8;
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #a1a1aa;
    }

    /* Keyboard shortcut hint */
    .kbd {
      display: inline-flex;
      align-items: center;
      padding: 2px 6px;
      background: #f4f4f5;
      border: 1px solid #e4e4e7;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 12px;
      color: #71717a;
    }

    /* Reading Path */
    .reading-path {
      background: #ffffff;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 40px;
    }

    .path-title {
      font-size: 16px;
      font-weight: 600;
      color: #18181b;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .path-steps {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .path-step {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .path-step-number {
      width: 24px;
      height: 24px;
      background: #0D9373;
      color: #ffffff;
      font-size: 12px;
      font-weight: 600;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .path-step-content {
      font-size: 14px;
      color: #3f3f46;
    }

    .path-step-content a {
      color: #0D9373;
      text-decoration: none;
      font-weight: 500;
    }

    .path-step-content a:hover {
      text-decoration: underline;
    }

    .path-arrow {
      color: #d4d4d8;
      margin-left: 36px;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle menu">
      <i data-lucide="menu" class="w-5 h-5 text-text-secondary"></i>
    </button>
    <div class="flex items-center gap-3">
      <i data-lucide="terminal" class="w-5 h-5 text-accent"></i>
      <span class="font-semibold text-text-primary">Claude Code</span>
    </div>
    <div class="flex-1 flex justify-center">
      <button class="flex items-center gap-2 px-4 py-2 bg-bg-muted rounded-lg text-text-muted text-sm hover:bg-border transition-colors">
        <i data-lucide="search" class="w-4 h-4"></i>
        <span>Search documentation...</span>
        <span class="kbd">Cmd+K</span>
      </button>
    </div>
    <div class="flex items-center gap-4">
      <a href="#" class="text-sm text-text-muted hover:text-text-primary transition-colors">Support</a>
      <button class="p-2 hover:bg-bg-muted rounded-lg transition-colors" aria-label="Toggle theme">
        <i data-lucide="sun" class="w-4 h-4 text-text-muted"></i>
      </button>
    </div>
  </header>

  <div class="three-panel-layout">
    <!-- Left Navigation -->
    <nav class="left-nav" id="leftNav">
      <div class="px-4 mb-4">
        <span class="text-xs font-semibold text-text-muted uppercase tracking-wider">Pattern Grammar</span>
      </div>

      <!-- Overview -->
      <div class="nav-section expanded" data-section="overview">
        <div class="nav-section-header active" onclick="toggleSection(this)">
          <i data-lucide="book-open" class="w-4 h-4"></i>
          <span>Overview</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#essence" class="nav-item active">The Grammar</a>
          <a href="#reading-path" class="nav-item">Reading Path</a>
        </div>
      </div>

      <!-- Documents -->
      <div class="nav-section expanded" data-section="documents">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="files" class="w-4 h-4"></i>
          <span>Documents</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#vocabulary" class="nav-item">Vocabulary</a>
          <a href="#syntax" class="nav-item">Syntax Rules</a>
          <a href="#plugins" class="nav-item">Plugin Grammar</a>
        </div>
      </div>

      <!-- Related -->
      <div class="nav-section" data-section="related">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="link" class="w-4 h-4"></i>
          <span>Related</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="taxonomy-master.html" class="nav-item">Taxonomy Index</a>
          <a href="principles-master.html" class="nav-item">Principles Index</a>
          <a href="architecture-complexity-ladder.html" class="nav-item">Complexity Ladder</a>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">

      <!-- Section 1: ESSENCE -->
      <section id="essence" data-activity="essence">
        <div class="essence-box">
          <div class="essence-label">Agent Pattern Grammar</div>
          <div class="essence-text">A formal language for describing, composing, and extending Claude Code agent patterns.</div>
        </div>

        <p class="text-text-secondary mb-6">
          The Grammar section provides the formal language for working with Claude Code patterns. Like any language, it has vocabulary (primitive terms), syntax (composition rules), and extensibility (plugins). Master this grammar and you can read, write, and reason about any agent pattern.
        </p>
      </section>

      <!-- Section 2: OVERVIEW DIAGRAM -->
      <section id="overview" data-activity="overview">
        <h2 class="section-title">
          <span class="section-number">1</span>
          The Three Layers
        </h2>

        <div class="overview-box">
          <div class="overview-title">Grammar Structure</div>
          <div class="overview-diagram">
            <pre>
  VOCABULARY               SYNTAX                  PLUGINS
  (The Dictionary)         (The Rules)             (Extensions)
  ─────────────────────────────────────────────────────────────────

  Primitives:              Operators:              Types:
  ├── while-loop           ├── Sequential (→)      ├── Visualization
  ├── for-loop             ├── Parallel (||)       ├── Memory
  ├── fresh-context        ├── Nested (⊃)          ├── Workflow
  ├── orchestrator         └── Conditional (?)     ├── Integration
  ├── worker                                       └── Infrastructure
  └── quality-gate         Constraints:
                           ├── State isolation     Anatomy:
  Containers:              ├── Sync points         ├── manifest
  ├── prd.json             └── Ownership rules     ├── commands
  ├── progress.txt                                 ├── skills
  └── CLAUDE.md            Validation:             ├── hooks
                           ├── Type checking       └── agents
  Patterns:                ├── Deadlock detection
  ├── Ralph                └── Resource bounds
  ├── Gas Town
  └── CC Mirror</pre>
          </div>
          <p class="text-sm text-text-muted">
            Vocabulary defines what the words mean. Syntax defines how to combine them. Plugins extend both.
          </p>
        </div>
      </section>

      <!-- Section 3: READING PATH -->
      <section id="reading-path" data-activity="reading-path">
        <h2 class="section-title">
          <span class="section-number">2</span>
          Reading Path
        </h2>

        <div class="reading-path">
          <div class="path-title">
            <i data-lucide="route" class="w-5 h-5 text-accent"></i>
            Recommended Order
          </div>
          <div class="path-steps">
            <div class="path-step">
              <div class="path-step-number">1</div>
              <div class="path-step-content">
                <a href="grammar-vocabulary.html">Pattern Vocabulary</a> - Learn the primitive terms first
              </div>
            </div>
            <div class="path-arrow">
              <i data-lucide="arrow-down" class="w-4 h-4"></i>
            </div>
            <div class="path-step">
              <div class="path-step-number">2</div>
              <div class="path-step-content">
                <a href="grammar-syntax.html">Composition Rules</a> - Understand how primitives combine
              </div>
            </div>
            <div class="path-arrow">
              <i data-lucide="arrow-down" class="w-4 h-4"></i>
            </div>
            <div class="path-step">
              <div class="path-step-number">3</div>
              <div class="path-step-content">
                <a href="grammar-plugins.html">Plugin Grammar</a> - Learn how to extend the vocabulary
              </div>
            </div>
          </div>
        </div>

        <p class="text-text-secondary mb-6">
          Start with vocabulary to build your lexicon. Move to syntax to understand composition. Finish with plugins to see how the language extends.
        </p>
      </section>

      <!-- Section 4: DOCUMENT INDEX -->
      <section id="documents" data-activity="documents">
        <h2 class="section-title">
          <span class="section-number">3</span>
          Documents
        </h2>

        <div class="index-grid">
          <!-- Vocabulary Card -->
          <a href="grammar-vocabulary.html" class="index-card" id="vocabulary">
            <div class="card-icon">
              <i data-lucide="book" class="w-6 h-6"></i>
            </div>
            <div class="card-title">Pattern Vocabulary</div>
            <div class="card-subtitle">The Complete Lexicon of Agent Terms</div>
            <div class="card-description">
              Defines every primitive term in the agent pattern language. Loop constructs, state containers, quality gates, agent types, communication primitives, isolation mechanisms, and more. Start here when terminology is confusing.
            </div>
            <div class="card-meta">
              <div class="meta-item">
                <i data-lucide="layers" class="w-3 h-3"></i>
                14 categories
              </div>
              <div class="meta-item">
                <i data-lucide="hash" class="w-3 h-3"></i>
                50+ terms
              </div>
            </div>
          </a>

          <!-- Syntax Card -->
          <a href="grammar-syntax.html" class="index-card" id="syntax">
            <div class="card-icon">
              <i data-lucide="git-merge" class="w-6 h-6"></i>
            </div>
            <div class="card-title">Composition Rules</div>
            <div class="card-subtitle">How Primitives Combine into Valid Patterns</div>
            <div class="card-description">
              The formal grammar for composing agent patterns. Sequential, parallel, and nested operators. Constraint rules, validation patterns, and syntax error detection. Use this when designing multi-agent systems or debugging composition failures.
            </div>
            <div class="card-meta">
              <div class="meta-item">
                <i data-lucide="code" class="w-3 h-3"></i>
                4 operators
              </div>
              <div class="meta-item">
                <i data-lucide="shield" class="w-3 h-3"></i>
                Validation rules
              </div>
            </div>
          </a>

          <!-- Plugins Card -->
          <a href="grammar-plugins.html" class="index-card" id="plugins">
            <div class="card-icon">
              <i data-lucide="puzzle" class="w-6 h-6"></i>
            </div>
            <div class="card-title">Plugin Grammar</div>
            <div class="card-subtitle">Extending Claude Code's Vocabulary</div>
            <div class="card-description">
              How plugins extend the pattern language with new capabilities. Plugin types taxonomy, composition rules, extension points, and ecosystem map. Essential reading before building or evaluating plugins.
            </div>
            <div class="card-meta">
              <div class="meta-item">
                <i data-lucide="package" class="w-3 h-3"></i>
                5 plugin types
              </div>
              <div class="meta-item">
                <i data-lucide="plug" class="w-3 h-3"></i>
                Extension points
              </div>
            </div>
          </a>
        </div>
      </section>

      <!-- Section 5: USE CASES -->
      <section id="use-cases" data-activity="use-cases">
        <h2 class="section-title">
          <span class="section-number">4</span>
          When to Use This Section
        </h2>

        <div class="overview-box">
          <div class="overview-title">Common Scenarios</div>
          <div class="grid gap-4 mt-4">
            <div class="flex gap-3 items-start">
              <i data-lucide="help-circle" class="w-5 h-5 text-accent flex-shrink-0 mt-0.5"></i>
              <div>
                <div class="font-medium text-text-primary">Unfamiliar terminology</div>
                <div class="text-sm text-text-secondary">When you encounter terms like "fresh-context", "polecat", or "orchestrator" in other documents</div>
              </div>
            </div>
            <div class="flex gap-3 items-start">
              <i data-lucide="git-branch" class="w-5 h-5 text-accent flex-shrink-0 mt-0.5"></i>
              <div>
                <div class="font-medium text-text-primary">Designing multi-agent systems</div>
                <div class="text-sm text-text-secondary">When you need to know how to combine patterns correctly</div>
              </div>
            </div>
            <div class="flex gap-3 items-start">
              <i data-lucide="alert-triangle" class="w-5 h-5 text-accent flex-shrink-0 mt-0.5"></i>
              <div>
                <div class="font-medium text-text-primary">Debugging composition failures</div>
                <div class="text-sm text-text-secondary">When a pattern combination fails at runtime - check syntax rules first</div>
              </div>
            </div>
            <div class="flex gap-3 items-start">
              <i data-lucide="puzzle" class="w-5 h-5 text-accent flex-shrink-0 mt-0.5"></i>
              <div>
                <div class="font-medium text-text-primary">Evaluating or building plugins</div>
                <div class="text-sm text-text-secondary">When you need to understand how plugins extend capabilities</div>
              </div>
            </div>
          </div>
        </div>
      </section>

    </main>

    <!-- Resizer -->
    <div class="resizer" data-resizer="activity-zone" aria-label="Resize activity panel"></div>

    <!-- Activity Zone -->
    <aside class="activity-zone" id="activityZone">
      <div class="text-xs font-semibold text-text-muted uppercase tracking-wider mb-4">Operational Intelligence</div>

      <!-- ESSENCE SECTION -->
      <div class="activity-item analogy" data-section="essence">
        <div class="activity-label" style="color: #d946ef;">
          <i data-lucide="git-compare" class="w-4 h-4"></i>
          Analogical Bridge
        </div>
        <div class="font-medium text-text-primary mb-2">Grammar = Natural Language</div>
        <div class="text-text-secondary text-sm">
          <strong>Vocabulary</strong> = Dictionary (what words mean)<br>
          <strong>Syntax</strong> = Grammar rules (how to form sentences)<br>
          <strong>Plugins</strong> = New jargon (domain-specific terms)<br><br>
          <em>If you can learn a language, you can learn this grammar.</em>
        </div>
      </div>

      <div class="activity-item invariant" data-section="essence">
        <div class="activity-label" style="color: #3b82f6;">
          <i data-lucide="link" class="w-4 h-4"></i>
          Invariant Connection
        </div>
        <div class="font-medium text-text-primary mb-2">The Grammar DNA</div>
        <div class="text-text-secondary text-sm">
          Every pattern in the knowledge base uses this grammar. Ralph, Gas Town, CC Mirror - all expressible in vocabulary + syntax. Master the grammar, read any pattern.
        </div>
      </div>

      <!-- OVERVIEW SECTION -->
      <div class="activity-item constraint" data-section="overview">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="link-2" class="w-4 h-4"></i>
          Constraint Chain
        </div>
        <div class="font-medium text-text-primary mb-2">Why Three Layers?</div>
        <div class="text-text-secondary text-sm">
          <strong>ROOT:</strong> Patterns are complex compositions<br>
          → Need shared terminology (vocabulary)<br>
          → Need composition rules (syntax)<br>
          → Need extensibility (plugins)<br>
          → Three layers = complete language
        </div>
      </div>

      <div class="activity-item expertise" data-section="overview">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
          Expertise Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">Grammar Understanding</div>
        <div class="text-text-secondary text-sm">
          <strong>Beginner:</strong> "What's a fresh-context?" → Vocabulary<br>
          <strong>Intermediate:</strong> "Can I parallel these?" → Syntax<br>
          <strong>Advanced:</strong> "Which plugin adds memory?" → Plugins<br>
          <strong>Staff:</strong> "How do I extend this?" → All three
        </div>
      </div>

      <!-- READING PATH SECTION -->
      <div class="activity-item horizon" data-section="reading-path">
        <div class="activity-label" style="color: #06b6d4;">
          <i data-lucide="clock" class="w-4 h-4"></i>
          Time Horizon Shift
        </div>
        <div class="font-medium text-text-primary mb-2">Learning Investment</div>
        <div class="text-text-secondary text-sm">
          <strong>30 min:</strong> Skim vocabulary reference card<br>
          <strong>1 hour:</strong> Read vocabulary + syntax operators<br>
          <strong>2 hours:</strong> Full grammar mastery<br><br>
          <em>One-time investment, lifetime returns.</em>
        </div>
      </div>

      <div class="activity-item violation" data-section="reading-path">
        <div class="activity-label" style="color: #f97316;">
          <i data-lucide="alert-octagon" class="w-4 h-4"></i>
          Violation Chain
        </div>
        <div class="font-medium text-text-primary mb-2">If You Skip Vocabulary</div>
        <div class="text-text-secondary text-sm">
          <strong>IF:</strong> Jump straight to syntax<br>
          <strong>THEN:</strong> Operators reference unknown terms<br>
          <strong>THEN:</strong> Composition rules are opaque<br>
          <strong>FINALLY:</strong> Patterns remain mysterious<br><br>
          <em>Vocabulary first. Always.</em>
        </div>
      </div>

      <!-- DOCUMENTS SECTION -->
      <div class="activity-item minimal" data-section="documents">
        <div class="activity-label" style="color: #84cc16;">
          <i data-lucide="minimize-2" class="w-4 h-4"></i>
          Minimal Pattern
        </div>
        <div class="font-medium text-text-primary mb-2">The Core Three</div>
        <div class="text-text-secondary text-sm">
          <strong>Vocabulary:</strong> 50+ terms, 14 categories<br>
          <strong>Syntax:</strong> 4 operators, constraint rules<br>
          <strong>Plugins:</strong> 5 types, extension points<br><br>
          <em>Three documents cover the entire language.</em>
        </div>
      </div>

      <div class="activity-item alternative" data-section="documents">
        <div class="activity-label" style="color: #6b7280;">
          <i data-lucide="arrow-right" class="w-4 h-4"></i>
          Alternative Paths
        </div>
        <div class="font-medium text-text-primary mb-2">Related Resources</div>
        <div class="text-text-secondary text-sm">
          <strong>Taxonomy Index</strong> → Classification of patterns<br>
          <strong>Principles Index</strong> → Core rules and anti-patterns<br>
          <strong>Complexity Ladder</strong> → Level 0-7 progression<br>
          <strong>Master Playbook</strong> → Complete capability guide
        </div>
      </div>

      <!-- USE CASES SECTION -->
      <div class="activity-item inversion" data-section="use-cases">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">When NOT to Use Grammar</div>
        <div class="text-text-secondary text-sm">
          <strong>Specific implementation?</strong> → Pattern documents (Ralph, Gas Town)<br>
          <strong>Quick reference?</strong> → Vocabulary reference card only<br>
          <strong>Decision making?</strong> → Judgment Guide<br><br>
          <em>Grammar is for understanding language, not specific patterns.</em>
        </div>
      </div>

      <div class="activity-item warstory" data-section="use-cases">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">Debugging with Grammar</div>
        <div class="text-text-secondary text-sm">
          "Parallel Ralph workers kept stepping on each other's files. Checked syntax rules - missing worktree isolation. Grammar caught what debugging missed."
        </div>
      </div>

    </aside>
  </div>

  <script>
    /**
     * PanelResizer - Handles draggable panel dividers
     */
    class PanelResizer {
      constructor(resizerEl, config = {}) {
        this.resizer = resizerEl;
        this.config = {
          storageKey: 'panel-activity-zone-width',
          minWidth: 280,
          maxWidth: 900,
          defaultWidth: 480,
          ...config
        };

        this.isResizing = false;
        this.startX = 0;
        this.startWidth = 0;

        this.activityZone = document.querySelector('.activity-zone');
        this.mainContent = document.querySelector('.main-content');

        this.onMouseDown = this.onMouseDown.bind(this);
        this.onMouseMove = this.onMouseMove.bind(this);
        this.onMouseUp = this.onMouseUp.bind(this);

        this.init();
      }

      init() {
        this.restoreWidth();
        this.resizer.addEventListener('mousedown', this.onMouseDown);
      }

      onMouseDown(e) {
        if (e.button !== 0) return;

        this.isResizing = true;
        this.startX = e.clientX;
        this.startWidth = this.activityZone.offsetWidth;

        this.resizer.classList.add('active');
        document.body.classList.add('resizing');

        document.addEventListener('mousemove', this.onMouseMove);
        document.addEventListener('mouseup', this.onMouseUp);

        e.preventDefault();
      }

      onMouseMove(e) {
        if (!this.isResizing) return;

        const delta = this.startX - e.clientX;
        const newWidth = this.startWidth + delta;

        const constrainedWidth = Math.max(
          this.config.minWidth,
          Math.min(this.config.maxWidth, newWidth)
        );

        this.activityZone.style.width = constrainedWidth + 'px';
        this.mainContent.style.marginRight = constrainedWidth + 'px';
        this.resizer.style.right = constrainedWidth + 'px';
      }

      onMouseUp(e) {
        if (!this.isResizing) return;

        this.isResizing = false;

        this.resizer.classList.remove('active');
        document.body.classList.remove('resizing');

        document.removeEventListener('mousemove', this.onMouseMove);
        document.removeEventListener('mouseup', this.onMouseUp);

        this.saveWidth();
      }

      saveWidth() {
        const width = this.activityZone.offsetWidth;
        localStorage.setItem(this.config.storageKey, JSON.stringify({
          width,
          timestamp: Date.now()
        }));
      }

      restoreWidth() {
        try {
          const stored = localStorage.getItem(this.config.storageKey);
          if (stored) {
            const { width } = JSON.parse(stored);
            if (width >= this.config.minWidth && width <= this.config.maxWidth) {
              this.activityZone.style.width = width + 'px';
              this.mainContent.style.marginRight = width + 'px';
              this.resizer.style.right = width + 'px';
            }
          }
        } catch (e) {
          console.warn('Failed to restore panel width:', e);
        }
      }

      destroy() {
        this.resizer.removeEventListener('mousedown', this.onMouseDown);
        document.removeEventListener('mousemove', this.onMouseMove);
        document.removeEventListener('mouseup', this.onMouseUp);
      }
    }

    // Auto-initialize resizers on DOM ready
    document.addEventListener('DOMContentLoaded', () => {
      const resizers = document.querySelectorAll('[data-resizer]');
      resizers.forEach(resizer => new PanelResizer(resizer));
    });

    // Initialize Lucide icons
    lucide.createIcons();

    // Navigation toggle
    function toggleSection(header) {
      const section = header.closest('.nav-section');
      section.classList.toggle('expanded');
      const children = section.querySelector('.nav-children');
      children.classList.toggle('expanded');
    }

    // Mobile menu toggle
    function toggleMobileMenu() {
      const nav = document.getElementById('leftNav');
      nav.classList.toggle('open');
    }

    // Scroll-sync with GSAP ScrollTrigger
    gsap.registerPlugin(ScrollTrigger);

    const sections = document.querySelectorAll('[data-activity]');
    const activityItems = document.querySelectorAll('.activity-item');

    sections.forEach(section => {
      ScrollTrigger.create({
        trigger: section,
        start: 'top 40%',
        end: 'bottom 40%',
        onEnter: () => activateSection(section.dataset.activity),
        onEnterBack: () => activateSection(section.dataset.activity),
      });
    });

    function activateSection(sectionName) {
      activityItems.forEach(item => {
        if (item.dataset.section === sectionName) {
          item.classList.add('active');
          gsap.to(item, {
            opacity: 1,
            y: -2,
            boxShadow: '0 4px 12px rgba(0,0,0,0.08)',
            duration: 0.3,
            ease: 'power2.out'
          });
        } else {
          item.classList.remove('active');
          gsap.to(item, {
            opacity: 0.5,
            y: 0,
            boxShadow: 'none',
            duration: 0.3,
            ease: 'power2.out'
          });
        }
      });

      document.querySelectorAll('.nav-section-header').forEach(header => {
        header.classList.remove('active');
      });
      const activeNav = document.querySelector(`[data-section="${sectionName}"] .nav-section-header`);
      if (activeNav) {
        activeNav.classList.add('active');
      }
    }

    // Initialize first section as active
    activateSection('essence');

    // Smooth scroll for nav links
    document.querySelectorAll('.nav-item').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const target = document.querySelector(link.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          document.querySelectorAll('.nav-item').forEach(l => l.classList.remove('active'));
          link.classList.add('active');
        }
      });
    });

    // Brushing interaction
    activityItems.forEach(item => {
      item.addEventListener('mouseenter', () => {
        const sectionName = item.dataset.section;
        const relatedSection = document.querySelector(`[data-activity="${sectionName}"]`);
        if (relatedSection) {
          relatedSection.style.backgroundColor = 'rgba(13, 147, 115, 0.05)';
          relatedSection.style.transition = 'background-color 0.3s ease';
        }
      });

      item.addEventListener('mouseleave', () => {
        const sectionName = item.dataset.section;
        const relatedSection = document.querySelector(`[data-activity="${sectionName}"]`);
        if (relatedSection) {
          relatedSection.style.backgroundColor = '';
        }
      });
    });
  </script>
</body>
</html>
