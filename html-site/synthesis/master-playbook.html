<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Master Playbook | Claude Code Documentation</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Lucide Icons CDN -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- GSAP for scroll-sync -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

  <!-- Tailwind Config with Design Tokens -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'bg-base': '#ffffff',
            'bg-subtle': '#fafafa',
            'bg-muted': '#f4f4f5',
            'text-primary': '#18181b',
            'text-secondary': '#3f3f46',
            'text-muted': '#71717a',
            'accent': '#0D9373',
            'accent-light': '#10b981',
            'accent-bg': '#ecfdf5',
            'border': '#e4e4e7',
            // Activity Zone content type colors (Original 6)
            'az-invariant': '#3b82f6',    // Blue
            'az-effect': '#f59e0b',       // Amber
            'az-composition': '#8b5cf6',  // Purple
            'az-frontier': '#ef4444',     // Red
            'az-warstory': '#10b981',     // Green
            'az-alternative': '#6b7280',  // Gray
            // Activity Zone generative content types (New 10)
            'az-inversion': '#4f46e5',    // Indigo
            'az-constraint': '#8b5cf6',   // Violet
            'az-gradient': '#f43f5e',     // Rose
            'az-horizon': '#06b6d4',      // Cyan
            'az-violation': '#f97316',    // Orange
            'az-tradeoff': '#f59e0b',     // Amber
            'az-analogy': '#d946ef',      // Fuchsia
            'az-expertise': '#10b981',    // Emerald
            'az-minimal': '#84cc16',      // Lime
            'az-inflection': '#eab308',   // Yellow
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
            mono: ['Fira Code', 'monospace'],
          },
        },
      },
    }
  </script>

  <style>
    /* Base Styles */
    * {
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
      scroll-padding-top: 80px;
    }

    [id] {
      scroll-margin-top: 80px;
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: #ffffff;
      color: #18181b;
      line-height: 1.7;
    }

    /* Three Panel Layout */
    .three-panel-layout {
      min-height: 100vh;
      position: relative;
    }

    /* Header */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 56px;
      background: #ffffff;
      border-bottom: 1px solid #e4e4e7;
      z-index: 100;
      display: flex;
      align-items: center;
      padding: 0 24px;
    }

    /* Left Navigation - 240px fixed */
    .left-nav {
      position: fixed;
      top: 56px;
      left: 0;
      width: 240px;
      height: calc(100vh - 56px);
      border-right: 1px solid #e4e4e7;
      background: #ffffff;
      overflow-y: auto;
      padding: 16px 0;
      z-index: 40;
    }

    .nav-section {
      padding: 0 12px;
      margin-bottom: 8px;
    }

    .nav-section-header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      font-size: 14px;
      font-weight: 500;
      color: #3f3f46;
      cursor: pointer;
      border-radius: 6px;
      transition: background 0.15s;
    }

    .nav-section-header:hover {
      background: #f4f4f5;
    }

    .nav-section-header.active {
      color: #0D9373;
      background: #ecfdf5;
    }

    .nav-item {
      display: block;
      padding: 6px 12px 6px 44px;
      font-size: 14px;
      color: #71717a;
      text-decoration: none;
      border-radius: 6px;
      transition: all 0.15s;
    }

    .nav-item:hover {
      color: #3f3f46;
      background: #f4f4f5;
    }

    .nav-item.active {
      color: #0D9373;
      background: #ecfdf5;
    }

    .nav-children {
      display: none;
      overflow: hidden;
    }

    .nav-children.expanded {
      display: block;
    }

    .nav-chevron {
      transition: transform 0.2s;
    }

    .nav-section.expanded .nav-chevron {
      transform: rotate(90deg);
    }

    /* Main Content - Flexible, margins for fixed sidebars */
    .main-content {
      margin-left: 240px;
      margin-right: 480px;
      margin-top: 56px;
      padding: 48px 48px;
      min-width: 400px;
    }

    /* Activity Zone - 480px fixed */
    .activity-zone {
      position: fixed;
      top: 56px;
      right: 0;
      width: 480px;
      height: calc(100vh - 56px);
      border-left: 1px dashed #e4e4e7;
      background: #fafafa;
      overflow-y: auto;
      padding: 24px 20px;
      z-index: 40;
    }

    /* Responsive: Hide Activity Zone below 1400px */
    @media (max-width: 1400px) {
      .activity-zone {
        display: none;
      }
      .main-content {
        margin-right: 0;
        padding: 40px 32px;
      }
    }

    /* Responsive: Hide Left Nav below 768px */
    @media (max-width: 768px) {
      .left-nav {
        display: none;
      }
      .left-nav.open {
        display: block;
        position: fixed;
        top: 56px;
        left: 0;
        right: 0;
        bottom: 0;
        background: #ffffff;
        z-index: 50;
        overflow-y: auto;
      }
      .main-content {
        margin-left: 0;
        padding: 24px 16px;
        min-width: auto;
      }
    }

    /* Resizer - Draggable divider between Main Panel and Activity Zone */
    .resizer {
      position: fixed;
      top: 56px;
      right: 480px;
      width: 6px;
      height: calc(100vh - 56px);
      cursor: col-resize;
      background: transparent;
      z-index: 50;
      transition: background 0.15s ease;
    }

    .resizer:hover {
      background: rgba(13, 147, 115, 0.15);
    }

    .resizer.active {
      background: rgba(13, 147, 115, 0.25);
    }

    /* Prevent text selection during resize */
    body.resizing {
      user-select: none;
      cursor: col-resize !important;
    }

    body.resizing * {
      cursor: col-resize !important;
    }

    /* Hide resizer when Activity Zone is hidden (responsive) */
    @media (max-width: 1400px) {
      .resizer {
        display: none;
      }
    }

    /* Activity Zone Items */
    .activity-item {
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      background: #ffffff;
      border: 1px solid #e4e4e7;
      font-size: 14px;
      line-height: 1.6;
      opacity: 0.5;
      transition: all 0.3s ease;
    }

    .activity-item.active {
      opacity: 1;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .activity-item:hover {
      opacity: 1;
    }

    .activity-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    /* Activity Zone content type borders (Original 6) */
    .activity-item.invariant { border-left: 4px solid #3b82f6; }
    .activity-item.effect { border-left: 4px solid #f59e0b; }
    .activity-item.composition { border-left: 4px solid #8b5cf6; }
    .activity-item.frontier { border-left: 4px solid #ef4444; }
    .activity-item.warstory { border-left: 4px solid #10b981; }
    .activity-item.alternative { border-left: 4px solid #6b7280; }

    /* Activity Zone generative content types (New 10) */
    .activity-item.inversion { border-left: 4px solid #4f46e5; }
    .activity-item.constraint { border-left: 4px solid #8b5cf6; }
    .activity-item.gradient { border-left: 4px solid #f43f5e; }
    .activity-item.horizon { border-left: 4px solid #06b6d4; }
    .activity-item.violation { border-left: 4px solid #f97316; }
    .activity-item.tradeoff { border-left: 4px solid #f59e0b; }
    .activity-item.analogy { border-left: 4px solid #d946ef; }
    .activity-item.expertise { border-left: 4px solid #10b981; }
    .activity-item.minimal { border-left: 4px solid #84cc16; }
    .activity-item.inflection { border-left: 4px solid #eab308; }

    /* Main Content Components */

    /* Section titles with number */
    .section-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      background: #0D9373;
      color: #ffffff;
      font-size: 14px;
      font-weight: 600;
      border-radius: 50%;
      margin-right: 12px;
    }

    .section-title {
      font-size: 24px;
      font-weight: 600;
      color: #18181b;
      margin-bottom: 20px;
      margin-top: 56px;
      display: flex;
      align-items: center;
    }

    .section-title:first-child {
      margin-top: 0;
    }

    /* Essence Box (15 words) */
    .essence-box {
      background: linear-gradient(135deg, #18181b 0%, #27272a 100%);
      border-radius: 12px;
      padding: 32px;
      margin-bottom: 40px;
    }

    .essence-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #10b981;
      margin-bottom: 12px;
    }

    .essence-text {
      font-size: 22px;
      font-weight: 500;
      color: #ffffff;
      line-height: 1.4;
    }

    /* Core Abstraction Box */
    .core-abstraction {
      background: #fafafa;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 40px;
    }

    .core-philosophy {
      font-size: 16px;
      color: #3f3f46;
      margin-bottom: 16px;
      font-style: italic;
    }

    .core-code {
      background: #18181b;
      border-radius: 8px;
      padding: 16px 20px;
      margin-bottom: 16px;
      overflow-x: auto;
    }

    .core-code code {
      font-family: 'Fira Code', monospace;
      font-size: 15px;
      color: #10b981;
      white-space: nowrap;
    }

    .core-anchor {
      font-size: 14px;
      color: #71717a;
      text-align: center;
    }

    /* Decision Box */
    .decision-box {
      background: #ffffff;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
    }

    .decision-why {
      font-size: 16px;
      font-weight: 600;
      color: #0D9373;
      margin-bottom: 12px;
    }

    .decision-reasoning {
      font-size: 14px;
      color: #3f3f46;
      margin-bottom: 16px;
    }

    .decision-implication {
      background: #f4f4f5;
      border-radius: 8px;
      padding: 16px;
    }

    .decision-implication-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      color: #71717a;
      margin-bottom: 8px;
    }

    /* Code Blocks */
    .code-block {
      background: #18181b;
      border-radius: 8px;
      padding: 16px 20px;
      margin-bottom: 24px;
      position: relative;
      overflow-x: auto;
    }

    .code-block pre {
      margin: 0;
      font-family: 'Fira Code', monospace;
      font-size: 13px;
      color: #e4e4e7;
      line-height: 1.6;
    }

    .code-block .comment { color: #6b7280; }
    .code-block .keyword { color: #c084fc; }
    .code-block .string { color: #10b981; }
    .code-block .variable { color: #60a5fa; }

    .copy-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: #3f3f46;
      color: #ffffff;
      border: none;
      border-radius: 4px;
      padding: 6px 10px;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: background 0.15s;
    }

    .copy-btn:hover {
      background: #52525b;
    }

    /* Path Steps */
    .path-container {
      background: #fafafa;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 40px;
    }

    .path-step {
      display: flex;
      gap: 16px;
      margin-bottom: 16px;
    }

    .path-step:last-child {
      margin-bottom: 0;
    }

    .path-number {
      flex-shrink: 0;
      width: 24px;
      height: 24px;
      background: #0D9373;
      color: #ffffff;
      font-size: 12px;
      font-weight: 600;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .path-content {
      flex: 1;
      font-size: 14px;
      color: #3f3f46;
    }

    .path-content code {
      background: #e4e4e7;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 13px;
    }

    /* Gotcha Box */
    .gotcha-box {
      background: #fffbeb;
      border: 1px solid #fcd34d;
      border-left: 4px solid #f59e0b;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .gotcha-title {
      font-weight: 600;
      color: #92400e;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .gotcha-detail {
      font-size: 14px;
      color: #78350f;
      margin-bottom: 8px;
    }

    .gotcha-detail strong {
      color: #92400e;
    }

    /* What's Hard Box */
    .hard-box {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-left: 4px solid #ef4444;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .hard-title {
      font-weight: 600;
      color: #991b1b;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .hard-detail {
      font-size: 14px;
      color: #7f1d1d;
      margin-bottom: 8px;
    }

    /* When To Use Grid */
    .when-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 40px;
    }

    @media (max-width: 900px) {
      .when-grid {
        grid-template-columns: 1fr;
      }
    }

    .when-use {
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      border-radius: 12px;
      padding: 24px;
    }

    .when-not {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: 12px;
      padding: 24px;
    }

    .when-title {
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .when-use .when-title { color: #166534; }
    .when-not .when-title { color: #991b1b; }

    .when-item {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      font-size: 14px;
    }

    .when-use .when-item { color: #166534; }
    .when-not .when-item { color: #991b1b; }

    /* Mobile Menu Button */
    .mobile-menu-btn {
      display: none;
      padding: 8px;
      background: none;
      border: none;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .mobile-menu-btn {
        display: flex;
      }
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: #fafafa;
    }

    ::-webkit-scrollbar-thumb {
      background: #d4d4d8;
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #a1a1aa;
    }

    /* Keyboard shortcut hint */
    .kbd {
      display: inline-flex;
      align-items: center;
      padding: 2px 6px;
      background: #f4f4f5;
      border: 1px solid #e4e4e7;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 12px;
      color: #71717a;
    }

    /* Level Badge */
    .level-badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 12px;
      border-radius: 9999px;
      font-size: 12px;
      font-weight: 600;
      margin-right: 8px;
    }

    .level-badge.level-0 { background: #f4f4f5; color: #71717a; }
    .level-badge.level-1 { background: #ecfdf5; color: #059669; }
    .level-badge.level-2 { background: #dbeafe; color: #2563eb; }
    .level-badge.level-3 { background: #fef3c7; color: #d97706; }
    .level-badge.level-4 { background: #fee2e2; color: #dc2626; }
    .level-badge.level-5 { background: #ede9fe; color: #7c3aed; }
    .level-badge.level-6 { background: #fce7f3; color: #db2777; }
    .level-badge.level-7 { background: #18181b; color: #ffffff; }

    /* Progression Table */
    .progression-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 24px;
    }

    .progression-table th,
    .progression-table td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid #e4e4e7;
      font-size: 14px;
    }

    .progression-table th {
      background: #f4f4f5;
      font-weight: 600;
      color: #3f3f46;
    }

    .progression-table tr:hover {
      background: #fafafa;
    }

    /* Principle Box */
    .principle-box {
      background: #ffffff;
      border: 1px solid #e4e4e7;
      border-left: 4px solid #0D9373;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .principle-number {
      font-size: 12px;
      font-weight: 600;
      color: #0D9373;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }

    .principle-title {
      font-size: 16px;
      font-weight: 600;
      color: #18181b;
      margin-bottom: 12px;
    }

    .principle-content {
      font-size: 14px;
      color: #3f3f46;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle menu">
      <i data-lucide="menu" class="w-5 h-5 text-text-secondary"></i>
    </button>
    <div class="flex items-center gap-3">
      <i data-lucide="terminal" class="w-5 h-5 text-accent"></i>
      <span class="font-semibold text-text-primary">Claude Code</span>
    </div>
    <div class="flex-1 flex justify-center">
      <button class="flex items-center gap-2 px-4 py-2 bg-bg-muted rounded-lg text-text-muted text-sm hover:bg-border transition-colors">
        <i data-lucide="search" class="w-4 h-4"></i>
        <span>Search documentation...</span>
        <span class="kbd">Cmd+K</span>
      </button>
    </div>
    <div class="flex items-center gap-4">
      <a href="#" class="text-sm text-text-muted hover:text-text-primary transition-colors">Support</a>
      <button class="p-2 hover:bg-bg-muted rounded-lg transition-colors" aria-label="Toggle theme">
        <i data-lucide="sun" class="w-4 h-4 text-text-muted"></i>
      </button>
    </div>
  </header>

  <div class="three-panel-layout">
    <!-- Left Navigation -->
    <nav class="left-nav" id="leftNav">
      <div class="px-4 mb-4">
        <span class="text-xs font-semibold text-text-muted uppercase tracking-wider">Master Playbook</span>
      </div>

      <!-- Essence -->
      <div class="nav-section expanded" data-section="essence">
        <div class="nav-section-header active" onclick="toggleSection(this)">
          <i data-lucide="zap" class="w-4 h-4"></i>
          <span>Essence</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#essence" class="nav-item active">The 15-Word Summary</a>
        </div>
      </div>

      <!-- Core Abstraction -->
      <div class="nav-section expanded" data-section="core">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="box" class="w-4 h-4"></i>
          <span>Core Abstraction</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#core-abstraction" class="nav-item">The 8 Core Principles</a>
        </div>
      </div>

      <!-- Design Decisions -->
      <div class="nav-section expanded" data-section="decisions">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="lightbulb" class="w-4 h-4"></i>
          <span>Design Decisions</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#why-progression" class="nav-item">Why Levels?</a>
          <a href="#why-principles" class="nav-item">Why Principles First?</a>
          <a href="#why-transformations" class="nav-item">Why Before/After?</a>
        </div>
      </div>

      <!-- File Structure -->
      <div class="nav-section" data-section="files">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="folder" class="w-4 h-4"></i>
          <span>Capability Levels</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#level-0" class="nav-item">Level 0: Single Session</a>
          <a href="#level-3" class="nav-item">Level 3: Ralph Loop</a>
          <a href="#level-5" class="nav-item">Level 5: CC Mirror</a>
          <a href="#level-7" class="nav-item">Level 7: Gas Town</a>
        </div>
      </div>

      <!-- Path of a Task -->
      <div class="nav-section" data-section="path">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="git-branch" class="w-4 h-4"></i>
          <span>Progression Path</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#path" class="nav-item">Level by Level</a>
        </div>
      </div>

      <!-- Gotchas -->
      <div class="nav-section" data-section="gotchas">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="alert-triangle" class="w-4 h-4"></i>
          <span>Gotchas</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#gotchas" class="nav-item">Common Mistakes</a>
        </div>
      </div>

      <!-- What's Hard -->
      <div class="nav-section" data-section="hard">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="flame" class="w-4 h-4"></i>
          <span>What's Hard</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#hard" class="nav-item">Fundamental Tensions</a>
        </div>
      </div>

      <!-- When to Use -->
      <div class="nav-section" data-section="when">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="check-circle" class="w-4 h-4"></i>
          <span>Pattern Selection</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#when" class="nav-item">Decision Trees</a>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">

      <!-- Section 1: ESSENCE -->
      <section id="essence" data-activity="essence">
        <div class="essence-box">
          <div class="essence-label">Essence (15 words)</div>
          <div class="essence-text">The complete progression from single sessions to factory-scale autonomous development, with judgment for each level.</div>
        </div>

        <p class="text-text-secondary mb-6">
          This is the master entry point for learning Claude Code orchestration. If you're overwhelmed by options, context problems, or don't know which pattern to use - start here. This playbook provides the complete progression from Level 0 (single sessions) to Level 7 (factory-scale autonomous development), with clear milestones and judgment criteria at each stage.
        </p>
      </section>

      <!-- Section 2: CORE ABSTRACTION + IMPLEMENTATION -->
      <section id="core-abstraction" data-activity="core">
        <h2 class="section-title">
          <span class="section-number">2</span>
          The Core Abstraction
        </h2>

        <div class="core-abstraction">
          <div class="core-philosophy">"Everything builds on 8 principles. Understand them, and you can derive any pattern."</div>

          <div class="core-code">
            <button class="copy-btn" onclick="copyCode(this, 'Context is finite. External state persists. Fresh beats extended. Orchestrators coordinate, workers execute.')">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <code>Context is finite. External state persists. Fresh beats extended. Orchestrators coordinate, workers execute.</code>
          </div>

          <div class="core-anchor">These 4 constraints generate all 8 principles and every pattern in this playbook.</div>
        </div>

        <h3 class="font-semibold text-lg mb-4">The 8 Core Principles</h3>

        <div class="principle-box">
          <div class="principle-number">Principle 1</div>
          <div class="principle-title">Context Is The Primary Constraint</div>
          <div class="principle-content">
            Claude's context window is finite (~200K tokens). Quality degrades as context fills (observable at 60-70%). Long sessions accumulate noise, contradictions, and cruft. Token costs scale linearly with context size. <strong>Every pattern in this playbook ultimately optimizes around context limits.</strong>
          </div>
        </div>

        <div class="principle-box">
          <div class="principle-number">Principle 2</div>
          <div class="principle-title">External State > Internal Memory</div>
          <div class="principle-content">
            Claude's "memory" lives only in the context window. When the session ends, everything is lost. <strong>Store state in files (prd.json, progress.txt), in git (commits as memory), and in external tools.</strong> External state survives session death and doesn't consume context tokens.
          </div>
        </div>

        <div class="principle-box">
          <div class="principle-number">Principle 3</div>
          <div class="principle-title">Fresh Context > Extended Sessions</div>
          <div class="principle-content">
            Long sessions degrade in quality. Context becomes polluted with false starts, corrections, tangents. There's no mechanism to "forget" irrelevant information. <strong>Quality of 20 five-minute sessions > Quality of one 100-minute session.</strong>
          </div>
        </div>

        <div class="principle-box">
          <div class="principle-number">Principle 4</div>
          <div class="principle-title">Orchestrator/Worker Separation (The Iron Law)</div>
          <div class="principle-content">
            <strong>Orchestrators coordinate. Workers execute. Never mix.</strong> Orchestrators create and assign tasks, monitor progress, make decisions - but NEVER write code. Workers receive specific tasks, execute them, and report results - but NEVER spawn other workers. This prevents infinite recursion and keeps orchestrator context lean.
          </div>
        </div>

        <div class="principle-box">
          <div class="principle-number">Principle 5</div>
          <div class="principle-title">Atomic, Verifiable Tasks</div>
          <div class="principle-content">
            "Build the auth system" is too big. "Make it work better" can't be verified. <strong>Break into smallest testable units. Each task fits in one context window. Each has explicit acceptance criteria.</strong> Verification is automated (typecheck, test, screenshot).
          </div>
        </div>

        <div class="principle-box">
          <div class="principle-number">Principle 6</div>
          <div class="principle-title">Quality Gates Before Commit</div>
          <div class="principle-content">
            Never mark work as "done" without verification. Broken code compounds (one bug becomes many). Early failures save rework. <strong>Always: npm run typecheck && npm run test && npm run lint && git commit</strong>
          </div>
        </div>

        <div class="principle-box">
          <div class="principle-number">Principle 7</div>
          <div class="principle-title">Isolation For Parallel Work</div>
          <div class="principle-content">
            Multiple agents editing the same files = merge conflicts. Shared state = race conditions. <strong>Use git worktrees for file isolation, separate branches per feature, domain-specific Claude instances.</strong>
          </div>
        </div>

        <div class="principle-box">
          <div class="principle-number">Principle 8</div>
          <div class="principle-title">Explicit Communication Channels</div>
          <div class="principle-content">
            Agents can't read minds. Assumptions lead to wrong work. <strong>Use progress files agents can read, structured task definitions (JSON), clear acceptance criteria, and hooks for notifications.</strong>
          </div>
        </div>
      </section>

      <!-- Section 3: DESIGN DECISIONS -->
      <section id="why-progression" data-activity="decisions">
        <h2 class="section-title">
          <span class="section-number">3</span>
          Design Decisions
        </h2>

        <div class="decision-box">
          <div class="decision-why">WHY LEVELS (0-7)?</div>
          <div class="decision-reasoning">
            Capability progression isn't smooth - it's stepped. Each level requires mastering the previous one's patterns before the next becomes useful. Jumping levels leads to failure because you don't have the mental models. Level 5 patterns fail if you haven't internalized Level 3 context discipline.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Identify your current level. Focus on the level JUST above where you are. Don't skip levels. If Level 5 fails, go back to Level 3 and verify you've truly mastered it.
            </div>
          </div>
        </div>

        <div class="decision-box" id="why-principles">
          <div class="decision-why">WHY PRINCIPLES FIRST?</div>
          <div class="decision-reasoning">
            Patterns are implementations of principles. If you memorize patterns without understanding principles, you can't adapt when your constraints differ. Understanding "why fresh context" lets you derive Ralph yourself. Understanding "why orchestrator separation" lets you design any multi-agent system.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Read Part 1 (Foundations) before jumping to specific patterns. When a pattern doesn't work, trace back to which principle you're violating. Principles are stable; patterns evolve.
            </div>
          </div>
        </div>

        <div class="decision-box" id="why-transformations">
          <div class="decision-why">WHY BEFORE/AFTER TRANSFORMATIONS?</div>
          <div class="decision-reasoning">
            Reading about patterns is abstract. Seeing the same task done both ways makes the value concrete. You need to feel the pain of the "before" to appreciate the "after." Without that contrast, you might think the pattern is unnecessary complexity.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Part 4 shows transformations for each major pattern. Read these when you're skeptical. Try the "before" approach first if needed - you'll understand why the pattern exists when it fails.
            </div>
          </div>
        </div>
      </section>

      <!-- Section 4: FILE STRUCTURE / CAPABILITY LEVELS -->
      <section id="level-0" data-activity="files">
        <h2 class="section-title">
          <span class="section-number">4</span>
          Capability Levels
        </h2>

        <h3 class="font-semibold text-lg mb-4 flex items-center">
          <span class="level-badge level-0">L0</span>
          Single Session (Where Most Start)
        </h3>

        <p class="text-text-secondary mb-4">
          All work happens in one continuous conversation. Manual approval for every operation. Context degrades after 60% fill. 90 minutes leads to session death or burnout.
        </p>

        <div class="code-block">
          <pre><span class="comment"># Level 0: The pain you know</span>
11:00 PM - Start session, explain project
11:15 PM - Ask for login form, approve changes
11:30 PM - Ask for validation, approve
11:45 PM - Context at 55%, Claude getting confused
12:00 AM - Claude repeats earlier mistakes
12:15 AM - Context at 75%, quality noticeably worse
12:30 AM - Give up, feature incomplete</pre>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8 flex items-center" id="level-3">
          <span class="level-badge level-3">L3</span>
          Ralph Loop (Autonomy Begins)
        </h3>

        <p class="text-text-secondary mb-4">
          Fresh context per iteration. External state (prd.json, progress.txt). You write the PRD, then sleep. Wake up to completed feature.
        </p>

        <div class="code-block">
          <button class="copy-btn" onclick="copyCodeBlock(this)">
            <i data-lucide="copy" class="w-3 h-3"></i>
            Copy
          </button>
          <pre><span class="comment">#!/bin/bash - ralph.sh</span>
<span class="variable">MAX_ITERATIONS</span>=<span class="variable">${1:-25}</span>

<span class="keyword">for</span> i <span class="keyword">in</span> $(seq 1 $MAX_ITERATIONS); <span class="keyword">do</span>
  <span class="keyword">echo</span> <span class="string">"=== Iteration $i ==="</span>
  OUTPUT=$(cat prompt.md | claude --dangerously-skip-permissions 2>&1)

  <span class="keyword">if</span> <span class="keyword">echo</span> "$OUTPUT" | grep -q <span class="string">"&lt;promise&gt;COMPLETE&lt;/promise&gt;"</span>; <span class="keyword">then</span>
    <span class="keyword">exit</span> 0
  <span class="keyword">fi</span>
  sleep 2
<span class="keyword">done</span></pre>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8 flex items-center" id="level-5">
          <span class="level-badge level-5">L5</span>
          CC Mirror (Multi-Agent)
        </h3>

        <p class="text-text-secondary mb-4">
          Hub-and-spoke orchestration. Opus orchestrator coordinates Sonnet/Haiku workers. Parallel execution. Model tiering for cost optimization.
        </p>

        <div class="code-block">
          <pre><span class="comment"># Orchestrator creates tasks, never writes code</span>
TaskCreate(
  subject: <span class="string">"Implement user registration"</span>,
  description: <span class="string">"Create POST /api/auth/register"</span>,
  acceptanceCriteria: [<span class="string">"Validates email"</span>, <span class="string">"Hashes password"</span>],
  model: <span class="string">"Sonnet"</span>
)

<span class="comment"># Workers execute, report back, never spawn</span></pre>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8 flex items-center" id="level-7">
          <span class="level-badge level-7">L7</span>
          Gas Town (Factory Scale)
        </h3>

        <p class="text-text-secondary mb-4">
          Persistent workers with memory. Self-improving systems. Automatic decomposition. Team equivalent: 3-5 mid-level developers. Prerequisites: 100+ hours multi-agent experience, $50-200/day budget tolerance.
        </p>

        <div class="code-block">
          <pre><span class="comment"># Gas Town Architecture</span>
Gas Town Factory
├─ HQ (Management)
│  ├─ Mayor (coordination)
│  ├─ Deacon (monitoring)
│  └─ Dogs (quality gates)
├─ Refinery (auto-decomposition)
└─ Rigs (projects)
   ├─ Witness (observer)
   ├─ Polecats (persistent workers)
   └─ Crew (ephemeral workers)</pre>
        </div>
      </section>

      <!-- Section 5: PATH OF A TASK / PROGRESSION -->
      <section id="path" data-activity="path">
        <h2 class="section-title">
          <span class="section-number">5</span>
          The Progression Path
        </h2>

        <p class="text-text-secondary mb-6">
          Your journey through capability levels, with time investment and expected outcomes:
        </p>

        <table class="progression-table">
          <thead>
            <tr>
              <th>Level</th>
              <th>Pattern</th>
              <th>Human Time</th>
              <th>Token Efficiency</th>
              <th>Time to Master</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><span class="level-badge level-0">L0</span></td>
              <td>Single Session</td>
              <td>90 min</td>
              <td>Low</td>
              <td>Day 1</td>
            </tr>
            <tr>
              <td><span class="level-badge level-1">L1</span></td>
              <td>CLAUDE.md + Commands</td>
              <td>60 min</td>
              <td>+20%</td>
              <td>Week 1</td>
            </tr>
            <tr>
              <td><span class="level-badge level-2">L2</span></td>
              <td>Subagents + Hooks</td>
              <td>45 min</td>
              <td>+30%</td>
              <td>Week 2</td>
            </tr>
            <tr>
              <td><span class="level-badge level-3">L3</span></td>
              <td>Ralph Loop</td>
              <td>10 min</td>
              <td>+50%</td>
              <td>Week 3-4</td>
            </tr>
            <tr>
              <td><span class="level-badge level-4">L4</span></td>
              <td>PRD-driven Reliability</td>
              <td>20 min</td>
              <td>+60%</td>
              <td>Month 1</td>
            </tr>
            <tr>
              <td><span class="level-badge level-5">L5</span></td>
              <td>CC Mirror</td>
              <td>30 min</td>
              <td>+40%</td>
              <td>Month 2</td>
            </tr>
            <tr>
              <td><span class="level-badge level-6">L6</span></td>
              <td>Parallel Worktrees</td>
              <td>15 min</td>
              <td>+70%</td>
              <td>Month 3</td>
            </tr>
            <tr>
              <td><span class="level-badge level-7">L7</span></td>
              <td>Gas Town Factory</td>
              <td>Minimal</td>
              <td>Variable</td>
              <td>Month 6+</td>
            </tr>
          </tbody>
        </table>

        <div class="path-container">
          <div class="path-step">
            <div class="path-number">1</div>
            <div class="path-content"><strong>Level 0 → 1:</strong> Create CLAUDE.md in project root. Add 3-5 slash commands. Break-even: 3-4 sessions. Investment: 30-45 minutes.</div>
          </div>
          <div class="path-step">
            <div class="path-number">2</div>
            <div class="path-content"><strong>Level 1 → 2:</strong> Create specialized subagents (security-reviewer, test-writer). Add formatting hooks. Investment: 2-4 hours.</div>
          </div>
          <div class="path-step">
            <div class="path-number">3</div>
            <div class="path-content"><strong>Level 2 → 3:</strong> Set up Ralph loop with prd.json and progress.txt. First overnight run. Investment: 1-2 hours setup + 15-20 min per feature PRD.</div>
          </div>
          <div class="path-step">
            <div class="path-number">4</div>
            <div class="path-content"><strong>Level 3 → 4:</strong> Add explicit acceptance criteria. Implement learning accumulation. Success rate: 60% → 95%.</div>
          </div>
          <div class="path-step">
            <div class="path-number">5</div>
            <div class="path-content"><strong>Level 4 → 5:</strong> Add CC Mirror orchestration. Implement model tiering (Opus orchestrator, Sonnet/Haiku workers). Parallel task execution.</div>
          </div>
          <div class="path-step">
            <div class="path-number">6</div>
            <div class="path-content"><strong>Level 5 → 6:</strong> Add git worktrees for true isolation. Run parallel Ralph loops. 3 features simultaneously = 1 hour instead of 3.</div>
          </div>
          <div class="path-step">
            <div class="path-number">7</div>
            <div class="path-content"><strong>Level 6 → 7:</strong> Implement Gas Town factory. Persistent workers. Automatic decomposition. Prerequisites: 100+ hours multi-agent experience.</div>
          </div>
        </div>
      </section>

      <!-- Section 6: GOTCHAS -->
      <section id="gotchas" data-activity="gotchas">
        <h2 class="section-title">
          <span class="section-number">6</span>
          Gotchas
        </h2>

        <p class="text-text-secondary mb-6">
          Common mistakes at each level, with concrete signals and fixes:
        </p>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Skipping Levels
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Level 5 patterns fail unexpectedly. Multi-agent chaos.</div>
          <div class="gotcha-detail"><strong>Why:</strong> You haven't internalized Level 3 context discipline. Workers inherit bad habits.</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Go back to Level 3. Run 10 successful Ralph iterations. Verify progress.txt hygiene. Then retry Level 5.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Orchestrators That Write Code
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Orchestrator context fills with implementation details. Loses coordination ability.</div>
          <div class="gotcha-detail"><strong>Why:</strong> Violated the Iron Law. Orchestrators must NEVER execute, only coordinate.</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Strict tool restriction. Orchestrator gets only TaskCreate/TaskUpdate/TaskGet + Read (1-2 files max). No Write, Edit, or Bash.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Workers Spawning Workers
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Infinite recursion. Costs spiral. Control lost.</div>
          <div class="gotcha-detail"><strong>Why:</strong> Violated the Iron Law from the worker side. Workers must NEVER spawn.</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Workers report back to orchestrator. Only orchestrator spawns. Add explicit "You must NOT spawn subagents" to worker prompts.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            $47,000 Problem (Runaway Costs)
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Agent keeps running, costs escalating, no completion in sight.</div>
          <div class="gotcha-detail"><strong>Why:</strong> Missing iteration limits, recursive loops, or missing stop conditions.</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Always set MAX_ITERATIONS. Add cost monitoring hooks. Set up ntfy/push notifications for long runs. Add cost cap check to ralph.sh.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Pattern-Shopping Without Principles
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Trying different patterns randomly. Nothing works consistently.</div>
          <div class="gotcha-detail"><strong>Why:</strong> Patterns without principles are recipes without understanding. Can't adapt.</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Return to Part 1. Understand WHY each principle exists. Then patterns become derivable.</div>
        </div>
      </section>

      <!-- Section 7: WHAT'S HARD -->
      <section id="hard" data-activity="hard">
        <h2 class="section-title">
          <span class="section-number">7</span>
          What's Hard
        </h2>

        <p class="text-text-secondary mb-6">
          Fundamental tensions in Claude Code orchestration that can't be fully solved:
        </p>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Context Rot vs. Memory Loss
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Fresh context avoids rot but loses learnings. progress.txt helps but grows unbounded. No perfect solution exists.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Quality drops in late iterations (rot), OR early iterations repeat mistakes from archived runs (memory loss).</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Keep progress.txt under 20KB. Start fresh runs from AGENTS.md (permanent), not progress.txt (session). Accept some re-learning as the cost of fresh context.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Judgment Transfer
          </div>
          <div class="hard-detail"><strong>The tension:</strong> This playbook teaches patterns, but choosing between them requires judgment. Judgment only develops through experience. You can't read your way to wisdom.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Picking wrong patterns for the situation. Overcomplicating simple tasks. Oversimplifying complex ones.</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Start with JUDGMENT-GUIDE.md decision trees. But expect to be wrong. Review each failure: "Which principle did I violate?" Build pattern recognition through iteration.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Cost vs. Quality vs. Speed
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Opus is best but expensive. Sonnet balances. Haiku is cheap but limited. More agents = more parallel but more coordination overhead. Faster iteration = less verification = more bugs.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Budget anxiety. Quality variance. Unexpected slow-downs from "efficient" choices.</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Tier by task type (Haiku lookups, Sonnet coding, Opus architecture). Verify before commit always. Measure actual costs per feature, not per token.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Determinism vs. Emergence
          </div>
          <div class="hard-detail"><strong>The tension:</strong> You want predictable outcomes. But LLMs are probabilistic. Multi-agent systems compound variance. The "same" run produces different results.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Flaky tests of agent behavior. "It worked yesterday." Different outcomes on retry.</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Verify outcomes, not processes. Accept that paths vary but destinations should match. Build tolerance for emergence at Level 6+.</div>
        </div>
      </section>

      <!-- Section 8: WHEN TO USE -->
      <section id="when" data-activity="when">
        <h2 class="section-title">
          <span class="section-number">8</span>
          Pattern Selection
        </h2>

        <h3 class="font-semibold text-lg mb-4">Which Pattern For This Task?</h3>

        <div class="code-block">
          <pre><span class="comment"># Decision Tree: Architecture Selection</span>

Is task well-defined with clear acceptance criteria?
├─ No → Stay interactive (Level 0-2), clarify first
└─ Yes → Can it complete in one context window?
         ├─ Yes → Single Ralph iteration (Level 3)
         └─ No → How many parallel features?
                 ├─ 1 feature → Ralph Loop (Level 3-4)
                 ├─ 2-3 features → Parallel Ralph + Worktrees (Level 6)
                 ├─ 3-8 agents → CC Mirror (Level 5)
                 └─ 10+ agents → Gas Town Factory (Level 7)</pre>
        </div>

        <div class="when-grid">
          <div class="when-use">
            <div class="when-title">
              <i data-lucide="check" class="w-5 h-5"></i>
              USE THIS PLAYBOOK WHEN
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>You're overwhelmed by Claude Code options and need a structured progression</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Your current approach hits context limits or quality degradation</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>You want to understand WHY patterns work, not just HOW</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>You need judgment criteria for choosing between approaches</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>You want to "ship while you sleep"</span>
            </div>
          </div>

          <div class="when-not">
            <div class="when-title">
              <i data-lucide="x" class="w-5 h-5"></i>
              USE SPECIFIC PATTERN DOCS WHEN
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>You know your level and need deep pattern implementation → mastery-ralph-complete.md</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>You need decision support for a specific choice → JUDGMENT-GUIDE.md</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>You need architecture diagrams and comparisons → architecture-complexity-ladder.md</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>You need production checklists → D-FINAL-operations.md</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>You're debugging a specific failure → Troubleshooting section in pattern docs</span>
            </div>
          </div>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8">Quick Reference: Level by Pattern</h3>

        <table class="progression-table">
          <thead>
            <tr>
              <th>If you need...</th>
              <th>Level</th>
              <th>Pattern</th>
              <th>Deep dive doc</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Basic productivity</td>
              <td><span class="level-badge level-1">L1</span></td>
              <td>CLAUDE.md + Commands</td>
              <td>-</td>
            </tr>
            <tr>
              <td>Overnight feature shipping</td>
              <td><span class="level-badge level-3">L3</span></td>
              <td>Ralph Loop</td>
              <td>mastery-ralph-complete.md</td>
            </tr>
            <tr>
              <td>Parallel task execution</td>
              <td><span class="level-badge level-5">L5</span></td>
              <td>CC Mirror</td>
              <td>mastery-multi-agent.md</td>
            </tr>
            <tr>
              <td>Multiple features simultaneously</td>
              <td><span class="level-badge level-6">L6</span></td>
              <td>Parallel Ralph + Worktrees</td>
              <td>mastery-context-management.md</td>
            </tr>
            <tr>
              <td>Team-scale development</td>
              <td><span class="level-badge level-7">L7</span></td>
              <td>Gas Town Factory</td>
              <td>mastery-gastown-complete.md</td>
            </tr>
          </tbody>
        </table>
      </section>

    </main>

    <!-- Resizer between Main Panel and Activity Zone -->
    <div class="resizer" data-resizer="activity-zone" aria-label="Resize activity panel"></div>

    <!-- Activity Zone -->
    <aside class="activity-zone" id="activityZone">
      <div class="text-xs font-semibold text-text-muted uppercase tracking-wider mb-4">Operational Intelligence</div>

      <!-- ESSENCE SECTION -->
      <div class="activity-item minimal" data-section="essence">
        <div class="activity-label" style="color: #84cc16;">
          <i data-lucide="minimize-2" class="w-4 h-4"></i>
          Minimal Pattern
        </div>
        <div class="font-medium text-text-primary mb-2">The irreducible core of this playbook</div>
        <div class="text-text-secondary text-sm">
          <strong>8 principles + 8 levels + judgment criteria.</strong><br>
          Everything else is elaboration and examples.<br><br>
          If you understand the principles and know your level, you can derive everything else.
        </div>
      </div>

      <div class="activity-item invariant" data-section="essence">
        <div class="activity-label" style="color: #3b82f6;">
          <i data-lucide="link" class="w-4 h-4"></i>
          Invariant Connection
        </div>
        <div class="font-medium text-text-primary mb-2">All patterns share INV-001: Context-First Paradigm</div>
        <div class="text-text-secondary text-sm">
          Every pattern in this playbook - Ralph, CC Mirror, Gas Town, Panopticon - ultimately optimizes for context constraints. The specific mechanisms differ, but the root invariant is identical. If you violate context discipline, all patterns fail.
        </div>
      </div>

      <div class="activity-item warstory" data-section="essence">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">Boris Cherny's "Vanilla" Philosophy</div>
        <div class="text-text-secondary text-sm">
          Claude Code's creator uses the simplest possible setup. CLAUDE.md + git + verification. No elaborate frameworks. "The best workflow is the one you actually use." This playbook exists because most people need structured progression to reach simplicity.
        </div>
      </div>

      <!-- CORE SECTION -->
      <div class="activity-item constraint" data-section="core">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="link-2" class="w-4 h-4"></i>
          Constraint Chain
        </div>
        <div class="font-medium text-text-primary mb-2">Context finite → ALL 8 PRINCIPLES</div>
        <div class="text-text-secondary text-sm">
          <strong>ROOT:</strong> Context window is finite (~200K)<br>
          → Quality degrades as context fills (Principle 1)<br>
          → External state must persist (Principle 2)<br>
          → Fresh context beats extended (Principle 3)<br>
          → Must separate coordination from execution (Principle 4)<br>
          → Tasks must be atomic and verifiable (Principles 5-6)<br>
          → Parallel work needs isolation (Principle 7)<br>
          → Communication must be explicit (Principle 8)<br><br>
          <em>One constraint, EIGHT downstream principles.</em>
        </div>
      </div>

      <div class="activity-item invariant" data-section="core">
        <div class="activity-label" style="color: #3b82f6;">
          <i data-lucide="link" class="w-4 h-4"></i>
          Invariant Connection
        </div>
        <div class="font-medium text-text-primary mb-2">Principles 2, 3, 7 share: "External > Internal"</div>
        <div class="text-text-secondary text-sm">
          External state > internal memory (P2), Fresh context > extended sessions (P3), and Isolation for parallel work (P7) are all manifestations of the same insight: <strong>what persists outside the agent is more reliable than what lives inside.</strong>
        </div>
      </div>

      <div class="activity-item analogy" data-section="core">
        <div class="activity-label" style="color: #d946ef;">
          <i data-lucide="git-compare" class="w-4 h-4"></i>
          Analogical Bridge
        </div>
        <div class="font-medium text-text-primary mb-2">8 Principles = Distributed Systems Fundamentals</div>
        <div class="text-text-secondary text-sm">
          Context finite → Bounded resources<br>
          External state → Database persistence<br>
          Fresh context → Stateless services<br>
          Orchestrator/Worker → Microservices separation<br>
          Atomic tasks → Transaction boundaries<br><br>
          <em>If you've built distributed systems, you already have the mental models.</em>
        </div>
      </div>

      <!-- DECISIONS SECTION -->
      <div class="activity-item inversion" data-section="decisions">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if you could skip levels?</div>
        <div class="text-text-secondary text-sm">
          <strong>You'd design:</strong> Jump straight to Gas Town (Level 7) day one.<br>
          <strong>Why this fails:</strong> Level 7 requires Level 3 context discipline, Level 5 coordination skills, Level 6 isolation patterns. Without those, Gas Town produces chaos.<br>
          <strong>Hidden constraint:</strong> Capability levels are skill dependencies, not arbitrary gates.
        </div>
      </div>

      <div class="activity-item tradeoff" data-section="decisions">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="scale" class="w-4 h-4"></i>
          Trade-Off Tension
        </div>
        <div class="font-medium text-text-primary mb-2">Principles vs. Patterns: What to teach first?</div>
        <div class="text-text-secondary text-sm">
          <strong>Principles first:</strong> Deeper understanding, but abstract until applied<br>
          <strong>Patterns first:</strong> Immediate utility, but fragile when constraints change<br>
          <strong>Interleaved:</strong> Best retention, but harder to navigate<br><br>
          <strong>This playbook's choice:</strong> Principles first (Part 1), then progression (Part 2), then deep patterns (Part 3). <em>Theory → Application → Mastery.</em>
        </div>
      </div>

      <div class="activity-item constraint" data-section="decisions">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="link-2" class="w-4 h-4"></i>
          Constraint Chain
        </div>
        <div class="font-medium text-text-primary mb-2">Why this playbook exists at all</div>
        <div class="text-text-secondary text-sm">
          <strong>ROOT:</strong> Claude Code is powerful but overwhelming<br>
          → Users need progression, not just reference<br>
          → Progression requires levels with clear milestones<br>
          → Milestones require judgment criteria<br>
          → Judgment requires understanding principles<br>
          → Understanding requires before/after contrast<br><br>
          <em>One pain point (overwhelm), six structural decisions.</em>
        </div>
      </div>

      <!-- FILES / LEVELS SECTION -->
      <div class="activity-item gradient" data-section="files">
        <div class="activity-label" style="color: #f43f5e;">
          <i data-lucide="trending-down" class="w-4 h-4"></i>
          Failure Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">How capability degrades when skipping levels</div>
        <div class="text-text-secondary text-sm">
          <strong>Skip L1 (CLAUDE.md):</strong> 20% efficiency loss, manageable<br>
          <strong>Skip L2 (Subagents):</strong> Context pollution starts<br>
          <strong>Skip L3 (Ralph):</strong> No context discipline foundation<br>
          <strong>Skip to L5 (CC Mirror):</strong> Orchestrator chaos, worker spawn loops<br>
          <strong>Skip to L7 (Gas Town):</strong> $1000+ burn before correction<br><br>
          <em>Critical: Skipping compounds. L3→L7 skip is worse than L1→L7.</em>
        </div>
      </div>

      <div class="activity-item expertise" data-section="files">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
          Expertise Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">How deeply do you understand the levels?</div>
        <div class="text-text-secondary text-sm">
          <strong>Beginner:</strong> "What level am I?" → Check table<br>
          <strong>Intermediate:</strong> "Why these specific levels?" → Skill dependencies<br>
          <strong>Advanced:</strong> "Can I combine levels?" → Yes, L3+L6 common<br>
          <strong>Staff:</strong> "When to skip levels?" → When you've proven the prerequisite skills<br>
          <strong>Expert:</strong> "Are there levels beyond 7?" → Yes, but undocumented emergence
        </div>
      </div>

      <div class="activity-item composition" data-section="files">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="layers" class="w-4 h-4"></i>
          Composition Case
        </div>
        <div class="font-medium text-text-primary mb-2">Level 3 + Level 6 (Ralph + Worktrees)</div>
        <div class="text-text-secondary text-sm">
          <strong>Works:</strong> Multiple features shipping overnight in parallel.<br>
          <strong>Why:</strong> Worktrees provide file isolation. Ralph provides iteration discipline. Multiplicative benefit.<br>
          <strong>Common:</strong> This is the most popular combination at Month 3+.
        </div>
      </div>

      <div class="activity-item warstory" data-section="files">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">Molly Cantillon: Panopticon at Scale</div>
        <div class="text-text-secondary text-sm">
          8 parallel Claude instances, each owning a life domain (nox, metrics, email, growth, trades, health, writing, personal). Built Jmail (18M users) overnight. "Domain isolation = context isolation = quality preservation."
        </div>
      </div>

      <!-- PATH / PROGRESSION SECTION -->
      <div class="activity-item horizon" data-section="path">
        <div class="activity-label" style="color: #06b6d4;">
          <i data-lucide="clock" class="w-4 h-4"></i>
          Time Horizon Shift
        </div>
        <div class="font-medium text-text-primary mb-2">How the playbook feels at different stages</div>
        <div class="text-text-secondary text-sm">
          <strong>Day 1:</strong> "This is overwhelming. So many patterns."<br>
          <strong>Week 2:</strong> "Level 1-2 are easy. Why is Level 3 hard?"<br>
          <strong>Month 1:</strong> "Oh, Level 3 is the foundation for everything."<br>
          <strong>Month 3:</strong> "I'm combining levels naturally now."<br>
          <strong>Month 6:</strong> "The playbook is a map. I navigate by principles."<br><br>
          <em>Don't judge the playbook by Day 1.</em>
        </div>
      </div>

      <div class="activity-item violation" data-section="path">
        <div class="activity-label" style="color: #f97316;">
          <i data-lucide="alert-octagon" class="w-4 h-4"></i>
          Violation Chain
        </div>
        <div class="font-medium text-text-primary mb-2">If you skip Level 3 context discipline</div>
        <div class="text-text-secondary text-sm">
          <strong>IF:</strong> You skip Ralph loop mastery<br>
          <strong>THEN:</strong> No experience with external state patterns<br>
          <strong>THEN:</strong> Level 5 orchestrator has no context hygiene<br>
          <strong>THEN:</strong> Workers inherit polluted context<br>
          <strong>THEN:</strong> Multi-agent becomes multi-chaos<br>
          <strong>FINALLY:</strong> "Multi-agent doesn't work" (but it does, with discipline)<br><br>
          <em>The fix: Master Level 3. 10+ successful overnight runs before Level 5.</em>
        </div>
      </div>

      <div class="activity-item inflection" data-section="path">
        <div class="activity-label" style="color: #eab308;">
          <i data-lucide="activity" class="w-4 h-4"></i>
          Inflection Point
        </div>
        <div class="font-medium text-text-primary mb-2">When Level 3 stops being enough</div>
        <div class="text-text-secondary text-sm">
          <strong>0-3 features/week:</strong> Level 3 Ralph is optimal<br>
          <strong>3-6 features/week:</strong> Parallel Ralph (Level 6) adds value<br>
          <strong>6-10 features/week:</strong> CC Mirror (Level 5) coordination needed<br>
          <strong>10+ features/week:</strong> Gas Town (Level 7) becomes justified<br><br>
          <strong>THE INFLECTION:</strong> ~6 features/week<br>
          <em>Before: Single-agent patterns. After: Multi-agent required.</em>
        </div>
      </div>

      <!-- GOTCHAS SECTION -->
      <div class="activity-item inversion" data-section="gotchas">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if orchestrators COULD write code?</div>
        <div class="text-text-secondary text-sm">
          <strong>You'd design:</strong> Orchestrator that implements AND coordinates. Simpler architecture.<br>
          <strong>Why this fails:</strong> Implementation details fill context. Orchestrator loses global view. Can't coordinate what it can't see.<br>
          <strong>Hidden constraint:</strong> The Iron Law exists because coordination requires perspective. Implementation consumes perspective.
        </div>
      </div>

      <div class="activity-item violation" data-section="gotchas">
        <div class="activity-label" style="color: #f97316;">
          <i data-lucide="alert-octagon" class="w-4 h-4"></i>
          Violation Chain
        </div>
        <div class="font-medium text-text-primary mb-2">If workers spawn workers</div>
        <div class="text-text-secondary text-sm">
          <strong>IF:</strong> Worker A spawns Worker B<br>
          <strong>THEN:</strong> Worker B might spawn Worker C<br>
          <strong>THEN:</strong> Recursion with no termination guarantee<br>
          <strong>THEN:</strong> Costs spiral ($47k+ documented)<br>
          <strong>THEN:</strong> No audit trail of what happened<br>
          <strong>FINALLY:</strong> System must be killed, all work lost<br><br>
          <em>The fix: "You must NOT spawn subagents" in EVERY worker prompt. No exceptions.</em>
        </div>
      </div>

      <div class="activity-item warstory" data-section="gotchas">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">The $47,000 Runaway Agent</div>
        <div class="text-text-secondary text-sm">
          Community member left agent running without iteration limits or cost caps. Workers spawning workers in recursive loop. Discovered next morning with $47k bill. Now documented as canonical warning. <strong>Always: MAX_ITERATIONS, cost monitoring, ntfy alerts.</strong>
        </div>
      </div>

      <div class="activity-item frontier" data-section="gotchas">
        <div class="activity-label" style="color: #ef4444;">
          <i data-lucide="flask-conical" class="w-4 h-4"></i>
          Research Frontier
        </div>
        <div class="font-medium text-text-primary mb-2">UNSOLVED: Optimal level transition timing</div>
        <div class="text-text-secondary text-sm">
          When exactly should you move from Level N to Level N+1? Current guidance is heuristic ("feels right", "10 successful runs"). No quantitative metrics exist. Research opportunity: Define measurable readiness criteria for each level transition.
        </div>
      </div>

      <!-- HARD SECTION -->
      <div class="activity-item tradeoff" data-section="hard">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="scale" class="w-4 h-4"></i>
          Trade-Off Tension
        </div>
        <div class="font-medium text-text-primary mb-2">Context Rot vs. Memory Loss (The Core Dilemma)</div>
        <div class="text-text-secondary text-sm">
          <strong>Extended sessions:</strong> Rich context, but quality degrades at 80K tokens<br>
          <strong>Fresh context:</strong> Peak quality, but must reconstruct state each time<br>
          <strong>progress.txt:</strong> Memory bridge, but grows unbounded<br><br>
          <strong>WHY NO PERFECT ANSWER:</strong> Context limits are physics. Progress files are lossy. Every iteration "forgets" 90% of prior.<br><br>
          <em>Accept: Fresh > rot. Invest in hygiene, not longer sessions.</em>
        </div>
      </div>

      <div class="activity-item gradient" data-section="hard">
        <div class="activity-label" style="color: #f43f5e;">
          <i data-lucide="trending-down" class="w-4 h-4"></i>
          Failure Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">How judgment failures compound</div>
        <div class="text-text-secondary text-sm">
          <strong>Wrong pattern, small task:</strong> 2x time cost, recoverable<br>
          <strong>Wrong pattern, medium task:</strong> Day lost, frustration<br>
          <strong>Wrong level, feature set:</strong> Week lost, architectural rework<br>
          <strong>Wrong principles, system design:</strong> Months lost, rebuild required<br><br>
          <em>Critical: Judgment errors at principle level cascade through everything.</em>
        </div>
      </div>

      <div class="activity-item frontier" data-section="hard">
        <div class="activity-label" style="color: #ef4444;">
          <i data-lucide="flask-conical" class="w-4 h-4"></i>
          Research Frontier
        </div>
        <div class="font-medium text-text-primary mb-2">UNSOLVED: Transferring judgment</div>
        <div class="text-text-secondary text-sm">
          <strong>The question:</strong> How do you teach judgment (when to use which pattern) without requiring all the failures that build judgment?<br>
          <strong>Why it's hard:</strong> Judgment is pattern recognition from experience. Reading about failures isn't the same as having them.<br>
          <strong>Current approach:</strong> Decision trees + failure stories + emphasis on principles.
        </div>
      </div>

      <div class="activity-item alternative" data-section="hard">
        <div class="activity-label" style="color: #6b7280;">
          <i data-lucide="arrow-right" class="w-4 h-4"></i>
          Alternative Path
        </div>
        <div class="font-medium text-text-primary mb-2">If judgment transfer is too hard</div>
        <div class="text-text-secondary text-sm">
          <strong>Embrace failures?</strong> → Accept learning tax. Budget for wrong choices.<br>
          <strong>Simplify options?</strong> → Use Ralph for everything until it breaks.<br>
          <strong>Pair with expert?</strong> → Community Discord for live guidance.<br>
          <strong>Start smaller?</strong> → Master Level 1-3 before reading Level 4+.
        </div>
      </div>

      <!-- WHEN SECTION -->
      <div class="activity-item inversion" data-section="when">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if you used Gas Town for a simple feature?</div>
        <div class="text-text-secondary text-sm">
          <strong>You'd design:</strong> Mayor, Deacon, Dogs, Polecats for a login form.<br>
          <strong>Why this fails:</strong> Coordination overhead exceeds implementation time. $50 budget for $2 task. 3 hours setup for 30 min work.<br>
          <strong>Hidden constraint:</strong> Pattern complexity must match task complexity. Overengineering is a pattern failure.
        </div>
      </div>

      <div class="activity-item composition" data-section="when">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="layers" class="w-4 h-4"></i>
          Composition Case
        </div>
        <div class="font-medium text-text-primary mb-2">This Playbook + JUDGMENT-GUIDE.md</div>
        <div class="text-text-secondary text-sm">
          <strong>Works:</strong> Playbook for learning progression, JUDGMENT-GUIDE for in-the-moment decisions.<br>
          <strong>Why:</strong> Different tools for different contexts. Playbook = curriculum. JUDGMENT-GUIDE = field manual.<br>
          <strong>Usage:</strong> Read Playbook once, reference JUDGMENT-GUIDE daily.
        </div>
      </div>

      <div class="activity-item invariant" data-section="when">
        <div class="activity-label" style="color: #3b82f6;">
          <i data-lucide="link" class="w-4 h-4"></i>
          Invariant Connection
        </div>
        <div class="font-medium text-text-primary mb-2">All decision trees share: "Match complexity to complexity"</div>
        <div class="text-text-secondary text-sm">
          Whether choosing between Ralph/CC Mirror/Gas Town, between Opus/Sonnet/Haiku, or between single/parallel execution - the invariant is the same: <strong>pattern complexity should match task complexity.</strong> Simple tasks deserve simple patterns.
        </div>
      </div>

      <div class="activity-item alternative" data-section="when">
        <div class="activity-label" style="color: #6b7280;">
          <i data-lucide="arrow-right" class="w-4 h-4"></i>
          Alternative Path
        </div>
        <div class="font-medium text-text-primary mb-2">If this Playbook isn't right for you</div>
        <div class="text-text-secondary text-sm">
          <strong>Need just one pattern?</strong> → mastery-ralph-complete.md<br>
          <strong>Need quick decisions?</strong> → JUDGMENT-GUIDE.md<br>
          <strong>Need visual architecture?</strong> → architecture-complexity-ladder.md<br>
          <strong>Need production checklists?</strong> → D-FINAL-operations.md<br>
          <strong>Need source research?</strong> → SOURCE-INDEX.md
        </div>
      </div>

      <div class="activity-item expertise" data-section="when">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
          Expertise Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">What's your pattern selection fluency?</div>
        <div class="text-text-secondary text-sm">
          <strong>Beginner:</strong> "Which pattern should I use?" → Decision tree<br>
          <strong>Intermediate:</strong> "Why this pattern over that?" → Understand constraints<br>
          <strong>Advanced:</strong> "Can I combine patterns?" → Yes, thoughtfully<br>
          <strong>Staff:</strong> "When do decision trees fail?" → Edge cases need judgment<br>
          <strong>Expert:</strong> "Do I need this playbook?" → Only for reference, not learning
        </div>
      </div>

    </aside>
  </div>

  <script>
    /**
     * PanelResizer - Handles draggable panel dividers
     */
    class PanelResizer {
      constructor(resizerEl, config = {}) {
        this.resizer = resizerEl;
        this.config = {
          storageKey: 'panel-activity-zone-width',
          minWidth: 280,
          maxWidth: 900,
          defaultWidth: 480,
          ...config
        };

        this.isResizing = false;
        this.startX = 0;
        this.startWidth = 0;

        // Elements
        this.activityZone = document.querySelector('.activity-zone');
        this.mainContent = document.querySelector('.main-content');

        // Bind methods
        this.onMouseDown = this.onMouseDown.bind(this);
        this.onMouseMove = this.onMouseMove.bind(this);
        this.onMouseUp = this.onMouseUp.bind(this);

        this.init();
      }

      init() {
        this.restoreWidth();
        this.resizer.addEventListener('mousedown', this.onMouseDown);
      }

      onMouseDown(e) {
        if (e.button !== 0) return;

        this.isResizing = true;
        this.startX = e.clientX;
        this.startWidth = this.activityZone.offsetWidth;

        this.resizer.classList.add('active');
        document.body.classList.add('resizing');

        document.addEventListener('mousemove', this.onMouseMove);
        document.addEventListener('mouseup', this.onMouseUp);

        e.preventDefault();
      }

      onMouseMove(e) {
        if (!this.isResizing) return;

        const delta = this.startX - e.clientX;
        const newWidth = this.startWidth + delta;

        const constrainedWidth = Math.max(
          this.config.minWidth,
          Math.min(this.config.maxWidth, newWidth)
        );

        this.activityZone.style.width = constrainedWidth + 'px';
        this.mainContent.style.marginRight = constrainedWidth + 'px';
        this.resizer.style.right = constrainedWidth + 'px';
      }

      onMouseUp(e) {
        if (!this.isResizing) return;

        this.isResizing = false;

        this.resizer.classList.remove('active');
        document.body.classList.remove('resizing');

        document.removeEventListener('mousemove', this.onMouseMove);
        document.removeEventListener('mouseup', this.onMouseUp);

        this.saveWidth();
      }

      saveWidth() {
        const width = this.activityZone.offsetWidth;
        localStorage.setItem(this.config.storageKey, JSON.stringify({
          width,
          timestamp: Date.now()
        }));
      }

      restoreWidth() {
        try {
          const stored = localStorage.getItem(this.config.storageKey);
          if (stored) {
            const { width } = JSON.parse(stored);
            if (width >= this.config.minWidth && width <= this.config.maxWidth) {
              this.activityZone.style.width = width + 'px';
              this.mainContent.style.marginRight = width + 'px';
              this.resizer.style.right = width + 'px';
            }
          }
        } catch (e) {
          console.warn('Failed to restore panel width:', e);
        }
      }

      destroy() {
        this.resizer.removeEventListener('mousedown', this.onMouseDown);
        document.removeEventListener('mousemove', this.onMouseMove);
        document.removeEventListener('mouseup', this.onMouseUp);
      }
    }

    // Auto-initialize resizers on DOM ready
    document.addEventListener('DOMContentLoaded', () => {
      const resizers = document.querySelectorAll('[data-resizer]');
      resizers.forEach(resizer => new PanelResizer(resizer));
    });

    // Initialize Lucide icons
    lucide.createIcons();

    // Navigation toggle
    function toggleSection(header) {
      const section = header.closest('.nav-section');
      section.classList.toggle('expanded');
      const children = section.querySelector('.nav-children');
      children.classList.toggle('expanded');
    }

    // Mobile menu toggle
    function toggleMobileMenu() {
      const nav = document.getElementById('leftNav');
      nav.classList.toggle('open');
    }

    // Copy functionality
    function copyCode(btn, text) {
      navigator.clipboard.writeText(text).then(() => {
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i data-lucide="check" class="w-3 h-3"></i> Copied!';
        lucide.createIcons();
        setTimeout(() => {
          btn.innerHTML = originalText;
          lucide.createIcons();
        }, 2000);
      });
    }

    function copyCodeBlock(btn) {
      const codeBlock = btn.closest('.code-block');
      const pre = codeBlock.querySelector('pre');
      const text = pre.textContent;
      copyCode(btn, text);
    }

    // Scroll-sync with GSAP ScrollTrigger
    gsap.registerPlugin(ScrollTrigger);

    // Track which sections are in view
    const sections = document.querySelectorAll('[data-activity]');
    const activityItems = document.querySelectorAll('.activity-item');

    sections.forEach(section => {
      ScrollTrigger.create({
        trigger: section,
        start: 'top 40%',
        end: 'bottom 40%',
        onEnter: () => activateSection(section.dataset.activity),
        onEnterBack: () => activateSection(section.dataset.activity),
      });
    });

    function activateSection(sectionName) {
      activityItems.forEach(item => {
        if (item.dataset.section === sectionName) {
          item.classList.add('active');
          gsap.to(item, {
            opacity: 1,
            y: -2,
            boxShadow: '0 4px 12px rgba(0,0,0,0.08)',
            duration: 0.3,
            ease: 'power2.out'
          });
        } else {
          item.classList.remove('active');
          gsap.to(item, {
            opacity: 0.5,
            y: 0,
            boxShadow: 'none',
            duration: 0.3,
            ease: 'power2.out'
          });
        }
      });

      // Update nav active state
      document.querySelectorAll('.nav-section-header').forEach(header => {
        header.classList.remove('active');
      });
      const activeNav = document.querySelector(`[data-section="${sectionName}"] .nav-section-header`);
      if (activeNav) {
        activeNav.classList.add('active');
      }
    }

    // Initialize first section as active
    activateSection('essence');

    // Smooth scroll for nav links
    document.querySelectorAll('.nav-item').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const target = document.querySelector(link.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          document.querySelectorAll('.nav-item').forEach(l => l.classList.remove('active'));
          link.classList.add('active');
        }
      });
    });

    // Brushing interaction - hover activity item highlights related content
    activityItems.forEach(item => {
      item.addEventListener('mouseenter', () => {
        const sectionName = item.dataset.section;
        const relatedSection = document.querySelector(`[data-activity="${sectionName}"]`);
        if (relatedSection) {
          relatedSection.style.backgroundColor = 'rgba(13, 147, 115, 0.05)';
          relatedSection.style.transition = 'background-color 0.3s ease';
        }
      });

      item.addEventListener('mouseleave', () => {
        const sectionName = item.dataset.section;
        const relatedSection = document.querySelector(`[data-activity="${sectionName}"]`);
        if (relatedSection) {
          relatedSection.style.backgroundColor = '';
        }
      });
    });
  </script>
</body>
</html>
