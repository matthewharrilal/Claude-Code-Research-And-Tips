<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plugin & Extension Grammar | Claude Code Documentation</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Lucide Icons CDN -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- GSAP for scroll-sync -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

  <!-- Tailwind Config with Design Tokens -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'bg-base': '#ffffff',
            'bg-subtle': '#fafafa',
            'bg-muted': '#f4f4f5',
            'text-primary': '#18181b',
            'text-secondary': '#3f3f46',
            'text-muted': '#71717a',
            'accent': '#0D9373',
            'accent-light': '#10b981',
            'accent-bg': '#ecfdf5',
            'border': '#e4e4e7',
            // Activity Zone content type colors (Original 6)
            'az-invariant': '#3b82f6',    // Blue
            'az-effect': '#f59e0b',       // Amber
            'az-composition': '#8b5cf6',  // Purple
            'az-frontier': '#ef4444',     // Red
            'az-warstory': '#10b981',     // Green
            'az-alternative': '#6b7280',  // Gray
            // Activity Zone generative content types (New 10)
            'az-inversion': '#4f46e5',    // Indigo
            'az-constraint': '#8b5cf6',   // Violet
            'az-gradient': '#f43f5e',     // Rose
            'az-horizon': '#06b6d4',      // Cyan
            'az-violation': '#f97316',    // Orange
            'az-tradeoff': '#f59e0b',     // Amber
            'az-analogy': '#d946ef',      // Fuchsia
            'az-expertise': '#10b981',    // Emerald
            'az-minimal': '#84cc16',      // Lime
            'az-inflection': '#eab308',   // Yellow
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
            mono: ['Fira Code', 'monospace'],
          },
        },
      },
    }
  </script>

  <style>
    /* Base Styles */
    * {
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
      scroll-padding-top: 80px;
    }

    [id] {
      scroll-margin-top: 80px;
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: #ffffff;
      color: #18181b;
      line-height: 1.7;
    }

    /* Three Panel Layout */
    .three-panel-layout {
      min-height: 100vh;
      position: relative;
    }

    /* Header */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 56px;
      background: #ffffff;
      border-bottom: 1px solid #e4e4e7;
      z-index: 100;
      display: flex;
      align-items: center;
      padding: 0 24px;
    }

    /* Left Navigation - 240px fixed */
    .left-nav {
      position: fixed;
      top: 56px;
      left: 0;
      width: 240px;
      height: calc(100vh - 56px);
      border-right: 1px solid #e4e4e7;
      background: #ffffff;
      overflow-y: auto;
      padding: 16px 0;
      z-index: 40;
    }

    .nav-section {
      padding: 0 12px;
      margin-bottom: 8px;
    }

    .nav-section-header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      font-size: 14px;
      font-weight: 500;
      color: #3f3f46;
      cursor: pointer;
      border-radius: 6px;
      transition: background 0.15s;
    }

    .nav-section-header:hover {
      background: #f4f4f5;
    }

    .nav-section-header.active {
      color: #0D9373;
      background: #ecfdf5;
    }

    .nav-item {
      display: block;
      padding: 6px 12px 6px 44px;
      font-size: 14px;
      color: #71717a;
      text-decoration: none;
      border-radius: 6px;
      transition: all 0.15s;
    }

    .nav-item:hover {
      color: #3f3f46;
      background: #f4f4f5;
    }

    .nav-item.active {
      color: #0D9373;
      background: #ecfdf5;
    }

    .nav-children {
      display: none;
      overflow: hidden;
    }

    .nav-children.expanded {
      display: block;
    }

    .nav-chevron {
      transition: transform 0.2s;
    }

    .nav-section.expanded .nav-chevron {
      transform: rotate(90deg);
    }

    /* Main Content - Flexible, margins for fixed sidebars */
    .main-content {
      margin-left: 240px;
      margin-right: 480px;
      margin-top: 56px;
      padding: 48px 48px;
      min-width: 400px;
    }

    /* Activity Zone - 480px fixed */
    .activity-zone {
      position: fixed;
      top: 56px;
      right: 0;
      width: 480px;
      height: calc(100vh - 56px);
      border-left: 1px dashed #e4e4e7;
      background: #fafafa;
      overflow-y: auto;
      padding: 24px 20px;
      z-index: 40;
    }

    /* Responsive: Hide Activity Zone below 1400px */
    @media (max-width: 1400px) {
      .activity-zone {
        display: none;
      }
      .main-content {
        margin-right: 0;
        padding: 40px 32px;
      }
    }

    /* Responsive: Hide Left Nav below 768px */
    @media (max-width: 768px) {
      .left-nav {
        display: none;
      }
      .left-nav.open {
        display: block;
        position: fixed;
        top: 56px;
        left: 0;
        right: 0;
        bottom: 0;
        background: #ffffff;
        z-index: 50;
        overflow-y: auto;
      }
      .main-content {
        margin-left: 0;
        padding: 24px 16px;
        min-width: auto;
      }
    }

    /* Resizer */
    .resizer {
      position: fixed;
      top: 56px;
      right: 480px;
      width: 6px;
      height: calc(100vh - 56px);
      cursor: col-resize;
      background: transparent;
      z-index: 50;
      transition: background 0.15s ease;
    }

    .resizer:hover {
      background: rgba(13, 147, 115, 0.15);
    }

    .resizer.active {
      background: rgba(13, 147, 115, 0.25);
    }

    body.resizing {
      user-select: none;
      cursor: col-resize !important;
    }

    body.resizing * {
      cursor: col-resize !important;
    }

    @media (max-width: 1400px) {
      .resizer {
        display: none;
      }
    }

    /* Activity Zone Items */
    .activity-item {
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      background: #ffffff;
      border: 1px solid #e4e4e7;
      font-size: 14px;
      line-height: 1.6;
      opacity: 0.5;
      transition: all 0.3s ease;
    }

    .activity-item.active {
      opacity: 1;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .activity-item:hover {
      opacity: 1;
    }

    .activity-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    /* Activity Zone content type borders */
    .activity-item.invariant { border-left: 4px solid #3b82f6; }
    .activity-item.effect { border-left: 4px solid #f59e0b; }
    .activity-item.composition { border-left: 4px solid #8b5cf6; }
    .activity-item.frontier { border-left: 4px solid #ef4444; }
    .activity-item.warstory { border-left: 4px solid #10b981; }
    .activity-item.alternative { border-left: 4px solid #6b7280; }
    .activity-item.inversion { border-left: 4px solid #4f46e5; }
    .activity-item.constraint { border-left: 4px solid #8b5cf6; }
    .activity-item.gradient { border-left: 4px solid #f43f5e; }
    .activity-item.horizon { border-left: 4px solid #06b6d4; }
    .activity-item.violation { border-left: 4px solid #f97316; }
    .activity-item.tradeoff { border-left: 4px solid #f59e0b; }
    .activity-item.analogy { border-left: 4px solid #d946ef; }
    .activity-item.expertise { border-left: 4px solid #10b981; }
    .activity-item.minimal { border-left: 4px solid #84cc16; }
    .activity-item.inflection { border-left: 4px solid #eab308; }

    /* Main Content Components */
    .section-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      background: #0D9373;
      color: #ffffff;
      font-size: 14px;
      font-weight: 600;
      border-radius: 50%;
      margin-right: 12px;
    }

    .section-title {
      font-size: 24px;
      font-weight: 600;
      color: #18181b;
      margin-bottom: 20px;
      margin-top: 56px;
      display: flex;
      align-items: center;
    }

    .section-title:first-child {
      margin-top: 0;
    }

    /* Essence Box */
    .essence-box {
      background: linear-gradient(135deg, #18181b 0%, #27272a 100%);
      border-radius: 12px;
      padding: 32px;
      margin-bottom: 40px;
    }

    .essence-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #10b981;
      margin-bottom: 12px;
    }

    .essence-text {
      font-size: 22px;
      font-weight: 500;
      color: #ffffff;
      line-height: 1.4;
    }

    /* Core Abstraction Box */
    .core-abstraction {
      background: #fafafa;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 40px;
    }

    .core-philosophy {
      font-size: 16px;
      color: #3f3f46;
      margin-bottom: 16px;
      font-style: italic;
    }

    .core-code {
      background: #18181b;
      border-radius: 8px;
      padding: 16px 20px;
      margin-bottom: 16px;
      overflow-x: auto;
    }

    .core-code code {
      font-family: 'Fira Code', monospace;
      font-size: 15px;
      color: #10b981;
      white-space: nowrap;
    }

    .core-anchor {
      font-size: 14px;
      color: #71717a;
      text-align: center;
    }

    /* Decision Box */
    .decision-box {
      background: #ffffff;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
    }

    .decision-why {
      font-size: 16px;
      font-weight: 600;
      color: #0D9373;
      margin-bottom: 12px;
    }

    .decision-reasoning {
      font-size: 14px;
      color: #3f3f46;
      margin-bottom: 16px;
    }

    .decision-implication {
      background: #f4f4f5;
      border-radius: 8px;
      padding: 16px;
    }

    .decision-implication-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      color: #71717a;
      margin-bottom: 8px;
    }

    /* Code Blocks */
    .code-block {
      background: #18181b;
      border-radius: 8px;
      padding: 16px 20px;
      margin-bottom: 24px;
      position: relative;
      overflow-x: auto;
    }

    .code-block pre {
      margin: 0;
      font-family: 'Fira Code', monospace;
      font-size: 13px;
      color: #e4e4e7;
      line-height: 1.6;
    }

    .code-block .comment { color: #6b7280; }
    .code-block .keyword { color: #c084fc; }
    .code-block .string { color: #10b981; }
    .code-block .variable { color: #60a5fa; }

    .copy-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: #3f3f46;
      color: #ffffff;
      border: none;
      border-radius: 4px;
      padding: 6px 10px;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: background 0.15s;
    }

    .copy-btn:hover {
      background: #52525b;
    }

    /* Path Steps */
    .path-container {
      background: #fafafa;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 40px;
    }

    .path-step {
      display: flex;
      gap: 16px;
      margin-bottom: 16px;
    }

    .path-step:last-child {
      margin-bottom: 0;
    }

    .path-number {
      flex-shrink: 0;
      width: 24px;
      height: 24px;
      background: #0D9373;
      color: #ffffff;
      font-size: 12px;
      font-weight: 600;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .path-content {
      flex: 1;
      font-size: 14px;
      color: #3f3f46;
    }

    .path-content code {
      background: #e4e4e7;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 13px;
    }

    /* Gotcha Box */
    .gotcha-box {
      background: #fffbeb;
      border: 1px solid #fcd34d;
      border-left: 4px solid #f59e0b;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .gotcha-title {
      font-weight: 600;
      color: #92400e;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .gotcha-detail {
      font-size: 14px;
      color: #78350f;
      margin-bottom: 8px;
    }

    .gotcha-detail strong {
      color: #92400e;
    }

    /* Hard Box */
    .hard-box {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-left: 4px solid #ef4444;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .hard-title {
      font-weight: 600;
      color: #991b1b;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .hard-detail {
      font-size: 14px;
      color: #7f1d1d;
      margin-bottom: 8px;
    }

    /* When Grid */
    .when-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 40px;
    }

    @media (max-width: 900px) {
      .when-grid {
        grid-template-columns: 1fr;
      }
    }

    .when-use {
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      border-radius: 12px;
      padding: 24px;
    }

    .when-not {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: 12px;
      padding: 24px;
    }

    .when-title {
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .when-use .when-title { color: #166534; }
    .when-not .when-title { color: #991b1b; }

    .when-item {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      font-size: 14px;
    }

    .when-use .when-item { color: #166534; }
    .when-not .when-item { color: #991b1b; }

    /* Plugin Type Grid */
    .plugin-type-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .plugin-type-card {
      background: #ffffff;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 20px;
      transition: all 0.2s ease;
    }

    .plugin-type-card:hover {
      border-color: #0D9373;
      box-shadow: 0 4px 12px rgba(13, 147, 115, 0.1);
    }

    .plugin-type-title {
      font-weight: 600;
      color: #18181b;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .plugin-type-desc {
      font-size: 14px;
      color: #71717a;
      margin-bottom: 12px;
    }

    .plugin-type-example {
      font-size: 13px;
      color: #3f3f46;
      background: #f4f4f5;
      padding: 8px 12px;
      border-radius: 6px;
      font-family: 'Fira Code', monospace;
    }

    /* Hierarchy Diagram */
    .hierarchy-diagram {
      background: #fafafa;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 32px;
      font-family: 'Fira Code', monospace;
      font-size: 14px;
      color: #3f3f46;
    }

    .hierarchy-item {
      padding-left: 20px;
      border-left: 2px solid #e4e4e7;
      margin-left: 8px;
      padding-top: 8px;
      padding-bottom: 8px;
    }

    .hierarchy-item:first-child {
      border-left: 2px solid #0D9373;
    }

    /* Table Styles */
    .content-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 32px;
      font-size: 14px;
    }

    .content-table th {
      background: #f4f4f5;
      padding: 12px 16px;
      text-align: left;
      font-weight: 600;
      color: #3f3f46;
      border-bottom: 2px solid #e4e4e7;
    }

    .content-table td {
      padding: 12px 16px;
      border-bottom: 1px solid #e4e4e7;
      color: #3f3f46;
    }

    .content-table code {
      background: #e4e4e7;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 12px;
    }

    /* Mobile Menu Button */
    .mobile-menu-btn {
      display: none;
      padding: 8px;
      background: none;
      border: none;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .mobile-menu-btn {
        display: flex;
      }
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: #fafafa;
    }

    ::-webkit-scrollbar-thumb {
      background: #d4d4d8;
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #a1a1aa;
    }

    /* Keyboard shortcut hint */
    .kbd {
      display: inline-flex;
      align-items: center;
      padding: 2px 6px;
      background: #f4f4f5;
      border: 1px solid #e4e4e7;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 12px;
      color: #71717a;
    }

    /* Composition Rule Box */
    .composition-rule {
      background: #ffffff;
      border: 1px solid #e4e4e7;
      border-left: 4px solid #8b5cf6;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .composition-rule-title {
      font-weight: 600;
      color: #5b21b6;
      margin-bottom: 12px;
    }

    .composition-pattern {
      background: #f4f4f5;
      padding: 12px 16px;
      border-radius: 6px;
      font-family: 'Fira Code', monospace;
      font-size: 13px;
      color: #3f3f46;
      margin-bottom: 12px;
    }

    /* Extension Point Box */
    .extension-point {
      background: #ffffff;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .extension-point-title {
      font-weight: 600;
      color: #0D9373;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .extension-point-purpose {
      font-size: 14px;
      color: #71717a;
      margin-bottom: 12px;
    }

    .extension-point-cases {
      font-size: 14px;
      color: #3f3f46;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle menu">
      <i data-lucide="menu" class="w-5 h-5 text-text-secondary"></i>
    </button>
    <div class="flex items-center gap-3">
      <i data-lucide="terminal" class="w-5 h-5 text-accent"></i>
      <span class="font-semibold text-text-primary">Claude Code</span>
    </div>
    <div class="flex-1 flex justify-center">
      <button class="flex items-center gap-2 px-4 py-2 bg-bg-muted rounded-lg text-text-muted text-sm hover:bg-border transition-colors">
        <i data-lucide="search" class="w-4 h-4"></i>
        <span>Search documentation...</span>
        <span class="kbd">Cmd+K</span>
      </button>
    </div>
    <div class="flex items-center gap-4">
      <a href="#" class="text-sm text-text-muted hover:text-text-primary transition-colors">Support</a>
      <button class="p-2 hover:bg-bg-muted rounded-lg transition-colors" aria-label="Toggle theme">
        <i data-lucide="sun" class="w-4 h-4 text-text-muted"></i>
      </button>
    </div>
  </header>

  <div class="three-panel-layout">
    <!-- Left Navigation -->
    <nav class="left-nav" id="leftNav">
      <div class="px-4 mb-4">
        <span class="text-xs font-semibold text-text-muted uppercase tracking-wider">Plugin Grammar</span>
      </div>

      <!-- Essence -->
      <div class="nav-section expanded" data-section="essence">
        <div class="nav-section-header active" onclick="toggleSection(this)">
          <i data-lucide="zap" class="w-4 h-4"></i>
          <span>Essence</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#essence" class="nav-item active">The 15-Word Summary</a>
        </div>
      </div>

      <!-- Core Abstraction -->
      <div class="nav-section expanded" data-section="core">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="box" class="w-4 h-4"></i>
          <span>Core Abstraction</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#core-abstraction" class="nav-item">Plugin as Primitive</a>
          <a href="#hierarchy" class="nav-item">The Hierarchy</a>
        </div>
      </div>

      <!-- Design Decisions -->
      <div class="nav-section expanded" data-section="decisions">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="lightbulb" class="w-4 h-4"></i>
          <span>Design Decisions</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#why-manifest" class="nav-item">Why Manifest?</a>
          <a href="#why-hooks" class="nav-item">Why Lifecycle Hooks?</a>
          <a href="#why-composition" class="nav-item">Why Composition Rules?</a>
        </div>
      </div>

      <!-- Plugin Types -->
      <div class="nav-section" data-section="types">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="layers" class="w-4 h-4"></i>
          <span>Plugin Types</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#plugin-types" class="nav-item">The 6 Categories</a>
          <a href="#visualization-plugins" class="nav-item">Visualization</a>
          <a href="#memory-plugins" class="nav-item">Memory</a>
          <a href="#workflow-plugins" class="nav-item">Workflow</a>
        </div>
      </div>

      <!-- Composition Rules -->
      <div class="nav-section" data-section="composition">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="git-merge" class="w-4 h-4"></i>
          <span>Composition Rules</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#composition" class="nav-item">The 6 Rules</a>
        </div>
      </div>

      <!-- Extension Points -->
      <div class="nav-section" data-section="extension">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="plug" class="w-4 h-4"></i>
          <span>Extension Points</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#extension-points" class="nav-item">The 5 Hooks</a>
        </div>
      </div>

      <!-- Gotchas -->
      <div class="nav-section" data-section="gotchas">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="alert-triangle" class="w-4 h-4"></i>
          <span>Gotchas</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#gotchas" class="nav-item">Practical Problems</a>
        </div>
      </div>

      <!-- When to Use -->
      <div class="nav-section" data-section="when">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="check-circle" class="w-4 h-4"></i>
          <span>When to Use</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#when" class="nav-item">Decision Criteria</a>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">

      <!-- Section 1: ESSENCE -->
      <section id="essence" data-activity="essence">
        <div class="essence-box">
          <div class="essence-label">Essence (15 words)</div>
          <div class="essence-text">Plugins package commands, skills, hooks, and agents into installable extensions that expand Claude Code's vocabulary.</div>
        </div>
      </section>

      <!-- Section 2: CORE ABSTRACTION -->
      <section id="core-abstraction" data-activity="core">
        <h2 class="section-title">
          <span class="section-number">2</span>
          The Core Abstraction
        </h2>

        <div class="core-abstraction">
          <div class="core-philosophy">"A plugin is a pre-packaged capability that extends Claude Code's vocabulary."</div>

          <div class="core-code">
            <button class="copy-btn" onclick="copyCode(this, 'plugin := { manifest, commands[], skills[], hooks[], agents[], scripts[] }')">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <code>plugin := { manifest, commands[], skills[], hooks[], agents[], scripts[] }</code>
          </div>

          <div class="core-anchor">That's the grammar. Plugins contain capabilities; capabilities compose with the core.</div>
        </div>

        <p class="text-text-secondary mb-6">
          Think of plugins as vocabulary expansion packs. Claude Code has a base vocabulary (Read, Write, Edit, Bash). Plugins add new words (commands), new instruction sets (skills), new event handlers (hooks), and new specialized workers (agents).
        </p>

        <h3 class="font-semibold text-lg mb-4 mt-8" id="hierarchy">The Hierarchy</h3>

        <div class="hierarchy-diagram">
          <div><strong>Plugin</strong> (container)</div>
          <div class="hierarchy-item">Commands (user-triggered actions)</div>
          <div class="hierarchy-item">Skills (knowledge/instruction sets)</div>
          <div class="hierarchy-item">Hooks (event-driven handlers)</div>
          <div class="hierarchy-item">Agents (specialized workers)</div>
          <div class="hierarchy-item">Scripts (setup/support utilities)</div>
        </div>

        <table class="content-table">
          <thead>
            <tr>
              <th>Primitive</th>
              <th>Nature</th>
              <th>Scope</th>
              <th>Trigger</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Plugin</strong></td>
              <td>Package of capabilities</td>
              <td>Full lifecycle</td>
              <td>Installation</td>
            </tr>
            <tr>
              <td><strong>Skill</strong></td>
              <td>Instruction set</td>
              <td>Single purpose</td>
              <td>Query relevance</td>
            </tr>
            <tr>
              <td><strong>Hook</strong></td>
              <td>Event handler</td>
              <td>Specific event</td>
              <td>Lifecycle event</td>
            </tr>
            <tr>
              <td><strong>Command</strong></td>
              <td>User action</td>
              <td>Atomic task</td>
              <td><code>/command</code></td>
            </tr>
            <tr>
              <td><strong>Agent</strong></td>
              <td>Isolated worker</td>
              <td>Scoped task</td>
              <td>Task tool</td>
            </tr>
            <tr>
              <td><strong>MCP Server</strong></td>
              <td>External tool</td>
              <td>Data/Action bridge</td>
              <td>Tool call</td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- Section 3: DESIGN DECISIONS -->
      <section id="why-manifest" data-activity="decisions">
        <h2 class="section-title">
          <span class="section-number">3</span>
          Design Decisions
        </h2>

        <div class="decision-box">
          <div class="decision-why">WHY A MANIFEST?</div>
          <div class="decision-reasoning">
            The manifest (<code>plugin.json</code>) declares what a plugin contains without requiring Claude to scan directories. It's the contract between plugin and system.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Every capability must be declared in the manifest. If it's not in <code>plugin.json</code>, it doesn't exist to Claude Code. Commands without manifest entries are invisible.
            </div>
          </div>
        </div>

        <div class="decision-box" id="why-hooks">
          <div class="decision-why">WHY LIFECYCLE HOOKS?</div>
          <div class="decision-reasoning">
            Hooks let plugins react to system events without modifying core behavior. PreToolUse, PostToolUse, SessionStart, SessionEnd, Stop - these are the extension points where plugins can inject behavior.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              To extend Claude Code, you don't modify Claude Code. You register hooks that fire at defined lifecycle points. This is the same pattern as browser extensions, VS Code extensions, and Git hooks.
            </div>
          </div>
        </div>

        <div class="decision-box" id="why-composition">
          <div class="decision-why">WHY COMPOSITION RULES?</div>
          <div class="decision-reasoning">
            Without formal composition rules, plugins would conflict unpredictably. The grammar defines how plugins combine with loops, hooks, workers, other plugins, MCP servers, and skills.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Before combining two plugins or a plugin with a pattern, check the composition rules. Plugin + Loop? Plugin + Hook? Plugin + MCP? Each has a defined pattern and known gotchas.
            </div>
          </div>
        </div>
      </section>

      <!-- Section 4: PLUGIN TYPES -->
      <section id="plugin-types" data-activity="types">
        <h2 class="section-title">
          <span class="section-number">4</span>
          Plugin Types Taxonomy
        </h2>

        <p class="text-text-secondary mb-6">
          Plugins fall into 6 categories based on their primary function. Each has a distinct grammar pattern showing how it hooks into Claude Code.
        </p>

        <div class="plugin-type-grid" id="visualization-plugins">
          <div class="plugin-type-card">
            <div class="plugin-type-title">
              <i data-lucide="activity" class="w-5 h-5 text-accent"></i>
              Visualization Plugins
            </div>
            <div class="plugin-type-desc">Extend observability and feedback. Run passively via hooks without modifying workflow.</div>
            <div class="plugin-type-example">hook(PostToolUse) -> render(status)</div>
          </div>

          <div class="plugin-type-card" id="memory-plugins">
            <div class="plugin-type-title">
              <i data-lucide="database" class="w-5 h-5 text-accent"></i>
              Memory Plugins
            </div>
            <div class="plugin-type-desc">Extend persistence and context. Capture via hooks, store externally, inject on session start.</div>
            <div class="plugin-type-example">hook(SessionStart) -> inject(context)</div>
          </div>

          <div class="plugin-type-card" id="workflow-plugins">
            <div class="plugin-type-title">
              <i data-lucide="git-branch" class="w-5 h-5 text-accent"></i>
              Workflow Plugins
            </div>
            <div class="plugin-type-desc">Extend operational patterns. User-initiated via command, spawn agents, verify output.</div>
            <div class="plugin-type-example">command -> orchestrate(agents) -> commit</div>
          </div>

          <div class="plugin-type-card">
            <div class="plugin-type-title">
              <i data-lucide="server" class="w-5 h-5 text-accent"></i>
              Tool Plugins (MCP)
            </div>
            <div class="plugin-type-desc">Extend capabilities through external tools. Configured declaratively, run as separate process.</div>
            <div class="plugin-type-example">configure(settings.json) -> spawn(server)</div>
          </div>

          <div class="plugin-type-card">
            <div class="plugin-type-title">
              <i data-lucide="shield" class="w-5 h-5 text-accent"></i>
              Security Plugins
            </div>
            <div class="plugin-type-desc">Extend safety mechanisms. Intercept before execution, pattern-based analysis, gate-keeping.</div>
            <div class="plugin-type-example">hook(PreToolUse) -> analyze -> allow|block</div>
          </div>

          <div class="plugin-type-card">
            <div class="plugin-type-title">
              <i data-lucide="palette" class="w-5 h-5 text-accent"></i>
              Output Style Plugins
            </div>
            <div class="plugin-type-desc">Extend communication patterns. SessionStart injection, modify response style.</div>
            <div class="plugin-type-example">hook(SessionStart) -> inject(personality)</div>
          </div>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8">Plugin Ecosystem Examples</h3>

        <table class="content-table">
          <thead>
            <tr>
              <th>Plugin</th>
              <th>Category</th>
              <th>Key Feature</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Claude HUD</strong></td>
              <td>Visualization</td>
              <td>Real-time context bar</td>
            </tr>
            <tr>
              <td><strong>Claude-Mem</strong></td>
              <td>Memory</td>
              <td>Persistent semantic memory</td>
            </tr>
            <tr>
              <td><strong>Ralph Wiggum</strong></td>
              <td>Workflow</td>
              <td>Stop hook loop continuation</td>
            </tr>
            <tr>
              <td><strong>Code-Review</strong></td>
              <td>Workflow</td>
              <td>5 parallel review agents</td>
            </tr>
            <tr>
              <td><strong>Security-Guidance</strong></td>
              <td>Security</td>
              <td>PreToolUse vulnerability scan</td>
            </tr>
            <tr>
              <td><strong>Explanatory-Output</strong></td>
              <td>Style</td>
              <td>Educational mode with explanations</td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- Section 5: COMPOSITION RULES -->
      <section id="composition" data-activity="composition">
        <h2 class="section-title">
          <span class="section-number">5</span>
          Plugin Composition Rules
        </h2>

        <p class="text-text-secondary mb-6">
          The grammar defines 6 rules for how plugins compose with other primitives. Each rule has a pattern and known interactions.
        </p>

        <div class="composition-rule">
          <div class="composition-rule-title">Rule 1: Plugin + Loop</div>
          <p class="text-text-secondary text-sm mb-3">Plugins can run within iterative loops (like Ralph).</p>
          <div class="composition-pattern">while-loop(plugin-invoke -> process -> commit)</div>
          <p class="text-text-secondary text-sm mt-3"><strong>Example:</strong> Each Ralph iteration invokes code-simplifier before committing.</p>
        </div>

        <div class="composition-rule">
          <div class="composition-rule-title">Rule 2: Plugin + Hook</div>
          <p class="text-text-secondary text-sm mb-3">Plugins can be triggered by lifecycle hooks.</p>
          <div class="composition-pattern">hook(event) -> plugin-invoke</div>
          <p class="text-text-secondary text-sm mt-3"><strong>Example:</strong> PostToolUse triggers prettier on every Edit.</p>
        </div>

        <div class="composition-rule">
          <div class="composition-rule-title">Rule 3: Plugin + Worker</div>
          <p class="text-text-secondary text-sm mb-3">Plugins provide agents that workers can utilize.</p>
          <div class="composition-pattern">orchestrator -> spawn(worker with plugin-agent)</div>
          <p class="text-text-secondary text-sm mt-3"><strong>Example:</strong> Code-review spawns 5 specialized agents in parallel.</p>
        </div>

        <div class="composition-rule">
          <div class="composition-rule-title">Rule 4: Plugin + Plugin</div>
          <p class="text-text-secondary text-sm mb-3">Plugins can compose with other plugins via output/input chaining.</p>
          <div class="composition-pattern">plugin-A.output -> plugin-B.input</div>
          <p class="text-text-secondary text-sm mt-3"><strong>Example:</strong> claude-mem:recall -> code-review:review -> claude-mem:store</p>
        </div>

        <div class="composition-rule">
          <div class="composition-rule-title">Rule 5: Plugin + MCP</div>
          <p class="text-text-secondary text-sm mb-3">Plugins can leverage MCP servers for external capabilities.</p>
          <div class="composition-pattern">plugin-command -> mcp-tool -> process-result</div>
          <p class="text-text-secondary text-sm mt-3"><strong>Example:</strong> browser-test plugin uses browserbase MCP for screenshots.</p>
        </div>

        <div class="composition-rule">
          <div class="composition-rule-title">Rule 6: Plugin + Skill</div>
          <p class="text-text-secondary text-sm mb-3">Plugins can package and auto-invoke skills based on query matching.</p>
          <div class="composition-pattern">query-match -> skill-load -> guided-execution</div>
          <p class="text-text-secondary text-sm mt-3"><strong>Example:</strong> Frontend-design skill loads automatically on UI work.</p>
        </div>
      </section>

      <!-- Section 6: EXTENSION POINTS -->
      <section id="extension-points" data-activity="extension">
        <h2 class="section-title">
          <span class="section-number">6</span>
          Extension Points
        </h2>

        <p class="text-text-secondary mb-6">
          Claude Code exposes 5 lifecycle hooks where plugins can inject behavior. Each hook provides specific data and enables specific use cases.
        </p>

        <div class="extension-point">
          <div class="extension-point-title">
            <i data-lucide="shield" class="w-5 h-5"></i>
            PreToolUse
          </div>
          <div class="extension-point-purpose">Intercept before tool execution</div>
          <div class="extension-point-cases">
            <strong>Use cases:</strong> Security gates, validation, logging, rate limiting<br>
            <strong>Data available:</strong> <code>$TOOL_NAME</code>, <code>$EVENT_DATA</code><br>
            <strong>Can:</strong> allow, block, modify, warn
          </div>
        </div>

        <div class="extension-point">
          <div class="extension-point-title">
            <i data-lucide="check-circle" class="w-5 h-5"></i>
            PostToolUse
          </div>
          <div class="extension-point-purpose">React after tool execution</div>
          <div class="extension-point-cases">
            <strong>Use cases:</strong> Formatting, linting, notifications, metrics<br>
            <strong>Data available:</strong> <code>$TOOL_NAME</code>, <code>$FILE</code>, <code>$EVENT_DATA</code><br>
            <strong>Can:</strong> transform output, log, notify
          </div>
        </div>

        <div class="extension-point">
          <div class="extension-point-title">
            <i data-lucide="play" class="w-5 h-5"></i>
            SessionStart
          </div>
          <div class="extension-point-purpose">Initialize session state</div>
          <div class="extension-point-cases">
            <strong>Use cases:</strong> Context loading, personality injection, environment setup<br>
            <strong>Can:</strong> inject context, modify behavior, load state
          </div>
        </div>

        <div class="extension-point">
          <div class="extension-point-title">
            <i data-lucide="save" class="w-5 h-5"></i>
            SessionEnd
          </div>
          <div class="extension-point-purpose">Cleanup and persistence</div>
          <div class="extension-point-cases">
            <strong>Use cases:</strong> State saving, summary generation, cleanup<br>
            <strong>Can:</strong> persist state, generate summaries, cleanup temp files
          </div>
        </div>

        <div class="extension-point">
          <div class="extension-point-title">
            <i data-lucide="stop-circle" class="w-5 h-5"></i>
            Stop
          </div>
          <div class="extension-point-purpose">Intercept exit attempts</div>
          <div class="extension-point-cases">
            <strong>Use cases:</strong> Loop continuation (Ralph), completion verification<br>
            <strong>Can:</strong> allow exit, restart with new prompt, continue execution
          </div>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8">Plugin Directory Structure</h3>

        <div class="code-block">
          <button class="copy-btn" onclick="copyCodeBlock(this)">
            <i data-lucide="copy" class="w-3 h-3"></i>
            Copy
          </button>
          <pre>my-plugin/
<span class="comment">├── .claude-plugin/</span>
│   └── plugin.json              <span class="comment"># Manifest (required)</span>
<span class="comment">├── commands/</span>
│   ├── init.md                  <span class="comment"># Initialization command</span>
│   ├── run.md                   <span class="comment"># Main command</span>
│   └── status.md                <span class="comment"># Status check</span>
<span class="comment">├── skills/</span>
│   └── main/
│       └── SKILL.md             <span class="comment"># Primary skill</span>
<span class="comment">├── agents/</span>
│   ├── worker.md                <span class="comment"># Worker agent</span>
│   └── reviewer.md              <span class="comment"># Review agent</span>
<span class="comment">├── hooks/</span>
│   ├── hooks.json               <span class="comment"># Hook configuration</span>
│   └── post-edit.sh             <span class="comment"># Hook scripts</span>
<span class="comment">├── scripts/</span>
│   └── setup.js                 <span class="comment"># Setup scripts</span>
└── templates/
    └── config.json              <span class="comment"># Templates</span></pre>
        </div>
      </section>

      <!-- Section 7: GOTCHAS -->
      <section id="gotchas" data-activity="gotchas">
        <h2 class="section-title">
          <span class="section-number">7</span>
          Gotchas
        </h2>

        <p class="text-text-secondary mb-6">
          Real problems you'll hit when working with plugins, with fixes.
        </p>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Plugin Not Found After Installation
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> <code>/plugin-name:command</code> returns "command not found"</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Marketplace not added, or plugin not properly installed</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Run <code>/plugin marketplace add [author]/[repo]</code>, then <code>/plugin install [name]</code>, then restart session.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Hook Not Firing
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> PostToolUse or PreToolUse hook configured but never executes</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Matcher misconfigured - must match exact tool name (Edit, Write, Bash, Read)</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Test with simple echo first. Check matcher matches exact tool name. Use <code>*</code> for catch-all.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            MCP Server Won't Start
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> MCP tools not appearing, or "server not found" errors</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Missing dependencies, wrong command path, or env vars not set</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Test server manually with <code>npx -y @package/server-name</code>. Verify env vars with <code>echo $VAR_NAME</code>.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Plugin Conflicts
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Two plugins trying to handle the same hook, unexpected behavior</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Multiple plugins registered for same lifecycle event without coordination</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Search for conflicting hooks with <code>grep -r "PostToolUse" ~/.claude/plugins/</code>. Disable one or sequence intentionally.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Skill Not Auto-Loading
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Plugin skill exists but doesn't activate on relevant queries</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Trigger keywords not matching, or skill file missing</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Verify skill has triggers in plugin.json. Test with explicit load: "Load the [skill-name] skill".</div>
        </div>
      </section>

      <!-- Section 8: WHEN TO USE -->
      <section id="when" data-activity="when">
        <h2 class="section-title">
          <span class="section-number">8</span>
          When to Use / When Not
        </h2>

        <div class="when-grid">
          <div class="when-use">
            <div class="when-title">
              <i data-lucide="check" class="w-5 h-5"></i>
              USE PLUGINS WHEN
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Capability is reusable across projects (not one-off)</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Behavior should be consistent regardless of CLAUDE.md</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Need to share capability with team or community</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Capability requires lifecycle hooks (pre/post tool use)</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Want versioning and updates separate from project</span>
            </div>
          </div>

          <div class="when-not">
            <div class="when-title">
              <i data-lucide="x" class="w-5 h-5"></i>
              DON'T USE PLUGINS WHEN
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Project-specific behavior - use CLAUDE.md instead</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>One-time automation - use a shell script instead</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Simple tool access - use MCP server directly</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Experimental/unstable - iterate in CLAUDE.md first</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Only used by you, only on one project - overhead not worth it</span>
            </div>
          </div>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8">Quick Reference: Installation Syntax</h3>

        <div class="code-block">
          <button class="copy-btn" onclick="copyCodeBlock(this)">
            <i data-lucide="copy" class="w-3 h-3"></i>
            Copy
          </button>
          <pre><span class="comment"># Add a marketplace</span>
/plugin marketplace add [author]/[repo]

<span class="comment"># Install from marketplace</span>
/plugin install [plugin-name]@[marketplace-name]

<span class="comment"># Direct CLI installation</span>
claude plugin install [plugin-name]

<span class="comment"># Invoke a plugin command</span>
/[plugin-name]:[command]

<span class="comment"># Natural language invocation</span>
"Use the code simplifier agent to clean up this code"</pre>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8">Quick Reference: Hook Configuration</h3>

        <div class="code-block">
          <button class="copy-btn" onclick="copyCodeBlock(this)">
            <i data-lucide="copy" class="w-3 h-3"></i>
            Copy
          </button>
          <pre>{
  <span class="string">"hooks"</span>: {
    <span class="string">"PostToolUse"</span>: [{
      <span class="string">"matcher"</span>: <span class="string">"Edit"</span>,
      <span class="string">"hooks"</span>: [{
        <span class="string">"type"</span>: <span class="string">"command"</span>,
        <span class="string">"command"</span>: <span class="string">"prettier --write $FILE"</span>
      }]
    }]
  }
}</pre>
        </div>
      </section>

    </main>

    <!-- Resizer -->
    <div class="resizer" data-resizer="activity-zone" aria-label="Resize activity panel"></div>

    <!-- Activity Zone -->
    <aside class="activity-zone" id="activityZone">
      <div class="text-xs font-semibold text-text-muted uppercase tracking-wider mb-4">Operational Intelligence</div>

      <!-- ESSENCE SECTION (3 items) -->
      <div class="activity-item inversion" data-section="essence">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if Claude Code had no extension mechanism?</div>
        <div class="text-text-secondary text-sm">
          <strong>You'd design:</strong> Fork Claude Code for every custom behavior. Maintain your own version.<br>
          <strong>Why this fails:</strong> Updates from Anthropic require manual merging. Custom forks drift and break.<br>
          <strong>Hidden constraint revealed:</strong> Plugins are the contract that lets customization survive upgrades.
        </div>
      </div>

      <div class="activity-item minimal" data-section="essence">
        <div class="activity-label" style="color: #84cc16;">
          <i data-lucide="minimize-2" class="w-4 h-4"></i>
          Minimal Pattern
        </div>
        <div class="font-medium text-text-primary mb-2">The irreducible plugin</div>
        <div class="text-text-secondary text-sm">
          <code style="background: #f4f4f5; padding: 2px 6px; border-radius: 4px; font-size: 12px;">.claude-plugin/plugin.json + commands/run.md</code><br>
          <strong>Essential:</strong> Manifest + one command.<br>
          <strong>Everything else:</strong> Organization and capability expansion.
        </div>
      </div>

      <div class="activity-item analogy" data-section="essence">
        <div class="activity-label" style="color: #d946ef;">
          <i data-lucide="git-compare" class="w-4 h-4"></i>
          Analogical Bridge
        </div>
        <div class="font-medium text-text-primary mb-2">Plugins = VS Code Extensions</div>
        <div class="text-text-secondary text-sm">
          Manifest (plugin.json) = package.json<br>
          Commands = contributes.commands<br>
          Hooks = activation events<br>
          Skills = language services<br><br>
          <em>If you've built VS Code extensions, you already understand Claude Code plugins.</em>
        </div>
      </div>

      <!-- CORE SECTION (4 items) -->
      <div class="activity-item constraint" data-section="core">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="link-2" class="w-4 h-4"></i>
          Constraint Chain
        </div>
        <div class="font-medium text-text-primary mb-2">One primitive hierarchy -> FIVE benefits</div>
        <div class="text-text-secondary text-sm">
          <strong>ROOT:</strong> Plugin contains capabilities in defined hierarchy<br>
          -> Commands provide user-facing entry points<br>
          -> Skills provide domain knowledge injection<br>
          -> Hooks provide lifecycle integration<br>
          -> Agents provide specialized workers<br>
          -> Scripts provide setup automation
        </div>
      </div>

      <div class="activity-item invariant" data-section="core">
        <div class="activity-label" style="color: #3b82f6;">
          <i data-lucide="link" class="w-4 h-4"></i>
          Invariant Connection
        </div>
        <div class="font-medium text-text-primary mb-2">Plugins, MCP, and CLAUDE.md all share INV-002</div>
        <div class="text-text-secondary text-sm">
          <strong>INV-002:</strong> External configuration > internal state<br>
          All three extend Claude Code through external files, not internal modification. The same principle enables all three extension mechanisms.
        </div>
      </div>

      <div class="activity-item expertise" data-section="core">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
          Expertise Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">How deep is your plugin understanding?</div>
        <div class="text-text-secondary text-sm">
          <strong>Beginner:</strong> "What's a plugin?" -> A package of capabilities<br>
          <strong>Intermediate:</strong> "What goes in manifest?" -> Commands, skills, hooks, agents<br>
          <strong>Advanced:</strong> "Why this hierarchy?" -> Each primitive has distinct trigger<br>
          <strong>Staff:</strong> "How do plugins compose?" -> The 6 composition rules<br>
          <strong>Expert:</strong> "When NOT to plugin?" -> Use CLAUDE.md for project-specific
        </div>
      </div>

      <div class="activity-item warstory" data-section="core">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">Jarrod Watts: Claude HUD adoption</div>
        <div class="text-text-secondary text-sm">
          Open source visualization plugin. Shows how community plugins spread: real-time context bar became essential for power users debugging context management issues.
        </div>
      </div>

      <!-- DECISIONS SECTION (4 items) -->
      <div class="activity-item violation" data-section="decisions">
        <div class="activity-label" style="color: #f97316;">
          <i data-lucide="alert-octagon" class="w-4 h-4"></i>
          Violation Chain
        </div>
        <div class="font-medium text-text-primary mb-2">If you skip the manifest</div>
        <div class="text-text-secondary text-sm">
          <strong>IF:</strong> You add commands without manifest entries<br>
          <strong>THEN:</strong> Claude Code doesn't know the command exists<br>
          <strong>THEN:</strong> <code>/plugin:command</code> fails silently<br>
          <strong>THEN:</strong> You debug for hours wondering why<br>
          <strong>FINALLY:</strong> Discovery: manifest is the contract<br><br>
          <em>The fix: Every capability must be declared in plugin.json.</em>
        </div>
      </div>

      <div class="activity-item tradeoff" data-section="decisions">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="scale" class="w-4 h-4"></i>
          Trade-Off Tension
        </div>
        <div class="font-medium text-text-primary mb-2">The Hook Granularity Dilemma</div>
        <div class="text-text-secondary text-sm">
          <strong>Coarse hooks:</strong> Simpler to reason about, but less control<br>
          <strong>Fine hooks:</strong> Precise control, but complex interactions<br>
          <strong>More hooks:</strong> More power, but more conflict potential<br><br>
          <em>Claude Code chose 5 hooks. Enough for most cases, not so many they conflict.</em>
        </div>
      </div>

      <div class="activity-item horizon" data-section="decisions">
        <div class="activity-label" style="color: #06b6d4;">
          <i data-lucide="clock" class="w-4 h-4"></i>
          Time Horizon Shift
        </div>
        <div class="font-medium text-text-primary mb-2">How plugin perception evolves</div>
        <div class="text-text-secondary text-sm">
          <strong>Day 1:</strong> "Plugins seem like overkill"<br>
          <strong>Week 2:</strong> "I keep copying the same CLAUDE.md sections"<br>
          <strong>Month 1:</strong> "This should be a plugin"<br>
          <strong>Month 3:</strong> "My plugin workflow is faster than typing"<br><br>
          <em>Don't judge plugins by day 1. Judge them by month 3.</em>
        </div>
      </div>

      <div class="activity-item inversion" data-section="decisions">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if hooks were untyped?</div>
        <div class="text-text-secondary text-sm">
          <strong>You'd design:</strong> Generic "onEvent" with string matching<br>
          <strong>Why this fails:</strong> No guarantee about available data. Plugins break on version updates.<br>
          <strong>Hidden constraint revealed:</strong> Typed hooks (PreToolUse, PostToolUse, etc.) are the API contract.
        </div>
      </div>

      <!-- TYPES SECTION (4 items) -->
      <div class="activity-item effect" data-section="types">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="bar-chart-2" class="w-4 h-4"></i>
          Second-Order Effect
        </div>
        <div class="font-medium text-text-primary mb-2">Memory plugins compound across sessions</div>
        <div class="text-text-secondary text-sm">
          <strong>At session 1:</strong> Memory plugin has nothing to inject<br>
          <strong>At session 10:</strong> Memory plugin accelerates context setup<br>
          <strong>At session 50:</strong> Memory plugin IS your institutional knowledge<br><br>
          <em>Memory plugins show their value at scale, not at first use.</em>
        </div>
      </div>

      <div class="activity-item composition" data-section="types">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="layers" class="w-4 h-4"></i>
          Composition Case
        </div>
        <div class="font-medium text-text-primary mb-2">Workflow Plugin + Memory Plugin</div>
        <div class="text-text-secondary text-sm">
          <strong>Works:</strong> Memory recalls context before workflow runs.<br>
          <strong>Pattern:</strong> claude-mem:recall -> workflow:execute -> claude-mem:store<br>
          <strong>Danger:</strong> Memory injection bloats context. Keep recall focused.
        </div>
      </div>

      <div class="activity-item gradient" data-section="types">
        <div class="activity-label" style="color: #f43f5e;">
          <i data-lucide="trending-down" class="w-4 h-4"></i>
          Failure Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">How security plugins degrade</div>
        <div class="text-text-secondary text-sm">
          <strong>100%:</strong> Every dangerous operation caught<br>
          <strong>80%:</strong> New patterns slip through<br>
          <strong>50%:</strong> False confidence ("plugin will catch it")<br>
          <strong>CLIFF:</strong> Real attack uses uncovered vector<br><br>
          <em>Security plugins are layers, not guarantees.</em>
        </div>
      </div>

      <div class="activity-item analogy" data-section="types">
        <div class="activity-label" style="color: #d946ef;">
          <i data-lucide="git-compare" class="w-4 h-4"></i>
          Analogical Bridge
        </div>
        <div class="font-medium text-text-primary mb-2">Plugin Types = Infrastructure Layers</div>
        <div class="text-text-secondary text-sm">
          Visualization = Monitoring (Datadog, Prometheus)<br>
          Memory = Database (Postgres, Redis)<br>
          Workflow = Orchestration (Airflow, Temporal)<br>
          Security = Auth/Firewall (OAuth, WAF)<br><br>
          <em>Same separation of concerns, different domain.</em>
        </div>
      </div>

      <!-- COMPOSITION SECTION (5 items) -->
      <div class="activity-item invariant" data-section="composition">
        <div class="activity-label" style="color: #3b82f6;">
          <i data-lucide="link" class="w-4 h-4"></i>
          Invariant Connection
        </div>
        <div class="font-medium text-text-primary mb-2">All 6 rules share INV-006: Explicit over implicit</div>
        <div class="text-text-secondary text-sm">
          Each composition rule requires explicit invocation. Plugins don't magically compose - you declare how they interact. This is the same principle as dependency injection.
        </div>
      </div>

      <div class="activity-item violation" data-section="composition">
        <div class="activity-label" style="color: #f97316;">
          <i data-lucide="alert-octagon" class="w-4 h-4"></i>
          Violation Chain
        </div>
        <div class="font-medium text-text-primary mb-2">If you compose plugins without rules</div>
        <div class="text-text-secondary text-sm">
          <strong>IF:</strong> Two plugins both hook PostToolUse<br>
          <strong>THEN:</strong> Execution order is undefined<br>
          <strong>THEN:</strong> One plugin's output clobbers other's input<br>
          <strong>THEN:</strong> Debugging nightmare ("works sometimes")<br>
          <strong>FINALLY:</strong> Disable one, lose its value<br><br>
          <em>The fix: Sequence hooks intentionally in settings.json</em>
        </div>
      </div>

      <div class="activity-item composition" data-section="composition">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="layers" class="w-4 h-4"></i>
          Composition Case
        </div>
        <div class="font-medium text-text-primary mb-2">Ralph + Code-Review Plugin</div>
        <div class="text-text-secondary text-sm">
          <strong>Works:</strong> Each Ralph iteration runs code-review before commit.<br>
          <strong>Pattern:</strong> implement -> /code-review -> fix-issues -> commit<br>
          <strong>Danger:</strong> Code-review spawns 5 agents. May exceed iteration time budget.
        </div>
      </div>

      <div class="activity-item tradeoff" data-section="composition">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="scale" class="w-4 h-4"></i>
          Trade-Off Tension
        </div>
        <div class="font-medium text-text-primary mb-2">The Plugin Chain Length Dilemma</div>
        <div class="text-text-secondary text-sm">
          <strong>Short chains:</strong> Easy to debug, but limited power<br>
          <strong>Medium chains:</strong> Balanced, but more failure points<br>
          <strong>Long chains:</strong> Maximum capability, but any failure breaks all<br><br>
          <em>Heuristic: If you can't diagram the chain from memory, it's too long.</em>
        </div>
      </div>

      <div class="activity-item frontier" data-section="composition">
        <div class="activity-label" style="color: #ef4444;">
          <i data-lucide="flask-conical" class="w-4 h-4"></i>
          Research Frontier
        </div>
        <div class="font-medium text-text-primary mb-2">UNSOLVED: Plugin dependency management</div>
        <div class="text-text-secondary text-sm">
          <strong>The question:</strong> How should plugin A declare dependency on plugin B?<br>
          <strong>Why it's hard:</strong> Version conflicts, optional dependencies, circular references<br>
          <strong>Current practice:</strong> Document dependencies manually. No automatic resolution.
        </div>
      </div>

      <!-- EXTENSION SECTION (4 items) -->
      <div class="activity-item constraint" data-section="extension">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="link-2" class="w-4 h-4"></i>
          Constraint Chain
        </div>
        <div class="font-medium text-text-primary mb-2">5 hooks -> Complete lifecycle coverage</div>
        <div class="text-text-secondary text-sm">
          <strong>ROOT:</strong> Claude Code has predictable lifecycle<br>
          -> PreToolUse: Before action (security, validation)<br>
          -> PostToolUse: After action (formatting, metrics)<br>
          -> SessionStart: Context setup (memory injection)<br>
          -> SessionEnd: Context persistence (state saving)<br>
          -> Stop: Exit control (loop continuation)
        </div>
      </div>

      <div class="activity-item inflection" data-section="extension">
        <div class="activity-label" style="color: #eab308;">
          <i data-lucide="activity" class="w-4 h-4"></i>
          Inflection Point
        </div>
        <div class="font-medium text-text-primary mb-2">When hooks flip from help to overhead</div>
        <div class="text-text-secondary text-sm">
          <strong>0-3 hooks:</strong> Pure benefit (targeted enhancement)<br>
          <strong>4-6 hooks:</strong> Diminishing returns (interaction complexity)<br>
          <strong>7+ hooks:</strong> Net negative (debugging exceeds value)<br><br>
          <strong>THE INFLECTION:</strong> ~5 active hooks per session<br>
          <em>Detection: If you're debugging hook interactions, you've crossed it.</em>
        </div>
      </div>

      <div class="activity-item expertise" data-section="extension">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
          Expertise Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">Hook understanding depth</div>
        <div class="text-text-secondary text-sm">
          <strong>Beginner:</strong> "What's a hook?" -> Event handler<br>
          <strong>Intermediate:</strong> "Which hook for X?" -> Pre vs Post vs Session<br>
          <strong>Advanced:</strong> "How to debug hooks?" -> Echo commands, check matchers<br>
          <strong>Staff:</strong> "How to sequence hooks?" -> Array order in settings.json<br>
          <strong>Expert:</strong> "Hook vs MCP?" -> Hooks for lifecycle, MCP for tools
        </div>
      </div>

      <div class="activity-item warstory" data-section="extension">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">Ralph's Stop hook: The key innovation</div>
        <div class="text-text-secondary text-sm">
          Matt Pocock's Ralph pattern depends on Stop hook to prevent Claude from exiting. Without this hook, autonomous loops would be impossible. The Stop hook enables "check completion, restart if not done."
        </div>
      </div>

      <!-- GOTCHAS SECTION (3 items) -->
      <div class="activity-item inversion" data-section="gotchas">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">Why exact matcher names?</div>
        <div class="text-text-secondary text-sm">
          <strong>What if matchers were fuzzy?</strong><br>
          "edit" matching "Edit", "EDIT", "editor"... Hook fires on unintended tools. Chaos.<br>
          <strong>Hidden constraint:</strong> Exact matching prevents accidental interception. The strictness is a feature.
        </div>
      </div>

      <div class="activity-item violation" data-section="gotchas">
        <div class="activity-label" style="color: #f97316;">
          <i data-lucide="alert-octagon" class="w-4 h-4"></i>
          Violation Chain
        </div>
        <div class="font-medium text-text-primary mb-2">If you don't test server manually</div>
        <div class="text-text-secondary text-sm">
          <strong>IF:</strong> Configure MCP server without testing<br>
          <strong>THEN:</strong> "Server not found" at runtime<br>
          <strong>THEN:</strong> Debug settings.json for hours<br>
          <strong>THEN:</strong> Discover: missing npx package<br>
          <strong>FINALLY:</strong> One manual test would have caught it<br><br>
          <em>The fix: Always <code>npx -y @package/server</code> before configuring.</em>
        </div>
      </div>

      <div class="activity-item horizon" data-section="gotchas">
        <div class="activity-label" style="color: #06b6d4;">
          <i data-lucide="clock" class="w-4 h-4"></i>
          Time Horizon Shift
        </div>
        <div class="font-medium text-text-primary mb-2">Plugin conflict perception over time</div>
        <div class="text-text-secondary text-sm">
          <strong>Plugin 1:</strong> "Everything works!"<br>
          <strong>Plugin 3:</strong> "Weird intermittent failures..."<br>
          <strong>Plugin 5:</strong> "Something's definitely conflicting"<br>
          <strong>Plugin 7:</strong> "I need to audit all my hooks"<br><br>
          <em>The more plugins, the more conflict potential. Audit early.</em>
        </div>
      </div>

      <!-- WHEN SECTION (4 items) -->
      <div class="activity-item alternative" data-section="when">
        <div class="activity-label" style="color: #6b7280;">
          <i data-lucide="arrow-right" class="w-4 h-4"></i>
          Alternative Paths
        </div>
        <div class="font-medium text-text-primary mb-2">If plugins aren't right for your use case</div>
        <div class="text-text-secondary text-sm">
          <strong>Project-specific behavior?</strong> -> CLAUDE.md<br>
          <strong>External tool access?</strong> -> MCP server directly<br>
          <strong>One-time automation?</strong> -> Shell script<br>
          <strong>Team knowledge?</strong> -> Shared CLAUDE.md in repo
        </div>
      </div>

      <div class="activity-item tradeoff" data-section="when">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="scale" class="w-4 h-4"></i>
          Trade-Off Tension
        </div>
        <div class="font-medium text-text-primary mb-2">Plugin vs CLAUDE.md</div>
        <div class="text-text-secondary text-sm">
          <strong>Plugin:</strong> Portable, versioned, but overhead to create<br>
          <strong>CLAUDE.md:</strong> Fast to write, project-local, but not shareable<br><br>
          <em>Heuristic: If you'd use it in 3+ projects, make it a plugin. Otherwise, CLAUDE.md.</em>
        </div>
      </div>

      <div class="activity-item effect" data-section="when">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="bar-chart-2" class="w-4 h-4"></i>
          Second-Order Effect
        </div>
        <div class="font-medium text-text-primary mb-2">Plugin ecosystem network effects</div>
        <div class="text-text-secondary text-sm">
          <strong>At 10 plugins:</strong> Each solves isolated problem<br>
          <strong>At 100 plugins:</strong> Plugins compose with each other<br>
          <strong>At 1000 plugins:</strong> Ecosystem becomes self-reinforcing<br><br>
          <em>Sharing plugins creates value beyond personal use.</em>
        </div>
      </div>

      <div class="activity-item analogy" data-section="when">
        <div class="activity-label" style="color: #d946ef;">
          <i data-lucide="git-compare" class="w-4 h-4"></i>
          Analogical Bridge
        </div>
        <div class="font-medium text-text-primary mb-2">Decision Heuristic = npm publish</div>
        <div class="text-text-secondary text-sm">
          Would you publish this as an npm package?<br>
          <strong>No:</strong> Too project-specific -> CLAUDE.md<br>
          <strong>Maybe:</strong> Useful but niche -> Local plugin<br>
          <strong>Yes:</strong> Generally useful -> Marketplace plugin<br><br>
          <em>Same bar: Is this valuable to others?</em>
        </div>
      </div>

    </aside>
  </div>

  <script>
    /**
     * PanelResizer - Handles draggable panel dividers
     */
    class PanelResizer {
      constructor(resizerEl, config = {}) {
        this.resizer = resizerEl;
        this.config = {
          storageKey: 'panel-activity-zone-width',
          minWidth: 280,
          maxWidth: 900,
          defaultWidth: 480,
          ...config
        };

        this.isResizing = false;
        this.startX = 0;
        this.startWidth = 0;

        this.activityZone = document.querySelector('.activity-zone');
        this.mainContent = document.querySelector('.main-content');

        this.onMouseDown = this.onMouseDown.bind(this);
        this.onMouseMove = this.onMouseMove.bind(this);
        this.onMouseUp = this.onMouseUp.bind(this);

        this.init();
      }

      init() {
        this.restoreWidth();
        this.resizer.addEventListener('mousedown', this.onMouseDown);
      }

      onMouseDown(e) {
        if (e.button !== 0) return;

        this.isResizing = true;
        this.startX = e.clientX;
        this.startWidth = this.activityZone.offsetWidth;

        this.resizer.classList.add('active');
        document.body.classList.add('resizing');

        document.addEventListener('mousemove', this.onMouseMove);
        document.addEventListener('mouseup', this.onMouseUp);

        e.preventDefault();
      }

      onMouseMove(e) {
        if (!this.isResizing) return;

        const delta = this.startX - e.clientX;
        const newWidth = this.startWidth + delta;

        const constrainedWidth = Math.max(
          this.config.minWidth,
          Math.min(this.config.maxWidth, newWidth)
        );

        this.activityZone.style.width = constrainedWidth + 'px';
        this.mainContent.style.marginRight = constrainedWidth + 'px';
        this.resizer.style.right = constrainedWidth + 'px';
      }

      onMouseUp(e) {
        if (!this.isResizing) return;

        this.isResizing = false;

        this.resizer.classList.remove('active');
        document.body.classList.remove('resizing');

        document.removeEventListener('mousemove', this.onMouseMove);
        document.removeEventListener('mouseup', this.onMouseUp);

        this.saveWidth();
      }

      saveWidth() {
        const width = this.activityZone.offsetWidth;
        localStorage.setItem(this.config.storageKey, JSON.stringify({
          width,
          timestamp: Date.now()
        }));
      }

      restoreWidth() {
        try {
          const stored = localStorage.getItem(this.config.storageKey);
          if (stored) {
            const { width } = JSON.parse(stored);
            if (width >= this.config.minWidth && width <= this.config.maxWidth) {
              this.activityZone.style.width = width + 'px';
              this.mainContent.style.marginRight = width + 'px';
              this.resizer.style.right = width + 'px';
            }
          }
        } catch (e) {
          console.warn('Failed to restore panel width:', e);
        }
      }

      destroy() {
        this.resizer.removeEventListener('mousedown', this.onMouseDown);
        document.removeEventListener('mousemove', this.onMouseMove);
        document.removeEventListener('mouseup', this.onMouseUp);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      const resizers = document.querySelectorAll('[data-resizer]');
      resizers.forEach(resizer => new PanelResizer(resizer));
    });

    // Initialize Lucide icons
    lucide.createIcons();

    // Navigation toggle
    function toggleSection(header) {
      const section = header.closest('.nav-section');
      section.classList.toggle('expanded');
      const children = section.querySelector('.nav-children');
      children.classList.toggle('expanded');
    }

    // Mobile menu toggle
    function toggleMobileMenu() {
      const nav = document.getElementById('leftNav');
      nav.classList.toggle('open');
    }

    // Copy functionality
    function copyCode(btn, text) {
      navigator.clipboard.writeText(text).then(() => {
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i data-lucide="check" class="w-3 h-3"></i> Copied!';
        lucide.createIcons();
        setTimeout(() => {
          btn.innerHTML = originalText;
          lucide.createIcons();
        }, 2000);
      });
    }

    function copyCodeBlock(btn) {
      const codeBlock = btn.closest('.code-block');
      const pre = codeBlock.querySelector('pre');
      const text = pre.textContent;
      copyCode(btn, text);
    }

    // Scroll-sync with GSAP ScrollTrigger
    gsap.registerPlugin(ScrollTrigger);

    const sections = document.querySelectorAll('[data-activity]');
    const activityItems = document.querySelectorAll('.activity-item');

    sections.forEach(section => {
      ScrollTrigger.create({
        trigger: section,
        start: 'top 40%',
        end: 'bottom 40%',
        onEnter: () => activateSection(section.dataset.activity),
        onEnterBack: () => activateSection(section.dataset.activity),
      });
    });

    function activateSection(sectionName) {
      activityItems.forEach(item => {
        if (item.dataset.section === sectionName) {
          item.classList.add('active');
          gsap.to(item, {
            opacity: 1,
            y: -2,
            boxShadow: '0 4px 12px rgba(0,0,0,0.08)',
            duration: 0.3,
            ease: 'power2.out'
          });
        } else {
          item.classList.remove('active');
          gsap.to(item, {
            opacity: 0.5,
            y: 0,
            boxShadow: 'none',
            duration: 0.3,
            ease: 'power2.out'
          });
        }
      });

      document.querySelectorAll('.nav-section-header').forEach(header => {
        header.classList.remove('active');
      });
      const activeNav = document.querySelector(`[data-section="${sectionName}"] .nav-section-header`);
      if (activeNav) {
        activeNav.classList.add('active');
      }
    }

    // Initialize first section as active
    activateSection('essence');

    // Smooth scroll for nav links
    document.querySelectorAll('.nav-item').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const target = document.querySelector(link.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          document.querySelectorAll('.nav-item').forEach(l => l.classList.remove('active'));
          link.classList.add('active');
        }
      });
    });

    // Brushing interaction
    activityItems.forEach(item => {
      item.addEventListener('mouseenter', () => {
        const sectionName = item.dataset.section;
        const relatedSection = document.querySelector(`[data-activity="${sectionName}"]`);
        if (relatedSection) {
          relatedSection.style.backgroundColor = 'rgba(13, 147, 115, 0.05)';
          relatedSection.style.transition = 'background-color 0.3s ease';
        }
      });

      item.addEventListener('mouseleave', () => {
        const sectionName = item.dataset.section;
        const relatedSection = document.querySelector(`[data-activity="${sectionName}"]`);
        if (relatedSection) {
          relatedSection.style.backgroundColor = '';
        }
      });
    });
  </script>
</body>
</html>
