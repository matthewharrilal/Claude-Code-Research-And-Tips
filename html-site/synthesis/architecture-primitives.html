<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent Pattern Primitives | Claude Code Documentation</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Lucide Icons CDN -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- GSAP for scroll-sync -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

  <!-- Tailwind Config with Design Tokens -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'bg-base': '#ffffff',
            'bg-subtle': '#fafafa',
            'bg-muted': '#f4f4f5',
            'text-primary': '#18181b',
            'text-secondary': '#3f3f46',
            'text-muted': '#71717a',
            'accent': '#0D9373',
            'accent-light': '#10b981',
            'accent-bg': '#ecfdf5',
            'border': '#e4e4e7',
            // Activity Zone content type colors (Original 6)
            'az-invariant': '#3b82f6',    // Blue
            'az-effect': '#f59e0b',       // Amber
            'az-composition': '#8b5cf6',  // Purple
            'az-frontier': '#ef4444',     // Red
            'az-warstory': '#10b981',     // Green
            'az-alternative': '#6b7280',  // Gray
            // Activity Zone generative content types (New 10)
            'az-inversion': '#4f46e5',    // Indigo
            'az-constraint': '#8b5cf6',   // Violet
            'az-gradient': '#f43f5e',     // Rose
            'az-horizon': '#06b6d4',      // Cyan
            'az-violation': '#f97316',    // Orange
            'az-tradeoff': '#f59e0b',     // Amber
            'az-analogy': '#d946ef',      // Fuchsia
            'az-expertise': '#10b981',    // Emerald
            'az-minimal': '#84cc16',      // Lime
            'az-inflection': '#eab308',   // Yellow
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
            mono: ['Fira Code', 'monospace'],
          },
        },
      },
    }
  </script>

  <style>
    /* Base Styles */
    * {
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
      scroll-padding-top: 80px;
    }

    [id] {
      scroll-margin-top: 80px;
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: #ffffff;
      color: #18181b;
      line-height: 1.7;
    }

    /* Three Panel Layout */
    .three-panel-layout {
      min-height: 100vh;
      position: relative;
    }

    /* Header */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 56px;
      background: #ffffff;
      border-bottom: 1px solid #e4e4e7;
      z-index: 100;
      display: flex;
      align-items: center;
      padding: 0 24px;
    }

    /* Left Navigation - 240px fixed */
    .left-nav {
      position: fixed;
      top: 56px;
      left: 0;
      width: 240px;
      height: calc(100vh - 56px);
      border-right: 1px solid #e4e4e7;
      background: #ffffff;
      overflow-y: auto;
      padding: 16px 0;
      z-index: 40;
    }

    .nav-section {
      padding: 0 12px;
      margin-bottom: 8px;
    }

    .nav-section-header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      font-size: 14px;
      font-weight: 500;
      color: #3f3f46;
      cursor: pointer;
      border-radius: 6px;
      transition: background 0.15s;
    }

    .nav-section-header:hover {
      background: #f4f4f5;
    }

    .nav-section-header.active {
      color: #0D9373;
      background: #ecfdf5;
    }

    .nav-item {
      display: block;
      padding: 6px 12px 6px 44px;
      font-size: 14px;
      color: #71717a;
      text-decoration: none;
      border-radius: 6px;
      transition: all 0.15s;
    }

    .nav-item:hover {
      color: #3f3f46;
      background: #f4f4f5;
    }

    .nav-item.active {
      color: #0D9373;
      background: #ecfdf5;
    }

    .nav-children {
      display: none;
      overflow: hidden;
    }

    .nav-children.expanded {
      display: block;
    }

    .nav-chevron {
      transition: transform 0.2s;
    }

    .nav-section.expanded .nav-chevron {
      transform: rotate(90deg);
    }

    /* Main Content - Flexible, margins for fixed sidebars */
    .main-content {
      margin-left: 240px;
      margin-right: 480px;
      margin-top: 56px;
      padding: 48px 48px;
      min-width: 400px;
    }

    /* Activity Zone - 480px fixed */
    .activity-zone {
      position: fixed;
      top: 56px;
      right: 0;
      width: 480px;
      height: calc(100vh - 56px);
      border-left: 1px dashed #e4e4e7;
      background: #fafafa;
      overflow-y: auto;
      padding: 24px 20px;
      z-index: 40;
    }

    /* Responsive: Hide Activity Zone below 1400px */
    @media (max-width: 1400px) {
      .activity-zone {
        display: none;
      }
      .main-content {
        margin-right: 0;
        padding: 40px 32px;
      }
    }

    /* Responsive: Hide Left Nav below 768px */
    @media (max-width: 768px) {
      .left-nav {
        display: none;
      }
      .left-nav.open {
        display: block;
        position: fixed;
        top: 56px;
        left: 0;
        right: 0;
        bottom: 0;
        background: #ffffff;
        z-index: 50;
        overflow-y: auto;
      }
      .main-content {
        margin-left: 0;
        padding: 24px 16px;
        min-width: auto;
      }
    }

    /* Resizer */
    .resizer {
      position: fixed;
      top: 56px;
      right: 480px;
      width: 6px;
      height: calc(100vh - 56px);
      cursor: col-resize;
      background: transparent;
      z-index: 50;
      transition: background 0.15s ease;
    }

    .resizer:hover {
      background: rgba(13, 147, 115, 0.15);
    }

    .resizer.active {
      background: rgba(13, 147, 115, 0.25);
    }

    body.resizing {
      user-select: none;
      cursor: col-resize !important;
    }

    body.resizing * {
      cursor: col-resize !important;
    }

    @media (max-width: 1400px) {
      .resizer {
        display: none;
      }
    }

    /* Activity Zone Items */
    .activity-item {
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      background: #ffffff;
      border: 1px solid #e4e4e7;
      font-size: 14px;
      line-height: 1.6;
      opacity: 0.5;
      transition: all 0.3s ease;
    }

    .activity-item.active {
      opacity: 1;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .activity-item:hover {
      opacity: 1;
    }

    .activity-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    /* Activity Zone content type borders (Original 6) */
    .activity-item.invariant { border-left: 4px solid #3b82f6; }
    .activity-item.effect { border-left: 4px solid #f59e0b; }
    .activity-item.composition { border-left: 4px solid #8b5cf6; }
    .activity-item.frontier { border-left: 4px solid #ef4444; }
    .activity-item.warstory { border-left: 4px solid #10b981; }
    .activity-item.alternative { border-left: 4px solid #6b7280; }

    /* Activity Zone generative content types (New 10) */
    .activity-item.inversion { border-left: 4px solid #4f46e5; }
    .activity-item.constraint { border-left: 4px solid #8b5cf6; }
    .activity-item.gradient { border-left: 4px solid #f43f5e; }
    .activity-item.horizon { border-left: 4px solid #06b6d4; }
    .activity-item.violation { border-left: 4px solid #f97316; }
    .activity-item.tradeoff { border-left: 4px solid #f59e0b; }
    .activity-item.analogy { border-left: 4px solid #d946ef; }
    .activity-item.expertise { border-left: 4px solid #10b981; }
    .activity-item.minimal { border-left: 4px solid #84cc16; }
    .activity-item.inflection { border-left: 4px solid #eab308; }

    /* Main Content Components */

    /* Section titles with number */
    .section-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      background: #0D9373;
      color: #ffffff;
      font-size: 14px;
      font-weight: 600;
      border-radius: 50%;
      margin-right: 12px;
    }

    .section-title {
      font-size: 24px;
      font-weight: 600;
      color: #18181b;
      margin-bottom: 20px;
      margin-top: 56px;
      display: flex;
      align-items: center;
    }

    .section-title:first-child {
      margin-top: 0;
    }

    /* Essence Box (15 words) */
    .essence-box {
      background: linear-gradient(135deg, #18181b 0%, #27272a 100%);
      border-radius: 12px;
      padding: 32px;
      margin-bottom: 40px;
    }

    .essence-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #10b981;
      margin-bottom: 12px;
    }

    .essence-text {
      font-size: 22px;
      font-weight: 500;
      color: #ffffff;
      line-height: 1.4;
    }

    /* Core Abstraction Box */
    .core-abstraction {
      background: #fafafa;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 40px;
    }

    .core-philosophy {
      font-size: 16px;
      color: #3f3f46;
      margin-bottom: 16px;
      font-style: italic;
    }

    .core-code {
      background: #18181b;
      border-radius: 8px;
      padding: 16px 20px;
      margin-bottom: 16px;
      overflow-x: auto;
    }

    .core-code code {
      font-family: 'Fira Code', monospace;
      font-size: 15px;
      color: #10b981;
      white-space: nowrap;
    }

    .core-anchor {
      font-size: 14px;
      color: #71717a;
      text-align: center;
    }

    /* Design Decision Box */
    .decision-box {
      background: #ffffff;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
    }

    .decision-why {
      font-size: 16px;
      font-weight: 600;
      color: #0D9373;
      margin-bottom: 12px;
    }

    .decision-reasoning {
      font-size: 14px;
      color: #3f3f46;
      margin-bottom: 16px;
    }

    .decision-implication {
      background: #f4f4f5;
      border-radius: 8px;
      padding: 16px;
    }

    .decision-implication-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      color: #71717a;
      margin-bottom: 8px;
    }

    /* Code Blocks */
    .code-block {
      background: #18181b;
      border-radius: 8px;
      padding: 16px 20px;
      margin-bottom: 24px;
      position: relative;
      overflow-x: auto;
    }

    .code-block pre {
      margin: 0;
      font-family: 'Fira Code', monospace;
      font-size: 13px;
      color: #e4e4e7;
      line-height: 1.6;
    }

    .code-block .comment { color: #6b7280; }
    .code-block .keyword { color: #c084fc; }
    .code-block .string { color: #10b981; }
    .code-block .variable { color: #60a5fa; }

    .copy-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: #3f3f46;
      color: #ffffff;
      border: none;
      border-radius: 4px;
      padding: 6px 10px;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: background 0.15s;
    }

    .copy-btn:hover {
      background: #52525b;
    }

    /* Path Steps */
    .path-container {
      background: #fafafa;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 40px;
    }

    .path-step {
      display: flex;
      gap: 16px;
      margin-bottom: 16px;
    }

    .path-step:last-child {
      margin-bottom: 0;
    }

    .path-number {
      flex-shrink: 0;
      width: 24px;
      height: 24px;
      background: #0D9373;
      color: #ffffff;
      font-size: 12px;
      font-weight: 600;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .path-content {
      flex: 1;
      font-size: 14px;
      color: #3f3f46;
    }

    .path-content code {
      background: #e4e4e7;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 13px;
    }

    /* Gotcha Box */
    .gotcha-box {
      background: #fffbeb;
      border: 1px solid #fcd34d;
      border-left: 4px solid #f59e0b;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .gotcha-title {
      font-weight: 600;
      color: #92400e;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .gotcha-detail {
      font-size: 14px;
      color: #78350f;
      margin-bottom: 8px;
    }

    .gotcha-detail strong {
      color: #92400e;
    }

    /* What's Hard Box */
    .hard-box {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-left: 4px solid #ef4444;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .hard-title {
      font-weight: 600;
      color: #991b1b;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .hard-detail {
      font-size: 14px;
      color: #7f1d1d;
      margin-bottom: 8px;
    }

    /* When To Use Grid */
    .when-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 40px;
    }

    @media (max-width: 900px) {
      .when-grid {
        grid-template-columns: 1fr;
      }
    }

    .when-use {
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      border-radius: 12px;
      padding: 24px;
    }

    .when-not {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: 12px;
      padding: 24px;
    }

    .when-title {
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .when-use .when-title { color: #166534; }
    .when-not .when-title { color: #991b1b; }

    .when-item {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      font-size: 14px;
    }

    .when-use .when-item { color: #166534; }
    .when-not .when-item { color: #991b1b; }

    /* Primitive Card */
    .primitive-card {
      background: #ffffff;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .primitive-name {
      font-size: 18px;
      font-weight: 600;
      color: #18181b;
      margin-bottom: 12px;
    }

    .primitive-description {
      font-size: 14px;
      color: #3f3f46;
      margin-bottom: 16px;
    }

    .primitive-properties {
      background: #f4f4f5;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .primitive-properties-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      color: #71717a;
      margin-bottom: 8px;
    }

    .primitive-used-in {
      font-size: 13px;
      color: #71717a;
    }

    .primitive-used-in span {
      background: #ecfdf5;
      color: #0D9373;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 12px;
      margin-left: 4px;
    }

    /* Composition Diagram */
    .composition-diagram {
      background: #18181b;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      overflow-x: auto;
    }

    .composition-diagram pre {
      font-family: 'Fira Code', monospace;
      font-size: 12px;
      color: #e4e4e7;
      line-height: 1.4;
      margin: 0;
    }

    /* Table */
    .primitive-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 24px;
    }

    .primitive-table th {
      background: #f4f4f5;
      padding: 12px 16px;
      text-align: left;
      font-size: 13px;
      font-weight: 600;
      color: #3f3f46;
      border-bottom: 1px solid #e4e4e7;
    }

    .primitive-table td {
      padding: 12px 16px;
      font-size: 14px;
      color: #3f3f46;
      border-bottom: 1px solid #e4e4e7;
    }

    .primitive-table code {
      background: #e4e4e7;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 12px;
    }

    /* Mobile Menu Button */
    .mobile-menu-btn {
      display: none;
      padding: 8px;
      background: none;
      border: none;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .mobile-menu-btn {
        display: flex;
      }
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: #fafafa;
    }

    ::-webkit-scrollbar-thumb {
      background: #d4d4d8;
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #a1a1aa;
    }

    /* Keyboard shortcut hint */
    .kbd {
      display: inline-flex;
      align-items: center;
      padding: 2px 6px;
      background: #f4f4f5;
      border: 1px solid #e4e4e7;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 12px;
      color: #71717a;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle menu">
      <i data-lucide="menu" class="w-5 h-5 text-text-secondary"></i>
    </button>
    <div class="flex items-center gap-3">
      <i data-lucide="terminal" class="w-5 h-5 text-accent"></i>
      <span class="font-semibold text-text-primary">Claude Code</span>
    </div>
    <div class="flex-1 flex justify-center">
      <button class="flex items-center gap-2 px-4 py-2 bg-bg-muted rounded-lg text-text-muted text-sm hover:bg-border transition-colors">
        <i data-lucide="search" class="w-4 h-4"></i>
        <span>Search documentation...</span>
        <span class="kbd">Cmd+K</span>
      </button>
    </div>
    <div class="flex items-center gap-4">
      <a href="#" class="text-sm text-text-muted hover:text-text-primary transition-colors">Support</a>
      <button class="p-2 hover:bg-bg-muted rounded-lg transition-colors" aria-label="Toggle theme">
        <i data-lucide="sun" class="w-4 h-4 text-text-muted"></i>
      </button>
    </div>
  </header>

  <div class="three-panel-layout">
    <!-- Left Navigation -->
    <nav class="left-nav" id="leftNav">
      <div class="px-4 mb-4">
        <span class="text-xs font-semibold text-text-muted uppercase tracking-wider">Agent Primitives</span>
      </div>

      <!-- Essence -->
      <div class="nav-section expanded" data-section="essence">
        <div class="nav-section-header active" onclick="toggleSection(this)">
          <i data-lucide="zap" class="w-4 h-4"></i>
          <span>Essence</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#essence" class="nav-item active">The 15-Word Summary</a>
        </div>
      </div>

      <!-- Core Abstraction -->
      <div class="nav-section expanded" data-section="core">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="box" class="w-4 h-4"></i>
          <span>Core Abstraction</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#core-abstraction" class="nav-item">The LEGO Bricks</a>
        </div>
      </div>

      <!-- Primitives Catalog -->
      <div class="nav-section expanded" data-section="primitives">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="layers" class="w-4 h-4"></i>
          <span>Primitives Catalog</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children expanded">
          <a href="#loop-primitives" class="nav-item">Loop Primitives</a>
          <a href="#state-primitives" class="nav-item">State Primitives</a>
          <a href="#control-primitives" class="nav-item">Control Primitives</a>
          <a href="#quality-primitives" class="nav-item">Quality Gates</a>
          <a href="#coordination-primitives" class="nav-item">Coordination</a>
          <a href="#memory-primitives" class="nav-item">Memory</a>
          <a href="#hook-primitives" class="nav-item">Hooks</a>
        </div>
      </div>

      <!-- Composition -->
      <div class="nav-section" data-section="composition">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="git-merge" class="w-4 h-4"></i>
          <span>Composition</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#composition" class="nav-item">How Primitives Combine</a>
        </div>
      </div>

      <!-- Gotchas -->
      <div class="nav-section" data-section="gotchas">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="alert-triangle" class="w-4 h-4"></i>
          <span>Gotchas</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#gotchas" class="nav-item">Practical Problems</a>
        </div>
      </div>

      <!-- What's Hard -->
      <div class="nav-section" data-section="hard">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="flame" class="w-4 h-4"></i>
          <span>What's Hard</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#hard" class="nav-item">Real Complexity</a>
        </div>
      </div>

      <!-- When to Use -->
      <div class="nav-section" data-section="when">
        <div class="nav-section-header" onclick="toggleSection(this)">
          <i data-lucide="check-circle" class="w-4 h-4"></i>
          <span>When to Use</span>
          <i data-lucide="chevron-right" class="w-4 h-4 nav-chevron ml-auto"></i>
        </div>
        <div class="nav-children">
          <a href="#when" class="nav-item">Selection Guide</a>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">

      <!-- Section 1: ESSENCE -->
      <section id="essence" data-activity="essence">
        <div class="essence-box">
          <div class="essence-label">Essence (15 words)</div>
          <div class="essence-text">Primitives are reusable atomic building blocks that compose into Ralph, Gas Town, and CC Mirror.</div>
        </div>

        <p class="text-text-secondary mb-6">
          <strong>You Are Here:</strong> This is the atomic building block catalog - the LEGO bricks that compose all orchestration patterns. Read this first to understand the individual pieces, then see <code>architecture-composition-rules.md</code> for how they combine into complete patterns.
        </p>
      </section>

      <!-- Section 2: CORE ABSTRACTION -->
      <section id="core-abstraction" data-activity="core">
        <h2 class="section-title">
          <span class="section-number">2</span>
          The Core Abstraction
        </h2>

        <div class="core-abstraction">
          <div class="core-philosophy">"Complex patterns emerge from simple primitives in predictable combinations."</div>

          <div class="core-code">
            <button class="copy-btn" onclick="copyCode(this, 'Primitive + Primitive + ... = Pattern')">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <code>Loop + State + Control + Quality Gate = Ralph</code>
          </div>

          <div class="core-anchor">Every agent pattern is a specific combination of these primitives. Master the primitives, master any pattern.</div>
        </div>

        <p class="text-text-secondary mb-6">
          The agent orchestration landscape looks complex: Ralph, Gas Town, CC Mirror, Panopticon, Orchestra. But underneath, they're all built from the same building blocks. Learn to see these primitives and you can:
        </p>

        <ul class="list-disc list-inside text-text-secondary mb-6 space-y-2">
          <li>Understand any new pattern quickly (decompose it)</li>
          <li>Build custom patterns for your needs (compose them)</li>
          <li>Debug failures systematically (trace to primitive)</li>
          <li>Predict behavior at scale (know primitive limits)</li>
        </ul>

        <h3 class="font-semibold text-lg mb-4">The Seven Primitive Categories</h3>

        <table class="primitive-table">
          <thead>
            <tr>
              <th>Category</th>
              <th>What It Does</th>
              <th>Example</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Loop</strong></td>
              <td>Drives iteration cycles</td>
              <td><code>while :; do claude; done</code></td>
            </tr>
            <tr>
              <td><strong>State</strong></td>
              <td>Persists across iterations</td>
              <td><code>prd.json</code>, <code>progress.txt</code></td>
            </tr>
            <tr>
              <td><strong>Control</strong></td>
              <td>Determines when to stop</td>
              <td>Promise/Stop condition</td>
            </tr>
            <tr>
              <td><strong>Quality Gate</strong></td>
              <td>Verifies before marking done</td>
              <td><code>npm run typecheck</code></td>
            </tr>
            <tr>
              <td><strong>Coordination</strong></td>
              <td>Manages multi-agent work</td>
              <td>TaskCreate, Worker Preamble</td>
            </tr>
            <tr>
              <td><strong>Memory</strong></td>
              <td>Cross-iteration learning</td>
              <td>Git, AGENTS.md, filesystem</td>
            </tr>
            <tr>
              <td><strong>Hook</strong></td>
              <td>Intercepts tool execution</td>
              <td>PreToolUse, PostToolUse</td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- Section 3: PRIMITIVES CATALOG -->
      <section id="loop-primitives" data-activity="primitives">
        <h2 class="section-title">
          <span class="section-number">3</span>
          Primitives Catalog
        </h2>

        <h3 class="font-semibold text-lg mb-4">Loop Primitives</h3>

        <div class="primitive-card">
          <div class="primitive-name">Basic While Loop</div>
          <div class="primitive-description">Infinite loop that continuously spawns fresh Claude sessions with the same prompt. Each iteration gets a fresh context window, no memory between iterations.</div>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre><span class="keyword">while</span> :; <span class="keyword">do</span>
  cat prompt.md | claude
<span class="keyword">done</span></pre>
          </div>
          <div class="primitive-properties">
            <div class="primitive-properties-label">Key Properties</div>
            <ul class="text-sm text-text-secondary space-y-1">
              <li>Fresh context per iteration (no memory)</li>
              <li>Runs forever unless externally stopped</li>
              <li>Relies on external state files for memory</li>
            </ul>
          </div>
          <div class="primitive-used-in">Used in: <span>Ralph (basic)</span> <span>Panopticon cron</span></div>
        </div>

        <div class="primitive-card">
          <div class="primitive-name">Iteration-Limited Loop</div>
          <div class="primitive-description">Runs a bounded number of iterations with early exit on completion. Prevents runaway costs.</div>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre><span class="variable">MAX_ITERATIONS</span>=${1:-10}

<span class="keyword">for</span> (( i=1; i<=$MAX_ITERATIONS; i++ )); <span class="keyword">do</span>
  <span class="keyword">echo</span> <span class="string">"Iteration $i / $MAX_ITERATIONS"</span>

  claude <span class="string">"$PROMPT"</span> | tee output.txt

  <span class="comment"># Check for early exit</span>
  <span class="keyword">if</span> grep -q <span class="string">"COMPLETE"</span> output.txt; <span class="keyword">then</span>
    <span class="keyword">break</span>
  <span class="keyword">fi</span>
<span class="keyword">done</span></pre>
          </div>
          <div class="primitive-properties">
            <div class="primitive-properties-label">Typical Values</div>
            <ul class="text-sm text-text-secondary space-y-1">
              <li>10-25 for feature development</li>
              <li>50+ for large migrations</li>
              <li>Cost scales linearly with iterations</li>
            </ul>
          </div>
          <div class="primitive-used-in">Used in: <span>Ralph (primary)</span> <span>Marathon Ralph</span> <span>Lisa</span></div>
        </div>

        <div class="primitive-card">
          <div class="primitive-name">jq-Based Conditional Loop</div>
          <div class="primitive-description">Loops until all tasks in a JSON file are marked as passed. More semantic than grep for completion detection.</div>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre><span class="keyword">while</span> jq <span class="string">'.tasks[] | select(.passes == false)'</span> prd.json | grep -q .; <span class="keyword">do</span>
  claude --chrome -p <span class="string">"$PROMPT"</span>
<span class="keyword">done</span></pre>
          </div>
          <div class="primitive-used-in">Source: @maurice_kleine</div>
        </div>

        <!-- State Primitives -->
        <h3 class="font-semibold text-lg mb-4 mt-8" id="state-primitives">State Primitives</h3>

        <div class="primitive-card">
          <div class="primitive-name">progress.txt (Append-Only Log)</div>
          <div class="primitive-description">Markdown file with dated sections. Append-only - never update previous entries. Two sections: "Codebase Patterns" at top (persistent learnings), entries below (per-iteration).</div>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre><span class="comment"># Ralph Progress Log</span>
Started: 2026-01-09

<span class="comment">## Codebase Patterns</span>
- Migrations: Use IF NOT EXISTS
- Types: Export from actions.ts

<span class="comment">## Key Files</span>
- db/schema.ts
- app/auth/actions.ts

---

<span class="comment">## 2026-01-09 - US-001</span>
- What was implemented: Login endpoint
- Files changed: src/api/auth.ts
- <span class="keyword">Learnings:</span>
  - bcrypt needs salt rounds of 12
  - JWT expiry should be configurable
---</pre>
          </div>
          <div class="primitive-properties">
            <div class="primitive-properties-label">Key Properties</div>
            <ul class="text-sm text-text-secondary space-y-1">
              <li>Human-readable, Git-tracked</li>
              <li>Cross-iteration memory via append</li>
              <li>Pattern accumulation over time</li>
            </ul>
          </div>
        </div>

        <div class="primitive-card">
          <div class="primitive-name">prd.json (Task Status Tracking)</div>
          <div class="primitive-description">JSON file with userStories array. Each story has id, priority, passes boolean, and acceptanceCriteria.</div>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre>{
  <span class="string">"project"</span>: <span class="string">"MyApp"</span>,
  <span class="string">"branchName"</span>: <span class="string">"ralph/feature-auth"</span>,
  <span class="string">"userStories"</span>: [
    {
      <span class="string">"id"</span>: <span class="string">"US-001"</span>,
      <span class="string">"title"</span>: <span class="string">"Create login endpoint"</span>,
      <span class="string">"acceptanceCriteria"</span>: [
        <span class="string">"POST /api/auth/login accepts email + password"</span>,
        <span class="string">"Returns JWT on success"</span>,
        <span class="string">"npm run typecheck passes"</span>
      ],
      <span class="string">"priority"</span>: 1,
      <span class="string">"passes"</span>: <span class="keyword">false</span>
    }
  ]
}</pre>
          </div>
          <table class="primitive-table">
            <thead>
              <tr>
                <th>Field</th>
                <th>Purpose</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>branchName</code></td>
                <td>Git branch for this feature set</td>
              </tr>
              <tr>
                <td><code>priority</code></td>
                <td>Lower number = execute first</td>
              </tr>
              <tr>
                <td><code>passes</code></td>
                <td><code>false</code> = needs work, <code>true</code> = complete</td>
              </tr>
              <tr>
                <td><code>blockedBy</code></td>
                <td>Dependencies (optional)</td>
              </tr>
              <tr>
                <td><code>acceptanceCriteria</code></td>
                <td>Verifiable completion conditions</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Control Primitives -->
        <h3 class="font-semibold text-lg mb-4 mt-8" id="control-primitives">Control Primitives</h3>

        <div class="primitive-card">
          <div class="primitive-name">Promise/Stop Condition</div>
          <div class="primitive-description">Unambiguous signal for completion. XML-style tags for reliability. Searched via grep in shell wrapper.</div>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre><span class="comment"># In prompt:</span>
If ALL stories pass, reply with:
&lt;promise&gt;COMPLETE&lt;/promise&gt;

<span class="comment"># Detection in loop:</span>
<span class="keyword">if</span> grep -q <span class="string">"&lt;promise&gt;COMPLETE&lt;/promise&gt;"</span> output.txt; <span class="keyword">then</span>
  <span class="keyword">echo</span> <span class="string">"All stories complete!"</span>
  <span class="keyword">exit</span> 0
<span class="keyword">fi</span></pre>
          </div>
          <div class="primitive-properties">
            <div class="primitive-properties-label">Variations</div>
            <ul class="text-sm text-text-secondary space-y-1">
              <li><code>PROMISE COMPLETE HERE</code></li>
              <li><code>&lt;complete/&gt;</code></li>
              <li><code>##DONE##</code></li>
            </ul>
          </div>
        </div>

        <div class="primitive-card">
          <div class="primitive-name">Story Selection Logic</div>
          <div class="primitive-description">Priority-ordered selection of next task. Single story per iteration to prevent context overload.</div>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre><span class="comment">## Your Task</span>

1. Read `scripts/ralph/prd.json`
2. Read `scripts/ralph/progress.txt` (check Codebase Patterns first)
3. Pick highest priority story where `passes: false`
4. Implement that ONE story
5. Run typecheck and tests
6. Update prd.json: `passes: true`
7. Append learnings to progress.txt</pre>
          </div>
        </div>

        <!-- Quality Gate Primitives -->
        <h3 class="font-semibold text-lg mb-4 mt-8" id="quality-primitives">Quality Gate Primitives</h3>

        <div class="primitive-card">
          <div class="primitive-name">Typecheck Gate</div>
          <div class="primitive-description">Verifies type safety before marking task complete. Always include in acceptance criteria.</div>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre>npm run typecheck
<span class="comment"># or</span>
tsc --noEmit
<span class="comment"># or</span>
pnpm typecheck</pre>
          </div>
        </div>

        <div class="primitive-card">
          <div class="primitive-name">Test Gate</div>
          <div class="primitive-description">Runs test suite to verify correctness.</div>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre>npm test
<span class="comment"># Run only related tests</span>
npm test -- --findRelatedTests $FILE
<span class="comment"># Run with coverage</span>
npm test -- --coverage --coverageThreshold='{"global":{"lines":80}}'</pre>
          </div>
        </div>

        <div class="primitive-card">
          <div class="primitive-name">CI Green Gate</div>
          <div class="primitive-description">Every commit must pass all checks. If ANY fail, do NOT mark story as passed.</div>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre>Every commit must pass all checks:
1. npm run typecheck
2. npm run test
3. npm run lint

If ANY fail, do NOT mark story as passed.</pre>
          </div>
          <div class="decision-implication" style="margin-top: 16px;">
            <div class="decision-implication-label">Key Insight (Matt Pocock)</div>
            <div class="text-text-secondary text-sm">
              "If you don't do this, you're hamstringing future agent runs with bad code, and they'll need to bisect to find bugs."
            </div>
          </div>
        </div>

        <!-- Coordination Primitives -->
        <h3 class="font-semibold text-lg mb-4 mt-8" id="coordination-primitives">Coordination Primitives</h3>

        <div class="primitive-card">
          <div class="primitive-name">Worker Preamble Template</div>
          <div class="primitive-description">Constrains worker agents to execution only. Prevents recursion. Must be at VERY START of worker prompt.</div>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre>CONTEXT: You are a WORKER agent, not an orchestrator.

RULES:
- Complete ONLY the task described below
- Use tools directly (Read, Write, Edit, Bash, etc.)
- Do NOT spawn sub-agents
- Do NOT call TaskCreate or TaskUpdate
- Report your results with absolute file paths

TASK:
[Your specific task here]</pre>
          </div>
        </div>

        <div class="primitive-card">
          <div class="primitive-name">Model Selection Matrix</div>
          <div class="primitive-description">Match model capability to task complexity for cost efficiency.</div>
          <table class="primitive-table">
            <thead>
              <tr>
                <th>Model</th>
                <th>Use Case</th>
                <th>Parallel Capacity</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>Haiku</strong></td>
                <td>Errand runner: fetch files, grep, simple lookups</td>
                <td>Spawn 5-10 in parallel</td>
              </tr>
              <tr>
                <td><strong>Sonnet</strong></td>
                <td>Capable worker: structured implementation, following patterns</td>
                <td>3-5 parallel</td>
              </tr>
              <tr>
                <td><strong>Opus</strong></td>
                <td>Complex reasoning, architecture decisions, ambiguous tasks</td>
                <td>1-2 (expensive)</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Memory Primitives -->
        <h3 class="font-semibold text-lg mb-4 mt-8" id="memory-primitives">Memory Primitives</h3>

        <div class="primitive-card">
          <div class="primitive-name">Git as Memory</div>
          <div class="primitive-description">Code changes persist across iterations via version control. Immutable history, diff-based understanding.</div>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre><span class="comment"># Future agent understands context from git history</span>
git log --oneline -10
git diff HEAD~5</pre>
          </div>
        </div>

        <div class="primitive-card">
          <div class="primitive-name">Filesystem as Memory (Panopticon)</div>
          <div class="primitive-description">Each domain has isolated directory that persists agent state. Domain isolation prevents cross-contamination.</div>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre>~/nox        <span class="comment"># Company/product</span>
~/metrics    <span class="comment"># Analytics/data</span>
~/email      <span class="comment"># Communications</span>
~/growth     <span class="comment"># Marketing/acquisition</span>
~/trades     <span class="comment"># Personal finance/trading</span>
~/health     <span class="comment"># Fitness/sleep/wellness</span>
~/writing    <span class="comment"># Content creation</span>
~/personal   <span class="comment"># Life admin</span></pre>
          </div>
          <div class="primitive-used-in">Used in: <span>Panopticon</span></div>
        </div>

        <div class="primitive-card">
          <div class="primitive-name">CLAUDE.md Hierarchy</div>
          <div class="primitive-description">Layered memory from enterprise policy to local overrides.</div>
          <div class="composition-diagram">
            <pre>Layer 1: Enterprise Policy
  /Library/Application Support/ClaudeCode/CLAUDE.md

Layer 2: Project Memory
  ./CLAUDE.md or ./.claude/CLAUDE.md

Layer 3: Modular Rules
  ./.claude/rules/*.md

Layer 4: Personal + Local
  ~/.claude/CLAUDE.md (user global)
  ./CLAUDE.local.md (project local, gitignored)</pre>
          </div>
        </div>

        <!-- Hook Primitives -->
        <h3 class="font-semibold text-lg mb-4 mt-8" id="hook-primitives">Hook Primitives</h3>

        <div class="primitive-card">
          <div class="primitive-name">Hook Events</div>
          <div class="primitive-description">Lifecycle events you can intercept for automation.</div>
          <table class="primitive-table">
            <thead>
              <tr>
                <th>Event</th>
                <th>Trigger</th>
                <th>Common Use Cases</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>PreToolUse</code></td>
                <td>Before a tool runs</td>
                <td>Validation, notifications, approval gates</td>
              </tr>
              <tr>
                <td><code>PostToolUse</code></td>
                <td>After a tool completes</td>
                <td>Formatting, linting, logging</td>
              </tr>
              <tr>
                <td><code>SessionStart</code></td>
                <td>When session begins</td>
                <td>Context loading, environment setup</td>
              </tr>
              <tr>
                <td><code>SessionEnd</code></td>
                <td>When session ends</td>
                <td>Cleanup, summary generation</td>
              </tr>
              <tr>
                <td><code>Stop</code></td>
                <td>Exit/completion attempts</td>
                <td>Loop continuation (Ralph)</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="primitive-card">
          <div class="primitive-name">Security Gate Hook</div>
          <div class="primitive-description">Blocks dangerous commands. Exit code 0 = allow, non-zero = block.</div>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCodeBlock(this)">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <pre><span class="comment">#!/bin/bash</span>
<span class="comment"># ~/.claude/hooks/security-gate.sh</span>

<span class="variable">COMMAND</span>=$(echo <span class="string">"$EVENT_DATA"</span> | jq -r '.tool_input.command')

<span class="variable">DANGEROUS_PATTERNS</span>=(
    <span class="string">"rm -rf /"</span>
    <span class="string">"git push --force"</span>
    <span class="string">"DROP TABLE"</span>
    <span class="string">"sudo"</span>
)

<span class="keyword">for</span> pattern <span class="keyword">in</span> <span class="string">"${DANGEROUS_PATTERNS[@]}"</span>; <span class="keyword">do</span>
    <span class="keyword">if</span> [[ <span class="string">"$COMMAND"</span> == *<span class="string">"$pattern"</span>* ]]; <span class="keyword">then</span>
        <span class="keyword">echo</span> <span class="string">"BLOCKED: Dangerous command pattern"</span> >&2
        <span class="keyword">exit</span> 1  <span class="comment"># Block the operation</span>
    <span class="keyword">fi</span>
<span class="keyword">done</span>

<span class="keyword">exit</span> 0  <span class="comment"># Allow</span></pre>
          </div>
        </div>
      </section>

      <!-- Section 4: COMPOSITION -->
      <section id="composition" data-activity="composition">
        <h2 class="section-title">
          <span class="section-number">4</span>
          How Primitives Compose
        </h2>

        <p class="text-text-secondary mb-6">
          Every major pattern is a specific composition of these primitives. Understanding composition lets you see the pattern's DNA.
        </p>

        <h3 class="font-semibold text-lg mb-4">Ralph Loop = Basic Composition</h3>

        <div class="composition-diagram">
          <pre>                       RALPH LOOP
+-------------------------------------------------------------+
|                                                             |
|  Iteration-Limited Loop                                     |
|       |                                                     |
|       +-- prd.json (State)                                  |
|       |       +-- Tracks: passes: true/false                |
|       |                                                     |
|       +-- Story Selection Logic                             |
|       |       +-- Pick highest priority where passes==false |
|       |                                                     |
|       +-- Quality Gates                                     |
|       |       +-- Typecheck                                 |
|       |       +-- Tests                                     |
|       |                                                     |
|       +-- progress.txt (Memory)                             |
|       |       +-- Append learnings each iteration           |
|       |                                                     |
|       +-- Git Commit                                        |
|       |       +-- Persist code changes                      |
|       |                                                     |
|       +-- Promise/Stop Condition                            |
|               +-- &lt;promise&gt;COMPLETE&lt;/promise&gt;               |
|                                                             |
+-------------------------------------------------------------+</pre>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8">CC Mirror = Hub-and-Spoke Composition</h3>

        <div class="composition-diagram">
          <pre>                 CC MIRROR ORCHESTRATION
+-------------------------------------------------------------+
|                                                             |
|  +=====================================================+    |
|  |              ORCHESTRATOR (Conductor)               |    |
|  |  Tools: TaskCreate, TaskUpdate, Task (spawn), Read  |    |
|  |  Role: Decompose, delegate, synthesize              |    |
|  +=====================================================+    |
|                          |                                  |
|         +----------------+----------------+                  |
|         |                |                |                  |
|         v                v                v                  |
|   +----------+    +----------+    +----------+              |
|   | Worker 1 |    | Worker 2 |    | Worker 3 |              |
|   | (Haiku)  |    | (Sonnet) |    | (Opus)   |              |
|   +----------+    +----------+    +----------+              |
|        |                |                |                   |
|        +-- Worker Preamble (prevents recursion) --+          |
|                                                             |
|   Coordination: TaskCreate dependencies (blockedBy/blocks)  |
|   Memory: Native task persistence                           |
|                                                             |
+-------------------------------------------------------------+</pre>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8">Primitive Composition Matrix</h3>

        <table class="primitive-table">
          <thead>
            <tr>
              <th>Pattern</th>
              <th>Loop</th>
              <th>State</th>
              <th>Control</th>
              <th>Quality</th>
              <th>Coordination</th>
              <th>Memory</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Ralph</strong></td>
              <td>Iteration-Limited</td>
              <td>prd.json + progress.txt</td>
              <td>Promise/Stop</td>
              <td>Typecheck + Tests</td>
              <td>Single-agent</td>
              <td>Git + Files</td>
            </tr>
            <tr>
              <td><strong>CC Mirror</strong></td>
              <td>Event-driven</td>
              <td>TaskCreate native</td>
              <td>Task dependencies</td>
              <td>Per-task gates</td>
              <td>Hub-and-spoke</td>
              <td>Task persistence</td>
            </tr>
            <tr>
              <td><strong>Gas Town</strong></td>
              <td>Continuous</td>
              <td>Beads (Git-backed)</td>
              <td>Role-based</td>
              <td>Dogs (watchdogs)</td>
              <td>Factory model</td>
              <td>MCP Agent Mail</td>
            </tr>
            <tr>
              <td><strong>Panopticon</strong></td>
              <td>Cron-scheduled</td>
              <td>Filesystem</td>
              <td>Domain isolation</td>
              <td>Domain-specific</td>
              <td>File handoffs</td>
              <td>Dir per domain</td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- Section 5: PATH OF SELECTION -->
      <section id="path" data-activity="path">
        <h2 class="section-title">
          <span class="section-number">5</span>
          Path of Primitive Selection
        </h2>

        <p class="text-text-secondary mb-6">
          Follow this path when building or debugging agent systems:
        </p>

        <div class="path-container">
          <div class="path-step">
            <div class="path-number">1</div>
            <div class="path-content">Identify your <strong>iteration model</strong>: Do you need bounded loops (Ralph), event-driven (CC Mirror), or scheduled (Panopticon)?</div>
          </div>
          <div class="path-step">
            <div class="path-number">2</div>
            <div class="path-content">Choose your <strong>state mechanism</strong>: JSON files for simple, native TaskCreate for multi-agent, filesystem for domain isolation</div>
          </div>
          <div class="path-step">
            <div class="path-number">3</div>
            <div class="path-content">Define your <strong>control mechanism</strong>: How does the system know when to stop? Promise signal? All tasks done? Human intervention?</div>
          </div>
          <div class="path-step">
            <div class="path-number">4</div>
            <div class="path-content">Add <strong>quality gates</strong>: What must pass before marking done? Tests? Typecheck? Visual verification?</div>
          </div>
          <div class="path-step">
            <div class="path-number">5</div>
            <div class="path-content">Design <strong>memory strategy</strong>: How do learnings persist? Append-only log? Git history? AGENTS.md?</div>
          </div>
          <div class="path-step">
            <div class="path-number">6</div>
            <div class="path-content">Add <strong>coordination</strong> if multi-agent: Worker preambles? Model selection? Dependency management?</div>
          </div>
          <div class="path-step">
            <div class="path-number">7</div>
            <div class="path-content">Install <strong>hooks</strong> for automation: Notifications? Formatting? Security gates?</div>
          </div>
          <div class="path-step">
            <div class="path-number">8</div>
            <div class="path-content">Test each primitive in isolation before composing. A broken primitive breaks the whole pattern.</div>
          </div>
        </div>
      </section>

      <!-- Section 6: GOTCHAS -->
      <section id="gotchas" data-activity="gotchas">
        <h2 class="section-title">
          <span class="section-number">6</span>
          Gotchas
        </h2>

        <p class="text-text-secondary mb-6">
          Real problems you'll hit when working with primitives:
        </p>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            progress.txt gets overwritten instead of appended
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Previous iteration learnings disappear; file contains only latest entry</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Using <code>></code> (overwrite) instead of <code>>></code> (append) in shell commands</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Always use <code>>></code> for progress.txt. CAPS "APPEND" in prompt helps LLM compliance.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            prd.json becomes invalid JSON
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> jq fails to parse; agent can't read task state</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Manual editing introduced syntax errors, or agent output malformed JSON</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Validate with <code>jq . prd.json</code>. Keep backups before each iteration. Use jq for updates instead of manual editing.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Hook doesn't fire
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Expected automation doesn't run; no notification sent</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Hook configuration in wrong location or incorrect event name</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Verify hook is in correct settings file. Check event name matches exactly. Test script independently. Ensure execute permissions.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Completion signal not detected
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Loop runs indefinitely even though agent outputs completion signal</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Signal format mismatch or grep not searching correct file</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Verify exact signal format matches between prompt and grep. Ensure output is captured to the file grep is searching.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Worker preamble ignored
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Worker behaves like orchestrator; spawns subagents; uses wrong tools</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Preamble placed after task description or too weak</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Place preamble at the VERY START of worker prompt. Use explicit prohibition language with "CANNOT", "MUST".</div>
        </div>
      </section>

      <!-- Section 7: WHAT'S HARD -->
      <section id="hard" data-activity="hard">
        <h2 class="section-title">
          <span class="section-number">7</span>
          What's Hard
        </h2>

        <p class="text-text-secondary mb-6">
          These are fundamental tensions in primitive design:
        </p>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Primitive Granularity
          </div>
          <div class="hard-detail"><strong>The tension:</strong> More granular primitives are more composable but harder to understand in isolation. Less granular primitives are easier to use but less flexible.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Too granular - boilerplate explosion. Too coarse - can't customize for edge cases.</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Start with coarse primitives (copy whole Ralph loop). Decompose only when you need to customize specific parts.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            State Synchronization
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Multiple state files (prd.json, progress.txt, git) can get out of sync. No transactional guarantees.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Task marked done in prd.json but code not committed. Learnings in progress.txt but task failed.</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Order operations carefully: code change -> test -> commit -> update prd.json -> append progress. Always update prd.json LAST.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Composition Debugging
          </div>
          <div class="hard-detail"><strong>The tension:</strong> When a composed pattern fails, hard to know which primitive caused it. Failures cascade.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> "It just doesn't work" - can't isolate problem. Fixes in one primitive break another.</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Test primitives in isolation first. Add logging at primitive boundaries. Build incrementally, not all at once.</div>
        </div>
      </section>

      <!-- Section 8: WHEN TO USE -->
      <section id="when" data-activity="when">
        <h2 class="section-title">
          <span class="section-number">8</span>
          Primitive Selection Guide
        </h2>

        <h3 class="font-semibold text-lg mb-4">For overnight feature development:</h3>
        <ul class="list-disc list-inside text-text-secondary mb-6 space-y-2">
          <li><strong>Loop:</strong> Iteration-Limited (prevent runaway costs)</li>
          <li><strong>State:</strong> prd.json + progress.txt</li>
          <li><strong>Control:</strong> Promise/Stop condition</li>
          <li><strong>Quality:</strong> Typecheck + Tests mandatory</li>
        </ul>

        <h3 class="font-semibold text-lg mb-4">For parallel life automation:</h3>
        <ul class="list-disc list-inside text-text-secondary mb-6 space-y-2">
          <li><strong>Loop:</strong> Cron scheduling</li>
          <li><strong>State:</strong> Filesystem per domain</li>
          <li><strong>Control:</strong> Domain isolation</li>
          <li><strong>Communication:</strong> File-based handoffs</li>
        </ul>

        <h3 class="font-semibold text-lg mb-4">For complex multi-agent work:</h3>
        <ul class="list-disc list-inside text-text-secondary mb-6 space-y-2">
          <li><strong>Coordination:</strong> TaskCreate with dependencies</li>
          <li><strong>Preambles:</strong> Worker Preamble mandatory</li>
          <li><strong>Model:</strong> Model Selection Matrix</li>
          <li><strong>Memory:</strong> Native task persistence</li>
        </ul>

        <h3 class="font-semibold text-lg mb-4">For safe autonomous operation:</h3>
        <ul class="list-disc list-inside text-text-secondary mb-6 space-y-2">
          <li><strong>Hooks:</strong> Security Gate hooks</li>
          <li><strong>Isolation:</strong> Docker containers</li>
          <li><strong>Limits:</strong> Max Iteration Guard</li>
          <li><strong>Recovery:</strong> Checkpoint state</li>
        </ul>

        <div class="when-grid">
          <div class="when-use">
            <div class="when-title">
              <i data-lucide="check" class="w-5 h-5"></i>
              GOOD FIT FOR PRIMITIVES
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Building custom patterns for unique workflows</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Debugging why an existing pattern fails</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Understanding tradeoffs between patterns</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Teaching others how agent systems work</span>
            </div>
          </div>

          <div class="when-not">
            <div class="when-title">
              <i data-lucide="x" class="w-5 h-5"></i>
              JUST COPY A PATTERN
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Standard feature development (just use Ralph)</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>First-time agent user (start with proven patterns)</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Time pressure (compose later, ship now)</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Team adoption (consistency over customization)</span>
            </div>
          </div>
        </div>
      </section>

    </main>

    <!-- Resizer -->
    <div class="resizer" data-resizer="activity-zone" aria-label="Resize activity panel"></div>

    <!-- Activity Zone -->
    <aside class="activity-zone" id="activityZone">
      <div class="text-xs font-semibold text-text-muted uppercase tracking-wider mb-4">Operational Intelligence</div>

      <!-- ESSENCE SECTION -->
      <div class="activity-item minimal" data-section="essence">
        <div class="activity-label" style="color: #84cc16;">
          <i data-lucide="minimize-2" class="w-4 h-4"></i>
          Minimal Pattern
        </div>
        <div class="font-medium text-text-primary mb-2">The irreducible primitive set</div>
        <div class="text-text-secondary text-sm">
          <code style="background: #f4f4f5; padding: 2px 6px; border-radius: 4px; font-size: 12px;">Loop + State + Control</code><br>
          <strong>Essential:</strong> Something iterates, something persists, something stops it.<br>
          <strong>Everything else:</strong> Reliability, safety, efficiency.
        </div>
      </div>

      <div class="activity-item analogy" data-section="essence">
        <div class="activity-label" style="color: #d946ef;">
          <i data-lucide="git-compare" class="w-4 h-4"></i>
          Analogical Bridge
        </div>
        <div class="font-medium text-text-primary mb-2">Primitives = LEGO Bricks</div>
        <div class="text-text-secondary text-sm">
          <strong>Individual bricks:</strong> Simple, limited alone<br>
          <strong>Combinations:</strong> Complex structures emerge<br>
          <strong>Standard interfaces:</strong> Any brick connects to any other<br>
          <strong>Instruction manuals:</strong> Composition patterns like Ralph<br><br>
          <em>If you understand LEGO, you understand primitives.</em>
        </div>
      </div>

      <div class="activity-item invariant" data-section="essence">
        <div class="activity-label" style="color: #3b82f6;">
          <i data-lucide="link" class="w-4 h-4"></i>
          Invariant Connection
        </div>
        <div class="font-medium text-text-primary mb-2">All patterns share INV-003: External state > internal memory</div>
        <div class="text-text-secondary text-sm">
          Ralph, Gas Town, CC Mirror, Panopticon - all use external state files, not LLM memory. The primitive is universal because the constraint (context rot) is universal.
        </div>
      </div>

      <!-- CORE SECTION -->
      <div class="activity-item constraint" data-section="core">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="link-2" class="w-4 h-4"></i>
          Constraint Chain
        </div>
        <div class="font-medium text-text-primary mb-2">One constraint produces the primitive taxonomy</div>
        <div class="text-text-secondary text-sm">
          <strong>ROOT:</strong> LLM context degrades with tokens<br>
          -> Fresh iterations needed (Loop primitives)<br>
          -> State must persist externally (State primitives)<br>
          -> Need to know when done (Control primitives)<br>
          -> Must verify before marking done (Quality primitives)<br>
          -> Multi-agent needs coordination (Coordination primitives)<br>
          -> Learning must cross iterations (Memory primitives)<br>
          -> Automation needs interception (Hook primitives)
        </div>
      </div>

      <div class="activity-item inversion" data-section="core">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if you didn't need primitives?</div>
        <div class="text-text-secondary text-sm">
          <strong>You'd design:</strong> One perfect pattern for all use cases<br>
          <strong>Why this fails:</strong> Different constraints (overnight vs real-time, single vs multi-agent, local vs cloud) require different compositions<br>
          <strong>Hidden constraint:</strong> Variety of use cases forces composability
        </div>
      </div>

      <div class="activity-item expertise" data-section="core">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
          Expertise Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">How deeply do you understand primitives?</div>
        <div class="text-text-secondary text-sm">
          <strong>Beginner:</strong> "What's a primitive?" -> Reusable building block<br>
          <strong>Intermediate:</strong> "Why these 7 categories?" -> Cover all concerns<br>
          <strong>Advanced:</strong> "Are these complete?" -> No, but sufficient<br>
          <strong>Staff:</strong> "When would I create new primitives?" -> Novel constraints<br>
          <strong>Expert:</strong> "Cross-primitive interactions?" -> State + Loop timing
        </div>
      </div>

      <!-- PRIMITIVES SECTION -->
      <div class="activity-item effect" data-section="primitives">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="bar-chart-2" class="w-4 h-4"></i>
          Second-Order Effect
        </div>
        <div class="font-medium text-text-primary mb-2">At 50+ iterations, loop primitive matters less than state primitive</div>
        <div class="text-text-secondary text-sm">
          <strong>Early:</strong> Loop determines speed<br>
          <strong>Late:</strong> State size determines quality<br>
          <strong>Threshold:</strong> ~20KB progress.txt<br><br>
          <em>Optimize for state management, not loop speed.</em>
        </div>
      </div>

      <div class="activity-item gradient" data-section="primitives">
        <div class="activity-label" style="color: #f43f5e;">
          <i data-lucide="trending-down" class="w-4 h-4"></i>
          Failure Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">How primitives fail gradually</div>
        <div class="text-text-secondary text-sm">
          <strong>Loop:</strong> Runs too long -> costs spike<br>
          <strong>State:</strong> Gets corrupted -> silent wrong answers<br>
          <strong>Control:</strong> Signal missed -> infinite loop<br>
          <strong>Quality:</strong> Gate skipped -> tech debt compounds<br><br>
          <em>State failures are most dangerous: invisible until cascade.</em>
        </div>
      </div>

      <div class="activity-item tradeoff" data-section="primitives">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="scale" class="w-4 h-4"></i>
          Trade-Off Tension
        </div>
        <div class="font-medium text-text-primary mb-2">JSON State vs. Filesystem State</div>
        <div class="text-text-secondary text-sm">
          <strong>JSON (prd.json):</strong> Atomic, queryable, but complex schema<br>
          <strong>Filesystem (Panopticon):</strong> Simple, isolated, but no queries<br>
          <strong>Git:</strong> History + diff, but not queryable mid-run<br><br>
          <em>Heuristic: JSON for task tracking, filesystem for domain isolation, git for code.</em>
        </div>
      </div>

      <div class="activity-item composition" data-section="primitives">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="layers" class="w-4 h-4"></i>
          Composition Case
        </div>
        <div class="font-medium text-text-primary mb-2">Loop + Quality Gate interaction</div>
        <div class="text-text-secondary text-sm">
          <strong>Works:</strong> Quality gate BEFORE marking done prevents bad commits<br>
          <strong>Danger:</strong> Quality gate AFTER marking done = tech debt in git<br>
          <strong>Order matters:</strong> test -> pass -> mark done -> commit
        </div>
      </div>

      <div class="activity-item warstory" data-section="primitives">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">Matt Pocock: The skipped typecheck</div>
        <div class="text-text-secondary text-sm">
          "If you don't do this, you're hamstringing future agent runs with bad code, and they'll need to bisect to find bugs."<br><br>
          One iteration without typecheck -> 10 iterations debugging type errors.
        </div>
      </div>

      <div class="activity-item violation" data-section="primitives">
        <div class="activity-label" style="color: #f97316;">
          <i data-lucide="alert-octagon" class="w-4 h-4"></i>
          Violation Chain
        </div>
        <div class="font-medium text-text-primary mb-2">If you use > instead of >> for progress.txt</div>
        <div class="text-text-secondary text-sm">
          <strong>IF:</strong> You overwrite instead of append<br>
          <strong>THEN:</strong> Previous learnings are lost<br>
          <strong>THEN:</strong> Next iteration repeats solved problems<br>
          <strong>THEN:</strong> No velocity improvement over time<br>
          <strong>FINALLY:</strong> Iteration 50 is as slow as iteration 1<br><br>
          <em>The fix: Always >> for progress.txt. Never >.</em>
        </div>
      </div>

      <div class="activity-item horizon" data-section="primitives">
        <div class="activity-label" style="color: #06b6d4;">
          <i data-lucide="clock" class="w-4 h-4"></i>
          Time Horizon Shift
        </div>
        <div class="font-medium text-text-primary mb-2">How primitive value changes over time</div>
        <div class="text-text-secondary text-sm">
          <strong>Iteration 1:</strong> "Loop primitive is core"<br>
          <strong>Iteration 10:</strong> "State primitive is what matters"<br>
          <strong>Iteration 30:</strong> "Memory primitive is why this works"<br>
          <strong>Iteration 50:</strong> "Quality primitive is what keeps it working"<br><br>
          <em>What matters shifts as iteration count grows.</em>
        </div>
      </div>

      <!-- COMPOSITION SECTION -->
      <div class="activity-item analogy" data-section="composition">
        <div class="activity-label" style="color: #d946ef;">
          <i data-lucide="git-compare" class="w-4 h-4"></i>
          Analogical Bridge
        </div>
        <div class="font-medium text-text-primary mb-2">Pattern Composition = Music Composition</div>
        <div class="text-text-secondary text-sm">
          <strong>Primitives:</strong> Notes (C, D, E...)<br>
          <strong>Patterns:</strong> Melodies (Ralph, Gas Town...)<br>
          <strong>Composition rules:</strong> Music theory<br>
          <strong>Dissonance:</strong> Incompatible primitives<br><br>
          <em>You can make new music once you know the notes.</em>
        </div>
      </div>

      <div class="activity-item invariant" data-section="composition">
        <div class="activity-label" style="color: #3b82f6;">
          <i data-lucide="link" class="w-4 h-4"></i>
          Invariant Connection
        </div>
        <div class="font-medium text-text-primary mb-2">Ralph and Gas Town share 4 primitive categories</div>
        <div class="text-text-secondary text-sm">
          Both use: Loop, State, Quality, Memory<br>
          Differ in: Coordination (single vs factory), Control (promise vs role-based)<br><br>
          <em>Understanding shared primitives lets you predict behavior.</em>
        </div>
      </div>

      <div class="activity-item composition" data-section="composition">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="layers" class="w-4 h-4"></i>
          Composition Case
        </div>
        <div class="font-medium text-text-primary mb-2">Can Ralph primitives compose with CC Mirror primitives?</div>
        <div class="text-text-secondary text-sm">
          <strong>Works:</strong> Ralph Loop + CC Mirror TaskCreate = "Ralph spawns workers"<br>
          <strong>Danger:</strong> Two coordination models compete. Workers might use Ralph's single-agent assumptions.<br>
          <strong>Recommendation:</strong> Keep Ralph for orchestrator, CC Mirror for workers.
        </div>
      </div>

      <div class="activity-item expertise" data-section="composition">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
          Expertise Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">Composition understanding depth</div>
        <div class="text-text-secondary text-sm">
          <strong>Beginner:</strong> "Copy whole Ralph" -> Works<br>
          <strong>Intermediate:</strong> "Swap prd.json format" -> OK if schema matches<br>
          <strong>Advanced:</strong> "Add hooks to Ralph" -> Powerful<br>
          <strong>Staff:</strong> "Mix Ralph loop + Gas Town memory" -> Experimental<br>
          <strong>Expert:</strong> "When does composition fail?" -> State timing conflicts
        </div>
      </div>

      <div class="activity-item frontier" data-section="composition">
        <div class="activity-label" style="color: #ef4444;">
          <i data-lucide="flask-conical" class="w-4 h-4"></i>
          Research Frontier
        </div>
        <div class="font-medium text-text-primary mb-2">UNSOLVED: Automatic composition validation</div>
        <div class="text-text-secondary text-sm">
          <strong>The question:</strong> Can we automatically detect incompatible primitive combinations?<br>
          <strong>Why it's hard:</strong> Interactions are emergent, not obvious from primitives alone<br>
          <strong>Current practice:</strong> Manual testing, community knowledge, trial and error
        </div>
      </div>

      <!-- PATH SECTION -->
      <div class="activity-item constraint" data-section="path">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="link-2" class="w-4 h-4"></i>
          Constraint Chain
        </div>
        <div class="font-medium text-text-primary mb-2">Selection order is forced</div>
        <div class="text-text-secondary text-sm">
          <strong>ROOT:</strong> Must iterate to use fresh context<br>
          -> Loop must come first<br>
          -> State follows (what persists between loops)<br>
          -> Control follows (when to stop looping)<br>
          -> Quality follows (what must pass)<br>
          -> Coordination follows (if multi-agent)<br>
          -> Memory follows (cross-run learning)<br>
          -> Hooks follow (automation on top)<br><br>
          <em>Selection order mirrors dependency order.</em>
        </div>
      </div>

      <div class="activity-item violation" data-section="path">
        <div class="activity-label" style="color: #f97316;">
          <i data-lucide="alert-octagon" class="w-4 h-4"></i>
          Violation Chain
        </div>
        <div class="font-medium text-text-primary mb-2">If you add hooks before testing primitives</div>
        <div class="text-text-secondary text-sm">
          <strong>IF:</strong> Add hooks before basic primitives work<br>
          <strong>THEN:</strong> Hooks mask primitive failures<br>
          <strong>THEN:</strong> You debug hooks when problem is in loop<br>
          <strong>THEN:</strong> Hours wasted on wrong layer<br>
          <strong>FINALLY:</strong> Frustration and confusion<br><br>
          <em>The fix: Bottom-up. Test primitives before adding hooks.</em>
        </div>
      </div>

      <!-- GOTCHAS SECTION -->
      <div class="activity-item inflection" data-section="gotchas">
        <div class="activity-label" style="color: #eab308;">
          <i data-lucide="activity" class="w-4 h-4"></i>
          Inflection Point
        </div>
        <div class="font-medium text-text-primary mb-2">When prd.json complexity flips from help to hurt</div>
        <div class="text-text-secondary text-sm">
          <strong>1-5 tasks:</strong> Simple is fine<br>
          <strong>5-15 tasks:</strong> Schema helps<br>
          <strong>15-30 tasks:</strong> Dependencies needed<br>
          <strong>30+ tasks:</strong> Native TaskCreate better<br><br>
          <strong>THE INFLECTION:</strong> ~30 tasks<br>
          <em>Detection: JSON gets unwieldy to edit manually.</em>
        </div>
      </div>

      <div class="activity-item inversion" data-section="gotchas">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if primitives never broke?</div>
        <div class="text-text-secondary text-sm">
          <strong>You'd design:</strong> No error handling, no logging, no backups<br>
          <strong>Why this fails:</strong> Files corrupt, networks fail, LLMs hallucinate<br>
          <strong>Hidden constraint:</strong> Distributed systems are unreliable. Primitives inherit that unreliability.
        </div>
      </div>

      <div class="activity-item warstory" data-section="gotchas">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">Community pattern: jq validation before each iteration</div>
        <div class="text-text-secondary text-sm">
          After multiple corrupted prd.json incidents, community standard emerged: <code>jq . prd.json > /dev/null</code> at loop start. If it fails, stop and alert.
        </div>
      </div>

      <div class="activity-item gradient" data-section="gotchas">
        <div class="activity-label" style="color: #f43f5e;">
          <i data-lucide="trending-down" class="w-4 h-4"></i>
          Failure Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">How hook misconfiguration degrades</div>
        <div class="text-text-secondary text-sm">
          <strong>100%:</strong> Hook fires correctly<br>
          <strong>80%:</strong> Hook fires but wrong event (subtle bugs)<br>
          <strong>50%:</strong> Hook doesn't fire (silent failure)<br>
          <strong>20%:</strong> Hook blocks operations incorrectly (system halt)<br>
          <strong>0%:</strong> Hook corrupts state (data loss)<br><br>
          <em>Critical: Silent non-firing is common. Add logging to every hook.</em>
        </div>
      </div>

      <!-- HARD SECTION -->
      <div class="activity-item tradeoff" data-section="hard">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="scale" class="w-4 h-4"></i>
          Trade-Off Tension
        </div>
        <div class="font-medium text-text-primary mb-2">Granularity Dilemma</div>
        <div class="text-text-secondary text-sm">
          <strong>THE DILEMMA:</strong><br>
          - Fine-grained: Maximum flexibility, overwhelming complexity<br>
          - Coarse-grained: Easy to use, can't customize<br>
          - Current taxonomy: Middle ground, not perfect for all<br><br>
          <strong>WHY NO PERFECT ANSWER:</strong> Different users need different granularities<br>
          <em>Heuristic: Start coarse, decompose when forced.</em>
        </div>
      </div>

      <div class="activity-item horizon" data-section="hard">
        <div class="activity-label" style="color: #06b6d4;">
          <i data-lucide="clock" class="w-4 h-4"></i>
          Time Horizon Shift
        </div>
        <div class="font-medium text-text-primary mb-2">How debugging difficulty changes</div>
        <div class="text-text-secondary text-sm">
          <strong>Day 1:</strong> "Easy to see which primitive failed"<br>
          <strong>Week 1:</strong> "Interactions are getting complex"<br>
          <strong>Month 1:</strong> "Hard to reproduce bugs"<br>
          <strong>Month 3:</strong> "Composition is the bottleneck, not primitives"<br><br>
          <em>Long-term: Add observability early. You'll need it.</em>
        </div>
      </div>

      <div class="activity-item frontier" data-section="hard">
        <div class="activity-label" style="color: #ef4444;">
          <i data-lucide="flask-conical" class="w-4 h-4"></i>
          Research Frontier
        </div>
        <div class="font-medium text-text-primary mb-2">UNSOLVED: Primitive versioning</div>
        <div class="text-text-secondary text-sm">
          <strong>The question:</strong> How do you upgrade primitives without breaking existing compositions?<br>
          <strong>Why it's hard:</strong> Compositions depend on specific primitive behavior<br>
          <strong>Current practice:</strong> Copy primitives into project, don't upgrade
        </div>
      </div>

      <!-- WHEN SECTION -->
      <div class="activity-item alternative" data-section="when">
        <div class="activity-label" style="color: #6b7280;">
          <i data-lucide="arrow-right" class="w-4 h-4"></i>
          Alternative Paths
        </div>
        <div class="font-medium text-text-primary mb-2">If primitives aren't right for you</div>
        <div class="text-text-secondary text-sm">
          <strong>Just want to ship?</strong> -> Copy Ralph whole<br>
          <strong>Need multi-agent now?</strong> -> Use CC Mirror as-is<br>
          <strong>Learning?</strong> -> Start with mastery-ralph-complete.md<br>
          <strong>Enterprise?</strong> -> Adopt Gas Town framework
        </div>
      </div>

      <div class="activity-item inversion" data-section="when">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if everyone designed from primitives?</div>
        <div class="text-text-secondary text-sm">
          <strong>You'd have:</strong> Many incompatible custom patterns<br>
          <strong>Why this fails:</strong> Team consistency requires shared patterns<br>
          <strong>Hidden constraint:</strong> Primitives are for architects, patterns are for teams
        </div>
      </div>

      <div class="activity-item analogy" data-section="when">
        <div class="activity-label" style="color: #d946ef;">
          <i data-lucide="git-compare" class="w-4 h-4"></i>
          Analogical Bridge
        </div>
        <div class="font-medium text-text-primary mb-2">Primitives = Assembly Language</div>
        <div class="text-text-secondary text-sm">
          <strong>Assembly:</strong> Maximum control, maximum complexity<br>
          <strong>High-level patterns:</strong> Less control, much easier<br>
          <strong>When assembly?:</strong> Performance critical, debugging, understanding<br>
          <strong>When patterns?:</strong> Most of the time<br><br>
          <em>Know assembly exists. Use high-level 95% of the time.</em>
        </div>
      </div>

      <div class="activity-item warstory" data-section="when">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">Team that went too deep too fast</div>
        <div class="text-text-secondary text-sm">
          Started with primitives instead of copying Ralph. Spent 2 weeks designing custom composition. Finally realized Ralph would have worked. Lesson: Start with patterns, decompose to primitives only when forced.
        </div>
      </div>

      <div class="activity-item expertise" data-section="when">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
          Expertise Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">When to use primitives vs patterns</div>
        <div class="text-text-secondary text-sm">
          <strong>Beginner:</strong> Always use patterns (Ralph, CC Mirror)<br>
          <strong>Intermediate:</strong> Customize patterns slightly<br>
          <strong>Advanced:</strong> Swap individual primitives<br>
          <strong>Staff:</strong> Design new compositions<br>
          <strong>Expert:</strong> Create new primitives when needed
        </div>
      </div>

    </aside>
  </div>

  <script>
    /**
     * PanelResizer - Handles draggable panel dividers
     */
    class PanelResizer {
      constructor(resizerEl, config = {}) {
        this.resizer = resizerEl;
        this.config = {
          storageKey: 'panel-activity-zone-width',
          minWidth: 280,
          maxWidth: 900,
          defaultWidth: 480,
          ...config
        };

        this.isResizing = false;
        this.startX = 0;
        this.startWidth = 0;

        this.activityZone = document.querySelector('.activity-zone');
        this.mainContent = document.querySelector('.main-content');

        this.onMouseDown = this.onMouseDown.bind(this);
        this.onMouseMove = this.onMouseMove.bind(this);
        this.onMouseUp = this.onMouseUp.bind(this);

        this.init();
      }

      init() {
        this.restoreWidth();
        this.resizer.addEventListener('mousedown', this.onMouseDown);
      }

      onMouseDown(e) {
        if (e.button !== 0) return;

        this.isResizing = true;
        this.startX = e.clientX;
        this.startWidth = this.activityZone.offsetWidth;

        this.resizer.classList.add('active');
        document.body.classList.add('resizing');

        document.addEventListener('mousemove', this.onMouseMove);
        document.addEventListener('mouseup', this.onMouseUp);

        e.preventDefault();
      }

      onMouseMove(e) {
        if (!this.isResizing) return;

        const delta = this.startX - e.clientX;
        const newWidth = this.startWidth + delta;

        const constrainedWidth = Math.max(
          this.config.minWidth,
          Math.min(this.config.maxWidth, newWidth)
        );

        this.activityZone.style.width = constrainedWidth + 'px';
        this.mainContent.style.marginRight = constrainedWidth + 'px';
        this.resizer.style.right = constrainedWidth + 'px';
      }

      onMouseUp(e) {
        if (!this.isResizing) return;

        this.isResizing = false;

        this.resizer.classList.remove('active');
        document.body.classList.remove('resizing');

        document.removeEventListener('mousemove', this.onMouseMove);
        document.removeEventListener('mouseup', this.onMouseUp);

        this.saveWidth();
      }

      saveWidth() {
        const width = this.activityZone.offsetWidth;
        localStorage.setItem(this.config.storageKey, JSON.stringify({
          width,
          timestamp: Date.now()
        }));
      }

      restoreWidth() {
        try {
          const stored = localStorage.getItem(this.config.storageKey);
          if (stored) {
            const { width } = JSON.parse(stored);
            if (width >= this.config.minWidth && width <= this.config.maxWidth) {
              this.activityZone.style.width = width + 'px';
              this.mainContent.style.marginRight = width + 'px';
              this.resizer.style.right = width + 'px';
            }
          }
        } catch (e) {
          console.warn('Failed to restore panel width:', e);
        }
      }

      destroy() {
        this.resizer.removeEventListener('mousedown', this.onMouseDown);
        document.removeEventListener('mousemove', this.onMouseMove);
        document.removeEventListener('mouseup', this.onMouseUp);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      const resizers = document.querySelectorAll('[data-resizer]');
      resizers.forEach(resizer => new PanelResizer(resizer));
    });

    // Initialize Lucide icons
    lucide.createIcons();

    // Navigation toggle
    function toggleSection(header) {
      const section = header.closest('.nav-section');
      section.classList.toggle('expanded');
      const children = section.querySelector('.nav-children');
      children.classList.toggle('expanded');
    }

    // Mobile menu toggle
    function toggleMobileMenu() {
      const nav = document.getElementById('leftNav');
      nav.classList.toggle('open');
    }

    // Copy functionality
    function copyCode(btn, text) {
      navigator.clipboard.writeText(text).then(() => {
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i data-lucide="check" class="w-3 h-3"></i> Copied!';
        lucide.createIcons();
        setTimeout(() => {
          btn.innerHTML = originalText;
          lucide.createIcons();
        }, 2000);
      });
    }

    function copyCodeBlock(btn) {
      const codeBlock = btn.closest('.code-block');
      const pre = codeBlock.querySelector('pre');
      const text = pre.textContent;
      copyCode(btn, text);
    }

    // Scroll-sync with GSAP ScrollTrigger
    gsap.registerPlugin(ScrollTrigger);

    const sections = document.querySelectorAll('[data-activity]');
    const activityItems = document.querySelectorAll('.activity-item');

    sections.forEach(section => {
      ScrollTrigger.create({
        trigger: section,
        start: 'top 40%',
        end: 'bottom 40%',
        onEnter: () => activateSection(section.dataset.activity),
        onEnterBack: () => activateSection(section.dataset.activity),
      });
    });

    function activateSection(sectionName) {
      activityItems.forEach(item => {
        if (item.dataset.section === sectionName) {
          item.classList.add('active');
          gsap.to(item, {
            opacity: 1,
            y: -2,
            boxShadow: '0 4px 12px rgba(0,0,0,0.08)',
            duration: 0.3,
            ease: 'power2.out'
          });
        } else {
          item.classList.remove('active');
          gsap.to(item, {
            opacity: 0.5,
            y: 0,
            boxShadow: 'none',
            duration: 0.3,
            ease: 'power2.out'
          });
        }
      });

      document.querySelectorAll('.nav-section-header').forEach(header => {
        header.classList.remove('active');
      });
      const activeNav = document.querySelector(`[data-section="${sectionName}"] .nav-section-header`);
      if (activeNav) {
        activeNav.classList.add('active');
      }
    }

    // Initialize first section as active
    activateSection('essence');

    // Smooth scroll for nav links
    document.querySelectorAll('.nav-item').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const target = document.querySelector(link.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          document.querySelectorAll('.nav-item').forEach(l => l.classList.remove('active'));
          link.classList.add('active');
        }
      });
    });

    // Brushing interaction
    activityItems.forEach(item => {
      item.addEventListener('mouseenter', () => {
        const sectionName = item.dataset.section;
        const relatedSection = document.querySelector(`[data-activity="${sectionName}"]`);
        if (relatedSection) {
          relatedSection.style.backgroundColor = 'rgba(13, 147, 115, 0.05)';
          relatedSection.style.transition = 'background-color 0.3s ease';
        }
      });

      item.addEventListener('mouseleave', () => {
        const sectionName = item.dataset.section;
        const relatedSection = document.querySelector(`[data-activity="${sectionName}"]`);
        if (relatedSection) {
          relatedSection.style.backgroundColor = '';
        }
      });
    });
  </script>
</body>
</html>
