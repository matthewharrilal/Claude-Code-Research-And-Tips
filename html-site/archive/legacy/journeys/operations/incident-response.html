<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta data-pagefind-meta="chapter" content="Journeys">
  <meta data-pagefind-meta="section" content="Operations">
  <title>Incident Response + Failure Mode Catalog - Operations Journey</title>
  <link rel="stylesheet" href="../../css/style.css">
  <link rel="stylesheet" href="../../css/sidebar.css">
</head>
<body>
  <div class="page-with-sidebar">
    <!-- Sidebar Navigation -->
    <nav class="sidebar">
      <button class="sidebar-close" aria-label="Close sidebar">&times;</button>
      <div class="sidebar-header">
        <h2 class="sidebar-title"><a href="../../index.html">Claude Code KB</a></h2>
      </div>
      <ul class="sidebar-nav">
        <li class="nav-section">
          <div class="nav-section-title">Start Here</div>
          <ul class="nav-subsections">
            <li class="nav-page"><a href="../../start-here/index.html">Overview</a></li>
            <li class="nav-page"><a href="../../start-here/master-playbook.html">Master Playbook</a></li>
            <li class="nav-page"><a href="../../start-here/judgment-guide.html">Judgment Guide</a></li>
          </ul>
        </li>
        <li class="nav-section">
          <div class="nav-section-title">Foundations</div>
          <ul class="nav-subsections">
            <li class="nav-page"><a href="../../foundations/index.html">Overview</a></li>
            <li class="nav-page"><a href="../../foundations/principles/core.html">Core Principles</a></li>
            <li class="nav-page"><a href="../../foundations/architecture/complexity-ladder.html">Complexity Ladder</a></li>
          </ul>
        </li>
        <li class="nav-section">
          <div class="nav-section-title">Mental Models Journey</div>
          <ul class="nav-subsections">
            <li class="nav-page"><a href="../mental-models/index.html">Overview</a></li>
            <li class="nav-page"><a href="../mental-models/core-models.html">Core Models (1-10)</a></li>
            <li class="nav-page"><a href="../mental-models/advanced-models.html">Advanced Models (11-16)</a></li>
            <li class="nav-page"><a href="../mental-models/practice-heuristics.html">Practice &amp; Heuristics</a></li>
          </ul>
        </li>
        <li class="nav-section">
          <div class="nav-section-title">Architecture Journey</div>
          <ul class="nav-subsections">
            <li class="nav-page"><a href="../architecture/index.html">Overview</a></li>
            <li class="nav-page"><a href="../architecture/decision-framework.html">Decision Framework</a></li>
            <li class="nav-page"><a href="../architecture/core-patterns.html">Core Patterns</a></li>
            <li class="nav-page"><a href="../architecture/enterprise-swarm.html">Enterprise &amp; Swarm</a></li>
            <li class="nav-page"><a href="../architecture/context-composition.html">Context &amp; Composition</a></li>
          </ul>
        </li>
        <li class="nav-section">
          <div class="nav-section-title">Implementation Journey</div>
          <ul class="nav-subsections">
            <li class="nav-page"><a href="../implementation/index.html">Overview</a></li>
            <li class="nav-page"><a href="../implementation/context-state.html">Context &amp; State</a></li>
            <li class="nav-page"><a href="../implementation/ralph-production.html">Ralph Production</a></li>
            <li class="nav-page"><a href="../implementation/hooks-enterprise.html">Hooks &amp; Enterprise</a></li>
          </ul>
        </li>
        <li class="nav-section open">
          <div class="nav-section-title">Operations Journey</div>
          <ul class="nav-subsections">
            <li class="nav-page"><a href="../operations/index.html">Overview</a></li>
            <li class="nav-page"><a href="../operations/monitoring-cost.html">Monitoring &amp; Cost</a></li>
            <li class="nav-page"><a href="../operations/security-checklists.html">Security &amp; Checklists</a></li>
            <li class="nav-page current"><a href="../operations/incident-response.html">Incident Response</a></li>
          </ul>
        </li>
        <li class="nav-section">
          <div class="nav-section-title">Reference</div>
          <ul class="nav-subsections">
            <li class="nav-page"><a href="../foundations/invariants-reference.html">Invariants Reference</a></li>
            <li class="nav-page"><a href="../../reference/index.html">Full Reference</a></li>
            <li class="nav-page"><a href="../../reference/cost-analysis.html">Cost Analysis</a></li>
          </ul>
        </li>
      </ul>
    </nav>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay"></div>

    <!-- Main Content -->
    <main class="main-content">
      <nav class="breadcrumb">
        <a href="../../index.html">Home</a>
        <span class="breadcrumb-separator">/</span>
        <a href="../index.html">Journeys</a>
        <span class="breadcrumb-separator">/</span>
        <a href="index.html">Operations</a>
        <span class="breadcrumb-separator">/</span>
        <span class="breadcrumb-current">Incident Response</span>
      </nav>

      <div class="page-meta">
        <span class="page-meta-item">52 min read</span>
        <span class="page-meta-item">Emergency Reference</span>
      </div>

      <h1>Incident Response + Failure Mode Catalog</h1>

      <div class="context-box you-are-here">
        <h3>You Are Here</h3>
        <p><strong>The Big Picture:</strong> This is your emergency reference guide. When something goes wrong with Claude Code - context pollution, runaway costs, destructive commands, or multi-agent conflicts - come here. Find your symptoms in the failure mode catalog, follow the recovery procedure, and get back to work.</p>
        <p><strong>What this covers:</strong></p>
        <ul>
          <li>Incident response checklist (first 60 seconds)</li>
          <li>Detection signal matrix and decision trees</li>
          <li>Recovery procedures for common scenarios</li>
          <li>Full failure mode catalog (FM-001 through FM-013)</li>
          <li>Escalation criteria and severity levels</li>
          <li>Post-mortem template</li>
        </ul>
        <p><strong>When to use:</strong></p>
        <ul>
          <li><strong>EMERGENCY:</strong> Something is actively going wrong</li>
          <li><strong>PREVENTION:</strong> Review failure modes before deploying autonomous agents</li>
          <li><strong>POST-MORTEM:</strong> After recovery, understand what happened</li>
        </ul>
        <p><strong>Prerequisites:</strong></p>
        <ul>
          <li>Completed <a href="monitoring-cost.html">Monitoring + Cost Management</a></li>
          <li>Completed <a href="security-checklists.html">Security + Checklists</a></li>
        </ul>
        <p><strong>Coming from:</strong> <a href="security-checklists.html">Security + Checklists</a> | <strong>Going to:</strong> <a href="../mental-models/context-management.html">Mental Models</a></p>
      </div>

      <p>This is your emergency reference guide. When something goes wrong with Claude Code, come here. Find your symptoms in the failure mode catalog, follow the recovery procedure, and get back to work.</p>

      <hr class="section-divider">

      <h2 id="incident-checklist">Incident Response Checklist</h2>

      <h3>Immediate Actions (First 60 seconds)</h3>

      <ol>
        <li><strong>STOP</strong> Claude if still running (Ctrl+C or close terminal)</li>
        <li>Take a breath - do not make it worse with panic</li>
        <li>Screenshot any error messages</li>
        <li>Note the time</li>
        <li>Identify blast radius (single user vs. team vs. organization)</li>
      </ol>

      <h3>Assessment (Next 2 minutes)</h3>

      <ul>
        <li>What was Claude trying to do?</li>
        <li>What actually happened?</li>
        <li>What is the current state?</li>
        <li>Is data at risk?</li>
        <li>Check cost accumulation (if relevant)</li>
      </ul>

      <h3>Data Protection (If destructive action occurred)</h3>

      <ul>
        <li><strong>DO NOT</strong> make more changes</li>
        <li>Check git status - are changes staged?</li>
        <li>Check git reflog - can we recover?</li>
        <li>Check backups - Time Machine, cloud sync</li>
      </ul>

      <h3>Recovery</h3>

      <ul>
        <li>Identify failure mode from catalog (below)</li>
        <li>Follow specific recovery procedure</li>
        <li>Verify recovery was successful</li>
        <li>Document what happened</li>
      </ul>

      <hr class="section-divider">

      <h2 id="detection-matrix">Detection Signal Matrix</h2>

      <table>
        <thead>
          <tr>
            <th>Signal Type</th>
            <th>Detection Method</th>
            <th>Severity</th>
            <th>Auto-Response</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Test Failure</td>
            <td>Exit code != 0</td>
            <td>HIGH</td>
            <td>Block commit, retry once</td>
          </tr>
          <tr>
            <td>Typecheck Error</td>
            <td><code>tsc --noEmit</code></td>
            <td>HIGH</td>
            <td>Block edit, show error</td>
          </tr>
          <tr>
            <td>Context Critical</td>
            <td>HUD/estimate >90%</td>
            <td>CRITICAL</td>
            <td>Block operations, force reset</td>
          </tr>
          <tr>
            <td>Stuck Loop</td>
            <td>3+ iterations no commits</td>
            <td>HIGH</td>
            <td>Exit loop, notify</td>
          </tr>
          <tr>
            <td>Cost Exceeded</td>
            <td>Tracker > threshold</td>
            <td>CRITICAL</td>
            <td>Hard stop, notify</td>
          </tr>
          <tr>
            <td>Circular Edit</td>
            <td>Same file 10+ edits</td>
            <td>HIGH</td>
            <td>Block file edits</td>
          </tr>
          <tr>
            <td>Zombie Session</td>
            <td>Heartbeat >5 min stale</td>
            <td>MEDIUM</td>
            <td>Kill and restart</td>
          </tr>
          <tr>
            <td>Hallucination</td>
            <td>Reference non-existent file</td>
            <td>CRITICAL</td>
            <td>Immediate reset</td>
          </tr>
        </tbody>
      </table>

      <h3>Detection Decision Tree</h3>

      <div class="ascii-diagram">FAILURE DETECTION FLOWCHART
===================================================================

START: Operation attempted
  |
  +-> Was operation blocked by hook?
  |     |
  |     +-> YES: Check block reason
  |     |     |-- Dangerous command -> SEE: FM-003
  |     |     |-- Rate limited -> SEE: Recovery 5.2.5
  |     |     |-- Context critical -> SEE: FM-001
  |     |     +-- Cost exceeded -> SEE: FM-002
  |     |
  |     +-> NO: Continue
  |
  +-> Did operation return error?
  |     |
  |     |-- Test/Lint failure -> SEE: Recovery 5.2.3
  |     |-- Git conflict -> SEE: Recovery 5.2.6
  |     +-- File not found -> Check for hallucination
  |
  +-> Is progress being made?
        |
        |-- Commits happening -> Normal operation
        +-- No commits -> SEE: Stuck Detection

===================================================================</div>

      <hr class="section-divider">

      <!-- Woven Summary: Error Taxonomy -->
      <div class="woven-summary" style="background: linear-gradient(135deg, #fef6f5 0%, #fefcf3 100%); border-left: 4px solid #c97065; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <h3 style="color: #c97065; margin-top: 0; font-size: 1.1em;">Deep Dive: The Complete Error Taxonomy</h3>
        <p>Agent failures fall into 9 major categories. Understanding this taxonomy helps you diagnose issues faster and build systematic defenses.</p>

        <h4>Error Category Overview</h4>
        <table style="width: 100%; border-collapse: collapse; margin: 1rem 0;">
          <thead>
            <tr style="background: #f5e0de;">
              <th style="padding: 0.5rem; border: 1px solid #e0d5c5; text-align: left;">Category</th>
              <th style="padding: 0.5rem; border: 1px solid #e0d5c5; text-align: left;">Root Cause</th>
              <th style="padding: 0.5rem; border: 1px solid #e0d5c5; text-align: left;">Primary Recovery</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;"><strong>Context Window</strong></td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Token exhaustion, quality degradation</td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Fresh session, Ralph pattern</td>
            </tr>
            <tr>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;"><strong>Merge/Version Control</strong></td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Parallel agent conflicts</td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Git worktrees, directory ownership</td>
            </tr>
            <tr>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;"><strong>Validation</strong></td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">False positive tests, optimistic marking</td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Layered verification, exit code checks</td>
            </tr>
            <tr>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;"><strong>Rate Limit/API</strong></td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Token burst, shared key contention</td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Stagger agents, separate keys</td>
            </tr>
            <tr>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;"><strong>Infinite Loop</strong></td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">No completion criteria, stuck detection miss</td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">--max-iterations, timeout wrapper</td>
            </tr>
            <tr>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;"><strong>Cost/Resource</strong></td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Runaway loops, wrong model selection</td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Budget caps, tiered model routing</td>
            </tr>
            <tr>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;"><strong>Security</strong></td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Credential exposure, path traversal</td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Permission gating, .claudeignore</td>
            </tr>
            <tr>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;"><strong>Orchestration</strong></td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Worker recursion, role confusion</td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Worker preambles, tool separation</td>
            </tr>
            <tr>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;"><strong>State Divergence</strong></td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Memory not persisting, stale context</td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">External state files, git commits</td>
            </tr>
          </tbody>
        </table>

        <h4>The 80-20 Rule</h4>
        <p><strong>80% of failures come from:</strong> Context exhaustion, missing verification, and vague instructions. Address these three and you prevent the majority of incidents.</p>

        <p style="margin-bottom: 0;"><a href="../../synthesis/error-taxonomy-recovery.html" style="color: #2a7d7d;">Full Error Taxonomy Reference</a> - 35+ specific error types with symptoms, causes, and recovery procedures.</p>
      </div>

      <h2 id="recovery-procedures">Recovery Procedures</h2>

      <h3 id="context-recovery">Context Exhaustion Recovery</h3>

      <p><strong>Trigger:</strong> Context usage >85% OR behavioral degradation observed</p>

      <p><strong>Symptoms:</strong></p>
      <ul>
        <li>Claude HUD shows red bar</li>
        <li>Response quality degraded</li>
        <li>Instructions being ignored</li>
        <li>Hallucinated file references</li>
      </ul>

      <div class="ascii-diagram">STEP 1: STOP NEW WORK
|-- Do not start new operations
|-- Do not request complex analyses
+-- Minimize further context consumption

STEP 2: EXTRACT STATE (30 seconds)
|-- Command: "Write current progress to thoughts/progress-[task].md"
|-- Include: What's done, what remains, key decisions, blockers
+-- Verify file was written

STEP 3: COMMIT CHECKPOINT
|-- git add thoughts/
|-- git commit -m "Session checkpoint before reset"
+-- Optional: git stash uncommitted work

STEP 4: RESET CONTEXT
|-- Option A: /clear then /catchup (soft reset)
|-- Option B: exit then claude (hard reset)
+-- For critical: exit, new terminal, claude

STEP 5: RECOVER IN NEW SESSION
|-- First prompt: "Read thoughts/progress-[task].md and continue"
|-- Verify Claude understands state before proceeding
+-- Resume work</div>

      <p><strong>Recovery Time:</strong> 2-3 minutes</p>

      <h3 id="cost-recovery">Cost Limit Recovery</h3>

      <p><strong>Trigger:</strong> Session cost exceeds threshold ($25-50)</p>

      <div class="ascii-diagram">STEP 1: ACKNOWLEDGE LIMIT
|-- Do NOT attempt to bypass
|-- This is a safety mechanism
+-- Review what was accomplished

STEP 2: ASSESS VALUE
|-- Was the work productive? (commits made, tests passing)
|-- Was there runaway behavior? (no commits, circular edits)
+-- Decision point: Continue or investigate

STEP 3: IF PRODUCTIVE
|-- Increase budget if justified
|-- Edit ~/.claude/hooks/cost-monitor.sh
|-- Update HARD_LIMIT_USD appropriately
+-- Continue session

STEP 4: IF RUNAWAY
|-- Do NOT increase budget
|-- Investigate root cause:
|   |-- Check iteration count vs commits
|   |-- Check for circular patterns
|   +-- Review tool call frequency
|-- Reset session with better constraints
+-- Add --max-iterations to prevent recurrence</div>

      <p><strong>Recovery Time:</strong> 5-10 minutes</p>

      <h3 id="test-recovery">Test/Lint Failure Recovery</h3>

      <p><strong>Trigger:</strong> Test or typecheck fails after code change</p>

      <div class="ascii-diagram">STEP 1: IDENTIFY FAILURE SCOPE
|-- How many tests failing?
|   |-- 1-3: Likely fixable
|   |-- 4-10: May need approach change
|   +-- >10: Possible breaking change
+-- Which files are affected?

STEP 2: IF MINOR FAILURE (1-3 tests)
|-- Request: "Fix the failing tests: [error message]"
|-- One retry attempt
+-- If still failing -> STEP 4

STEP 3: IF MAJOR FAILURE (4+ tests)
|-- Request: "Review the test failures and explain what went wrong"
|-- Assess: Is the approach correct?
|-- If approach wrong -> git checkout to revert, try different approach
+-- If approach right -> Fix incrementally, one test at a time

STEP 4: IF PERSISTENT FAILURE
|-- Rollback: git checkout HEAD -- [affected files]
|-- Checkpoint: Write what was attempted to thoughts/debug-[task].md
|-- Reset context if >70%
+-- Try alternative approach in fresh session</div>

      <p><strong>Recovery Time:</strong> 5-15 minutes</p>

      <h3 id="git-recovery">Git Snapshot Rollback</h3>

      <p><strong>Trigger:</strong> Operation failure requiring clean state recovery</p>

      <div class="code-block">
        <button class="copy-btn">Copy</button>
        <pre><code># Pre-operation snapshot
git add -A && git stash

# ... execute operation ...

# On success:
git stash drop

# On failure:
git stash pop
git checkout -- .</code></pre>
      </div>

      <h3 id="provider-fallback">Provider Fallback Configuration</h3>

      <div class="code-block">
        <button class="copy-btn">Copy</button>
        <pre><code># Automatic failover when primary model fails

litellm_settings:
  fallbacks:
    # Standard fallback: primary -> secondary -> tertiary
    - claude-sonnet: [gpt-4, claude-haiku]

  content_policy_fallbacks:
    # When content filtered: try different provider
    - claude-sonnet: [gpt-4]

  context_window_fallbacks:
    # When context exceeds limits: try larger model
    - claude-sonnet: [claude-opus]

# Retry configuration
litellm_settings:
  num_retries: 3
  allowed_fails: 3
  cooldown_time: 30  # seconds</code></pre>
      </div>

      <h3 id="circuit-breaker">Circuit Breaker Recovery</h3>

      <p><strong>Trigger:</strong> Multiple consecutive failures or runaway conditions</p>

      <div class="code-block">
        <button class="copy-btn">Copy</button>
        <pre><code>#!/bin/bash
# circuit-breaker.sh - Prevents runaway loops

BREAKER_STATE="/tmp/circuit-breaker.json"

# Load state
CONSECUTIVE_FAILURES=$(jq -r '.consecutive_failures // 0' "$BREAKER_STATE" 2>/dev/null || echo 0)
COST_ACCUMULATED=$(jq -r '.cost_accumulated // 0' "$BREAKER_STATE" 2>/dev/null || echo 0)
START_TIME=$(jq -r '.start_time // 0' "$BREAKER_STATE" 2>/dev/null || echo 0)

# Thresholds
MAX_CONSECUTIVE_FAILURES=5
MAX_COST_USD=20
MAX_TIME_SECONDS=14400  # 4 hours

CURRENT_TIME=$(date +%s)
ELAPSED=$((CURRENT_TIME - START_TIME))

# Check circuit breaker conditions
if [ "$CONSECUTIVE_FAILURES" -ge "$MAX_CONSECUTIVE_FAILURES" ]; then
    echo "CIRCUIT BREAKER: $CONSECUTIVE_FAILURES consecutive failures" >&2
    echo "Pausing loop for human review" >&2
    exit 42
fi

if (( $(echo "$COST_ACCUMULATED >= $MAX_COST_USD" | bc -l) )); then
    echo "CIRCUIT BREAKER: Cost \$$COST_ACCUMULATED exceeds \$$MAX_COST_USD" >&2
    exit 42
fi

if [ "$ELAPSED" -ge "$MAX_TIME_SECONDS" ]; then
    echo "CIRCUIT BREAKER: Time ${ELAPSED}s exceeds ${MAX_TIME_SECONDS}s" >&2
    exit 42
fi

exit 0</code></pre>
      </div>

      <hr class="section-divider">

      <!-- Woven Summary: Debugging Framework -->
      <div class="woven-summary" style="background: linear-gradient(135deg, #f5f0e8 0%, #fefcf3 100%); border-left: 4px solid #c49052; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <h3 style="color: #c49052; margin-top: 0; font-size: 1.1em;">Deep Dive: The OHIV Diagnosis Framework</h3>
        <p>Systematic diagnosis prevents panic-driven decisions. The OHIV framework (Observe, Hypothesize, Isolate, Verify) provides structure during incidents.</p>

        <h4>OHIV in Practice</h4>
        <div class="code-block" style="background: #f0ebe3; padding: 1rem; border-radius: 6px; margin: 1rem 0;">
          <pre style="margin: 0; font-family: monospace; font-size: 0.9em;"><code>OBSERVE: Gather all evidence before assumptions
|-- Claude HUD: Context %, tool activity
|-- Git log: Recent commits, commit frequency
|-- progress.txt: What agent claims it did
|-- Test output: Pass/fail, error messages
+-- Resource state: Disk, processes, costs

HYPOTHESIZE: Form theories based on evidence
|-- Context exhaustion if % > 85%
|-- Stuck loop if no commits > 10 min
|-- Cost runaway if $ > threshold
+-- Security issue if blocked command

ISOLATE: Test one variable at a time
|-- Fresh session (context issue?)
|-- Same task, different agent (agent issue?)
|-- Manual execution (task issue?)
+-- Different model (capability issue?)

VERIFY: Confirm the fix actually works
|-- Tests pass
|-- Behavior correct
|-- No regression in other areas
+-- Document for future prevention</code></pre>
        </div>

        <h4>The Failure Cascade Pattern</h4>
        <p><strong>Critical insight:</strong> Agent failures cascade. A small issue in iteration 1 becomes three problems by iteration 3. The cost of recovery grows exponentially with each iteration. <em>Catch failures early.</em></p>

        <p style="margin-bottom: 0;"><a href="../../synthesis/debugging-agent-failures.html" style="color: #2a7d7d;">Full Debugging Guide</a> - Case studies from production, mental models, and decision trees for diagnosis.</p>
      </div>

      <h2 id="escalation">Escalation Criteria</h2>

      <table>
        <thead>
          <tr>
            <th>Condition</th>
            <th>Auto-Handle?</th>
            <th>Escalation Level</th>
            <th>Notification</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Test failure (1-3 tests)</td>
            <td>YES</td>
            <td>None</td>
            <td>Console only</td>
          </tr>
          <tr>
            <td>Test failure (4+ tests)</td>
            <td>NO</td>
            <td>L1: Review</td>
            <td>Console warning</td>
          </tr>
          <tr>
            <td>Context >90%</td>
            <td>PARTIAL</td>
            <td>L1: Alert</td>
            <td>Console + checkpoint</td>
          </tr>
          <tr>
            <td>Cost >$25</td>
            <td>NO</td>
            <td>L2: Approve</td>
            <td>Push notification</td>
          </tr>
          <tr>
            <td>Dangerous command blocked</td>
            <td>NO</td>
            <td>L2: Manual</td>
            <td>Console block</td>
          </tr>
          <tr>
            <td>Database operation</td>
            <td>NO</td>
            <td>L3: Critical</td>
            <td>Block + notify</td>
          </tr>
          <tr>
            <td>Production path access</td>
            <td>NO</td>
            <td>L3: Critical</td>
            <td>Block + notify</td>
          </tr>
          <tr>
            <td>Credential exposed</td>
            <td>NO</td>
            <td>L3: Security</td>
            <td>Security team</td>
          </tr>
          <tr>
            <td>Hallucinated file reference</td>
            <td>NO</td>
            <td>L3: Critical</td>
            <td>Immediate stop</td>
          </tr>
        </tbody>
      </table>

      <div class="ascii-diagram">ESCALATION HIERARCHY
===================================================================

L0: AUTO-HANDLE
|-- Transient failures (retry)
|-- Minor test failures (fix and continue)
|-- Rate limit warnings (wait and continue)
+-- Resource warnings (log and continue)

L1: REVIEW REQUIRED
|-- Multiple test failures
|-- Context near limits
|-- Unusual patterns detected
+-- Human should review before continuing

L2: APPROVAL REQUIRED
|-- Cost threshold exceeded
|-- Dangerous commands needed
|-- Stuck detection triggered
+-- Requires explicit human decision

L3: CRITICAL - IMMEDIATE STOP
|-- Production/database operations
|-- Credential access attempts
|-- Hallucination detected
|-- Security-sensitive operations
+-- NEVER auto-proceed

===================================================================</div>

      <hr class="section-divider">

      <!-- Woven Summary: Migration and Recovery Decisions -->
      <div class="woven-summary" style="background: linear-gradient(135deg, #f5f0e8 0%, #fefcf3 100%); border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <h3 style="color: #6b9b7a; margin-top: 0; font-size: 1.1em;">Deep Dive: Recovery Decision Tree</h3>
        <p>When incidents occur, you need to decide: recover in place, migrate to a different pattern, or downgrade to something simpler. This decision tree helps.</p>

        <h4>Recovery vs. Migration Decision</h4>
        <table style="width: 100%; border-collapse: collapse; margin: 1rem 0;">
          <thead>
            <tr style="background: #e0d5c5;">
              <th style="padding: 0.5rem; border: 1px solid #e0d5c5; text-align: left;">Symptom</th>
              <th style="padding: 0.5rem; border: 1px solid #e0d5c5; text-align: left;">Recovery</th>
              <th style="padding: 0.5rem; border: 1px solid #e0d5c5; text-align: left;">Migration</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Single session context exhaustion</td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Fresh session, /compact</td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">N/A - normal operation</td>
            </tr>
            <tr>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Repeated context issues across sessions</td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Review .claudeignore</td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Adopt Ralph pattern</td>
            </tr>
            <tr>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Waiting on Ralph while work exists</td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Parallelize stories</td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Adopt CC Mirror</td>
            </tr>
            <tr>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Agents overwriting each other</td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Git worktrees</td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Adopt Gas Town (Refinery)</td>
            </tr>
            <tr>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Costs spiraling despite limits</td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Tiered model routing</td>
              <td style="padding: 0.5rem; border: 1px solid #e0d5c5;">Downgrade to simpler pattern</td>
            </tr>
          </tbody>
        </table>

        <h4>When to Downgrade</h4>
        <p>More complex patterns are not always better. Downgrade when:</p>
        <ul>
          <li>Overhead exceeds value (spending more time managing agents than doing work)</li>
          <li>Cost > 3x simpler approach without proportional value</li>
          <li>Team lacks expertise to maintain the pattern</li>
          <li>Single-threaded work is fine and you added complexity prematurely</li>
        </ul>

        <p style="margin-bottom: 0;"><a href="../../synthesis/cross-pattern-migration.html" style="color: #2a7d7d;">Full Migration Guide</a> - Step-by-step migration scripts, state preservation, and rollback procedures.</p>
      </div>

      <h2 id="failure-modes">Failure Mode Catalog</h2>

      <details class="troubleshoot">
        <summary>FM-001: Context Pollution Death Spiral (CRITICAL)</summary>
        <div class="troubleshoot-content">
          <p><strong>Frequency:</strong> Common in extended sessions</p>
          <p><strong>War Story:</strong> 3.2M Token Circular Revisions (72 hours)</p>

          <p><strong>Symptoms:</strong></p>
          <ul>
            <li>Same file edited 5+ times with similar changes</li>
            <li>Claude contradicting itself within same response</li>
            <li>Test "fixes" that do not fix the test</li>
            <li>Instructions from CLAUDE.md being ignored</li>
          </ul>

          <p><strong>Root Cause Chain:</strong></p>
          <ol>
            <li>Session runs long without checkpointing</li>
            <li>Context fills with outdated information</li>
            <li>Recent instructions pushed out of attention window</li>
            <li>Claude reverts to earlier patterns</li>
            <li>Changes conflict with recent decisions</li>
            <li>Attempts to fix create more context</li>
            <li>Spiral accelerates</li>
          </ol>

          <div class="troubleshoot-fix">
            <div class="troubleshoot-fix-label">Recovery</div>
            <p>See Context Exhaustion Recovery above.</p>
          </div>

          <p><strong>Prevention:</strong></p>
          <ul>
            <li>Time-box sessions to 30-45 minutes for complex work</li>
            <li>Install Claude HUD for context visibility</li>
            <li>Checkpoint at every milestone</li>
            <li>Use Ralph pattern (fresh context per iteration) for autonomous work</li>
          </ul>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>FM-002: Runaway Cost Loop (CRITICAL)</summary>
        <div class="troubleshoot-content">
          <p><strong>Frequency:</strong> Rare but catastrophic</p>
          <p><strong>War Story:</strong> $47,000 Recursive Loop (11 days)</p>

          <p><strong>Symptoms:</strong></p>
          <ul>
            <li>Iteration count climbing without commits</li>
            <li>Cost accumulating rapidly</li>
            <li>Agent retry-on-failure without limits</li>
            <li>Same operations repeated</li>
          </ul>

          <p><strong>Root Cause Chain:</strong></p>
          <ol>
            <li>No --max-iterations limit set</li>
            <li>Agent interprets failure as "try again"</li>
            <li>Failure continues (underlying issue not addressed)</li>
            <li>Each retry costs money</li>
            <li>No human oversight during extended period</li>
            <li>Costs accumulate unnoticed</li>
          </ol>

          <div class="troubleshoot-fix">
            <div class="troubleshoot-fix-label">Prevention</div>
            <ul>
              <li><strong>ALWAYS</strong> set <code>--max-iterations</code> on any loop</li>
              <li><strong>ALWAYS</strong> wrap in <code>timeout</code> command</li>
              <li>Configure cost tracking and alerts</li>
              <li>Set Anthropic Console spending limits</li>
            </ul>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>FM-003: Destructive Command Execution (CRITICAL)</summary>
        <div class="troubleshoot-content">
          <p><strong>Frequency:</strong> Rare but devastating</p>
          <p><strong>War Story:</strong> Home Directory Deletion, Production DB Wipe</p>

          <p><strong>Symptoms:</strong></p>
          <ul>
            <li>Files/data missing after Claude operation</li>
            <li>Unexpected destructive command in history</li>
            <li>Unable to recover data</li>
          </ul>

          <p><strong>Root Cause Chain:</strong></p>
          <ol>
            <li>No command blocklist configured</li>
            <li>Context pollution or hallucination</li>
            <li>Claude constructs dangerous command</li>
            <li>No human review before execution</li>
            <li>Command executes with full privileges</li>
            <li>Data destroyed, potentially unrecoverable</li>
          </ol>

          <div class="troubleshoot-fix">
            <div class="troubleshoot-fix-label">Recovery</div>
            <ol>
              <li>ASSESS damage immediately</li>
              <li>If git-tracked files: <code>git checkout HEAD -- [files]</code></li>
              <li>If untracked: Check backups, Time Machine, cloud sync</li>
              <li>If no backup exists: Professional data recovery</li>
              <li>Document what happened for prevention</li>
            </ol>
          </div>

          <p><strong>Prevention:</strong></p>
          <ul>
            <li>Install command blocklist hook (MANDATORY)</li>
            <li>Run Claude in Docker container for autonomous work</li>
            <li>Commit before Claude sessions (git safety net)</li>
            <li>Maintain off-machine backups</li>
            <li>Never run with elevated privileges</li>
          </ul>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>FM-004: Zombie Agent Session (MEDIUM)</summary>
        <div class="troubleshoot-content">
          <p><strong>Frequency:</strong> Occasional</p>

          <p><strong>Symptoms:</strong></p>
          <ul>
            <li>Session exists but agent unresponsive</li>
            <li>Heartbeat file stale (>5 minutes)</li>
            <li>No tool calls being made</li>
            <li>Terminal shows no activity</li>
          </ul>

          <div class="troubleshoot-fix">
            <div class="troubleshoot-fix-label">Recovery</div>
            <div class="code-block">
              <button class="copy-btn">Copy</button>
              <pre><code># 1. Check session status
tmux ls

# 2. Kill zombie session
tmux kill-session -t [name]

# 3. Check for orphaned processes
pgrep -f claude

# 4. Kill orphans
pkill -f claude

# 5. Clean up worktrees
git worktree prune

# 6. Restart fresh
claude</code></pre>
            </div>
          </div>

          <p><strong>Prevention:</strong></p>
          <ul>
            <li>Implement heartbeat monitoring</li>
            <li>Add external health check cron job</li>
            <li>Set timeouts on all operations</li>
            <li>Use Claude Squad or similar for managed sessions</li>
          </ul>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>FM-005: Multi-Agent Conflict (HIGH)</summary>
        <div class="troubleshoot-content">
          <p><strong>Frequency:</strong> Common without isolation</p>
          <p><strong>War Story:</strong> "All hell breaks loose" without isolation</p>

          <p><strong>Symptoms:</strong></p>
          <ul>
            <li>Git merge conflicts appearing unexpectedly</li>
            <li>Files changing when they should not</li>
            <li>Test failures in unrelated code</li>
            <li>Agents producing conflicting outputs</li>
          </ul>

          <div class="troubleshoot-fix">
            <div class="troubleshoot-fix-label">Recovery</div>
            <ol>
              <li>STOP all agents</li>
              <li>Identify conflicting changes: <code>git diff</code></li>
              <li>Resolve conflicts manually</li>
              <li>Commit resolution</li>
              <li>Restart agents with proper isolation</li>
            </ol>
          </div>

          <p><strong>Prevention:</strong></p>
          <ul>
            <li>Use git worktrees for parallel agents (Claude Squad pattern)</li>
            <li>Assign agents to non-overlapping file sets</li>
            <li>Implement file locking or conflict detection</li>
            <li>Use orchestration layer for coordination</li>
          </ul>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>FM-006: Resource Exhaustion (MEDIUM-HIGH)</summary>
        <div class="troubleshoot-content">
          <p><strong>Frequency:</strong> Occasional</p>
          <p><strong>War Story:</strong> 200GB+ Debug Directory</p>

          <p><strong>Symptoms:</strong></p>
          <ul>
            <li>Disk space running low</li>
            <li>Debug directories growing</li>
            <li>System performance degrading</li>
            <li>Swap usage increasing</li>
          </ul>

          <div class="troubleshoot-fix">
            <div class="troubleshoot-fix-label">Recovery</div>
            <div class="code-block">
              <button class="copy-btn">Copy</button>
              <pre><code># 1. Identify large directories
du -sh ~/.claude/*

# 2. Clean debug
rm -rf ~/.claude/debug/*

# 3. Clean old logs
find ~/.claude -name "*.log" -mtime +7 -delete

# 4. Clean rate limit tracking
rm -rf ~/.claude/rate-limits/*

# 5. Verify space freed
df -h</code></pre>
            </div>
          </div>

          <p><strong>Prevention:</strong></p>
          <ul>
            <li>Schedule cleanup cron job (hourly or daily)</li>
            <li>Monitor disk usage in SessionStart hook</li>
            <li>Set alerts for >1GB Claude directory</li>
            <li>Configure log rotation</li>
          </ul>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>FM-007: Byzantine Failure (Multi-Agent) (HIGH)</summary>
        <div class="troubleshoot-content">
          <p><strong>Frequency:</strong> Rare in well-configured systems</p>

          <p><strong>Symptoms:</strong></p>
          <ul>
            <li>Consensus failures (agents disagree)</li>
            <li>Timeout patterns (agent unresponsive)</li>
            <li>Output anomalies (incorrect results from subset)</li>
          </ul>

          <div class="troubleshoot-fix">
            <div class="troubleshoot-fix-label">Configuration</div>
            <p><strong>Requirement:</strong> 2f+1 agents where f = tolerated failures</p>
            <ul>
              <li>3 agents can tolerate 1 failure</li>
              <li>5 agents can tolerate 2 failures</li>
              <li>7 agents can tolerate 3 failures</li>
            </ul>
            <p><strong>Recovery:</strong></p>
            <ol>
              <li>Detect agent failure (timeout, crash, incorrect output)</li>
              <li>Mark agent as failed</li>
              <li>Continue with remaining agents</li>
              <li>Spawn replacement if below f+1 threshold</li>
              <li>Rebalance workload</li>
            </ol>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>FM-008: Multi-Tenant Cost Spillover (HIGH)</summary>
        <div class="troubleshoot-content">
          <p><strong>Frequency:</strong> Common without budget isolation</p>

          <p><strong>Symptoms:</strong></p>
          <ul>
            <li>One team/user exhausting shared budget</li>
            <li>Other teams blocked unexpectedly</li>
            <li>No visibility into per-team spending</li>
          </ul>

          <div class="troubleshoot-fix">
            <div class="troubleshoot-fix-label">Recovery</div>
            <ol>
              <li>Identify high-spending team/user via LiteLLM dashboard</li>
              <li>Temporarily reduce their quota</li>
              <li>Reallocate budget if needed</li>
              <li>Implement per-team budgets to prevent recurrence</li>
            </ol>
          </div>

          <p><strong>Prevention:</strong></p>
          <ul>
            <li>Implement three-level budget hierarchy</li>
            <li>Set per-team and per-user quotas</li>
            <li>Configure budget alerts per team</li>
            <li>Regular budget utilization review</li>
          </ul>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>FM-009: HITL Approval Bypass (CRITICAL)</summary>
        <div class="troubleshoot-content">
          <p><strong>Frequency:</strong> Rare but severe</p>
          <p><strong>Source:</strong> 12-factor-agents Factor 7</p>

          <p><strong>Symptoms:</strong></p>
          <ul>
            <li>High-stakes operation executed without human approval</li>
            <li>HITL gate circumvented or ignored</li>
            <li>Compliance audit shows gap in approval chain</li>
            <li>Sensitive operation lacks approval record</li>
          </ul>

          <p><strong>Root Cause Chain:</strong></p>
          <ol>
            <li>HITL approval gate not properly configured</li>
            <li>OR approval timeout defaulted to "allow" instead of "deny"</li>
            <li>OR agent found alternative path bypassing gate</li>
            <li>High-stakes operation executes</li>
            <li>No human oversight occurred</li>
            <li>Potential compliance/security violation</li>
          </ol>

          <div class="troubleshoot-fix">
            <div class="troubleshoot-fix-label">Prevention</div>
            <ul>
              <li>Configure HITL timeouts to <strong>deny</strong> by default</li>
              <li>Use deterministic <code>@require_approval()</code> decorators</li>
              <li>Audit all high-stakes paths for HITL coverage</li>
              <li>Test approval flows regularly</li>
            </ul>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>FM-010: Prompt Injection Compromise (CRITICAL)</summary>
        <div class="troubleshoot-content">
          <p><strong>Frequency:</strong> Increasing in multi-agent systems</p>
          <p><strong>Source:</strong> anthropic-cookbook tool validation</p>

          <p><strong>Symptoms:</strong></p>
          <ul>
            <li>Unexpected behavior after processing external input</li>
            <li>Tool calls with suspicious parameters</li>
            <li>Agent acting contrary to instructions</li>
            <li>Malicious commands in output</li>
          </ul>

          <div class="troubleshoot-fix">
            <div class="troubleshoot-fix-label">Recovery</div>
            <ol>
              <li>Immediately stop agent execution</li>
              <li>Identify injection source</li>
              <li>Quarantine/remove malicious input</li>
              <li>Review all operations since injection</li>
              <li>Rollback affected changes</li>
              <li>Log to Compliance Ledger</li>
            </ol>
          </div>

          <p><strong>Prevention:</strong></p>
          <ul>
            <li>Install tool input validation hook</li>
            <li>Validate all external inputs before use</li>
            <li>Use cookbook injection defense patterns</li>
            <li>Monitor for unusual tool call patterns</li>
            <li>Sandbox external content processing</li>
          </ul>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>FM-011: Control Manifest Violation (HIGH-CRITICAL)</summary>
        <div class="troubleshoot-content">
          <p><strong>Frequency:</strong> Occasional in complex projects</p>
          <p><strong>Source:</strong> BMAD-METHOD</p>

          <p><strong>Symptoms:</strong></p>
          <ul>
            <li>Protected zone file modified without approval</li>
            <li>Security constraint check failed</li>
            <li>Compliance Ledger shows unauthorized operation</li>
            <li>SOC2/HIPAA audit gap identified</li>
          </ul>

          <div class="troubleshoot-fix">
            <div class="troubleshoot-fix-label">Recovery</div>
            <ol>
              <li>Identify what was modified</li>
              <li>Check if modification was legitimate but misconfigured</li>
              <li>If legitimate: Update Control Manifest, log exception</li>
              <li>If unauthorized: Rollback, investigate, escalate</li>
              <li>Extract compliance report from ledger</li>
              <li>Update manifest patterns to close gap</li>
            </ol>
          </div>

          <p><strong>Prevention:</strong></p>
          <ul>
            <li>Keep Control Manifest current with project structure</li>
            <li>Run security-manifest-check.sh in PreToolUse hook</li>
            <li>Regular compliance ledger audits</li>
            <li>Test protected zones with dry-run operations</li>
          </ul>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>FM-012: Swarm Consensus Failure (HIGH)</summary>
        <div class="troubleshoot-content">
          <p><strong>Frequency:</strong> Occasional in multi-agent systems</p>
          <p><strong>Source:</strong> swarms multi-agent coordination</p>

          <p><strong>Symptoms:</strong></p>
          <ul>
            <li>Agents repeatedly re-propose conflicting solutions</li>
            <li>Voting rounds exceed timeout thresholds</li>
            <li>Coordination topology shows split decisions</li>
            <li>Progress log shows oscillating state changes</li>
            <li>Task completion stalls despite active agents</li>
          </ul>

          <p><strong>Root Causes:</strong></p>
          <ul>
            <li>Incompatible success criteria - Agents have different definitions of "done"</li>
            <li>Conflicting context - Agents loaded different versions of requirements</li>
            <li>Byzantine agent - One agent consistently votes against valid solutions</li>
            <li>Timeout misconfiguration - Consensus window too short for task complexity</li>
          </ul>

          <div class="troubleshoot-fix">
            <div class="troubleshoot-fix-label">Recovery</div>
            <ol>
              <li><strong>Pause swarm</strong> - Stop new task assignments</li>
              <li><strong>Extract voting history</strong> - <code>cat swarm-votes.log | grep -A5 "ROUND"</code></li>
              <li><strong>Identify disagreeing agents</strong> - Find agents with minority votes</li>
              <li><strong>Check agent contexts</strong> - Verify all agents have same requirements</li>
              <li><strong>Resolve or escalate:</strong>
                <ul>
                  <li>If context mismatch: Resync contexts, retry</li>
                  <li>If criteria conflict: Human decides success criteria</li>
                  <li>If byzantine agent: Quarantine agent, investigate</li>
                </ul>
              </li>
              <li><strong>Resume with consensus</strong> - Clear vote history, restart round</li>
            </ol>
          </div>

          <p><strong>Prevention:</strong></p>
          <ul>
            <li>Define explicit success criteria in task specification</li>
            <li>Use appropriate topology for task type</li>
            <li>Set consensus timeout proportional to task complexity</li>
            <li>Implement vote logging from the start</li>
          </ul>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>FM-013: Distributed State Divergence (HIGH)</summary>
        <div class="troubleshoot-content">
          <p><strong>Frequency:</strong> Occasional in multi-agent systems</p>
          <p><strong>Source:</strong> swarms state synchronization</p>

          <p><strong>Symptoms:</strong></p>
          <ul>
            <li>Agent A reports task complete, Agent B still working on same task</li>
            <li>File conflicts between agents working on "different" files</li>
            <li>Progress reports show impossible states (e.g., 150% complete)</li>
            <li>Coordination messages reference non-existent state</li>
            <li>Agents "forget" completed work and re-attempt finished tasks</li>
          </ul>

          <p><strong>Root Causes:</strong></p>
          <ul>
            <li>Race condition - Multiple agents update shared state simultaneously</li>
            <li>Stale cache - Agent's local state not refreshed before action</li>
            <li>Partition - Network/file system latency causes read-before-write conflicts</li>
            <li>Missing sync point - No barrier between dependent operations</li>
            <li>Corrupted state file - Concurrent writes damage shared state</li>
          </ul>

          <div class="troubleshoot-fix">
            <div class="troubleshoot-fix-label">Recovery</div>
            <ol>
              <li><strong>Freeze all agents</strong> - Prevent further state modifications</li>
              <li><strong>Capture current states</strong></li>
              <li><strong>Identify divergence point</strong> - Git log or state history</li>
              <li><strong>Determine authoritative state</strong> - Most recent consistent state, OR human review</li>
              <li><strong>Rebuild shared state</strong> - Merge valid changes, discard conflicts</li>
              <li><strong>Resync all agents</strong></li>
              <li><strong>Resume with barrier</strong> - All agents confirm sync before proceeding</li>
            </ol>
          </div>

          <p><strong>Prevention:</strong></p>
          <ul>
            <li>Use file locking or atomic operations for state updates</li>
            <li>Implement sync barriers at stage boundaries</li>
            <li>Include state hash in agent health checks</li>
            <li>Regular state consistency audits</li>
            <li>Design for idempotent operations (re-running is safe)</li>
          </ul>
        </div>
      </details>

      <hr class="section-divider">

      <h2 id="quick-reference">Failure Mode Quick Reference</h2>

      <table>
        <thead>
          <tr>
            <th>Code</th>
            <th>Name</th>
            <th>Severity</th>
            <th>Detection</th>
            <th>Recovery Time</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>FM-001</td>
            <td>Context Pollution</td>
            <td>CRITICAL</td>
            <td>Behavioral</td>
            <td>2-5 min</td>
          </tr>
          <tr>
            <td>FM-002</td>
            <td>Runaway Costs</td>
            <td>CRITICAL</td>
            <td>Cost monitor</td>
            <td>Immediate</td>
          </tr>
          <tr>
            <td>FM-003</td>
            <td>Destructive Command</td>
            <td>CRITICAL</td>
            <td>Post-mortem</td>
            <td>Varies</td>
          </tr>
          <tr>
            <td>FM-004</td>
            <td>Zombie Session</td>
            <td>MEDIUM</td>
            <td>Heartbeat</td>
            <td>1-2 min</td>
          </tr>
          <tr>
            <td>FM-005</td>
            <td>Multi-Agent Conflict</td>
            <td>HIGH</td>
            <td>Git status</td>
            <td>5-30 min</td>
          </tr>
          <tr>
            <td>FM-006</td>
            <td>Resource Exhaustion</td>
            <td>MEDIUM</td>
            <td>Disk check</td>
            <td>1-5 min</td>
          </tr>
          <tr>
            <td>FM-007</td>
            <td>Byzantine Failure</td>
            <td>HIGH</td>
            <td>Consensus check</td>
            <td>5-15 min</td>
          </tr>
          <tr>
            <td>FM-008</td>
            <td>Multi-Tenant Spillover</td>
            <td>HIGH</td>
            <td>Budget dashboard</td>
            <td>10-30 min</td>
          </tr>
          <tr>
            <td>FM-009</td>
            <td>HITL Bypass</td>
            <td>CRITICAL</td>
            <td>Audit gap</td>
            <td>5-30 min</td>
          </tr>
          <tr>
            <td>FM-010</td>
            <td>Prompt Injection</td>
            <td>CRITICAL</td>
            <td>Validation hook</td>
            <td>10-60 min</td>
          </tr>
          <tr>
            <td>FM-011</td>
            <td>Manifest Violation</td>
            <td>HIGH-CRITICAL</td>
            <td>Compliance log</td>
            <td>5-30 min</td>
          </tr>
          <tr>
            <td>FM-012</td>
            <td>Swarm Consensus</td>
            <td>HIGH</td>
            <td>Agreement timeout</td>
            <td>10-30 min</td>
          </tr>
          <tr>
            <td>FM-013</td>
            <td>State Divergence</td>
            <td>HIGH</td>
            <td>State diff check</td>
            <td>15-45 min</td>
          </tr>
        </tbody>
      </table>

      <hr class="section-divider">

      <h2 id="troubleshooting-quick-ref">Troubleshooting Quick Reference</h2>

      <h3>Context Recovery Commands</h3>

      <div class="code-block">
        <button class="copy-btn">Copy</button>
        <pre><code># Soft reset (keeps files, clears conversation)
/clear
/catchup

# Hard reset (new session)
exit
claude

# Emergency state dump
~/.claude/scripts/emergency-dump.sh

# Recovery prompt for new session
"Read thoughts/progress-*.md and git log -10 to understand state before continuing"</code></pre>
      </div>

      <h3>Common Error Resolution</h3>

      <table>
        <thead>
          <tr>
            <th>Error Message</th>
            <th>Likely Cause</th>
            <th>Quick Fix</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>BLOCKED: Dangerous command</code></td>
            <td>Command on blocklist</td>
            <td>Execute manually if safe</td>
          </tr>
          <tr>
            <td><code>RATE LIMITED</code></td>
            <td>Tool call limit hit</td>
            <td>Wait 1 hour or reduce usage</td>
          </tr>
          <tr>
            <td><code>Context at X%</code></td>
            <td>Approaching limit</td>
            <td>Checkpoint and <code>/clear</code></td>
          </tr>
          <tr>
            <td><code>Agent stuck for N iterations</code></td>
            <td>No progress being made</td>
            <td>Review task, reset context</td>
          </tr>
          <tr>
            <td><code>HARD LIMIT: Session cost</code></td>
            <td>Budget exceeded</td>
            <td>Review spend, increase if justified</td>
          </tr>
          <tr>
            <td><code>CIRCUIT BREAKER</code></td>
            <td>Repeated failures</td>
            <td>Investigate root cause</td>
          </tr>
        </tbody>
      </table>

      <hr class="section-divider">

      <h2 id="post-mortem">Post-Mortem Template</h2>

      <p>Use this template after any significant incident:</p>

      <div class="code-block">
        <button class="copy-btn">Copy</button>
        <pre><code># Post-Mortem: [Incident Name]

**Date:** [YYYY-MM-DD]
**Severity:** [CRITICAL/HIGH/MEDIUM/LOW]
**Duration:** [How long was impact felt]
**Cost:** [Financial and/or time cost]

## Summary
[2-3 sentence description of what happened]

## Timeline
- [HH:MM] - [Event 1]
- [HH:MM] - [Event 2]
- [HH:MM] - [Detection]
- [HH:MM] - [Recovery started]
- [HH:MM] - [Recovery complete]

## Root Cause
[Clear explanation of why this happened]

## Impact
- [Impact 1 - quantified if possible]
- [Impact 2]

## What Went Well
- [Thing that helped limit damage]

## What Went Wrong
- [Thing that allowed failure or extended it]

## Action Items
- [ ] [Specific, assignable action to prevent recurrence]
- [ ] [Another action]

## Lessons Learned
[Key takeaways for future reference]</code></pre>
      </div>

      <div class="checkpoint">
        <div class="checkpoint-header">Checkpoint: Incident Response Complete</div>
        <div class="checkpoint-content">
          <p><strong>General Knowledge:</strong></p>
          <ul>
            <li>You can identify the 13 failure modes by symptoms</li>
            <li>You know which are CRITICAL vs HIGH vs MEDIUM severity</li>
            <li>You have the post-mortem template saved</li>
            <li>You understand the prevention for each mode</li>
            <li>You have bookmarked this page for emergency reference</li>
            <li>You have a budget in mind for your work</li>
          </ul>
          <p><strong>Security Operations (BMAD + 12-Factor + Cookbook):</strong></p>
          <ul>
            <li>You have the BMAD Control Manifest configured (<code>.claude/security-manifest.yaml</code>)</li>
            <li>You have the security-manifest-check hook installed (BMAD-METHOD)</li>
            <li>You understand 12-factor HITL escalation (humanlayer/12-factor-agents Factor 7)</li>
            <li>You have tool input validation active (anthropic-cookbook)</li>
            <li>You know the security error glossary meanings</li>
            <li>You understand compliance ledger audit extraction (BMAD-METHOD)</li>
          </ul>
        </div>
      </div>

      <hr class="section-divider">

      <section class="want-to-go-deeper">
        <h2 id="go-deeper">Want to Go Deeper?</h2>
        <table>
          <thead>
            <tr>
              <th>Topic</th>
              <th>Depth Layer</th>
              <th>Location</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Cost economics deep-dive</td>
              <td>Advanced</td>
              <td><code>synthesis/reference-cost-economics.md</code></td>
            </tr>
            <tr>
              <td>Multi-agent coordination</td>
              <td>Advanced</td>
              <td><code>synthesis/multi-agent-cc-mirror-complete.md</code></td>
            </tr>
            <tr>
              <td>Advanced context management</td>
              <td>Technical</td>
              <td><code>synthesis/technical-context-management-advanced.md</code></td>
            </tr>
            <tr>
              <td>Subagent spawning patterns</td>
              <td>Technical</td>
              <td><code>synthesis/technical-subagent-spawning-best-practices.md</code></td>
            </tr>
            <tr>
              <td>Production war stories</td>
              <td>Case Studies</td>
              <td><code>synthesis/research-production-war-stories.md</code></td>
            </tr>
            <tr>
              <td>Grammar/Vocabulary</td>
              <td>Reference</td>
              <td><code>synthesis/grammar-vocabulary.md</code></td>
            </tr>
          </tbody>
        </table>
      </section>

      <hr class="section-divider">

      <section class="known-gaps">
        <h2 id="known-gaps">Known Gaps</h2>
        <p><em>From gap analysis - content not fully covered in this journey:</em></p>
        <table>
          <thead>
            <tr>
              <th>Gap</th>
              <th>Why Not Covered</th>
              <th>Where to Find</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>MCP Ecosystem</strong></td>
              <td>Operations-focused, not infrastructure</td>
              <td><code>extractions/techniques/research-mcp-servers-expanded.md</code></td>
            </tr>
            <tr>
              <td><strong>Mobile Workflows</strong></td>
              <td>Different operational paradigm</td>
              <td><code>synthesis/frontier-mobile.md</code></td>
            </tr>
            <tr>
              <td><strong>SDK + Cloudflare Sandboxes</strong></td>
              <td>Alternative infrastructure</td>
              <td><code>extractions/infrastructure/002-claude-sdk-cloudflare-sandboxes-johnturner.md</code></td>
            </tr>
            <tr>
              <td><strong>Mac-as-API Patterns</strong></td>
              <td>Niche infrastructure</td>
              <td><code>extractions/infrastructure/001-system-mac-remote-control-burcs.md</code></td>
            </tr>
          </tbody>
        </table>
        <p><strong>COMPLEMENTS files providing deeper context for this journey:</strong></p>
        <ul>
          <li><code>synthesis/JUDGMENT-GUIDE.md</code> - Decision trees for operational choices</li>
          <li><code>synthesis/MASTER-PLAYBOOK.md</code> - Alternative entry point with user journey framing</li>
          <li><code>synthesis/boris-workflow-complete.md</code> - Boris Cherny's operational philosophy</li>
          <li><code>synthesis/ralph-ecosystem-complete.md</code> - Ralph pattern ecosystem and variants</li>
        </ul>
      </section>

      <hr class="section-divider">

      <section class="operations-mindset">
        <h2 id="operations-mindset">The Operations Mindset</h2>

        <h3>Key Principles</h3>
        <ol>
          <li><strong>Monitor proactively</strong> - You cannot optimize what you cannot see</li>
          <li><strong>Fail gracefully</strong> - Default values > hard failures</li>
          <li><strong>Escalate early</strong> - When in doubt, get human input</li>
          <li><strong>Checkpoint constantly</strong> - External state survives sessions</li>
          <li><strong>Defense in depth</strong> - Every layer you skip is a disaster waiting</li>
        </ol>

        <h3>The $47K Rule (Revisited)</h3>
        <p>Every war story in this document traces back to a missing prevention layer.</p>
        <ul>
          <li>The $47,000 recursive loop happened because <code>--max-iterations</code> was not set.</li>
          <li>The home directory deletion happened because the command blocklist was not installed.</li>
          <li>The 3.2M token death spiral happened because context was not monitored.</li>
        </ul>
        <p><strong>Install the safety rails before you need them.</strong></p>

        <h3>Operational Maturity Model</h3>
        <table>
          <thead>
            <tr>
              <th>Level</th>
              <th>Coverage</th>
              <th>Key Capabilities</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>L0: Experimental</strong></td>
              <td>Basic</td>
              <td>Session monitoring, manual recovery</td>
            </tr>
            <tr>
              <td><strong>L1: Team</strong></td>
              <td>Intermediate</td>
              <td>Cost tracking, stuck detection, hooks</td>
            </tr>
            <tr>
              <td><strong>L2: Department</strong></td>
              <td>Advanced</td>
              <td>Budget hierarchy, multi-agent coordination</td>
            </tr>
            <tr>
              <td><strong>L3: Enterprise</strong></td>
              <td>Full</td>
              <td>Three-tier budgets, compliance, Byzantine FT</td>
            </tr>
            <tr>
              <td><strong>L4: Scale</strong></td>
              <td>Extended</td>
              <td>Multi-region, self-optimizing systems</td>
            </tr>
          </tbody>
        </table>
        <p><strong>Where are you?</strong> Start at L0, progress as your usage grows.</p>
      </section>

      <hr class="section-divider">

      <h2 id="next-steps">Where to Go Next</h2>

      <div class="related-pages">
        <h3>Operations Journey Complete</h3>
        <p>You have completed the Operations Journey. Here are your next options:</p>

        <ul>
          <li><a href="../architecture/core-patterns.html">Architecture Patterns</a> - Choose patterns before operating</li>
          <li><a href="../implementation/ralph-pattern.html">Implementation Guide</a> - Build what you will operate</li>
          <li><a href="../mental-models/context-management.html">Mental Models</a> - Understand WHY these practices matter</li>
          <li><a href="../../reference/war-stories.html">War Stories</a> - Learn from others' failures</li>
        </ul>
      </div>

      <nav class="footer-nav">
        <a href="security-checklists.html" class="nav-prev">
          <span class="nav-direction">Previous</span>
          <span class="nav-title">Security + Checklists</span>
        </a>
        <a href="../mental-models/context-management.html" class="nav-next">
          <span class="nav-direction">Next Journey</span>
          <span class="nav-title">Mental Models</span>
        </a>
      </nav>
    </main>
  </div>

  <!-- Mobile Toggle Button -->
  <button class="sidebar-toggle" aria-label="Toggle navigation">&#9776;</button>

  <script src="../../js/sidebar.js"></script>
</body>
</html>
