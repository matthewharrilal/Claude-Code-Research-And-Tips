<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta data-pagefind-meta="section" content="Synthesis">
  <meta data-pagefind-meta="category" content="MCP">
  <title>MCP Ecosystem Complete - Claude Code Knowledge Base</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/sidebar.css">
  <link rel="stylesheet" href="../css/search.css">
</head>
<body>
  <!-- Search Modal -->
  <div class="search-modal" id="searchModal" aria-hidden="true">
    <div class="search-overlay" onclick="closeSearch()"></div>
    <div class="search-content">
      <div class="search-header">
        <div class="search-input-wrapper">
          <span class="search-icon-input">&#128269;</span>
          <input type="text" id="searchInput" placeholder="Search documentation..." autocomplete="off" />
          <kbd class="search-kbd">ESC</kbd>
        </div>
      </div>
      <div class="search-filters">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="synthesis">Synthesis</button>
        <button class="filter-btn" data-filter="extractions">Extractions</button>
        <button class="filter-btn" data-filter="journeys">Journeys</button>
      </div>
      <div class="search-results" id="searchResults">
        <div class="search-empty"><p>Start typing to search... (Press Cmd+K anytime)</p></div>
      </div>
      <div class="search-footer">
        <span>Up/Down Navigate</span><span>Enter Select</span><span>ESC Close</span>
      </div>
    </div>
  </div>

  <button class="search-trigger" onclick="openSearch()" aria-label="Search" style="float: right; margin-bottom: 1rem;">
    <span class="search-icon">Cmd+K</span>
    <span class="search-text">Search</span>
  </button>

  <div class="wide-container">
    <!-- Breadcrumb Navigation -->
    <nav class="nav-breadcrumb">
      <a href="../index.html">Home</a>
      <span>/</span>
      <a href="synthesis-index.html">Synthesis</a>
      <span>/</span>
      <span>MCP Ecosystem Complete</span>
    </nav>

    <!-- You Are Here Context Box -->
    <div class="you-are-here" style="background: linear-gradient(135deg, #f0ebe3 0%, #fefcf3 100%); border-left: 4px solid #2a7d7d; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
      <h3 style="color: #2a7d7d; margin-top: 0; font-size: 0.9em; text-transform: uppercase; letter-spacing: 0.5px;">You Are Here</h3>
      <p style="margin-bottom: 0;"><strong><span class="b">MCP</span> Ecosystem Complete</strong> - Comprehensive reference for the Model Context Protocol ecosystem: Python SDK, TypeScript SDK, Agent Mail coordination, and N-Skills knowledge packaging. Covers protocol implementation, transport abstraction, context reduction techniques, and integration patterns.</p>
    </div>

    <h1><span class="b">MCP</span> Ecosystem <span class="b">Comp</span>lete</h1>
    <p class="subtitle">Protocol, SDKs, Coordination, and Knowledge Packaging</p>

    <!-- Table of Contents -->
    <div class="toc">
      <div class="toc-title">Contents</div>
      <ul>
        <li><a href="#ecosystem-position">MCP in the Architecture Stack</a></li>
        <li><a href="#protocol-comparison">Protocol Implementation Comparison</a></li>
        <li><a href="#three-primitives">The Three MCP Primitives</a></li>
        <li><a href="#agent-mail">Agent Mail Coordination Layer</a></li>
        <li><a href="#n-skills">N-Skills Knowledge Packaging</a></li>
        <li><a href="#context-reduction">Context Reduction Techniques</a></li>
        <li><a href="#transport">Transport Abstraction</a></li>
        <li><a href="#decision-tree">When to Use Which Component</a></li>
        <li><a href="#mental-models">Mental Models</a></li>
        <li><a href="#checkpoints">Checkpoints</a></li>
        <li><a href="#troubleshooting">Troubleshooting</a></li>
        <li><a href="#integration-patterns">Integration Patterns</a></li>
        <li><a href="#source-attribution">Source Attribution</a></li>
      </ul>
    </div>

    <hr class="section-divider">

    <!-- MCP Ecosystem Position -->
    <section id="ecosystem-position">
      <h2><span class="b">MCP</span> in the <span class="b">Arch</span>itecture Stack</h2>

      <div class="ascii-diagram">
+===========================================================================+
|                     MCP ECOSYSTEM POSITION                                 |
+===========================================================================+
|                                                                           |
|                      CLAUDE CODE RUNTIME                                   |
|                                                                           |
|     +---------------------------------------------------------------+     |
|     |                    Extension Layer                             |     |
|     |                                                                |     |
|     |  +---------------+  +---------------+  +---------------+       |     |
|     |  | SKILLS        |  | MCP SERVERS   |  | HOOKS         |       |     |
|     |  | (N-Skills)    |  | (Agent Mail)  |  | (Automation)  |       |     |
|     |  |               |  |               |  |               |       |     |
|     |  | Knowledge     |  | Tool          |  | Event         |       |     |
|     |  | Packaging     |  | Endpoints     |  | Triggers      |       |     |
|     |  +---------------+  +---------------+  +---------------+       |     |
|     |            |                |                                   |     |
|     |            |                |                                   |     |
|     |  +---------+----------------+-------------------------------+  |     |
|     |  |           MCP PROTOCOL (JSON-RPC 2.0)                     |  |     |
|     |  |   +------------------+  +------------------+              |  |     |
|     |  |   |  Python SDK      |  | TypeScript SDK   |              |  |     |
|     |  |   |  (FastMCP)       |  | (McpServer)      |              |  |     |
|     |  |   +------------------+  +------------------+              |  |     |
|     |  +-----------------------------------------------------------+  |     |
|     +---------------------------------------------------------------+     |
|                                                                           |
|                 ORCHESTRATION PATTERNS (USE MCP)                          |
|     +---------------------------------------------------------------+     |
|     |  +------------+  +------------+  +------------+                |     |
|     |  |   RALPH    |  |  GAS TOWN  |  |  CC-MIRROR |                |     |
|     |  |   Loops    |  |  Factory   |  |  Multi-Mod |                |     |
|     |  +------------+  +------------+  +------------+                |     |
|     +---------------------------------------------------------------+     |
|                                                                           |
+===========================================================================+</div>

      <h3>What This Document Covers</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Component</th><th>Purpose</th><th>Source Document</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Python SDK</strong></td><td>Server/client implementation in Python</td><td>012-mcp-python-sdk.md</td></tr>
            <tr><td><strong>TypeScript SDK</strong></td><td>Type-safe server/client in TypeScript</td><td>013-mcp-typescript-sdk.md</td></tr>
            <tr><td><strong>Agent Mail</strong></td><td>Asynchronous agent coordination</td><td>009-mcp-agent-mail.md</td></tr>
            <tr><td><strong>N-Skills</strong></td><td>Universal skill marketplace</td><td>010-n-skills-collection.md</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Complexity Ladder Position</h3>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>Level 0: Single session                [ ]
Level 1: Hooks and automation          [ ]
Level 2: Skills and enhanced context   [*] &lt;-- N-Skills STARTS HERE
Level 3: External tool integration     [*] &lt;-- MCP SDKs START HERE
Level 4: Native orchestration          [*] &lt;-- Agent Mail ENABLES THIS
Level 5: Multi-instance coordination   [*] &lt;-- Agent Mail CORE USE
Level 6: Factory components            [*] &lt;-- Agent Mail + SDKs
Level 7: Factory-scale (Gas Town)      [*] &lt;-- ALL COMPONENTS</code></pre>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Protocol Implementation Comparison -->
    <section id="protocol-comparison">
      <h2><span class="b">Prot</span>ocol Implementation <span class="b">Comp</span>arison</h2>

      <h3>The USB-C Analogy</h3>

      <blockquote>
        <p>"Think of MCP like a USB-C port for AI applications. Just as USB-C provides a standardized way to connect electronic devices, MCP provides a standardized way to connect AI applications to external systems."</p>
        <cite>-- MCP Documentation</cite>
      </blockquote>

      <h3>Python SDK vs TypeScript SDK</h3>

      <div class="ascii-diagram">
+==================================================================================+
|                    PYTHON SDK vs TYPESCRIPT SDK                                   |
+==================================================================================+
|                                                                                   |
|  PYTHON SDK                              TYPESCRIPT SDK                           |
|  ---------------------------             ---------------------------              |
|                                                                                   |
|  Repository:                             Repository:                              |
|  modelcontextprotocol/python-sdk         modelcontextprotocol/typescript-sdk      |
|                                                                                   |
|  Stars: 21.2k+                           Stars: 11.4k+                            |
|  License: MIT                            License: Apache 2.0 (new) / MIT          |
|  Version: v2 (pre-alpha), v1.x (stable)  Version: v1.25.2 (stable), v2 (alpha)   |
|                                                                                   |
|  +----------------------------------+    +----------------------------------+    |
|  |  DECORATOR-BASED                 |    |  METHOD-BASED                    |    |
|  |                                  |    |                                  |    |
|  |  from mcp.server.fastmcp import  |    |  import { McpServer } from       |    |
|  |    FastMCP                       |    |    "@modelcontextprotocol/       |    |
|  |                                  |    |     server/mcp.js";              |    |
|  |  mcp = FastMCP("MyServer")       |    |                                  |    |
|  |                                  |    |  const server = new McpServer({  |    |
|  |  @mcp.tool()                     |    |    name: "my-server",            |    |
|  |  def my_tool(x: str) -&gt; str:    |    |    version: "1.0.0"              |    |
|  |      return f"Got: {x}"          |    |  });                             |    |
|  |                                  |    |                                  |    |
|  |  mcp.run()                       |    |  server.registerTool(...)        |    |
|  +----------------------------------+    +----------------------------------+    |
|                                                                                   |
+==================================================================================+</div>

      <h3>Detailed Comparison Matrix</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Aspect</th><th>Python SDK</th><th>TypeScript SDK</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Type Safety</strong></td><td>Runtime via Pydantic</td><td>Compile-time via TypeScript + Zod</td></tr>
            <tr><td><strong>Async Model</strong></td><td><code>asyncio</code></td><td>Native <code>async/await</code></td></tr>
            <tr><td><strong>Primary Use</strong></td><td>Scripts, notebooks, backend</td><td>Claude Desktop, VS Code, web</td></tr>
            <tr><td><strong>Framework</strong></td><td>FastMCP, ASGI</td><td>Express, Hono, Node HTTP</td></tr>
            <tr><td><strong>Learning Curve</strong></td><td>Lower (decorator-based)</td><td>Higher (TS + Zod)</td></tr>
            <tr><td><strong>Performance</strong></td><td>Slightly slower startup</td><td>Faster startup</td></tr>
            <tr><td><strong>Ecosystem</strong></td><td>pip, ML libraries</td><td>npm, browser compat</td></tr>
          </tbody>
        </table>
      </div>

      <h3>When to Use Which SDK</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Scenario</th><th>Recommendation</th><th>Reason</th></tr>
          </thead>
          <tbody>
            <tr><td>Claude Desktop tools</td><td>TypeScript</td><td>Reference implementation</td></tr>
            <tr><td>Data analysis tools</td><td>Python</td><td>Access to numpy, pandas</td></tr>
            <tr><td>Rapid prototyping</td><td>Python</td><td>Decorator syntax faster</td></tr>
            <tr><td>Production deployment</td><td>Either</td><td>Both stable</td></tr>
            <tr><td>Browser compatibility</td><td>TypeScript</td><td>Native Browser APIs</td></tr>
            <tr><td>ML/AI workflows</td><td>Python</td><td>Torch, TensorFlow access</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <hr class="section-divider">

    <!-- The Three Primitives -->
    <section id="three-primitives">
      <h2><span class="b">The</span> Three MCP <span class="b">Prim</span>itives</h2>

      <div class="ascii-diagram">
+===============================+
|    MCP THREE PRIMITIVES       |
+===============================+
|                               |
|  TOOLS                        |
|  ----------------             |
|  +-------------------------+  |
|  | Model-Controlled        |  |
|  | Think: POST endpoint    |  |
|  |                         |  |
|  | * AI decides WHEN       |  |
|  | * Can have side effects |  |
|  | * Returns results       |  |
|  |                         |  |
|  | Examples:               |  |
|  |   - query_database      |  |
|  |   - send_email          |  |
|  |   - create_file         |  |
|  +-------------------------+  |
|                               |
|  RESOURCES                    |
|  ----------------             |
|  +-------------------------+  |
|  | App-Controlled          |  |
|  | Think: GET endpoint     |  |
|  |                         |  |
|  | * Read-only access      |  |
|  | * URI-based IDs         |  |
|  | * Template support      |  |
|  |                         |  |
|  | Examples:               |  |
|  |   - config://settings   |  |
|  |   - file://{path}       |  |
|  |   - docs://readme       |  |
|  +-------------------------+  |
|                               |
|  PROMPTS                      |
|  ----------------             |
|  +-------------------------+  |
|  | User-Controlled         |  |
|  | Think: Slash commands   |  |
|  |                         |  |
|  | * User initiates        |  |
|  | * Parameterized         |  |
|  | * Returns messages      |  |
|  |                         |  |
|  | Examples:               |  |
|  |   - /code_review        |  |
|  |   - /debug_error        |  |
|  |   - /explain_code       |  |
|  +-------------------------+  |
|                               |
+===============================+</div>

      <h3>Python SDK: Complete Tool Example</h3>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>#!/usr/bin/env python3
"""Complete MCP server example in Python with FastMCP."""

from mcp.server.fastmcp import FastMCP, Context
from mcp.server.session import ServerSession
from pydantic import BaseModel, Field
from typing import Annotated
import httpx
import asyncio

# Create server instance
mcp = FastMCP("WeatherServer")

# Define structured output model
class WeatherData(BaseModel):
    temperature: float
    conditions: str
    humidity: int
    location: str

# Simple tool with basic types
@mcp.tool()
def echo(text: str) -&gt; str:
    """Echo the input text back."""
    return text

# Async tool with HTTP request
@mcp.tool()
async def get_weather(
    city: Annotated[str, Field(description="City name to get weather for")],
    units: Annotated[str, Field(default="metric", description="metric or imperial")]
) -&gt; WeatherData:
    """Get current weather for a city."""
    async with httpx.AsyncClient() as client:
        response = await client.get(
            f"https://api.weather.example.com/{city}",
            params={"units": units}
        )
        data = response.json()

    return WeatherData(
        temperature=data["temp"],
        conditions=data["conditions"],
        humidity=data["humidity"],
        location=city
    )

# Resource with static URI
@mcp.resource("config://app")
def get_app_config() -&gt; str:
    """Return application configuration."""
    return '{"version": "1.0", "environment": "development"}'

if __name__ == "__main__":
    # Run with stdio transport (default)
    mcp.run()</code></pre>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Agent Mail Coordination -->
    <section id="agent-mail">
      <h2><span class="b">Age</span>nt Mail <span class="b">Coord</span>ination Layer</h2>

      <h3>What Agent Mail Is</h3>

      <blockquote>
        <p>"Like Gmail for your coding agents. Lets various different agents communicate and coordinate with each other."</p>
        <cite>-- Jeffrey Emanuel</cite>
      </blockquote>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Capability</th><th>Description</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Identity</strong></td><td>Memorable adjective+noun names (GreenCastle, RedCat)</td></tr>
            <tr><td><strong>Inbox/Outbox</strong></td><td>Threaded message queues with acknowledgment</td></tr>
            <tr><td><strong>File Reservations</strong></td><td>Advisory leases to prevent edit conflicts</td></tr>
            <tr><td><strong>Searchable History</strong></td><td>Full-text search across all conversations</td></tr>
            <tr><td><strong>Multi-Project</strong></td><td>Coordinate across repositories</td></tr>
            <tr><td><strong>Human Oversight</strong></td><td>Web UI for monitoring</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Architecture: Dual-Persistence Model</h3>

      <div class="ascii-diagram">
                       +----------------------+
                       |    Agent/Client      |
                       +----------+-----------+
                                  |
                         HTTP (FastMCP 2.0)
                                  |
                       +----------v-----------+
                       |     MCP Server       |
                       |    (Port 8765)       |
                       +-----+----------+-----+
                             |          |
              +--------------+          +--------------+
              |                                        |
       +------v------+                        +--------v-------+
       |   SQLite    |                        |   Git Repo     |
       |   + FTS5    |                        |  (.md files)   |
       +-------------+                        +----------------+

       For: Fast queries,                     For: Human audit,
       search, indexing                       version history,
                                              portability</div>

      <h3>File Reservations: Critical Coordination</h3>

      <p><strong>Always reserve files before editing in multi-agent scenarios:</strong></p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Step 1: Reserve files
file_reservation_paths(
    project_key="/my/project",
    agent_name="GreenCastle",
    paths=["src/api/**/*.py", "tests/api/**/*.py"],
    ttl_seconds=3600,           # 1 hour lease
    exclusive=True,             # No shared access
    reason="feature-123"        # Link to task/issue
)

# Step 2: Do work...

# Step 3: Release when done
release_file_reservations(
    project_key="/my/project",
    agent_name="GreenCastle"
)</code></pre>
      </div>

      <h3>Basic Registration + Work Pattern</h3>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Step 1: Register identity
register_agent(
    project_key="/my/project",
    agent_name="GreenCastle",
    program="Claude Code",
    model="Opus 4.5",
    task_description="Backend API development"
)

# Step 2: Reserve work surface
file_reservation_paths(
    project_key="/my/project",
    agent_name="GreenCastle",
    paths=["src/api/**"],
    ttl_seconds=3600,
    exclusive=True,
    reason="feature-auth"
)

# Step 3: Announce work to other agents
send_message(
    project_key="/my/project",
    from_agent="GreenCastle",
    to_agents=["RedCat", "BlueLake"],
    thread_id="feature-auth",
    subject="[feature-auth] Starting authentication API",
    body="Working on JWT auth endpoints. Files reserved.",
    importance="normal",
    ack_required=True
)</code></pre>
      </div>
    </section>

    <hr class="section-divider">

    <!-- N-Skills Knowledge Packaging -->
    <section id="n-skills">
      <h2><span class="b">N-Ski</span>lls Knowledge <span class="b">Pack</span>aging</h2>

      <h3>What N-Skills Is</h3>

      <p><strong>N-Skills</strong> is a curated marketplace of skills that extend Claude Code with portable, reusable capabilities.</p>

      <blockquote>
        <p>"Write once. Run everywhere."</p>
        <cite>-- Numman Ali</cite>
      </blockquote>

      <h3>Repository Statistics</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Attribute</th><th>Value</th></tr>
          </thead>
          <tbody>
            <tr><td>Repository</td><td>github.com/numman-ali/n-skills</td></tr>
            <tr><td>Stars</td><td>822+</td></tr>
            <tr><td>License</td><td>Apache 2.0</td></tr>
            <tr><td>Platforms</td><td>9+ (Claude Code, Copilot, Codex, Cursor, etc.)</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Featured Skills Catalog</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Skill</th><th>Purpose</th><th>Key Feature</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Orchestration</strong></td><td>Multi-agent coordination</td><td>CC-Mirror task management</td></tr>
            <tr><td><strong>Gas Town</strong></td><td>Factory-scale orchestration</td><td>66 specialized agents</td></tr>
            <tr><td><strong>Dev-Browser</strong></td><td>Browser automation</td><td>Persistent page state</td></tr>
            <tr><td><strong>ZAI-CLI</strong></td><td>Vision, search, repo exploration</td><td>Z.AI integration</td></tr>
            <tr><td><strong>Open-Source-Maintainer</strong></td><td>GitHub maintenance</td><td>Triage, ship, investigate, grow</td></tr>
          </tbody>
        </table>
      </div>

      <h3>3-Tier Loading Pattern</h3>

      <div class="ascii-diagram">
+--------------------------------------------------------------+
|                    SKILL LOADING TIERS                        |
+--------------------------------------------------------------+
|                                                               |
|  TIER 1: ALWAYS LOADED                                        |
|  ---------------------                                        |
|  * CLAUDE.md -&gt; AGENTS.md pointer                             |
|  * Core skill metadata only                                   |
|  * ~200 tokens overhead                                       |
|                                                               |
|  TIER 2: ON-DEMAND                                            |
|  ---------------------                                        |
|  * /skill &lt;name&gt; triggers load                                |
|  * Full SKILL.md content                                      |
|  * Domain references                                          |
|  * ~2-5K tokens per skill                                     |
|                                                               |
|  TIER 3: DEEP CONTEXT                                         |
|  ---------------------                                        |
|  * Domain guides (software-dev, testing, etc.)                |
|  * Reference implementations                                  |
|  * Examples directory                                         |
|  * ~5-20K tokens when needed                                  |
|                                                               |
+--------------------------------------------------------------+</div>

      <h3>Installation Methods</h3>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Method 1: Claude Code Plugin (Recommended)
/plugin marketplace add numman-ali/n-skills
/plugin install orchestration@n-skills

# Method 2: Universal Installation (openskills)
npm i -g openskills
openskills install numman-ali/n-skills

# Method 3: Manual Clone
git clone https://github.com/numman-ali/n-skills.git</code></pre>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Context Reduction Techniques -->
    <section id="context-reduction">
      <h2><span class="b">Cont</span>ext Reduction <span class="b">Tech</span>niques</h2>

      <h3>The Context Problem</h3>

      <div class="ascii-diagram">
+-------------------------------------------------------------+
|              CONTEXT WINDOW DEGRADATION                      |
+-------------------------------------------------------------+
|                                                              |
|  Token Count vs Quality                                      |
|                                                              |
|  Quality                                                     |
|     |                                                        |
|  100|============                                            |
|     |            ====                                        |
|   75|                ====                                    |
|     |                    ====                                |
|   50|                        ========                        |
|     |                                ========                |
|   25|                                        ========        |
|     |                                                        |
|    0+------------------------------------------------        |
|      0    25K   50K   75K   100K  125K  150K  175K  200K     |
|                         Token Count                          |
|                                                              |
|  SWEET SPOT: &lt;50K tokens                                     |
|  DEGRADATION: 75K+ tokens                                    |
|  CRITICAL: 150K+ tokens                                      |
|                                                              |
+-------------------------------------------------------------+</div>

      <h3>Technique 1: Tool Profiles (~70% Savings)</h3>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Full profile: All 41+ tools
mcp-agent-mail serve-http --profile full
# Context cost: ~8K tokens

# Messaging profile: Only messaging tools
mcp-agent-mail serve-http --profile messaging
# Context cost: ~2K tokens (75% reduction)

# File profile: Only file reservation tools
mcp-agent-mail serve-http --profile files
# Context cost: ~1K tokens (87% reduction)</code></pre>
      </div>

      <h3>Technique 2: Macro Consolidation</h3>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># BEFORE: 3 separate calls (3x context)
register_agent(...)
file_reservation_paths(...)
send_message(...)

# AFTER: 1 macro call (1x context)
macro_start_session(
    project_key="/my/project",
    agent_name="GreenCastle",
    paths=["src/**"],
    thread_id="feature-123",
    announcement="Starting work"
)</code></pre>
      </div>

      <h3>Context Reduction Summary</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Technique</th><th>Savings</th><th>Implementation</th></tr>
          </thead>
          <tbody>
            <tr><td>Tool Profiles</td><td>~70%</td><td><code>--profile</code> flag</td></tr>
            <tr><td>Macros</td><td>~60%</td><td>Combined operations</td></tr>
            <tr><td>Skill Tiering</td><td>~94%</td><td>On-demand loading</td></tr>
            <tr><td>Fresh Context</td><td>100%</td><td>Ralph loops</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Transport Abstraction -->
    <section id="transport">
      <h2><span class="b">Trans</span>port <span class="b">Abstr</span>action</h2>

      <h3>Transport Options</h3>

      <div class="ascii-diagram">
+===================================================================+
|                     MCP TRANSPORT LAYER                            |
+===================================================================+
|                                                                    |
|                     APPLICATION LAYER                              |
|  (Claude Code, Claude Desktop, VS Code, Custom Clients)            |
|                              |                                     |
|                              v                                     |
|                    MCP PROTOCOL (JSON-RPC 2.0)                     |
|                                                                    |
|  +------------+   +------------------+   +------------------+      |
|  |   STDIO    |   |  HTTP Streamable |   |  SSE (Legacy)    |      |
|  +-----+------+   +--------+---------+   +--------+---------+      |
|        |                   |                      |                |
|        v                   v                      v                |
|  +-------------+ +------------------+ +----------------------+     |
|  |LOCAL PROCESS| |  REMOTE SERVER   | |  LEGACY SERVERS      |     |
|  |             | |                  | |                      |     |
|  | * stdin/out | | * Port 8000+     | | * Protocol 2024-11   |     |
|  | * Single    | | * Multi-client   | | * SSE notifications  |     |
|  | * Low lat   | | * OAuth support  | | * Backwards compat   |     |
|  +-------------+ +------------------+ +----------------------+     |
|                                                                    |
+===================================================================+</div>

      <h3>Transport Selection Decision Tree</h3>

      <div class="ascii-diagram">
                     Where is the server?
                            |
              +-------------+-------------+
              |                           |
        Same Machine?              Different Machine?
              |                           |
              v                           v
       +-------------+            +-------------+
       |    STDIO    |            | Streamable  |
       |             |            |    HTTP     |
       | * Fastest   |            |             |
       | * Simplest  |            | * Remote OK |
       | * No auth   |            | * OAuth     |
       |   needed    |            | * Sessions  |
       +-------------+            +-------------+</div>

      <h3>STDIO Transport Example</h3>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Python
from mcp.server.fastmcp import FastMCP
mcp = FastMCP("LocalServer")
mcp.run()  # Default: stdio</code></pre>
      </div>

      <h3>HTTP Streamable Transport Example</h3>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Python
mcp.run(
    transport="streamable-http",
    host="0.0.0.0",
    port=8000,
    json_response=True
)</code></pre>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Decision Tree -->
    <section id="decision-tree">
      <h2><span class="b">Whe</span>n to Use <span class="b">Whi</span>ch Component</h2>

      <h3>Decision Tree</h3>

      <div class="ascii-diagram">
+========================================================================+
|                    MCP COMPONENT DECISION TREE                          |
+========================================================================+
|                                                                         |
|  START: What do you need?                                               |
|            |                                                            |
|  +---------+----------+------------------+-------------------+          |
|  |                    |                  |                   |          |
|  v                    v                  v                   v          |
| BUILD               COORDINATE        PACKAGE              COMBINE      |
| TOOLS?              AGENTS?           KNOWLEDGE?           ALL?         |
|  |                    |                  |                   |          |
|  v                    v                  v                   v          |
| +--------+          +--------+        +--------+          +--------+   |
| | Which  |          | How    |        | What   |          | See    |   |
| | lang?  |          | many?  |        | scope? |          | Below  |   |
| +---+----+          +---+----+        +---+----+          +--------+   |
|     |                   |                 |                             |
|  +--+--+             +--+--+          +---+---+                         |
|  |     |             |     |          |       |                         |
|  v     v             v     v          v       v                         |
| PY    TS            2-5   5+         TEAM   PUBLIC                      |
|  |     |             |     |          |       |                         |
|  v     v             v     v          v       v                         |
| +---+ +---+        +---+ +---+     +---+  +---+                        |
| |PY | |TS |        |AM | |AM+|     |SKL|  |N- |                        |
| |SDK| |SDK|        |   | |GT |     |   |  |SKL|                        |
| +---+ +---+        +---+ +---+     +---+  +---+                        |
|                                                                         |
| Legend:                                                                 |
|   PY SDK = Python SDK (FastMCP)                                        |
|   TS SDK = TypeScript SDK (McpServer)                                  |
|   AM     = Agent Mail                                                  |
|   GT     = Gas Town                                                    |
|   SKL    = Custom SKILL.md                                             |
|   N-SKL  = N-Skills marketplace                                        |
|                                                                         |
+========================================================================+</div>

      <h3>Quick Reference Matrix</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Need</th><th>Component</th><th>When</th></tr>
          </thead>
          <tbody>
            <tr><td>Custom database tool</td><td>Python SDK</td><td>Querying SQL, accessing data</td></tr>
            <tr><td>Type-safe API tool</td><td>TypeScript SDK</td><td>Production deployment</td></tr>
            <tr><td>2-5 agent coordination</td><td>Agent Mail</td><td>Parallel development</td></tr>
            <tr><td>10+ agent factory</td><td>Agent Mail + Gas Town</td><td>Factory-scale</td></tr>
            <tr><td>Team workflow</td><td>Custom SKILL.md</td><td>Internal procedures</td></tr>
            <tr><td>Public capability</td><td>N-Skills submission</td><td>Sharing with community</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Mental Models -->
    <section id="mental-models">
      <h2><span class="b">Men</span>tal <span class="b">Mod</span>els</h2>

      <h3>Mental Model 1: The Layered Extension Stack</h3>

      <div class="ascii-diagram">
+---------------------------------------------------------------------+
|                        USER INTENT                                   |
|                    "Build feature X"                                 |
+-------------------------------------+-------------------------------+
                                      |
                                      v
+---------------------------------------------------------------------+
|                          SKILLS LAYER                                |
|                    (N-Skills, SKILL.md)                              |
|                                                                      |
|   * Procedural knowledge                                             |
|   * Domain expertise                                                 |
|   * Workflow templates                                               |
|   * "HOW to think about this"                                        |
+-------------------------------------+-------------------------------+
                                      |
                                      v
+---------------------------------------------------------------------+
|                     COORDINATION LAYER                               |
|                       (Agent Mail)                                   |
|                                                                      |
|   * Multi-agent communication                                        |
|   * File reservation                                                 |
|   * State synchronization                                            |
|   * "WHO does what WHEN"                                             |
+-------------------------------------+-------------------------------+
                                      |
                                      v
+---------------------------------------------------------------------+
|                        TOOLS LAYER                                   |
|                   (MCP Python/TS SDK)                                |
|                                                                      |
|   * External capabilities                                            |
|   * Database access                                                  |
|   * API integration                                                  |
|   * "WHAT can be done"                                               |
+-------------------------------------+-------------------------------+
                                      |
                                      v
+---------------------------------------------------------------------+
|                      PROTOCOL LAYER                                  |
|                     (MCP JSON-RPC)                                   |
|                                                                      |
|   * Standardized interface                                           |
|   * Transport abstraction                                            |
|   * Platform compatibility                                           |
|   * "HOW to connect"                                                 |
+---------------------------------------------------------------------+</div>

      <h3>Mental Model 2: Tools vs Skills vs Coordination</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Aspect</th><th>TOOLS (SDKs)</th><th>SKILLS (N-Skills)</th><th>COORDINATION (Agent Mail)</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Nature</strong></td><td>Capabilities</td><td>Procedures</td><td>Synchronization</td></tr>
            <tr><td><strong>Question</strong></td><td>"I CAN..."</td><td>"HERE'S HOW..."</td><td>"WHO DOES WHAT..."</td></tr>
            <tr><td><strong>Analogous To</strong></td><td>Endpoint-like</td><td>Document-like</td><td>Middleware-like</td></tr>
            <tr><td><strong>When Invoked</strong></td><td>Runtime</td><td>Context loaded</td><td>Always available</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Mental Model 3: The Post Office Analogy</h3>

      <blockquote>
        <p>Agents don't need to know WHERE other agents are. They just: 1) Check their mailbox, 2) Send letters to names, 3) Register their work area.</p>
      </blockquote>
    </section>

    <hr class="section-divider">

    <!-- Checkpoints -->
    <section id="checkpoints">
      <h2><span class="b">Check</span>points</h2>

      <!-- Checkpoint: MCP SDK Installed -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint 1: MCP SDK Installed</div>
        <p><strong>Verify your state:</strong></p>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code># Python
uv run python -c "from mcp.server.fastmcp import FastMCP; print('FastMCP ready')"

# TypeScript
npm list @modelcontextprotocol/server zod</code></pre>
        </div>
        <p><strong>You should see:</strong> "FastMCP ready" or package versions listed</p>
      </div>

      <!-- Checkpoint: Agent Mail Running -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint 2: Agent Mail Running</div>
        <p><strong>Verify your state:</strong></p>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code># Start server
mcp-agent-mail serve-http --port 8765

# Verify
curl http://127.0.0.1:8765/health</code></pre>
        </div>
        <p><strong>You should see:</strong> <code>{"status": "ok"}</code></p>
        <p><strong>Web UI available at:</strong> <code>http://127.0.0.1:8765/mail</code></p>
      </div>

      <!-- Checkpoint: Skill Loaded -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint 3: N-Skills Loaded</div>
        <p><strong>Verify your state:</strong></p>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code># Check marketplace added
/plugin marketplace list
# Should show: numman-ali/n-skills

# Load skill
/skill orchestration
# Skill should activate

# Verify cc-mirror
npx cc-mirror tasks --json
# Should return task list (may be empty)</code></pre>
        </div>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Troubleshooting -->
    <section id="troubleshooting">
      <h2><span class="b">Trou</span>bleshooting</h2>

      <details class="troubleshoot">
        <summary>"ModuleNotFoundError: mcp" (Python)</summary>
        <div>
          <p><strong>Cause:</strong> SDK not installed in current environment</p>
          <p><strong>Solution:</strong></p>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code># Ensure correct venv
source .venv/bin/activate

# Reinstall
uv add "mcp[cli]"
# or
pip install "mcp[cli]"</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>"Error: write EPIPE" (stdio)</summary>
        <div>
          <p><strong>Cause:</strong> Writing to stdout when client disconnected, or debug logs to stdout</p>
          <p><strong>Solution:</strong></p>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code># BAD: console.log / print to stdout
print("Debug message")  # Corrupts JSON-RPC!

# GOOD: Use stderr
print("Debug message", file=sys.stderr)

# TypeScript: NEVER use console.log() in stdio servers
console.error("Debug message");  # OK</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>"from_agent not registered" (Agent Mail)</summary>
        <div>
          <p><strong>Cause:</strong> Sending message before registration</p>
          <p><strong>Solution:</strong></p>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code># Always register FIRST
register_agent(
    project_key="/my/project",
    agent_name="MyAgent",
    program="Claude Code",
    model="Opus 4.5"
)

# THEN send messages
send_message(...)</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>"FILE_RESERVATION_CONFLICT" (Agent Mail)</summary>
        <div>
          <p><strong>Cause:</strong> Another agent holds exclusive reservation</p>
          <p><strong>Solutions:</strong></p>
          <ol>
            <li>Wait for TTL expiry</li>
            <li>Use <code>exclusive=False</code> for shared access</li>
            <li>Work on different files</li>
            <li>Contact holding agent to coordinate</li>
          </ol>
          <p><strong>Check who holds reservation:</strong> Web UI at <code>http://127.0.0.1:8765/mail/reservations</code></p>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>"Agent name rejected" (Agent Mail)</summary>
        <div>
          <p><strong>Cause:</strong> Name doesn't match Adjective+Noun pattern</p>
          <p><strong>Invalid:</strong> <code>steve</code>, <code>claude</code>, <code>MyAgent123</code></p>
          <p><strong>Valid:</strong> <code>GreenCastle</code>, <code>RedCat</code>, <code>SwiftFalcon</code></p>
        </div>
      </details>
    </section>

    <hr class="section-divider">

    <!-- Integration Patterns -->
    <section id="integration-patterns">
      <h2><span class="b">Integ</span>ration <span class="b">Patt</span>erns</h2>

      <h3>Combination Matrix</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Combination</th><th>Use Case</th><th>Complexity</th><th>Value</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Python SDK + Ralph</strong></td><td>Custom verification tools</td><td>Medium</td><td>Very High</td></tr>
            <tr><td><strong>TS SDK + Claude Desktop</strong></td><td>Type-safe desktop tools</td><td>Medium</td><td>High</td></tr>
            <tr><td><strong>Agent Mail + Gas Town</strong></td><td>Factory communication</td><td>Medium</td><td>Very High</td></tr>
            <tr><td><strong>Agent Mail + Ralph</strong></td><td>Async iteration memory</td><td>Medium</td><td>High</td></tr>
            <tr><td><strong>N-Skills + CC-Mirror</strong></td><td>Multi-model skills</td><td>Low</td><td>High</td></tr>
            <tr><td><strong>All Components</strong></td><td>Production factory</td><td>High</td><td>Maximum</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Pattern: MCP Tools + Ralph</h3>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># ralph_tools_server.py
from mcp.server.fastmcp import FastMCP
import subprocess

mcp = FastMCP("RalphTools")

@mcp.tool()
def run_typecheck() -&gt; str:
    """Run TypeScript type checking."""
    result = subprocess.run(
        ["npm", "run", "typecheck"],
        capture_output=True,
        text=True,
        cwd="/path/to/project"
    )
    return f"Exit: {result.returncode}\n{result.stdout}\n{result.stderr}"

@mcp.tool()
def read_prd() -&gt; str:
    """Read current PRD status."""
    import json
    with open("/path/to/project/plans/prd.json") as f:
        prd = json.load(f)
    incomplete = [s for s in prd["userStories"] if not s["passes"]]
    return json.dumps({"incomplete": incomplete}, indent=2)

if __name__ == "__main__":
    mcp.run()</code></pre>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Source Attribution -->
    <section id="source-attribution">
      <h2><span class="b">Sou</span>rce <span class="b">Attr</span>ibution</h2>

      <h3>Primary Sources</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Source</th><th>Type</th><th>Reliability</th></tr>
          </thead>
          <tbody>
            <tr><td>github.com/modelcontextprotocol/python-sdk</td><td>Official Repository</td><td>Authoritative</td></tr>
            <tr><td>github.com/modelcontextprotocol/typescript-sdk</td><td>Official Repository</td><td>Authoritative</td></tr>
            <tr><td>github.com/Dicklesworthstone/mcp_agent_mail</td><td>Community Project</td><td>High (1,500+ stars)</td></tr>
            <tr><td>github.com/numman-ali/n-skills</td><td>Community Project</td><td>High (822+ stars)</td></tr>
            <tr><td>modelcontextprotocol.io</td><td>Official Documentation</td><td>Authoritative</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Repository Statistics (Jan 2026)</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Repository</th><th>Stars</th><th>License</th></tr>
          </thead>
          <tbody>
            <tr><td>Python SDK</td><td>21.2k+</td><td>MIT</td></tr>
            <tr><td>TypeScript SDK</td><td>11.4k+</td><td>Apache 2.0</td></tr>
            <tr><td>Agent Mail</td><td>1,500+</td><td>MIT</td></tr>
            <tr><td>N-Skills</td><td>822+</td><td>Apache 2.0</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Key Contributors</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Person</th><th>Contribution</th></tr>
          </thead>
          <tbody>
            <tr><td>Anthropic Team</td><td>MCP Protocol, Official SDKs</td></tr>
            <tr><td>Jeffrey Emanuel</td><td>Agent Mail, Agentic Tooling Flywheel</td></tr>
            <tr><td>Numman Ali</td><td>N-Skills marketplace</td></tr>
            <tr><td>SawyerHood</td><td>Dev-browser original</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Milestone -->
    <div class="milestone" style="background: linear-gradient(90deg, #6b9b7a 0%, #2a7d7d 100%); color: white; padding: 1rem 1.5rem; border-radius: 8px; text-align: center; margin: 2rem 0;">
      MCP provides the standardized interface. SDKs build the tools. Agent Mail coordinates the agents. N-Skills packages the knowledge.
    </div>

    <!-- Related Pages -->
    <div class="related-pages">
      <h3>Related Pages</h3>
      <ul>
        <li><a href="mastery-ralph-complete.html">Ralph Complete</a> - Ralph loops using MCP tools</li>
        <li><a href="mastery-gastown-complete.html">Gas Town Complete</a> - Factory orchestration</li>
        <li><a href="integration-memory-patterns.html">Memory Integration</a> - Claude-Mem, Beads, Claude HUD</li>
        <li><a href="architecture-complexity-ladder.html">Complexity Ladder</a> - Where MCP fits</li>
      </ul>
    </div>

    <!-- Footer Navigation -->
    <nav class="footer-nav">
      <a href="integration-memory-patterns.html" class="nav-prev">
        <span class="nav-direction">Previous</span>
        <span class="nav-title">Memory Integration Patterns</span>
      </a>
      <a href="synthesis-index.html" class="nav-next">
        <span class="nav-direction">Next</span>
        <span class="nav-title">Synthesis Index</span>
      </a>
    </nav>

  </div>

  <nav class="left-nav" id="leftNav">
    <div class="px-4 mb-4">
      <a href="../index.html" class="text-xs font-semibold text-accent hover:text-accent-light uppercase tracking-wider">Claude Code KB</a>
    </div>
    <div class="nav-content"></div>
  </nav>

  <script src="../js/search.js"></script>
  <script src="../js/sidebar.js"></script>
  <script src="../js/global-nav.js"></script>
  <script>
    function copyCode(button) {
      const codeBlock = button.parentElement.querySelector('code');
      navigator.clipboard.writeText(codeBlock.textContent);
      button.textContent = 'Copied!';
      button.classList.add('copied');
      setTimeout(() => {
        button.textContent = 'Copy';
        button.classList.remove('copied');
      }, 2000);
    }
  </script>
</body>
</html>
