<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta data-pagefind-meta="section" content="Synthesis">
  <meta data-pagefind-meta="category" content="Migration">
  <title>Cross-Pattern Migration Guide - Claude Code Knowledge Base</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/sidebar.css">
  <link rel="stylesheet" href="../css/search.css">
</head>
<body>
  <!-- Search Modal -->
  <div class="search-modal" id="searchModal" aria-hidden="true">
    <div class="search-overlay" onclick="closeSearch()"></div>
    <div class="search-content">
      <div class="search-header">
        <div class="search-input-wrapper">
          <span class="search-icon-input">&#128269;</span>
          <input type="text" id="searchInput" placeholder="Search documentation..." autocomplete="off" />
          <kbd class="search-kbd">ESC</kbd>
        </div>
      </div>
      <div class="search-filters">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="synthesis">Synthesis</button>
        <button class="filter-btn" data-filter="extractions">Extractions</button>
      </div>
      <div class="search-results" id="searchResults">
        <div class="search-empty"><p>Start typing to search... (Press Cmd+K anytime)</p></div>
      </div>
      <div class="search-footer">
        <span>Up/Down Navigate</span><span>Enter Select</span><span>ESC Close</span>
      </div>
    </div>
  </div>

  <button class="search-trigger" onclick="openSearch()" aria-label="Search" style="float: right; margin-bottom: 1rem;">
    <span class="search-icon">Cmd+K</span>
    <span class="search-text">Search</span>
  </button>

  <div class="container">
    <!-- Breadcrumb Navigation -->
    <nav class="nav-breadcrumb">
      <a href="../index.html">Home</a>
      <span>/</span>
      <a href="synthesis-index.html">Synthesis</a>
      <span>/</span>
      <span>Cross-Pattern Migration</span>
    </nav>

    <!-- You Are Here Context Box -->
    <div class="you-are-here" style="background: linear-gradient(135deg, #f0ebe3 0%, #fefcf3 100%); border-left: 4px solid #2a7d7d; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
      <h3 style="color: #2a7d7d; margin-top: 0; font-size: 0.9em; text-transform: uppercase; letter-spacing: 0.5px;">You Are Here</h3>
      <p style="margin-bottom: 0;">This document guides you through <strong>migration between orchestration patterns</strong>. You're reading this because you've outgrown your current approach (Ralph to Gas Town, Gas Town to Claude-Flow) or need to scale down from overkill. Use this as your step-by-step migration playbook with checkpoints and rollback procedures.</p>
    </div>

    <h1><span class="bionic">Cro</span>ss-Pattern <span class="bionic">Mig</span>ration <span class="bionic">Gui</span>de</h1>

    <p class="conversational-lead">
      Scaling your orchestration from Ralph to Gas Town to Enterprise. This guide covers when to migrate, how to preserve learnings, step-by-step migration scripts, and downgrade paths when simpler approaches suffice.
    </p>

    <!-- Table of Contents -->
    <div class="toc">
      <div class="toc-title">Contents</div>
      <ul>
        <li><a href="#complexity-ladder">The Orchestration Complexity Ladder</a></li>
        <li><a href="#outgrew-ralph">I Outgrew Ralph - What's Next?</a></li>
        <li><a href="#ralph-to-gastown">Ralph to Gas Town Migration</a></li>
        <li><a href="#gastown-to-claudeflow">Gas Town to Claude-Flow Scaling</a></li>
        <li><a href="#state-preservation">State Preservation During Migration</a></li>
        <li><a href="#downgrade-paths">Downgrade Paths</a></li>
        <li><a href="#anti-patterns">Migration Anti-Patterns</a></li>
        <li><a href="#mental-models">Mental Models</a></li>
        <li><a href="#cc-mirror">Intermediate Pattern: CC Mirror</a></li>
        <li><a href="#troubleshooting">Troubleshooting</a></li>
      </ul>
    </div>

    <hr class="section-divider">

    <!-- Complexity Ladder -->
    <section id="complexity-ladder">
      <h2>The <span class="bionic">Orc</span>hestration <span class="bionic">Com</span>plexity <span class="bionic">Lad</span>der</h2>

      <div class="ascii-diagram">
ORCHESTRATION COMPLEXITY LADDER
===============================

Level 7: Claude-Flow v3 (Enterprise)     <- Maximum automation, self-learning
    |
Level 6-7: Gas Town (Factory-Scale)      <- 20-30+ agents, specialized roles
    |
Level 5-6: CC Mirror + Parallel          <- THIS DOC COVERS TRANSITIONS
    |
Level 4-5: Zeroshot / Marathon Ralph     <- Multi-agent Ralph variants
    |
Level 3-4: Production Ralph              <- PRD-driven automation
    |
Level 3: Original Ralph                  <- Fresh context loop
    |
Level 1-2: CLAUDE.md + Extended          <- Basic persistence
    |
Level 0: Single Interactive Session      <- Entry point
      </div>

      <p>This document covers <strong>transitions between levels 3-7</strong>. Understanding when and how to move between patterns is as important as understanding the patterns themselves.</p>
    </section>

    <hr class="section-divider">

    <!-- Outgrew Ralph -->
    <section id="outgrew-ralph">
      <h2>I <span class="bionic">Out</span>grew <span class="bionic">Ral</span>ph - <span class="bionic">Wha</span>t's Next?</h2>

      <h3>Signs You Need Multi-Agent (CC Mirror / Parallel Ralph)</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Symptom</th><th>What It Means</th></tr>
          </thead>
          <tbody>
            <tr><td>"I'm waiting on Ralph" while other work exists</td><td>Single-threaded bottleneck</td></tr>
            <tr><td>Stories have no dependencies between them</td><td>Could run in parallel</td></tr>
            <tr><td>Feature branches conflict on merge</td><td>Need isolated worktrees</td></tr>
            <tr><td>Overnight runs complete one feature only</td><td>Could do 3-4 features overnight</td></tr>
            <tr><td>Context isolation would improve quality</td><td>Different features need different context</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Signs You Need Factory-Scale (Gas Town)</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Symptom</th><th>What It Means</th></tr>
          </thead>
          <tbody>
            <tr><td>Running 5+ Claude instances simultaneously</td><td>Need role specialization</td></tr>
            <tr><td>Agents overwriting each other's work</td><td>Need merge queue (Refinery)</td></tr>
            <tr><td>Codebase > 100K LOC</td><td>Scale requires coordination</td></tr>
            <tr><td>Want persistent named agents</td><td>Polecats vs ephemeral workers</td></tr>
            <tr><td>Need human-in-the-loop for decisions</td><td>Overseer role pattern</td></tr>
            <tr><td>$50-200/day API budget</td><td>Factory economics viable</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Signs You Need Enterprise (Claude-Flow v3)</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Symptom</th><th>What It Means</th></tr>
          </thead>
          <tbody>
            <tr><td>Want self-learning routing (patterns improve over time)</td><td>Need SONA architecture</td></tr>
            <tr><td>Need consensus algorithms (Raft, Byzantine, Gossip)</td><td>Byzantine fault tolerance</td></tr>
            <tr><td>Want multi-provider LLM routing</td><td>OpenAI, Gemini, Ollama fallbacks</td></tr>
            <tr><td>MCP-native is important</td><td>170+ tools via MCP</td></tr>
            <tr><td>Team prefers Node.js/TS over Go</td><td>Technology fit</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Decision Tree: What's Next?</h3>

      <div class="ascii-diagram">
                    +--------------------------------------------+
                    |  ARE YOU CONSISTENTLY WAITING FOR RALPH    |
                    |  WHILE PARALLELIZABLE WORK EXISTS?          |
                    +----------------------+---------------------+
                                           |
                               +-----------+-----------+
                               |                       |
                              YES                      NO
                               |                       |
                               v                       v
             +-------------------------+   +-------------------------+
             |   CC MIRROR OR          |   |   STAY WITH RALPH       |
             |   PARALLEL RALPH        |   |   (Optimize stories)    |
             +-----------+-------------+   +-------------------------+
                         |
                         v
         +--------------------------------------------+
         |  ARE AGENTS OVERWRITING EACH OTHER'S WORK  |
         |  OR DO YOU NEED SPECIALIZED ROLES?          |
         +----------------------+---------------------+
                                |
                    +-----------+-----------+
                    |                       |
                   YES                      NO
                    |                       |
                    v                       v
      +-------------------------+   +-------------------------+
      |      GAS TOWN           |   |   STAY WITH CC MIRROR   |
      |  (Factory with roles)   |   |   (Simpler multi-agent) |
      +-----------+-------------+   +-------------------------+
                  |
                  v
      +--------------------------------------------+
      |  DO YOU NEED SELF-LEARNING, MULTI-PROVIDER |
      |  OR MCP-NATIVE ENTERPRISE FEATURES?        |
      +----------------------+---------------------+
                             |
                 +-----------+-----------+
                 |                       |
                YES                      NO
                 |                       |
                 v                       v
   +-------------------------+   +-------------------------+
   |    CLAUDE-FLOW v3       |   |   STAY WITH GAS TOWN    |
   |  (Enterprise features)  |   |   (Proven production)   |
   +-------------------------+   +-------------------------+
      </div>

      <h3>Complexity Cost Matrix</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Level</th><th>Pattern</th><th>Daily Cost</th><th>Setup Time</th><th>Maintenance</th></tr>
          </thead>
          <tbody>
            <tr><td>3-4</td><td><strong>Production Ralph</strong></td><td>$10-30</td><td>30 minutes</td><td>Low</td></tr>
            <tr><td>4-5</td><td><strong>CC Mirror</strong></td><td>$30-80</td><td>1-2 hours</td><td>Low-Medium</td></tr>
            <tr><td>5-6</td><td><strong>Parallel Ralph</strong></td><td>$30-80</td><td>1 hour</td><td>Low</td></tr>
            <tr><td>6-7</td><td><strong>Gas Town</strong></td><td>$50-200</td><td>4-8 hours</td><td>Medium-High</td></tr>
            <tr><td>7+</td><td><strong>Claude-Flow v3</strong></td><td>$10-50</td><td>2-4 hours</td><td>Medium</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Ralph to Gas Town -->
    <section id="ralph-to-gastown">
      <h2><span class="bionic">Ral</span>ph to <span class="bionic">Gas</span> Town <span class="bionic">Mig</span>ration</h2>

      <h3>The Transformation Architecture</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Ralph Concept</th><th>Gas Town Concept</th></tr>
          </thead>
          <tbody>
            <tr><td>prd.json</td><td>Beads ledger (.beads/)</td></tr>
            <tr><td>progress.txt</td><td>Beads task notes</td></tr>
            <tr><td>CLAUDE.md</td><td>Rig CLAUDE.md + hooks</td></tr>
            <tr><td>Single Claude instance</td><td>8 specialized roles</td></tr>
            <tr><td>while loop bash</td><td>gt commands</td></tr>
            <tr><td>Story by story</td><td>Convoy-based work bundles</td></tr>
            <tr><td>Self-verification</td><td>Dogs quality gates</td></tr>
            <tr><td>Manual branch</td><td>Refinery merge queue</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Phase 1: Prerequisites Check (30 minutes)</h3>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>#!/bin/bash
# ralph-to-gastown-phase1.sh
# Verify prerequisites for Gas Town

set -e

echo "=== Phase 1: Prerequisites Check ==="

# Check Go version
GO_VERSION=$(go version 2>/dev/null | grep -oE '[0-9]+\.[0-9]+' | head -1)
if [[ "$GO_VERSION" < "1.23" ]]; then
  echo "ERROR: Go 1.23+ required. Current: $GO_VERSION"
  echo "Install: brew install go"
  exit 1
fi
echo "OK Go version: $GO_VERSION"

# Check Git version
GIT_VERSION=$(git --version | grep -oE '[0-9]+\.[0-9]+' | head -1)
if [[ "$GIT_VERSION" < "2.25" ]]; then
  echo "ERROR: Git 2.25+ required for worktrees"
  exit 1
fi
echo "OK Git version: $GIT_VERSION"

# Check tmux
if ! command -v tmux &> /dev/null; then
  echo "ERROR: tmux required. Install: brew install tmux"
  exit 1
fi
echo "OK tmux installed"

# Check Claude Code
if ! command -v claude &> /dev/null; then
  echo "ERROR: Claude Code CLI not found"
  exit 1
fi
echo "OK Claude Code installed"

echo ""
echo "=== All prerequisites met ==="</code></pre>
      </div>

      <!-- Checkpoint -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint 1: Prerequisites</div>
        <p><strong>You should see:</strong> 4 "OK" messages for Go, Git, tmux, and Claude Code.</p>
        <p><strong>If something is missing:</strong> Install the missing prerequisite before proceeding.</p>
      </div>

      <h3>Phase 2: Install Gas Town (15 minutes)</h3>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>#!/bin/bash
# ralph-to-gastown-phase2.sh
# Install Gas Town

set -e

echo "=== Phase 2: Gas Town Installation ==="

# Install gt command
echo "Installing Gas Town CLI..."
go install github.com/steveyegge/gastown/cmd/gt@latest

# Verify installation
if ! command -v gt &> /dev/null; then
  echo "ERROR: gt command not found"
  echo "Add ~/go/bin to your PATH"
  exit 1
fi
echo "OK gt command installed: $(gt version)"

# Initialize workspace
GT_HOME="${GT_HOME:-$HOME/gt}"
echo "Initializing Gas Town workspace at $GT_HOME..."
gt install "$GT_HOME" --git

echo ""
echo "=== Installation complete ==="
echo "Workspace: $GT_HOME"</code></pre>
      </div>

      <!-- Checkpoint -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint 2: Installation</div>
        <p><strong>Verify:</strong> <code>gt version</code> returns version info. <code>$GT_HOME/.gt/</code> directory exists.</p>
        <p><strong>If gt not found:</strong> Add <code>export PATH="$HOME/go/bin:$PATH"</code> to your shell profile.</p>
      </div>

      <h3>Phase 3: Migrate Ralph Project (30 minutes)</h3>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>#!/bin/bash
# ralph-to-gastown-phase3.sh
# Migrate existing Ralph project to Gas Town rig

set -e

RALPH_PROJECT="${1:?Usage: $0 <ralph-project-path>}"
RIG_NAME="${2:-$(basename $RALPH_PROJECT)}"
GT_HOME="${GT_HOME:-$HOME/gt}"

echo "=== Phase 3: Project Migration ==="
echo "Ralph project: $RALPH_PROJECT"
echo "Rig name: $RIG_NAME"

# Add project as rig
echo "Adding rig: $RIG_NAME"
cd "$GT_HOME"
gt rig add "$RIG_NAME" "$RALPH_PROJECT"

# Convert prd.json to Beads
if [[ -f "$RALPH_PROJECT/scripts/ralph/prd.json" ]]; then
  echo "Converting prd.json to Beads tasks..."
  jq -r '.userStories[] | select(.passes == false) | .id + "|||" + .title' \
    "$RALPH_PROJECT/scripts/ralph/prd.json" | while IFS='|||' read -r id title; do
    echo "Creating bead: $title"
    cd "$GT_HOME/$RIG_NAME"
    bd create "$title" --note "Migrated from Ralph $id"
  done
fi

# Create crew workspace
echo "Creating crew workspace..."
gt crew add "$RIG_NAME" --name "yourname"

echo ""
echo "=== Migration complete ==="
echo "Start with: gt mayor attach"</code></pre>
      </div>

      <!-- Checkpoint -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint 3: Migration</div>
        <p><strong>Verify:</strong> <code>gt rig list</code> shows your project. <code>bd ready</code> shows converted tasks.</p>
        <p><strong>If tasks missing:</strong> Check prd.json path and re-run conversion.</p>
      </div>

      <h3>Phase 4: Start Gas Town Workflow</h3>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>#!/bin/bash
# ralph-to-gastown-phase4.sh
# Start Gas Town with migrated rig

GT_HOME="${GT_HOME:-$HOME/gt}"
RIG_NAME="${1:?Usage: $0 <rig-name>}"

echo "=== Phase 4: Starting Gas Town ==="

# Create tmux session
SESSION="gastown"

tmux new-session -d -s $SESSION -n 'overview'

# Window 1: Mayor (your primary interface)
tmux new-window -t $SESSION -n 'mayor'
tmux send-keys -t $SESSION:mayor "cd $GT_HOME && gt mayor attach" C-m

# Window 2: Dogs (quality gates)
tmux new-window -t $SESSION -n 'dogs'
tmux send-keys -t $SESSION:dogs "cd $GT_HOME && gt dogs up" C-m

# Window 3: Rig (Witness + Refinery)
tmux new-window -t $SESSION -n "rig-$RIG_NAME"
tmux split-window -h -t "rig-$RIG_NAME"
tmux send-keys -t $SESSION:"rig-$RIG_NAME".0 "cd $GT_HOME && gt witness up $RIG_NAME" C-m
tmux send-keys -t $SESSION:"rig-$RIG_NAME".1 "cd $GT_HOME && gt refinery up $RIG_NAME" C-m

# Windows 4-6: Polecats (named workers)
for POLECAT in alice bob carol; do
  tmux new-window -t $SESSION -n "$POLECAT"
  tmux send-keys -t $SESSION:$POLECAT "cd $GT_HOME && gt polecat up $RIG_NAME $POLECAT" C-m
done

echo "Starting tmux session..."
tmux select-window -t $SESSION:mayor
tmux attach -t $SESSION</code></pre>
      </div>

      <!-- Checkpoint -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint 4: Gas Town Running</div>
        <p><strong>Verify:</strong> <code>gt status</code> shows all roles running. Mayor responds to commands.</p>
        <p><strong>If roles not starting:</strong> Check tmux window outputs for errors.</p>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Gas Town to Claude-Flow -->
    <section id="gastown-to-claudeflow">
      <h2><span class="bionic">Gas</span> Town to <span class="bionic">Cla</span>ude-Flow <span class="bionic">Sca</span>ling</h2>

      <h3>Why Migrate to Claude-Flow?</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Gas Town Limitation</th><th>Claude-Flow Solution</th></tr>
          </thead>
          <tbody>
            <tr><td>Go runtime only</td><td>Node.js ecosystem</td></tr>
            <tr><td>Manual human oversight</td><td>Self-learning SONA</td></tr>
            <tr><td>Single provider (Claude)</td><td>Multi-provider routing</td></tr>
            <tr><td>Fixed role hierarchy</td><td>Dynamic agent spawning</td></tr>
            <tr><td>~$50-200/day</td><td>~$10-50/day (cost optimized)</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Architecture Comparison</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Gas Town</th><th>Claude-Flow v3</th></tr>
          </thead>
          <tbody>
            <tr><td>Overseer (YOU)</td><td>Strategic Queen</td></tr>
            <tr><td>Mayor (Coordination)</td><td>Tactical Queen</td></tr>
            <tr><td>Deacon (Heartbeat)</td><td>Adaptive Queen (learning)</td></tr>
            <tr><td>Dogs (Quality)</td><td>Security Architect</td></tr>
            <tr><td>Refinery (Merge)</td><td>Consensus algorithms</td></tr>
            <tr><td>Witness (Monitoring)</td><td>Swarm health checks</td></tr>
            <tr><td>Polecats (Workers)</td><td>54+ specialized agents</td></tr>
            <tr><td>Beads (Memory)</td><td>AgentDB + ReasoningBank</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Migration Steps</h3>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Step 1: Install Claude-Flow v3
npm install -g claude-flow@v3alpha

# Step 2: Initialize in existing project
cd ~/gt/myproject  # Your Gas Town rig
npx claude-flow@v3alpha init --wizard

# Step 3: Add as MCP server
claude mcp add claude-flow -- npx -y claude-flow@v3alpha

# Step 4: Export Beads to Claude-Flow memory
cd ~/gt/myproject
bd list --json > /tmp/beads-export.json

npx claude-flow@v3alpha memory import /tmp/beads-export.json \
  --type "beads-migration" \
  --metadata '{"source": "gas-town"}'</code></pre>
      </div>
    </section>

    <hr class="section-divider">

    <!-- State Preservation -->
    <section id="state-preservation">
      <h2><span class="bionic">Sta</span>te <span class="bionic">Pre</span>servation <span class="bionic">Dur</span>ing <span class="bionic">Mig</span>ration</h2>

      <div class="callout callout-insight">
        <div class="callout-title">The Golden Rule</div>
        <p><strong>Never lose learnings. Extract, document, transfer.</strong></p>
      </div>

      <h3>State Preservation Checklist</h3>

      <h4>Before Migration</h4>
      <ul>
        <li>Export progress.txt patterns to standalone doc</li>
        <li>Archive prd.json as migration-source.json</li>
        <li>Git commit all pending changes</li>
        <li>Document working verification commands</li>
        <li>Export successful prompt templates</li>
        <li>Note any custom modifications to scripts</li>
      </ul>

      <h4>During Migration</h4>
      <ul>
        <li>Create mapping document (old to new concepts)</li>
        <li>Test each component before moving to next</li>
        <li>Keep old system running until new is verified</li>
        <li>Document any translation/conversion logic</li>
      </ul>

      <h4>After Migration</h4>
      <ul>
        <li>Verify all tasks transferred</li>
        <li>Run test task through new system</li>
        <li>Confirm learnings accessible in new format</li>
        <li>Archive old system config (don't delete yet)</li>
        <li>Update CLAUDE.md to reference new patterns</li>
      </ul>

      <h3>Export Ralph Patterns Script</h3>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>#!/bin/bash
# export-ralph-patterns.sh
# Extract and format Ralph learnings for migration

RALPH_DIR="${1:-./scripts/ralph}"
OUTPUT_DIR="${2:-./migration-export}"

mkdir -p "$OUTPUT_DIR"

echo "=== Exporting Ralph Patterns ==="

# 1. Extract prd.json schema patterns
echo "Extracting PRD patterns..."
cat "$RALPH_DIR/prd.json" | jq '{
  project: .project,
  storyFormat: .userStories[0] | keys,
  totalStories: .userStories | length,
  completedStories: [.userStories[] | select(.passes == true)] | length
}' > "$OUTPUT_DIR/prd-patterns.json"

# 2. Export prompt.md for reference
cp "$RALPH_DIR/prompt.md" "$OUTPUT_DIR/original-prompt.md"

# 3. Archive entire structure
tar -czf "$OUTPUT_DIR/ralph-archive-$(date +%Y%m%d).tar.gz" "$RALPH_DIR"

echo "=== Export Complete ==="
ls -la "$OUTPUT_DIR"</code></pre>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Downgrade Paths -->
    <section id="downgrade-paths">
      <h2><span class="bionic">Dow</span>ngrade <span class="bionic">Pat</span>hs</h2>

      <p>When enterprise is overkill, know how to simplify.</p>

      <h3>Downgrade Triggers</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>From</th><th>To</th><th>When</th></tr>
          </thead>
          <tbody>
            <tr><td>Claude-Flow</td><td>Gas Town</td><td>Self-learning not providing value, prefer explicit human oversight</td></tr>
            <tr><td>Gas Town</td><td>CC Mirror</td><td>Only 3-5 agents needed, role specialization adds overhead</td></tr>
            <tr><td>Multi-Agent</td><td>Ralph</td><td>Parallelization not needed, single feature focus</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Gas Town to CC Mirror Downgrade</h3>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>#!/bin/bash
# downgrade-gastown-to-ccmirror.sh

echo "=== Downgrading from Gas Town to CC Mirror ==="

# 1. Export Beads as prd.json format
cd ~/gt/myproject
bd list --json | jq '{
  project: "migrated-from-gastown",
  userStories: [.[] | {
    id: .id,
    title: .title,
    description: .note,
    passes: (.status == "done")
  }]
}' > scripts/ralph/prd.json

# 2. Stop Gas Town
gt town down

# 3. Install CC Mirror if not present
npx cc-mirror quick --provider mirror --name mclaude

echo "Downgrade complete. Run: mclaude"</code></pre>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Anti-Patterns -->
    <section id="anti-patterns">
      <h2><span class="bionic">Mig</span>ration <span class="bionic">Ant</span>i-Patterns</h2>

      <div class="callout callout-warning">
        <div class="callout-title">Anti-Pattern #1: Big Bang Migration</div>
        <p><strong>Wrong:</strong> Switch everything overnight, delete old system</p>
        <p><strong>Right:</strong> Incremental migration, parallel operation period</p>
        <p><strong>Why:</strong> If new system fails, you need fallback.</p>
      </div>

      <div class="callout callout-warning">
        <div class="callout-title">Anti-Pattern #2: Losing Learned Patterns</div>
        <p><strong>Wrong:</strong> Start fresh, ignore progress.txt and AGENTS.md</p>
        <p><strong>Right:</strong> Export, transform, import all patterns</p>
        <p><strong>Why:</strong> Patterns represent weeks of iteration. Don't lose them.</p>
      </div>

      <div class="callout callout-warning">
        <div class="callout-title">Anti-Pattern #3: Skipping Verification Checkpoints</div>
        <p><strong>Wrong:</strong> Run full migration script without stopping</p>
        <p><strong>Right:</strong> Verify each phase before proceeding</p>
        <p><strong>Why:</strong> Errors compound. Catch early.</p>
      </div>

      <div class="callout callout-warning">
        <div class="callout-title">Anti-Pattern #4: Migrating Without Understanding Destination</div>
        <p><strong>Wrong:</strong> "Gas Town sounds cool, let me migrate"</p>
        <p><strong>Right:</strong> Understand prerequisites, daily workflow, costs first</p>
        <p><strong>Why:</strong> Each system has different requirements and tradeoffs.</p>
      </div>

      <h3>Recommended Migration Timeline</h3>

      <div class="ascii-diagram">
RECOMMENDED MIGRATION TIMELINE
==============================

Week 0:
|-- Document current state
|-- Export all patterns
|-- Read destination documentation
+-- Set up destination (don't migrate yet)

Week 1:
|-- Run test project on new system
|-- Verify basic functionality
|-- Start ONE workflow on new system
+-- Keep production on old system

Week 2:
|-- Migrate more workflows to new system
|-- Run parallel for critical paths
|-- Document any translation issues
+-- Build confidence in new system

Week 3:
|-- All new work on new system
|-- Old system for reference only
|-- Address any remaining issues
+-- Prepare to archive old system

Week 4:
|-- Archive old system (don't delete)
|-- Full commitment to new system
|-- Update all documentation
+-- Migration complete
      </div>
    </section>

    <hr class="section-divider">

    <!-- Mental Models -->
    <section id="mental-models">
      <h2><span class="bionic">Men</span>tal <span class="bionic">Mod</span>els</h2>

      <h3>Mental Model 1: The Scaffolding Metaphor</h3>

      <p>When constructing a building, you don't remove scaffolding until the structure is stable.</p>

      <div class="ascii-diagram">
Phase 1: Old supports everything, new being constructed
         +-------------+
         | OLD SYSTEM  |---------->  [under construction]
         +-------------+

Phase 2: New takes partial load, old still supporting
         +-------------+        +-------------+
         | OLD SYSTEM  |------> | NEW SYSTEM  |
         +-------------+        +-------------+

Phase 3: New stable, old for emergency only
         +-------------+        +-------------+
         | (standby)   |        | NEW SYSTEM  | <-- primary
         +-------------+        +-------------+

Phase 4: Remove scaffolding, archive old
                                +-------------+
         [archived]             | NEW SYSTEM  | <-- only system
                                +-------------+
      </div>

      <p><strong>Application:</strong> Keep old system running until new system is proven stable.</p>

      <h3>Mental Model 2: The ETL Pipeline</h3>

      <p>Think of migration as a data pipeline with three stages: Extract, Transform, Load.</p>

      <div class="ascii-diagram">
EXTRACT              TRANSFORM              LOAD
-------              ---------              ----

+-------------+    +-------------+    +-------------+
| Old System  |--->| Translation |--->| New System  |
| Patterns    |    | Layer       |    | Format      |
+-------------+    +-------------+    +-------------+

EXAMPLES:

prd.json ---------> jq transform ----------> Beads
progress.txt -----> grep/sed --------------> AGENTS.md
Beads ------------> JSON export -----------> AgentDB
      </div>

      <p><strong>Key Insight:</strong> Transformation is where data loss occurs. Document the transformation. Verify after loading.</p>
    </section>

    <hr class="section-divider">

    <!-- CC Mirror -->
    <section id="cc-mirror">
      <h2><span class="bionic">Int</span>ermediate <span class="bionic">Pat</span>tern: CC <span class="bionic">Mir</span>ror</h2>

      <p>CC Mirror occupies the critical middle territory between Ralph and Gas Town.</p>

      <div class="ascii-diagram">
COMPLEXITY SPECTRUM
===================

SIMPLE <---------------------------------------------------> COMPLEX

[Ralph]        [CC Mirror]              [Gas Town]    [Claude-Flow]
   |               |                        |               |
Single         Multi-agent              Factory          Enterprise
Sequential     Parallel                 Roles            Self-learn
$10-30/day     $30-80/day              $50-200/day      $10-50/day
      </div>

      <h3>CC Mirror Sweet Spot</h3>
      <ul>
        <li>Need parallelization</li>
        <li>Don't need specialized roles</li>
        <li>Don't need merge queue management</li>
        <li>Budget-conscious</li>
        <li>Simpler than Gas Town, more capable than Ralph</li>
      </ul>

      <h3>Ralph to CC Mirror Migration</h3>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>#!/bin/bash
# ralph-to-ccmirror.sh

echo "=== Migrating Ralph to CC Mirror ==="

PROJECT_DIR="${1:-.}"

# 1. Preserve Ralph state
cp -r "$PROJECT_DIR/scripts/ralph" "$PROJECT_DIR/scripts/ralph-backup"

# 2. Install CC Mirror
npx cc-mirror quick --provider mirror --name mclaude

echo "Migration prepared."
echo ""
echo "In mclaude session:"
echo "1. 'Load the orchestration skill and initiate'"
echo "2. 'Import tasks from scripts/ralph/prd.json'"</code></pre>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Troubleshooting -->
    <section id="troubleshooting">
      <h2><span class="bionic">Tro</span>ubleshooting</h2>

      <details class="troubleshoot">
        <summary>ERROR: "bd: command not found" during Beads operations</summary>
        <div>
          <p><strong>Cause:</strong> Beads CLI not in PATH or not installed with Gas Town.</p>
          <p><strong>Solution:</strong></p>
          <div class="code-block">
            <pre><code># Verify Beads installation
which bd || echo "Beads not found"

# If missing, install Beads separately
go install github.com/steveyegge/beads/cmd/bd@latest

# Add to PATH if needed
export PATH="$HOME/go/bin:$PATH"</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>ERROR: "jq: command not found" during prd.json parsing</summary>
        <div>
          <p><strong>Cause:</strong> jq JSON processor not installed.</p>
          <p><strong>Solution:</strong></p>
          <div class="code-block">
            <pre><code># macOS
brew install jq

# Linux (Debian/Ubuntu)
apt install jq</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>ERROR: Patterns missing after import</summary>
        <div>
          <p><strong>Cause:</strong> Transformation script failed silently, or patterns in unexpected format.</p>
          <p><strong>Solution:</strong></p>
          <ol>
            <li>Verify source has patterns: <code>cat ./migration-export/codebase-patterns.md</code></li>
            <li>Re-run export with verbose output: <code>bash -x ./export-ralph-patterns.sh</code></li>
            <li>Check destination format and manually copy if needed</li>
          </ol>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>ERROR: Gas Town tmux session won't start</summary>
        <div>
          <p><strong>Cause:</strong> Existing session, tmux not running, or permission issue.</p>
          <p><strong>Solution:</strong></p>
          <div class="code-block">
            <pre><code># Kill existing session
tmux kill-session -t gastown 2>/dev/null

# Start fresh
tmux new-session -d -s gastown
tmux attach -t gastown

# If tmux fails entirely
brew reinstall tmux  # macOS</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>ERROR: MCP server fails to connect after Claude-Flow install</summary>
        <div>
          <p><strong>Cause:</strong> Port conflict, server not started, or registration issue.</p>
          <p><strong>Solution:</strong></p>
          <div class="code-block">
            <pre><code># Check if server is running
ps aux | grep claude-flow

# Re-register MCP
claude mcp remove claude-flow
claude mcp add claude-flow -- npx -y claude-flow@v3alpha

# Restart
npx claude-flow@v3alpha mcp restart</code></pre>
          </div>
        </div>
      </details>
    </section>

    <hr class="section-divider">

    <!-- Quick Reference -->
    <section id="quick-reference">
      <h2><span class="bionic">Qui</span>ck <span class="bionic">Ref</span>erence</h2>

      <h3>Migration Decision Matrix</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>From</th><th>To</th><th>Key Trigger</th><th>Effort</th></tr>
          </thead>
          <tbody>
            <tr><td>Ralph</td><td>CC Mirror</td><td>Need parallelization</td><td>1-2 hours</td></tr>
            <tr><td>Ralph</td><td>Gas Town</td><td>Need roles + merge queue</td><td>4-8 hours</td></tr>
            <tr><td>CC Mirror</td><td>Gas Town</td><td>Agents overwriting</td><td>2-4 hours</td></tr>
            <tr><td>Gas Town</td><td>Claude-Flow</td><td>Need self-learning</td><td>2-4 hours</td></tr>
            <tr><td>Gas Town</td><td>CC Mirror</td><td>Roles are overkill</td><td>2-3 hours</td></tr>
            <tr><td>CC Mirror</td><td>Ralph</td><td>Parallelization not needed</td><td>1 hour</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Rollback Commands</h3>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Gas Town emergency stop
gt town down

# Claude-Flow emergency stop
npx claude-flow@v3alpha swarm shutdown

# CC Mirror stop
pkill -f "mclaude"

# Restore Ralph backup
tar -xzf ./migration-archive-*.tar.gz</code></pre>
      </div>
    </section>

    <!-- Related Pages -->
    <div class="related-pages">
      <h3>Related Documents</h3>
      <ul>
        <li><a href="architecture-complexity-ladder.html">Complexity Ladder</a> - Level definitions and when to use each</li>
        <li><a href="compare-orchestration.html">Orchestration Comparison</a> - Side-by-side pattern analysis</li>
        <li><a href="error-taxonomy-recovery.html">Error Taxonomy</a> - What can go wrong during migration</li>
        <li><a href="debugging-agent-failures.html">Debugging Guide</a> - When things break</li>
      </ul>
    </div>

    <!-- Footer Navigation -->
    <nav class="footer-nav">
      <a href="compare-orchestration.html" class="nav-prev">
        <span class="nav-direction">Previous</span>
        <span class="nav-title">Orchestration Comparison</span>
      </a>
      <a href="error-taxonomy-recovery.html" class="nav-next">
        <span class="nav-direction">Next</span>
        <span class="nav-title">Error Taxonomy</span>
      </a>
    </nav>

    <!-- Tags -->
    <div style="margin-top: 2rem;">
      <span class="tag">#migration</span>
      <span class="tag">#orchestration</span>
      <span class="tag">#ralph</span>
      <span class="tag">#gas-town</span>
      <span class="tag">#claude-flow</span>
      <span class="tag">#cc-mirror</span>
      <span class="tag">#scaling</span>
      <span class="tag">#downgrade</span>
    </div>
  </div>

  <script src="../js/copy-code.js"></script>
  <script src="../js/search.js"></script>
<script src="../js/global-nav.js"></script>
</body>
</html>
