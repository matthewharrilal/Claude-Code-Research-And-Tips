<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta data-pagefind-meta="section" content="Synthesis">
  <meta data-pagefind-meta="category" content="Principles">
  <title>Learning &amp; Feedback Loop Engineering - Claude Code Knowledge Base</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/sidebar.css">
  <link rel="stylesheet" href="../css/search.css">
</head>
<body>
  <!-- Search Modal -->
  <div class="search-modal" id="searchModal" aria-hidden="true">
    <div class="search-overlay" onclick="closeSearch()"></div>
    <div class="search-content">
      <div class="search-header">
        <div class="search-input-wrapper">
          <span class="search-icon-input">&#128269;</span>
          <input type="text" id="searchInput" placeholder="Search documentation..." autocomplete="off" />
          <kbd class="search-kbd">ESC</kbd>
        </div>
      </div>
      <div class="search-filters">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="synthesis">Synthesis</button>
        <button class="filter-btn" data-filter="extractions">Extractions</button>
      </div>
      <div class="search-results" id="searchResults">
        <div class="search-empty"><p>Start typing to search... (Press Cmd+K anytime)</p></div>
      </div>
      <div class="search-footer">
        <span>Up/Down Navigate</span><span>Enter Select</span><span>ESC Close</span>
      </div>
    </div>
  </div>

  <button class="search-trigger" onclick="openSearch()" aria-label="Search" style="float: right; margin-bottom: 1rem;">
    <span class="search-icon">Cmd+K</span>
    <span class="search-text">Search</span>
  </button>

  <nav class="left-nav" id="leftNav">
    <div class="px-4 mb-4">
      <a href="../index.html" class="text-xs font-semibold text-accent hover:text-accent-light uppercase tracking-wider">Claude Code KB</a>
    </div>
    <div class="nav-content"></div>
  </nav>

  <div class="container">
    <!-- Breadcrumb Navigation -->
    <nav class="nav-breadcrumb">
      <a href="../index.html">Home</a>
      <span>/</span>
      <a href="synthesis-index.html">Synthesis</a>
      <span>/</span>
      <a href="principles-master.html">Principles</a>
      <span>/</span>
      <span>Learning Loops</span>
    </nav>

    <!-- You Are Here Context Box -->
    <div class="you-are-here" style="background: linear-gradient(135deg, #f0ebe3 0%, #fefcf3 100%); border-left: 4px solid #2a7d7d; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
      <h3 style="color: #2a7d7d; margin-top: 0; font-size: 0.9em; text-transform: uppercase; letter-spacing: 0.5px;">You Are Here</h3>
      <p style="margin-bottom: 0;">This guide shows how to make <strong>each run better than the last</strong> through systematic learning accumulation. Read this after understanding basic patterns (Ralph, fresh context) to learn how to capture and compound learnings across sessions, runs, and projects. The key insight: <strong>systems that learn outperform systems that start fresh</strong>.</p>
    </div>

    <h1><span class="bionic">Lea</span>rning &amp; <span class="bionic">Fee</span>dback <span class="bionic">Loop</span> <span class="bionic">Eng</span>ineering</h1>

    <p class="conversational-lead">
      The most powerful insight from Claude Code practitioners: <strong>systems that learn from previous runs outperform systems that start fresh every time.</strong>
    </p>

    <!-- Table of Contents -->
    <div class="toc">
      <div class="toc-title">Contents</div>
      <ul>
        <li><a href="#compounding-knowledge">The Compounding Knowledge Pattern</a></li>
        <li><a href="#feedback-loop-types">Feedback Loop Types</a>
          <ul>
            <li><a href="#within-session">Within-Session Learning</a></li>
            <li><a href="#cross-session">Cross-Session Learning</a></li>
            <li><a href="#cross-run">Cross-Run Learning (Compounding Ralph)</a></li>
            <li><a href="#cross-project">Cross-Project Learning (Semantic Memory)</a></li>
          </ul>
        </li>
        <li><a href="#implementation">Implementing Feedback Loops</a></li>
        <li><a href="#measuring">Measuring Improvement</a></li>
        <li><a href="#anti-patterns">Anti-patterns in Learning</a></li>
        <li><a href="#lifecycle">The Compounding Development Lifecycle</a></li>
        <li><a href="#verification">The Verification Imperative</a></li>
        <li><a href="#architecture">Advanced: Learning Architecture</a></li>
        <li><a href="#quick-reference">Quick Reference</a></li>
        <li><a href="#troubleshooting">Troubleshooting</a></li>
      </ul>
    </div>

    <hr class="section-divider">

    <!-- Compounding Knowledge Pattern -->
    <section id="compounding-knowledge">
      <h2>The <span class="bionic">Com</span>pounding <span class="bionic">Kno</span>wledge <span class="bionic">Pat</span>tern</h2>

      <h3>Ryan Carson's Key Insight</h3>
      <blockquote>
        <p>"What's amazing is I can ask it to look at previous runs to learn what worked or didn't work (I archive each PRD and user story JSON). So every time I run Ralph, it gets better and better."</p>
        <cite>-- Ryan Carson</cite>
      </blockquote>

      <p>This is the <strong>Compounding Ralph</strong> pattern:</p>

      <div class="ascii-diagram">
Run 1: Initial attempt
  -> Archive prd.json, learnings

Run 2: References Run 1 archives
  -> Better prompts, fewer failures
  -> Archive this run too

Run 3: References Runs 1+2
  -> Even better performance
  -> Continues compounding...
      </div>

      <h3>Why Compounding Works</h3>
      <p>Traditional Ralph starts fresh each session. Compounding Ralph adds:</p>
      <ul>
        <li>Archived PRDs from previous runs</li>
        <li>Archived user story JSONs</li>
        <li>Agent references past successes AND failures</li>
        <li>Patterns discovered in one run inform the next</li>
      </ul>

      <!-- Checkpoint -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint: Compounding Knowledge Pattern</div>
        <p><strong>You should now understand:</strong></p>
        <ul>
          <li>The difference between fresh-start runs and compounding runs</li>
          <li>How archived PRDs and learnings inform future runs</li>
          <li>Why compounding is more valuable than single-run optimization</li>
          <li>The multiplicative benefit: Run 10 is dramatically better than Run 1</li>
        </ul>
        <p><strong>If unclear:</strong> Re-read Ryan Carson's insight above - this is the core idea of the entire document.</p>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Feedback Loop Types -->
    <section id="feedback-loop-types">
      <h2><span class="bionic">Fee</span>dback <span class="bionic">Loop</span> <span class="bionic">Typ</span>es</h2>

      <!-- Within-Session -->
      <div id="within-session" class="scenario-block">
        <div class="scenario-header">
          <span class="scenario-type">Level 1</span>
          <h3 class="scenario-title">Within-Session Learning</h3>
        </div>
        <div class="scenario-content">
          <p><strong>Mechanism:</strong> progress.txt accumulation</p>

          <p>Each iteration within a Ralph loop builds on the previous:</p>

          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code># Progress Log

## Codebase Patterns
- Migrations: Use IF NOT EXISTS
- React: useRef&lt;Timeout | null&gt;(null)
- Zod: Always use .optional() explicitly

---

## 2026-01-09 - US-001
- Implemented: Tool skeleton with Zod schema
- Learned: Use orange (#FF6B35) for dark backgrounds
- Files: src/tools/upsert.ts

---

## 2026-01-09 - US-002
- Implemented: Category mapping
- Learned: Schema needed adjustment for optional fields
- Pattern added to Codebase Patterns section above</code></pre>
          </div>

          <p><strong>The Codebase Patterns Section:</strong></p>
          <ul>
            <li>Lives at TOP of progress.txt</li>
            <li>Accumulates reusable patterns</li>
            <li>Agent reads this FIRST each iteration</li>
            <li>By story 10, Ralph knows patterns from stories 1-9</li>
          </ul>

          <div class="callout callout-warning">
            <div class="callout-title">Critical Rules</div>
            <ul>
              <li><strong>APPEND ONLY</strong> - never edit previous entries</li>
              <li>Patterns discovered go to the top section</li>
              <li>Learnings compound across iterations</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Cross-Session -->
      <div id="cross-session" class="scenario-block">
        <div class="scenario-header">
          <span class="scenario-type">Level 2</span>
          <h3 class="scenario-title">Cross-Session Learning</h3>
        </div>
        <div class="scenario-content">
          <p><strong>Mechanism:</strong> CLAUDE.md and AGENTS.md</p>

          <p>For knowledge that persists beyond a single Ralph loop:</p>

          <h4>CLAUDE.md - Project-Level Knowledge</h4>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code># Project: MyApp

## Tech Stack
- Next.js 14, TypeScript, Prisma, PostgreSQL

## Commands
- `npm run dev` - Dev server (port 3000)
- `npm test` - Run Jest tests

## Conventions
- All API routes in src/api/
- Use Zod for validation
- Repository pattern for data access

## Known Gotchas
- Migrations need DEFAULT for existing data
- Use .optional() for nullable Zod fields</code></pre>
          </div>

          <p><strong>When to Update CLAUDE.md:</strong></p>
          <ul>
            <li>Permanent patterns discovered</li>
            <li>Critical gotchas that apply to all future work</li>
            <li>Conventions that shouldn't change</li>
          </ul>

          <h4>Git History as Memory</h4>
          <p>The ultimate persistent memory:</p>
          <ul>
            <li>Commits as checkpoints</li>
            <li>Diff as context (what changed)</li>
            <li>History as narrative</li>
            <li>Rollback as safety net</li>
          </ul>

          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code># Agent reads history for context
git log --oneline -10
git diff main..HEAD</code></pre>
          </div>
        </div>
      </div>

      <!-- Cross-Run -->
      <div id="cross-run" class="scenario-block">
        <div class="scenario-header">
          <span class="scenario-type">Level 3</span>
          <h3 class="scenario-title">Cross-Run Learning (Compounding Ralph)</h3>
        </div>
        <div class="scenario-content">
          <p><strong>Mechanism:</strong> Archives and references</p>

          <p>The pattern that makes each run better than the last:</p>

          <h4>Archive Structure</h4>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code>archives/
|- run-2026-01-05/
|   |- prd.json
|   |- progress.txt
|   |- learnings.md
|- run-2026-01-06/
|   |- prd.json
|   |- progress.txt
|   |- learnings.md
|- run-2026-01-08/
    |- ...</code></pre>
          </div>

          <h4>Prompt Strategy for Cross-Run Learning</h4>
          <p>In <code>prompt.md</code>, instruct the agent:</p>

          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code>## Learning from Previous Runs

Before starting, review archives in `archives/` folder:
- What patterns worked well?
- What caused failures?
- What shortcuts were discovered?

Apply these learnings to current implementation.</code></pre>
          </div>

          <h4>What Gets Archived</h4>
          <div class="table-responsive">
            <table>
              <thead>
                <tr><th>Artifact</th><th>Purpose</th></tr>
              </thead>
              <tbody>
                <tr><td>prd.json</td><td>What was attempted, what passed</td></tr>
                <tr><td>progress.txt</td><td>Session learnings, patterns discovered</td></tr>
                <tr><td>learnings.md</td><td>Synthesized insights (optional)</td></tr>
                <tr><td>git commits</td><td>Actual code changes</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Cross-Project -->
      <div id="cross-project" class="scenario-block">
        <div class="scenario-header">
          <span class="scenario-type">Level 4</span>
          <h3 class="scenario-title">Cross-Project Learning (Semantic Memory)</h3>
        </div>
        <div class="scenario-content">
          <p><strong>Mechanism:</strong> Claude-Mem plugin</p>

          <p>For knowledge that spans multiple projects:</p>

          <div class="ascii-diagram">
+---------------------------------------------+
|  Claude Code Session                        |
|  |- Lifecycle Hooks                         |
|       |- Capture events                     |
+---------------------------------------------+
              |
              v
+---------------------------------------------+
|  Worker Service                             |
|  |- SQLite DB (raw data)                    |
|  |- Chroma Vector DB (embeddings)           |
|  |- Claude Agent SDK (compression)          |
+---------------------------------------------+
              |
              v
+---------------------------------------------+
|  Future Session                             |
|  |- Auto-inject relevant context            |
+---------------------------------------------+
          </div>

          <p><strong>How It Works:</strong></p>
          <ol>
            <li><strong>Capture:</strong> Lifecycle hooks log all session events to SQLite</li>
            <li><strong>Compress:</strong> Agent-SDK generates semantic summaries (~50-100 tokens)</li>
            <li><strong>Retrieve:</strong> 3-layer system (search -> timeline -> full details)</li>
            <li><strong>Inject:</strong> Relevant context auto-injected into new sessions</li>
          </ol>

          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code>{
  "context_injection_rules": {
    "auto_inject": true,
    "max_tokens": 5000
  }
}</code></pre>
          </div>
        </div>
      </div>

      <!-- Checkpoint -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint: Feedback Loop Types</div>
        <p><strong>You should now understand:</strong></p>
        <ul>
          <li>The 4 levels: within-session, cross-session, cross-run, cross-project</li>
          <li>progress.txt with Codebase Patterns section for within-session</li>
          <li>CLAUDE.md and AGENTS.md for cross-session</li>
          <li>Archives for cross-run; Claude-Mem for cross-project</li>
        </ul>
        <p><strong>If unclear:</strong> Focus on mastering levels 1-3 before attempting level 4 (Claude-Mem).</p>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Implementation -->
    <section id="implementation">
      <h2><span class="bionic">Imp</span>lementing <span class="bionic">Fee</span>dback <span class="bionic">Loo</span>ps</h2>

      <h3>The Progress.txt Pattern</h3>
      <p>The heart of within-session learning:</p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Progress Log - Append Only (NEVER UPDATE)

## Codebase Patterns
- [Accumulated patterns here - grows over time]
- Migrations: IF NOT EXISTS
- React: useRef&lt;Timeout | null&gt;(null)
- Zod: .optional() for nullable fields

## Key Files
- db/schema.ts
- app/auth/actions.ts

---

## 2026-01-09 - US-001
- **What:** Created tool skeleton with Zod schema
- **Files:** src/tools/upsert.ts
- **Learnings:**
  - Use orange for visibility on dark backgrounds
  - Pattern: Validate inputs before database operations

---

## 2026-01-09 - US-002
- **What:** Added category mapping
- **Files:** src/tools/categories.ts, src/types/index.ts
- **Issue:** Zod schema needed adjustment for optional fields
- **Pattern:** Added ".optional() for nullable" to Codebase Patterns</code></pre>
      </div>

      <h3>The Archive Pattern</h3>
      <p>End-of-run archival for cross-run learning:</p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>#!/bin/bash
# archive-run.sh - Run after Ralph completes

DATE=$(date +%Y-%m-%d)
RUN_ID=$(date +%H%M%S)
ARCHIVE_DIR="archives/run-$DATE-$RUN_ID"

mkdir -p "$ARCHIVE_DIR"

# Copy artifacts
cp plans/prd.json "$ARCHIVE_DIR/"
cp plans/progress.txt "$ARCHIVE_DIR/"

# Generate learnings summary
echo "# Learnings from Run $DATE-$RUN_ID" > "$ARCHIVE_DIR/learnings.md"
echo "" >> "$ARCHIVE_DIR/learnings.md"
echo "## Patterns Discovered" >> "$ARCHIVE_DIR/learnings.md"
head -20 plans/progress.txt | grep -A 100 "## Codebase Patterns" >> "$ARCHIVE_DIR/learnings.md"

# Git log for this run
git log --oneline --since="$(date -v-1d +%Y-%m-%d)" >> "$ARCHIVE_DIR/commits.log"

echo "Archived to $ARCHIVE_DIR"</code></pre>
      </div>

      <h3>The Reference Pattern</h3>
      <p>How the agent uses archives in subsequent runs:</p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># prompt.md - Instructions for Ralph

## Before You Start

1. Review `archives/` folder for recent runs
2. Look at `learnings.md` for patterns that worked
3. Check what failed and why
4. Apply these insights to current work

## Archive Analysis Checklist
- What database patterns were used?
- What validation approaches worked?
- Were there any repeated failures?
- What gotchas were discovered?

## Current Task
[Your PRD here]</code></pre>
      </div>

      <h3>The CLAUDE.md Update Pattern</h3>
      <p>Promoting learnings from session to permanent:</p>

      <div class="ascii-diagram">
progress.txt (session)
        |
        v  "This pattern is reusable"
        |
CLAUDE.md (permanent)
      </div>

      <p><strong>Criteria for Promotion:</strong></p>
      <ul>
        <li>Pattern applies to future work (not just this task)</li>
        <li>Gotcha will affect future developers</li>
        <li>Convention should be followed project-wide</li>
      </ul>
    </section>

    <hr class="section-divider">

    <!-- Measuring -->
    <section id="measuring">
      <h2><span class="bionic">Mea</span>suring <span class="bionic">Imp</span>rovement</h2>

      <h3>Metrics That Matter</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Metric</th><th>How to Measure</th><th>Good Signal</th></tr>
          </thead>
          <tbody>
            <tr><td>Iterations per task</td><td>Count Ralph loops</td><td>Decreasing over time</td></tr>
            <tr><td>First-attempt success rate</td><td>Tasks passing first try</td><td>Increasing</td></tr>
            <tr><td>Time to completion</td><td>Wall clock time</td><td>Decreasing</td></tr>
            <tr><td>Pattern reuse</td><td>References to Codebase Patterns</td><td>Increasing</td></tr>
            <tr><td>Failure repetition</td><td>Same error appearing</td><td>Decreasing</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Tracking Progress</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Run Statistics

## Run 2026-01-05
- Tasks: 5
- Iterations: 12
- First-try passes: 2/5 (40%)
- Time: 45 min

## Run 2026-01-08
- Tasks: 6
- Iterations: 8
- First-try passes: 4/6 (67%)
- Time: 30 min

## Trend: Improving</code></pre>
      </div>

      <h3>Signs of Successful Compounding</h3>
      <ol>
        <li><strong>Fewer iterations per task</strong> - Agent solves faster</li>
        <li><strong>Reduced failures</strong> - Known patterns avoid mistakes</li>
        <li><strong>Faster completion</strong> - Less exploration needed</li>
        <li><strong>Pattern references</strong> - Agent cites previous learnings</li>
        <li><strong>Smaller progress.txt additions</strong> - Less new to discover</li>
      </ol>
    </section>

    <hr class="section-divider">

    <!-- Anti-patterns -->
    <section id="anti-patterns">
      <h2><span class="bionic">Ant</span>i-patterns in <span class="bionic">Lea</span>rning</h2>

      <div class="gotcha-block">
        <h4>1. Not Archiving</h4>
        <p><strong>The Problem:</strong> Every run starts from zero. No compounding. Same mistakes repeated.</p>
        <p><strong>The Fix:</strong> Archive after every significant run: <code>./archive-run.sh</code></p>
      </div>

      <div class="gotcha-block">
        <h4>2. Not Referencing Prior Work</h4>
        <p><strong>The Problem:</strong> Agent doesn't read archives. Knowledge exists but isn't used.</p>
        <p><strong>The Fix:</strong> Explicitly instruct archive review in prompt.md</p>
      </div>

      <div class="gotcha-block">
        <h4>3. Over-relying on Session Memory</h4>
        <p><strong>The Problem:</strong> Using context compaction instead of external files. Lossy. Detail lost.</p>
        <p><strong>The Fix:</strong> Externalize everything: progress.txt, prd.json, git, CLAUDE.md</p>
      </div>

      <div class="gotcha-block">
        <h4>4. Bloated CLAUDE.md</h4>
        <p><strong>The Problem:</strong> Everything promoted to CLAUDE.md. Context window filled with irrelevant history.</p>
        <p><strong>The Fix:</strong> Keep CLAUDE.md under 500 tokens. Only truly permanent patterns.</p>
      </div>

      <div class="gotcha-block">
        <h4>5. Progress.txt Editing</h4>
        <p><strong>The Problem:</strong> Editing previous entries. History lost. Can't trace what happened when.</p>
        <p><strong>The Fix:</strong> APPEND ONLY. Never modify. The log is the log.</p>
      </div>

      <div class="gotcha-block">
        <h4>6. No Verification Loop</h4>
        <p><strong>The Problem:</strong> Agent marks tasks complete without testing. False completion compounds.</p>
        <p><strong>The Fix:</strong> Always include verification in acceptance criteria.</p>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Lifecycle -->
    <section id="lifecycle">
      <h2>The <span class="bionic">Com</span>pounding <span class="bionic">Dev</span>elopment <span class="bionic">Lif</span>ecycle</h2>

      <h3>Daily Cycle</h3>
      <div class="ascii-diagram">
Morning: Review overnight Ralph output
    |
    v
Midday: Update CLAUDE.md with new learnings
    |
    v
Afternoon: Plan next Ralph run
    |
    v
Evening: Write PRD, start Ralph
    |
    v
Night: Ralph runs autonomously
    |
    v
[Repeat]
      </div>

      <h3>Weekly Cycle</h3>
      <div class="ascii-diagram">
Monday: Review week's archives
    |
    v
Tuesday-Thursday: Run features
    |
    v
Friday: Consolidate learnings
    |
    v
Weekend: Archive cleanup, pattern synthesis
    |
    v
[Next Week: Reference this week's learnings]
      </div>

      <h3>The Mental Model</h3>
      <blockquote>
        <p>"Think of AI coding as an extremely persistent but context-limited junior developer who works 24/7. You become the product manager/architect. Each run should benefit from all previous runs."</p>
      </blockquote>

      <h3>Key Principles</h3>
      <ol>
        <li><strong>Heavy upfront planning</strong> pays massive dividends</li>
        <li><strong>Persistence &gt; perfection</strong> in single prompt (iterate many times)</li>
        <li><strong>Memory via artifacts</strong> (JSON, git, logs) &gt; relying on long context</li>
        <li><strong>Compounding returns</strong> - each run makes the next better</li>
        <li><strong>Parallelization</strong> - run multiple Ralphs simultaneously</li>
      </ol>
    </section>

    <hr class="section-divider">

    <!-- Verification -->
    <section id="verification">
      <h2>The <span class="bionic">Ver</span>ification <span class="bionic">Imp</span>erative</h2>

      <p>Per Boris Cherny (Claude Code creator):</p>
      <blockquote>
        <p>"Verification feedback loop -> 2-3x quality"</p>
        <cite>-- Boris Cherny</cite>
      </blockquote>

      <p>Without verification, learning is corrupted:</p>
      <ul>
        <li>False completions pollute progress.txt</li>
        <li>Bad patterns get archived</li>
        <li>Future runs learn from failures, not successes</li>
      </ul>

      <h3>Verification Hierarchy</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Priority</th><th>Method</th><th>Use Case</th></tr>
          </thead>
          <tbody>
            <tr><td>1</td><td>Type checking</td><td><code>pnpm typecheck</code> - Always</td></tr>
            <tr><td>2</td><td>Unit tests</td><td><code>pnpm test</code> - For logic</td></tr>
            <tr><td>3</td><td>CI green</td><td>Every commit must pass</td></tr>
            <tr><td>4</td><td>Browser automation</td><td>Playwright for UI</td></tr>
            <tr><td>5</td><td>Manual spot-check</td><td>Human at milestones</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Verification in PRD</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>{
  "acceptanceCriteria": [
    "Dropdown renders with options: All, Active, Inactive",
    "Selecting option filters list correctly",
    "npm run typecheck passes",
    "npm run test passes",
    "Visual verification via Playwright screenshot"
  ]
}</code></pre>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Architecture -->
    <section id="architecture">
      <h2><span class="bionic">Adv</span>anced: <span class="bionic">Lea</span>rning <span class="bionic">Arc</span>hitecture</h2>

      <h3>The Full Stack</h3>
      <div class="ascii-diagram">
+-------------------------------------------------------------+
|                    SEMANTIC MEMORY                          |
|  (Claude-Mem: Cross-project patterns, long-term knowledge)  |
+-------------------------------------------------------------+
                              ^
                              |
+-------------------------------------------------------------+
|                    CROSS-RUN ARCHIVES                       |
|  (archives/: PRDs, progress logs, synthesized learnings)    |
+-------------------------------------------------------------+
                              ^
                              |
+-------------------------------------------------------------+
|                    CROSS-SESSION STATE                      |
|  (CLAUDE.md, AGENTS.md, git history)                        |
+-------------------------------------------------------------+
                              ^
                              |
+-------------------------------------------------------------+
|                    WITHIN-SESSION LEARNING                  |
|  (progress.txt: append-only, Codebase Patterns section)     |
+-------------------------------------------------------------+
                              ^
                              |
+-------------------------------------------------------------+
|                    INSTANT FEEDBACK                         |
|  (Tests, typecheck, CI, browser automation)                 |
+-------------------------------------------------------------+
      </div>

      <h3>Flow Direction</h3>
      <div class="ascii-diagram">
Instant Feedback (tests pass/fail)
        |
        v  "This approach works"
Within-Session (progress.txt pattern)
        |
        v  "This pattern is reusable"
Cross-Session (CLAUDE.md update)
        |
        v  "Archive this run's learnings"
Cross-Run Archives
        |
        v  "Query for similar situations"
Semantic Memory (future sessions)
      </div>
    </section>

    <hr class="section-divider">

    <!-- Quick Reference -->
    <section id="quick-reference">
      <h2><span class="bionic">Qui</span>ck <span class="bionic">Ref</span>erence: <span class="bionic">Lea</span>rning <span class="bionic">Loop</span> <span class="bionic">Che</span>cklist</h2>

      <h3>Before Each Run</h3>
      <ul>
        <li>Review recent archives</li>
        <li>Check CLAUDE.md for relevant patterns</li>
        <li>Write PRD with explicit verification criteria</li>
      </ul>

      <h3>During Each Run</h3>
      <ul>
        <li>progress.txt updated after each iteration</li>
        <li>Codebase Patterns section maintained</li>
        <li>Git commits after each passing task</li>
      </ul>

      <h3>After Each Run</h3>
      <ul>
        <li>Archive PRD, progress, learnings</li>
        <li>Promote key patterns to CLAUDE.md</li>
        <li>Clean up temporary notes</li>
      </ul>

      <h3>Weekly Review</h3>
      <ul>
        <li>Consolidate archives</li>
        <li>Synthesize cross-run patterns</li>
        <li>Prune CLAUDE.md if bloated</li>
        <li>Update prompt.md with new instructions</li>
      </ul>

      <h3>The Learning Commandments</h3>
      <ol>
        <li><strong>Archive everything.</strong> Runs that disappear teach nothing.</li>
        <li><strong>Reference archives.</strong> Knowledge unused is knowledge wasted.</li>
        <li><strong>Append, never edit.</strong> progress.txt is sacred history.</li>
        <li><strong>Verify before logging.</strong> False completions corrupt learning.</li>
        <li><strong>Promote patterns.</strong> Session learnings -> permanent knowledge.</li>
        <li><strong>Prune regularly.</strong> Context is finite; keep only what matters.</li>
        <li><strong>Measure improvement.</strong> If you can't track it, you can't improve it.</li>
        <li><strong>Compound daily.</strong> Each run should benefit from all previous runs.</li>
        <li><strong>External over internal.</strong> Files outlast context windows.</li>
        <li><strong>The agent is stateless.</strong> Memory is architecture, not magic.</li>
      </ol>
    </section>

    <hr class="section-divider">

    <!-- Troubleshooting -->
    <section id="troubleshooting">
      <h2><span class="bionic">Tro</span>ubleshooting</h2>

      <details class="troubleshoot">
        <summary>progress.txt Becomes Too Large</summary>
        <div>
          <p><strong>Symptom:</strong> Agent spends excessive time reading progress.txt; context fills quickly</p>
          <p><strong>Cause:</strong> Unbounded accumulation without pruning</p>
          <p><strong>Fix:</strong></p>
          <ol>
            <li>Promote stable patterns to CLAUDE.md, then remove from progress.txt</li>
            <li>Archive old entries to <code>archives/</code> after each significant run</li>
            <li>Keep progress.txt focused on current session + recent patterns only</li>
            <li>Target: progress.txt should stay under 2000 tokens</li>
          </ol>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Archives Not Being Referenced</summary>
        <div>
          <p><strong>Symptom:</strong> Runs repeat the same mistakes despite archived learnings</p>
          <p><strong>Cause:</strong> Prompt doesn't explicitly instruct archive review</p>
          <p><strong>Fix:</strong> Add explicit archive instruction to prompt.md:</p>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code>## Before Starting
1. Review `archives/` folder for recent runs
2. Read `learnings.md` from most recent 2-3 runs
3. Note patterns that worked AND failed
4. Apply these insights to current implementation</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>CLAUDE.md Becomes Bloated</summary>
        <div>
          <p><strong>Symptom:</strong> CLAUDE.md exceeds 500 tokens; context budget consumed by instructions</p>
          <p><strong>Cause:</strong> Promoting too many patterns without pruning</p>
          <p><strong>Fix:</strong></p>
          <ol>
            <li>CLAUDE.md is for permanent, project-wide patterns ONLY</li>
            <li>If a pattern is session-specific, keep it in progress.txt</li>
            <li>Prune quarterly: remove patterns that are now obvious or obsolete</li>
            <li>Use imports (<code>@docs/...</code>) for detailed references, not inline content</li>
          </ol>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Verification Failures Corrupt Learning</summary>
        <div>
          <p><strong>Symptom:</strong> False completions in archives; agent learns wrong patterns</p>
          <p><strong>Cause:</strong> Marking complete without actual verification</p>
          <p><strong>Fix:</strong></p>
          <ol>
            <li>Every PRD item MUST include testable acceptance criteria</li>
            <li>Include <code>npm run typecheck passes</code> and <code>npm run test passes</code></li>
            <li>If verification fails, learnings should note the FAILURE, not success</li>
            <li>Manual review archives periodically for corrupted learnings</li>
          </ol>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Compounding Not Working (No Improvement Over Runs)</summary>
        <div>
          <p><strong>Symptom:</strong> Run 10 is no better than Run 1</p>
          <p><strong>Cause:</strong> Usually missing one of: archiving, referencing, or pattern promotion</p>
          <p><strong>Fix:</strong> Verify the full cycle:</p>
          <ol>
            <li>Are you archiving after each run? (<code>./archive-run.sh</code>)</li>
            <li>Does prompt instruct agent to READ archives?</li>
            <li>Are learnings being promoted to Codebase Patterns section?</li>
            <li>Is agent ACTUALLY reading the files (check context usage)?</li>
          </ol>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Cross-Project Learning Not Transferring</summary>
        <div>
          <p><strong>Symptom:</strong> Claude-Mem configured but no cross-project benefit</p>
          <p><strong>Cause:</strong> Retrieval not matching or injection not happening</p>
          <p><strong>Fix:</strong></p>
          <ol>
            <li>Verify Claude-Mem is capturing: check SQLite DB for entries</li>
            <li>Verify retrieval: manually query for relevant patterns</li>
            <li>Check injection rules in config: is <code>auto_inject: true</code>?</li>
            <li>Consider if patterns are truly cross-project or project-specific</li>
          </ol>
        </div>
      </details>
    </section>

    <hr class="section-divider">

    <!-- Related Pages -->
    <div class="related-pages">
      <h3>Related Principles Documents</h3>
      <ul>
        <li><a href="principles-core.html">Core Principles</a> - The 8 foundational principles</li>
        <li><a href="principles-derivation-guide.html">Derivation Guide</a> - How to create new patterns</li>
        <li><a href="principles-anti-patterns.html">Anti-Patterns</a> - What NOT to do and why</li>
      </ul>
    </div>

    <!-- Footer Navigation -->
    <nav class="footer-nav">
      <a href="principles-derivation-guide.html" class="nav-prev">
        <span class="nav-direction">Previous</span>
        <span class="nav-title">Derivation Guide</span>
      </a>
      <a href="principles-anti-patterns.html" class="nav-next">
        <span class="nav-direction">Next</span>
        <span class="nav-title">Anti-Patterns</span>
      </a>
    </nav>

    <!-- Tags -->
    <div style="margin-top: 2rem;">
      <span class="tag">#learning-loops</span>
      <span class="tag">#feedback-engineering</span>
      <span class="tag">#compounding-ralph</span>
      <span class="tag">#progress-tracking</span>
      <span class="tag">#archives</span>
      <span class="tag">#cross-session</span>
      <span class="tag">#within-session</span>
      <span class="tag">#verification</span>
      <span class="tag">#claude-mem</span>
      <span class="tag">#external-memory</span>
    </div>
  </div>

  <script src="../js/copy-code.js"></script>
  <script src="../js/search.js"></script>
  <script src="../js/global-nav.js"></script>
</body>
</html>
