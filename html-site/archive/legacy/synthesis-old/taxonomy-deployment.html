<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta data-pagefind-meta="section" content="Synthesis">
  <meta data-pagefind-meta="category" content="Taxonomy">
  <title>Deployment Architecture Taxonomy - Claude Code Knowledge Base</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/sidebar.css">
  <link rel="stylesheet" href="../css/search.css">
</head>
<body>
  <!-- Search Modal -->
  <div class="search-modal" id="searchModal" aria-hidden="true">
    <div class="search-overlay" onclick="closeSearch()"></div>
    <div class="search-content">
      <div class="search-header">
        <div class="search-input-wrapper">
          <span class="search-icon-input">&#128269;</span>
          <input type="text" id="searchInput" placeholder="Search documentation..." autocomplete="off" />
          <kbd class="search-kbd">ESC</kbd>
        </div>
      </div>
      <div class="search-filters">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="synthesis">Synthesis</button>
        <button class="filter-btn" data-filter="extractions">Extractions</button>
        <button class="filter-btn" data-filter="journeys">Journeys</button>
      </div>
      <div class="search-results" id="searchResults">
        <div class="search-empty"><p>Start typing to search... (Press Cmd+K anytime)</p></div>
      </div>
      <div class="search-footer">
        <span>Up/Down Navigate</span><span>Enter Select</span><span>ESC Close</span>
      </div>
    </div>
  </div>

  <nav class="left-nav" id="leftNav">
    <div class="px-4 mb-4">
      <a href="../index.html" class="text-xs font-semibold text-accent hover:text-accent-light uppercase tracking-wider">Claude Code KB</a>
    </div>
    <div class="nav-content"></div>
  </nav>

  <button class="search-trigger" onclick="openSearch()" aria-label="Search" style="float: right; margin-bottom: 1rem;">
    <span class="search-icon">Cmd+K</span>
    <span class="search-text">Search</span>
  </button>

  <div class="wide-container">
    <!-- Breadcrumb Navigation -->
    <nav class="nav-breadcrumb">
      <a href="../index.html">Home</a>
      <span>/</span>
      <a href="synthesis-index.html">Synthesis</a>
      <span>/</span>
      <a href="taxonomy-master.html">Taxonomy</a>
      <span>/</span>
      <span>Deployment</span>
    </nav>

    <!-- You Are Here Context Box -->
    <div class="you-are-here" style="background: linear-gradient(135deg, #f0ebe3 0%, #fefcf3 100%); border-left: 4px solid #2a7d7d; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
      <h3 style="color: #2a7d7d; margin-top: 0; font-size: 0.9em; text-transform: uppercase; letter-spacing: 0.5px;">You Are Here</h3>
      <p style="margin-bottom: 0;"><strong><span class="b">Dep</span>loyment <span class="b">Arch</span>itecture <span class="b">Tax</span>onomy</strong> - The infrastructure reference for running Claude Code. Covers every deployment pattern (local, cloud VM, Docker, serverless, mobile), security considerations, cost analysis, and decision trees for choosing the right environment for your workflow.</p>
      <p style="margin-top: 0.5rem; font-size: 0.9em; color: #666;"><em>Note: This content is also covered in D-FINAL-operations Section 4.</em></p>
    </div>

    <h1><span class="b">Dep</span>loyment <span class="b">Arch</span>itecture <span class="b">Tax</span>onomy</h1>

    <!-- Table of Contents -->
    <div class="toc">
      <div class="toc-title">Contents</div>
      <ul>
        <li><a href="#overview">Overview</a></li>
        <li><a href="#local-development">Local Development</a></li>
        <li><a href="#remote-terminal">Remote Terminal Access</a></li>
        <li><a href="#containerized">Containerized Execution</a></li>
        <li><a href="#serverless">Serverless and Cloud</a></li>
        <li><a href="#browser-automation">Browser Automation Infrastructure</a></li>
        <li><a href="#multi-agent-infra">Multi-Agent Orchestration Infrastructure</a></li>
        <li><a href="#mobile">Mobile and Cross-Device</a></li>
        <li><a href="#sandboxing">Sandboxing Strategies</a></li>
        <li><a href="#security">Security Architecture</a></li>
        <li><a href="#decision-tree">Decision Tree</a></li>
        <li><a href="#cost-analysis">Cost Analysis</a></li>
        <li><a href="#troubleshooting">Troubleshooting</a></li>
      </ul>
    </div>

    <hr class="section-divider">

    <!-- Overview -->
    <section id="overview">
      <h2><span class="b">Over</span>view</h2>

      <p>Claude Code can be deployed across a spectrum of infrastructure patterns, from bare-metal local execution to fully serverless cloud architectures. This taxonomy provides an exhaustive classification to help practitioners select the appropriate deployment strategy.</p>

      <h3>Deployment Spectrum</h3>
      <div class="ascii-diagram">
                LOCAL <-------------------------------> CLOUD
                  |                                       |
Direct CLI ---------> VM/SSH ---------> Container ---------> Serverless
     |                  |                   |                    |
Bare metal         Persistent          Isolated            Ephemeral
Full access        Terminal            Sandboxed           Managed
No isolation       Manual              Reproducible        Scalable</div>

      <h3>Key Dimensions</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Dimension</th><th>Spectrum</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Isolation</strong></td><td>None --> Process --> Container --> VM --> Cloud Sandbox</td></tr>
            <tr><td><strong>Persistence</strong></td><td>Ephemeral --> Session --> Persistent --> Durable</td></tr>
            <tr><td><strong>Scalability</strong></td><td>Single Instance --> Parallel --> Auto-Scaling</td></tr>
            <tr><td><strong>Network</strong></td><td>Full Access --> Allowlist --> API-Only --> Isolated</td></tr>
            <tr><td><strong>Security</strong></td><td>Permissive --> Gated --> Sandboxed --> Zero-Trust</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Local Development -->
    <section id="local-development">
      <h2><span class="b">Loc</span>al <span class="b">Dev</span>elopment</h2>

      <h3>1. Direct Claude Code CLI</h3>
      <p>The simplest deployment pattern: Claude Code running directly on your local machine.</p>

      <div class="ascii-diagram">
+-------------------------------------------------------------+
|  Local Machine                                               |
|  +----------------------------------------------------------+
|  |  Terminal                                                 |
|  |  +-- claude (CLI)                                        |
|  |       +-- Tools: Read, Write, Edit, Bash                 |
|  |       +-- File System: Full access                       |
|  |       +-- Network: Full access (API calls)               |
|  +----------------------------------------------------------+
+-------------------------------------------------------------+</div>

      <p><strong>Characteristics:</strong> Zero setup overhead, full file system access, interactive permission prompts, session-based context.</p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Basic usage
claude

# With specific model
claude --model claude-opus-4-5-20251101

# Continue previous session
claude --continue

# Headless/scripted mode
claude --print "Review this file" < file.ts</code></pre>
      </div>

      <h3>2. tmux-Based Local Sessions</h3>
      <p>Persistent terminal sessions for long-running work.</p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># ~/.tmux.conf
set -g mouse on
set -g history-limit 100000
set -g base-index 1

# Auto-save sessions
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @continuum-restore 'on'
set -g @resurrect-processes 'claude node python'

# Status bar showing git branch
set -g status-right '#(cd #{pane_current_path} && git branch --show-current)'</code></pre>
      </div>

      <h3>3. Git Worktrees for Parallel Isolation</h3>
      <p>Branch-based parallelization without conflicts.</p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>#!/bin/bash
# spawn-parallel-agent.sh

BRANCH=$1
TASK=$2
WORKTREE_DIR="../worktrees/$BRANCH"

# Create worktree
git worktree add "$WORKTREE_DIR" -b "$BRANCH" 2>/dev/null || \
git worktree add "$WORKTREE_DIR" "$BRANCH"

# Launch Claude in worktree
cd "$WORKTREE_DIR"
tmux new-window -n "$BRANCH" "claude '$TASK'"

echo "Agent started in $WORKTREE_DIR"</code></pre>
      </div>

      <h3>4. Ralph Loop Local Execution</h3>
      <p>Autonomous iteration with fresh context per cycle.</p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>#!/bin/bash
# ralph.sh
MAX_ITERATIONS=${1:-25}

for (( i=1; i<=MAX_ITERATIONS; i++ )); do
  echo "=== Iteration $i / $MAX_ITERATIONS ==="

  claude "Review plans/prd.json and plans/progress.txt.
    Pick ONE feature with passes: false.
    Implement it. Run tests.
    If passing, mark passes: true and commit.
    Append learnings to progress.txt.
    If ALL complete, output: <promise>COMPLETE</promise>" | tee output.txt

  if grep -q "<promise>COMPLETE</promise>" output.txt; then
    echo "=== PRD Complete! ==="
    break
  fi
done</code></pre>
      </div>

      <!-- Checkpoint -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint: Local Development</div>
        <p><strong>You should now understand:</strong></p>
        <ul>
          <li>The 4 local patterns: Direct CLI, tmux, Git Worktrees, Ralph Loop</li>
          <li>How to set up tmux for persistent sessions</li>
          <li>The worktree spawn pattern for parallel agents</li>
          <li>Ralph loop file structure (prd.json, progress.txt, ralph.sh)</li>
        </ul>
        <p><strong>Terminal verification:</strong></p>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code># Test your local setup
claude --version && tmux -V && git worktree list
# You should see: version numbers and worktree list</code></pre>
        </div>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Remote Terminal Access -->
    <section id="remote-terminal">
      <h2><span class="b">Rem</span>ote <span class="b">Term</span>inal Access</h2>

      <h3>Cloud VM with SSH/mosh</h3>

      <div class="ascii-diagram">
+-------------------------------------------------------------+
|  CLIENT DEVICES                                              |
|  +-- Laptop --------------------------+                      |
|  +-- Phone ----------------------------+  SSH/mosh           |
|  +-- Tablet ---------------------------+  (Tailscale VPN)    |
+--------------------------------------+------------------------+
                                       |
                                       v
+-------------------------------------------------------------+
|  CLOUD VM (Hetzner/Vultr/AWS)                               |
|  +----------------------------------------------------------+
|  |  Security                                                 |
|  |  +-- No public SSH (Tailscale only)                      |
|  |  +-- fail2ban + nftables                                 |
|  |  +-- Non-root user                                       |
|  +----------------------------------------------------------+
|  |  tmux Session                                            |
|  |  +-- Window 1: Claude Code (main)                        |
|  |  +-- Window 2-6: Parallel agents (worktrees)             |
|  |  +-- Window 7: Monitoring                                |
|  +----------------------------------------------------------+
+-------------------------------------------------------------+</div>

      <h3>Provider Comparison</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Provider</th><th>Tier</th><th>Cost/Month</th><th>Best For</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Hetzner</strong></td><td>CX31 (4 vCPU, 8GB)</td><td>$13</td><td>Best value (EU)</td></tr>
            <tr><td><strong>Vultr</strong></td><td>vhf-8c-32gb</td><td>~$210 (or $7/day)</td><td>US, hourly billing</td></tr>
            <tr><td><strong>DigitalOcean</strong></td><td>s-4vcpu-8gb</td><td>$48</td><td>Simple UX</td></tr>
            <tr><td><strong>AWS EC2</strong></td><td>t3.xlarge</td><td>$120</td><td>Enterprise</td></tr>
            <tr><td><strong>Oracle Cloud</strong></td><td>Always Free</td><td>$0</td><td>Budget option</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Setup Pattern (Hetzner)</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># 1. Create VM
hcloud server create --name claude-dev --type cx31 --image ubuntu-24.04

# 2. Install Tailscale
curl -fsSL https://tailscale.com/install.sh | sh
tailscale up

# 3. Harden SSH
ufw allow from 100.64.0.0/10  # Tailscale CIDR only
ufw enable

# 4. Install Claude Code
npm install -g @anthropic-ai/claude-code

# 5. Configure tmux auto-attach
echo 'if [[ -z "$TMUX" ]]; then tmux attach -t main 2>/dev/null || tmux new -s main; fi' >> ~/.zshrc</code></pre>
      </div>

      <h3>Home Mac/PC as Always-On Server</h3>
      <p>Zero-cost cloud alternative using home hardware.</p>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Prevent Mac sleep
caffeinate -i &

# Or via pmset
sudo pmset -a sleep 0 disksleep 0

# Add to Login Items: Terminal with `claude`</code></pre>
      </div>
      <p><strong>Cost:</strong> $0/month (electricity only)</p>
    </section>

    <hr class="section-divider">

    <!-- Containerized Execution -->
    <section id="containerized">
      <h2><span class="b">Cont</span>ainerized <span class="b">Exec</span>ution</h2>

      <h3>Basic Docker Setup</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Dockerfile
FROM node:20-alpine

# Security hardening
RUN apk add --no-cache dumb-init git
RUN npm install -g @anthropic-ai/claude-code

# Non-root user
RUN addgroup -g 1000 claude && adduser -u 1000 -G claude -D claude
USER claude

WORKDIR /workspace
ENTRYPOINT ["/usr/bin/dumb-init", "--"]
CMD ["claude"]</code></pre>
      </div>

      <h3>docker-compose.yml</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>version: '3.8'
services:
  claude:
    build: .
    volumes:
      - ./project:/workspace
      - claude-config:/home/claude/.claude
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    read_only: true
    tmpfs:
      - /tmp:size=100M,mode=1777

volumes:
  claude-config:</code></pre>
      </div>

      <h3>Multi-Container Parallel Agents (AI-Maestro Pattern)</h3>
      <div class="ascii-diagram">
+-------------------------------------------------------------+
|                   AI-Maestro Orchestrator                   |
|  +----------------------------------------------------------+
|  |  Agent Pool                                               |
|  |  +-------------+ +-------------+ +-------------+          |
|  |  | Container 1 | | Container 2 | | Container 3 |          |
|  |  | Claude      | | Claude      | | Claude      |          |
|  |  | Branch: A   | | Branch: B   | | Branch: C   |          |
|  |  +-------------+ +-------------+ +-------------+          |
|  |        |               |               |                  |
|  |        +---------------------------------+                 |
|  |                        |                                  |
|  |             +----------------------+                      |
|  |             | Shared Docker Volume |                      |
|  |             | (file-based messaging)|                     |
|  |             +----------------------+                      |
|  +----------------------------------------------------------+
+-------------------------------------------------------------+</div>
    </section>

    <hr class="section-divider">

    <!-- Serverless and Cloud -->
    <section id="serverless">
      <h2><span class="b">Serv</span>erless and <span class="b">Clo</span>ud</h2>

      <h3>Cloudflare Workers + Claude Agent SDK</h3>
      <div class="ascii-diagram">
+-------------------------------------------------------------+
|  Cloudflare Edge Network                                     |
|  +----------------------------------------------------------+
|  |  Worker (Stateless Compute)                               |
|  |  +-- Claude Agent SDK                                     |
|  |  +-- Skills (mini-apps)                                   |
|  |  +-- Tool orchestration                                   |
|  |  +-- WebSocket for real-time                              |
|  +----------------------------------------------------------+
|  |  Durable Object (Stateful)                                |
|  |  +-- Session persistence                                  |
|  |  +-- Transcript storage                                   |
|  |  +-- Resume on sandbox death                              |
|  +----------------------------------------------------------+
|  |  Sandbox (Code Execution)                                 |
|  |  +-- Tier: standard-2 (required for >10s)                |
|  |  +-- Dynamic code writing                                 |
|  |  +-- Safe execution environment                           |
|  +----------------------------------------------------------+
+-------------------------------------------------------------+</div>

      <p><strong>The Stack:</strong></p>
      <ul>
        <li>Claude Agent SDK = Reliable tool loop (official harness)</li>
        <li>Skills = Composable mini-applications</li>
        <li>Sandbox = Safe code execution</li>
      </ul>

      <p><strong>Starter Template:</strong> github.com/craigsdennis/claude-in-the-box</p>

      <h3>E2B Sandboxed Execution</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>from e2b import Sandbox

with Sandbox() as sandbox:
    result = sandbox.run_code(agent_generated_code)
    # Returns to agent for analysis</code></pre>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Browser Automation Infrastructure -->
    <section id="browser-automation">
      <h2><span class="b">Brow</span>ser <span class="b">Auto</span>mation Infrastructure</h2>

      <h3>Claude for Chrome (Local Browser)</h3>
      <p>Native browser automation via Chrome extension with 19 tools: navigate, screenshot, click, get_text, etc.</p>

      <div class="callout callout-warning">
        <div class="callout-title">Security Concerns</div>
        <ul>
          <li>Cookies/sessions exposed</li>
          <li>Prompt injection could exfiltrate data</li>
          <li>Personal browser state vulnerable</li>
        </ul>
      </div>

      <h3>Browserbase (Remote Cloud Browsers)</h3>
      <p>Cloud browser infrastructure for safe, scalable automation.</p>
      <ul>
        <li><strong>Security:</strong> Isolated cloud execution</li>
        <li><strong>Scale:</strong> Parallel browser sessions</li>
        <li><strong>Production-grade:</strong> Headless, reliable</li>
        <li><strong>Stealth:</strong> Claude doesn't know the difference</li>
      </ul>

      <h3>Playwright MCP Server</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>{
  "mcp": {
    "servers": {
      "playwright": {
        "command": "npx",
        "args": ["@anthropic-ai/mcp-server-playwright"],
        "env": {
          "HEADLESS": "true"
        }
      }
    }
  }
}</code></pre>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Multi-Agent Orchestration Infrastructure -->
    <section id="multi-agent-infra">
      <h2><span class="b">Multi</span>-Agent <span class="b">Orch</span>estration Infrastructure</h2>

      <h3>Personal Panopticon (Domain-Isolated Instances)</h3>
      <p>8 parallel Claude instances, each owning a life domain.</p>

      <div class="ascii-diagram">
+-------------------------------------------------------------+
|  Personal Panopticon                                         |
|  +-------+ +-------+ +-------+ +-------+                     |
|  |~/nox  | |~/metrics| |~/email| |~/growth|                  |
|  |Company| |Analytics| |Comms  | |Marketing|                 |
|  +-------+ +-------+ +-------+ +-------+                     |
|  +-------+ +-------+ +-------+ +--------+                    |
|  |~/trades| |~/health| |~/writing| |~/personal|              |
|  |Finance| |Wellness| |Content | |Life Admin|                |
|  +-------+ +-------+ +-------+ +--------+                    |
|                                                              |
|  Each instance:                                              |
|  +-- Isolated directory                                      |
|  +-- Spawns short-lived subagents                           |
|  +-- File-based handoffs between domains                     |
|  +-- Can control desktop apps via mouse/keystroke            |
+-------------------------------------------------------------+</div>

      <h3>Gas Town (Agent Factory)</h3>
      <p>Industrial-scale agent orchestration with specialized roles.</p>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Role</th><th>Purpose</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Mayor</strong></td><td>Town-wide coordination</td></tr>
            <tr><td><strong>Deacon</strong></td><td>Monitoring and handshakes between agents</td></tr>
            <tr><td><strong>Dogs</strong></td><td>Quality gates and watchdogs</td></tr>
            <tr><td><strong>Refinery</strong></td><td>Task decomposition</td></tr>
            <tr><td><strong>Polecat</strong></td><td>Named persistent workers</td></tr>
            <tr><td><strong>Crew</strong></td><td>Ephemeral workers</td></tr>
            <tr><td><strong>Witness</strong></td><td>Per-rig observer</td></tr>
          </tbody>
        </table>
      </div>

      <blockquote>
        <p>"If you have any doubt whatsoever, then you can't use it."</p>
        <cite>-- Steve Yegge on Gas Town requirements</cite>
      </blockquote>
    </section>

    <hr class="section-divider">

    <!-- Mobile and Cross-Device -->
    <section id="mobile">
      <h2><span class="b">Mob</span>ile and <span class="b">Cross</span>-Device</h2>

      <h3>Phone SSH Setup (dabit3 Pattern)</h3>
      <div class="ascii-diagram">
+-------------------------------------------------------------+
|  PHONE                                                       |
|  +-- Termius (SSH/mosh client)                               |
|  +-- Tailscale VPN                                           |
|  +-- Poke (push notifications)                               |
+--------------------------------------+-----------------------+
                                       | Tailscale VPN
                                       v
+-------------------------------------------------------------+
|  CLOUD VM ($7/day)                                           |
|  +-- tmux (6 parallel Claude windows)                        |
|  +-- Git worktrees (branch isolation)                        |
|  +-- PreToolUse hook --> Poke webhook                        |
|  +-- Security: nftables, fail2ban, no public SSH             |
+-------------------------------------------------------------+</div>

      <h3>Push Notification Hook</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>#!/bin/bash
# notify-mobile.sh
QUESTION=$(echo "$CLAUDE_HOOK_EVENT_DATA" | jq -r '.tool_input.questions[0].question')
curl -X POST "https://api.poke.fm/v1/notify" \
  -H "Authorization: Bearer $POKE_TOKEN" \
  -d "{\"title\": \"Claude needs input\", \"body\": \"$QUESTION\"}"</code></pre>
      </div>

      <h3>SSH Clients for Mobile</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>App</th><th>Platform</th><th>Cost</th><th>mosh Support</th></tr>
          </thead>
          <tbody>
            <tr><td>Termius</td><td>iOS/Android</td><td>Free/$10mo</td><td>Yes</td></tr>
            <tr><td>Blink Shell</td><td>iOS</td><td>$20</td><td>Yes</td></tr>
            <tr><td>Prompt 3</td><td>iOS</td><td>$25</td><td>No</td></tr>
            <tr><td>Termux</td><td>Android</td><td>Free</td><td>Yes</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Teleportation (Session Handoff)</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># In terminal Claude session
--teleport
# or just type: &

# Outputs URL like: https://claude.ai/code/session/abc123
# Open URL on any device to continue</code></pre>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Sandboxing Strategies -->
    <section id="sandboxing">
      <h2><span class="b">Sand</span>boxing <span class="b">Strat</span>egies</h2>

      <h3>Sandboxing Levels Overview</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Level</th><th>Isolation</th><th>Performance</th><th>Use Case</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>None</strong></td><td>No isolation</td><td>Full speed</td><td>Trusted, supervised work</td></tr>
            <tr><td><strong>Process</strong></td><td>Limited</td><td>Good</td><td>Basic separation</td></tr>
            <tr><td><strong>Container</strong></td><td>Strong</td><td>Good</td><td>Development, CI/CD</td></tr>
            <tr><td><strong>VM</strong></td><td>Maximum</td><td>Overhead</td><td>Untrusted, autonomous</td></tr>
            <tr><td><strong>Cloud Sandbox</strong></td><td>Maximum + Managed</td><td>Variable</td><td>Production serverless</td></tr>
          </tbody>
        </table>
      </div>

      <h3>YOLO Mode - When Appropriate</h3>
      <p><code>--dangerously-skip-permissions</code> should ONLY be used:</p>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Scenario</th><th>Safe?</th><th>Notes</th></tr>
          </thead>
          <tbody>
            <tr><td>Isolated VM/container</td><td>Yes</td><td>No risk to host</td></tr>
            <tr><td>Disposable cloud instance</td><td>Yes</td><td>Can terminate/rebuild</td></tr>
            <tr><td>CI/CD sandboxed runners</td><td>Conditional</td><td>Only in isolated runners</td></tr>
            <tr><td>Local development machine</td><td><strong>No</strong></td><td>Risk of destructive commands</td></tr>
            <tr><td>Production systems</td><td><strong>Never</strong></td><td>Catastrophic potential</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Security Architecture -->
    <section id="security">
      <h2><span class="b">Sec</span>urity <span class="b">Arch</span>itecture</h2>

      <h3>Security Matrix</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Deployment</th><th>Network</th><th>Filesystem</th><th>Permissions</th><th>Audit</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Local CLI</strong></td><td>Full</td><td>Full</td><td>Interactive</td><td>Manual</td></tr>
            <tr><td><strong>Remote SSH</strong></td><td>VPN-only</td><td>Restricted</td><td>Config-based</td><td>Logs</td></tr>
            <tr><td><strong>Docker</strong></td><td>Isolated/Proxy</td><td>Mount-based</td><td>Config-based</td><td>Logs</td></tr>
            <tr><td><strong>Serverless</strong></td><td>Managed</td><td>Ephemeral</td><td>Minimal</td><td>Built-in</td></tr>
            <tr><td><strong>Enterprise</strong></td><td>Zero Trust</td><td>Encrypted</td><td>SSO/RBAC</td><td>SIEM</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Permission Configuration Template</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>{
  "permissions": {
    "tools": {
      "Bash": "ask",
      "Read": "allow",
      "Edit": "allow",
      "Write": "ask",
      "WebFetch": "ask",
      "WebSearch": "ask"
    },
    "commands": {
      "git status": "allow-always",
      "git diff": "allow-always",
      "npm test": "allow-always",
      "rm -rf": "deny-always",
      "git push --force": "deny-always",
      "sudo": "deny-always"
    },
    "paths": {
      "read": ["**/*"],
      "write": ["src/**", "tests/**"],
      "deny": [".env*", "*.pem", "*.key", "node_modules/**"]
    }
  }
}</code></pre>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Decision Tree -->
    <section id="decision-tree">
      <h2><span class="b">Dec</span>ision <span class="b">Tr</span>ee</h2>

      <div class="ascii-diagram">
START: What are you building?
|
+-- Personal dev work (supervised)
|   +-- LOCAL CLI
|       +-- Add tmux for persistence
|
+-- Overnight autonomous tasks
|   +-- Can use local machine?
|   |   +-- Yes --> LOCAL + RALPH LOOP
|   +-- No --> CLOUD VM + RALPH LOOP
|
+-- Multi-agent parallel work
|   +-- Same branch conflicts likely?
|   |   +-- Yes --> GIT WORKTREES or DOCKER MULTI-CONTAINER
|   +-- No --> TMUX PARALLEL SESSIONS
|
+-- Team/production deployment
|   +-- Need code execution sandbox?
|   |   +-- Yes --> CLOUDFLARE SANDBOX or E2B
|   +-- No --> CONTAINERIZED with security controls
|
+-- Mobile-first workflow
|   +-- Have always-on home Mac?
|   |   +-- Yes --> HOME MAC + TAILSCALE
|   +-- No --> CLOUD VM + TAILSCALE
|
+-- Browser automation needed
|   +-- Production/parallel?
|   |   +-- Yes --> BROWSERBASE (cloud)
|   +-- No --> LOCAL CHROME MCP
|
+-- Enterprise deployment
    +-- HYBRID: Cloudflare Workers + VPC endpoints + SSO</div>
    </section>

    <hr class="section-divider">

    <!-- Cost Analysis -->
    <section id="cost-analysis">
      <h2><span class="b">Cost</span> <span class="b">Ana</span>lysis</h2>

      <h3>Infrastructure Costs</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Setup</th><th>Monthly Cost</th><th>Notes</th></tr>
          </thead>
          <tbody>
            <tr><td>Local only</td><td>$0</td><td>Electricity only</td></tr>
            <tr><td>Home Mac server</td><td>$0</td><td>Already owned</td></tr>
            <tr><td>Hetzner CX31</td><td>$13</td><td>Best value</td></tr>
            <tr><td>DigitalOcean</td><td>$48</td><td>Simple UX</td></tr>
            <tr><td>Vultr (always-on)</td><td>$210</td><td>US presence</td></tr>
            <tr><td>Vultr (8h/day)</td><td>$70</td><td>Stop when idle</td></tr>
            <tr><td>AWS EC2 Spot</td><td>$12-40</td><td>70-90% cheaper</td></tr>
            <tr><td>Codespaces (free tier)</td><td>$0</td><td>60 hrs/month</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Cost Optimization Strategies</h3>
      <ul>
        <li><strong>Stop VMs when idle</strong> - Use iOS Shortcuts/cron</li>
        <li><strong>Use Haiku for simple tasks</strong> - 95% cheaper than Opus</li>
        <li><strong>Prompt caching</strong> - 90% savings on repeated context</li>
        <li><strong>Batch API</strong> - 50% discount</li>
        <li><strong>Ralph file-based state</strong> - 60-80% context reduction</li>
        <li><strong>Spot instances</strong> - 70-90% cheaper than on-demand</li>
      </ul>
    </section>

    <hr class="section-divider">

    <!-- Troubleshooting -->
    <section id="troubleshooting">
      <h2><span class="b">Trou</span>bleshooting</h2>

      <details class="troubleshoot">
        <summary>SSH Session Drops During Long Operation</summary>
        <div>
          <p><strong>Symptom:</strong> Claude Code disconnects mid-task, work lost.</p>
          <p><strong>Cause:</strong> SSH connection timeout, network instability.</p>
          <p><strong>Fix:</strong></p>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code># 1. Use mosh instead of SSH for mobile connections
mosh user@server

# 2. Use tmux for session persistence
tmux new -s claude
# Reconnect: tmux attach -t claude

# 3. Configure SSH keepalive (~/.ssh/config)
Host *
    ServerAliveInterval 60
    ServerAliveCountMax 3</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Docker Container Permission Denied</summary>
        <div>
          <p><strong>Symptom:</strong> Claude Code can't write to mounted volumes.</p>
          <p><strong>Cause:</strong> UID/GID mismatch between container and host.</p>
          <p><strong>Fix:</strong></p>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code># 1. Check host user ID
id -u && id -g

# 2. Match in Dockerfile
RUN addgroup -g 1000 claude && adduser -u 1000 -G claude -D claude

# 3. Or use --user flag
docker run --user $(id -u):$(id -g) ...

# 4. Or fix permissions on host
chown -R $(id -u):$(id -g) ./project</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>API Key Not Found in Container</summary>
        <div>
          <p><strong>Symptom:</strong> "ANTHROPIC_API_KEY not set" error.</p>
          <p><strong>Cause:</strong> Environment variable not passed to container.</p>
          <p><strong>Fix:</strong></p>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code># Option 1: Pass at runtime
docker run -e ANTHROPIC_API_KEY=$ANTHROPIC_API_KEY ...

# Option 2: Use .env file with docker-compose
# .env
ANTHROPIC_API_KEY=sk-...

# docker-compose.yml
env_file: .env

# Option 3: Use Docker secrets (production)
docker secret create anthropic_key key.txt</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Push Notifications Not Arriving</summary>
        <div>
          <p><strong>Symptom:</strong> Agent finishes but no mobile notification.</p>
          <p><strong>Cause:</strong> Hook not configured, service not running, or rate limited.</p>
          <p><strong>Fix:</strong></p>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code># 1. Test notification service directly
curl -d "title=Test&message=Test&priority=5" \
  -H "Access-Token: YOUR_KEY" \
  https://api.pushover.net/1/messages.json

# 2. Check hook is configured in settings.json
cat ~/.claude/settings.json | jq '.hooks'

# 3. Verify hook script is executable
chmod +x ~/.claude/hooks/notify.sh

# 4. Test hook manually
TOOL_NAME="AskUserQuestion" ~/.claude/hooks/notify.sh</code></pre>
          </div>
        </div>
      </details>
    </section>

    <hr class="section-divider">

    <!-- Summary -->
    <section id="summary">
      <h2><span class="b">Sum</span>mary</h2>

      <h3>Deployment Selection Guide</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Scenario</th><th>Recommended Deployment</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Quick prototyping</strong></td><td>Local CLI</td></tr>
            <tr><td><strong>Single feature, overnight</strong></td><td>Local + Ralph Loop</td></tr>
            <tr><td><strong>Multiple life domains</strong></td><td>Panopticon (isolated directories)</td></tr>
            <tr><td><strong>Team parallel features</strong></td><td>Git worktrees + tmux</td></tr>
            <tr><td><strong>Production app</strong></td><td>Docker + security hardening</td></tr>
            <tr><td><strong>Serverless agents</strong></td><td>Cloudflare Workers + Sandbox</td></tr>
            <tr><td><strong>Browser automation at scale</strong></td><td>Browserbase</td></tr>
            <tr><td><strong>Mobile-first development</strong></td><td>Cloud VM + Tailscale + push notifications</td></tr>
            <tr><td><strong>Self-improving systems</strong></td><td>Infinite Orchestra (Docker 24/7)</td></tr>
            <tr><td><strong>Industrial scale</strong></td><td>Gas Town (10+ agents)</td></tr>
            <tr><td><strong>Enterprise</strong></td><td>Hybrid cloud + SSO + audit logging</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Related Pages -->
    <div class="related-pages">
      <h3>Related Pages</h3>
      <ul>
        <li><a href="compare-architecture.html">Agent Architecture Compared</a> - Single vs Subagents vs Swarm vs Hierarchical</li>
        <li><a href="compare-orchestration.html">Orchestration Approaches Compared</a> - Ralph, CC Mirror, Gas Town</li>
        <li><a href="compare-cost.html">Cost Optimization Strategies</a> - Token economics and budget management</li>
      </ul>
    </div>

    <!-- Footer Navigation -->
    <nav class="footer-nav">
      <a href="taxonomy-master.html" class="nav-prev">
        <span class="nav-direction">Previous</span>
        <span class="nav-title">Taxonomy Index</span>
      </a>
      <a href="taxonomy-enterprise-agents.html" class="nav-next">
        <span class="nav-direction">Next</span>
        <span class="nav-title">Enterprise Agents Taxonomy</span>
      </a>
    </nav>

  </div>

  <script src="../js/search.js"></script>
  <script src="../js/sidebar.js"></script>
  <script src="../js/global-nav.js"></script>
  <script>
    function copyCode(button) {
      const codeBlock = button.parentElement.querySelector('code');
      navigator.clipboard.writeText(codeBlock.textContent);
      button.textContent = 'Copied!';
      button.classList.add('copied');
      setTimeout(() => {
        button.textContent = 'Copy';
        button.classList.remove('copied');
      }, 2000);
    }
  </script>
</body>
</html>
