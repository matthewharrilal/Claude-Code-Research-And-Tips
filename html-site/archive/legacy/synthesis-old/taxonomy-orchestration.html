<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta data-pagefind-meta="section" content="Synthesis">
  <meta data-pagefind-meta="category" content="Taxonomy">
  <title>Orchestration Pattern Taxonomy - Claude Code Knowledge Base</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/sidebar.css">
  <link rel="stylesheet" href="../css/search.css">
</head>
<body>
  <!-- Search Modal -->
  <div class="search-modal" id="searchModal" aria-hidden="true">
    <div class="search-overlay" onclick="closeSearch()"></div>
    <div class="search-content">
      <div class="search-header">
        <div class="search-input-wrapper">
          <span class="search-icon-input">&#128269;</span>
          <input type="text" id="searchInput" placeholder="Search documentation..." autocomplete="off" />
          <kbd class="search-kbd">ESC</kbd>
        </div>
      </div>
      <div class="search-filters">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="synthesis">Synthesis</button>
        <button class="filter-btn" data-filter="extractions">Extractions</button>
        <button class="filter-btn" data-filter="journeys">Journeys</button>
      </div>
      <div class="search-results" id="searchResults">
        <div class="search-empty"><p>Start typing to search... (Press Cmd+K anytime)</p></div>
      </div>
      <div class="search-footer">
        <span>Up/Down Navigate</span><span>Enter Select</span><span>ESC Close</span>
      </div>
    </div>
  </div>

  <nav class="left-nav" id="leftNav">
    <div class="px-4 mb-4">
      <a href="../index.html" class="text-xs font-semibold text-accent hover:text-accent-light uppercase tracking-wider">Claude Code KB</a>
    </div>
    <div class="nav-content"></div>
  </nav>

  <button class="search-trigger" onclick="openSearch()" aria-label="Search" style="float: right; margin-bottom: 1rem;">
    <span class="search-icon">Cmd+K</span>
    <span class="search-text">Search</span>
  </button>

  <div class="wide-container">
    <!-- Breadcrumb Navigation -->
    <nav class="nav-breadcrumb">
      <a href="../index.html">Home</a>
      <span>/</span>
      <a href="synthesis-index.html">Synthesis</a>
      <span>/</span>
      <a href="taxonomy-master.html">Taxonomy</a>
      <span>/</span>
      <span>Orchestration</span>
    </nav>

    <!-- You Are Here Context Box -->
    <div class="you-are-here" style="background: linear-gradient(135deg, #f0ebe3 0%, #fefcf3 100%); border-left: 4px solid #2a7d7d; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
      <h3 style="color: #2a7d7d; margin-top: 0; font-size: 0.9em; text-transform: uppercase; letter-spacing: 0.5px;">You Are Here</h3>
      <p style="margin-bottom: 0;"><strong><span class="b">Orch</span>estration <span class="b">Patt</span>ern <span class="b">Tax</span>onomy</strong> - The exhaustive pattern catalog for agent orchestration. Covers every variation of Ralph loops, multi-agent coordination, isolation strategies, communication patterns, failure recovery, and monitoring. Use this as a reference when designing or debugging complex agent workflows.</p>
      <p style="margin-top: 0.5rem; font-size: 0.9em; color: #666;"><em>Note: This content is also covered in D-FINAL-architecture Section 2.</em></p>
    </div>

    <h1><span class="b">Orch</span>estration <span class="b">Patt</span>ern <span class="b">Tax</span>onomy</h1>

    <!-- Table of Contents -->
    <div class="toc">
      <div class="toc-title">Contents</div>
      <ul>
        <li><a href="#loop-patterns">Loop-Based Patterns</a></li>
        <li><a href="#multi-agent">Multi-Agent Patterns</a></li>
        <li><a href="#isolation">Isolation Patterns</a></li>
        <li><a href="#communication">Communication Patterns</a></li>
        <li><a href="#architecture">Architecture Patterns</a></li>
        <li><a href="#memory">Memory Patterns</a></li>
        <li><a href="#verification">Verification Patterns</a></li>
        <li><a href="#monitoring">Monitoring Patterns</a></li>
        <li><a href="#failure-recovery">Failure Recovery Patterns</a></li>
        <li><a href="#resource-management">Resource Management Patterns</a></li>
        <li><a href="#pattern-relationships">Pattern Relationships Map</a></li>
        <li><a href="#troubleshooting">Troubleshooting</a></li>
      </ul>
    </div>

    <hr class="section-divider">

    <!-- Loop-Based Patterns -->
    <section id="loop-patterns">
      <h2><span class="b">Loo</span>p-Based <span class="b">Patt</span>erns</h2>

      <h3>1.1 Ralph Wiggum (Core Pattern)</h3>
      <p><strong>Source:</strong> Geoffrey Huntley (ghuntley.com/ralph)<br>
      <strong>Popularized by:</strong> @mattpocockuk, @ryancarson</p>

      <p>A bash loop that runs Claude Code repeatedly with fresh context until a completion condition is met. Each iteration gets a clean slate but has access to git history and file-based memory.</p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>for (( i=1; i<=$MAX_ITERATIONS; i++ )); do
  claude "Review prd.json... If complete, output PROMISE COMPLETE HERE"
  if grep -q "PROMISE COMPLETE HERE" output.txt; then break; fi
done</code></pre>
      </div>

      <p><strong>Key Principles:</strong></p>
      <ul>
        <li>Fresh context per iteration (avoids "context rot")</li>
        <li>External memory via git history + progress.txt</li>
        <li>Verifiable completion (tests must pass)</li>
        <li>Small task sizing (each story completable in one context window)</li>
        <li>Hard stop condition (<code>&lt;promise&gt;COMPLETE&lt;/promise&gt;</code>)</li>
      </ul>

      <p><strong>Files Required:</strong></p>
      <ul>
        <li><code>ralph.sh</code> - The loop script</li>
        <li><code>prompt.md</code> - Instructions for each iteration</li>
        <li><code>prd.json</code> - Task list with user stories</li>
        <li><code>progress.txt</code> - Learnings and patterns</li>
      </ul>

      <h3>1.2 Ralph Variants</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Variant</th><th>Source</th><th>Key Enhancement</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Compounding Ralph</strong></td><td>@ryancarson</td><td>References archived PRDs and learnings from previous runs</td></tr>
            <tr><td><strong>Marathon Ralph</strong></td><td>@stephen_rayner</td><td>Extended for building entire apps with full SDLC</td></tr>
            <tr><td><strong>Dr. Ralph</strong></td><td>@MikeEndale</td><td>Multi-phase with confidence thresholds (80%+)</td></tr>
            <tr><td><strong>Lisa</strong></td><td>@petruarakiss</td><td>Enhanced logging and progress tracking</td></tr>
            <tr><td><strong>Zeroshot</strong></td><td>@Eivind1384955</td><td>"Next gen version" with streamlined execution</td></tr>
          </tbody>
        </table>
      </div>

      <h3>1.3 Kanban Loop Pattern</h3>
      <div class="ascii-diagram">
Pick task --> Complete task --> Back to board --> All done? --> Exit/Loop</div>
      <p><strong>Key Insight:</strong> Focus on WHAT it should do at the end, not HOW to get there.</p>

      <!-- Checkpoint -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint: Loop-Based Patterns</div>
        <p><strong>You should now understand:</strong></p>
        <ul>
          <li>The core Ralph Wiggum pattern and its 6 variants</li>
          <li>The key files: ralph.sh, prompt.md, prd.json, progress.txt</li>
          <li>Fresh context per iteration principle</li>
          <li>The Kanban loop mental model</li>
        </ul>
        <p><strong>If unclear:</strong> See <code>mastery-ralph-complete.md</code> for comprehensive Ralph coverage</p>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code># Test Ralph loop is set up correctly
cat plans/prd.json | jq '.userStories[] | select(.passes == false) | .id'
# You should see: list of incomplete story IDs</code></pre>
        </div>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Multi-Agent Patterns -->
    <section id="multi-agent">
      <h2><span class="b">Multi</span>-Agent <span class="b">Patt</span>erns</h2>

      <h3>2.1 Personal Panopticon</h3>
      <p><strong>Source:</strong> @mollycantillon</p>
      <p>Run 8+ parallel isolated Claude Code instances, each owning a life/work domain, to achieve "self-legibility" across all personal data.</p>

      <div class="ascii-diagram">
~/nox        # Company/product
~/metrics    # Analytics/data
~/email      # Communications
~/growth     # Marketing/acquisition
~/trades     # Personal finance/trading
~/health     # Fitness/sleep/wellness
~/writing    # Content creation
~/personal   # Life admin</div>

      <p><strong>Key Features:</strong></p>
      <ul>
        <li><strong>Isolation:</strong> Each instance operates independently, no cross-contamination</li>
        <li><strong>Subagents:</strong> Spawn short-lived agents for specific tasks</li>
        <li><strong>Handoffs:</strong> Exchange context through explicit file-based handoffs</li>
        <li><strong>Filesystem as Memory:</strong> Read/write to their directory as persistent memory</li>
        <li><strong>GUI fallback:</strong> Inject mouse/keystroke events for desktop app control</li>
      </ul>

      <h3>2.2 CC Mirror (Hub-and-Spoke Orchestration)</h3>
      <p><strong>Source:</strong> @nummanali | <strong>Repo:</strong> github.com/numman-ali/cc-mirror</p>
      <p>Central orchestrator that delegates to specialized worker agents, never touching code directly.</p>

      <div class="callout callout-warning">
        <div class="callout-title">The Iron Law</div>
        <p><strong>YOU DO NOT WRITE CODE. YOU DO NOT RUN COMMANDS. YOU DO NOT EXPLORE CODEBASES.</strong></p>
        <p>You are the CONDUCTOR. Your agents play the instruments.</p>
      </div>

      <h4>Tool Ownership</h4>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Role</th><th>Tools</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Orchestrator</strong></td><td>Read (1-2 files), Task*, AskUserQuestion</td></tr>
            <tr><td><strong>Workers</strong></td><td>Read, Write, Edit, Bash, Glob, Grep, WebFetch, LSP</td></tr>
          </tbody>
        </table>
      </div>

      <h4>Task Management</h4>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>TaskCreate  --> Create with subject, description, acceptance criteria
TaskList    --> Filter by status, owner, blocked state
TaskGet     --> Full context with dependencies
TaskUpdate  --> Claim ownership, add comments, resolve, link

# Dependency Features:
addBlocks   - This task blocks another
addBlockedBy - This task is blocked by another</code></pre>
      </div>

      <h3>2.3 Gas Town (Agent Factory)</h3>
      <p><strong>Source:</strong> @steve_yegge | <strong>Repo:</strong> github.com/steveyegge/gastown</p>
      <p>Not just agents, but an <strong>agent factory</strong> with specialized roles and town-level coordination.</p>

      <div class="ascii-diagram">
Gas Town (~/.gt)
+-- HQ (town-level management)
+-- Rigs (project repos)
|   +-- Witness (per-rig observer)
+-- Workers
|   +-- Mayor (town coordination)
|   +-- Deacon (monitoring/handshakes)
|   +-- Dogs (quality gates)
|   +-- Refinery (task decomposition)
|   +-- Polecat (named persistent workers)
|   +-- Crew (ephemeral workers)
+-- Overseer (YOU - human with inbox)</div>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Role</th><th>Purpose</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Mayor</strong></td><td>Town-wide coordination</td></tr>
            <tr><td><strong>Deacon</strong></td><td>Monitoring and handshakes between agents</td></tr>
            <tr><td><strong>Dogs</strong></td><td>Quality gates and watchdogs</td></tr>
            <tr><td><strong>Refinery</strong></td><td>Task decomposition</td></tr>
            <tr><td><strong>Polecat</strong></td><td>Named persistent workers</td></tr>
            <tr><td><strong>Crew</strong></td><td>Ephemeral workers</td></tr>
            <tr><td><strong>Witness</strong></td><td>Per-rig observer</td></tr>
          </tbody>
        </table>
      </div>

      <blockquote>
        <p>"You just make up features, design them, file the implementation plans, and sling work around to your polecats and crew."</p>
        <cite>-- Steve Yegge</cite>
      </blockquote>

      <h3>2.4 Infinite Orchestra</h3>
      <p><strong>Source:</strong> @0xSero | <strong>Repo:</strong> github.com/0xSero/orchestra</p>
      <p>Self-improving orchestrator running 24/7 in Docker with specialized worker profiles.</p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>{
  "profiles": [
    { "id": "vision", "purpose": "Visual analysis" },
    { "id": "docs", "purpose": "Documentation research" },
    { "id": "research", "purpose": "Deep investigation" },
    { "id": "coder", "purpose": "Implementation" },
    { "id": "memory", "purpose": "Context persistence" },
    { "id": "architect", "purpose": "System design" }
  ]
}</code></pre>
      </div>

      <h3>2.5 Additional Multi-Agent Patterns</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Pattern</th><th>Description</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Parallel Task Executor</strong></td><td>Parse plan file, extract tasks, execute in parallel using subagents</td></tr>
            <tr><td><strong>AI-Maestro</strong></td><td>Container-isolated parallelism with shared Docker volumes</td></tr>
            <tr><td><strong>Adversarial Speccing</strong></td><td>Architect proposes, Critic challenges (DHH, security, perf personas)</td></tr>
            <tr><td><strong>AutoGen-Style Group Chat</strong></td><td>Multiple agents share conversation, round-robin or topic-based</td></tr>
            <tr><td><strong>CrewAI-Style Roles</strong></td><td>Agents with explicit roles, goals, and backstories</td></tr>
            <tr><td><strong>LangGraph State Machine</strong></td><td>Model workflows as state machines with explicit transitions</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Isolation Patterns -->
    <section id="isolation">
      <h2><span class="b">Iso</span>lation <span class="b">Patt</span>erns</h2>

      <h3>3.1 Domain-Isolated Parallel Instances</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Terminal 1
cd ~/project/frontend && claude

# Terminal 2
cd ~/project/backend && claude

# Terminal 3
cd ~/project/docs && claude</code></pre>
      </div>
      <p><strong>Key Insight:</strong> Filesystem isolation prevents context pollution between agents.</p>

      <h3>3.2 Branch-Based Parallel Work</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>git checkout -b feature-auth
claude "Implement authentication"

# In another terminal
git checkout -b feature-payments
claude "Implement payment processing"</code></pre>
      </div>
      <p><strong>Merge Strategy:</strong> Human reviews and resolves conflicts during PR.</p>

      <h3>3.3 Git Worktree Isolation</h3>
      <div class="ascii-diagram">
Main repo: ~/project/
  +-- .git/           # Shared git database
  +-- src/            # Main working directory

Worktrees: ~/project-worktrees/
  +-- feature-a/      # Agent 1's isolated directory
  +-- feature-b/      # Agent 2's isolated directory
  +-- bugfix-c/       # Agent 3's isolated directory</div>

      <p><strong>Lifecycle Management:</strong></p>
      <ul>
        <li>Creation with automatic cleanup tracking</li>
        <li>Stale worktree detection (24+ hours old)</li>
        <li>Atomic merge back to main</li>
        <li>Shared symlinks for common configuration</li>
      </ul>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Worktree + Ralph Combination
for feature in auth payments notifications; do
  git worktree add ../wt-$feature $feature-branch
  (cd ../wt-$feature && ./ralph.sh 20) &
done
wait</code></pre>
      </div>

      <h3>3.4 Directory Ownership Pattern</h3>
      <div class="ascii-diagram">
agent-frontend/ --> Only frontend agent touches
agent-backend/  --> Only backend agent touches
shared/         --> Read-only for all, write via handoff protocol</div>
    </section>

    <hr class="section-divider">

    <!-- Communication Patterns -->
    <section id="communication">
      <h2><span class="b">Comm</span>unication <span class="b">Patt</span>erns</h2>

      <h3>4.1 File-Based Handoffs</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>// handoff-agent1-to-agent2.json
{
  "from": "agent1",
  "to": "agent2",
  "timestamp": "2026-01-09T10:30:00Z",
  "context": {
    "completed": ["API schema", "Database models"],
    "next_steps": ["Implement REST endpoints"],
    "blockers": [],
    "notes": "Using FastAPI, see docs in /api/README.md"
  }
}</code></pre>
      </div>

      <h3>4.2 Git-Based Handoffs</h3>
      <ul>
        <li><strong>progress.txt</strong> - Append-only learnings log</li>
        <li><strong>prd.json</strong> - Task status with passes: true/false</li>
        <li><strong>Git commits</strong> - Each iteration commits, future agents see history</li>
      </ul>

      <h3>4.3 Docker Volume Handoffs</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>Agent 1 writes --> /shared/agent1-output.json
Agent 2 reads  <-- /shared/agent1-output.json</code></pre>
      </div>
      <p>Lightweight, no external dependencies, not real-time.</p>

      <h3>4.4 MCP Agent Mail</h3>
      <p><strong>Source:</strong> Steve Yegge's Gas Town | <strong>Repo:</strong> github.com/Dicklesworthstone/mcp_agent_mail</p>
      <ul>
        <li>Agents collaborate via email-like interfaces</li>
        <li>No training needed</li>
        <li>Natural "agent village" behavior</li>
        <li>Async by default</li>
      </ul>

      <h3>4.5 Additional Communication Patterns</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Pattern</th><th>Mechanism</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Message Queue (FIFO Pipes)</strong></td><td>Lightweight message passing using FIFO pipes for real-time coordination</td></tr>
            <tr><td><strong>Event-Driven Architecture</strong></td><td>File-based event bus with agents watching for specific event types</td></tr>
            <tr><td><strong>Consensus Protocol</strong></td><td>Multiple agents must agree (>66%) before proceeding</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Architecture Patterns -->
    <section id="architecture">
      <h2><span class="b">Arch</span>itecture <span class="b">Patt</span>erns</h2>

      <h3>5.1 Hub-and-Spoke</h3>
      <div class="ascii-diagram">
         +------------------+
         |   Orchestrator   |
         +--------+---------+
                  |
    +-------------+-------------+
    |             |             |
    v             v             v
+-------+   +-------+   +-------+
| Coder |   | Tester|   |  Docs |
+-------+   +-------+   +-------+</div>
      <p><strong>Best For:</strong> Clear task decomposition, predictable workflow, centralized monitoring</p>
      <p><strong>Examples:</strong> CC Mirror, Gas Town (Deacon role)</p>

      <h3>5.2 Peer-to-Peer</h3>
      <div class="ascii-diagram">
+-------+     +-------+
|Agent 1|<--->|Agent 2|
+-------+     +-------+
    ^             ^
    +------+------+
           v
      +-------+
      |Agent 3|
      +-------+</div>
      <p><strong>Best For:</strong> Emergent collaboration, flexible workflows, resilience</p>
      <p><strong>Challenges:</strong> Harder to monitor, potential for deadlocks</p>

      <h3>5.3 Factory Pattern (Gas Town)</h3>
      <ul>
        <li>Named persistent workers (Polecats)</li>
        <li>Ephemeral workers (Crew)</li>
        <li>Role-based specialization</li>
        <li>Town-level coordination</li>
      </ul>
    </section>

    <hr class="section-divider">

    <!-- Memory Patterns -->
    <section id="memory">
      <h2><span class="b">Mem</span>ory <span class="b">Patt</span>erns</h2>

      <h3>6.1 Hierarchical Memory Architecture</h3>
      <div class="ascii-diagram">
Layer 1: Enterprise Policy
  /Library/Application Support/ClaudeCode/CLAUDE.md
  Organization-wide security policies, compliance

Layer 2: Project Memory
  ./CLAUDE.md or ./.claude/CLAUDE.md
  Architecture decisions, coding standards, team workflows

Layer 3: Modular Rules
  ./.claude/rules/*.md
  Path-specific rules with frontmatter targeting

Layer 4: Personal + Local
  ~/.claude/CLAUDE.md (user global)
  ./CLAUDE.local.md (project local, gitignored)
  Agent-specific context, sandbox URLs, credentials</div>

      <h3>6.2 Dynamic Memory with File Imports</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>## Standard References
@docs/architecture.md
@docs/api-conventions.md

## Multi-Agent Context (dynamic)
@.agent-status/current-assignments.md
@.agent-status/blocked-files.md
@.agent-status/handoff-queue.md</code></pre>
      </div>

      <h3>6.3 Artifact-Based Persistence</h3>
      <ul>
        <li><strong>progress.txt</strong> - Session memory for Ralph iterations</li>
        <li><strong>AGENTS.md</strong> - Permanent docs for humans and future agents</li>
        <li><strong>Git history</strong> - Long-term state</li>
        <li><strong>prd.json</strong> - Current task state</li>
      </ul>
    </section>

    <hr class="section-divider">

    <!-- Verification Patterns -->
    <section id="verification">
      <h2><span class="b">Veri</span>fication <span class="b">Patt</span>erns</h2>

      <h3>7.1 CI Green Enforcement</h3>
      <p>Tests + types must pass every commit. No broken code inheritance.</p>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Requirements
1. Type checking: npm run typecheck
2. Unit tests: npm test
3. Lint: npm run lint
4. CI green on every commit</code></pre>
      </div>

      <h3>7.2 Browser Automation Verification</h3>
      <p>Use Playwright MCP for UI verification. Not complete until verified with screenshot.</p>

      <h3>7.3 Multi-Phase Verification Protocol</h3>
      <p>80%+ confidence threshold before advancing phases (Dr. Ralph pattern).</p>

      <h3>7.4 Cross-Agent Verification</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Level</th><th>Checks</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Per-agent</strong></td><td>Type check, unit tests, lint, self-review</td></tr>
            <tr><td><strong>Cross-agent</strong></td><td>Integration tests after merge</td></tr>
            <tr><td><strong>Human checkpoints</strong></td><td>DB migrations, API breaking changes, security-sensitive code</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Monitoring Patterns -->
    <section id="monitoring">
      <h2><span class="b">Mon</span>itoring <span class="b">Patt</span>erns</h2>

      <h3>8.1 Claude HUD Plugin</h3>
      <p><strong>Source:</strong> @jarrodwatts | <strong>Repo:</strong> github.com/jarrodwatts/claude-hud</p>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>[Opus 4.5] ████████░░ 35% | 1 MCPs | ⏳ 1m
✓ Read x2 | ✓ WebFetch x1 | ✓ Skill x1 | ✓ Edit x1</code></pre>
      </div>
      <p><strong>Features:</strong> Context remaining (color-coded), tool execution, subagent status, to-do progress</p>

      <h3>8.2 rpai - tmux Multi-Agent Manager</h3>
      <p><strong>Install:</strong> <code>cargo install rpai && rpai</code></p>
      <ul>
        <li>Scans tmux panes for running AI agents</li>
        <li>TUI with agent list, status, output previews</li>
        <li>Jump to any agent with selection</li>
        <li>Monitor all agents from one view</li>
      </ul>

      <h3>8.3 Agent Health Metrics</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Metric</th><th>Description</th></tr>
          </thead>
          <tbody>
            <tr><td>Heartbeat timestamp</td><td>Last activity time</td></tr>
            <tr><td>Status</td><td>running/stopped</td></tr>
            <tr><td>Context usage</td><td>Percentage of window used</td></tr>
            <tr><td>Tokens consumed</td><td>Total tokens this session</td></tr>
            <tr><td>Tasks completed</td><td>Count of finished tasks</td></tr>
            <tr><td>Error count</td><td>Failures this session</td></tr>
            <tr><td>Git branch</td><td>Current working branch</td></tr>
          </tbody>
        </table>
      </div>

      <h3>8.4 Anomaly Detection</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Type</th><th>Indicators</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Resource</strong></td><td>Context >90% without completion, 3x normal token consumption</td></tr>
            <tr><td><strong>Behavioral</strong></td><td>Circular edits, increasing test failures, excessive subagents</td></tr>
            <tr><td><strong>Coordination</strong></td><td>Deadlocks, conflicting edits, unconsumed handoffs</td></tr>
          </tbody>
        </table>
      </div>
      <p><strong>Response Actions:</strong> Alert --> Throttle --> Checkpoint --> Terminate --> Escalate</p>
    </section>

    <hr class="section-divider">

    <!-- Failure Recovery Patterns -->
    <section id="failure-recovery">
      <h2><span class="b">Fail</span>ure <span class="b">Rec</span>overy Patterns</h2>

      <h3>9.1 Checkpointing</h3>
      <p>Periodic save of agent state for recovery.</p>
      <ul>
        <li><strong>Git state:</strong> stash ref, commit ref, staged/unstaged diffs</li>
        <li><strong>Agent state:</strong> progress.txt, prd.json, status</li>
        <li><strong>Auto-checkpoint:</strong> Every N iterations</li>
      </ul>

      <h3>9.2 Graceful Degradation</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Level</th><th>Trigger</th><th>Action</th></tr>
          </thead>
          <tbody>
            <tr><td>1</td><td>Transient errors, rate limiting</td><td>Retry with Backoff</td></tr>
            <tr><td>2</td><td>Model failure</td><td>Fallback Model (Opus --> Sonnet --> Haiku)</td></tr>
            <tr><td>3</td><td>Context corruption, invalid state</td><td>Requeue Task</td></tr>
            <tr><td>4</td><td>Repeated failures, conflicts</td><td>Human Escalation</td></tr>
            <tr><td>5</td><td>Quota exhausted, infrastructure failure</td><td>Safe Shutdown</td></tr>
          </tbody>
        </table>
      </div>

      <h3>9.3 Dead Letter Queue</h3>
      <p>Tasks that repeatedly fail (3+ times) move to dead letter queue for human review.</p>

      <h3>9.4 Circuit Breaker</h3>
      <ul>
        <li><strong>CLOSED:</strong> Normal operation</li>
        <li><strong>OPEN:</strong> Failing fast (after N failures)</li>
        <li><strong>HALF_OPEN:</strong> Testing recovery (after timeout)</li>
      </ul>

      <h3>9.5 Semantic Merge for Conflicts</h3>
      <p>Use Claude to resolve merge conflicts by understanding intent of both changes.</p>

      <h3>9.6 Optimistic Locking</h3>
      <p>Record expected file version before editing, check validity before commit.</p>
    </section>

    <hr class="section-divider">

    <!-- Resource Management Patterns -->
    <section id="resource-management">
      <h2><span class="b">Res</span>ource <span class="b">Man</span>agement Patterns</h2>

      <h3>10.1 Model Selection Optimization</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Task Characteristic</th><th>Recommended Model</th></tr>
          </thead>
          <tbody>
            <tr><td>File lookup, simple grep</td><td>Haiku</td></tr>
            <tr><td>Code generation with patterns</td><td>Sonnet</td></tr>
            <tr><td>Architecture decisions</td><td>Opus</td></tr>
            <tr><td>Test generation</td><td>Sonnet</td></tr>
            <tr><td>Security review</td><td>Opus</td></tr>
            <tr><td>Documentation</td><td>Haiku/Sonnet</td></tr>
            <tr><td>Debugging complex issues</td><td>Opus</td></tr>
          </tbody>
        </table>
      </div>

      <h3>10.2 Task Queue with Priority</h3>
      <div class="ascii-diagram">
Queue directories:
+-- pending/      # Waiting tasks (priority-sorted)
+-- in-progress/  # Claimed by agents
+-- completed/    # Finished tasks
+-- failed/       # Error tasks</div>

      <h3>10.3 Dynamic Agent Scaling</h3>
      <ul>
        <li>Scale up when queue depth > threshold</li>
        <li>Scale down when queue depth < threshold</li>
        <li>Maintain min/max agent limits</li>
      </ul>

      <h3>10.4 Resource-Aware Scheduling</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Profile</th><th>Model</th><th>Max Tokens</th><th>Concurrent</th><th>Use Case</th></tr>
          </thead>
          <tbody>
            <tr><td>Light</td><td>Haiku</td><td>4K</td><td>10</td><td>Lookups, simple transforms</td></tr>
            <tr><td>Medium</td><td>Sonnet</td><td>16K</td><td>5</td><td>Implementation, testing</td></tr>
            <tr><td>Heavy</td><td>Opus</td><td>32K+</td><td>2</td><td>Architecture, complex reasoning</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Pattern Relationships Map -->
    <section id="pattern-relationships">
      <h2><span class="b">Patt</span>ern <span class="b">Rel</span>ationships Map</h2>

      <div class="ascii-diagram">
                    +-----------------------------+
                    |        BASE PATTERNS        |
                    +-----------------------------+
                              |
        +---------------------+---------------------+
        |                     |                     |
        v                     v                     v
+---------------+   +-------------------+   +-----------------+
|  RALPH LOOP   |   |  MULTI-AGENT      |   |  ISOLATION      |
|  (Single)     |   |  (Parallel)       |   |  PATTERNS       |
+-------+-------+   +---------+---------+   +--------+--------+
        |                     |                      |
        |    +----------------+----------------+     |
        |    |                |                |     |
        v    v                v                v     v
+-----------------+  +-------------+  +-----------------+
| Compounding     |  | CC Mirror   |  | Git Worktrees   |
| Ralph           |  | Hub-Spoke   |  |                 |
+--------+--------+  +------+------+  +--------+--------+
         |                  |                   |
         |                  v                   |
         |         +-----------------+          |
         |         |    Gas Town     |          |
         |         |    (Factory)    |          |
         |         +--------+--------+          |
         |                  |                   |
         +------------------+-------------------+
                            |
                            v
            +-----------------------------+
            |    SUPPORT PATTERNS         |
            +-----------------------------+
            | - Communication (Handoffs)  |
            | - Memory (Hierarchical)     |
            | - Verification (CI Green)   |
            | - Monitoring (HUD, Tracing) |
            | - Recovery (Checkpoint)     |
            | - Resources (Scaling)       |
            +-----------------------------+</div>

      <h3>Builds-On Relationships</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Pattern</th><th>Builds On</th></tr>
          </thead>
          <tbody>
            <tr><td>Compounding Ralph</td><td>Ralph Wiggum Core</td></tr>
            <tr><td>Marathon Ralph</td><td>Ralph Wiggum Core</td></tr>
            <tr><td>CC Mirror</td><td>Hub-and-Spoke Architecture</td></tr>
            <tr><td>Gas Town</td><td>CC Mirror + Factory Pattern</td></tr>
            <tr><td>AI-Maestro</td><td>Container Isolation + Parallelism</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Combines-Well-With</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Pattern A</th><th>Pattern B</th><th>Synergy</th></tr>
          </thead>
          <tbody>
            <tr><td>Ralph</td><td>Git Worktrees</td><td>Parallel feature development</td></tr>
            <tr><td>CC Mirror</td><td>Adversarial Speccing</td><td>Quality architecture</td></tr>
            <tr><td>Any Multi-Agent</td><td>Distributed Tracing</td><td>Observability</td></tr>
            <tr><td>Any Loop</td><td>Checkpointing</td><td>Reliability</td></tr>
            <tr><td>Any Pattern</td><td>CI Green Enforcement</td><td>Quality gates</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Task Sizing -->
    <section id="task-sizing">
      <h2><span class="b">Task</span> <span class="b">Siz</span>ing Guidelines</h2>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Size</th><th>Characteristics</th><th>Example</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Too Small</strong></td><td>Overhead exceeds value</td><td>"Add a comment to line 42"</td></tr>
            <tr><td><strong>Just Right</strong></td><td>One context window, verifiable</td><td>"Implement User model with these fields"</td></tr>
            <tr><td><strong>Too Large</strong></td><td>Context collapse risk</td><td>"Build the entire backend"</td></tr>
          </tbody>
        </table>
      </div>

      <p><strong>Sweet Spot:</strong></p>
      <ul>
        <li>~100-500 lines of code change</li>
        <li>~1-3 files modified</li>
        <li>~30-60 minutes equivalent human time</li>
        <li>Clear success criteria</li>
      </ul>
    </section>

    <hr class="section-divider">

    <!-- Troubleshooting -->
    <section id="troubleshooting">
      <h2><span class="b">Trou</span>bleshooting</h2>

      <details class="troubleshoot">
        <summary>Ralph Loop Never Completes</summary>
        <div>
          <p><strong>Symptom:</strong> Loop runs to max iterations without outputting "PROMISE COMPLETE"</p>
          <p><strong>Cause:</strong> Tasks too large, missing completion condition, or stuck on failing tests</p>
          <p><strong>Fix:</strong></p>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code># 1. Check PRD status
cat plans/prd.json | jq '.userStories[] | select(.passes == false) | {id, title}'

# 2. Check progress.txt for blockers
tail -50 plans/progress.txt

# 3. Verify tests actually pass
npm run typecheck && npm test

# 4. Check task size - split if too large
# Good: "Add login endpoint"
# Bad: "Build entire auth system"</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Orchestrator Context Exhaustion</summary>
        <div>
          <p><strong>Symptom:</strong> CC Mirror orchestrator loses track of tasks, quality degrades</p>
          <p><strong>Cause:</strong> Orchestrator doing too much, not delegating properly</p>
          <p><strong>Fix:</strong></p>
          <ol>
            <li>Ensure auto-compact is enabled for CC Mirror</li>
            <li>Orchestrator should only use: Read (1-2 files), Task*, AskUserQuestion</li>
            <li>Never have orchestrator write code or run commands</li>
            <li>Delegate all implementation to worker subagents</li>
          </ol>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Git Worktree Conflicts</summary>
        <div>
          <p><strong>Symptom:</strong> Cannot create worktree, or worktrees have stale branches</p>
          <p><strong>Cause:</strong> Branch already checked out, or worktree cleanup incomplete</p>
          <p><strong>Fix:</strong></p>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code># 1. List existing worktrees
git worktree list

# 2. Remove stale worktrees
git worktree prune

# 3. Remove specific worktree
git worktree remove ../wt-feature-name

# 4. If branch is checked out elsewhere, create new branch
git worktree add ../wt-new-name -b new-branch-name</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Handoff Files Not Being Read</summary>
        <div>
          <p><strong>Symptom:</strong> Agent doesn't see context from other agents</p>
          <p><strong>Cause:</strong> Wrong file path, timing issue, or file format error</p>
          <p><strong>Fix:</strong></p>
          <ol>
            <li>Verify handoff file location: <code>ls ~/shared/handoff-*.json</code></li>
            <li>Check file contains valid JSON: <code>cat handoff.json | jq .</code></li>
            <li>Add explicit read instruction in prompt: "Read ~/shared/handoff-agent1-to-agent2.json first"</li>
            <li>Consider file watching or polling for async handoffs</li>
          </ol>
        </div>
      </details>
    </section>

    <hr class="section-divider">

    <!-- Quick Reference Commands -->
    <section id="quick-reference">
      <h2><span class="b">Quick</span> <span class="b">Ref</span>erence</h2>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Ralph Loop
./ralph.sh 25

# Git Worktree
git worktree add ../feature-branch feature-branch

# CC Mirror
npx cc-mirror quick --provider mirror --name mclaude

# Claude HUD
/plugin install claude-hud

# rpai (tmux manager)
cargo install rpai && rpai

# Gas Town
go install github.com/steveyegge/gastown/cmd/gt@latest</code></pre>
      </div>

      <h3>Pattern Selection Guide</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Scenario</th><th>Recommended Pattern</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Single feature, overnight</strong></td><td>Ralph Loop</td></tr>
            <tr><td><strong>Multiple life domains</strong></td><td>Panopticon (isolated directories)</td></tr>
            <tr><td><strong>Team project, parallel features</strong></td><td>Git worktrees + branch discipline</td></tr>
            <tr><td><strong>Complex architecture work</strong></td><td>Hub-and-spoke with specialized workers</td></tr>
            <tr><td><strong>Production app with dependencies</strong></td><td>CC Mirror native orchestration</td></tr>
            <tr><td><strong>Massive scale (10+ agents)</strong></td><td>Gas Town factory</td></tr>
            <tr><td><strong>Self-improving system</strong></td><td>Infinite Orchestra</td></tr>
            <tr><td><strong>High-stakes decisions</strong></td><td>Adversarial Speccing</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Related Pages -->
    <div class="related-pages">
      <h3>Related Pages</h3>
      <ul>
        <li><a href="taxonomy-deployment.html">Deployment Architecture Taxonomy</a> - Infrastructure patterns for running Claude Code</li>
        <li><a href="taxonomy-enterprise-agents.html">Enterprise Agent Taxonomy</a> - 329+ pre-built agents across three ecosystems</li>
        <li><a href="compare-orchestration.html">Orchestration Approaches Compared</a> - Ralph vs CC Mirror vs Gas Town</li>
        <li><a href="compare-architecture.html">Agent Architecture Compared</a> - Single vs Subagents vs Swarm vs Hierarchical</li>
      </ul>
    </div>

    <!-- Footer Navigation -->
    <nav class="footer-nav">
      <a href="taxonomy-enterprise-agents.html" class="nav-prev">
        <span class="nav-direction">Previous</span>
        <span class="nav-title">Enterprise Agents</span>
      </a>
      <a href="compare-orchestration.html" class="nav-next">
        <span class="nav-direction">Next</span>
        <span class="nav-title">Orchestration Compared</span>
      </a>
    </nav>

  </div>

  <script src="../js/search.js"></script>
  <script src="../js/sidebar.js"></script>
  <script src="../js/global-nav.js"></script>
  <script>
    function copyCode(button) {
      const codeBlock = button.parentElement.querySelector('code');
      navigator.clipboard.writeText(codeBlock.textContent);
      button.textContent = 'Copied!';
      button.classList.add('copied');
      setTimeout(() => {
        button.textContent = 'Copy';
        button.classList.remove('copied');
      }, 2000);
    }
  </script>
</body>
</html>
