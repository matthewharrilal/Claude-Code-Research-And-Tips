<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta data-pagefind-meta="section" content="Synthesis">
  <meta data-pagefind-meta="category" content="Infrastructure">
  <title>Infrastructure Stack Blueprint - Claude Code Knowledge Base</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/sidebar.css">
  <link rel="stylesheet" href="../css/search.css">
</head>
<body>
  <!-- Search Modal -->
  <div class="search-modal" id="searchModal" aria-hidden="true">
    <div class="search-overlay" onclick="closeSearch()"></div>
    <div class="search-content">
      <div class="search-header">
        <div class="search-input-wrapper">
          <span class="search-icon-input">&#128269;</span>
          <input type="text" id="searchInput" placeholder="Search documentation..." autocomplete="off" />
          <kbd class="search-kbd">ESC</kbd>
        </div>
      </div>
      <div class="search-filters">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="synthesis">Synthesis</button>
        <button class="filter-btn" data-filter="extractions">Extractions</button>
      </div>
      <div class="search-results" id="searchResults">
        <div class="search-empty"><p>Start typing to search... (Press Cmd+K anytime)</p></div>
      </div>
      <div class="search-footer">
        <span>Up/Down Navigate</span><span>Enter Select</span><span>ESC Close</span>
      </div>
    </div>
  </div>

  <button class="search-trigger" onclick="openSearch()" aria-label="Search" style="float: right; margin-bottom: 1rem;">
    <span class="search-icon">Cmd+K</span>
    <span class="search-text">Search</span>
  </button>

  <div class="wide-container">
    <!-- Breadcrumb Navigation -->
    <nav class="nav-breadcrumb">
      <a href="../index.html">Home</a>
      <span>/</span>
      <a href="synthesis-index.html">Synthesis</a>
      <span>/</span>
      <span>Infrastructure</span>
      <span>/</span>
      <span>Stack Blueprint</span>
    </nav>

    <!-- You Are Here Context Box -->
    <div class="you-are-here" style="background: linear-gradient(135deg, #f0ebe3 0%, #fefcf3 100%); border-left: 4px solid #2a7d7d; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
      <h3 style="color: #2a7d7d; margin-top: 0; font-size: 0.9em; text-transform: uppercase; letter-spacing: 0.5px;">You Are Here</h3>
      <p style="margin-bottom: 0;">This is your <strong><span style="font-weight: 700;">com</span>plete blueprint</strong> for deploying AI agent systems from local development to production infrastructure. It synthesizes Roughneck (Terraform/Ansible), Station (NATS messaging), Agentic-Flow (production platform), and Kimaki (Discord interface) into one coherent deployment path.</p>
    </div>

    <h1><span style="font-weight: 700;">Inf</span>rastructure Stack Blueprint</h1>

    <p class="conversational-lead">
      <span style="font-weight: 700;">The</span> complete path from zero to production-grade agent orchestration. This document covers cloud provisioning, messaging backbone, production deployment, and user interface layers.
    </p>

    <!-- Table of Contents -->
    <div class="toc">
      <div class="toc-title">Contents</div>
      <ul>
        <li><a href="#architecture-overview">Architecture Overview</a> - The complete stack</li>
        <li><a href="#roughneck">Roughneck Provisioning</a> - Terraform + Ansible</li>
        <li><a href="#pricing">Multi-Cloud Pricing</a> - Cost comparison</li>
        <li><a href="#station-nats">Station NATS Backbone</a> - Messaging infrastructure</li>
        <li><a href="#agentic-flow">Agentic-Flow Platform</a> - Production deployment</li>
        <li><a href="#production-checklist">Production Checklist</a> - Go-live verification</li>
        <li><a href="#troubleshooting">Troubleshooting</a> - Common issues</li>
      </ul>
    </div>

    <hr class="section-divider divider-procedure">

    <!-- Architecture Overview Section -->
    <section id="architecture-overview">
      <h2><span style="font-weight: 700;">Arc</span>hitecture Overview</h2>

      <div class="ascii-diagram">
LAYER 5: USER INTERFACES
+---------------------------------------------------------------+
|  Kimaki (Discord) | Web UIs | Terminal CLI | Mobile Apps      |
+---------------------------------------------------------------+
                                |
LAYER 4: ORCHESTRATION PLATFORM
+---------------------------------------------------------------+
|  Gas Town (Mayor, Dogs, Refinery) | Agentic-Flow Swarms       |
+---------------------------------------------------------------+
                                |
LAYER 3: MESSAGING BACKBONE
+---------------------------------------------------------------+
|  Station NATS | JetStream Persistence | Lattice Mesh Network  |
+---------------------------------------------------------------+
                                |
LAYER 2: COMPUTE INFRASTRUCTURE  <====== THIS DOCUMENT FOCUSES HERE
+---------------------------------------------------------------+
|  Roughneck + Agentic-Flow Deployment                          |
|  Terraform | Ansible | Docker | Kubernetes                    |
+---------------------------------------------------------------+
                                |
LAYER 1: CLOUD PROVIDERS
+---------------------------------------------------------------+
|  Hetzner (~$4-8/mo) | DigitalOcean (~$24/mo) | AWS (~$30/mo)  |
+---------------------------------------------------------------+
      </div>

      <h3>Who This Is For</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Your Situation</th><th>What You'll Gain</th></tr>
        </thead>
        <tbody>
          <tr><td>Building Gas Town factory</td><td>IaC provisioning + multi-region deployment</td></tr>
          <tr><td>Running Ralph loops</td><td>Production containerization + persistence</td></tr>
          <tr><td>Need multi-machine agents</td><td>NATS mesh network + service discovery</td></tr>
          <tr><td>Want team collaboration</td><td>Discord interface + shared state</td></tr>
        </tbody>
      </table>
    </section>

    <hr class="section-divider divider-procedure">

    <!-- Roughneck Section -->
    <section id="roughneck">
      <h2><span style="font-weight: 700;">Rou</span>ghneck Terraform + Ansible Provisioning</h2>

      <p><strong>Roughneck</strong> is infrastructure-as-code that provisions cloud VMs preconfigured with Gas Town, Beads, and AI coding assistants. Think of it as the construction company that builds the factory.</p>

      <h3>CLI Commands Reference</h3>
      <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; position: relative; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
        <button class="copy-btn" onclick="copyCode(this)" style="position: absolute; top: 0.5rem; right: 0.5rem; background: #2a7d7d; color: white; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer;">Copy</button>
        <pre style="margin: 0; overflow-x: auto;"><code># Deployment lifecycle
./roughneck new [name]          # Create new deployment (interactive)
./roughneck deploy [name]       # Deploy existing configuration
./roughneck destroy [name]      # Tear down infrastructure
./roughneck list                # Show all deployments

# Management
./roughneck provision [name]    # Re-run Ansible (no Terraform)
./roughneck update [name]       # Update packages/tools
./roughneck validate [name]     # Run health checks
./roughneck ssh [name]          # SSH into deployment</code></pre>
      </div>

      <h3>Configuration File (terraform.tfvars)</h3>
      <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; position: relative; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
        <button class="copy-btn" onclick="copyCode(this)" style="position: absolute; top: 0.5rem; right: 0.5rem; background: #2a7d7d; color: white; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer;">Copy</button>
        <pre style="margin: 0; overflow-x: auto;"><code># deployments/&lt;name&gt;/terraform.tfvars

# Core settings
project_name = "my-gastown"
provider = "hetzner"
region = "fsn1"
instance_type = "cx21"

# Gas Town Ecosystem
enable_gastown = true          # Install Gas Town (gt CLI)
enable_beads = true            # Install Beads (bd CLI)
enable_systemd_services = true # Start Mayor/Deacon on boot

# AI Assistants
enable_claude = true
enable_codex = true</code></pre>
      </div>

      <h3>Deployment Isolation Model</h3>
      <p>Each deployment is fully isolated with independent state:</p>
      <div class="ascii-diagram">
deployments/
+-- gastown-prod/               # Production Gas Town
|   +-- terraform.tfstate       # Independent state
|   +-- inventory.ini           # Own inventory
|   +-- generated_key           # Own SSH key
|
+-- gastown-dev/                # Development Gas Town
|   +-- terraform.tfstate       # Independent state
|   +-- inventory.ini           # Own inventory
      </div>
    </section>

    <hr class="section-divider divider-procedure">

    <!-- Pricing Section -->
    <section id="pricing">
      <h2><span style="font-weight: 700;">Mul</span>ti-Cloud Pricing Comparison</h2>

      <table class="comparison-table">
        <thead>
          <tr><th>Provider</th><th>Monthly Cost</th><th>Specs</th><th>Best For</th></tr>
        </thead>
        <tbody>
          <tr><td>Hetzner</td><td>~$4-8/mo</td><td>2 vCPU, 4GB RAM</td><td>Budget-conscious, EU-based</td></tr>
          <tr><td>DigitalOcean</td><td>~$24/mo</td><td>2 vCPU, 4GB RAM</td><td>Simple, developer-friendly</td></tr>
          <tr><td>AWS EC2</td><td>~$30/mo</td><td>2 vCPU, 4GB RAM (t3.medium)</td><td>Enterprise integration</td></tr>
        </tbody>
      </table>

      <h3>Scaling Tiers</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Tier</th><th>Specs</th><th>Cost Range</th><th>Use Case</th></tr>
        </thead>
        <tbody>
          <tr><td>Development</td><td>2 vCPU, 4GB RAM</td><td>$4-30/mo</td><td>Single Gas Town, 5-10 agents</td></tr>
          <tr><td>Production</td><td>4 vCPU, 8GB RAM</td><td>$10-60/mo</td><td>15-20 agents, moderate load</td></tr>
          <tr><td>High Performance</td><td>8 vCPU, 16GB RAM</td><td>$30-150/mo</td><td>30+ agents, high throughput</td></tr>
        </tbody>
      </table>
    </section>

    <hr class="section-divider divider-procedure">

    <!-- Station NATS Section -->
    <section id="station-nats">
      <h2><span style="font-weight: 700;">Sta</span>tion NATS Backbone</h2>

      <p><strong>Station</strong> is an open-source runtime that uses NATS as the coordination backbone. This provides infrastructure-grade messaging for production multi-agent deployments.</p>

      <h3>Why NATS?</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Capability</th><th>Benefit</th></tr>
        </thead>
        <tbody>
          <tr><td>Sub-millisecond latency</td><td>Real-time agent coordination</td></tr>
          <tr><td>JetStream persistence</td><td>Exactly-once semantics, audit trails</td></tr>
          <tr><td>Built-in clustering</td><td>High availability without external tools</td></tr>
          <tr><td>KeyValue stores</td><td>Distributed state management</td></tr>
        </tbody>
      </table>

      <h3>Operating Modes</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Mode</th><th>Command</th><th>Use Case</th></tr>
        </thead>
        <tbody>
          <tr><td>Standalone</td><td><code>stn serve</code></td><td>Development, testing</td></tr>
          <tr><td>Orchestrator</td><td><code>stn serve --orchestration</code></td><td>Hub deployment</td></tr>
          <tr><td>Member</td><td><code>stn serve --lattice &lt;url&gt;</code></td><td>Distributed agents</td></tr>
        </tbody>
      </table>

      <h3>Quick Start</h3>
      <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; position: relative; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
        <button class="copy-btn" onclick="copyCode(this)" style="position: absolute; top: 0.5rem; right: 0.5rem; background: #2a7d7d; color: white; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer;">Copy</button>
        <pre style="margin: 0; overflow-x: auto;"><code># Install Station CLI
curl -fsSL https://raw.githubusercontent.com/cloudshipai/station/main/install.sh | bash

# Initialize with provider
export ANTHROPIC_API_KEY="sk-ant-api03-..."
stn init --provider anthropic

# Start services
stn jaeger up           # Tracing backend
stn up                  # Station server
stn status              # Verify status</code></pre>
      </div>
    </section>

    <hr class="section-divider divider-procedure">

    <!-- Agentic-Flow Section -->
    <section id="agentic-flow">
      <h2><span style="font-weight: 700;">Age</span>ntic-Flow Production Platform</h2>

      <p><strong>Agentic-Flow</strong> transforms development-stage agent workflows into scalable, persistent, enterprise-grade deployments.</p>

      <h3>Key Performance Metrics</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Feature</th><th>Performance</th><th>Benefit</th></tr>
        </thead>
        <tbody>
          <tr><td>HNSW Vector Search</td><td>150x-12,500x faster</td><td>Sub-millisecond retrieval</td></tr>
          <tr><td>Flash Attention</td><td>2.49x-7.47x speedup</td><td>50-75% memory reduction</td></tr>
          <tr><td>QUIC Transport</td><td>50-70% faster execution</td><td>0-RTT reconnection</td></tr>
        </tbody>
      </table>

      <h3>Swarm Topologies</h3>
      <div class="ascii-diagram">
HIERARCHICAL                    MESH                        RING
    +---+                    +---+---+---+                +---+
    | C | Coordinator        | A | B | C |              +-| A |-+
    +-+-+                    +---+---+---+              | +---+ |
  +---+---+                  | D | E | F |            +-+-+   +-+-+
+-+-+ | +-+-+                +---+---+---+            | E |   | B |
| A | | | B |                                         +-+-+   +-+-+
+---+ | +---+                                           | +---+ |
    +-+-+                                               +-| D |-+
    | C |                                                 +---+
    +---+

Scales to ~100 agents        Full redundancy              Ordered flow
Best for: Codebase analysis  Best for: Consensus          Best for: Pipelines
      </div>

      <h3>Basic Initialization</h3>
      <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; position: relative; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
        <button class="copy-btn" onclick="copyCode(this)" style="position: absolute; top: 0.5rem; right: 0.5rem; background: #2a7d7d; color: white; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer;">Copy</button>
        <pre style="margin: 0; overflow-x: auto;"><code>import { EnhancedAgentDBWrapper } from 'agentic-flow/core';

const wrapper = new EnhancedAgentDBWrapper({
  enableAttention: true,
  enableGNN: true,
  attentionConfig: {
    type: 'flash'  // 2.49x-7.47x speedup
  },
});

await wrapper.initialize();</code></pre>
      </div>
    </section>

    <hr class="section-divider divider-procedure">

    <!-- Production Checklist Section -->
    <section id="production-checklist">
      <h2><span style="font-weight: 700;">Pro</span>duction Readiness Checklist</h2>

      <h3>Phase 1: Infrastructure Provisioning</h3>
      <ul>
        <li>Cloud provider account created and verified</li>
        <li>API credentials secured and encrypted</li>
        <li>Terraform/OpenTofu installed and configured</li>
        <li>Ansible installed with required collections</li>
        <li>Roughneck cloned and dependencies installed</li>
      </ul>

      <h3>Phase 2: Service Verification</h3>
      <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; position: relative; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
        <button class="copy-btn" onclick="copyCode(this)" style="position: absolute; top: 0.5rem; right: 0.5rem; background: #2a7d7d; color: white; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer;">Copy</button>
        <pre style="margin: 0; overflow-x: auto;"><code>./roughneck ssh production-gastown

# On remote VM:
gt version           # Gas Town CLI
bd version           # Beads CLI
claude --version     # Claude Code CLI
systemctl status roughneck-mayor
systemctl status roughneck-deacon
docker info</code></pre>
      </div>

      <h3>Key Ports Reference</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Port</th><th>Service</th></tr>
        </thead>
        <tbody>
          <tr><td>22</td><td>SSH</td></tr>
          <tr><td>4222</td><td>NATS</td></tr>
          <tr><td>4433</td><td>QUIC</td></tr>
          <tr><td>8222</td><td>NATS HTTP monitoring</td></tr>
          <tr><td>8585</td><td>Station Web UI</td></tr>
          <tr><td>10000</td><td>code-server IDE</td></tr>
          <tr><td>16686</td><td>Jaeger UI</td></tr>
        </tbody>
      </table>

      <!-- Checkpoint Box -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint: Infrastructure Deployed</div>
        <p><strong>You should see:</strong></p>
        <ul>
          <li>Terraform init and apply completed without errors</li>
          <li>Ansible playbook executed successfully</li>
          <li>SSH access working</li>
          <li>Gas Town Mayor and Deacon services running</li>
        </ul>
      </div>
    </section>

    <hr class="section-divider divider-warning">

    <!-- Troubleshooting Section -->
    <section id="troubleshooting">
      <h2><span style="font-weight: 700;">Tro</span>ubleshooting</h2>

      <details class="troubleshoot" style="border: 1px solid #c97065; border-radius: 8px; margin: 1rem 0;">
        <summary style="background: #fef6f5; padding: 1rem; cursor: pointer; color: #c97065; font-weight: 600;">Terraform init failed</summary>
        <div style="padding: 1rem;">
          <p><strong>Solutions:</strong></p>
          <ol>
            <li>Check internet connectivity</li>
            <li>Verify Terraform version: <code>terraform --version</code> (needs 1.0+)</li>
            <li>Try OpenTofu instead: <code>brew install opentofu</code></li>
            <li>Clear cache: <code>rm -rf .terraform*</code></li>
          </ol>
        </div>
      </details>

      <details class="troubleshoot" style="border: 1px solid #c97065; border-radius: 8px; margin: 1rem 0;">
        <summary style="background: #fef6f5; padding: 1rem; cursor: pointer; color: #c97065; font-weight: 600;">Ansible connection refused</summary>
        <div style="padding: 1rem;">
          <p><strong>Solutions:</strong></p>
          <ol>
            <li>Wait 2-3 minutes for VM to fully boot</li>
            <li>Verify SSH key: <code>ssh -i deployments/&lt;name&gt;/generated_key root@&lt;ip&gt;</code></li>
            <li>Check cloud firewall allows SSH (port 22)</li>
            <li>Verify inventory file: <code>cat deployments/&lt;name&gt;/inventory.ini</code></li>
          </ol>
        </div>
      </details>

      <details class="troubleshoot" style="border: 1px solid #c97065; border-radius: 8px; margin: 1rem 0;">
        <summary style="background: #fef6f5; padding: 1rem; cursor: pointer; color: #c97065; font-weight: 600;">Gas Town not installed</summary>
        <div style="padding: 1rem;">
          <p><strong>Solutions:</strong></p>
          <ol>
            <li>Check feature flag: <code>grep enable_gastown deployments/&lt;name&gt;/terraform.tfvars</code></li>
            <li>Source bash profile: <code>source ~/.bashrc</code></li>
            <li>Check PATH: <code>echo $PATH | grep go/bin</code></li>
            <li>Verify Go binary: <code>ls ~/go/bin/gt</code></li>
          </ol>
        </div>
      </details>

      <details class="troubleshoot" style="border: 1px solid #c97065; border-radius: 8px; margin: 1rem 0;">
        <summary style="background: #fef6f5; padding: 1rem; cursor: pointer; color: #c97065; font-weight: 600;">Failed to connect to NATS</summary>
        <div style="padding: 1rem;">
          <p><strong>Solutions:</strong></p>
          <ol>
            <li>Verify orchestrator is running: <code>stn status</code></li>
            <li>Check NATS port: <code>nc -zv localhost 4222</code></li>
            <li>Verify firewall allows port 4222</li>
            <li>Check URL format: <code>nats://host:port</code> (not <code>http://</code>)</li>
          </ol>
        </div>
      </details>
    </section>

    <hr class="section-divider">

    <!-- Milestone -->
    <div class="milestone" style="background: linear-gradient(90deg, #6b9b7a 0%, #2a7d7d 100%); color: white; padding: 1rem 1.5rem; border-radius: 8px; text-align: center; margin: 2rem 0;">
      Roughneck is the construction company. Gas Town is the factory floor. Station is the communication backbone.
    </div>

    <!-- Related Pages -->
    <div class="related-pages" style="margin-top: 2rem; padding: 1rem; background: #f9f6f0; border-radius: 8px;">
      <h4 style="margin-top: 0;">Related Documents</h4>
      <ul>
        <li><a href="architecture-complexity-ladder.html">Complexity Ladder</a> - Where these tools fit (Level 6-7)</li>
        <li><a href="compare-ralph-variants-complete.html">Ralph Variants</a> - Continuous loop patterns</li>
        <li><a href="mcp-ecosystem-complete.html">MCP Ecosystem</a> - Protocol and SDK reference</li>
      </ul>
    </div>

    <!-- Footer Navigation -->
    <div class="footer-nav" style="display: flex; justify-content: space-between; margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #e0d5c5;">
      <a href="synthesis-index.html">Back to Synthesis Index</a>
      <a href="integration-memory-patterns.html">Next: Memory Patterns</a>
    </div>

  </div>

  <script src="../js/copy-code.js"></script>
  <script src="../js/search.js"></script>
  <script>
    function copyCode(button) {
      const codeBlock = button.parentElement.querySelector('code');
      navigator.clipboard.writeText(codeBlock.textContent);
      button.textContent = 'Copied!';
      setTimeout(() => button.textContent = 'Copy', 2000);
    }
  </script>
<script src="../js/global-nav.js"></script>
</body>
</html>
