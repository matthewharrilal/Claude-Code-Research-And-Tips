<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta data-pagefind-meta="section" content="Synthesis">
  <meta data-pagefind-meta="category" content="Taxonomy">
  <title>Workflow Pattern Taxonomy - Claude Code Knowledge Base</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/sidebar.css">
  <link rel="stylesheet" href="../css/search.css">
</head>
<body>
  <!-- Search Modal -->
  <div class="search-modal" id="searchModal" aria-hidden="true">
    <div class="search-overlay" onclick="closeSearch()"></div>
    <div class="search-content">
      <div class="search-header">
        <div class="search-input-wrapper">
          <span class="search-icon-input">&#128269;</span>
          <input type="text" id="searchInput" placeholder="Search documentation..." autocomplete="off" />
          <kbd class="search-kbd">ESC</kbd>
        </div>
      </div>
      <div class="search-filters">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="synthesis">Synthesis</button>
        <button class="filter-btn" data-filter="extractions">Extractions</button>
        <button class="filter-btn" data-filter="journeys">Journeys</button>
      </div>
      <div class="search-results" id="searchResults">
        <div class="search-empty"><p>Start typing to search... (Press Cmd+K anytime)</p></div>
      </div>
      <div class="search-footer">
        <span>Up/Down Navigate</span><span>Enter Select</span><span>ESC Close</span>
      </div>
    </div>
  </div>

  <nav class="left-nav" id="leftNav">
    <div class="px-4 mb-4">
      <a href="../index.html" class="text-xs font-semibold text-accent hover:text-accent-light uppercase tracking-wider">Claude Code KB</a>
    </div>
    <div class="nav-content"></div>
  </nav>

  <button class="search-trigger" onclick="openSearch()" aria-label="Search" style="float: right; margin-bottom: 1rem;">
    <span class="search-icon">Cmd+K</span>
    <span class="search-text">Search</span>
  </button>

  <div class="wide-container">
    <!-- Breadcrumb Navigation -->
    <nav class="nav-breadcrumb">
      <a href="../index.html">Home</a>
      <span>/</span>
      <a href="synthesis-index.html">Synthesis</a>
      <span>/</span>
      <a href="taxonomy-master.html">Taxonomy</a>
      <span>/</span>
      <span>Workflow Patterns</span>
    </nav>

    <!-- You Are Here Context Box -->
    <div class="you-are-here" style="background: linear-gradient(135deg, #f0ebe3 0%, #fefcf3 100%); border-left: 4px solid #2a7d7d; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
      <h3 style="color: #2a7d7d; margin-top: 0; font-size: 0.9em; text-transform: uppercase; letter-spacing: 0.5px;">You Are Here</h3>
      <p style="margin-bottom: 0;"><strong><span class="b">Work</span>flow <span class="b">Pat</span>tern <span class="b">Tax</span>onomy</strong> - The complete workflow reference for Claude Code usage patterns. If you're deciding how to structure your development workflow (PRD-driven, Kanban, goal-conditioned, hybrid), verification patterns (tests, browser, screenshots), or stop conditions, this document covers every pattern with decision guides.</p>
      <p style="margin-top: 0.5rem; font-size: 0.9em; color: #5c4b3a;"><em>Note: For D-FINAL current content, see D-FINAL-implementation.md Section 3.</em></p>
    </div>

    <h1><span class="b">Work</span>flow <span class="b">Pat</span>tern <span class="b">Tax</span>onomy</h1>

    <!-- Table of Contents -->
    <div class="toc">
      <div class="toc-title">Contents</div>
      <ul>
        <li><a href="#task-management">1. Task Management Approaches</a></li>
        <li><a href="#verification-patterns">2. Verification Patterns</a></li>
        <li><a href="#workflow-progression">3. Workflow Progression Spectrum</a></li>
        <li><a href="#external-memory">4. External Memory Systems</a></li>
        <li><a href="#context-management">5. Context Management Strategies</a></li>
        <li><a href="#multi-agent">6. Multi-Agent Coordination Patterns</a></li>
        <li><a href="#feedback-loops">7. Feedback Loop Architectures</a></li>
        <li><a href="#stop-conditions">8. Stop Condition Patterns</a></li>
        <li><a href="#task-sizing">9. Task Sizing Heuristics</a></li>
        <li><a href="#error-recovery">10. Error Recovery Workflows</a></li>
        <li><a href="#cost-optimization">11. Cost Optimization Workflows</a></li>
        <li><a href="#hybrid-workflows">12. Hybrid Human-AI Workflows</a></li>
        <li><a href="#decision-guide">13. Decision Guide</a></li>
        <li><a href="#troubleshooting">Troubleshooting</a></li>
      </ul>
    </div>

    <hr class="section-divider">

    <!-- Task Management Approaches -->
    <section id="task-management">
      <h2><span class="b">1.</span> <span class="b">Ta</span>sk <span class="b">Man</span>agement <span class="b">App</span>roaches</h2>

      <h3>1.1 PRD-Driven Development</h3>
      <p>The dominant pattern for structured, multi-task autonomous work. Use a JSON Product Requirements Document to define all tasks with explicit state tracking.</p>

      <h4>prd.json Format (Ryan Carson / Anthropic)</h4>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>{
  "project": "MyProject",
  "branchName": "feature/my-feature",
  "description": "Feature description",
  "userStories": [
    {
      "id": "US-001",
      "title": "Task title",
      "description": "As a [user], I need [what]",
      "acceptanceCriteria": [
        "Criterion 1",
        "Criterion 2",
        "npm run typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    }
  ]
}</code></pre>
      </div>

      <h4>Matt Pocock's Simplified Format</h4>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>{
  "delete_video_shows_confirmation": {
    "description": "Delete video shows confirmation dialog before deleting",
    "passes": true
  },
  "beats_display": {
    "description": "Beats display as three orange ellipses dots below clip",
    "details": "Add beat to clip, verify 3 orange dots appear",
    "passes": false
  }
}</code></pre>
      </div>

      <h4>Why JSON Over Markdown</h4>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Aspect</th><th>JSON</th><th>Markdown</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Parsing</strong></td><td>Deterministic</td><td>Ambiguous</td></tr>
            <tr><td><strong>Updates</strong></td><td>Structured</td><td>Risk of malformed edits</td></tr>
            <tr><td><strong>State tracking</strong></td><td><code>passes: true/false</code></td><td>Manual checkboxes</td></tr>
            <tr><td><strong>LLM reliability</strong></td><td>Higher</td><td>Lower</td></tr>
          </tbody>
        </table>
      </div>

      <h4>Key Principles</h4>
      <ul>
        <li><strong>Tasks must be small</strong> - Completable in one context window</li>
        <li><strong>Acceptance criteria must be verifiable</strong> - Agent can check without human</li>
        <li><strong>Always include typecheck</strong> - <code>npm run typecheck passes</code> as final criterion</li>
        <li><strong>Dependencies ordered correctly</strong> - Schema -> Backend -> Frontend</li>
      </ul>

      <h3>1.2 Kanban-Style Mental Model</h3>
      <p>Treat tasks as cards on a virtual board. Agent picks from "todo", moves to "doing", then "done".</p>

      <div class="ascii-diagram">
+-------------+    +-------------+    +-------------+
|    TODO     |    |    DOING    |    |    DONE     |
+-------------+    +-------------+    +-------------+
|  US-003     |    |  US-002     |    |  US-001     |
|  US-004     |    |             |    |             |
|  US-005     |    |             |    |             |
+-------------+    +-------------+    +-------------+</div>

      <blockquote>
        <p>"Pick task from board -> Complete -> Back to board -> All done? Exit : Loop"</p>
        <cite>-- Matt Pocock</cite>
      </blockquote>

      <h3>1.3 Goal-Conditioned Loops</h3>
      <p>Define the end state, let agent loop until it reaches it.</p>

      <h4>The Promise Pattern</h4>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>claude "Build a REST API for todos. When complete, output: &lt;promise&gt;COMPLETE&lt;/promise&gt;"</code></pre>
      </div>

      <h4>Ralph Wiggum Implementation</h4>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>#!/bin/bash
while :; do
  output=$(claude @prompt.md)
  if echo "$output" | grep -q "&lt;promise&gt;COMPLETE&lt;/promise&gt;"; then
    echo "Goal reached!"
    break
  fi
done</code></pre>
      </div>

      <h4>jq-Based Loop Condition (Maurice Kleine)</h4>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>while jq '.tasks[] | select(.passes == false)' prd.json | grep -q .; do
  claude @prompt.md
done</code></pre>
      </div>

      <h3>1.4 Phase-Based Development</h3>
      <p>Break large features into sequential phases with gates.</p>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>{
  "epic": "User Authentication System",
  "phases": [
    {
      "phase": 1,
      "name": "Database Foundation",
      "prd_file": "plans/auth-phase1.json",
      "estimated_iterations": 5,
      "gate": ["Schema exists", "Migrations run"]
    },
    {
      "phase": 2,
      "name": "Backend Logic",
      "prd_file": "plans/auth-phase2.json",
      "blockedBy": "phase1",
      "gate": ["All API endpoints return expected status codes"]
    },
    {
      "phase": 3,
      "name": "Frontend Integration",
      "prd_file": "plans/auth-phase3.json",
      "blockedBy": "phase2",
      "gate": ["E2E login flow passes"]
    }
  ],
  "total_budget": "$50"
}</code></pre>
      </div>

      <h3>1.5 TodoWrite (Native Ephemeral)</h3>
      <p>Claude Code's built-in todo list for single-session tracking.</p>
      <ul>
        <li><strong>Best For:</strong> Single-session work, personal linear tasks, quick tracking</li>
        <li><strong>Limitations:</strong> Ephemeral (does not persist), no owners/team visibility, no dependency tracking</li>
      </ul>

      <h3>1.6 TaskCreate (Native Multi-Agent)</h3>
      <p>Claude Code's disabled beta features for multi-agent coordination (enabled via CC Mirror).</p>
      <div class="ascii-diagram">
Tasks:
 #1 Design API architecture
 #2 Create project structure
 #3 Implement data models
 #4 Implement REST endpoints (blocked by #3)
 #5 Write integration tests (blocked by #4)
 #6 Create documentation (blocked by #4)</div>

      <!-- Checkpoint -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint: Task Management</div>
        <p><strong>You should now understand:</strong></p>
        <ul>
          <li>The 6 task management approaches (PRD-Driven, Kanban, Goal-Conditioned, Phase-Based, TodoWrite, TaskCreate)</li>
          <li>Why JSON over Markdown for PRD files</li>
          <li>The 2-3 sentence test for task sizing</li>
          <li>The difference between TodoWrite (ephemeral) and TaskCreate (multi-agent)</li>
        </ul>
        <p><strong>Terminal verification:</strong></p>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code># Test your PRD is valid JSON
cat plans/prd.json | jq '.userStories | length'
# You should see: number of stories in your PRD</code></pre>
        </div>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Verification Patterns -->
    <section id="verification-patterns">
      <h2><span class="b">2.</span> <span class="b">Ver</span>ification <span class="b">Pat</span>terns</h2>

      <h3>Verification Hierarchy</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Priority</th><th>Method</th><th>Use Case</th><th>Tool</th></tr>
          </thead>
          <tbody>
            <tr><td>1</td><td>Type checking</td><td>Always</td><td><code>npm run typecheck</code></td></tr>
            <tr><td>2</td><td>Unit tests</td><td>Logic verification</td><td><code>npm test</code>, <code>pytest</code></td></tr>
            <tr><td>3</td><td>Integration tests</td><td>API verification</td><td><code>npm run test:integration</code></td></tr>
            <tr><td>4</td><td>E2E tests</td><td>Full flow</td><td>Playwright, Cypress</td></tr>
            <tr><td>5</td><td>CI green</td><td>All commits</td><td>GitHub Actions</td></tr>
            <tr><td>6</td><td>Browser automation</td><td>UI verification</td><td>Playwright MCP</td></tr>
            <tr><td>7</td><td>Manual spot-check</td><td>Milestones</td><td>Human review</td></tr>
          </tbody>
        </table>
      </div>

      <h3>2.1 Test-Driven Verification</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>{
  "acceptanceCriteria": [
    "npm run typecheck passes",
    "npm run test passes",
    "npm run lint passes"
  ]
}</code></pre>
      </div>

      <blockquote>
        <p>"Without verification, Ralph produces garbage."</p>
        <cite>-- @mattpocockuk</cite>
      </blockquote>

      <blockquote>
        <p>"Keep CI green. If you don't, you're hamstringing future agent runs with bad code, and they'll need to bisect to find bugs."</p>
        <cite>-- @mattpocockuk</cite>
      </blockquote>

      <h3>2.2 Browser Verification (Playwright MCP)</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>{
  "acceptanceCriteria": [
    "Navigate to /users",
    "Click filter dropdown",
    "Select 'Active'",
    "Confirm list shows only active users",
    "Take screenshot for verification"
  ]
}</code></pre>
      </div>

      <blockquote>
        <p>"Claude's tendency to mark features complete without proper testing... did much better at verifying end-to-end once explicitly prompted to use browser automation tools"</p>
        <cite>-- Anthropic Best Practices</cite>
      </blockquote>

      <h3>2.3 Screenshot Validation</h3>
      <p>Capture visual state for UI verification.</p>
      <ul>
        <li>Confirm UI rendered correctly</li>
        <li>Document visual state for progress.txt</li>
        <li>Regression detection for UI changes</li>
      </ul>

      <h3>2.4 Negative Verification</h3>
      <p>Always include "don't break" criteria:</p>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>{
  "negativeCriteria": [
    "Does not modify files outside {directory}",
    "Does not add new dependencies without approval note",
    "Does not increase bundle size > 5KB",
    "Does not break existing public API",
    "Does not log sensitive data",
    "No console errors"
  ]
}</code></pre>
      </div>

      <h3>2.5 Property-Based Verification</h3>
      <p>For mathematical/data tasks:</p>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>{
  "testStrategy": "property-based",
  "properties": [
    "Output array length equals input length",
    "All items from input appear in output",
    "Adjacent items satisfy: a.date <= b.date",
    "Idempotent: sort(sort(x)) === sort(x)"
  ],
  "acceptanceCriteria": [
    "npm run test:property -- sortByDate passes 1000 cases"
  ]
}</code></pre>
      </div>

      <!-- Checkpoint -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint: Verification Patterns</div>
        <p><strong>You should now understand:</strong></p>
        <ul>
          <li>The 6 verification methods and their priority order</li>
          <li>Why browser verification is critical for UI work</li>
          <li>Negative verification (what NOT to break)</li>
          <li>Property-based testing for mathematical/data tasks</li>
        </ul>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Workflow Progression Spectrum -->
    <section id="workflow-progression">
      <h2><span class="b">3.</span> <span class="b">Work</span>flow <span class="b">Pro</span>gression <span class="b">Spec</span>trum</h2>

      <div class="ascii-diagram">
+-------------------------------------------------------------------------+
|                    WORKFLOW PROGRESSION SPECTRUM                         |
+-------------------------------------------------------------------------+
|                                                                          |
|  SINGLE-SHOT --> INTERACTIVE --> AUTONOMOUS --> MULTI-AGENT --> SWARM   |
|                                                                          |
|  +----------+   +----------+   +----------+   +----------+   +--------+ |
|  |One prompt|   |Back-and- |   |Ralph     |   |CC Mirror |   |Gas Town| |
|  |One task  |   |forth     |   |loops     |   |TaskCreate|   |Factory | |
|  |Immediate |   |dialogue  |   |Overnight |   |Parallel  |   |10+ agen| |
|  |result    |   |Human-    |   |operations|   |agents    |   |ts      | |
|  |          |   |guided    |   |          |   |          |   |        | |
|  +----------+   +----------+   +----------+   +----------+   +--------+ |
|                                                                          |
|  Low complexity                                        High complexity   |
|  High oversight                                        Low oversight     |
|  Low cost                                              High cost         |
|                                                                          |
+-------------------------------------------------------------------------+</div>

      <h3>3.1 Single-Shot Workflow</h3>
      <ul>
        <li>One prompt, one response, immediate result</li>
        <li>Human reviews before proceeding</li>
        <li><strong>When to Use:</strong> Simple well-defined tasks, bug fixes, documentation updates</li>
      </ul>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>claude "Add a comment to the calculateTotal function explaining what it does"</code></pre>
      </div>

      <h3>3.2 Interactive Workflow</h3>
      <ul>
        <li>Back-and-forth dialogue, human guides direction</li>
        <li>Incremental refinement, high oversight</li>
        <li><strong>When to Use:</strong> Exploration, design decisions, code review, learning codebases</li>
      </ul>

      <h3>3.3 Autonomous Workflow (Ralph Loops)</h3>
      <ul>
        <li>Agent works independently, multiple iterations</li>
        <li>External state persistence, completion signals</li>
        <li><strong>When to Use:</strong> Well-defined features, overnight operations, mechanical/repetitive tasks</li>
      </ul>

      <div class="ascii-diagram">
+---------------------------------------------+
|  1. Start with fresh context                |
|            |                                |
|  2. Read task state from files              |
|     (prd.json, progress.txt, git history)   |
|            |                                |
|  3. Pick highest priority incomplete task   |
|            |                                |
|  4. Implement task                          |
|            |                                |
|  5. Run verification (tests, typecheck)     |
|            |                                |
|  6. If pass: commit, update prd.json        |
|     If fail: log learnings, try again       |
|            |                                |
|  7. Append to progress.txt                  |
|            |                                |
|  8. Check completion condition              |
|     All done? --> Output promise --> EXIT   |
|     Not done? --> Loop continues            |
+---------------------------------------------+</div>

      <h3>3.4 Multi-Agent Parallel Workflow</h3>
      <ul>
        <li>Multiple agents simultaneously, task coordination</li>
        <li>Branch isolation, merge at completion</li>
        <li><strong>When to Use:</strong> Large features with independent parts, team collaboration</li>
      </ul>

      <h4>Git Worktrees for Isolation</h4>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>for feature in auth payments notifications; do
  git worktree add ../wt-$feature $feature-branch
  (cd ../wt-$feature && ./ralph.sh 20) &
done
wait</code></pre>
      </div>

      <h3>3.5 Swarm Workflow (Gas Town)</h3>
      <ul>
        <li>10+ parallel agents, hub-and-spoke architecture</li>
        <li>Factory-like scaling, heavy investment</li>
        <li><strong>When to Use:</strong> Enterprise-scale refactoring, mass migrations, large greenfield projects</li>
      </ul>

      <div class="ascii-diagram">
+-------------------------------------------------------------------------+
|                            GAS TOWN FACTORY                              |
+-------------------------------------------------------------------------+
|                                                                          |
|  +----------+                                                            |
|  | REFINERY | &lt;-- Task decomposition, quality control                    |
|  +-----+----+                                                            |
|        |                                                                 |
|        v                                                                 |
|  +--------------------------------------------------------------+       |
|  |                       WORKER POOL                             |       |
|  |  +--------+ +--------+ +--------+ +--------+ +--------+       |       |
|  |  |Worker 1| |Worker 2| |Worker 3| |Worker 4| |Worker N|       |       |
|  |  |(Sonnet)| |(Sonnet)| |(Sonnet)| |(Sonnet)| |(Sonnet)|       |       |
|  |  +--------+ +--------+ +--------+ +--------+ +--------+       |       |
|  +--------------------------------------------------------------+       |
|                                                                          |
|  Requirements: Stage 7+ developer, significant infrastructure            |
|                                                                          |
+-------------------------------------------------------------------------+</div>
    </section>

    <hr class="section-divider">

    <!-- External Memory Systems -->
    <section id="external-memory">
      <h2><span class="b">4.</span> <span class="b">Ext</span>ernal <span class="b">Mem</span>ory <span class="b">Sys</span>tems</h2>

      <h3>The Fresh Context Principle</h3>
      <blockquote>
        <p>"Each iteration spawns a NEW Claude instance with NO memory of previous work."</p>
      </blockquote>

      <p>Continuity comes entirely from external sources:</p>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>State Type</th><th>Storage</th><th>Update Pattern</th></tr>
          </thead>
          <tbody>
            <tr><td>Code changes</td><td>Git history</td><td>Commit each iteration</td></tr>
            <tr><td>Task status</td><td>prd.json</td><td>Update <code>passes: true/false</code></td></tr>
            <tr><td>Learnings</td><td>progress.txt</td><td>APPEND only</td></tr>
            <tr><td>Context</td><td>CLAUDE.md</td><td>Rarely updated</td></tr>
            <tr><td>Project structure</td><td>File system</td><td>Modified as needed</td></tr>
          </tbody>
        </table>
      </div>

      <h3>4.1 progress.txt Pattern</h3>
      <p><strong>Purpose:</strong> Append-only log for LLM memory across iterations.</p>

      <div class="callout callout-warning">
        <div class="callout-title">Critical Rule</div>
        <p><strong>NEVER UPDATE</strong> - would overwrite history. Always append new entries.</p>
      </div>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>Use this to leave a note for the next person working on your codebase.

---

Iteration 1 (2026-01-09 10:00):
- Completed: US-001 - Tool skeleton created
- Learned: Use orange (#FF6B35) for visibility on dark backgrounds
- Next: Consider beat playback timing

---

Iteration 2 (2026-01-09 10:15):
- Completed: US-002 - Category mapping
- Issue encountered: Zod schema needed adjustment for optional fields
- Pattern discovered: Always use .optional() explicitly</code></pre>
      </div>

      <h4>What to Log</h4>
      <ol>
        <li><strong>What was completed</strong> - Reference user story ID</li>
        <li><strong>What was learned</strong> - Patterns, gotchas, decisions</li>
        <li><strong>What blocked or failed</strong> - Help future iterations avoid</li>
        <li><strong>What to do next</strong> - Suggestions for priority</li>
      </ol>

      <h3>4.2 CLAUDE.md Pattern</h3>
      <p>Project-level context that persists across all sessions.</p>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Project Name

## Ralph Loop Configuration

This project uses the Ralph Wiggum pattern for autonomous development.

### PRD Location
- Task tracking: `plans/prd.json`
- Progress log: `plans/progress.txt`

### Verification Requirements
For any story to be marked `passes: true`:
1. `npm run typecheck` must pass
2. `npm run test` must pass
3. `npm run lint` must pass

### Workflow
1. Read prd.json to find next task with `passes: false`
2. Implement the feature following existing patterns
3. Run verification commands
4. If all pass, mark `passes: true` and commit
5. Append learnings to progress.txt
6. If ALL tasks complete, output: &lt;promise&gt;COMPLETE&lt;/promise&gt;</code></pre>
      </div>

      <h3>4.3 Git History as Memory</h3>
      <p>Each commit is a checkpoint agent can reference.</p>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>feat(US-001): Add user authentication schema

- Created users table with email, password_hash
- Added migration for existing data
- Typecheck passes

Co-Authored-By: Claude Opus 4.5 &lt;noreply@anthropic.com&gt;</code></pre>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Context Management Strategies -->
    <section id="context-management">
      <h2><span class="b">5.</span> <span class="b">Con</span>text <span class="b">Man</span>agement <span class="b">Str</span>ategies</h2>

      <h3>The Context Rot Problem</h3>
      <blockquote>
        <p>"Context rot: LLMs get stupider with more tokens. If tasks are too big, fill context window before done, quality drops dramatically, agent loses track."</p>
        <cite>-- @mattpocockuk</cite>
      </blockquote>

      <h3>Token Budget Framework</h3>
      <p><strong>Recommended Allocation (100K effective):</strong></p>
      <div class="ascii-diagram">
+-- 10K System/CLAUDE.md (fixed)
+-- 20K Codebase context (per task)
+-- 40K Working memory (implementation)
+-- 15K Tool outputs (verification)
+-- 15K Buffer (retries, exploration)</div>
      <p><strong>Task must fit in working memory allocation (40K) or split.</strong></p>

      <h3>Signs of Context Overflow</h3>
      <ul>
        <li>Agent repeats earlier statements</li>
        <li>Agent forgets recent changes</li>
        <li>Quality of output degrades</li>
        <li>Agent "hallucinates" non-existent code</li>
        <li>Agent marks incomplete work as done</li>
      </ul>

      <h3>Context Protection Strategies</h3>

      <h4>1. Subagents for Expensive Operations</h4>
      <blockquote>
        <p>"The feedback loop is everything, but put costly tools like browser control in subagents to protect your main context window tokens"</p>
        <cite>-- @TendiesOfWisdom</cite>
      </blockquote>
      <p>Spawn subagents for: Playwright browser automation, large file reads, MCP tool calls, verbose git operations.</p>

      <h4>2. Fresh Context Per Iteration</h4>
      <p>Ralph pattern: Kill session, start fresh, read state from files.</p>

      <h4>3. Compact PRD</h4>
      <p>Only include active stories, archive completed ones.</p>

      <h4>4. Prune Progress.txt</h4>
      <p>Periodically archive old learnings to <code>progress-archive.txt</code>.</p>

      <h4>5. Auto-Handoff Pattern (Amp)</h4>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>{
  "amp.experimental.autoHandoff": {
    "context": 90
  }
}</code></pre>
      </div>
      <p>Automatically starts new context at 90% usage.</p>
    </section>

    <hr class="section-divider">

    <!-- Multi-Agent Coordination Patterns -->
    <section id="multi-agent">
      <h2><span class="b">6.</span> <span class="b">Mul</span>ti-<span class="b">Age</span>nt <span class="b">Coo</span>rdination <span class="b">Pat</span>terns</h2>

      <h3>6.1 Hub-and-Spoke (Gas Town)</h3>
      <div class="ascii-diagram">
        +----------+
        |   HUB    | (Orchestrator)
        +----+-----+
             |
    +--------+--------+
    |        |        |
    v        v        v
+------+ +------+ +------+
|Spoke1| |Spoke2| |Spoke3| (Workers)
+------+ +------+ +------+</div>
      <p>Hub decomposes tasks. Spokes execute independently. Hub merges results.</p>

      <h3>6.2 Peer-to-Peer (CC Mirror)</h3>
      <div class="ascii-diagram">
+---------+     +---------+
| Agent 1 |&lt;---&gt;| Agent 2 |
+----+----+     +----+----+
     |              |
     +------+-------+
            |
            v
       +---------+
       | Agent 3 |
       +---------+</div>
      <p>Agents communicate via TaskCreate/TaskUpdate. Blocking relationships coordinated. No central orchestrator.</p>

      <h3>6.3 Assembly Line (Sequential Handoff)</h3>
      <div class="ascii-diagram">
+--------+    +--------+    +--------+    +--------+
| Design |---&gt;| Develop|---&gt;|  Test  |---&gt;| Deploy |
+--------+    +--------+    +--------+    +--------+</div>
      <p>Each agent specializes. Output becomes next input. Clear handoff points.</p>

      <h3>6.4 Parallel Ralph with Worktrees</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>for feature in auth payments notifications; do
  git worktree add ../wt-$feature $feature-branch
  (cd ../wt-$feature && ./ralph.sh 20) &
done
wait

# Merge results
for feature in auth payments notifications; do
  git merge wt-$feature
done</code></pre>
      </div>
      <p>True isolation. No file conflicts. Shared git history.</p>
    </section>

    <hr class="section-divider">

    <!-- Feedback Loop Architectures -->
    <section id="feedback-loops">
      <h2><span class="b">7.</span> <span class="b">Fee</span>dback <span class="b">Lo</span>op <span class="b">Arch</span>itectures</h2>

      <h3>7.1 Tight Loop (Within Iteration)</h3>
      <div class="ascii-diagram">
Code Change --> Typecheck --> Fix --> Typecheck --> Pass --> Commit</div>
      <p>Immediate feedback. Same context window. Quick corrections.</p>

      <h3>7.2 Medium Loop (Across Iterations)</h3>
      <div class="ascii-diagram">
Iteration 1: Attempt task --> Fail --> Log to progress.txt
Iteration 2: Read progress.txt --> Try different approach --> Pass</div>
      <p>Fresh context. Learned from history. Pattern recognition.</p>

      <h3>7.3 Loose Loop (Across Sessions)</h3>
      <div class="ascii-diagram">
Session 1: Build foundation --> Checkpoint
Session 2: Continue from checkpoint --> Build features
Session 3: Complete and ship</div>
      <p>Long-running projects. Human checkpoints between. Major milestone reviews.</p>

      <h3>7.4 Self-Critique Loop (Ralph Marketer)</h3>
      <div class="ascii-diagram">
DISCOVER --> LEARN --> RESEARCH --> IDEATE --> WRITE --> CRITIQUE
                                                           |
                                                  "Would founder publish?"
                                                           |
                                                    No --> ITERATE
                                                    Yes --> PUBLISH</div>
      <p>Quality gate before completion. Subjective evaluation. Domain-specific criteria.</p>
    </section>

    <hr class="section-divider">

    <!-- Stop Condition Patterns -->
    <section id="stop-conditions">
      <h2><span class="b">8.</span> <span class="b">Sto</span>p <span class="b">Con</span>dition <span class="b">Pat</span>terns</h2>

      <h3>8.1 Promise Tag</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>if grep -q "&lt;promise&gt;COMPLETE&lt;/promise&gt;" output.txt; then
  break
fi</code></pre>
      </div>

      <h3>8.2 JSON State Check</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>while jq '.tasks[] | select(.passes == false)' prd.json | grep -q .; do
  # continue
done</code></pre>
      </div>

      <h3>8.3 Max Iterations</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>MAX_ITERATIONS=25
while [ $CURRENT_ITERATION -le $MAX_ITERATIONS ]; do
  # work
done</code></pre>
      </div>

      <h3>8.4 Budget Cap</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>if [ $TOTAL_TOKENS -gt $MAX_TOKENS ]; then
  echo "Token budget exceeded"
  exit 1
fi</code></pre>
      </div>

      <h3>8.5 Stuck Detection</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>STUCK_THRESHOLD=3
if [ "$CURRENT_COMMIT" = "$LAST_COMMIT" ]; then
  STUCK_COUNT=$((STUCK_COUNT + 1))
  if [ $STUCK_COUNT -ge $STUCK_THRESHOLD ]; then
    echo "Stuck - intervention needed"
    exit 1
  fi
fi</code></pre>
      </div>

      <h3>8.6 Time-Based</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>START_TIME=$(date +%s)
MAX_SECONDS=3600  # 1 hour

while true; do
  ELAPSED=$(($(date +%s) - START_TIME))
  if [ $ELAPSED -gt $MAX_SECONDS ]; then
    echo "Time limit exceeded"
    break
  fi
  # work
done</code></pre>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Task Sizing Heuristics -->
    <section id="task-sizing">
      <h2><span class="b">9.</span> <span class="b">Ta</span>sk <span class="b">Siz</span>ing <span class="b">Heu</span>ristics</h2>

      <h3>The Golden Rule</h3>
      <blockquote>
        <p>"Each story must be completable in ONE iteration (~one context window)"</p>
      </blockquote>

      <h3>The 2-3 Sentence Test</h3>
      <blockquote>
        <p>"If you can't describe the task in 2-3 sentences, it's too big."</p>
      </blockquote>

      <h3>Right-Sized Tasks</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Size</th><th>Lines of Code</th><th>Files</th><th>Iterations</th><th>Example</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>XS</strong></td><td>1-20</td><td>1</td><td>1</td><td>Add column, fix typo</td></tr>
            <tr><td><strong>S</strong></td><td>20-100</td><td>1-2</td><td>1</td><td>New component, endpoint</td></tr>
            <tr><td><strong>M</strong></td><td>100-300</td><td>2-5</td><td>1-2</td><td>Feature piece, integration</td></tr>
            <tr><td><strong>L</strong></td><td>300-1000</td><td>5-10</td><td>3-5</td><td>Small feature, refactor</td></tr>
            <tr><td><strong>XL</strong></td><td>1000+</td><td>10+</td><td>5+</td><td>Full feature (MUST SPLIT)</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Cognitive Load Factors</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Factor</th><th>Weight</th><th>Example</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Novel patterns</strong></td><td>3x</td><td>First time using a library</td></tr>
            <tr><td><strong>Cross-boundary</strong></td><td>2x</td><td>Frontend + Backend + DB</td></tr>
            <tr><td><strong>Undocumented</strong></td><td>2x</td><td>Legacy code without tests</td></tr>
            <tr><td><strong>State complexity</strong></td><td>2x</td><td>Concurrent operations</td></tr>
            <tr><td><strong>External API</strong></td><td>1.5x</td><td>Third-party service calls</td></tr>
            <tr><td><strong>Standard CRUD</strong></td><td>1x</td><td>Simple data operations</td></tr>
          </tbody>
        </table>
      </div>
      <p><strong>Formula:</strong> <code>Effective Size = Base Size * max(Cognitive Weights)</code></p>

      <h3>Split Triggers</h3>
      <p>Split task if:</p>
      <ul>
        <li><strong>> 40K tokens</strong> estimated for implementation</li>
        <li><strong>> 10 files</strong> need modification</li>
        <li><strong>> 5 test runs</strong> expected</li>
        <li><strong>> 3 MCP tool sequences</strong> required</li>
        <li>Can't describe in 2-3 sentences</li>
      </ul>
    </section>

    <hr class="section-divider">

    <!-- Error Recovery Workflows -->
    <section id="error-recovery">
      <h2><span class="b">10.</span> <span class="b">Err</span>or <span class="b">Rec</span>overy <span class="b">Work</span>flows</h2>

      <h3>10.1 Test Failure Recovery</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>run_with_test_recovery() {
  local test_failures=0

  while [ $test_failures -lt $MAX_TEST_RETRIES ]; do
    claude @prompt.md

    if npm run test 2>&1 | grep -q "passed"; then
      return 0
    else
      test_failures=$((test_failures + 1))
      echo "Test failure $test_failures/$MAX_TEST_RETRIES"
      npm run test 2>&1 | tail -20 >> progress.txt
    fi
  done

  return 1
}</code></pre>
      </div>

      <h3>10.2 Git Rollback Recovery</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Reset to last known good
git log --oneline -10
git reset --hard &lt;good-commit&gt;

# Clear progress
echo "# Resetting from bad state" > progress.txt

# Update PRD
# Manually set passes: false on unfinished items

# Resume
./ralph.sh 10</code></pre>
      </div>

      <h3>10.3 Rollback Decision Tree</h3>
      <ol>
        <li><strong>Test failure after code change?</strong>
          <ul>
            <li>Revert last commit: <code>git reset --hard HEAD~1</code></li>
            <li>Retry same story with fresh context</li>
          </ul>
        </li>
        <li><strong>Multiple failures on same story (3+)?</strong>
          <ul>
            <li>Split story into smaller pieces</li>
            <li>Add notes to progress.txt about blocker</li>
            <li>Move to next unblocked story</li>
          </ul>
        </li>
        <li><strong>Context degradation detected?</strong>
          <ul>
            <li>Save progress to checkpoint</li>
            <li>Kill current session</li>
            <li>Start fresh with checkpoint context</li>
          </ul>
        </li>
        <li><strong>Budget exceeded?</strong>
          <ul>
            <li>Stop loop</li>
            <li>Document incomplete work</li>
            <li>Notify human for review</li>
          </ul>
        </li>
      </ol>
    </section>

    <hr class="section-divider">

    <!-- Cost Optimization Workflows -->
    <section id="cost-optimization">
      <h2><span class="b">11.</span> <span class="b">Co</span>st <span class="b">Opt</span>imization <span class="b">Work</span>flows</h2>

      <h3>Token Usage Per Iteration</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Activity</th><th>Approximate Tokens</th></tr>
          </thead>
          <tbody>
            <tr><td>PRD read</td><td>500-2000</td></tr>
            <tr><td>Progress read</td><td>200-1000</td></tr>
            <tr><td>Task implementation</td><td>2000-10000</td></tr>
            <tr><td>Verification</td><td>500-2000</td></tr>
            <tr><td>Commit/update</td><td>200-500</td></tr>
          </tbody>
        </table>
      </div>
      <p><strong>Per iteration estimate:</strong> 3,000-15,000 tokens</p>

      <h3>Cost Estimates</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Iterations</th><th>Tokens (est.)</th><th>Cost @ $15/M</th></tr>
          </thead>
          <tbody>
            <tr><td>10</td><td>30K-150K</td><td>$0.45-$2.25</td></tr>
            <tr><td>25</td><td>75K-375K</td><td>$1.13-$5.63</td></tr>
            <tr><td>50</td><td>150K-750K</td><td>$2.25-$11.25</td></tr>
            <tr><td>100</td><td>300K-1.5M</td><td>$4.50-$22.50</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Model Stepping Pattern</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>MODELS=("claude-haiku" "claude-sonnet" "claude-opus")
MODEL_INDEX=0

for iteration in {1..50}; do
  CURRENT_MODEL=${MODELS[$MODEL_INDEX]}

  output=$(claude --model $CURRENT_MODEL @prompt.md)

  # Escalate if needed
  if echo "$output" | grep -q "NEED_STRONGER_MODEL"; then
    MODEL_INDEX=$((MODEL_INDEX + 1))
  fi

  # Check completion
  if echo "$output" | grep -q "COMPLETE"; then
    break
  fi
done</code></pre>
      </div>

      <h3>Cost Optimization Strategies</h3>
      <ol>
        <li><strong>Subagents for expensive tools</strong> - Playwright, MCP in subagents</li>
        <li><strong>Compact PRD</strong> - Only active stories</li>
        <li><strong>Prune progress.txt</strong> - Archive old learnings</li>
        <li><strong>Right-size tasks</strong> - Fewer iterations needed</li>
        <li><strong>Set max-iterations</strong> - Prevent runaway</li>
        <li><strong>Model stepping</strong> - Start cheap, escalate if needed</li>
        <li><strong>Off-peak scheduling</strong> - Run overnight</li>
      </ol>
    </section>

    <hr class="section-divider">

    <!-- Hybrid Human-AI Workflows -->
    <section id="hybrid-workflows">
      <h2><span class="b">12.</span> <span class="b">Hyb</span>rid <span class="b">Hum</span>an-<span class="b">AI</span> <span class="b">Work</span>flows</h2>

      <h3>12.1 HOTL Ralph (Human On The Loop)</h3>
      <p>Single-iteration variant with human review:</p>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>#!/bin/bash
# ralph-once.sh

claude "Review plans/prd.json and plans/progress.txt.
  Pick ONE feature marked passes: false.
  Implement it.
  Run tests.
  If passing, mark passes: true and commit.
  Append learnings to progress.txt."

# Human review
echo "=== Changes made ==="
git diff HEAD~1 --stat

read -p "Continue? (y/n) " -n 1 -r
if [[ $REPLY =~ ^[Yy]$ ]]; then
  ./ralph-once.sh
fi</code></pre>
      </div>

      <p><strong>When to Use HOTL:</strong> Security-sensitive code, learning a new codebase, training the PRD format, debugging stuck loops.</p>

      <h3>12.2 Panopticon Pattern (Molly Cantillon)</h3>
      <blockquote>
        <p>"Spawn 5+ parallel Claude sessions"</p>
      </blockquote>
      <p>Human as observer of multiple agents: Start multiple agents on related tasks, monitor progress across all, intervene when needed, merge results at end.</p>

      <h3>12.3 Planning + Execution Separation (Codex)</h3>
      <ul>
        <li><strong>Phase 1: Human-Guided Planning</strong> - Define architecture, set acceptance criteria, create PRD</li>
        <li><strong>Phase 2: Autonomous Execution</strong> - Ralph loops, overnight operation, minimal intervention</li>
        <li><strong>Phase 3: Human Review</strong> - Code review, merge approval, production deployment</li>
      </ul>

      <h3>12.4 Mobile Monitoring Workflow</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>{
  "hooks": {
    "PreToolUse": [{
      "matcher": "AskUserQuestion",
      "hooks": [{
        "type": "command",
        "command": "~/.claude/hooks/notify.sh"
      }]
    }]
  }
}</code></pre>
      </div>
      <p>Agent runs autonomously, human receives push notifications when intervention needed.</p>
    </section>

    <hr class="section-divider">

    <!-- Decision Guide -->
    <section id="decision-guide">
      <h2><span class="b">13.</span> <span class="b">Dec</span>ision <span class="b">Gui</span>de</h2>

      <h3>Workflow Selection Matrix</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Scenario</th><th>Recommended Workflow</th><th>Key Factors</th></tr>
          </thead>
          <tbody>
            <tr><td>Simple bug fix</td><td>Single-shot</td><td>Clear solution, low risk</td></tr>
            <tr><td>Explore codebase</td><td>Interactive</td><td>Discovery, learning</td></tr>
            <tr><td>Well-defined feature</td><td>Ralph loop</td><td>Clear criteria, testable</td></tr>
            <tr><td>Multi-component feature</td><td>PRD phases</td><td>Dependencies, milestones</td></tr>
            <tr><td>Team collaboration</td><td>CC Mirror + TaskCreate</td><td>Coordination, visibility</td></tr>
            <tr><td>Enterprise migration</td><td>Gas Town</td><td>Scale, resources</td></tr>
            <tr><td>Security-sensitive</td><td>HOTL Ralph</td><td>Human review required</td></tr>
            <tr><td>Time-sensitive</td><td>Parallel Ralph</td><td>Speed over efficiency</td></tr>
            <tr><td>Budget-constrained</td><td>Model stepping</td><td>Cost optimization</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Task Type to Workflow Mapping</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Task Type</th><th>Best Workflow</th><th>Why</th></tr>
          </thead>
          <tbody>
            <tr><td>Add single endpoint</td><td>Single-shot</td><td>Simple, isolated</td></tr>
            <tr><td>Implement feature</td><td>Ralph loop</td><td>Multiple steps, testable</td></tr>
            <tr><td>Refactor codebase</td><td>Phased PRD</td><td>Large scope, milestones</td></tr>
            <tr><td>Fix bug</td><td>Interactive</td><td>Investigation needed</td></tr>
            <tr><td>Write documentation</td><td>Single-shot</td><td>Human review anyway</td></tr>
            <tr><td>Database migration</td><td>Careful Ralph</td><td>Reversibility critical</td></tr>
            <tr><td>UI component</td><td>Ralph + Playwright</td><td>Browser verification</td></tr>
            <tr><td>API integration</td><td>HOTL Ralph</td><td>External dependencies</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Verification Method Selection</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Code Type</th><th>Primary Verification</th><th>Secondary</th></tr>
          </thead>
          <tbody>
            <tr><td>Business logic</td><td>Unit tests</td><td>Integration tests</td></tr>
            <tr><td>API endpoints</td><td>Integration tests</td><td>E2E tests</td></tr>
            <tr><td>UI components</td><td>Playwright</td><td>Screenshot comparison</td></tr>
            <tr><td>Database</td><td>Migration status</td><td>Data integrity checks</td></tr>
            <tr><td>Types</td><td>Typecheck</td><td>Lint</td></tr>
            <tr><td>Security</td><td>Manual review</td><td>Automated scans</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Red Flags - When NOT to Use Autonomous Workflows</h3>
      <ol>
        <li><strong>Subjective tasks</strong> - "Make this pretty" has no verifiable completion</li>
        <li><strong>Security-critical code</strong> - Needs human review</li>
        <li><strong>Ambiguous requirements</strong> - "Build something cool" wastes tokens</li>
        <li><strong>One-shot operations</strong> - No loop needed</li>
        <li><strong>Exploratory work</strong> - Use HOTL or interactive</li>
        <li><strong>Design decisions</strong> - Agent implements, humans decide</li>
        <li><strong>Complex debugging</strong> - Often needs human intuition</li>
        <li><strong>Legacy code without tests</strong> - No verification possible</li>
        <li><strong>Third-party API integrations</strong> - Often need manual testing</li>
        <li><strong>Production deployments</strong> - Always review before shipping</li>
      </ol>
    </section>

    <hr class="section-divider">

    <!-- Quick Reference -->
    <section id="quick-reference">
      <h2><span class="b">Qui</span>ck <span class="b">Ref</span>erence</h2>

      <h3>Minimal Ralph Setup</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>project/
+-- plans/
|   +-- ralph.sh         # Loop script
|   +-- prompt.md        # Instructions
|   +-- prd.json         # Tasks
|   +-- progress.txt     # Learnings
+-- CLAUDE.md            # Context</code></pre>
      </div>

      <h3>Essential Bash Script</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>#!/bin/bash
MAX_ITERATIONS=${1:-10}

for (( i=1; i<=$MAX_ITERATIONS; i++ )); do
  echo "Iteration $i / $MAX_ITERATIONS"

  claude "Review plans/prd.json and plans/progress.txt.
    Mark the right PRD items as passes: true.
    Append your progress to progress.txt.
    Make a git commit of that feature.
    Only work on a single feature.
    If PRD is complete, output PROMISE COMPLETE HERE." | tee output.txt

  if grep -q "PROMISE COMPLETE HERE" output.txt; then
    break
  fi
done</code></pre>
      </div>

      <h3>Pre-Flight Checklist</h3>
      <ul>
        <li>Tasks are small enough (2-3 sentence rule)</li>
        <li>Dependencies ordered correctly (schema -> backend -> frontend)</li>
        <li>Acceptance criteria are verifiable</li>
        <li>Tests exist or will be created</li>
        <li>Git branch created</li>
        <li>progress.txt initialized</li>
        <li>Max iterations set</li>
        <li>Verification commands work</li>
      </ul>
    </section>

    <hr class="section-divider">

    <!-- Troubleshooting -->
    <section id="troubleshooting">
      <h2><span class="b">Trou</span>bleshooting</h2>

      <details class="troubleshoot">
        <summary>Agent Marks Task Complete But It's Not Done</summary>
        <div>
          <p><strong>Symptom:</strong> Story marked <code>passes: true</code> but feature doesn't work</p>
          <p><strong>Cause:</strong> Missing verification steps, or acceptance criteria too vague</p>
          <p><strong>Fix:</strong></p>
          <ol>
            <li>Always include <code>npm run typecheck passes</code> in acceptance criteria</li>
            <li>Add specific, testable criteria: "Response contains user email" not "Works correctly"</li>
            <li>Use browser verification for UI tasks</li>
            <li>Add negative criteria: "No console errors"</li>
            <li>If using Playwright, include screenshot step for proof</li>
          </ol>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Loop Gets Stuck on Same Story</summary>
        <div>
          <p><strong>Symptom:</strong> Same story attempted repeatedly across iterations</p>
          <p><strong>Cause:</strong> Tests failing, or criteria impossible to meet</p>
          <p><strong>Fix:</strong></p>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code># 1. Check progress.txt for failure pattern
grep -A3 "STORY-ID" plans/progress.txt

# 2. Verify tests actually work
npm run test -- --grep "story name"

# 3. Check if story is too large (split if needed)
# Good: "Add login button to header"
# Bad: "Build authentication system"

# 4. Add stuck handling to prompt:
# "After 3 failed attempts on same story, add BLOCKED note and move to next"</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Cost Spiraling Out of Control</summary>
        <div>
          <p><strong>Symptom:</strong> Ralph loop consuming much more than expected</p>
          <p><strong>Cause:</strong> Too many iterations, wrong model, or tasks too large</p>
          <p><strong>Fix:</strong></p>
          <ol>
            <li>Set max iterations: <code>./ralph.sh 25</code> (not unlimited)</li>
            <li>Use model stepping: start Haiku, escalate to Sonnet/Opus only if needed</li>
            <li>Right-size tasks (see Task Sizing Heuristics section)</li>
            <li>Use subagents for expensive operations (Playwright, MCP)</li>
            <li>Track costs: <code>claude --print-cost</code> after sessions</li>
          </ol>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Verification Passes But Production Fails</summary>
        <div>
          <p><strong>Symptom:</strong> All tests green, but bug in deployed code</p>
          <p><strong>Cause:</strong> Test coverage gap, or environment differences</p>
          <p><strong>Fix:</strong></p>
          <ol>
            <li>Add integration tests that match production environment</li>
            <li>Include E2E tests for critical paths</li>
            <li>Use property-based testing for edge cases</li>
            <li>Add staging environment verification step</li>
            <li>Include "don't break existing" negative criteria</li>
          </ol>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Human Can't Keep Up with Parallel Agents</summary>
        <div>
          <p><strong>Symptom:</strong> Multiple agents running, human overwhelmed</p>
          <p><strong>Cause:</strong> Too many agents without proper monitoring</p>
          <p><strong>Fix:</strong></p>
          <ol>
            <li>Start with 2-3 agents max (Personal Panopticon recommendation)</li>
            <li>Use push notifications (Pushover/ntfy) for attention-needed events</li>
            <li>Set up Claude HUD or rpai for visibility</li>
            <li>Have agents write progress to shared location</li>
            <li>Schedule review checkpoints, don't try real-time monitoring</li>
          </ol>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Fresh Context Loses Important Information</summary>
        <div>
          <p><strong>Symptom:</strong> New iteration doesn't know critical context from previous</p>
          <p><strong>Cause:</strong> Not capturing learnings in progress.txt or CLAUDE.md</p>
          <p><strong>Fix:</strong></p>
          <ol>
            <li>End each iteration with progress.txt update:
              <ul>
                <li>What was completed (reference story ID)</li>
                <li>What was learned (patterns, gotchas)</li>
                <li>What to do next</li>
              </ul>
            </li>
            <li>Update CLAUDE.md with discovered patterns</li>
            <li>Use meaningful git commit messages</li>
            <li>Include "read progress.txt first" in prompt</li>
          </ol>
        </div>
      </details>
    </section>

    <hr class="section-divider">

    <!-- Summary -->
    <section id="summary">
      <h2><span class="b">Sum</span>mary: The <span class="b">Work</span>flow <span class="b">Phi</span>losophy</h2>

      <blockquote>
        <p>"View AI agents as persistent, file-memory-based loops where AI acts as an autonomous worker, breaking projects into small, verifiable stories that compound over iterations -- emphasizing eventual consistency over perfect first attempts."</p>
      </blockquote>

      <h3>Core Principles</h3>
      <ol>
        <li><strong>Fresh context per iteration</strong> - Avoid context rot</li>
        <li><strong>External memory</strong> - Git, files, PRD for continuity</li>
        <li><strong>Small, verifiable tasks</strong> - Complete in one context window</li>
        <li><strong>Failure as data</strong> - Each failure informs next attempt</li>
        <li><strong>Explicit completion signals</strong> - <code>&lt;promise&gt;COMPLETE&lt;/promise&gt;</code></li>
        <li><strong>Append-only learning</strong> - progress.txt compounds knowledge</li>
        <li><strong>Verification mandatory</strong> - Tests, typecheck, browser automation</li>
      </ol>

      <h3>The Mental Model</h3>
      <p>Ralph is not about making the agent smarter. It's about:</p>
      <ul>
        <li>Working around context limitations</li>
        <li>Leveraging persistence</li>
        <li>Building feedback loops</li>
        <li>Compounding progress</li>
        <li>Accepting imperfection</li>
        <li>Achieving eventual consistency</li>
      </ul>
    </section>

    <hr class="section-divider">

    <!-- Related Pages -->
    <div class="related-pages">
      <h3>Related Pages</h3>
      <ul>
        <li><a href="taxonomy-skills-expanded.html">Skills and Commands Taxonomy</a> - 129+ skills, 57 commands, composition patterns</li>
        <li><a href="taxonomy-tools.html">Tool Integration Taxonomy</a> - Hooks, MCP servers, plugins</li>
        <li><a href="compare-orchestration.html">Orchestration Approaches Compared</a> - Ralph, CC Mirror, Gas Town</li>
      </ul>
    </div>

    <!-- Footer Navigation -->
    <nav class="footer-nav">
      <a href="taxonomy-tools.html" class="nav-prev">
        <span class="nav-direction">Previous</span>
        <span class="nav-title">Tool Integration Taxonomy</span>
      </a>
      <a href="taxonomy-master.html" class="nav-next">
        <span class="nav-direction">Next</span>
        <span class="nav-title">Taxonomy Index</span>
      </a>
    </nav>

  </div>

  <script src="../js/search.js"></script>
  <script src="../js/sidebar.js"></script>
  <script src="../js/global-nav.js"></script>
  <script>
    function copyCode(button) {
      const codeBlock = button.parentElement.querySelector('code');
      navigator.clipboard.writeText(codeBlock.textContent);
      button.textContent = 'Copied!';
      button.classList.add('copied');
      setTimeout(() => {
        button.textContent = 'Copy';
        button.classList.remove('copied');
      }, 2000);
    }
  </script>
</body>
</html>
