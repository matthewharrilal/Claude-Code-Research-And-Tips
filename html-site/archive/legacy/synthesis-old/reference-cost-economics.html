<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta data-pagefind-meta="section" content="Synthesis">
  <meta data-pagefind-meta="category" content="Reference">
  <title>Cost Estimation &amp; Token Economics Reference - Claude Code Knowledge Base</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/sidebar.css">
  <link rel="stylesheet" href="../css/search.css">
</head>
<body>
  <!-- Search Modal -->
  <div class="search-modal" id="searchModal" aria-hidden="true">
    <div class="search-overlay" onclick="closeSearch()"></div>
    <div class="search-content">
      <div class="search-header">
        <div class="search-input-wrapper">
          <span class="search-icon-input">&#128269;</span>
          <input type="text" id="searchInput" placeholder="Search documentation..." autocomplete="off" />
          <kbd class="search-kbd">ESC</kbd>
        </div>
      </div>
      <div class="search-filters">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="synthesis">Synthesis</button>
        <button class="filter-btn" data-filter="extractions">Extractions</button>
      </div>
      <div class="search-results" id="searchResults">
        <div class="search-empty"><p>Start typing to search... (Press Cmd+K anytime)</p></div>
      </div>
      <div class="search-footer">
        <span>Up/Down Navigate</span><span>Enter Select</span><span>ESC Close</span>
      </div>
    </div>
  </div>

  <button class="search-trigger" onclick="openSearch()" aria-label="Search" style="float: right; margin-bottom: 1rem;">
    <span class="search-icon">Cmd+K</span>
    <span class="search-text">Search</span>
  </button>

  <div class="wide-container">
    <!-- Breadcrumb Navigation -->
    <nav class="nav-breadcrumb">
      <a href="../index.html">Home</a>
      <span>/</span>
      <a href="synthesis-index.html">Synthesis</a>
      <span>/</span>
      <span>Reference</span>
      <span>/</span>
      <span>Cost Economics</span>
    </nav>

    <!-- You Are Here Context Box -->
    <div class="you-are-here" style="background: linear-gradient(135deg, #f0ebe3 0%, #fefcf3 100%); border-left: 4px solid #2a7d7d; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
      <h3 style="color: #2a7d7d; margin-top: 0; font-size: 0.9em; text-transform: uppercase; letter-spacing: 0.5px;">You Are Here</h3>
      <p style="margin-bottom: 0;">This is the <strong>complete cost reference</strong> for Claude Code - pricing tables, pattern costs, optimization strategies, and ROI frameworks. Use this when budgeting projects, comparing approaches, or optimizing spend. For context management (which affects cost), see <a href="technical-context-management-advanced.html">Advanced Context Management</a>.</p>
    </div>

    <h1><span style="font-weight: 700;">Cos</span>t Estimation &amp; Token Economics Reference</h1>

    <p class="conversational-lead">
      <span style="font-weight: 700;">From</span> API pricing to pattern cost analysis to organizational ROI frameworks.
    </p>

    <!-- Table of Contents -->
    <div class="toc">
      <div class="toc-title">Contents</div>
      <ul>
        <li><a href="#token-pricing">Token Pricing Tables</a> - Current model costs (January 2026)</li>
        <li><a href="#subscription">Claude Code Subscription Costs</a> - Individual, Team, Enterprise</li>
        <li><a href="#pattern-costs">Pattern Cost Analysis</a> - Ralph loops, multi-agent, Gas Town</li>
        <li><a href="#optimization">Cost Optimization Strategies</a> - Model selection, caching, batching</li>
        <li><a href="#roi">ROI Framework</a> - Measuring productivity gains</li>
        <li><a href="#monitoring">Community Tools &amp; Monitoring</a> - Cost tracking tools</li>
        <li><a href="#troubleshooting">Cost Troubleshooting</a> - Common issues and fixes</li>
        <li><a href="#quick-reference">Quick Reference</a> - Daily cost expectations</li>
      </ul>
    </div>

    <hr class="section-divider divider-context">

    <!-- Token Pricing Section -->
    <section id="token-pricing">
      <h2><span style="font-weight: 700;">Tok</span>en Pricing Tables</h2>

      <h3>Current Model Pricing (January 2026)</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Model</th><th>Input (per 1M)</th><th>Output (per 1M)</th><th>Context Window</th><th>Best For</th></tr>
        </thead>
        <tbody>
          <tr><td><strong>Claude Haiku 4.5</strong></td><td>$1.00</td><td>$5.00</td><td>200K</td><td>Speed, volume, simple tasks</td></tr>
          <tr><td><strong>Claude Haiku 3.5</strong></td><td>$0.80</td><td>$4.00</td><td>200K</td><td>Budget batch processing</td></tr>
          <tr><td><strong>Claude Haiku 3</strong></td><td>$0.25</td><td>$1.25</td><td>200K</td><td>Lowest cost option</td></tr>
          <tr><td><strong>Claude Sonnet 4.5</strong></td><td>$3.00</td><td>$15.00</td><td>200K (1M beta)</td><td>Daily development work</td></tr>
          <tr><td><strong>Claude Sonnet 4</strong></td><td>$3.00</td><td>$15.00</td><td>200K (1M beta)</td><td>General-purpose coding</td></tr>
          <tr><td><strong>Claude Opus 4.5</strong></td><td>$5.00</td><td>$25.00</td><td>200K</td><td>Complex reasoning, critical tasks</td></tr>
          <tr><td><strong>Claude Opus 4.1</strong></td><td>$15.00</td><td>$75.00</td><td>200K</td><td>Legacy (higher cost)</td></tr>
        </tbody>
      </table>

      <div class="callout callout-insight">
        <div class="callout-title">Key Insight</div>
        <p style="margin-bottom: 0;">Opus 4.5 represents a <strong>67% price reduction</strong> from Opus 4.1 ($5/$25 vs $15/$75) while maintaining flagship capabilities.</p>
      </div>

      <h3>Long Context Pricing (1M Token Beta)</h3>
      <p>For Claude Sonnet 4/4.5 with 1M context enabled:</p>
      <table class="comparison-table">
        <thead>
          <tr><th>Context Size</th><th>Input (per 1M)</th><th>Output (per 1M)</th></tr>
        </thead>
        <tbody>
          <tr><td>&le;200K tokens</td><td>$3.00</td><td>$15.00</td></tr>
          <tr><td>&gt;200K tokens</td><td>$6.00</td><td>$22.50</td></tr>
        </tbody>
      </table>
      <p><strong>Note:</strong> Premium pricing applies to entire request when input exceeds 200K.</p>

      <h3>Prompt Caching Pricing</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Cache Operation</th><th>Multiplier</th><th>Opus 4.5</th><th>Sonnet 4.5</th><th>Haiku 4.5</th></tr>
        </thead>
        <tbody>
          <tr><td>Base Input</td><td>1.0x</td><td>$5.00/MTok</td><td>$3.00/MTok</td><td>$1.00/MTok</td></tr>
          <tr><td>5-min Cache Write</td><td>1.25x</td><td>$6.25/MTok</td><td>$3.75/MTok</td><td>$1.25/MTok</td></tr>
          <tr><td>1-hour Cache Write</td><td>2.0x</td><td>$10.00/MTok</td><td>$6.00/MTok</td><td>$2.00/MTok</td></tr>
          <tr><td>Cache Read/Refresh</td><td>0.1x</td><td>$0.50/MTok</td><td>$0.30/MTok</td><td>$0.10/MTok</td></tr>
        </tbody>
      </table>
      <p><strong>Savings Potential:</strong> Up to <strong>90% cost reduction</strong> on cached content.</p>

      <h3>Batch API Pricing (50% Discount)</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Model</th><th>Batch Input (per 1M)</th><th>Batch Output (per 1M)</th></tr>
        </thead>
        <tbody>
          <tr><td>Claude Opus 4.5</td><td>$2.50</td><td>$12.50</td></tr>
          <tr><td>Claude Sonnet 4.5</td><td>$1.50</td><td>$7.50</td></tr>
          <tr><td>Claude Haiku 4.5</td><td>$0.50</td><td>$2.50</td></tr>
          <tr><td>Claude Haiku 3</td><td>$0.125</td><td>$0.625</td></tr>
        </tbody>
      </table>

      <h3>Tool-Specific Token Overhead</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Tool</th><th>Additional Input Tokens</th></tr>
        </thead>
        <tbody>
          <tr><td>Text Editor (Claude 4.x)</td><td>700 tokens</td></tr>
          <tr><td>Bash Tool</td><td>245 tokens</td></tr>
          <tr><td>Tool Use System Prompt</td><td>313-346 tokens</td></tr>
          <tr><td>Computer Use</td><td>735 tokens + screenshots</td></tr>
        </tbody>
      </table>

      <table class="comparison-table">
        <thead>
          <tr><th>Server Tool</th><th>Pricing</th></tr>
        </thead>
        <tbody>
          <tr><td>Web Search</td><td>$10.00 per 1,000 searches</td></tr>
          <tr><td>Web Fetch</td><td>No additional charge (tokens only)</td></tr>
          <tr><td>Code Execution</td><td>$0.05/hour after 1,550 free hours/month</td></tr>
        </tbody>
      </table>
    </section>

    <hr class="section-divider divider-procedure">

    <!-- Subscription Section -->
    <section id="subscription">
      <h2><span style="font-weight: 700;">Cla</span>ude Code Subscription Costs</h2>

      <h3>Individual Plans</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Plan</th><th>Monthly Cost</th><th>Usage vs Pro</th><th>Target User</th></tr>
        </thead>
        <tbody>
          <tr><td><strong>Free</strong></td><td>$0</td><td>Baseline</td><td>Evaluation</td></tr>
          <tr><td><strong>Pro</strong></td><td>$20</td><td>5x Free</td><td>Regular developers</td></tr>
          <tr><td><strong>Max 5x</strong></td><td>$100</td><td>5x Pro (25x Free)</td><td>Power users</td></tr>
          <tr><td><strong>Max 20x</strong></td><td>$200</td><td>20x Pro (100x Free)</td><td>Heavy automation</td></tr>
        </tbody>
      </table>

      <h3>Team &amp; Enterprise</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Plan</th><th>Cost</th><th>Features</th></tr>
        </thead>
        <tbody>
          <tr><td><strong>Team</strong></td><td>$30/user/month</td><td>5-seat minimum, pooled usage</td></tr>
          <tr><td><strong>Enterprise</strong></td><td>Custom</td><td>Custom limits, dedicated support</td></tr>
        </tbody>
      </table>

      <h3>Claude Code Token Allocations (5-Hour Rolling Window)</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Plan</th><th>Approximate Tokens per Window</th></tr>
        </thead>
        <tbody>
          <tr><td>Pro</td><td>~44,000 tokens</td></tr>
          <tr><td>Max 5x</td><td>~88,000 tokens</td></tr>
          <tr><td>Max 20x</td><td>~220,000 tokens</td></tr>
        </tbody>
      </table>

      <h3>API vs Subscription Economics</h3>
      <div class="callout callout-insight">
        <div class="callout-title">Break-Even Analysis</div>
        <ul style="margin-bottom: 0;">
          <li>At $6/day average (Anthropic's reported figure), API costs ~$180/month</li>
          <li>Max 20x ($200/month) becomes economical for heavy users</li>
          <li>Pro ($20/month) sufficient for moderate daily usage</li>
        </ul>
      </div>

      <table class="comparison-table">
        <thead>
          <tr><th>Scenario</th><th>Recommended</th></tr>
        </thead>
        <tbody>
          <tr><td>Occasional use (&lt;$20/month API)</td><td>Pro subscription</td></tr>
          <tr><td>Moderate daily use</td><td>Pro subscription</td></tr>
          <tr><td>Heavy daily use ($100-200+/month API)</td><td>Max 5x/20x</td></tr>
          <tr><td>Multi-agent orchestration</td><td>Max 20x or API</td></tr>
          <tr><td>Predictable high-volume</td><td>Subscription</td></tr>
          <tr><td>Variable/bursty usage</td><td>API pay-per-token</td></tr>
        </tbody>
      </table>

      <!-- Checkpoint -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint: Pricing Fundamentals</div>
        <p><strong>You should now understand:</strong></p>
        <ul>
          <li>Current model pricing (Haiku &lt; Sonnet &lt; Opus)</li>
          <li>Prompt caching savings (up to 90% on cached content)</li>
          <li>Batch API discount (50% off)</li>
          <li>Subscription tiers and when each makes sense</li>
        </ul>
      </div>
    </section>

    <hr class="section-divider divider-procedure">

    <!-- Pattern Costs Section -->
    <section id="pattern-costs">
      <h2><span style="font-weight: 700;">Pat</span>tern Cost Analysis</h2>

      <h3>Single Session Costs</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Session Type</th><th>Token Range</th><th>Cost Range (Sonnet 4.5)</th></tr>
        </thead>
        <tbody>
          <tr><td>Quick question</td><td>1K-5K</td><td>$0.01-$0.08</td></tr>
          <tr><td>Bug fix session</td><td>10K-30K</td><td>$0.15-$0.50</td></tr>
          <tr><td>Feature implementation</td><td>50K-100K</td><td>$0.75-$1.80</td></tr>
          <tr><td>Heavy refactoring</td><td>100K-200K</td><td>$1.80-$3.60</td></tr>
        </tbody>
      </table>

      <div class="callout callout-insight">
        <div class="callout-title">Anthropic's Official Stats</div>
        <ul style="margin-bottom: 0;">
          <li><strong>Average:</strong> $6/developer/day</li>
          <li><strong>90th percentile:</strong> &lt;$12/day</li>
          <li><strong>Team average:</strong> $100-200/developer/month</li>
        </ul>
      </div>

      <h3>Ralph Loop Costs</h3>
      <p>The Ralph Wiggum loop (<code>while :; do cat PROMPT.md | claude-code ; done</code>) burns tokens proportionally to iterations.</p>

      <table class="comparison-table">
        <thead>
          <tr><th>Loop Configuration</th><th>Per Iteration</th><th>10 Iterations</th><th>50 Iterations</th></tr>
        </thead>
        <tbody>
          <tr><td>Small codebase, focused task</td><td>$0.50-$2</td><td>$5-$20</td><td>$25-$100</td></tr>
          <tr><td>Medium codebase, complex task</td><td>$2-$5</td><td>$20-$50</td><td>$100-$250</td></tr>
          <tr><td>Large codebase, autonomous</td><td>$5-$15</td><td>$50-$150</td><td>$250-$750</td></tr>
        </tbody>
      </table>

      <p><strong>Real-World Examples:</strong></p>
      <ul>
        <li>YC hackathon teams: 6+ repos overnight for <strong>$297 total</strong></li>
        <li>Geoffrey Huntley: 3-month loop building programming language - extensive but ROI-positive</li>
        <li>Typical heavy session: 50 iterations on large codebase = <strong>$50-$100+</strong></li>
      </ul>

      <h3>Multi-Agent Orchestration Costs</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Architecture</th><th>Agents</th><th>Per-Session Estimate</th><th>Daily Estimate</th></tr>
        </thead>
        <tbody>
          <tr><td>Basic orchestrator + 2 workers</td><td>3</td><td>$3-$10</td><td>$15-$50</td></tr>
          <tr><td>Task router + specialists</td><td>4-6</td><td>$10-$30</td><td>$50-$150</td></tr>
          <tr><td>Full Gas Town (Mayor, Deacon, Dogs)</td><td>5-10+</td><td>$30-$100</td><td>$150-$500</td></tr>
          <tr><td>Personal Panopticon (8 domains)</td><td>8+</td><td>$20-$80</td><td>$100-$400</td></tr>
        </tbody>
      </table>

      <div class="callout callout-insight">
        <div class="callout-title">Token Savings Techniques</div>
        <ul style="margin-bottom: 0;">
          <li>Multi-agent Ralph loop claims <strong>95% token savings</strong> through efficient coordination</li>
          <li>Claude-Flow reports <strong>32.3% token reduction</strong> through context management</li>
          <li>Programmatic tool calling: <strong>37% reduction</strong> by keeping intermediate results out of context</li>
        </ul>
      </div>

      <h3>Gas Town (Full Scale) Costs</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Component</th><th>Role</th><th>Typical Cost</th></tr>
        </thead>
        <tbody>
          <tr><td>Mayor</td><td>High-level planning</td><td>$5-$15/session</td></tr>
          <tr><td>Deacon</td><td>Quality gates</td><td>$3-$10/check</td></tr>
          <tr><td>Dogs (3-5)</td><td>Parallel execution</td><td>$5-$15 each</td></tr>
          <tr><td>Refinery</td><td>Results integration</td><td>$5-$10/merge</td></tr>
        </tbody>
      </table>
      <p><strong>Estimated Daily Run:</strong> $50-$200 depending on task complexity and parallel workers.</p>
    </section>

    <hr class="section-divider divider-procedure">

    <!-- Optimization Section -->
    <section id="optimization">
      <h2><span style="font-weight: 700;">Cos</span>t Optimization Strategies</h2>

      <h3>1. Model Selection Strategy</h3>
      <blockquote style="border-left: 3px solid #2a7d7d; padding-left: 1rem; margin: 1.5rem 0; font-style: italic; color: #5c4b3a;">
        "Haiku for setup, Sonnet for builds, Opus for reviews"
        <cite style="display: block; margin-top: 0.5rem; font-size: 0.9em;">-- The 60-80% Savings Formula</cite>
      </blockquote>

      <table class="comparison-table">
        <thead>
          <tr><th>Task Type</th><th>Recommended Model</th><th>Cost vs Opus 4.5</th></tr>
        </thead>
        <tbody>
          <tr><td>Code review, linting, docs</td><td>Haiku 4.5</td><td>80% cheaper</td></tr>
          <tr><td>Daily development, debugging</td><td>Sonnet 4.5</td><td>40% cheaper</td></tr>
          <tr><td>Complex refactoring, final review</td><td>Opus 4.5</td><td>Baseline</td></tr>
        </tbody>
      </table>

      <p><strong>Model Limitations:</strong></p>
      <ul>
        <li><strong>Haiku:</strong> Loses track in long sessions, forgets variable names</li>
        <li><strong>Sonnet:</strong> Occasional hallucinations on edge cases</li>
        <li><strong>Opus:</strong> Too slow/expensive for routine tasks</li>
      </ul>

      <h3>2. Context Management</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Context Level</th><th>Action</th></tr>
        </thead>
        <tbody>
          <tr><td>&lt;60%</td><td>Continue normally</td></tr>
          <tr><td>60-80%</td><td>Consider compacting</td></tr>
          <tr><td>80-95%</td><td>Compact or prepare to reset</td></tr>
          <tr><td>&gt;95%</td><td>Auto-compact triggers, consider fresh session</td></tr>
        </tbody>
      </table>

      <h3>3. Prompt Caching Optimization</h3>
      <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
        <pre style="margin: 0; overflow-x: auto;"><code>Cache-Friendly Pattern:

First request:  3,500 tokens x $3.75/M = $0.013 (cache write)
Next 4 requests: 3,500 tokens x $0.30/M = $0.001 each (cache read)
Total: $0.017

Without caching: 5 x 3,500 x $3.00/M = $0.053
Savings: 68%</code></pre>
      </div>

      <p><strong>Best Practices:</strong></p>
      <ul>
        <li>Structure prompts with static content first</li>
        <li>Reuse system prompts across sessions</li>
        <li>Batch similar queries together</li>
        <li>Use 1-hour cache for long-running workflows</li>
      </ul>

      <h3>4. Batch Processing</h3>
      <p>Use Batch API for:</p>
      <ul>
        <li>Large-scale refactoring across many files</li>
        <li>Test generation at scale</li>
        <li>Documentation generation</li>
        <li>Code analysis sweeps</li>
      </ul>
      <p><strong>Savings:</strong> 50% on both input and output tokens.</p>

      <!-- Checkpoint -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint: Cost Optimization</div>
        <p><strong>You should now understand:</strong></p>
        <ul>
          <li>Model selection strategy (Haiku for setup, Sonnet for builds, Opus for reviews)</li>
          <li>Context management impact on costs</li>
          <li>Prompt caching implementation for repeated contexts</li>
          <li>When to use batch processing</li>
        </ul>
      </div>
    </section>

    <hr class="section-divider divider-procedure">

    <!-- ROI Section -->
    <section id="roi">
      <h2><span style="font-weight: 700;">ROI</span> Framework</h2>

      <h3>Individual Developer Gains</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Metric</th><th>Observed Change</th><th>Source</th></tr>
        </thead>
        <tbody>
          <tr><td>Story completion</td><td>+164%</td><td>Faros AI</td></tr>
          <tr><td>PR throughput</td><td>+98%</td><td>Faros AI</td></tr>
          <tr><td>Tasks completed</td><td>+21%</td><td>Research studies</td></tr>
        </tbody>
      </table>

      <h3>The Productivity Paradox</h3>
      <div class="callout callout-warning">
        <div class="callout-title">Critical Finding</div>
        <p>Individual gains don't automatically translate to organizational gains.</p>
        <table class="comparison-table">
          <thead>
            <tr><th>Individual Metric</th><th>Organizational Impact</th></tr>
          </thead>
          <tbody>
            <tr><td>+98% PR throughput</td><td>Review time +91%</td></tr>
            <tr><td>+21% tasks completed</td><td>Delivery velocity "largely unchanged"</td></tr>
            <tr><td>More code produced</td><td>More defects, larger PRs</td></tr>
          </tbody>
        </table>
        <p style="margin-bottom: 0;"><strong>Root Cause:</strong> Bottleneck shifts from production to review.</p>
      </div>

      <h3>ROI Calculation Framework</h3>
      <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
        <pre style="margin: 0; overflow-x: auto;"><code>ROI = (Value of Incremental Output - Total Cost) / Total Cost

Example:
- Team: 50 developers on Max plans
- Annual cost: $200/month x 50 x 12 = $120,000
- PRs merged: 8,400 (vs 5,200 baseline)
- Incremental PRs: 3,200
- Value per PR: $150 (conservative estimate)
- Incremental value: $480,000
- ROI: ($480,000 - $120,000) / $120,000 = 300% (4:1 ratio)</code></pre>
      </div>

      <h3>Timeline Expectations</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Phase</th><th>Duration</th><th>What to Expect</th></tr>
        </thead>
        <tbody>
          <tr><td>Learning curve</td><td>2-4 weeks</td><td>Productivity drop</td></tr>
          <tr><td>Pattern stabilization</td><td>2-3 months</td><td>Patterns emerge</td></tr>
          <tr><td>ROI confidence</td><td>6 months</td><td>Meaningful measurement</td></tr>
        </tbody>
      </table>
      <p><strong>Warning:</strong> Short-term measurements during learning curves produce misleading negative results.</p>
    </section>

    <hr class="section-divider divider-procedure">

    <!-- Monitoring Section -->
    <section id="monitoring">
      <h2><span style="font-weight: 700;">Com</span>munity Tools &amp; Monitoring</h2>

      <h3>Official Tools</h3>
      <p><strong>/cost Command:</strong></p>
      <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
        <pre style="margin: 0; overflow-x: auto;"><code>Total cost:            $0.55
Total duration (API):  6m 19.7s
Total duration (wall): 6h 33m 10.2s
Total code changes:    0 lines added, 0 lines removed</code></pre>
      </div>

      <h3>Community Tools</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Tool</th><th>Features</th></tr>
        </thead>
        <tbody>
          <tr><td><strong>CC Usage</strong> (ccusage.com)</td><td>Daily/monthly reports, 5-hour block monitoring, live dashboards</td></tr>
          <tr><td><strong>Claude Code Usage Monitor</strong></td><td>Token tracking, Playwright MCP monitoring, usage transparency</td></tr>
          <tr><td><strong>LiteLLM</strong></td><td>Open-source spend tracking by key, Bedrock/Vertex support</td></tr>
        </tbody>
      </table>

      <h3>Monitoring Best Practices</h3>
      <ol>
        <li><strong>Track per-session costs</strong> - Use /cost regularly</li>
        <li><strong>Monitor 5-hour windows</strong> - Understand consumption patterns</li>
        <li><strong>Watch cache efficiency</strong> - Target 30:1+ cache read:write ratio</li>
        <li><strong>Set workspace limits</strong> - Prevent surprise overages</li>
        <li><strong>Review weekly trends</strong> - Identify optimization opportunities</li>
      </ol>
    </section>

    <hr class="section-divider divider-warning">

    <!-- Troubleshooting Section -->
    <section id="troubleshooting">
      <h2><span style="font-weight: 700;">Cos</span>t Troubleshooting</h2>

      <details class="troubleshoot" style="border: 1px solid #c97065; border-radius: 8px; margin: 1rem 0;">
        <summary style="background: #fef6f5; padding: 1rem; cursor: pointer; color: #c97065; font-weight: 600;">Unexpected cost spike</summary>
        <div style="padding: 1rem;">
          <p><strong>Symptoms:</strong> Daily cost jumped from $5 to $50+. Budget consumed unexpectedly fast.</p>
          <p><strong>Common Causes:</strong></p>
          <ul>
            <li>Runaway Ralph loop - No iteration limit, ran overnight</li>
            <li>Large file reads - Reading entire codebases into context</li>
            <li>Wrong model selection - Using Opus for simple tasks</li>
            <li>Cache invalidation - Same prompts re-cached repeatedly</li>
          </ul>
          <p><strong>Prevention:</strong></p>
          <ul>
            <li>Set MAX_ITERATIONS on all Ralph loops</li>
            <li>Use /context to monitor usage during sessions</li>
            <li>Set workspace spending limits in Claude Console</li>
            <li>Use Haiku for simple queries, Sonnet for implementation</li>
          </ul>
        </div>
      </details>

      <details class="troubleshoot" style="border: 1px solid #c97065; border-radius: 8px; margin: 1rem 0;">
        <summary style="background: #fef6f5; padding: 1rem; cursor: pointer; color: #c97065; font-weight: 600;">Hit rate limit unexpectedly</summary>
        <div style="padding: 1rem;">
          <p><strong>Symptoms:</strong> "Rate limit exceeded" errors. Session pauses.</p>
          <p><strong>Common Causes:</strong></p>
          <ul>
            <li>Parallel agents without coordination</li>
            <li>Rapid successive requests without delays</li>
            <li>Token burst from large file operations</li>
            <li>Shared API key across team</li>
          </ul>
          <p><strong>Solutions:</strong></p>
          <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
            <pre style="margin: 0;"><code># Add delays in automation scripts
sleep 5  # Between iterations

# Stagger parallel agents
sleep $((RANDOM % 10))

# For teams: Separate API keys per developer</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot" style="border: 1px solid #c97065; border-radius: 8px; margin: 1rem 0;">
        <summary style="background: #fef6f5; padding: 1rem; cursor: pointer; color: #c97065; font-weight: 600;">Cost unpredictable between sessions</summary>
        <div style="padding: 1rem;">
          <p><strong>Symptoms:</strong> Same task costs $0.50 one day, $5.00 the next. No pattern.</p>
          <p><strong>Common Causes:</strong></p>
          <ul>
            <li>Context size variation - Different starting conditions</li>
            <li>Cache efficiency - Cold cache vs warm cache</li>
            <li>Model drift - Claude taking different approaches</li>
            <li>Retry loops - Hidden failures triggering retries</li>
          </ul>
          <p><strong>Tracking:</strong></p>
          <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
            <pre style="margin: 0;"><code># Start each session by checking context
/context

# End each session by checking cost
/cost

# Log both to track correlation
echo "$(date): context=$CONTEXT cost=$COST" >> ~/.claude/cost-log.txt</code></pre>
          </div>
        </div>
      </details>

      <h3>Emergency Cost Control</h3>
      <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; position: relative; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
        <button class="copy-btn" onclick="copyCode(this)" style="position: absolute; top: 0.5rem; right: 0.5rem; background: #2a7d7d; color: white; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer;">Copy</button>
        <pre style="margin: 0; overflow-x: auto;"><code># STOP: Kill all running Claude processes immediately
pkill -f "claude"
ps aux | grep claude  # Verify none running

# ASSESS: Check what got spent (In a new Claude session)
/cost

# PREVENT: For Ralph loops, always use:
MAX_ITERATIONS=10  # Never unlimited

# LIMIT: Set workspace limits in Claude Console
# console.anthropic.com -> Workspaces -> Spending Limits

# RECOVER: If budget blown for the day
# Option 1: Wait for 5-hour window reset
# Option 2: Switch to API with different key
# Option 3: Use Haiku for essential tasks only</code></pre>
      </div>
    </section>

    <hr class="section-divider divider-checkpoint">

    <!-- Quick Reference Section -->
    <section id="quick-reference">
      <h2><span style="font-weight: 700;">Qui</span>ck Reference Card</h2>

      <h3>Daily Cost Expectations</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>User Type</th><th>Daily Cost</th><th>Monthly Cost</th></tr>
        </thead>
        <tbody>
          <tr><td>Light user</td><td>$1-$3</td><td>$20-$60</td></tr>
          <tr><td>Moderate user</td><td>$3-$6</td><td>$60-$120</td></tr>
          <tr><td>Power user</td><td>$6-$12</td><td>$120-$250</td></tr>
          <tr><td>Heavy automation</td><td>$12-$30+</td><td>$250-$600+</td></tr>
        </tbody>
      </table>

      <h3>Cost Per Activity</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Activity</th><th>Typical Cost</th></tr>
        </thead>
        <tbody>
          <tr><td>Quick question</td><td>$0.01-$0.10</td></tr>
          <tr><td>Bug fix</td><td>$0.15-$0.50</td></tr>
          <tr><td>Feature implementation</td><td>$0.75-$2.00</td></tr>
          <tr><td>Ralph loop iteration</td><td>$0.50-$5.00</td></tr>
          <tr><td>Multi-agent session</td><td>$3-$30</td></tr>
        </tbody>
      </table>

      <h3>Optimization Checklist</h3>
      <ul>
        <li>Using appropriate model for task complexity</li>
        <li>Leveraging prompt caching for repeated contexts</li>
        <li>Resetting context before degradation</li>
        <li>Batch processing non-urgent large jobs</li>
        <li>Monitoring with /cost command</li>
        <li>Tracking cache efficiency ratio</li>
      </ul>

      <!-- Milestone -->
      <div class="milestone" style="background: linear-gradient(90deg, #6b9b7a 0%, #2a7d7d 100%); color: white; padding: 1rem 1.5rem; border-radius: 8px; text-align: center; margin: 2rem 0;">
        Optimize costs through model selection, caching, and context management. Track with /cost.
      </div>
    </section>

    <!-- Related Pages -->
    <div class="related-pages" style="margin-top: 2rem; padding: 1rem; background: #f9f6f0; border-radius: 8px;">
      <h4 style="margin-top: 0;">Related Documents</h4>
      <ul>
        <li><a href="technical-context-management-advanced.html">Advanced Context Management</a> - Context affects cost</li>
        <li><a href="compare-cost.html">Cost Comparison</a> - Pattern cost comparisons</li>
        <li><a href="mastery-ralph-complete.html">Ralph Complete</a> - Loop cost optimization</li>
      </ul>
      <h4>Official Resources</h4>
      <ul>
        <li><a href="https://platform.claude.com/docs/en/about-claude/pricing" target="_blank">Anthropic Pricing</a></li>
        <li><a href="https://ccusage.com/" target="_blank">CC Usage (Community Tool)</a></li>
      </ul>
    </div>

    <!-- Footer Navigation -->
    <div class="footer-nav" style="display: flex; justify-content: space-between; margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #e0d5c5;">
      <a href="compare-cost.html">Prev: Cost Comparison</a>
      <a href="technical-context-management-advanced.html">Next: Advanced Context Management</a>
    </div>

  </div>

  <nav class="left-nav" id="leftNav">
    <div class="px-4 mb-4">
      <a href="../index.html" class="text-xs font-semibold text-accent hover:text-accent-light uppercase tracking-wider">Claude Code KB</a>
    </div>
    <div class="nav-content"></div>
  </nav>

  <script src="../js/copy-code.js"></script>
  <script src="../js/search.js"></script>
  <script src="../js/global-nav.js"></script>
  <script>
    function copyCode(button) {
      const codeBlock = button.parentElement.querySelector('code');
      navigator.clipboard.writeText(codeBlock.textContent);
      button.textContent = 'Copied!';
      setTimeout(() => button.textContent = 'Copy', 2000);
    }
  </script>
</body>
</html>
