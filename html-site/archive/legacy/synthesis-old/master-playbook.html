<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta data-pagefind-meta="section" content="Synthesis">
  <meta data-pagefind-meta="category" content="Master">
  <title>Claude Code Master Playbook - Claude Code Knowledge Base</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/sidebar.css">
  <link rel="stylesheet" href="../css/search.css">
</head>
<body>
  <!-- Search Modal -->
  <div class="search-modal" id="searchModal" aria-hidden="true">
    <div class="search-overlay" onclick="closeSearch()"></div>
    <div class="search-content">
      <div class="search-header">
        <div class="search-input-wrapper">
          <span class="search-icon-input">&#128269;</span>
          <input type="text" id="searchInput" placeholder="Search documentation..." autocomplete="off" />
          <kbd class="search-kbd">ESC</kbd>
        </div>
      </div>
      <div class="search-filters">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="synthesis">Synthesis</button>
        <button class="filter-btn" data-filter="extractions">Extractions</button>
      </div>
      <div class="search-results" id="searchResults">
        <div class="search-empty"><p>Start typing to search... (Press Cmd+K anytime)</p></div>
      </div>
      <div class="search-footer">
        <span>Up/Down Navigate</span><span>Enter Select</span><span>ESC Close</span>
      </div>
    </div>
  </div>

  <button class="search-trigger" onclick="openSearch()" aria-label="Search" style="float: right; margin-bottom: 1rem;">
    <span class="search-icon">Cmd+K</span>
    <span class="search-text">Search</span>
  </button>

  <div class="container">
    <!-- Breadcrumb Navigation -->
    <nav class="nav-breadcrumb">
      <a href="../index.html">Home</a>
      <span>/</span>
      <a href="synthesis-index.html">Synthesis</a>
      <span>/</span>
      <a href="mastery-master.html">Master</a>
      <span>/</span>
      <span>Master Playbook</span>
    </nav>

    <!-- You Are Here Context Box -->
    <div class="you-are-here" style="background: linear-gradient(135deg, #f0ebe3 0%, #fefcf3 100%); border-left: 4px solid #2a7d7d; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
      <h3 style="color: #2a7d7d; margin-top: 0; font-size: 0.9em; text-transform: uppercase; letter-spacing: 0.5px;">You Are Here</h3>
      <p style="margin-bottom: 0;">This is the <strong>master entry point</strong> for learning Claude Code orchestration. If you're overwhelmed by options, context problems, or don't know which pattern to use - start here. This playbook provides the complete progression from single sessions (Level 0) to factory-scale autonomous development (Level 7), with clear milestones at each stage.</p>
    </div>

    <h1><span class="bionic">Cla</span>ude <span class="bionic">Cod</span>e <span class="bionic">Mas</span>ter <span class="bionic">Pla</span>ybook</h1>

    <p class="conversational-lead">
      The <span class="bionic">Com</span>plete <span class="bionic">Gui</span>de to Orchestration, Context Management, and Agent Engineering. From single sessions to factory-scale autonomous development.
    </p>

    <!-- Table of Contents -->
    <div class="toc">
      <div class="toc-title">Contents</div>
      <ul>
        <li><a href="#who-this-is-for">Who This Playbook Is For</a></li>
        <li><a href="#part-1-foundations">Part 1: Foundations</a>
          <ul>
            <li><a href="#core-principles">The Eight Core Principles</a></li>
            <li><a href="#primitives">Building Blocks: The Primitives</a></li>
            <li><a href="#anti-patterns">What Fails &amp; Why: Anti-Patterns</a></li>
            <li><a href="#decision-framework">Decision Framework</a></li>
          </ul>
        </li>
        <li><a href="#part-2-progression">Part 2: Your Capability Progression</a>
          <ul>
            <li><a href="#level-0">Level 0: Where You Are Now</a></li>
            <li><a href="#level-1">Level 1: First Quick Wins</a></li>
            <li><a href="#level-2">Level 2: Specialization</a></li>
            <li><a href="#level-3">Level 3: Autonomy</a></li>
            <li><a href="#level-4">Level 4: Reliability</a></li>
            <li><a href="#level-5">Level 5: Parallelism</a></li>
            <li><a href="#level-6">Level 6: True Parallelization</a></li>
            <li><a href="#level-7">Level 7: Factory Scale</a></li>
          </ul>
        </li>
        <li><a href="#part-3-mastery">Part 3: Deep Pattern Mastery</a></li>
        <li><a href="#part-4-transformations">Part 4: Transformations</a></li>
        <li><a href="#part-5-combinations">Part 5: Pattern Combinations</a></li>
        <li><a href="#part-6-architectures">Part 6: Complete Architectures</a></li>
        <li><a href="#part-7-reference">Part 7: Reference</a></li>
        <li><a href="#troubleshooting">Troubleshooting</a></li>
      </ul>
    </div>

    <hr class="section-divider">

    <!-- Who This Is For -->
    <section id="who-this-is-for">
      <h2><span class="bionic">Who</span> This <span class="bionic">Pla</span>ybook Is For</h2>

      <h3>Your Current State</h3>
      <ul>
        <li>Single long sessions with subagents that overflow context</li>
        <li>Context degrades mid-task, sessions die, progress lost</li>
        <li>Token costs spiraling</li>
        <li>Overwhelmed by options, unclear on which patterns to use when</li>
      </ul>

      <h3>What You'll Learn</h3>
      <ul>
        <li>WHY each pattern works (not just HOW)</li>
        <li>Judgment to choose between approaches</li>
        <li>How to manage context while maintaining full depth</li>
        <li>Concrete implementations with user journeys</li>
        <li>How patterns combine for compounding value</li>
      </ul>

      <h3>How To Read This</h3>
      <ol>
        <li><strong>Start with Part 1</strong> - Understand the foundations everything builds on</li>
        <li><strong>Part 2 shows your progression</strong> - Level 0 to Level 7, with clear milestones</li>
        <li><strong>Parts 3-5 go deep</strong> - Master specific patterns and combinations</li>
        <li><strong>Parts 6-7 are reference</strong> - Return to when you need decisions or lookups</li>
      </ol>
    </section>

    <hr class="section-divider">

    <!-- Part 1: Foundations -->
    <section id="part-1-foundations">
      <h2><span class="bionic">Par</span>t 1: <span class="bionic">Fou</span>ndations</h2>
      <p><em>Everything builds on these principles. Understand them first.</em></p>

      <div id="core-principles">
        <h3>The <span class="bionic">Eig</span>ht <span class="bionic">Cor</span>e <span class="bionic">Pri</span>nciples</h3>
        <p>These principles underlie EVERY successful pattern in this playbook. When you understand WHY these are true, you can derive any pattern yourself.</p>

        <h4>Principle 1: Context Is The Primary Constraint</h4>
        <p><strong>The Reality:</strong></p>
        <ul>
          <li>Claude's context window is finite (~200K tokens)</li>
          <li>Quality degrades as context fills (observable at 60-70%)</li>
          <li>Long sessions accumulate noise, contradictions, and cruft</li>
          <li>Token costs scale linearly with context size</li>
        </ul>
        <p><strong>What This Means:</strong> Every pattern in this playbook ultimately optimizes around context limits. This is THE constraint that shapes everything.</p>

        <h4>Principle 2: External State &gt; Internal Memory</h4>
        <p><strong>The Problem:</strong> Claude's "memory" lives only in the context window. When the session ends, everything is lost.</p>
        <p><strong>The Solution:</strong> Store state in files (prd.json, progress.txt, AGENTS.md), in git (commits as memory), and in external tools (Claude-Mem, databases).</p>
        <p><strong>Why It Works:</strong> External state survives session death, can be read by fresh agents, and doesn't consume context tokens when not needed.</p>

        <h4>Principle 3: Fresh Context &gt; Extended Sessions</h4>
        <p><strong>The Problem:</strong> Long sessions degrade in quality. Context becomes polluted with false starts, corrections, tangents. No mechanism to "forget" irrelevant information.</p>
        <p><strong>The Math:</strong></p>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code>Quality of 20 five-minute sessions > Quality of one 100-minute session</code></pre>
        </div>

        <h4>Principle 4: Orchestrator/Worker Separation</h4>
        <blockquote>
          <p><strong>The Iron Law:</strong> Orchestrators coordinate. Workers execute. Never mix.</p>
        </blockquote>
        <div class="table-responsive">
          <table>
            <thead>
              <tr><th>Role</th><th>Does</th><th>Does NOT</th></tr>
            </thead>
            <tbody>
              <tr><td>Orchestrator</td><td>Creates tasks, monitors progress, makes decisions</td><td>Write code, run commands</td></tr>
              <tr><td>Worker</td><td>Receives tasks, executes fully, reports results</td><td>Spawn workers, create tasks</td></tr>
            </tbody>
          </table>
        </div>

        <h4>Principle 5: Atomic, Verifiable Tasks</h4>
        <p><strong>The Problem:</strong> "Build the auth system" is too big for one context window. "Make it work better" can't be verified.</p>
        <p><strong>Good Task:</strong></p>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code>{
  "title": "Add email validation to login form",
  "acceptanceCriteria": [
    "Validates email format with Zod",
    "Shows error message on invalid email",
    "npm run typecheck passes"
  ]
}</code></pre>
        </div>

        <h4>Principle 6: Quality Gates Before Commit</h4>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code>npm run typecheck &amp;&amp;
npm run test &amp;&amp;
npm run lint &amp;&amp;
git commit</code></pre>
        </div>
        <p><strong>Why This Matters:</strong> Broken code compounds (one bug becomes many). Early failures save rework. Passing tests give confidence for next iteration.</p>

        <h4>Principle 7: Isolation For Parallel Work</h4>
        <p><strong>The Problem:</strong> Multiple agents editing the same files = merge conflicts. Shared state = race conditions. Context pollution across domains.</p>
        <p><strong>The Solution:</strong> Git worktrees for file isolation, separate branches per feature, domain-specific Claude instances (Panopticon pattern).</p>

        <h4>Principle 8: Explicit Communication Channels</h4>
        <p><strong>The Problem:</strong> Agents can't read minds. Assumptions lead to wrong work. "I thought you meant..." wastes iterations.</p>
        <p><strong>The Solution:</strong> Progress files agents can read, structured task definitions (JSON), clear acceptance criteria, hooks for notifications.</p>

        <!-- Checkpoint -->
        <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
          <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint: Core Principles</div>
          <p><strong>You should now understand:</strong></p>
          <ul>
            <li>Why context is THE primary constraint (Principle 1)</li>
            <li>Why external state beats internal memory (Principle 2)</li>
            <li>Why fresh context beats extended sessions (Principle 3)</li>
            <li>The Iron Law of orchestrator/worker separation (Principle 4)</li>
            <li>Why atomic, verifiable tasks matter (Principles 5-6)</li>
          </ul>
          <p><strong>If unclear:</strong> Re-read Principles 1-4 above, or see <a href="architecture-complexity-ladder.html">architecture-complexity-ladder.html</a> for visual diagrams.</p>
        </div>
      </div>

      <div id="primitives">
        <h3><span class="bionic">Bui</span>lding <span class="bionic">Blo</span>cks: The <span class="bionic">Pri</span>mitives</h3>
        <p>Patterns are built from these atomic components. Understand the primitives to understand any pattern.</p>

        <h4>Loop Primitives</h4>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code># Bash While Loop
while [ condition ]; do
  # agent iteration
done

# For Loop with Counter
for i in $(seq 1 $MAX_ITERATIONS); do
  # iteration $i
done

# Stop Condition Check
if echo "$OUTPUT" | grep -q "&lt;promise&gt;COMPLETE&lt;/promise&gt;"; then
  exit 0
fi</code></pre>
        </div>

        <h4>State Primitives</h4>
        <div class="table-responsive">
          <table>
            <thead>
              <tr><th>Primitive</th><th>Format</th><th>Purpose</th></tr>
            </thead>
            <tbody>
              <tr><td>prd.json</td><td>JSON</td><td>Machine-readable task tracking</td></tr>
              <tr><td>progress.txt</td><td>Markdown</td><td>Append-only session memory</td></tr>
              <tr><td>AGENTS.md</td><td>Markdown</td><td>Permanent documentation for future agents</td></tr>
              <tr><td>Git</td><td>Commits</td><td>History, checkpoints, rollback</td></tr>
            </tbody>
          </table>
        </div>

        <h4>Hook Primitives</h4>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code>{
  "hooks": {
    "PreToolUse": [{ "matcher": "Edit", "hooks": [{"type": "command", "command": "..."}] }],
    "PostToolUse": [{ "matcher": "Edit", "hooks": [{"type": "command", "command": "prettier --write $FILE"}] }]
  }
}</code></pre>
        </div>

        <h4>Communication Primitives</h4>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code># Push Notification (poke/ntfy)
curl -d "Claude needs input" ntfy.sh/your-topic</code></pre>
        </div>
      </div>

      <div id="anti-patterns">
        <h3>What <span class="bionic">Fai</span>ls &amp; Why: <span class="bionic">Ant</span>i-Patterns</h3>

        <div class="table-responsive">
          <table>
            <thead>
              <tr><th>Anti-Pattern</th><th>What It Is</th><th>Why It Fails</th><th>The Fix</th></tr>
            </thead>
            <tbody>
              <tr><td>Context Rot</td><td>Single long sessions</td><td>Quality degrades over time, Claude "forgets"</td><td>Fresh context + external state</td></tr>
              <tr><td>Orchestrators That Code</td><td>Orchestrator implements</td><td>Context fills, loses big-picture view</td><td>Iron Law separation</td></tr>
              <tr><td>Workers Spawning Workers</td><td>Recursive sub-agents</td><td>Infinite recursion risk, loss of control</td><td>Only orchestrator spawns</td></tr>
              <tr><td>Missing Verification</td><td>No checking before done</td><td>Broken code compounds</td><td>Quality gates always</td></tr>
              <tr><td>Vague Tasks</td><td>"Make it better"</td><td>Can't verify success, agent guesses</td><td>Explicit acceptance criteria</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div id="decision-framework">
        <h3><span class="bionic">Dec</span>ision <span class="bionic">Fra</span>mework</h3>

        <h4>Should I Autonomize This Task?</h4>
        <div class="ascii-diagram">
Is task well-defined with clear acceptance criteria?
|-- No --> Stay interactive, clarify requirements first
+-- Yes --> Can it be completed in one context window?
            |-- Yes --> Single Ralph iteration
            +-- No --> Break into smaller tasks, then Ralph
        </div>

        <h4>Which Architecture?</h4>
        <div class="ascii-diagram">
How many parallel features?
|-- 1 feature --> Ralph Loop
|-- 2-3 features --> Parallel Ralph + Worktrees
|-- 3-8 agents --> CC Mirror
+-- 10+ agents --> Gas Town Factory
        </div>

        <h4>Which Model For This Task?</h4>
        <div class="table-responsive">
          <table>
            <thead>
              <tr><th>Task Type</th><th>Recommended Model</th><th>Why</th></tr>
            </thead>
            <tbody>
              <tr><td>Complex reasoning</td><td>Opus</td><td>Highest capability</td></tr>
              <tr><td>Standard coding</td><td>Sonnet</td><td>Good balance</td></tr>
              <tr><td>Lookups, formatting</td><td>Haiku</td><td>Fast and cheap</td></tr>
              <tr><td>Initial exploration</td><td>Sonnet</td><td>Balance of speed and insight</td></tr>
              <tr><td>Final review</td><td>Opus</td><td>Catch subtle issues</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Part 2: Capability Progression -->
    <section id="part-2-progression">
      <h2><span class="bionic">Par</span>t 2: Your <span class="bionic">Cap</span>ability <span class="bionic">Pro</span>gression</h2>
      <p><em>Your journey from single sessions to factory-scale development.</em></p>

      <div id="level-0">
        <h3><span class="bionic">Lev</span>el 0: <span class="bionic">Whe</span>re You Are Now</h3>
        <ul>
          <li>All work happens in one continuous conversation</li>
          <li>Manual approval for every operation</li>
          <li>Context degrades after 60% fill</li>
          <li>90 minutes leads to session death or burnout</li>
        </ul>

        <h4>What's Actually Happening</h4>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code>Token Flow:
Start: 0 tokens
|-- You explain project: +2,000 tokens
|-- Claude responds: +1,500 tokens
|-- You request feature: +500 tokens
|-- Claude implements: +3,000 tokens
|-- You approve: +200 tokens
|-- Claude updates: +2,000 tokens
...
+-- At 60%: Quality starts dropping
+-- At 80%: Visible degradation
+-- At 95%: Session unusable</code></pre>
        </div>

        <h4>Concrete Example: Building Auth</h4>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code>11:00 PM - Start session, explain project
11:15 PM - Ask for login form, approve changes
11:30 PM - Ask for validation, approve
11:45 PM - Context at 55%, Claude getting confused
12:00 AM - Ask for server action, Claude repeats earlier mistakes
12:15 AM - Context at 75%, quality noticeably worse
12:30 AM - Give up, feature incomplete

Result: 90 minutes invested, feature not done, frustrated.</code></pre>
        </div>
      </div>

      <div id="level-1">
        <h3><span class="bionic">Lev</span>el 1: <span class="bionic">Fir</span>st <span class="bionic">Qui</span>ck Wins (Week 1)</h3>
        <p><strong>What You Add:</strong> CLAUDE.md + 3-5 slash commands</p>

        <h4>The Transformation</h4>
        <p><strong>Before:</strong></p>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code>"I need you to review this code. We're using Next.js 14 with
TypeScript, server actions, Prisma ORM, and Tailwind. The
architecture follows..."
[5 minutes of context every session]</code></pre>
        </div>
        <p><strong>After:</strong></p>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code>/review
[Claude already knows your stack from CLAUDE.md]</code></pre>
        </div>

        <h4>Create CLAUDE.md in project root</h4>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code># MyProject

## Tech Stack
- Next.js 14 (App Router)
- TypeScript (strict mode)
- Prisma + PostgreSQL
- Tailwind CSS
- Server Actions (no API routes)

## Code Standards
- Functional components only
- Zod for all validation
- Never use `any` type
- Error boundaries for all routes

## Testing
- Vitest for unit tests
- Playwright for E2E
- npm run typecheck must pass</code></pre>
        </div>

        <p><strong>What You Gain:</strong> ~20% token savings per session (no re-explaining), consistency, speed.</p>
        <p><strong>Time Investment:</strong> 30-45 minutes initial setup. Break-even: 3-4 sessions.</p>
      </div>

      <div id="level-2">
        <h3><span class="bionic">Lev</span>el 2: <span class="bionic">Spe</span>cialization (Week 2)</h3>
        <p><strong>What You Add:</strong> Subagents + Hooks</p>
        <p><strong>Before:</strong> One Claude doing everything, context polluted with unrelated work.</p>
        <p><strong>After:</strong> Specialized agents with clean, focused contexts: Security reviewer (reads, doesn't write), Test writer (focused on tests), Performance auditor (analyzes only).</p>

        <h4>Create Specialized Agent</h4>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code># .claude/agents/security-reviewer.yaml
name: security-reviewer
description: Security vulnerability scanner
instructions: |
  You are a security expert. Review code for:
  - Hardcoded secrets
  - SQL injection vectors
  - XSS vulnerabilities
  - Auth bypass risks
  Report findings, never modify code.</code></pre>
        </div>

        <h4>Add Auto-Formatting Hook (~/.claude/settings.json)</h4>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code>{
  "hooks": {
    "PostToolUse": [{
      "matcher": "Edit",
      "hooks": [{
        "type": "command",
        "command": "prettier --write \"$FILE\""
      }]
    }]
  }
}</code></pre>
        </div>

        <p><strong>What You Gain:</strong> Isolated contexts (each agent stays focused), automation, quality.</p>
        <p><strong>Time Investment:</strong> 2-4 hours setup. Create 3-4 agents to start.</p>
      </div>

      <div id="level-3">
        <h3><span class="bionic">Lev</span>el 3: <span class="bionic">Aut</span>onomy (Week 3-4)</h3>
        <p><strong>What You Add:</strong> Ralph Loop + External memory</p>
        <p><strong>Before:</strong> You babysit Claude for 90 minutes.</p>
        <p><strong>After:</strong></p>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code>./ralph.sh 25  # Run up to 25 iterations
# Go to sleep
# Wake up to completed feature</code></pre>
        </div>

        <h4>ralph.sh</h4>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code>#!/bin/bash
MAX_ITERATIONS=${1:-25}
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" &amp;&amp; pwd)"

for i in $(seq 1 $MAX_ITERATIONS); do
  echo "=== Iteration $i ==="

  OUTPUT=$(cat "$SCRIPT_DIR/prompt.md" | claude --dangerously-skip-permissions 2&gt;&amp;1)

  if echo "$OUTPUT" | grep -q "&lt;promise&gt;COMPLETE&lt;/promise&gt;"; then
    echo "All tasks complete!"
    exit 0
  fi

  sleep 2
done

echo "Max iterations reached"</code></pre>
        </div>

        <h4>prompt.md</h4>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code># Ralph Agent

1. Read scripts/ralph/prd.json for tasks
2. Read scripts/ralph/progress.txt for learnings
3. Pick highest priority task where passes: false
4. Implement that ONE task
5. Run: npm run typecheck &amp;&amp; npm run test
6. If passing: commit, mark passes: true
7. Append learnings to progress.txt

When ALL tasks pass: &lt;promise&gt;COMPLETE&lt;/promise&gt;</code></pre>
        </div>

        <p><strong>What You Gain:</strong> Human time 90 min to 10 min (setup only). Fresh context every iteration. Continuity via progress.txt. Sleep shipping.</p>
        <p><strong>Time Investment:</strong> 1-2 hours first setup. 15-20 minutes per feature (PRD writing).</p>
      </div>

      <div id="level-4">
        <h3><span class="bionic">Lev</span>el 4: <span class="bionic">Rel</span>iability (Month 1)</h3>
        <p><strong>What You Add:</strong> Explicit acceptance criteria, progress tracking, learning accumulation</p>
        <p><strong>Before:</strong> Ralph runs, you hope it worked.</p>
        <p><strong>After:</strong></p>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code>Story 1: PASS (commit: abc123)
Story 2: PASS (commit: def456)
Story 3: FAIL - typecheck error at auth.ts:42
Story 4: PENDING (blocked by Story 3)</code></pre>
        </div>

        <h4>Enhanced prd.json</h4>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code>{
  "project": "UserAuth",
  "branchName": "feat/auth",
  "userStories": [
    {
      "id": "US-001",
      "title": "Add users table",
      "acceptanceCriteria": [
        "users table exists with id, email, password_hash",
        "id is primary key auto-increment",
        "Migrations are idempotent (IF NOT EXISTS)",
        "npm run typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    }
  ]
}</code></pre>
        </div>
        <p><strong>What You Gain:</strong> Success rate 60% to 95%. Debugging clarity. Compounding knowledge.</p>
      </div>

      <div id="level-5">
        <h3><span class="bionic">Lev</span>el 5: <span class="bionic">Par</span>allelism (Month 2)</h3>
        <p><strong>What You Add:</strong> CC Mirror + Multiple workers + Model tiering</p>

        <div class="ascii-diagram">
Before (Sequential):
Task 1 --> Task 2 --> Task 3 --> Task 4
[60 minutes total]

After (Parallel):
Task 1 --+
Task 2 --+--> [20 minutes total]
Task 3 --+
Task 4 (depends on 1-3) --> [+5 minutes]
        </div>

        <h4>Task Creation</h4>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code>TaskCreate(
  subject: "Implement user registration",
  description: "Create POST /api/auth/register",
  acceptanceCriteria: [
    "Validates email format",
    "Hashes password with bcrypt",
    "Returns 201 on success"
  ],
  model: "Sonnet"
)</code></pre>
        </div>
        <p><strong>What You Gain:</strong> 2-3x faster (parallel execution). Cost optimization (Haiku for lookups, Sonnet for coding). Specialization.</p>
      </div>

      <div id="level-6">
        <h3><span class="bionic">Lev</span>el 6: <span class="bionic">Tru</span>e <span class="bionic">Par</span>allelization (Month 3)</h3>
        <p><strong>What You Add:</strong> Git worktrees + Parallel Ralph loops</p>
        <p><strong>Before:</strong> 3 features sequentially = 3 hours</p>
        <p><strong>After:</strong> 3 features in parallel worktrees = 1 hour</p>

        <h4>spawn-parallel.sh</h4>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code>#!/bin/bash
FEATURES=("auth" "payments" "notifications")

for feature in "${FEATURES[@]}"; do
  git worktree add ../wt-$feature $feature-branch
  (
    cd ../wt-$feature
    ./scripts/ralph/ralph.sh 20
  ) &amp;
done

wait
echo "All features complete!"</code></pre>
        </div>
        <p><strong>What You Gain:</strong> True 3-5x speedup (no conflicts during work). Sleep shipping at scale. Isolation.</p>
      </div>

      <div id="level-7">
        <h3><span class="bionic">Lev</span>el 7: <span class="bionic">Fac</span>tory <span class="bionic">Sca</span>le (Month 6+)</h3>
        <p><strong>What You Add:</strong> Persistent workers, self-improving systems, automatic decomposition</p>

        <h4>The Gas Town Architecture</h4>
        <div class="ascii-diagram">
Gas Town Factory
|-- HQ (Management)
|   |-- Mayor (coordination)
|   |-- Deacon (monitoring)
|   +-- Dogs (quality gates)
|-- Refinery (auto-decomposition)
+-- Rigs (projects)
    |-- Witness (observer)
    |-- Polecats (persistent workers)
    +-- Crew (ephemeral workers)
        </div>

        <p><strong>What You Gain:</strong> Team equivalent: 3-5 mid-level developers. 24/7 operation. Self-improvement.</p>
        <p><strong>Prerequisites:</strong> 100+ hours multi-agent experience, $50-200/day budget tolerance, comfort with emergence and chaos.</p>
      </div>

      <!-- Progression Summary Table -->
      <h3>Progression Summary</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Level</th><th>Pattern</th><th>Human Time</th><th>Token Efficiency</th><th>Capability</th></tr>
          </thead>
          <tbody>
            <tr><td>0</td><td>Single Session</td><td>90 min</td><td>Low</td><td>Basic</td></tr>
            <tr><td>1</td><td>CLAUDE.md</td><td>60 min</td><td>+20%</td><td>Consistent</td></tr>
            <tr><td>2</td><td>Subagents</td><td>45 min</td><td>+30%</td><td>Specialized</td></tr>
            <tr><td>3</td><td>Ralph</td><td>10 min</td><td>+50%</td><td>Autonomous</td></tr>
            <tr><td>4</td><td>PRD-driven</td><td>20 min</td><td>+60%</td><td>Reliable</td></tr>
            <tr><td>5</td><td>CC Mirror</td><td>30 min</td><td>+40%</td><td>Parallel</td></tr>
            <tr><td>6</td><td>Worktrees</td><td>15 min</td><td>+70%</td><td>Scaled</td></tr>
            <tr><td>7</td><td>Gas Town</td><td>Minimal</td><td>Variable</td><td>Factory</td></tr>
          </tbody>
        </table>
      </div>

      <!-- Checkpoint -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint: Your Progression Level</div>
        <p><strong>Identify your current level:</strong></p>
        <ul>
          <li>Level 0-1: You manually babysit sessions, re-explain context each time</li>
          <li>Level 2-3: You use CLAUDE.md and have tried subagents or basic loops</li>
          <li>Level 4-5: You use PRDs with verification, experimenting with multi-agent</li>
          <li>Level 6-7: You run parallel worktrees, considering factory-scale</li>
        </ul>
        <p><strong>Your next step:</strong> Focus on the level JUST above where you are now. Don't skip levels.</p>
        <p><strong>If unclear:</strong> See <a href="architecture-complexity-ladder.html">architecture-complexity-ladder.html</a> for detailed level descriptions.</p>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Part 3: Deep Pattern Mastery -->
    <section id="part-3-mastery">
      <h2><span class="bionic">Par</span>t 3: <span class="bionic">Dee</span>p <span class="bionic">Pat</span>tern <span class="bionic">Mas</span>tery</h2>
      <p><em>Go deep on the patterns that matter most.</em></p>

      <h3>Context Management: The Invisible Constraint</h3>
      <blockquote>
        <p>"Context rot: LLMs get stupider with more tokens"</p>
      </blockquote>

      <h4>The Degradation Curve</h4>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Context Level</th><th>Quality Impact</th></tr>
          </thead>
          <tbody>
            <tr><td>0-50%</td><td>Full capability</td></tr>
            <tr><td>50-70%</td><td>Slight degradation possible</td></tr>
            <tr><td>70-85%</td><td>Noticeable quality loss</td></tr>
            <tr><td>85-95%</td><td>Significant degradation</td></tr>
            <tr><td>95%+</td><td>Failure mode</td></tr>
          </tbody>
        </table>
      </div>

      <h4>Strategy 1: Fresh Context Per Iteration</h4>
      <div class="ascii-diagram">
+-------------------------------------------------------------+
|  Iteration 1 (fresh Claude instance)                        |
|  --> Read state from files (PRD, progress, git)             |
|  --> Pick highest priority incomplete task                  |
|  --> Implement + verify                                     |
|  --> Commit if passing                                      |
|  --> Exit                                                   |
+-------------------------------------------------------------+
              | (no memory carried forward)
+-------------------------------------------------------------+
|  Iteration 2 (fresh Claude instance)                        |
|  --> Read state from files (now updated)                    |
|  --> Repeat...                                              |
+-------------------------------------------------------------+
      </div>

      <h4>Context Budget Quick Reference</h4>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>Total Effective: ~100K tokens
|-- System prompt + CLAUDE.md:   ~5K (5%)
|-- Codebase context:            ~20K (20%)
|-- Current task:                ~2K (2%)
|-- Working memory:              ~30K (30%)
|-- Tool outputs:                ~20K (20%)
|-- Code generation:             ~15K (15%)
+-- Buffer for retries:          ~8K (8%)</code></pre>
      </div>

      <h3>The Ralph Loop: Complete Implementation</h3>
      <blockquote>
        <p>"Think of the AI agent as an <strong>eager but somewhat dim junior developer (Ralph)</strong> who never sleeps, happily works on one tiny task at a time, commits often, and tells you when it is truly finished."</p>
      </blockquote>

      <h4>The Mental Model</h4>
      <p>At its absolute core:</p>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>while :; do cat PROMPT.md | claude ; done</code></pre>
      </div>

      <h4>Task Sizing: The Most Critical Factor</h4>
      <blockquote>
        <p>"If you can't describe it in 2-3 sentences, it's too big."</p>
      </blockquote>
      <p><strong>Right-sized tasks:</strong></p>
      <ul>
        <li>Add a database column + migration</li>
        <li>Add a UI component to an existing page</li>
        <li>Write tests for one module</li>
        <li>Implement one API endpoint</li>
      </ul>
      <p><strong>Too big (split these):</strong></p>
      <ul>
        <li>"Build the entire dashboard"</li>
        <li>"Add authentication"</li>
        <li>"Create e-commerce flow"</li>
      </ul>

      <h4>Terminal Output: Successful Ralph Run</h4>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>$ ./ralph.sh 25
=== Iteration 1 ===
Reading prd.json...
Task: US-001 - Create login form
Running typecheck... PASS
Running tests... PASS
Committing: feat(auth): Add login form component
=== Iteration 2 ===
Reading prd.json...
Task: US-002 - Add Zod validation
Running typecheck... PASS
Running tests... PASS
Committing: feat(auth): Add Zod email validation
=== Iteration 3 ===
Reading prd.json...
All tasks complete!
&lt;promise&gt;COMPLETE&lt;/promise&gt;
Done!
$</code></pre>
      </div>

      <h4>Ralph Variants</h4>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Variant</th><th>Purpose</th><th>When to Use</th></tr>
          </thead>
          <tbody>
            <tr><td>Basic Ralph</td><td>Standard loop</td><td>Normal features</td></tr>
            <tr><td>AFK Ralph</td><td>Overnight autonomous</td><td>Sleep shipping</td></tr>
            <tr><td>HOTL Ralph</td><td>Human review between</td><td>Security-sensitive</td></tr>
            <tr><td>Compounding Ralph</td><td>Archives past runs</td><td>Long-term projects</td></tr>
            <tr><td>Parallel Ralph</td><td>Git worktrees</td><td>Multi-feature overnight</td></tr>
          </tbody>
        </table>
      </div>

      <!-- Checkpoint -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint: Ralph Pattern Mastery</div>
        <p><strong>You should now understand:</strong></p>
        <ul>
          <li>The core Ralph loop (<code>while :; do cat PROMPT.md | claude ; done</code>)</li>
          <li>Why fresh context per iteration beats long sessions</li>
          <li>How prd.json, progress.txt, and prompt.md work together</li>
          <li>The 2-3 sentence rule for task sizing</li>
          <li>Which Ralph variant to use for which situation</li>
        </ul>
        <p><strong>If unclear:</strong> See mastery-ralph-complete.html for deep dive.</p>
      </div>

      <h3>Multi-Agent Architecture</h3>
      <h4>The Iron Law of Worker Separation</h4>
      <div class="ascii-diagram">
+=====================================================+
|  ORCHESTRATORS COORDINATE. WORKERS EXECUTE.         |
|  NEVER MIX.                                         |
+=====================================================+
      </div>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Role</th><th>What They Do</th><th>What They DON'T Do</th></tr>
          </thead>
          <tbody>
            <tr><td>Orchestrator</td><td>Decompose tasks, assign workers</td><td>Write code, run commands</td></tr>
            <tr><td>Workers</td><td>Execute specific tasks</td><td>Spawn sub-agents, create tasks</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Domain Isolation: The Panopticon Pattern</h3>
      <p>Running Claude Code as a <strong>swarm of parallel isolated instances</strong>, each owning a distinct life domain.</p>

      <h4>The 8 Parallel Domains</h4>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>~/nox        # Company/product
~/metrics    # Analytics/data
~/email      # Communications
~/growth     # Marketing
~/trades     # Personal finance
~/health     # Fitness/wellness
~/writing    # Content creation
~/personal   # Life admin</code></pre>
      </div>

      <h4>Why Domain Isolation Matters</h4>
      <ol>
        <li><strong>Context Pollution Prevention</strong> - Each domain maintains focused context</li>
        <li><strong>Specialized Optimization</strong> - Different tools, schedules, models per domain</li>
        <li><strong>Security Boundaries</strong> - Credentials don't leak between domains</li>
        <li><strong>Parallel Execution</strong> - All domains run simultaneously</li>
      </ol>
    </section>

    <hr class="section-divider">

    <!-- Part 4: Transformations -->
    <section id="part-4-transformations">
      <h2><span class="bionic">Par</span>t 4: <span class="bionic">Tra</span>nsformations (Before/After)</h2>
      <p><em>See the same task done both ways to understand the value.</em></p>

      <h3>Single Session to Efficient Orchestration</h3>
      <p><strong>The Task:</strong> Build User Authentication Feature - Login form, Zod validation, server action with bcrypt, database integration, tests.</p>

      <h4>BEFORE: Single Session with Naive Subagents</h4>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>Token Cost: ~62,000 tokens ($4-8)
Result: Incomplete, buggy feature
Human Time: 90 minutes active</code></pre>
      </div>

      <h4>AFTER: Ralph Pattern</h4>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>./ralph.sh 25  # Run at 11 PM, go to sleep

Result:
- 7 iterations, 7 clean commits
- Each iteration: fresh context (0%)
- Token cost: ~27,000 tokens ($2-3)
- Human time: 5 minutes setup
- Feature: Complete, tested</code></pre>
      </div>

      <h4>Side-by-Side Comparison</h4>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Aspect</th><th>Before</th><th>After</th></tr>
          </thead>
          <tbody>
            <tr><td>Human Time</td><td>90 min</td><td>5 min</td></tr>
            <tr><td>Tokens</td><td>62,000</td><td>27,000</td></tr>
            <tr><td>Cost</td><td>$4-8</td><td>$2-3</td></tr>
            <tr><td>Context Health</td><td>85%+ (degraded)</td><td>Fresh each iteration</td></tr>
            <tr><td>Result</td><td>Incomplete</td><td>Complete</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Manual Context to Filesystem State</h3>
      <p><strong>Before:</strong> Re-explaining context every session.</p>
      <p><strong>After:</strong> State in files, sessions read automatically. Knowledge compounds. You never repeat the same mistake twice.</p>

      <h3>Generalist Agent to Specialized Swarm</h3>
      <p><strong>Before:</strong> One agent doing everything. DB schema + API + React + tests = 85% context, quality drops.</p>
      <p><strong>After:</strong> Specialized workers with fresh contexts. Quality per domain. Parallel execution. 50-70% cost reduction.</p>
    </section>

    <hr class="section-divider">

    <!-- Part 5: Pattern Combinations -->
    <section id="part-5-combinations">
      <h2><span class="bionic">Par</span>t 5: <span class="bionic">Pat</span>tern <span class="bionic">Com</span>binations</h2>
      <p><em>How patterns work together for compounding value.</em></p>

      <h3>Essential Pairwise Combinations</h3>

      <h4>Ralph + Hooks (Multiplicative)</h4>
      <p>Push notifications during AFK runs. Auto-format on every edit.</p>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>{
  "hooks": {
    "PostToolUse": [{
      "matcher": "Edit",
      "hooks": [{"type": "command", "command": "prettier --write $FILE"}]
    }],
    "PreToolUse": [{
      "matcher": "AskUserQuestion",
      "hooks": [{"type": "command", "command": "~/.claude/hooks/notify.sh"}]
    }]
  }
}</code></pre>
      </div>
      <p><strong>ROI:</strong> 15 min setup. Never miss a blocking question again.</p>

      <h4>Subagents + Git Worktrees (Multiplicative)</h4>
      <p>True parallel development with no merge conflicts.</p>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>git worktree add ../auth-agent feature/auth
git worktree add ../payments-agent feature/payments

(cd ../auth-agent &amp;&amp; claude "Implement auth...") &amp;
(cd ../payments-agent &amp;&amp; claude "Implement payments...") &amp;
wait</code></pre>
      </div>
      <p><strong>This fixes your subagent problem:</strong> Each agent gets fresh context, not inherited pollution.</p>

      <h4>progress.txt + AGENTS.md (Compounding)</h4>
      <p>Short-term memory (progress.txt) + Long-term memory (AGENTS.md).</p>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>Session 1: Learns bcrypt needs 12 rounds --> progress.txt
Session 5: Distills to AGENTS.md --> "Auth: bcrypt 12 rounds"
Session 50: Agent reads AGENTS.md --> Uses 12 rounds automatically</code></pre>
      </div>

      <h3>Triple Stacks: The Production Multi-Agent Stack</h3>
      <p><strong>Components:</strong> CC Mirror + Git Worktrees + Hooks</p>
      <div class="ascii-diagram">
Orchestrator (Opus)
|-- Backend Worker (Sonnet) --> ../worktrees/backend/
|   +-- Hooks: format, notify
|-- Frontend Worker (Sonnet) --> ../worktrees/frontend/
|   +-- Hooks: format, lint
+-- Test Worker (Haiku) --> ../worktrees/tests/
    +-- Hooks: run tests
      </div>

      <h3>Anti-Pattern Combinations (What NOT to Do)</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Pattern A</th><th>Pattern B</th><th>Why It Fails</th></tr>
          </thead>
          <tbody>
            <tr><td>Naive Subagents</td><td>Large Context</td><td>Inherited pollution</td></tr>
            <tr><td>CC Mirror</td><td>Gas Town</td><td>Competing orchestrators</td></tr>
            <tr><td>Ralph</td><td>No Verification</td><td>Infinite broken loops</td></tr>
            <tr><td>Opus</td><td>Everything</td><td>Budget explosion</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Implementation Priority</h3>
      <p><strong>Week 1 (Stop the Bleeding):</strong></p>
      <ol>
        <li>Create prd.json template (15 min)</li>
        <li>Set up ralph.sh (30 min)</li>
        <li>Add formatting hooks (15 min)</li>
      </ol>
      <p><strong>Week 2 (Context Discipline):</strong></p>
      <ol>
        <li>Create progress.txt pattern (10 min)</li>
        <li>Create AGENTS.md (20 min)</li>
        <li>Replace subagents with worktrees (1 hr)</li>
      </ol>
      <p><strong>Week 3 (Orchestration):</strong></p>
      <ol>
        <li>Add CC Mirror (2 hrs)</li>
        <li>Implement tiered model selection (30 min)</li>
      </ol>
      <p><strong>Result:</strong> 50-70% cost reduction. Better quality. Ship while sleeping.</p>
    </section>

    <hr class="section-divider">

    <!-- Part 6: Complete Architectures -->
    <section id="part-6-architectures">
      <h2><span class="bionic">Par</span>t 6: <span class="bionic">Com</span>plete <span class="bionic">Arc</span>hitectures</h2>
      <p><em>Visual representations and narrative workflows.</em></p>

      <h3>A Day With Ralph: The Overnight Shipping Story</h3>

      <h4>The Setup (6:47 PM, Wednesday)</h4>
      <p>You've been staring at the Jira board for three weeks. The authentication feature keeps slipping. Tonight, that changes.</p>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>cd ~/projects/saas-app
git checkout -b feature/auth-flow
./scripts/ralph/ralph.sh 25 2&gt;&amp;1 | tee ralph.log &amp;</code></pre>
      </div>
      <p>The loop begins. You grab your jacket and leave.</p>

      <h4>The Night (Automatic)</h4>
      <ul>
        <li><strong>Iteration 1 (6:52 PM):</strong> Fresh Claude instance. Reads prd.json. Implements US-001 (User model). Commits.</li>
        <li><strong>Iteration 2 (7:08 PM):</strong> Fresh context. Reads progress.txt learnings. Implements US-002 (login endpoint). Commits.</li>
        <li><strong>Iteration 3-5:</strong> Database, form component, tests. Each fresh. Each committed.</li>
        <li><strong>Iteration 6:</strong> All stories pass. Outputs <code>&lt;promise&gt;COMPLETE&lt;/promise&gt;</code>. Loop exits.</li>
      </ul>

      <h4>The Morning After (7:15 AM, Thursday)</h4>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>git log --oneline feature/auth-flow

a3f2c1d feat(auth): Add protected route middleware
8b4e5f2 feat(auth): Add login form
c7d9a0b feat(auth): Add registration
4e6f8c1 feat(auth): Add login endpoint
9a1b2c3 feat(auth): Add User model</code></pre>
      </div>
      <p>Five clean commits. CI green. You run the app. It works.</p>
      <p><strong>Three weeks of Jira tickets - shipped while you slept.</strong></p>

      <h3>Feature Development: The Complete Journey</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Phase</th><th>Mode</th><th>Duration</th><th>Human Role</th></tr>
          </thead>
          <tbody>
            <tr><td>Discovery</td><td>Interactive</td><td>30-60 min</td><td>Thinking partner</td></tr>
            <tr><td>Planning</td><td>Collaborative</td><td>30-60 min</td><td>PRD author</td></tr>
            <tr><td>Preparation</td><td>Manual</td><td>15 min</td><td>Setup</td></tr>
            <tr><td>Execution</td><td>Autonomous</td><td>4-8 hrs</td><td>Sleeping</td></tr>
            <tr><td>Verification</td><td>Review</td><td>30-60 min</td><td>Quality gate</td></tr>
            <tr><td>Integration</td><td>Git workflow</td><td>Varies</td><td>Process</td></tr>
          </tbody>
        </table>
      </div>
      <p><strong>Total human time:</strong> 2-3 hours. <strong>Feature shipped:</strong> Overnight.</p>

      <h3>Pattern Dependency Graph</h3>
      <div class="ascii-diagram">
CLAUDE.md -------------------------------------------+
    |                                               |
    |--> Slash Commands --+                         |
    |--> Hooks -----------+---> Ralph Loop ---------+
    +--> Skills ----------+        |                |
                                   v                |
                    +---------------------+         |
                    |  progress.txt       |         |
                    |  prd.json           |         |
                    +---------------------+         |
                                   |                |
                                   v                |
                    +---------------------+         |
                    |  Multi-Agent        |&lt;--------+
                    |  (CC Mirror)        |
                    +---------------------+
      </div>

      <h3>Orchestrator/Worker Separation</h3>
      <div class="ascii-diagram">
+-----------------------------------------------------+
|  ORCHESTRATOR              WORKERS                   |
|  -----------               -------                   |
|  TaskCreate               Read, Write, Edit          |
|  TaskUpdate      ====>    Bash, Glob, Grep          |
|  TaskGet         Delegates                          |
|  Read (1-2 files)&lt;===     Reports results           |
|                                                      |
|  "CONDUCTOR"              "MUSICIANS"                |
|  Never codes              Execute only               |
+-----------------------------------------------------+
|  THE IRON LAW: Workers NEVER spawn or create tasks  |
+-----------------------------------------------------+
      </div>
    </section>

    <hr class="section-divider">

    <!-- Part 7: Reference -->
    <section id="part-7-reference">
      <h2><span class="bionic">Par</span>t 7: <span class="bionic">Ref</span>erence</h2>
      <p><em>Quick lookups and decision support.</em></p>

      <h3>Pattern Vocabulary</h3>
      <h4>Loop Constructs</h4>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Term</th><th>Definition</th></tr>
          </thead>
          <tbody>
            <tr><td>while-loop</td><td>Indefinite iteration until signal</td></tr>
            <tr><td>for-loop</td><td>Bounded iteration with max</td></tr>
            <tr><td>fresh-context</td><td>Zero accumulated context</td></tr>
            <tr><td>stop-condition</td><td><code>&lt;promise&gt;COMPLETE&lt;/promise&gt;</code></td></tr>
          </tbody>
        </table>
      </div>

      <h4>State Containers</h4>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Term</th><th>Location</th><th>Purpose</th></tr>
          </thead>
          <tbody>
            <tr><td>progress.txt</td><td>scripts/ralph/</td><td>Session learnings</td></tr>
            <tr><td>prd.json</td><td>scripts/ralph/</td><td>Task tracking</td></tr>
            <tr><td>AGENTS.md</td><td>Project root</td><td>Permanent learnings</td></tr>
            <tr><td>CLAUDE.md</td><td>Project root</td><td>Project context</td></tr>
          </tbody>
        </table>
      </div>

      <h4>Agent Types</h4>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Term</th><th>Role</th></tr>
          </thead>
          <tbody>
            <tr><td>orchestrator</td><td>Coordinates, never executes</td></tr>
            <tr><td>worker</td><td>Executes, never coordinates</td></tr>
            <tr><td>polecat</td><td>Persistent named worker (Gas Town)</td></tr>
            <tr><td>crew</td><td>Ephemeral worker (Gas Town)</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Decision Trees</h3>
      <h4>Which Pattern?</h4>
      <div class="ascii-diagram">
Is this a single, simple task?
|--YES--> Single interactive session
+--NO--> Can you walk away (AFK)?
    |--NO--> CC Mirror (multi-agent)
    +--YES--> Can you write clear acceptance criteria?
         |--NO--> NOT READY (refine first)
         +--YES--> Need parallelism?
              |--NO--> Ralph loop
              +--YES--> Parallel Ralph + Worktrees
      </div>

      <h4>Which Model?</h4>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Task</th><th>Model</th></tr>
          </thead>
          <tbody>
            <tr><td>Lookups, formatting</td><td>Haiku</td></tr>
            <tr><td>Implementation</td><td>Sonnet</td></tr>
            <tr><td>Architecture, reasoning</td><td>Opus</td></tr>
            <tr><td>Security-critical</td><td>Opus</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Essential prd.json Template</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>{
  "project": "Name",
  "branchName": "feature/xxx",
  "userStories": [
    {
      "id": "US-001",
      "title": "Task (2-3 sentences)",
      "acceptanceCriteria": ["Verifiable condition", "npm run typecheck passes"],
      "priority": 1,
      "passes": false
    }
  ]
}</code></pre>
      </div>

      <h3>Essential ralph.sh</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>#!/bin/bash
MAX_ITERATIONS="${1:-25}"
for (( i=1; i&lt;=$MAX_ITERATIONS; i++ )); do
    OUTPUT=$(cat prompt.md | claude --dangerously-skip-permissions)
    if echo "$OUTPUT" | grep -q "&lt;promise&gt;COMPLETE&lt;/promise&gt;"; then
        exit 0
    fi
done</code></pre>
      </div>

      <h3>Before Going Autonomous Checklist</h3>
      <ul>
        <li>Tasks are atomic (2-3 sentences)</li>
        <li>Dependencies ordered by priority</li>
        <li>Acceptance criteria verifiable</li>
        <li>Every story includes <code>npm run typecheck passes</code></li>
        <li>Git branch created</li>
        <li>progress.txt initialized</li>
        <li>Max iterations set</li>
      </ul>
      <p><strong>If any missing: Stay interactive until ready.</strong></p>

      <h3>The Iron Law (Always Remember)</h3>
      <div class="ascii-diagram">
+=============================================================+
|                     THE IRON LAW                             |
+=============================================================+
|  An agent that ORCHESTRATES must NEVER directly EXECUTE.    |
|  An agent that EXECUTES must NEVER directly ORCHESTRATE.    |
+=============================================================+
      </div>
    </section>

    <hr class="section-divider">

    <!-- Troubleshooting -->
    <section id="troubleshooting">
      <h2><span class="bionic">Tro</span>ubleshooting</h2>

      <details class="troubleshoot">
        <summary>Ralph Loop Stuck (Same Commit Repeated)</summary>
        <div>
          <p><strong>Symptom:</strong> Loop runs but same task repeats, no progress, iteration counter increases without new commits.</p>
          <p><strong>Cause:</strong> Usually one of:</p>
          <ol>
            <li>Task acceptance criteria can't be met</li>
            <li>prd.json not being updated after pass</li>
            <li>Prompt doesn't instruct to mark <code>passes: true</code></li>
          </ol>
          <p><strong>Fix:</strong></p>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code># Check the prd.json - is passes still false after commits?
cat scripts/ralph/prd.json | jq '.userStories[] | {id, passes}'

# Check progress.txt - is it growing?
wc -l scripts/ralph/progress.txt

# If stuck, manually mark the task as passed and restart</code></pre>
          </div>
          <p><strong>Terminal output when stuck:</strong></p>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code>=== Iteration 5 ===
Task: US-001 - Create login form   # &lt;-- Same task as iteration 4!
Running typecheck... PASS
Running tests... PASS
Committing: feat(auth): Add login form component  # Duplicate commit
=== Iteration 6 ===
Task: US-001 - Create login form   # &lt;-- Still stuck!</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Context Degradation Mid-Session</summary>
        <div>
          <p><strong>Symptom:</strong> Claude "forgets" earlier decisions, contradicts itself, quality drops noticeably.</p>
          <p><strong>Cause:</strong> Context window filling (usually 60-70%+ usage). Long sessions accumulate noise.</p>
          <p><strong>Fix:</strong></p>
          <ol>
            <li>Check context usage: Look for "context" warnings in Claude's output</li>
            <li>Use <code>/clear</code> to reset context in interactive sessions</li>
            <li>Switch to Ralph pattern (fresh context per iteration)</li>
            <li>Move learnings to external files (progress.txt, CLAUDE.md)</li>
          </ol>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Subagent Inherits Polluted Context</summary>
        <div>
          <p><strong>Symptom:</strong> Subagent starts confused, makes errors based on earlier (irrelevant) context.</p>
          <p><strong>Cause:</strong> Default subagent spawning inherits parent context.</p>
          <p><strong>Fix:</strong> Use git worktrees for true isolation:</p>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code># Create isolated worktree for subagent work
git worktree add ../feature-worktree feature-branch

# Run subagent in isolated directory
cd ../feature-worktree &amp;&amp; claude "Your task..."</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Tests Pass Locally but Agent Claims Failure</summary>
        <div>
          <p><strong>Symptom:</strong> You run <code>npm test</code> manually and it passes, but Ralph marks task as failed.</p>
          <p><strong>Cause:</strong> Usually environment differences - agent runs in different working directory or missing env vars.</p>
          <p><strong>Fix:</strong></p>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code># Check working directory in ralph.sh
echo "Running from: $(pwd)"

# Ensure npm commands run from project root
cd "$SCRIPT_DIR/../.." &amp;&amp; npm run typecheck</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Progress.txt Gets Overwritten (Learnings Lost)</summary>
        <div>
          <p><strong>Symptom:</strong> progress.txt has same content each iteration, historical learnings missing.</p>
          <p><strong>Cause:</strong> Prompt says "write" instead of "append" to progress.txt.</p>
          <p><strong>Fix:</strong> Use explicit language in prompt.md:</p>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code>APPEND to progress.txt (NEVER overwrite or replace existing content):
## [Date] - [Task ID]
- What was implemented
- What was learned</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Runaway Costs ($47,000 Problem)</summary>
        <div>
          <p><strong>Symptom:</strong> Agent keeps running, costs escalating, no completion in sight.</p>
          <p><strong>Cause:</strong> Missing iteration limits, recursive loops, or missing stop conditions.</p>
          <p><strong>Fix:</strong></p>
          <ol>
            <li>Always set MAX_ITERATIONS in ralph.sh</li>
            <li>Add cost monitoring hooks</li>
            <li>Set up ntfy/push notifications for long runs</li>
          </ol>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code># Add cost cap check to ralph.sh
if [ "$COST" -gt "$MAX_COST" ]; then
    echo "Cost cap exceeded!"
    curl -d "Ralph cost cap exceeded: $COST" ntfy.sh/your-topic
    exit 1
fi</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Multi-Agent Coordination Failures</summary>
        <div>
          <p><strong>Symptom:</strong> Orchestrator and workers get out of sync, tasks done twice or not at all.</p>
          <p><strong>Cause:</strong> Unclear task ownership, missing status updates, no single source of truth.</p>
          <p><strong>Fix:</strong></p>
          <ol>
            <li>Use centralized task tracking (prd.json or Beads)</li>
            <li>Orchestrator owns all task state changes</li>
            <li>Workers report completion, don't mark their own tasks done</li>
          </ol>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code>Architecture check:
Orchestrator: Creates tasks, updates status
Workers: Execute tasks, REPORT results (don't update prd.json)</code></pre>
          </div>
        </div>
      </details>
    </section>

    <hr class="section-divider">

    <!-- Related Pages -->
    <div class="related-pages">
      <h3>Related Documents</h3>
      <ul>
        <li><a href="judgment-guide.html">Judgment Guide</a> - Decision support for selecting patterns</li>
        <li><a href="staff-engineer-mental-model.html">Staff Engineer Mental Model</a> - Frontier thinking for advanced practitioners</li>
        <li><a href="architecture-complexity-ladder.html">Complexity Ladder</a> - Visual level progression</li>
        <li><a href="principles-core.html">Core Principles</a> - The 8 principles in depth</li>
      </ul>
    </div>

    <!-- Footer Navigation -->
    <nav class="footer-nav">
      <span></span>
      <a href="judgment-guide.html" class="nav-next">
        <span class="nav-direction">Next</span>
        <span class="nav-title">Judgment Guide</span>
      </a>
    </nav>

    <!-- Tags -->
    <div style="margin-top: 2rem;">
      <span class="tag">#master-playbook</span>
      <span class="tag">#orchestration</span>
      <span class="tag">#ralph-loop</span>
      <span class="tag">#context-management</span>
      <span class="tag">#multi-agent</span>
      <span class="tag">#complexity-ladder</span>
      <span class="tag">#gas-town</span>
      <span class="tag">#cc-mirror</span>
    </div>
  </div>

  <script src="../js/copy-code.js"></script>
  <script src="../js/search.js"></script>
<script src="../js/global-nav.js"></script>
</body>
</html>
