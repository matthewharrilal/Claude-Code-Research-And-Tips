<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta data-pagefind-meta="section" content="Synthesis">
  <meta data-pagefind-meta="category" content="Taxonomy">
  <title>Agent Architecture Taxonomy - Claude Code Knowledge Base</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/sidebar.css">
  <link rel="stylesheet" href="../css/search.css">
</head>
<body>
  <!-- Search Modal -->
  <div class="search-modal" id="searchModal" aria-hidden="true">
    <div class="search-overlay" onclick="closeSearch()"></div>
    <div class="search-content">
      <div class="search-header">
        <div class="search-input-wrapper">
          <span class="search-icon-input">&#128269;</span>
          <input type="text" id="searchInput" placeholder="Search documentation..." autocomplete="off" />
          <kbd class="search-kbd">ESC</kbd>
        </div>
      </div>
      <div class="search-filters">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="synthesis">Synthesis</button>
        <button class="filter-btn" data-filter="extractions">Extractions</button>
      </div>
      <div class="search-results" id="searchResults">
        <div class="search-empty"><p>Start typing to search... (Press Cmd+K anytime)</p></div>
      </div>
      <div class="search-footer">
        <span>Up/Down Navigate</span><span>Enter Select</span><span>ESC Close</span>
      </div>
    </div>
  </div>

  <nav class="left-nav" id="leftNav">
    <div class="px-4 mb-4">
      <a href="../index.html" class="text-xs font-semibold text-accent hover:text-accent-light uppercase tracking-wider">Claude Code KB</a>
    </div>
    <div class="nav-content"></div>
  </nav>

  <button class="search-trigger" onclick="openSearch()" aria-label="Search" style="float: right; margin-bottom: 1rem;">
    <span class="search-icon">Cmd+K</span>
    <span class="search-text">Search</span>
  </button>

  <div class="container">
    <!-- Breadcrumb Navigation -->
    <nav class="nav-breadcrumb">
      <a href="../index.html">Home</a>
      <span>/</span>
      <a href="synthesis-index.html">Synthesis</a>
      <span>/</span>
      <a href="taxonomy-master.html">Taxonomy</a>
      <span>/</span>
      <span>Architecture Taxonomy</span>
    </nav>

    <!-- Deprecation Notice -->
    <div class="callout callout-warning" style="background: #fff9e6; border-left: 4px solid #c49052; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
      <div class="callout-title" style="color: #c49052; font-weight: 600;">Deprecated (2026-01-18)</div>
      <p>This content has been superseded by D-FINAL synthesis.</p>
      <p><strong>Replacement:</strong> See D-FINAL-architecture Sections 1-2 for current content.</p>
      <p><strong>Reason:</strong> Content fully covered in D-FINAL with production validation.</p>
      <p>Original preserved below for reference.</p>
    </div>

    <!-- You Are Here Context Box -->
    <div class="you-are-here" style="background: linear-gradient(135deg, #f0ebe3 0%, #fefcf3 100%); border-left: 4px solid #2a7d7d; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
      <h3 style="color: #2a7d7d; margin-top: 0; font-size: 0.9em; text-transform: uppercase; letter-spacing: 0.5px;">You Are Here</h3>
      <p style="margin-bottom: 0;">This is the <strong>architecture reference</strong> for agent patterns. If you're deciding how to structure your Claude Code setup (single agent, multi-agent, hub-and-spoke, factory), this document classifies every known architecture with comparison matrices.</p>
    </div>

    <h1><span class="bionic">Age</span>nt <span class="bionic">Arc</span>hitecture <span class="bionic">Tax</span>onomy</h1>

    <p class="conversational-lead">
      A <span class="bionic">com</span>prehensive classification of agent patterns for Claude Code and AI-assisted development. From 15+ primary extractions covering community innovations, production implementations, and Anthropic guidance.
    </p>

    <!-- Table of Contents -->
    <div class="toc">
      <div class="toc-title">Contents</div>
      <ul>
        <li><a href="#single-agent-patterns">1. Single Agent Patterns</a></li>
        <li><a href="#multi-agent-patterns">2. Multi-Agent Patterns</a></li>
        <li><a href="#orchestrator-worker-separation">3. Orchestrator/Worker Separation</a></li>
        <li><a href="#swarm-architectures">4. Swarm Architectures</a></li>
        <li><a href="#hierarchical-structures">5. Hierarchical Structures</a></li>
        <li><a href="#architecture-comparison-matrix">6. Architecture Comparison Matrix</a></li>
        <li><a href="#iron-law">7. The Iron Law of Worker Separation</a></li>
        <li><a href="#communication-patterns">8. Communication Patterns</a></li>
        <li><a href="#isolation-strategies">9. Isolation Strategies</a></li>
        <li><a href="#production-deployment">10. Production Deployment Patterns</a></li>
        <li><a href="#troubleshooting">Troubleshooting</a></li>
      </ul>
    </div>

    <hr class="section-divider">

    <!-- Section 1: Single Agent Patterns -->
    <section id="single-agent-patterns">
      <h2>1. <span class="bionic">Sin</span>gle <span class="bionic">Age</span>nt <span class="bionic">Pat</span>terns</h2>

      <h3>1.1 Interactive Session Pattern</h3>
      <p>The baseline pattern - human interacts with a single Claude Code instance in a conversational loop.</p>

      <div class="ascii-diagram">
Human &lt;---&gt; Claude Code &lt;---&gt; Codebase
              |
              +---&gt; Tools (Read, Write, Bash, etc.)
      </div>

      <h4>Characteristics</h4>
      <ul>
        <li>Synchronous, turn-based interaction</li>
        <li>Full context available to single agent</li>
        <li>Human remains in the loop for decisions</li>
        <li>No coordination overhead</li>
      </ul>

      <h4>Use Cases</h4>
      <ul>
        <li>Exploratory development</li>
        <li>Debugging sessions</li>
        <li>Code review</li>
        <li>Learning and experimentation</li>
      </ul>

      <hr class="section-divider divider-context">

      <h3>1.2 Loop-Based Autonomous Pattern (Ralph Wiggum)</h3>
      <p><strong>Source:</strong> Geoffrey Huntley, popularized by @mattpocockuk, @ryancarson</p>
      <p>A bash loop that runs Claude Code repeatedly with fresh context until a completion condition is met. Each iteration gets a clean slate but has access to git history and file-based memory.</p>

      <div class="ascii-diagram">
+---------------------------------------------------------------+
|                    RALPH LOOP PATTERN                          |
+---------------------------------------------------------------+
|                                                                |
|  +----------------+                                            |
|  |  PRD.json      |  &lt;- Task definitions with passes: true/false|
|  |  progress.txt  |  &lt;- Append-only learnings log              |
|  +-------+--------+                                            |
|          |                                                     |
|          v                                                     |
|  +---------------------------------------------------------+  |
|  |             ITERATION N (Fresh Context)                  |  |
|  |  1. Read prd.json, progress.txt                          |  |
|  |  2. Pick next unpassed story                             |  |
|  |  3. Implement feature                                    |  |
|  |  4. Run tests                                            |  |
|  |  5. If passing: commit, update prd.json passes: true     |  |
|  |  6. Append learnings to progress.txt                     |  |
|  |  7. Output PROMISE COMPLETE if all done                  |  |
|  +---------------------------------------------------------+  |
|          |                                                     |
|          v                                                     |
|  +----------------+                                            |
|  | All complete?  |----YES----&gt; EXIT                           |
|  +-------+--------+                                            |
|          | NO                                                  |
|          +------------------&gt; LOOP (new iteration)             |
|                                                                |
+---------------------------------------------------------------+
      </div>

      <h4>Implementation</h4>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>#!/bin/bash
MAX_ITERATIONS=${1:-10}

for (( i=1; i&lt;=$MAX_ITERATIONS; i++ )); do
  echo "Iteration $i / $MAX_ITERATIONS"

  claude "Review plans/prd.json and plans/progress.txt.
    Mark the right PRD items as passes: true.
    Append your progress to progress.txt.
    Make a git commit of that feature.
    Only work on a single feature.
    If PRD is complete, output PROMISE COMPLETE HERE." | tee output.txt

  if grep -q "PROMISE COMPLETE HERE" output.txt; then
    break
  fi
done</code></pre>
      </div>

      <h4>Key Principles</h4>
      <ol>
        <li><strong>Fresh context per iteration</strong> - avoids context rot</li>
        <li><strong>External memory</strong> - git history + progress.txt</li>
        <li><strong>Verifiable completion</strong> - tests must pass</li>
        <li><strong>Small task sizing</strong> - each story completable in one context window</li>
      </ol>

      <h4>Ralph Variants</h4>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Variant</th><th>Source</th><th>Enhancement</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Marathon Ralph</strong></td><td>@stephen_rayner</td><td>Full SDLC with E2E tests</td></tr>
            <tr><td><strong>Dr. Ralph</strong></td><td>@MikeEndale</td><td>Confidence thresholds (80%+)</td></tr>
            <tr><td><strong>Lisa</strong></td><td>@petruarakiss</td><td>Logging + progress tracking</td></tr>
            <tr><td><strong>Zeroshot</strong></td><td>@Eivind1384955</td><td>Next-gen version</td></tr>
          </tbody>
        </table>
      </div>

      <hr class="section-divider divider-context">

      <h3>1.3 Subagent-Spawning Pattern</h3>
      <p>Single parent agent spawns ephemeral child agents for specific tasks, then absorbs their results.</p>

      <div class="ascii-diagram">
+----------------------------------------------------+
|                 PARENT AGENT                        |
|  (Maintains overall context)                        |
+----------------------------------------------------+
|                                                     |
|  Task(subagent_type="researcher", ...)              |
|         |                                           |
|         v                                           |
|  +---------------------+                            |
|  |   CHILD AGENT       |  &lt;- Isolated context       |
|  |   (Short-lived)     |  &lt;- Returns result to      |
|  |   Research files... |     parent                 |
|  +---------------------+                            |
|         |                                           |
|         v                                           |
|  Result incorporated into parent context            |
|                                                     |
+----------------------------------------------------+
      </div>

      <h4>Use Cases</h4>
      <ul>
        <li>Exploratory research that would pollute main context</li>
        <li>Parallel investigation of multiple approaches</li>
        <li>Adversarial validation (critic subagent challenges design)</li>
        <li>Specialized skill delegation</li>
      </ul>

      <h4>Anti-Patterns</h4>
      <ul>
        <li>Spawning subagents for simple lookups</li>
        <li>Deep nesting (&gt;2 levels)</li>
        <li>Subagents modifying shared state without coordination</li>
      </ul>

      <hr class="section-divider divider-context">

      <h3>1.4 Cron-Scheduled Autonomous Pattern</h3>
      <p><strong>Source:</strong> @mollycantillon (Personal Panopticon)</p>
      <p>Scheduled Claude Code invocations that run at specified times without human intervention.</p>

      <div class="ascii-diagram">
+-----------------------------------------------------+
|                  CRON SCHEDULER                      |
+-----------------------------------------------------+
|                                                      |
|  0 6 * * * cd ~/trades && claude "Morning brief"    |
|      |                                               |
|      +--&gt; Runs at 6 AM daily                        |
|                                                      |
|  0 22 * * * cd ~/metrics && claude "Daily report"   |
|      |                                               |
|      +--&gt; Runs at 10 PM daily                       |
|                                                      |
|  Output written to files, notifications sent        |
|                                                      |
+-----------------------------------------------------+
      </div>

      <!-- Checkpoint -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint: Single Agent Patterns</div>
        <p><strong>You should now understand:</strong></p>
        <ul>
          <li>The 4 single-agent patterns: Interactive, Loop-Based (Ralph), Subagent-Spawning, Cron-Scheduled</li>
          <li>When to use each pattern</li>
          <li>The Ralph Wiggum loop structure and its variants (Marathon, Dr. Ralph, Lisa)</li>
          <li>The difference between subagents and standalone sessions</li>
        </ul>
        <p><strong>If unclear:</strong> See <a href="mastery-master.html">Mastery - Ralph Complete</a> for deep Ralph coverage</p>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Section 2: Multi-Agent Patterns -->
    <section id="multi-agent-patterns">
      <h2>2. <span class="bionic">Mul</span>ti-<span class="bionic">Age</span>nt <span class="bionic">Pat</span>terns</h2>

      <h3>2.1 Hub-and-Spoke Pattern (CC Mirror)</h3>
      <p><strong>Source:</strong> @nummanali</p>
      <p>Central orchestrator delegates to specialized workers. Orchestrator NEVER writes code directly - only coordinates.</p>

      <div class="callout callout-insight" style="background: #fef6f5; border-left: 4px solid #c97065; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0;">
        <div class="callout-title" style="color: #c97065; font-weight: 600;">The CC Mirror Mandate</div>
        <p style="font-weight: bold; margin-bottom: 0;">YOU DO NOT WRITE CODE. YOU DO NOT RUN COMMANDS. YOU DO NOT EXPLORE CODEBASES. You are the CONDUCTOR. Your agents play the instruments.</p>
      </div>

      <div class="ascii-diagram">
         +-------------------+
         |   ORCHESTRATOR    |
         |   (Opus 4.5)      |
         +---------+---------+
                   |
                   | Task(description=..., run_in_background=True)
                   |
    +--------------+-------------+
    |              |             |
    v              v             v
+---------+  +---------+  +---------+
| Coder   |  | Tester  |  | Docs    |
|(Sonnet) |  |(Sonnet) |  |(Haiku)  |
+---------+  +---------+  +---------+
      </div>

      <h4>Tool Ownership</h4>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Role</th><th>Tools Used</th><th>Tools NEVER Used</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Orchestrator</strong></td><td>Read (1-2 files), TaskCreate/Update/List/Get, AskUserQuestion, Task</td><td>Write, Edit, Bash, Glob, Grep</td></tr>
            <tr><td><strong>Worker</strong></td><td>Read, Write, Edit, Bash, Glob, Grep, WebFetch, WebSearch, LSP</td><td>Task, TaskCreate, sub-spawning</td></tr>
          </tbody>
        </table>
      </div>

      <h4>Worker Preamble Template</h4>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>CONTEXT: You are a WORKER agent, not an orchestrator.

RULES:
- Complete ONLY the task described below
- Use tools directly (Read, Write, Edit, Bash, etc.)
- Do NOT spawn sub-agents
- Do NOT call TaskCreate or TaskUpdate
- Report your results with absolute file paths

TASK:
[Your specific task here]</code></pre>
      </div>

      <hr class="section-divider divider-context">

      <h3>2.2 Factory Pattern (Gas Town)</h3>
      <p><strong>Source:</strong> @steve_yegge</p>
      <p>Not just agents, but an <strong>agent factory</strong> with a full "town" of specialized roles, persistent workers, and ephemeral crews.</p>

      <div class="ascii-diagram">
Gas Town (~/.gt)
+-- HQ (town-level management)
+-- Rigs (project repos)
|   +-- Witness (per-rig observer)
+-- Workers
|   +-- Mayor (town coordination)
|   +-- Deacon (monitoring/handshakes)
|   +-- Dogs (quality gates)
|   +-- Refinery (task decomposition)
|   +-- Polecat (named persistent workers)
|   +-- Crew (ephemeral workers)
+-- Overseer (YOU - human with inbox)
      </div>

      <h4>The 7 Specialized Roles</h4>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Role</th><th>Function</th><th>Persistence</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Mayor</strong></td><td>Town-level coordination, resource allocation</td><td>Persistent</td></tr>
            <tr><td><strong>Deacon</strong></td><td>Monitoring, health checks, handshakes between agents</td><td>Persistent</td></tr>
            <tr><td><strong>Dogs</strong></td><td>Quality gates, watchdogs, enforcement</td><td>Persistent</td></tr>
            <tr><td><strong>Refinery</strong></td><td>Task decomposition, story breakdown</td><td>On-demand</td></tr>
            <tr><td><strong>Polecat</strong></td><td>Named persistent workers with specific expertise</td><td>Persistent</td></tr>
            <tr><td><strong>Crew</strong></td><td>Ephemeral workers for one-off tasks</td><td>Ephemeral</td></tr>
            <tr><td><strong>Witness</strong></td><td>Per-rig observer, audit trail</td><td>Persistent</td></tr>
          </tbody>
        </table>
      </div>

      <blockquote>
        <p>"You just make up features, design them, file the implementation plans, and sling work around to your polecats and crew."</p>
        <cite>-- Steve Yegge</cite>
      </blockquote>

      <hr class="section-divider divider-context">

      <h3>2.3 Domain-Isolated Parallel Pattern (Panopticon)</h3>
      <p><strong>Source:</strong> @mollycantillon</p>
      <p>Run 8 parallel Claude Code instances, each owning a life domain, achieving "self-legibility" through comprehensive personal automation.</p>

      <div class="ascii-diagram">
+---------------------------------------------------------------+
|                    PERSONAL PANOPTICON                         |
|              (8 Domain-Isolated Agent Instances)               |
+---------------------------------------------------------------+
|                                                                |
|  ~/nox        &lt;- Company/product development                   |
|  ~/metrics    &lt;- Analytics/data processing                     |
|  ~/email      &lt;- Communications automation                     |
|  ~/growth     &lt;- Marketing/acquisition                         |
|  ~/trades     &lt;- Personal finance/trading                      |
|  ~/health     &lt;- Fitness/sleep/wellness                        |
|  ~/writing    &lt;- Content creation                              |
|  ~/personal   &lt;- Life admin                                    |
|                                                                |
|  Each instance:                                                |
|  - Operates independently (no cross-contamination)             |
|  - Reads/writes to its directory as persistent memory          |
|  - Can spawn short-lived subagents                             |
|  - Exchanges context through file-based handoffs               |
|                                                                |
+---------------------------------------------------------------+
      </div>

      <!-- Checkpoint -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint: Multi-Agent Patterns</div>
        <p><strong>You should now understand:</strong></p>
        <ul>
          <li>The 5 multi-agent patterns: Hub-and-Spoke, Factory (Gas Town), Kanban Loop, Parallel Branch, Panopticon</li>
          <li>Tool ownership differences between orchestrator and worker roles</li>
          <li>The CC Mirror installation process: <code>npx cc-mirror quick --provider mirror --name mclaude</code></li>
          <li>Requirements for Gas Town (Stage 7+ dev, tmux proficiency, significant budget)</li>
        </ul>
        <p><strong>If unclear:</strong> Re-read sections 2.1-2.3 or see the extractions/orchestration/ files</p>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Section 3: Orchestrator/Worker Separation -->
    <section id="orchestrator-worker-separation">
      <h2>3. <span class="bionic">Orc</span>hestrator/<span class="bionic">Wor</span>ker <span class="bionic">Sep</span>aration</h2>

      <h3>The Fundamental Dichotomy</h3>
      <p>The most critical architectural pattern in multi-agent systems is the <strong>strict separation between orchestration and execution</strong>.</p>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Aspect</th><th>Orchestrator</th><th>Worker</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Primary Function</strong></td><td>Coordinate, delegate, monitor</td><td>Execute, implement, verify</td></tr>
            <tr><td><strong>Code Writing</strong></td><td>NEVER</td><td>ALWAYS</td></tr>
            <tr><td><strong>Tool Usage</strong></td><td>Task*, Read (minimal)</td><td>Read, Write, Edit, Bash, etc.</td></tr>
            <tr><td><strong>Context Scope</strong></td><td>Project-wide strategy</td><td>Task-specific focus</td></tr>
            <tr><td><strong>Spawning</strong></td><td>Spawns workers</td><td>Never spawns sub-agents</td></tr>
            <tr><td><strong>Model Choice</strong></td><td>Opus (complex reasoning)</td><td>Sonnet/Haiku (execution)</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Model Selection by Role</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Model</th><th>Best Role</th><th>Rationale</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Opus 4.5</strong></td><td>Orchestrator</td><td>Complex reasoning, strategy, ambiguity handling</td></tr>
            <tr><td><strong>Sonnet</strong></td><td>Primary Worker</td><td>Good balance of capability and cost</td></tr>
            <tr><td><strong>Haiku</strong></td><td>Errand Runner</td><td>Fast, cheap lookups and simple transforms</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Section 4: Swarm Architectures -->
    <section id="swarm-architectures">
      <h2>4. <span class="bionic">Swa</span>rm <span class="bionic">Arc</span>hitectures</h2>

      <h3>4.1 Git Worktree Swarm Pattern</h3>
      <p>Git worktrees create isolated working directories sharing the same repo, enabling parallel agent work.</p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>#!/bin/bash
# spawn-agent.sh - Create worktree and launch agent

BRANCH_NAME=$1
WORKTREE_DIR="../worktrees/$BRANCH_NAME"

# Create branch if doesn't exist
git branch $BRANCH_NAME 2>/dev/null || true

# Create worktree
git worktree add $WORKTREE_DIR $BRANCH_NAME

# Launch Claude in worktree
cd $WORKTREE_DIR && claude "$2"</code></pre>
      </div>

      <h4>Worktree + Ralph Combination</h4>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Spawn parallel Ralph loops in worktrees
for feature in auth payments notifications; do
  git worktree add ../wt-$feature $feature-branch
  (cd ../wt-$feature && ./ralph.sh 20) &
done
wait</code></pre>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Section 6: Architecture Comparison Matrix -->
    <section id="architecture-comparison-matrix">
      <h2>6. <span class="bionic">Arc</span>hitecture <span class="bionic">Com</span>parison <span class="bionic">Mat</span>rix</h2>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Pattern</th><th>Complexity</th><th>Parallelism</th><th>Context Isolation</th><th>Cost</th><th>Use Case</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Interactive Session</strong></td><td>Low</td><td>None</td><td>N/A</td><td>Low</td><td>Exploration, debugging</td></tr>
            <tr><td><strong>Ralph Loop</strong></td><td>Low-Medium</td><td>None (sequential)</td><td>Per-iteration</td><td>Medium</td><td>Overnight feature shipping</td></tr>
            <tr><td><strong>Subagent Spawning</strong></td><td>Medium</td><td>Limited</td><td>Per-subagent</td><td>Medium</td><td>Research, validation</td></tr>
            <tr><td><strong>Hub-and-Spoke</strong></td><td>Medium-High</td><td>High</td><td>Per-worker</td><td>Medium-High</td><td>Team projects</td></tr>
            <tr><td><strong>Factory (Gas Town)</strong></td><td>Very High</td><td>Very High</td><td>Per-worker</td><td>High</td><td>Enterprise scale</td></tr>
            <tr><td><strong>Panopticon</strong></td><td>High</td><td>High</td><td>Per-domain</td><td>High</td><td>Personal automation</td></tr>
            <tr><td><strong>Worktree Swarm</strong></td><td>Medium</td><td>High</td><td>Per-worktree</td><td>Medium</td><td>Parallel features</td></tr>
            <tr><td><strong>Container Swarm</strong></td><td>High</td><td>Very High</td><td>Per-container</td><td>High</td><td>CI/CD integration</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Selection Guide</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Scenario</th><th>Recommended Pattern</th></tr>
          </thead>
          <tbody>
            <tr><td>Single feature, overnight</td><td>Ralph Loop</td></tr>
            <tr><td>Multiple life domains</td><td>Panopticon (isolated directories)</td></tr>
            <tr><td>Team project, parallel features</td><td>Git worktrees + branch discipline</td></tr>
            <tr><td>Complex architecture work</td><td>Hub-and-Spoke with specialized workers</td></tr>
            <tr><td>Production app with dependencies</td><td>CC Mirror native orchestration</td></tr>
            <tr><td>Massive scale (10+ agents)</td><td>Gas Town factory</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Section 7: Iron Law -->
    <section id="iron-law">
      <h2>7. The <span class="bionic">Iro</span>n <span class="bionic">Law</span> of <span class="bionic">Wor</span>ker <span class="bionic">Sep</span>aration</h2>

      <div class="callout callout-insight" style="background: #f0ebe3; border-left: 4px solid #5c4b3a; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0;">
        <div class="callout-title" style="color: #5c4b3a; font-weight: 600;">THE IRON LAW</div>
        <p><strong>An agent that ORCHESTRATES must NEVER directly EXECUTE.</strong></p>
        <p><strong>An agent that EXECUTES must NEVER directly ORCHESTRATE.</strong></p>
        <p style="margin-bottom: 0;">Mixing these roles leads to: context pollution, scope creep, verification bypass, uncontrolled recursion.</p>
      </div>

      <h3>Why This Matters</h3>

      <h4>Problem 1: Context Pollution</h4>
      <p>When an orchestrator writes code, it fills its context with implementation details, losing strategic perspective.</p>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>BAD:
  Orchestrator: "I'll just quickly write this function..."
               [Context now filled with code, loses project overview]

GOOD:
  Orchestrator: "Spawning Sonnet worker to implement login function..."
               [Context remains strategic, worker handles details]</code></pre>
      </div>

      <h4>Problem 2: Uncontrolled Recursion</h4>
      <p>Workers that spawn sub-workers create nested contexts that become impossible to track.</p>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>BAD:
  Worker A -> spawns Worker B -> spawns Worker C -> spawns...
  [Exponential context explosion, coordination nightmare]

GOOD:
  Orchestrator -> spawns Worker A (flat)
              -> spawns Worker B (flat)
              -> spawns Worker C (flat)
  [All workers report directly to orchestrator]</code></pre>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Section 8: Communication Patterns -->
    <section id="communication-patterns">
      <h2>8. <span class="bionic">Com</span>munication <span class="bionic">Pat</span>terns</h2>

      <h3>8.1 File-Based Handoffs</h3>
      <p>Agents communicate through the filesystem:</p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>// handoff-agent1-to-agent2.json
{
  "from": "agent1",
  "to": "agent2",
  "timestamp": "2026-01-09T10:30:00Z",
  "context": {
    "completed": ["API schema", "Database models"],
    "next_steps": ["Implement REST endpoints"],
    "blockers": [],
    "notes": "Using FastAPI, see docs in /api/README.md"
  }
}</code></pre>
      </div>

      <h3>8.2 Git-Based Handoffs</h3>
      <p>Progress persists in files, git history provides context:</p>
      <ul>
        <li><strong>progress.txt</strong> - Append-only learnings log</li>
        <li><strong>prd.json</strong> - Task status with passes: true/false</li>
        <li><strong>Git commits</strong> - Each iteration commits, future agents see history</li>
      </ul>
    </section>

    <hr class="section-divider">

    <!-- Section 9: Isolation Strategies -->
    <section id="isolation-strategies">
      <h2>9. <span class="bionic">Iso</span>lation <span class="bionic">Str</span>ategies</h2>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Strategy</th><th>Mechanism</th><th>Best For</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Directory isolation</strong></td><td>Each agent owns a directory</td><td>Domain specialization</td></tr>
            <tr><td><strong>Branch isolation</strong></td><td>Each agent works on its own branch</td><td>Feature parallelism</td></tr>
            <tr><td><strong>Worktree isolation</strong></td><td>Git worktrees share repo, isolate checkouts</td><td>Heavy parallelism</td></tr>
            <tr><td><strong>Container isolation</strong></td><td>Docker containers with volume mounts</td><td>Production systems</td></tr>
            <tr><td><strong>Context window isolation</strong></td><td>Subagents inherently isolated</td><td>Ephemeral research</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Section 10: Production Deployment -->
    <section id="production-deployment">
      <h2>10. <span class="bionic">Pro</span>duction <span class="bionic">Dep</span>loyment <span class="bionic">Pat</span>terns</h2>

      <h3>Requirements by Scale</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Scale</th><th>Agents</th><th>Requirements</th><th>Example Pattern</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Solo</strong></td><td>1-3</td><td>Single machine, tmux</td><td>Ralph Loop</td></tr>
            <tr><td><strong>Team</strong></td><td>3-10</td><td>Shared repo, branch discipline</td><td>Hub-and-Spoke</td></tr>
            <tr><td><strong>Department</strong></td><td>10-50</td><td>Task queues, monitoring</td><td>Gas Town</td></tr>
            <tr><td><strong>Enterprise</strong></td><td>50+</td><td>Container orchestration, central control</td><td>Kubernetes + Custom</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Quick Reference Commands</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Ralph Loop
./ralph.sh 25

# Git Worktree
git worktree add ../feature-branch feature-branch

# CC Mirror
npx cc-mirror quick --provider mirror --name mclaude

# Claude HUD
/plugin install claude-hud

# rpai (tmux manager)
cargo install rpai && rpai

# Gas Town
go install github.com/steveyegge/gastown/cmd/gt@latest</code></pre>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Troubleshooting -->
    <section id="troubleshooting">
      <h2><span class="bionic">Tro</span>ubleshooting</h2>

      <details class="troubleshoot" style="border: 1px solid #c97065; border-radius: 8px; margin: 1rem 0;">
        <summary style="background: #fef6f5; padding: 1rem; cursor: pointer; color: #c97065;">Orchestrator Writing Code Directly</summary>
        <div style="padding: 1rem;">
          <p><strong>Symptom:</strong> Main agent context fills up with implementation details, loses strategic view</p>
          <p><strong>Cause:</strong> Violating the Iron Law of Worker Separation</p>
          <p><strong>Fix:</strong></p>
          <ol>
            <li>Review Section 7 (Iron Law) - orchestrators must NEVER write code</li>
            <li>Add explicit worker preamble to subagent prompts</li>
            <li>Use CC Mirror orchestration skill which enforces this pattern</li>
          </ol>
        </div>
      </details>

      <details class="troubleshoot" style="border: 1px solid #c97065; border-radius: 8px; margin: 1rem 0;">
        <summary style="background: #fef6f5; padding: 1rem; cursor: pointer; color: #c97065;">Worker Spawning Sub-Workers</summary>
        <div style="padding: 1rem;">
          <p><strong>Symptom:</strong> Exponential context explosion, coordination nightmare</p>
          <p><strong>Cause:</strong> Worker trying to orchestrate instead of execute</p>
          <p><strong>Fix:</strong></p>
          <ol>
            <li>Workers must NEVER spawn sub-agents (flat hierarchy only)</li>
            <li>Add explicit instruction: "Do NOT call TaskCreate or TaskUpdate"</li>
            <li>All workers report directly to single orchestrator</li>
          </ol>
        </div>
      </details>

      <details class="troubleshoot" style="border: 1px solid #c97065; border-radius: 8px; margin: 1rem 0;">
        <summary style="background: #fef6f5; padding: 1rem; cursor: pointer; color: #c97065;">Wrong Model for Task Type</summary>
        <div style="padding: 1rem;">
          <p><strong>Symptom:</strong> High costs for simple tasks, or poor quality on complex ones</p>
          <p><strong>Cause:</strong> Not matching model capability to task requirements</p>
          <p><strong>Fix:</strong> Model selection guide:</p>
          <ul>
            <li><strong>Haiku</strong> - File lookups, simple grep, errand running (spawn 5-10 parallel)</li>
            <li><strong>Sonnet</strong> - Implementation, patterns, tests</li>
            <li><strong>Opus</strong> - Architecture, complex reasoning, ambiguous tasks</li>
          </ul>
        </div>
      </details>

      <details class="troubleshoot" style="border: 1px solid #c97065; border-radius: 8px; margin: 1rem 0;">
        <summary style="background: #fef6f5; padding: 1rem; cursor: pointer; color: #c97065;">File Conflicts in Parallel Agents</summary>
        <div style="padding: 1rem;">
          <p><strong>Symptom:</strong> Merge conflicts, overwritten changes, inconsistent state</p>
          <p><strong>Cause:</strong> Multiple agents editing same files</p>
          <p><strong>Fix:</strong></p>
          <ol>
            <li>Use Git worktrees for isolation: <code>git worktree add ../feature-branch feature-branch</code></li>
            <li>Or use directory ownership pattern (each agent owns specific dirs)</li>
            <li>Or use task dependencies to serialize conflicting work</li>
            <li>See Section 9 (Isolation Strategies) for full options</li>
          </ol>
        </div>
      </details>
    </section>

    <hr class="section-divider">

    <!-- Related Pages -->
    <div class="related-pages">
      <h3>Related Taxonomy Documents</h3>
      <ul>
        <li><a href="taxonomy-context-memory.html">Context and Memory Taxonomy</a> - Memory persistence patterns</li>
        <li><a href="taxonomy-cross-reference.html">Cross-Reference Index</a> - Theme connections and author expertise</li>
        <li><a href="compare-orchestration.html">Orchestration Comparison</a> - CC Mirror vs Gas Town vs Ralph</li>
      </ul>
    </div>

    <!-- Footer Navigation -->
    <nav class="footer-nav">
      <a href="taxonomy-master.html" class="nav-prev">
        <span class="nav-direction">Previous</span>
        <span class="nav-title">Taxonomy Master</span>
      </a>
      <a href="taxonomy-context-memory.html" class="nav-next">
        <span class="nav-direction">Next</span>
        <span class="nav-title">Context and Memory Taxonomy</span>
      </a>
    </nav>

    <!-- Tags -->
    <div style="margin-top: 2rem;">
      <span class="tag">#architecture</span>
      <span class="tag">#taxonomy</span>
      <span class="tag">#multi-agent</span>
      <span class="tag">#orchestration</span>
      <span class="tag">#swarm</span>
      <span class="tag">#ralph-loop</span>
      <span class="tag">#gas-town</span>
      <span class="tag">#cc-mirror</span>
      <span class="tag">#panopticon</span>
      <span class="tag">#hub-and-spoke</span>
      <span class="tag">#iron-law</span>
    </div>
  </div>

  <script src="../js/copy-code.js"></script>
  <script src="../js/search.js"></script>
  <script src="../js/global-nav.js"></script>
</body>
</html>
