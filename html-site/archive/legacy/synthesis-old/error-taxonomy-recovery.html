<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta data-pagefind-meta="section" content="Synthesis">
  <meta data-pagefind-meta="category" content="Errors">
  <title>Error Taxonomy and Recovery Patterns - Claude Code Knowledge Base</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/sidebar.css">
  <link rel="stylesheet" href="../css/search.css">
</head>
<body>
  <!-- Search Modal -->
  <div class="search-modal" id="searchModal" aria-hidden="true">
    <div class="search-overlay" onclick="closeSearch()"></div>
    <div class="search-content">
      <div class="search-header">
        <div class="search-input-wrapper">
          <span class="search-icon-input">&#128269;</span>
          <input type="text" id="searchInput" placeholder="Search documentation..." autocomplete="off" />
          <kbd class="search-kbd">ESC</kbd>
        </div>
      </div>
      <div class="search-filters">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="synthesis">Synthesis</button>
        <button class="filter-btn" data-filter="extractions">Extractions</button>
      </div>
      <div class="search-results" id="searchResults">
        <div class="search-empty"><p>Start typing to search... (Press Cmd+K anytime)</p></div>
      </div>
      <div class="search-footer">
        <span>Up/Down Navigate</span><span>Enter Select</span><span>ESC Close</span>
      </div>
    </div>
  </div>

  <button class="search-trigger" onclick="openSearch()" aria-label="Search" style="float: right; margin-bottom: 1rem;">
    <span class="search-icon">Cmd+K</span>
    <span class="search-text">Search</span>
  </button>

  <div class="container">
    <!-- Breadcrumb Navigation -->
    <nav class="nav-breadcrumb">
      <a href="../index.html">Home</a>
      <span>/</span>
      <a href="synthesis-index.html">Synthesis</a>
      <span>/</span>
      <span>Error Taxonomy</span>
    </nav>

    <!-- You Are Here Context Box -->
    <div class="you-are-here" style="background: linear-gradient(135deg, #f0ebe3 0%, #fefcf3 100%); border-left: 4px solid #2a7d7d; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
      <h3 style="color: #2a7d7d; margin-top: 0; font-size: 0.9em; text-transform: uppercase; letter-spacing: 0.5px;">You Are Here</h3>
      <p style="margin-bottom: 0;">This is your <strong>comprehensive error recovery reference</strong> for Claude Code workflows. It synthesizes failure patterns from production war stories, community experiences, and documented incidents across 4,677+ GitHub issues. Use Cmd+F to search for your specific symptom.</p>
    </div>

    <h1><span class="bionic">Err</span>or <span class="bionic">Tax</span>onomy and <span class="bionic">Rec</span>overy <span class="bionic">Pat</span>terns</h1>

    <p class="conversational-lead">
      Complete guide to Claude Code failure modes, recovery strategies, and error prevention. 9 major error categories, 35+ specific error types, 6 recovery patterns, and 4 mental models for understanding what can go wrong.
    </p>

    <!-- Table of Contents -->
    <div class="toc">
      <div class="toc-title">Contents</div>
      <ul>
        <li><a href="#context-errors">Context Window Errors</a></li>
        <li><a href="#merge-errors">Merge and Version Control Errors</a></li>
        <li><a href="#validation-errors">Validation and Verification Errors</a></li>
        <li><a href="#rate-limit-errors">Rate Limit and API Errors</a></li>
        <li><a href="#loop-errors">Infinite Loop Errors</a></li>
        <li><a href="#cost-errors">Cost and Resource Errors</a></li>
        <li><a href="#security-errors">Security and Permission Errors</a></li>
        <li><a href="#orchestration-errors">Orchestration and Multi-Agent Errors</a></li>
        <li><a href="#recovery-patterns">Recovery Patterns</a></li>
        <li><a href="#mental-models">Mental Models</a></li>
        <li><a href="#checkpoints">Prevention Checkpoints</a></li>
        <li><a href="#troubleshooting">Troubleshooting Accordions</a></li>
        <li><a href="#golden-rules">The Golden Rules</a></li>
      </ul>
    </div>

    <hr class="section-divider">

    <!-- Context Errors -->
    <section id="context-errors">
      <h2><span class="bionic">Con</span>text <span class="bionic">Win</span>dow <span class="bionic">Err</span>ors</h2>

      <p>Context window errors are the <strong>most common failure category</strong>, accounting for the majority of quality degradation in Claude Code sessions.</p>

      <h3>Context Overflow</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Property</th><th>Value</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Error Type</strong></td><td>DETERMINISTIC</td></tr>
            <tr><td><strong>Severity</strong></td><td>HIGH</td></tr>
            <tr><td><strong>Frequency</strong></td><td>Very Common</td></tr>
          </tbody>
        </table>
      </div>

      <p><strong>Symptoms:</strong></p>
      <ul>
        <li><code>API Error 400</code> messages</li>
        <li>Quality degradation after 30+ minutes</li>
        <li>Claude forgetting earlier instructions</li>
        <li>Truncated code outputs (functions cut off mid-definition)</li>
        <li>CLAUDE.md directives being ignored</li>
      </ul>

      <p><strong>Root Cause:</strong> Context window (200K tokens) has exceeded capacity. Performance degradation begins at 60-70% capacity and becomes critical above 90%.</p>

      <h4>Context Level Impact Table</h4>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Level</th><th>Impact</th><th>Recovery Action</th></tr>
          </thead>
          <tbody>
            <tr><td>0-50%</td><td>Full capability</td><td>Continue normal operation</td></tr>
            <tr><td>50-70%</td><td>Slight degradation possible</td><td>Proactive /compact recommended</td></tr>
            <tr><td>70-85%</td><td>Noticeable quality loss</td><td>Compact immediately</td></tr>
            <tr><td>85-95%</td><td>Significant degradation</td><td>Reset session</td></tr>
            <tr><td>95%+</td><td>Failure mode</td><td>Session unrecoverable, start fresh</td></tr>
          </tbody>
        </table>
      </div>

      <p><strong>Prevention:</strong> Use Ralph pattern (fresh context), Claude HUD monitoring</p>

      <h3>Context Rot (Quality Degradation)</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Property</th><th>Value</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Error Type</strong></td><td>NON-DETERMINISTIC</td></tr>
            <tr><td><strong>Severity</strong></td><td>MEDIUM-HIGH</td></tr>
            <tr><td><strong>Frequency</strong></td><td>Common</td></tr>
          </tbody>
        </table>
      </div>

      <p><strong>Symptoms:</strong></p>
      <ul>
        <li>Responses become generic or repetitive</li>
        <li>Errors start compounding</li>
        <li>Claude claims it did something it didn't</li>
        <li>Circular edits to the same file</li>
        <li>Same mistake repeated despite corrections</li>
      </ul>

      <blockquote>
        <p>"Beyond three turns, AI becomes unreliable without proper memory, summarization, and state handling."</p>
        <cite>-- Community wisdom</cite>
      </blockquote>

      <p><strong>Prevention:</strong> Fresh context per iteration (Ralph), external memory files</p>

      <h3>Context Pollution (Wrong Data Loaded)</h3>

      <p><strong>Symptoms:</strong></p>
      <ul>
        <li>Context fills immediately after "read all files" command</li>
        <li>No room left for actual work</li>
        <li>Simple tasks become impossible</li>
      </ul>

      <p><strong>Anti-Pattern vs Pattern:</strong></p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># BAD - Context pollution
"Read all the files in src/ to understand the architecture"

# GOOD - Targeted loading
"Read src/index.ts and src/config.ts to understand the entry point"</code></pre>
      </div>

      <p><strong>Prevention:</strong> <code>.claudeignore</code> file, targeted file reads, subagents for exploration</p>
    </section>

    <hr class="section-divider">

    <!-- Merge Errors -->
    <section id="merge-errors">
      <h2><span class="bionic">Mer</span>ge and <span class="bionic">Ver</span>sion <span class="bionic">Con</span>trol <span class="bionic">Err</span>ors</h2>

      <h3>Merge Conflicts Between Parallel Agents</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Property</th><th>Value</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Error Type</strong></td><td>DETERMINISTIC</td></tr>
            <tr><td><strong>Severity</strong></td><td>HIGH</td></tr>
            <tr><td><strong>Frequency</strong></td><td>Common in multi-agent setups</td></tr>
          </tbody>
        </table>
      </div>

      <p><strong>Symptoms:</strong></p>
      <ul>
        <li>Git conflicts at merge time</li>
        <li><code>&lt;&lt;&lt;&lt;&lt;&lt;&lt;</code>, <code>=======</code>, <code>&gt;&gt;&gt;&gt;&gt;&gt;&gt;</code> markers in source files</li>
        <li>Work overwritten by parallel agents</li>
        <li>Race conditions on shared files</li>
      </ul>

      <blockquote>
        <p>"If both agents work on the same file, all hell breaks loose. They'll overwrite each other's edits and manipulate the other agent's context."</p>
        <cite>-- Community experience</cite>
      </blockquote>

      <p><strong>Prevention:</strong> Git worktrees for complete isolation, directory ownership per agent</p>

      <h3>Destructive Git Operations</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Property</th><th>Value</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Error Type</strong></td><td>DETERMINISTIC</td></tr>
            <tr><td><strong>Severity</strong></td><td>CRITICAL</td></tr>
            <tr><td><strong>Frequency</strong></td><td>Rare but Catastrophic</td></tr>
          </tbody>
        </table>
      </div>

      <p><strong>Symptoms:</strong></p>
      <ul>
        <li>Uncommitted work permanently destroyed</li>
        <li><code>git reset --hard</code> executed without warning</li>
        <li>History rewritten unexpectedly</li>
      </ul>

      <p><strong>GitHub Issue:</strong> #17190</p>

      <p><strong>Prevention:</strong></p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Before any Claude Code session
git stash push -m "pre-claude-backup"

# Or work on a dedicated branch
git checkout -b claude-work</code></pre>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Validation Errors -->
    <section id="validation-errors">
      <h2><span class="bionic">Val</span>idation and <span class="bionic">Ver</span>ification <span class="bionic">Err</span>ors</h2>

      <h3>False Positive Test Results</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Property</th><th>Value</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Error Type</strong></td><td>NON-DETERMINISTIC</td></tr>
            <tr><td><strong>Severity</strong></td><td>HIGH</td></tr>
            <tr><td><strong>Frequency</strong></td><td>Common</td></tr>
          </tbody>
        </table>
      </div>

      <p><strong>Symptoms:</strong></p>
      <ul>
        <li>Claude reports tests pass but tests are actually broken</li>
        <li>Test framework not installed</li>
        <li>Tests running in wrong directory</li>
        <li>Exit codes ignored</li>
      </ul>

      <p><strong>Detection:</strong></p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>npm test 2>&1 | tail -20
echo "Exit code: $?"</code></pre>
      </div>

      <p><strong>Prevention:</strong> Always include exit code verification</p>

      <h3>Features Marked Complete Without Testing</h3>

      <blockquote>
        <p>"Claude's tendency to mark features complete without proper testing... did much better at verifying end-to-end once explicitly prompted to use browser automation tools"</p>
        <cite>-- Anthropic Best Practices</cite>
      </blockquote>

      <p><strong>Prevention:</strong></p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>{
  "acceptanceCriteria": [
    "Feature implemented",
    "npm run typecheck passes with exit code 0",
    "npm run test passes with exit code 0",
    "Verify at localhost:3000/feature using Playwright screenshot"
  ]
}</code></pre>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Rate Limit Errors -->
    <section id="rate-limit-errors">
      <h2><span class="bionic">Rat</span>e <span class="bionic">Lim</span>it and <span class="bionic">API</span> <span class="bionic">Err</span>ors</h2>

      <h3>Rate Limit Errors</h3>

      <p><strong>Symptoms:</strong></p>
      <ul>
        <li><code>rate_limit</code> errors in output</li>
        <li>API requests rejected</li>
        <li>Agent stuck waiting</li>
        <li>Workflow blocked</li>
      </ul>

      <p><strong>Recovery:</strong></p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>#!/bin/bash
RATE_LIMIT_SLEEP=5

# Check for rate limit and wait
if grep -q "rate_limit" output.txt; then
  echo "Rate limited, waiting..."
  sleep 60
fi

sleep $RATE_LIMIT_SLEEP  # Always pause between iterations</code></pre>
      </div>

      <h3>Authentication Failures</h3>

      <p><strong>Symptoms:</strong> 401/403 errors, token/session expiration too frequent</p>

      <p><strong>Recovery:</strong></p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Re-authenticate
claude auth logout
claude auth login

# Or use API key instead
export ANTHROPIC_API_KEY="sk-ant-..."</code></pre>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Loop Errors -->
    <section id="loop-errors">
      <h2><span class="bionic">Inf</span>inite <span class="bionic">Loo</span>p <span class="bionic">Err</span>ors</h2>

      <h3>Verification Loop</h3>

      <p><strong>Symptoms:</strong></p>
      <ul>
        <li>Same file edited 5+ times without progress</li>
        <li>Claude runs tests, finds failure, makes change, tests fail differently, repeat</li>
        <li>Token consumption without meaningful progress</li>
      </ul>

      <p><strong>Root Cause:</strong> Fundamental approach is wrong, not just implementation details.</p>

      <p><strong>Break Pattern:</strong></p>
      <ol>
        <li>Interrupt: <code>Ctrl+C</code></li>
        <li>Rethink approach at higher level</li>
        <li>Split task into smaller pieces</li>
        <li>Add blocking dependency on simpler tasks</li>
      </ol>

      <h3>Ralph Loop Runaway</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Property</th><th>Value</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Error Type</strong></td><td>NON-DETERMINISTIC</td></tr>
            <tr><td><strong>Severity</strong></td><td>CRITICAL (Cost)</td></tr>
            <tr><td><strong>Frequency</strong></td><td>Occasional</td></tr>
          </tbody>
        </table>
      </div>

      <p><strong>Symptoms:</strong></p>
      <ul>
        <li>Completion promise never found</li>
        <li>Loop runs to max iterations every time</li>
        <li>Tasks actually complete but loop continues</li>
        <li>Massive token consumption</li>
      </ul>

      <div class="callout callout-warning">
        <div class="callout-title">The $47,000 Incident</div>
        <p>"A multi-agent research tool slipped into a recursive loop that ran for 11 days before anyone noticed, accumulating $47,000 in costs."</p>
      </div>

      <p><strong>Prevention:</strong></p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Always set max iterations
MAX_ITERATIONS=${1:-25}

# Include timeout
timeout 3600 ./ralph.sh 50  # 1 hour max

# Stuck detection
STUCK_THRESHOLD=3
if [ "$CURRENT_COMMIT" = "$LAST_COMMIT" ]; then
  STUCK_COUNT=$((STUCK_COUNT + 1))
  if [ $STUCK_COUNT -ge $STUCK_THRESHOLD ]; then
    echo "WARNING: Stuck for $STUCK_COUNT iterations"
    exit 1
  fi
fi</code></pre>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Cost Errors -->
    <section id="cost-errors">
      <h2><span class="bionic">Cos</span>t and <span class="bionic">Res</span>ource <span class="bionic">Err</span>ors</h2>

      <h3>Cost Runaway</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Property</th><th>Value</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Error Type</strong></td><td>DETERMINISTIC (once loop starts)</td></tr>
            <tr><td><strong>Severity</strong></td><td>CRITICAL</td></tr>
            <tr><td><strong>Frequency</strong></td><td>Occasional but Devastating</td></tr>
          </tbody>
        </table>
      </div>

      <p><strong>Documented Incidents:</strong></p>
      <ul>
        <li>$47,000 from 11-day recursive loop</li>
        <li>3.2 million tokens on circular revisions</li>
        <li>$500+ bills on simple features</li>
      </ul>

      <h4>Model Cost Awareness</h4>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Model</th><th>Input</th><th>Output</th><th>Relative Cost</th></tr>
          </thead>
          <tbody>
            <tr><td>Haiku</td><td>$0.25/1M</td><td>$1.25/1M</td><td>1x</td></tr>
            <tr><td>Sonnet</td><td>$3/1M</td><td>$15/1M</td><td>12x</td></tr>
            <tr><td>Opus</td><td>$15/1M</td><td>$75/1M</td><td>60x</td></tr>
          </tbody>
        </table>
      </div>

      <p><strong>Prevention:</strong></p>
      <ul>
        <li>Always set iteration limits</li>
        <li>Use timeouts</li>
        <li>Match model to task complexity</li>
        <li>Monitor with Claude HUD or API dashboard</li>
      </ul>

      <h3>Tool Overhead Costs</h3>

      <p><strong>Hidden Tool Overhead:</strong></p>
      <ul>
        <li>Bash tool: +245 input tokens per call</li>
        <li>Text editor: +700 input tokens typical</li>
        <li>Web search: $10 per 1,000 searches</li>
        <li>Code execution: $0.05 per session-hour</li>
      </ul>

      <blockquote>
        <p>"If a loop calls web search 100 times, that's $1 in search alone - before tokens."</p>
      </blockquote>
    </section>

    <hr class="section-divider">

    <!-- Security Errors -->
    <section id="security-errors">
      <h2><span class="bionic">Sec</span>urity and <span class="bionic">Per</span>mission <span class="bionic">Err</span>ors</h2>

      <h3>Catastrophic File Deletion</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Property</th><th>Value</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Error Type</strong></td><td>DETERMINISTIC</td></tr>
            <tr><td><strong>Severity</strong></td><td>CRITICAL</td></tr>
            <tr><td><strong>Frequency</strong></td><td>Rare but Devastating</td></tr>
          </tbody>
        </table>
      </div>

      <p><strong>Documented Incidents:</strong></p>
      <ul>
        <li><code>rm -rf tests/ patches/ plan/ ~/</code> - Deleted user's entire home folder (GitHub Issue #17164)</li>
        <li><code>rmdir /s /q d:\</code> - Deleted entire D: drive (Google Antigravity incident)</li>
        <li>Replit deleting production database with 1,200+ executives' data</li>
      </ul>

      <p><strong>Prevention (MANDATORY):</strong></p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>{
  "permissions": {
    "blockedPatterns": [
      "rm -rf",
      "rmdir /s",
      "find . -delete",
      "git push --force",
      "git reset --hard",
      "sudo rm",
      "chmod -R 777"
    ]
  }
}</code></pre>
      </div>

      <h3>Credentials Exposure</h3>

      <p><strong>Symptoms:</strong></p>
      <ul>
        <li>API keys visible in conversation</li>
        <li>Passwords in logs</li>
        <li><code>.env</code> contents displayed</li>
        <li>Secrets in git history</li>
      </ul>

      <p><strong>Prevention:</strong></p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># .claudeignore - REQUIRED
.env*
*.pem
*.key
credentials.json
secrets/
.aws/
.ssh/
*.keychain</code></pre>
      </div>

      <p><strong>Recovery:</strong></p>
      <ol>
        <li>Rotate ALL exposed credentials immediately</li>
        <li>Remove secrets from git history: <code>git filter-branch</code></li>
        <li>Add files to .claudeignore</li>
        <li>Never cat .env in Claude Code</li>
      </ol>

      <h3>Memory Injection Attacks</h3>

      <p><strong>Symptoms:</strong></p>
      <ul>
        <li>Agent develops false beliefs</li>
        <li>Defends incorrect information</li>
        <li>Security policies ignored</li>
        <li>Vendor relationships fabricated</li>
      </ul>

      <blockquote>
        <p>"A single compromised agent poisoned 87% of downstream decision-making within 4 hours."</p>
        <cite>-- Research finding</cite>
      </blockquote>

      <p><strong>Prevention:</strong></p>
      <ul>
        <li>Validate external data before injection</li>
        <li>Use trusted sources only</li>
        <li>Implement data integrity checks</li>
        <li>Regular audits of agent beliefs</li>
      </ul>
    </section>

    <hr class="section-divider">

    <!-- Orchestration Errors -->
    <section id="orchestration-errors">
      <h2><span class="bionic">Orc</span>hestration and <span class="bionic">Mul</span>ti-Agent <span class="bionic">Err</span>ors</h2>

      <h3>Recursive Agent Explosion</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Property</th><th>Value</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Error Type</strong></td><td>DETERMINISTIC</td></tr>
            <tr><td><strong>Severity</strong></td><td>CRITICAL</td></tr>
            <tr><td><strong>Frequency</strong></td><td>Common without proper preambles</td></tr>
          </tbody>
        </table>
      </div>

      <p><strong>Symptoms:</strong></p>
      <ul>
        <li>Subagent depth exceeds 2-3 levels</li>
        <li>Context usage spikes unexpectedly</li>
        <li>Tasks taking 10x longer than expected</li>
        <li>Runaway API costs</li>
      </ul>

      <p><strong>Prevention - Worker Preamble:</strong></p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>CONTEXT: You are a WORKER agent, not an orchestrator.

RULES:
- Complete ONLY the task described below
- Use tools directly (Read, Write, Edit, Bash, etc.)
- Do NOT spawn sub-agents
- Do NOT call TaskCreate or TaskUpdate
- Report your results with absolute file paths</code></pre>
      </div>

      <h3>Orchestrator Role Violation</h3>

      <p><strong>Symptoms:</strong></p>
      <ul>
        <li>Orchestrator gets distracted by implementation details</li>
        <li>Role confusion between planning and execution</li>
        <li>Scope creep within orchestrator context</li>
        <li>Orchestrator context filling with file contents</li>
      </ul>

      <div class="callout callout-insight">
        <div class="callout-title">The Iron Law (CC Mirror)</div>
        <p>"YOU DO NOT WRITE CODE. YOU DO NOT RUN COMMANDS. YOU DO NOT EXPLORE CODEBASES. You are the CONDUCTOR. Your agents play the instruments."</p>
      </div>

      <p><strong>Tool Ownership Separation:</strong></p>
      <ul>
        <li><strong>Orchestrator uses:</strong> TaskCreate, TaskList, TaskGet, TaskUpdate, AskUserQuestion, Task (to spawn workers), Read (1-2 references max)</li>
        <li><strong>Workers use:</strong> Read, Write, Edit, Bash, Glob, Grep, WebFetch, WebSearch, LSP</li>
        <li><strong>Workers NEVER use:</strong> Task*, spawn sub-agents</li>
      </ul>

      <h3>Multi-Agent Error Amplification</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Failure Mode</th><th>Percentage</th></tr>
          </thead>
          <tbody>
            <tr><td>Specification problems</td><td>41.77%</td></tr>
            <tr><td>Coordination failures</td><td>36.94%</td></tr>
            <tr><td>Error amplification (independent agents)</td><td>17.2x</td></tr>
            <tr><td>Error amplification (centralized)</td><td>4.4x</td></tr>
          </tbody>
        </table>
      </div>

      <p><strong>Prevention:</strong></p>
      <ul>
        <li>Use hub-and-spoke (CC Mirror) over fully decentralized</li>
        <li>Add verification at every handoff point</li>
        <li>Implement circuit breakers for error detection</li>
      </ul>
    </section>

    <hr class="section-divider">

    <!-- Recovery Patterns -->
    <section id="recovery-patterns">
      <h2><span class="bionic">Rec</span>overy <span class="bionic">Pat</span>terns</h2>

      <h3>Pattern 1: Restart with Fresh Context</h3>

      <p><strong>When to Use:</strong> Context rot symptoms, quality degradation, post-compaction issues, API 400 errors</p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># 1. Save current work state
git add -A && git stash

# 2. Document what you were working on
echo "Working on: [describe task]" > /tmp/recovery-notes.txt

# 3. Try compaction first (may salvage session)
/compact

# 4. If quality doesn't improve, reset
/reset

# 5. If still bad, exit completely
exit

# 6. Start fresh session
claude

# 7. Restore context from files
# (Claude will see CLAUDE.md automatically)

# 8. Resume work
git stash pop</code></pre>
      </div>

      <div class="callout callout-insight">
        <div class="callout-title">Key Insight</div>
        <p>"Fresh context beats accumulated context. When in doubt, start over."</p>
      </div>

      <h3>Pattern 2: Resume from External State</h3>

      <p><strong>When to Use:</strong> Progress lost between iterations, session interrupted, need to continue after restart</p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Ralph pattern - state lives in files, not context

# Check current state
cat prd.json | jq '.userStories[] | select(.passes == false) | .title'
cat progress.txt | tail -20
git log --oneline -5

# Resume by reading state
claude "Read prd.json and progress.txt, continue from where we left off"</code></pre>
      </div>

      <h3>Pattern 3: Escalate to Simpler Model</h3>

      <p><strong>When to Use:</strong> Complex task failing repeatedly, budget constraints</p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Haiku for simple lookups (5-10 parallel)
# Sonnet for implementation (2-5 parallel)
# Opus for complex reasoning (1 sequential)

# If Haiku fails -> Retry with Sonnet
# If Sonnet fails -> Retry with Opus
# If Opus fails -> Escalate to human via AskUserQuestion</code></pre>
      </div>

      <h3>Pattern 4: Decompose Further</h3>

      <p><strong>When to Use:</strong> Task too complex for single iteration, context overflow on single task, stuck loop</p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>// BAD: Task too large
{
  "title": "Build entire auth system",
  "description": "Add login, signup, password reset, OAuth, 2FA..."
}

// GOOD: Decomposed tasks
[
  {
    "title": "Add users table migration",
    "description": "Create users table with email, password_hash",
    "priority": 1
  },
  {
    "title": "Implement password hashing",
    "description": "Add bcrypt hashing in src/auth/password.ts",
    "priority": 2
  },
  {
    "title": "Create login endpoint",
    "description": "POST /api/login that validates credentials",
    "priority": 3,
    "blockedBy": ["1", "2"]
  }
]</code></pre>
      </div>

      <p><strong>Task Sizing Rules:</strong></p>
      <ul>
        <li><strong>Too big:</strong> If you can't describe it in 2-3 sentences, split it</li>
        <li><strong>Just right:</strong> 100-500 lines of code change per task</li>
        <li><strong>Scope:</strong> 1-3 files modified per task</li>
      </ul>

      <h3>Pattern 5: Rollback and Retry</h3>

      <p><strong>When to Use:</strong> File corruption detected, wrong approach taken, need to undo recent changes</p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Check what changed
git status
git diff

# Discard changes to specific file
git checkout -- path/to/file.ts

# Or revert all changes
git checkout -- .

# If uncommitted work was stashed
git stash pop

# For more drastic recovery
git reset --hard HEAD</code></pre>
      </div>

      <h3>Pattern 6: Circuit Breaker</h3>

      <p><strong>When to Use:</strong> Preventing infinite loops, cost containment, quality threshold enforcement</p>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Phase</th><th>Default Limit</th><th>Trigger Action</th></tr>
          </thead>
          <tbody>
            <tr><td>Verify</td><td>3 attempts</td><td>Create bug ticket</td></tr>
            <tr><td>Plan</td><td>3 attempts</td><td>Escalate to human</td></tr>
            <tr><td>Code</td><td>3 attempts</td><td>Decompose task</td></tr>
            <tr><td>Test</td><td>5 attempts</td><td>Review test setup</td></tr>
            <tr><td>Per-issue</td><td>5 attempts</td><td>Mark blocked</td></tr>
            <tr><td>Consecutive failures</td><td>5</td><td>Stop entire marathon</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Mental Models -->
    <section id="mental-models">
      <h2><span class="bionic">Men</span>tal <span class="bionic">Mod</span>els</h2>

      <h3>Mental Model 1: The Checkpoint Climber</h3>

      <p>Mountain climbing with fixed checkpoints. Each checkpoint is a git commit. If you fall (error), you only fall back to the last checkpoint, not to the base.</p>

      <div class="ascii-diagram">
Summit (Task Complete)
    ^
    |
  --+-- Checkpoint 4 (git commit)
    |
    |   <- You fall here
    |
  --+-- Checkpoint 3 (git commit) <- You land here
    |
  --+-- Checkpoint 2 (git commit)
    |
  --+-- Checkpoint 1 (git commit)
    |
Base Camp (Initial state)
      </div>

      <p><strong>Application:</strong></p>
      <ul>
        <li>Commit early and often</li>
        <li>Each working state is a checkpoint</li>
        <li>Rollback is cheap and fast</li>
        <li>Never climb too far without a checkpoint</li>
      </ul>

      <h3>Mental Model 2: The Circuit Breaker</h3>

      <p>Electrical circuit breakers prevent house fires by cutting power when current exceeds safe levels. Claude Code circuit breakers prevent cost fires by stopping execution when failures exceed safe levels.</p>

      <div class="ascii-diagram">
CIRCUIT BREAKER STATES
======================

CLOSED (Normal Operation)
|-- Requests flow through
|-- Failures counted
+-- If failures > threshold -> OPEN

OPEN (Protection Mode)
|-- Requests blocked
|-- Cooling period starts
+-- After timeout -> HALF-OPEN

HALF-OPEN (Testing)
|-- Limited requests allowed
|-- If success -> CLOSED
+-- If failure -> OPEN
      </div>

      <h3>Mental Model 3: The Immune System</h3>

      <p>Your body has multiple layers of defense. Claude Code error handling should have multiple layers too.</p>

      <div class="ascii-diagram">
DEFENSE IN DEPTH
================

Layer 1: Prevention (Skin)
|-- .claudeignore (blocks sensitive files)
|-- Permission blocklist (blocks dangerous commands)
+-- CLAUDE.md (sets expectations)

Layer 2: Detection (Immune Cells)
|-- Context monitoring (Claude HUD)
|-- Stuck detection (no commits for N iterations)
+-- Cost monitoring (API dashboard)

Layer 3: Response (Antibodies)
|-- Circuit breakers (automatic stop)
|-- Rollback mechanisms (git checkout)
+-- Fresh context restart

Layer 4: Recovery (Healing)
|-- State restoration (progress.txt, prd.json)
|-- Resume from checkpoint
+-- Learnings captured for future
      </div>
    </section>

    <hr class="section-divider">

    <!-- Checkpoints -->
    <section id="checkpoints">
      <h2><span class="bionic">Pre</span>vention <span class="bionic">Che</span>ckpoints</h2>

      <!-- Checkpoint 1 -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint 1: Pre-Session Setup</div>
        <p><strong>Where you are:</strong> About to start a Claude Code session</p>
        <div class="code-block">
          <pre><code># Check git status
git status
# Should show: clean working directory or stashed changes

# Check .claudeignore exists
cat .claudeignore 2>/dev/null || echo "WARNING: No .claudeignore"

# Check CLAUDE.md exists
cat CLAUDE.md 2>/dev/null | head -5 || echo "WARNING: No CLAUDE.md"</code></pre>
        </div>
        <p><strong>Checklist:</strong></p>
        <ul>
          <li>Git working directory clean or stashed?</li>
          <li>On dedicated branch (not main/master)?</li>
          <li>.claudeignore excludes sensitive files?</li>
          <li>CLAUDE.md updated with current context?</li>
          <li>Dangerous commands blocked in permissions?</li>
        </ul>
      </div>

      <!-- Checkpoint 2 -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint 2: Mid-Session Monitoring</div>
        <p><strong>Where you are:</strong> Active Claude Code session</p>
        <p><strong>Warning Signs to Watch:</strong></p>
        <div class="table-responsive">
          <table>
            <thead>
              <tr><th>Red Flag</th><th>Severity</th><th>Action</th></tr>
            </thead>
            <tbody>
              <tr><td>Same file edited 5+ times</td><td>High</td><td>Stop, review, simplify task</td></tr>
              <tr><td>Context > 70%</td><td>High</td><td>Compact immediately</td></tr>
              <tr><td>Context > 90%</td><td>Critical</td><td>Stop, save state, fresh session</td></tr>
              <tr><td>No commits for 3+ iterations</td><td>Medium</td><td>Check for stuck task</td></tr>
              <tr><td>Claude referencing non-existent files</td><td>Critical</td><td>Reset session immediately</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Checkpoint 3 -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint 3: Post-Session Verification</div>
        <p><strong>Where you are:</strong> Claude session completed or paused</p>
        <div class="code-block">
          <pre><code># Check all changes
git diff

# Run verification suite
npm run typecheck && echo "Typecheck: PASS" || echo "Typecheck: FAIL"
npm test && echo "Tests: PASS" || echo "Tests: FAIL"</code></pre>
        </div>
        <p><strong>Checklist:</strong></p>
        <ul>
          <li>All changes reviewed via <code>git diff</code>?</li>
          <li>Tests passing: <code>npm test</code> exit code 0?</li>
          <li>Type checking passing: <code>npm run typecheck</code>?</li>
          <li>No security issues introduced?</li>
          <li>Session costs within budget?</li>
        </ul>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Troubleshooting Accordions -->
    <section id="troubleshooting">
      <h2><span class="bionic">Tro</span>ubleshooting <span class="bionic">Acc</span>ordions</h2>

      <details class="troubleshoot">
        <summary>Context Overflow - API Error 400</summary>
        <div>
          <p><strong>Symptoms:</strong> <code>API Error 400</code> messages, Claude becomes "completely unusable"</p>
          <p><strong>Cause:</strong> Conversation has exceeded maximum context window (200K tokens)</p>
          <p><strong>Solution:</strong></p>
          <ol>
            <li>You cannot continue this session</li>
            <li>Save any uncommitted work: <code>git stash</code></li>
            <li>Exit Claude Code: <code>exit</code></li>
            <li>Start fresh session</li>
            <li>Load essential context only</li>
          </ol>
          <p><strong>Prevention:</strong> Never work more than 2-3 hours without fresh context. Use Ralph pattern for long-running work.</p>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Infinite Loop - No Progress</summary>
        <div>
          <p><strong>Symptoms:</strong> Same file edited repeatedly, no commits for 3+ iterations, token consumption without output</p>
          <p><strong>Cause:</strong> Task is blocked, broken, or has unsatisfiable criteria</p>
          <p><strong>Solution:</strong></p>
          <ol>
            <li>Interrupt: <code>Ctrl+C</code></li>
            <li>If that doesn't work: <code>Ctrl+\</code></li>
            <li>If still running: <code>pkill -9 -f claude</code></li>
            <li>Fix the stuck task by simplifying it</li>
          </ol>
          <p><strong>Prevention:</strong> Always set <code>MAX_ITERATIONS</code>. Include timeout.</p>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Cost Runaway</summary>
        <div>
          <p><strong>Symptoms:</strong> API costs far exceed expectations, token usage in millions</p>
          <p><strong>Cause:</strong> No iteration limits, using Opus for everything, runaway loops</p>
          <p><strong>Solution:</strong></p>
          <ol>
            <li>Kill all Claude processes immediately: <code>pkill -f claude</code></li>
            <li>Check Anthropic dashboard</li>
            <li>Set hard budget limit in console</li>
            <li>Review what caused high usage</li>
          </ol>
          <p><strong>Prevention:</strong> Always set iteration limits. Use timeouts. Match model to task complexity.</p>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Credentials Exposed</summary>
        <div>
          <p><strong>Symptoms:</strong> API keys visible in conversation, passwords in logs, <code>.env</code> contents displayed</p>
          <p><strong>Cause:</strong> No <code>.claudeignore</code>, sensitive files readable by Claude</p>
          <p><strong>Solution:</strong></p>
          <ol>
            <li><strong>IMMEDIATELY</strong> rotate ALL exposed credentials</li>
            <li>Remove secrets from git history: <code>git filter-branch</code></li>
            <li>Add files to .claudeignore</li>
            <li>Never cat .env in Claude Code</li>
          </ol>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Workers Spawning Workers (Recursive Explosion)</summary>
        <div>
          <p><strong>Symptoms:</strong> Subagent depth exceeds 2-3 levels, context usage spikes, runaway costs</p>
          <p><strong>Cause:</strong> Workers not properly restricted</p>
          <p><strong>Solution:</strong></p>
          <ol>
            <li>Kill all Claude processes: <code>pkill -f claude</code></li>
            <li>Revert incomplete changes: <code>git checkout -- .</code></li>
            <li>Restart with proper worker preamble</li>
          </ol>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>PRD Status Doesn't Match Reality</summary>
        <div>
          <p><strong>Symptoms:</strong> Tasks marked <code>passes: true</code> but code is broken</p>
          <p><strong>Cause:</strong> PRD updates not tied to verification</p>
          <p><strong>Solution:</strong></p>
          <div class="code-block">
            <pre><code># Run all verification commands
npm test
npm run typecheck

# Reset PRD to match reality
cat prd.json | jq '.userStories[] |= .passes = false' > prd.json.tmp
mv prd.json.tmp prd.json</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Rate Limiting</summary>
        <div>
          <p><strong>Symptoms:</strong> <code>rate_limit</code> errors, API requests rejected</p>
          <p><strong>Cause:</strong> Exceeding API rate limits from heavy automation</p>
          <p><strong>Solution:</strong></p>
          <div class="code-block">
            <pre><code># Implement exponential backoff
RETRY_DELAY=5
if grep -q "rate_limit" output.txt; then
  DELAY=$((RETRY_DELAY * 2))
  echo "Rate limited, waiting ${DELAY}s..."
  sleep $DELAY
fi</code></pre>
          </div>
          <p><strong>Prevention:</strong> Add delays between iterations. Don't run multiple instances 24/7.</p>
        </div>
      </details>
    </section>

    <hr class="section-divider">

    <!-- Golden Rules -->
    <section id="golden-rules">
      <h2>The <span class="bionic">Gol</span>den <span class="bionic">Rul</span>es of Error Prevention</h2>

      <h3>Rule 1: Fresh Context Beats Extended Sessions</h3>
      <blockquote><p>"When in doubt, start over."</p></blockquote>
      <p>Context rot is inevitable. Fresh context per iteration (Ralph pattern) eliminates accumulated errors.</p>

      <h3>Rule 2: External State Beats Internal Memory</h3>
      <blockquote><p>"If it's not in a file, it doesn't exist."</p></blockquote>
      <p>Memory lives in progress.txt, prd.json, and git history - not in the conversation.</p>

      <h3>Rule 3: Verification Is Non-Negotiable</h3>
      <blockquote><p>"If you can't test it, don't mark it done."</p></blockquote>
      <p>Always verify with tests, typechecks, and exit codes before considering anything complete.</p>

      <h3>Rule 4: Iteration Limits Are Insurance</h3>
      <blockquote><p>"Always set max iterations."</p></blockquote>
      <p>Circuit breakers prevent $47,000 runaway loops.</p>

      <h3>Rule 5: Model Matching Saves Money</h3>
      <blockquote><p>"Haiku for lookups, Sonnet for code, Opus for architecture."</p></blockquote>
      <p>Using Opus for file searches is 60x more expensive than necessary.</p>

      <h3>Rule 6: Isolation Prevents Chaos</h3>
      <blockquote><p>"Worktrees for parallel agents."</p></blockquote>
      <p>Multiple agents on same files = merge conflict hell.</p>

      <h3>Rule 7: Permissions Prevent Disasters</h3>
      <blockquote><p>"Blocklist destructive commands."</p></blockquote>
      <p>Never whitelist <code>rm -rf</code>, <code>sudo</code>, or <code>git push --force</code>.</p>

      <h3>Rule 8: Backups Save Careers</h3>
      <blockquote><p>"Git commit often. Stash before experiments."</p></blockquote>
      <p>Every checkpoint is a potential recovery point.</p>

      <!-- Milestone -->
      <div class="milestone" style="background: linear-gradient(90deg, #6b9b7a 0%, #2a7d7d 100%); color: white; padding: 1rem 1.5rem; border-radius: 8px; text-align: center; margin: 2rem 0;">
        <strong>Error Taxonomy Complete!</strong><br>
        You now have the knowledge to diagnose, recover from, and prevent the most common Claude Code failures.
      </div>
    </section>

    <!-- Related Pages -->
    <div class="related-pages">
      <h3>Related Documents</h3>
      <ul>
        <li><a href="debugging-agent-failures.html">Debugging Guide</a> - Systematic diagnosis workflows</li>
        <li><a href="principles-anti-patterns.html">Anti-Patterns</a> - What NOT to do and why</li>
        <li><a href="cross-pattern-migration.html">Migration Guide</a> - Moving between patterns safely</li>
        <li><a href="master-playbook.html">Master Playbook</a> - Complete capability progression</li>
      </ul>
    </div>

    <!-- Footer Navigation -->
    <nav class="footer-nav">
      <a href="cross-pattern-migration.html" class="nav-prev">
        <span class="nav-direction">Previous</span>
        <span class="nav-title">Migration Guide</span>
      </a>
      <a href="debugging-agent-failures.html" class="nav-next">
        <span class="nav-direction">Next</span>
        <span class="nav-title">Debugging Guide</span>
      </a>
    </nav>

    <!-- Tags -->
    <div style="margin-top: 2rem;">
      <span class="tag">#error-taxonomy</span>
      <span class="tag">#recovery</span>
      <span class="tag">#failure-modes</span>
      <span class="tag">#troubleshooting</span>
      <span class="tag">#context-management</span>
      <span class="tag">#circuit-breakers</span>
      <span class="tag">#security</span>
      <span class="tag">#cost-optimization</span>
      <span class="tag">#verification</span>
    </div>
  </div>

  <script src="../js/copy-code.js"></script>
  <script src="../js/search.js"></script>
<script src="../js/global-nav.js"></script>
</body>
</html>
