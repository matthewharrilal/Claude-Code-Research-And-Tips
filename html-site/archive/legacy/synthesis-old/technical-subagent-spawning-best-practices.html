<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta data-pagefind-meta="section" content="Synthesis">
  <meta data-pagefind-meta="category" content="Technical">
  <title>Subagent Spawning Best Practices - Claude Code Knowledge Base</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/sidebar.css">
  <link rel="stylesheet" href="../css/search.css">
</head>
<body>
  <!-- Search Modal -->
  <div class="search-modal" id="searchModal" aria-hidden="true">
    <div class="search-overlay" onclick="closeSearch()"></div>
    <div class="search-content">
      <div class="search-header">
        <div class="search-input-wrapper">
          <span class="search-icon-input">&#128269;</span>
          <input type="text" id="searchInput" placeholder="Search documentation..." autocomplete="off" />
          <kbd class="search-kbd">ESC</kbd>
        </div>
      </div>
      <div class="search-filters">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="synthesis">Synthesis</button>
        <button class="filter-btn" data-filter="extractions">Extractions</button>
      </div>
      <div class="search-results" id="searchResults">
        <div class="search-empty"><p>Start typing to search... (Press Cmd+K anytime)</p></div>
      </div>
      <div class="search-footer">
        <span>Up/Down Navigate</span><span>Enter Select</span><span>ESC Close</span>
      </div>
    </div>
  </div>

  <button class="search-trigger" onclick="openSearch()" aria-label="Search" style="float: right; margin-bottom: 1rem;">
    <span class="search-icon">Cmd+K</span>
    <span class="search-text">Search</span>
  </button>

  <div class="wide-container">
    <!-- Breadcrumb Navigation -->
    <nav class="nav-breadcrumb">
      <a href="../index.html">Home</a>
      <span>/</span>
      <a href="synthesis-index.html">Synthesis</a>
      <span>/</span>
      <span>Technical</span>
      <span>/</span>
      <span>Subagent Spawning</span>
    </nav>

    <!-- You Are Here Context Box -->
    <div class="you-are-here" style="background: linear-gradient(135deg, #f0ebe3 0%, #fefcf3 100%); border-left: 4px solid #2a7d7d; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
      <h3 style="color: #2a7d7d; margin-top: 0; font-size: 0.9em; text-transform: uppercase; letter-spacing: 0.5px;">You Are Here</h3>
      <p style="margin-bottom: 0;"><strong>Technical depth guide</strong> for when, why, and how to spawn subagents in Claude Code. Covers spawning patterns (sequential, parallel, hybrid), coordination strategies, anti-patterns to avoid, model selection, and production patterns from Boris Cherny, Dan Shipper, and others.</p>
    </div>

    <h1><span style="font-weight: 700;">Sub</span>agent Spawning Best Practices</h1>

    <p class="conversational-lead">
      <span style="font-weight: 700;">"Sub</span>agents are colleagues you call in mid-stream, not tools you use for every small task."
    </p>

    <!-- Table of Contents -->
    <div class="toc">
      <div class="toc-title">Contents</div>
      <ul>
        <li><a href="#spawning-decision">The Spawning Decision Framework</a> - Core trade-offs and overhead</li>
        <li><a href="#when-to-spawn">When to Spawn: Decision Matrix</a> - Quick reference table</li>
        <li><a href="#spawning-patterns">Spawning Patterns</a> - Sequential, parallel, hybrid</li>
        <li><a href="#coordination">Coordination Strategies</a> - File-based, progress tracking</li>
        <li><a href="#anti-patterns">Anti-Patterns</a> - What NOT to do</li>
        <li><a href="#model-selection">Model Selection</a> - Haiku/Sonnet/Opus per task</li>
        <li><a href="#production-patterns">Production Patterns</a> - Boris Cherny, Dan Shipper</li>
        <li><a href="#troubleshooting">Troubleshooting</a> - Common problems and fixes</li>
      </ul>
    </div>

    <hr class="section-divider divider-context">

    <!-- Spawning Decision Section -->
    <section id="spawning-decision">
      <h2><span style="font-weight: 700;">The</span> Spawning Decision Framework</h2>

      <h3>The Core Trade-Off</h3>
      <p>Subagents provide <strong>context isolation</strong> but come with <strong>overhead costs</strong>:</p>

      <div class="ascii-diagram">
SUBAGENT OVERHEAD

FIXED COSTS (per spawn):
+-- Context initialization: ~2-5K tokens
+-- System prompt loading: ~1-3K tokens
+-- CLAUDE.md inheritance: ~1-2K tokens
+-- Tool initialization: ~1K tokens

VARIABLE COSTS:
+-- Task description passage: varies
+-- Result communication: varies
+-- Coordination overhead: depends on complexity

MINIMUM VIABLE SPAWN: ~5-10K tokens overhead
      </div>

      <h3>The Golden Rule</h3>
      <blockquote style="border-left: 3px solid #2a7d7d; padding-left: 1rem; margin: 1.5rem 0; font-style: italic; color: #5c4b3a;">
        "Using a subagent for a one-liner adds unnecessary overhead. Match the tool to the task complexity."
        <cite style="display: block; margin-top: 0.5rem; font-size: 0.9em;">-- Claude Code Mastery</cite>
      </blockquote>
      <p><strong>Break-even point:</strong> Tasks requiring ~15-20K+ tokens of focused work justify subagent spawn overhead.</p>
    </section>

    <hr class="section-divider divider-procedure">

    <!-- When to Spawn Section -->
    <section id="when-to-spawn">
      <h2><span style="font-weight: 700;">Whe</span>n to Spawn: Decision Matrix</h2>

      <h3>Quick Reference Table</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Scenario</th><th>Spawn?</th><th>Rationale</th></tr>
        </thead>
        <tbody>
          <tr><td>Single file, small change</td><td>NO</td><td>Main agent sufficient, overhead not justified</td></tr>
          <tr><td>Multiple independent files</td><td>YES</td><td>Parallel efficiency, no context pollution</td></tr>
          <tr><td>Research + implement</td><td>YES</td><td>Different skill profiles, research doesn't pollute implementation</td></tr>
          <tr><td>Complex refactor (coupled files)</td><td>MAYBE</td><td>Depends on coupling - tightly coupled = single agent better</td></tr>
          <tr><td>Testing + fixing</td><td>YES</td><td>Separate concerns, test output doesn't fill main context</td></tr>
          <tr><td>Code review</td><td>YES</td><td>Adversarial review benefits from separate context</td></tr>
          <tr><td>Simple grep/lookup</td><td>NO</td><td>Main agent tools sufficient</td></tr>
          <tr><td>Architecture decision</td><td>YES (multiple)</td><td>Benefits from parallel exploration and debate</td></tr>
          <tr><td>Documentation generation</td><td>MAYBE</td><td>If large, yes; if small update, no</td></tr>
          <tr><td>Security audit</td><td>YES</td><td>Specialized focus, shouldn't pollute main flow</td></tr>
        </tbody>
      </table>

      <h3>Decision Tree</h3>
      <div class="ascii-diagram">
START: Should I spawn a subagent?
|
+-- Will task take < 5K tokens of work?
|   +-- YES --> Main agent handles directly
|
+-- Does task need isolated context?
|   +-- YES --> Consider spawning
|       +-- Research that might go tangential?
|       +-- Review that should be adversarial?
|       +-- Heavy tool output (browser, large files)?
|       +-- Work that shouldn't pollute main conversation?
|
+-- Are there multiple independent subtasks?
|   +-- YES --> Spawn parallel subagents
|       +-- Different files with no dependencies?
|       +-- Multiple research directions?
|       +-- Parallel feature implementations?
|
+-- Is specialization valuable?
|   +-- YES --> Specialized subagent
|       +-- Security review (different mindset)
|       +-- Performance optimization (different focus)
|       +-- Test generation (systematic approach)
|
+-- END: Use main agent if none of above apply
      </div>

      <h3>The "Context Pollution" Test</h3>
      <div class="callout callout-insight">
        <div class="callout-title">Ask Yourself</div>
        <p style="margin-bottom: 0;"><strong>"If this task fails or takes 50 tool calls, will it ruin my main conversation?"</strong></p>
        <ul style="margin-bottom: 0;">
          <li><strong>If YES</strong> - Spawn a subagent to contain the potential mess</li>
          <li><strong>If NO</strong> - Main agent is fine</li>
        </ul>
      </div>

      <!-- Checkpoint -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint: The Spawning Decision</div>
        <p><strong>You should now understand:</strong></p>
        <ul>
          <li>Minimum viable spawn overhead (~5-10K tokens)</li>
          <li>Break-even point (~15-20K tokens of focused work)</li>
          <li>The "context pollution test" for spawn decisions</li>
          <li>When to spawn vs when main agent is sufficient</li>
        </ul>
      </div>
    </section>

    <hr class="section-divider divider-procedure">

    <!-- Spawning Patterns Section -->
    <section id="spawning-patterns">
      <h2><span style="font-weight: 700;">Spa</span>wning Patterns</h2>

      <h3>Sequential Spawning</h3>
      <p><strong>When:</strong> Tasks have dependencies, output of one feeds input of next.</p>

      <div class="ascii-diagram">
SEQUENTIAL PATTERN

Main Agent
    |
    +---> [Subagent 1: Research]
    |          |
    |          v Result
    |
    +---> [Subagent 2: Plan based on research]
    |          |
    |          v Result
    |
    +---> [Subagent 3: Implement based on plan]
               |
               v Result

Main Agent synthesizes final result
      </div>

      <p><strong>Best for:</strong></p>
      <ul>
        <li>Research -> Plan -> Implement workflows</li>
        <li>Tasks with clear phase dependencies</li>
        <li>When you need human review between phases</li>
      </ul>

      <h3>Parallel Spawning</h3>
      <p><strong>When:</strong> Tasks are independent, can run simultaneously.</p>

      <div class="ascii-diagram">
PARALLEL PATTERN

Main Agent (Orchestrator)
    |
    +------------+------------+------------+
    |            |            |            |
    v            v            v            v
[Subagent 1] [Subagent 2] [Subagent 3] [Subagent 4]
Frontend     Backend      Tests        Docs
    |            |            |            |
    +------------+------------+------------+
                     |
                     v
Main Agent collects and synthesizes results
      </div>

      <p><strong>Best for:</strong></p>
      <ul>
        <li>Independent feature pieces</li>
        <li>Multiple research directions</li>
        <li>Dan Shipper's "4 terminal" workflow: Frontend, Backend, Test, Docs</li>
      </ul>

      <div class="callout callout-warning">
        <div class="callout-title">Caution</div>
        <p style="margin-bottom: 0;">Parallel agents on <strong>same files</strong> cause conflicts. Use file ownership rules or git worktrees.</p>
      </div>

      <h3>Dependency Classification</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Type</th><th>Examples</th><th>Approach</th></tr>
        </thead>
        <tbody>
          <tr><td><strong>Independent</strong></td><td>Different files, different modules, research on separate topics</td><td>Parallelize</td></tr>
          <tr><td><strong>Dependent</strong></td><td>Schema change -> Backend -> Frontend, Interface -> Implementation</td><td>Serialize</td></tr>
          <tr><td><strong>Hybrid</strong></td><td>Schema -> (Backend || API Types) -> Frontend</td><td>Partial parallelism</td></tr>
        </tbody>
      </table>

      <!-- Checkpoint -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint: Pattern Selection</div>
        <p><strong>You should now understand:</strong></p>
        <ul>
          <li>Sequential vs parallel vs hybrid spawning patterns</li>
          <li>Independent vs dependent task classification</li>
          <li>File-based, prompt-based, and git-based context sharing</li>
        </ul>
      </div>
    </section>

    <hr class="section-divider divider-procedure">

    <!-- Coordination Section -->
    <section id="coordination">
      <h2><span style="font-weight: 700;">Coo</span>rdination Strategies</h2>

      <h3>File-Based Coordination</h3>
      <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
        <pre style="margin: 0; overflow-x: auto;"><code>project/
+-- .agent-context/
|   +-- research-findings.md      # Subagent 1 writes, others read
|   +-- implementation-plan.md    # Subagent 2 writes, coder reads
|   +-- progress.json             # All agents update
|   +-- handoff-notes.md          # Inter-agent communication</code></pre>
      </div>

      <h3>Status File Format</h3>
      <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; position: relative; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
        <button class="copy-btn" onclick="copyCode(this)" style="position: absolute; top: 0.5rem; right: 0.5rem; background: #2a7d7d; color: white; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer;">Copy</button>
        <pre style="margin: 0; overflow-x: auto;"><code>{
  "agent_id": "coder-1",
  "current_task": "US-003: Implement login endpoint",
  "status": "in_progress",
  "started_at": "2026-01-13T10:30:00Z",
  "files_touching": ["src/api/auth.ts", "src/models/user.ts"],
  "blockers": [],
  "progress_pct": 60,
  "notes": "Found existing auth utilities in src/utils/auth.ts, will reuse"
}</code></pre>
      </div>

      <h3>The progress.txt Pattern (from Ralph)</h3>
      <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; position: relative; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
        <button class="copy-btn" onclick="copyCode(this)" style="position: absolute; top: 0.5rem; right: 0.5rem; background: #2a7d7d; color: white; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer;">Copy</button>
        <pre style="margin: 0; overflow-x: auto;"><code># Progress Log - Append Only

## 2026-01-13 10:30 - Coder-1
- Completed: User model with email/password fields
- Learning: Team prefers Zod for validation (found in existing code)
- Next: Need to implement password hashing

## 2026-01-13 10:45 - Coder-1
- Completed: Password hashing with bcrypt (12 rounds per CLAUDE.md)
- Blocker: None
- Next: Login endpoint

## 2026-01-13 11:00 - Coder-2
- Completed: Registration form component
- Learning: Using existing Button component from src/components/ui
- Note for Coder-1: I'm expecting POST /api/auth/register endpoint</code></pre>
      </div>

      <h3>Error Handling Protocol</h3>
      <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; position: relative; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
        <button class="copy-btn" onclick="copyCode(this)" style="position: absolute; top: 0.5rem; right: 0.5rem; background: #2a7d7d; color: white; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer;">Copy</button>
        <pre style="margin: 0; overflow-x: auto;"><code>## Error Handling for Subagents

When you encounter an error:

1. DO NOT repeatedly retry the same approach
2. Log the error to .agent-context/errors.md with:
   - What you tried
   - What failed
   - Your hypothesis about why
3. If blocked for 3+ attempts, signal for human help:
   "BLOCKED: [description of issue]"
4. Continue with other tasks if possible</code></pre>
      </div>
    </section>

    <hr class="section-divider divider-warning">

    <!-- Anti-Patterns Section -->
    <section id="anti-patterns">
      <h2><span style="font-weight: 700;">Ant</span>i-Patterns and Better Alternatives</h2>

      <h3>Anti-Pattern 1: Over-Spawning</h3>
      <p><strong>The Problem:</strong> Subagents add overhead. Spawning for trivial tasks wastes tokens and time.</p>

      <table class="comparison-table">
        <thead>
          <tr><th>Bad</th><th>Better</th></tr>
        </thead>
        <tbody>
          <tr>
            <td>Spawn subagent for: "Add a comment to line 42" (~5-10K overhead for 10-token change)</td>
            <td>Main agent uses Edit tool directly</td>
          </tr>
        </tbody>
      </table>
      <p><strong>Rule of Thumb:</strong> If the task description is longer than the likely implementation, don't spawn.</p>

      <h3>Anti-Pattern 2: Context Pollution</h3>
      <p><strong>The Problem:</strong> Passing too much context to subagents or letting subagent output flood orchestrator.</p>

      <table class="comparison-table">
        <thead>
          <tr><th>Bad</th><th>Better</th></tr>
        </thead>
        <tbody>
          <tr>
            <td>Pass 50K tokens of codebase docs to subagent for simple button change</td>
            <td>Pass minimal, relevant context: specific file paths, constraints, patterns to follow</td>
          </tr>
        </tbody>
      </table>

      <h3>Anti-Pattern 3: Missing Coordination</h3>
      <p><strong>The Problem:</strong> Parallel subagents editing same files without awareness of each other.</p>

      <table class="comparison-table">
        <thead>
          <tr><th>Bad</th><th>Better Options</th></tr>
        </thead>
        <tbody>
          <tr>
            <td>Spawn parallel agents both modifying src/auth.ts</td>
            <td>1) Sequential for same-file work<br>2) File ownership rules<br>3) Git worktrees for true isolation</td>
          </tr>
        </tbody>
      </table>

      <h3>Anti-Pattern 4: Deep Nesting</h3>
      <p><strong>The Problem:</strong> Subagents spawning sub-subagents, creating recursive depth and cost explosion.</p>

      <div class="ascii-diagram">
BAD: Deep Nesting
Main Agent
+-- Subagent 1 (spawns)
    +-- Sub-subagent A (spawns)
        +-- Sub-sub-subagent X
# Each level adds overhead, control is lost
      </div>

      <p><strong>Better:</strong> Always include worker preamble that prevents recursive spawning:</p>
      <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; position: relative; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
        <button class="copy-btn" onclick="copyCode(this)" style="position: absolute; top: 0.5rem; right: 0.5rem; background: #2a7d7d; color: white; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer;">Copy</button>
        <pre style="margin: 0; overflow-x: auto;"><code># Worker Preamble (prevents recursive spawning)

CONTEXT: You are a WORKER agent, not an orchestrator.

RULES:
- Complete ONLY the task described below
- Use tools directly (Read, Write, Edit, Bash, etc.)
- Do NOT spawn sub-agents
- Do NOT call TaskCreate or TaskUpdate
- Report your results with absolute file paths

TASK:
[Your specific task here]</code></pre>
      </div>
      <p><strong>Maximum recommended depth:</strong> 2 levels (Orchestrator -> Worker)</p>
    </section>

    <hr class="section-divider divider-procedure">

    <!-- Model Selection Section -->
    <section id="model-selection">
      <h2><span style="font-weight: 700;">Mod</span>el Selection for Subagents</h2>

      <div class="ascii-diagram">
MODEL SELECTION GUIDE

HAIKU (Fast, Cheap)
+-- File lookups and grep operations
+-- Simple data transformations
+-- Status checks and validation
+-- Documentation lookups
+-- Spawn 5-10 in parallel for research sweeps

SONNET (Balanced)
+-- Standard implementation tasks
+-- Test generation
+-- Code following established patterns
+-- Bug fixes with clear reproduction
+-- Documentation generation

OPUS (Deep Reasoning)
+-- Architecture decisions
+-- Complex debugging with ambiguous symptoms
+-- Security review
+-- Performance optimization
+-- Novel problem solving
+-- Tasks requiring extended thinking
      </div>

      <h3>Cost Comparison</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Model</th><th>Input (per 1M)</th><th>Output (per 1M)</th><th>Typical Task Cost</th></tr>
        </thead>
        <tbody>
          <tr><td>Haiku</td><td>$0.25</td><td>$1.25</td><td>$0.01-0.05</td></tr>
          <tr><td>Sonnet</td><td>$3.00</td><td>$15.00</td><td>$0.10-0.50</td></tr>
          <tr><td>Opus</td><td>$15.00</td><td>$75.00</td><td>$0.50-2.00</td></tr>
        </tbody>
      </table>

      <h3>The Multi-Model Swarm Pattern</h3>
      <p>From Dan Shipper's Compound Engineering:</p>
      <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
        <pre style="margin: 0; overflow-x: auto;"><code># Phase 1: Parallel Haiku research (cheap exploration)
for search_area in ["src/api/", "src/utils/", "src/models/"]:
    Spawn Haiku: "Search {search_area} for authentication-related code"

# Phase 2: Sonnet implementation (based on Haiku findings)
Spawn Sonnet: "Based on research findings, implement the login endpoint"</code></pre>
      </div>
    </section>

    <hr class="section-divider divider-procedure">

    <!-- Production Patterns Section -->
    <section id="production-patterns">
      <h2><span style="font-weight: 700;">Pro</span>duction Patterns</h2>

      <h3>Boris Cherny's Multiple Reviewers Pattern</h3>
      <p>From the Claude Code creator's workflow:</p>
      <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; position: relative; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
        <button class="copy-btn" onclick="copyCode(this)" style="position: absolute; top: 0.5rem; right: 0.5rem; background: #2a7d7d; color: white; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer;">Copy</button>
        <pre style="margin: 0; overflow-x: auto;"><code># Spawn multiple review subagents with different perspectives
reviewers = [
    ("security", "Review for security vulnerabilities, injection attacks, auth issues"),
    ("performance", "Review for N+1 queries, memory leaks, slow patterns"),
    ("maintainability", "Review for code clarity, naming, abstraction levels"),
    ("correctness", "Review for logic errors, edge cases, type safety")
]

for reviewer_type, focus in reviewers:
    Spawn reviewer with focus and ask for:
    - CRITICAL: Must fix before merge
    - IMPORTANT: Should fix
    - SUGGESTION: Nice to have</code></pre>
      </div>

      <h3>Dan Shipper's 4-Terminal Workflow</h3>
      <div class="ascii-diagram">
4-TERMINAL PATTERN

Terminal 1: Frontend Specialist
+-- Focus: UI components, styling, user interactions
+-- Files: src/components/, src/pages/
+-- Tools: Browser preview, Playwright

Terminal 2: Backend Specialist
+-- Focus: API endpoints, business logic, database
+-- Files: src/api/, src/models/, src/services/
+-- Tools: curl, database queries

Terminal 3: Test Specialist
+-- Focus: Unit tests, integration tests, E2E tests
+-- Files: tests/, __tests__/
+-- Tools: Jest, Playwright

Terminal 4: Docs/Review Specialist
+-- Focus: Documentation, code review, CLAUDE.md updates
+-- Files: docs/, README, CLAUDE.md
+-- Tools: Read-only access to all

Coordination: File-based handoffs, git branches
      </div>

      <h3>The "Team with Daily Amnesia" Model</h3>
      <p>Treating agents as team members who forget everything overnight:</p>
      <ul>
        <li><strong>Everything in files</strong> - No reliance on conversation memory</li>
        <li><strong>Self-contained tasks</strong> - Each task includes all needed context</li>
        <li><strong>Explicit handoffs</strong> - Write handoff notes for the "next person"</li>
        <li><strong>Idempotent operations</strong> - Running same task twice is safe</li>
      </ul>
    </section>

    <hr class="section-divider divider-warning">

    <!-- Troubleshooting Section -->
    <section id="troubleshooting">
      <h2><span style="font-weight: 700;">Tro</span>ubleshooting</h2>

      <details class="troubleshoot" style="border: 1px solid #c97065; border-radius: 8px; margin: 1rem 0;">
        <summary style="background: #fef6f5; padding: 1rem; cursor: pointer; color: #c97065; font-weight: 600;">Subagent produces wrong output, ignores instructions</summary>
        <div style="padding: 1rem;">
          <p><strong>Symptoms:</strong> Worker agent returns unrelated work or misses key requirements.</p>
          <p><strong>Cause:</strong> Instructions too long, buried in noise, or context exceeded.</p>
          <p><strong>Fix:</strong> Structure worker prompts with clear hierarchy:</p>
          <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
            <pre style="margin: 0;"><code>## ROLE (who you are)
You are a WORKER agent...

## TASK (exactly what to do - put this EARLY)
Implement the login form component.

## CONSTRAINTS (what NOT to do)
- Do NOT spawn sub-agents
- Do NOT modify files outside src/components/

## CONTEXT (supporting info - can be longer)
[Relevant background...]

# Rule: Task description should be in first 500 words</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot" style="border: 1px solid #c97065; border-radius: 8px; margin: 1rem 0;">
        <summary style="background: #fef6f5; padding: 1rem; cursor: pointer; color: #c97065; font-weight: 600;">Parallel workers produce conflicting changes</summary>
        <div style="padding: 1rem;">
          <p><strong>Symptoms:</strong> Git conflicts, or one worker overwrites another's changes.</p>
          <p><strong>Cause:</strong> No file ownership rules, or workers touching shared resources.</p>
          <p><strong>Fix Options:</strong></p>
          <ol>
            <li><strong>Explicit file ownership:</strong> In each worker's prompt, specify which files they own</li>
            <li><strong>Git worktrees:</strong> True isolation - each worker in separate worktree, merge later</li>
            <li><strong>Sequential:</strong> If workers must touch same file, serialize them</li>
          </ol>
        </div>
      </details>

      <details class="troubleshoot" style="border: 1px solid #c97065; border-radius: 8px; margin: 1rem 0;">
        <summary style="background: #fef6f5; padding: 1rem; cursor: pointer; color: #c97065; font-weight: 600;">Can't tell when subagent finished</summary>
        <div style="padding: 1rem;">
          <p><strong>Symptoms:</strong> Main agent waiting indefinitely, or checking too early/often.</p>
          <p><strong>Cause:</strong> No completion signal protocol.</p>
          <p><strong>Fix:</strong> Require structured completion output:</p>
          <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
            <pre style="margin: 0;"><code># In worker preamble:
When complete, output EXACTLY:
{
  "status": "complete",
  "files_modified": ["..."],
  "summary": "..."
}</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot" style="border: 1px solid #c97065; border-radius: 8px; margin: 1rem 0;">
        <summary style="background: #fef6f5; padding: 1rem; cursor: pointer; color: #c97065; font-weight: 600;">Subagent spawned sub-subagents, costs exploded</summary>
        <div style="padding: 1rem;">
          <p><strong>Symptoms:</strong> Unexpected depth of agents, $50+ bill from one task.</p>
          <p><strong>Cause:</strong> Missing worker preamble that prevents recursive spawning.</p>
          <p><strong>Fix:</strong> ALWAYS include in worker preamble:</p>
          <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
            <pre style="margin: 0;"><code>RULES:
- Complete ONLY the task described below
- Use tools directly (Read, Write, Edit, Bash)
- Do NOT spawn sub-agents
- Do NOT call TaskCreate or TaskUpdate
- You are a WORKER, not an orchestrator</code></pre>
          </div>
        </div>
      </details>
    </section>

    <hr class="section-divider divider-checkpoint">

    <!-- Summary Section -->
    <section>
      <h2><span style="font-weight: 700;">Sum</span>mary: The Spawning Philosophy</h2>

      <div class="ascii-diagram">
SPAWN when:
+-- Context isolation is valuable
+-- Tasks are parallel and independent
+-- Specialization improves quality
+-- Heavy tool output would flood main context

DON'T SPAWN when:
+-- Task is simple (< 5K tokens)
+-- Main agent has all needed context
+-- Overhead exceeds benefit
+-- Tasks are tightly coupled (serialize instead)

COORDINATE via:
+-- File-based status and progress
+-- Git for persistent state
+-- Clear handoff protocols
+-- Worker preambles preventing recursion
      </div>

      <!-- Milestone -->
      <div class="milestone" style="background: linear-gradient(90deg, #6b9b7a 0%, #2a7d7d 100%); color: white; padding: 1rem 1.5rem; border-radius: 8px; text-align: center; margin: 2rem 0;">
        Subagents are colleagues you call in mid-stream, not tools for every small task.
      </div>
    </section>

    <!-- Related Pages -->
    <div class="related-pages" style="margin-top: 2rem; padding: 1rem; background: #f9f6f0; border-radius: 8px;">
      <h4 style="margin-top: 0;">Related Documents</h4>
      <ul>
        <li><a href="mastery-multi-agent.html">Multi-Agent Mastery</a> - Orchestration patterns</li>
        <li><a href="technical-context-management-advanced.html">Advanced Context Management</a> - Context budget and recovery</li>
        <li><a href="reference-cost-economics.html">Cost Economics</a> - Model pricing and optimization</li>
      </ul>
      <h4>Key Sources</h4>
      <ul>
        <li>Boris Cherny - Claude Code creator, reviewer patterns</li>
        <li>Dan Shipper - Compound Engineering, 4-terminal workflow</li>
        <li>CC Mirror documentation - Worker preamble, orchestration</li>
      </ul>
    </div>

    <!-- Footer Navigation -->
    <div class="footer-nav" style="display: flex; justify-content: space-between; margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #e0d5c5;">
      <a href="technical-context-management-advanced.html">Prev: Advanced Context Management</a>
      <a href="tooling-observability-guide.html">Next: Observability Guide</a>
    </div>

  </div>

  <script src="../js/copy-code.js"></script>
  <script src="../js/search.js"></script>
  <script>
    function copyCode(button) {
      const codeBlock = button.parentElement.querySelector('code');
      navigator.clipboard.writeText(codeBlock.textContent);
      button.textContent = 'Copied!';
      setTimeout(() => button.textContent = 'Copy', 2000);
    }
  </script>
<script src="../js/global-nav.js"></script>
</body>
</html>
