<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta data-pagefind-meta="section" content="Synthesis">
  <meta data-pagefind-meta="category" content="Transformations">
  <title>Manual Context to Filesystem State | Transformations | Claude Code Knowledge Base</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/sidebar.css">
  <link rel="stylesheet" href="../css/search.css">
  <style>
    .you-are-here {
      background: linear-gradient(135deg, #f0ebe3 0%, #fefcf3 100%);
      border-left: 4px solid #2a7d7d;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 2rem;
    }
    .bionic { font-weight: 700; }
    .checkpoint {
      background: #f0ebe3;
      border-left: 4px solid #6b9b7a;
      border-radius: 8px;
      padding: 1.5rem;
      margin: 2rem 0;
    }
    .checkpoint-header { color: #6b9b7a; font-weight: 600; margin-bottom: 0.5rem; }
    .milestone {
      background: linear-gradient(90deg, #6b9b7a 0%, #2a7d7d 100%);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      text-align: center;
      margin: 2rem 0;
    }
    .before-after-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin: 24px 0;
    }
    @media (max-width: 900px) {
      .before-after-container { grid-template-columns: 1fr; }
    }
    .before-box, .after-box {
      border-radius: 12px;
      padding: 20px;
    }
    .before-box {
      background: #fdf0ef;
      border: 2px solid var(--error);
    }
    .before-box h3, .before-box h4 { color: var(--error); margin-top: 0; }
    .after-box {
      background: #eef6f0;
      border: 2px solid var(--success);
    }
    .after-box h3, .after-box h4 { color: var(--success); margin-top: 0; }
    .code-block-wrapper {
      position: relative;
    }
    .troubleshoot {
      border: 1px solid #c97065;
      border-radius: 8px;
      margin: 1rem 0;
    }
    .troubleshoot summary {
      background: #fef6f5;
      padding: 1rem;
      cursor: pointer;
      color: #c97065;
      font-weight: 600;
    }
    .troubleshoot > div {
      padding: 1rem;
    }
    .d-final-box {
      background: #f5f0e8;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem 0;
      font-size: 0.9em;
    }
    .d-final-box h4 {
      margin-top: 0;
      color: var(--heading);
    }
    .architecture-diagram {
      background: var(--code-bg);
      border-radius: 8px;
      padding: 20px;
      margin: 24px 0;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 0.85em;
      line-height: 1.4;
    }
    .file-tree {
      background: var(--code-bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px 20px;
      margin: 16px 0;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <!-- Search Modal -->
  <div class="search-modal" id="searchModal" aria-hidden="true">
    <div class="search-overlay" onclick="closeSearch()"></div>
    <div class="search-content">
      <div class="search-header">
        <div class="search-input-wrapper">
          <span class="search-icon-input">&#128269;</span>
          <input type="text" id="searchInput" placeholder="Search documentation..." autocomplete="off" />
          <kbd class="search-kbd">ESC</kbd>
        </div>
      </div>
      <div class="search-filters">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="synthesis">Synthesis</button>
        <button class="filter-btn" data-filter="extractions">Extractions</button>
        <button class="filter-btn" data-filter="journeys">Journeys</button>
      </div>
      <div class="search-results" id="searchResults">
        <div class="search-empty"><p>Start typing to search... (Press Cmd+K anytime)</p></div>
      </div>
      <div class="search-footer">
        <span>Up/Down Navigate</span><span>Enter Select</span><span>ESC Close</span>
      </div>
    </div>
  </div>

  <button class="search-trigger" onclick="openSearch()" aria-label="Search" style="float: right; margin-bottom: 1rem;">
    <span class="search-icon">Cmd+K</span>
    <span class="search-text">Search</span>
  </button>

  <nav class="left-nav" id="leftNav">
    <div class="px-4 mb-4">
      <a href="../index.html" class="text-xs font-semibold text-accent hover:text-accent-light uppercase tracking-wider">Claude Code KB</a>
    </div>
    <div class="nav-content"></div>
  </nav>

  <div class="container">
    <nav class="nav-breadcrumb">
      <a href="../index.html">Home</a>
      <span>/</span>
      <a href="synthesis-index.html">Synthesis</a>
      <span>/</span>
      <a href="transform-master.html">Transformations</a>
      <span>/</span>
      <strong>Manual to Filesystem</strong>
    </nav>

    <h1><span class="bionic">Tra</span>nsformation: <span class="bionic">Man</span>ual <span class="bionic">Con</span>text to <span class="bionic">Fil</span>esystem <span class="bionic">Sta</span>te</h1>

    <div class="you-are-here">
      <h3 style="margin-top: 0; color: var(--accent);"><span class="bionic">You</span> Are <span class="bionic">Her</span>e</h3>
      <p>This document shows how to stop losing knowledge between sessions by moving state from your brain and Claude's context window into persistent files. If you find yourself re-explaining the same patterns every session or forgetting discoveries you made last week, this transformation is essential. This is the foundation for all autonomous patterns (Ralph, CC Mirror) and connects to INV-2 (External state over internal memory) on the invariant list.</p>
    </div>

    <div class="d-final-box">
      <h4>D-FINAL Integration</h4>
      <p><strong>Validates invariants:</strong> INV-2 (External state over internal memory), INV-9 (Learning must compound), INV-11 (Ralph Mindset - files carry state)</p>
      <p><strong>Maps to complexity ladder:</strong> Level 0-1 (Manual/Single Session) to Level 2+ (Ralph and beyond)</p>
      <p><strong>Cross-references:</strong> <a href="principles-core.html">Core Principles</a>, <a href="mastery-ralph-complete.html">Ralph Complete Guide</a></p>
    </div>

    <div class="toc">
      <div class="toc-title">Contents</div>
      <ul>
        <li><a href="#the-problem">The Problem</a></li>
        <li><a href="#before">BEFORE: Manual Context Management</a></li>
        <li><a href="#after">AFTER: Filesystem State</a></li>
        <li><a href="#architecture">Filesystem State Architecture</a></li>
        <li><a href="#benefits">The Transformation Benefits</a></li>
        <li><a href="#migration">Migration Checklist</a></li>
        <li><a href="#templates">Quick Reference: File Templates</a></li>
        <li><a href="#mental-model">The Mental Model</a></li>
        <li><a href="#troubleshooting">Troubleshooting</a></li>
      </ul>
    </div>

    <hr class="section-divider">

    <h2 id="the-problem">The <span class="bionic">Pro</span>blem</h2>

    <p>You're building a complex feature across multiple sessions and need to track:</p>
    <ul>
      <li>What's done and what's next</li>
      <li>Patterns you've discovered in this codebase</li>
      <li>Decisions made and why</li>
      <li>Learnings that should persist</li>
    </ul>

    <p><strong>The question: Where does this knowledge live?</strong></p>

    <hr class="section-divider">

    <h2 id="before"><span class="bionic">BEF</span>ORE: <span class="bionic">Man</span>ual <span class="bionic">Con</span>text <span class="bionic">Man</span>agement</h2>

    <div class="before-box" style="margin: 24px 0;">
      <h3>The Approach</h3>
      <div class="architecture-diagram">
[Your Brain] -----&gt; [Claude Session] -----&gt; [Code Changes]
     |                    |
     |                    v
     |              Session ends
     |                    |
     v                    v
  Remembers?         [Knowledge Lost]
      </div>
      <p>You keep state in your head:</p>
      <ul>
        <li>"I was working on the auth module"</li>
        <li>"I discovered we use bcrypt 12 rounds here"</li>
        <li>"US-003 is blocked by that migration bug"</li>
        <li>"The pattern for new routes is..."</li>
      </ul>
    </div>

    <h3>What This <span class="bionic">Loo</span>ks Like</h3>

    <p><strong>Starting a new session:</strong></p>
    <div class="code-block-wrapper">
      <pre><code>Human: I'm continuing work on the user dashboard.
Yesterday we finished the login form (US-001).
We learned that server actions are required for forms.
The migration pattern uses IF NOT EXISTS.
Today we need to do US-002 (profile page).
Also remember that types go in actions.ts...</code></pre>
    </div>

    <p><strong>Every. Single. Session.</strong></p>

    <h3>The <span class="bionic">Pro</span>blems</h3>

    <div class="table-responsive">
      <table>
        <thead>
          <tr>
            <th>Problem</th>
            <th>Impact</th>
          </tr>
        </thead>
        <tbody>
          <tr><td><strong>Context lost on clear/compact</strong></td><td>Start over explaining everything</td></tr>
          <tr><td><strong>Human memory limits</strong></td><td>Forget discoveries, repeat mistakes</td></tr>
          <tr><td><strong>No compounding learning</strong></td><td>Each session starts from zero</td></tr>
          <tr><td><strong>Tribal knowledge</strong></td><td>Only you know the patterns</td></tr>
          <tr><td><strong>Session-dependent</strong></td><td>Can't hand off to another agent</td></tr>
        </tbody>
      </table>
    </div>

    <h3>The <span class="bionic">Fai</span>lure Mode</h3>

    <div class="code-block-wrapper">
      <pre><code>Session 1: Discover bcrypt needs 12 rounds (the hard way)
Session 2: Forget, use default 10 rounds
Session 3: Debug production auth issues
Session 4: Rediscover bcrypt needs 12 rounds</code></pre>
    </div>

    <p><strong>Knowledge doesn't compound. You're running in circles.</strong></p>

    <hr class="section-divider">

    <h2 id="after"><span class="bionic">AFT</span>ER: <span class="bionic">Fil</span>esystem <span class="bionic">Sta</span>te</h2>

    <div class="after-box" style="margin: 24px 0;">
      <h3>The New Architecture</h3>
      <div class="architecture-diagram">
[Filesystem State] &lt;---&gt; [Claude Session] -----&gt; [Code Changes]
       |                        |                      |
       v                        v                      v
  [Persists]              [Reads State]          [Updates State]
       |                        |                      |
       +------------------------+----------------------+
                    |
              [Compounds Over Time]
      </div>
      <p><strong>State lives in files. Sessions read and write. Knowledge persists.</strong></p>
    </div>

    <h3><span class="bionic">Sta</span>te <span class="bionic">Fil</span>es</h3>

    <div class="tutorial-block">
      <div class="tutorial-header">scripts/ralph/progress.txt - Session Memory</div>
      <div class="tutorial-content">
        <div class="code-block-wrapper">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code># Progress Log
Project: User Dashboard
Started: 2026-01-09

## Codebase Patterns Discovered
- Migrations: Always use IF NOT EXISTS (learned from failed deploy)
- Types: Export from actions.ts, import in components
- React: useRef&lt;Timeout | null&gt;(null) for timer refs
- Forms: Server actions required, not API routes
- Auth: bcrypt rounds = 12 (security requirement)

## Session Log

### 2026-01-09 - US-001: Login Form
- Status: COMPLETE
- Files modified:
  - app/login/page.tsx
  - lib/actions/auth.ts
  - lib/schemas/auth.ts
- Learnings:
  - Server actions handle form submission
  - Zod validation happens server-side
  - Toast notifications via sonner
- Time: ~2 hours
---

### 2026-01-09 - US-002: Profile Page
- Status: IN PROGRESS
- Files modified:
  - app/profile/page.tsx (started)
- Blocked by: Need to understand image upload pattern
- Next: Check how settings page handles uploads
---</code></pre>
        </div>
      </div>
    </div>

    <div class="tutorial-block">
      <div class="tutorial-header">scripts/ralph/prd.json - Task State</div>
      <div class="tutorial-content">
        <div class="code-block-wrapper">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code>{
  "project": "User Dashboard",
  "lastUpdated": "2026-01-09T14:30:00Z",
  "userStories": [
    {
      "id": "US-001",
      "title": "Login Form",
      "status": "complete",
      "passes": true,
      "completedAt": "2026-01-09T10:00:00Z"
    },
    {
      "id": "US-002",
      "title": "Profile Page",
      "status": "in_progress",
      "passes": false,
      "blockers": ["image-upload-pattern"]
    },
    {
      "id": "US-003",
      "title": "Settings Page",
      "status": "pending",
      "passes": false,
      "dependencies": ["US-002"]
    }
  ],
  "discoveries": {
    "patterns": ["server-actions-for-forms", "bcrypt-12-rounds"],
    "antipatterns": ["api-routes-for-forms", "inline-validation"]
  }
}</code></pre>
        </div>
      </div>
    </div>

    <div class="tutorial-block">
      <div class="tutorial-header">AGENTS.md - Permanent Learnings</div>
      <div class="tutorial-content">
        <div class="code-block-wrapper">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code># Agent Learnings

This file contains patterns and knowledge discovered through development.
Read before starting work. Update when you learn something new.

## Authentication Module

### Security Requirements
- Password hashing: bcrypt with minimum 12 rounds
- Session tokens: 7-day expiry, refresh on activity
- Rate limiting: 5 attempts per 15 minutes

### Patterns
- All auth actions in `lib/actions/auth.ts`
- Schemas in `lib/schemas/auth.ts`
- Use `getServerSession()` not `useSession()` in server components

## Database

### Migration Patterns
- Always use `IF NOT EXISTS` for table creation
- Always use `IF EXISTS` for drops
- Name format: `YYYYMMDD_description.sql`
- Test migrations against production clone before deploy

### Query Patterns
- Use prepared statements exclusively
- Connection pooling via `lib/db/pool.ts`
- Transactions for multi-table operations

## Frontend

### Form Handling
- Server actions, not API routes
- Zod validation server-side
- `useFormState` + `useFormStatus` for state
- Toast feedback via sonner

### Component Patterns
- Ref typing: `useRef&lt;HTMLElement | null&gt;(null)`
- Timer refs: `useRef&lt;Timeout | null&gt;(null)`
- Cleanup in useEffect return</code></pre>
        </div>
      </div>
    </div>

    <h3><span class="bionic">Sta</span>rting a New <span class="bionic">Ses</span>sion Now</h3>

    <div class="code-block-wrapper">
      <pre><code>Human: Continue work on user dashboard

[Claude reads progress.txt, prd.json, AGENTS.md]

Claude: I see we completed US-001 (login form) and US-002 (profile page)
is in progress, blocked on the image upload pattern. Let me check the
settings page to understand how uploads work here, then continue with
the profile page.</code></pre>
    </div>

    <div class="milestone">
      Zero context re-explanation. Knowledge compounds.
    </div>

    <hr class="section-divider">

    <h2 id="architecture"><span class="bionic">Fil</span>esystem <span class="bionic">Sta</span>te <span class="bionic">Arc</span>hitecture</h2>

    <div class="file-tree">
project/
+-- scripts/ralph/              # Agent working memory
|   +-- progress.txt            # Session log, discoveries
|   +-- prd.json                # Task tracking, dependencies
|   +-- scratch/                # Temporary analysis files
|
+-- AGENTS.md                   # Permanent learnings
|                               # (or .claude/AGENTS.md)
|
+-- .git/                       # History as memory
|   +-- (commits tell the story)
|
+-- src/                        # The actual code
    </div>

    <h3>What Each <span class="bionic">Lay</span>er Does</h3>

    <div class="table-responsive">
      <table>
        <thead>
          <tr>
            <th>Layer</th>
            <th>Purpose</th>
            <th>Lifespan</th>
            <th>Who Reads</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>progress.txt</td><td>Session continuity</td><td>This project</td><td>Same agent, next session</td></tr>
          <tr><td>prd.json</td><td>Task state machine</td><td>This project</td><td>Agent, potentially CI</td></tr>
          <tr><td>AGENTS.md</td><td>Pattern library</td><td>Permanent</td><td>All future agents</td></tr>
          <tr><td>.git</td><td>Change history</td><td>Permanent</td><td>Anyone</td></tr>
        </tbody>
      </table>
    </div>

    <hr class="section-divider">

    <h2 id="benefits">The <span class="bionic">Tra</span>nsformation <span class="bionic">Ben</span>efits</h2>

    <h3>Before vs After</h3>

    <div class="table-responsive">
      <table>
        <thead>
          <tr>
            <th>Aspect</th>
            <th>Manual Context</th>
            <th>Filesystem State</th>
          </tr>
        </thead>
        <tbody>
          <tr><td><strong>Session start</strong></td><td>Re-explain everything</td><td>Read files, continue</td></tr>
          <tr><td><strong>Pattern discovery</strong></td><td>Lost on session end</td><td>Persists, compounds</td></tr>
          <tr><td><strong>Handoff to new agent</strong></td><td>Impossible</td><td>Read the files</td></tr>
          <tr><td><strong>Debugging old work</strong></td><td>"What was I thinking?"</td><td>Check progress.txt</td></tr>
          <tr><td><strong>Avoiding past mistakes</strong></td><td>Hope you remember</td><td>It's documented</td></tr>
        </tbody>
      </table>
    </div>

    <h3><span class="bionic">Com</span>pounding <span class="bionic">Ret</span>urns</h3>

    <div class="architecture-diagram">
Session 1:  Learn pattern A, write to AGENTS.md
Session 2:  Read AGENTS.md, learn pattern B, write it
Session 3:  Read AGENTS.md, know A+B already, learn C
...
Session N:  Read AGENTS.md, know A through N-1, highly effective
    </div>

    <p><strong>Each session is more productive than the last.</strong></p>

    <hr class="section-divider">

    <h2 id="migration"><span class="bionic">Mig</span>ration <span class="bionic">Che</span>cklist</h2>

    <h3><span class="bionic">Get</span>ting <span class="bionic">Sta</span>rted (Do Once)</h3>

    <ul>
      <li>[ ] Create <code>scripts/ralph/</code> directory (or your preferred name)</li>
      <li>[ ] Initialize <code>progress.txt</code> with project header</li>
      <li>[ ] Initialize <code>prd.json</code> with user stories structure</li>
      <li>[ ] Create <code>AGENTS.md</code> at project root (or in <code>.claude/</code>)</li>
    </ul>

    <div class="checkpoint">
      <div class="checkpoint-header">Checkpoint: After Getting Started</div>
      <p><strong>Where you are:</strong> You have the core state file infrastructure in place.</p>
      <p><strong>What this enables:</strong> Sessions can now read state from files instead of relying on human memory or context window.</p>

      <p><strong>Verify your state:</strong></p>
      <div class="code-block-wrapper">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Check directory structure
ls -la scripts/ralph/

# Check all files exist
ls scripts/ralph/progress.txt scripts/ralph/prd.json AGENTS.md

# Verify prd.json has valid structure
jq 'keys' scripts/ralph/prd.json</code></pre>
      </div>

      <div class="expected-output">
        <p><strong>You should see:</strong></p>
        <pre>scripts/ralph/:
-rw-r--r--  progress.txt    &larr; Session log ready
-rw-r--r--  prd.json        &larr; Task state ready

AGENTS.md exists             &larr; Pattern library ready

["project", "userStories"]   &larr; Required keys present</pre>
      </div>

      <p><strong>Your folder should look like:</strong></p>
      <div class="file-tree">
project/
+-- scripts/ralph/
|   +-- progress.txt   &larr; created
|   +-- prd.json       &larr; created
+-- AGENTS.md          &larr; created
+-- src/
      </div>

      <p><strong>If you don't see this:</strong></p>
      <ul>
        <li>Check: Did you create the scripts/ralph/ directory?</li>
        <li>Check: Is prd.json valid JSON?</li>
        <li>Check: Is AGENTS.md at project root?</li>
        <li>Go back to: Creating the directory structure</li>
      </ul>
    </div>

    <h3><span class="bionic">Eve</span>ry <span class="bionic">Ses</span>sion Start</h3>

    <ul>
      <li>[ ] Read <code>progress.txt</code> to understand where you left off</li>
      <li>[ ] Read <code>prd.json</code> to see task states and blockers</li>
      <li>[ ] Read <code>AGENTS.md</code> to load project patterns</li>
      <li>[ ] Identify the next task to work on</li>
    </ul>

    <h3><span class="bionic">Dur</span>ing <span class="bionic">Ses</span>sion</h3>

    <ul>
      <li>[ ] Update <code>progress.txt</code> when you learn something</li>
      <li>[ ] Update <code>prd.json</code> when task status changes</li>
      <li>[ ] Note blockers and dependencies as you discover them</li>
    </ul>

    <h3><span class="bionic">Eve</span>ry <span class="bionic">Ses</span>sion End</h3>

    <ul>
      <li>[ ] Update <code>progress.txt</code> with session summary</li>
      <li>[ ] Update <code>prd.json</code> with final task states</li>
      <li>[ ] Add any permanent learnings to <code>AGENTS.md</code></li>
      <li>[ ] Commit state files with meaningful message</li>
    </ul>

    <div class="checkpoint">
      <div class="checkpoint-header">Checkpoint: After First Complete Session Cycle</div>
      <p><strong>Where you are:</strong> You've completed read &rarr; work &rarr; write cycle for all state files.</p>
      <p><strong>What this enables:</strong> Knowledge compounds. Next session starts ahead. Patterns persist.</p>

      <p><strong>Verify your state:</strong></p>
      <div class="code-block-wrapper">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Check progress.txt has at least one session entry
grep -c "## Session" scripts/ralph/progress.txt

# Check prd.json has updated task states
jq '.userStories | map(select(.status != "pending")) | length' scripts/ralph/prd.json

# Check AGENTS.md has patterns
grep -c "^- " AGENTS.md  # Count bullet points (patterns)

# Check git has state files committed
git log --oneline --name-only -1 | grep -E "progress|prd|AGENTS"</code></pre>
      </div>

      <div class="expected-output">
        <p><strong>You should see:</strong></p>
        <pre>1                              &larr; At least 1 session logged
1                              &larr; At least 1 task started/completed
5                              &larr; Multiple patterns documented
progress.txt                   &larr; State files in commit
prd.json</pre>
      </div>

      <p><strong>Test next session start:</strong></p>
      <div class="code-block-wrapper">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Simulate what Claude would read at session start
head -30 scripts/ralph/progress.txt
jq '.userStories[] | {id, status}' scripts/ralph/prd.json</code></pre>
      </div>

      <p><strong>If you don't see this:</strong></p>
      <ul>
        <li>Check: Did you append to progress.txt (not overwrite)?</li>
        <li>Check: Did you update prd.json task states?</li>
        <li>Check: Did you git commit the state files?</li>
        <li>Go back to: Session End checklist</li>
      </ul>
    </div>

    <h3><span class="bionic">Per</span>iodic <span class="bionic">Mai</span>ntenance</h3>

    <ul>
      <li>[ ] Review <code>AGENTS.md</code> for outdated patterns</li>
      <li>[ ] Archive completed work from <code>progress.txt</code></li>
      <li>[ ] Clean up resolved blockers in <code>prd.json</code></li>
    </ul>

    <hr class="section-divider">

    <h2 id="templates"><span class="bionic">Qui</span>ck <span class="bionic">Ref</span>erence: <span class="bionic">Fil</span>e <span class="bionic">Tem</span>plates</h2>

    <h3><span class="bionic">Min</span>imal progress.txt</h3>

    <div class="code-block-wrapper">
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      <pre><code># Progress Log
Project: [Name]
Started: [Date]

## Patterns
- [Pattern 1]

## Sessions
### [Date] - [Task]
- Status: [complete|in_progress|blocked]
- Files: [list]
- Learnings: [what you discovered]
---</code></pre>
    </div>

    <h3><span class="bionic">Min</span>imal prd.json</h3>

    <div class="code-block-wrapper">
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      <pre><code>{
  "project": "Name",
  "userStories": [
    {"id": "US-001", "title": "Task", "status": "pending", "passes": false}
  ]
}</code></pre>
    </div>

    <h3><span class="bionic">Min</span>imal AGENTS.md</h3>

    <div class="code-block-wrapper">
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      <pre><code># Agent Learnings

## [Module Name]
- [Pattern or requirement]</code></pre>
    </div>

    <hr class="section-divider">

    <h2 id="mental-model">The <span class="bionic">Men</span>tal <span class="bionic">Mod</span>el</h2>

    <p><strong>Manual Context:</strong> Knowledge lives in wetware, dies with the session.</p>

    <p><strong>Filesystem State:</strong> Knowledge lives in files, compounds forever.</p>

    <div class="milestone">
      Your brain is RAM.<br>
      The filesystem is disk.<br>
      Persist what matters.
    </div>

    <hr class="section-divider">

    <h2 id="troubleshooting"><span class="bionic">Tro</span>ubleshooting</h2>

    <details class="troubleshoot">
      <summary>Claude Doesn't Read State Files</summary>
      <div>
        <p><strong>Symptom:</strong> You have progress.txt and prd.json but Claude starts fresh, asks questions you've already answered.</p>
        <p><strong>Cause:</strong> CLAUDE.md doesn't instruct Claude to read state files, or files aren't mentioned in session start prompt.</p>
        <p><strong>Fix:</strong></p>
        <div class="code-block-wrapper">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code># Add to CLAUDE.md:

## Session Startup
At the start of every session, IMMEDIATELY read these files:
1. scripts/ralph/progress.txt - session history and learnings
2. scripts/ralph/prd.json - task states and dependencies
3. AGENTS.md - permanent patterns and requirements

Do this BEFORE responding to any user request.</code></pre>
        </div>
        <div class="code-block-wrapper">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code># Or start sessions with explicit instruction:
claude "Read scripts/ralph/progress.txt and prd.json first, then continue work on the dashboard"</code></pre>
        </div>
      </div>
    </details>

    <details class="troubleshoot">
      <summary>State Files Become Stale</summary>
      <div>
        <p><strong>Symptom:</strong> progress.txt hasn't been updated in days. prd.json still shows old task states. Reality has diverged.</p>
        <p><strong>Cause:</strong> Forgot to update at session end, or updates became optional rather than required.</p>
        <p><strong>Fix:</strong></p>
        <div class="code-block-wrapper">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code># Create session-end checklist (add to CLAUDE.md or as script)

# session-end.sh
echo "=== Session End Checklist ==="
echo "1. Update progress.txt with session summary"
echo "2. Update prd.json with task states"
echo "3. Add new patterns to AGENTS.md"
echo "4. Commit state files to git"
echo ""
echo "Verify files changed:"
git diff --name-only | grep -E "progress|prd|AGENTS"</code></pre>
        </div>
        <div class="code-block-wrapper">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code># Add to CLAUDE.md:

## Session End Requirements (MANDATORY)
Before session ends, you MUST:
1. Append session summary to progress.txt
2. Update task states in prd.json
3. Add any new patterns to AGENTS.md
4. Commit: `git add scripts/ralph/* AGENTS.md &amp;&amp; git commit -m "chore: update state files"`</code></pre>
        </div>
      </div>
    </details>

    <details class="troubleshoot">
      <summary>progress.txt Gets Too Long</summary>
      <div>
        <p><strong>Symptom:</strong> progress.txt is 1000+ lines. Mostly old session logs. Takes forever to read. Context getting crowded with history.</p>
        <p><strong>Cause:</strong> Appending forever without archiving old entries.</p>
        <p><strong>Fix:</strong></p>
        <div class="code-block-wrapper">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code># Archive old sessions
# Keep last 10 sessions active, archive the rest

# Create archive
mkdir -p scripts/ralph/archive

# Move old content
head -100 scripts/ralph/progress.txt &gt; scripts/ralph/archive/progress-$(date +%Y%m).md
tail -200 scripts/ralph/progress.txt &gt; scripts/ralph/progress.txt.new
mv scripts/ralph/progress.txt.new scripts/ralph/progress.txt

# Or use a rotating log strategy:
# - progress.txt: Current patterns + last 5 sessions
# - progress-archive.txt: Everything else (Claude doesn't read by default)</code></pre>
        </div>
        <p><strong>Recommended progress.txt structure:</strong></p>
        <div class="code-block-wrapper">
          <pre><code># Progress Log
Project: [Name]

## Patterns (Always Read)
[Keep this section updated, never archive]

## Recent Sessions (Last 5)
[Rolling window of recent work]

---
## Archived Sessions
See scripts/ralph/archive/ for older entries</code></pre>
        </div>
      </div>
    </details>

    <details class="troubleshoot">
      <summary>prd.json Has Invalid JSON</summary>
      <div>
        <p><strong>Symptom:</strong> <code>jq . scripts/ralph/prd.json</code> fails with parse error. State file is corrupted.</p>
        <p><strong>Cause:</strong> Manual edit introduced syntax error, or Claude wrote invalid JSON.</p>
        <p><strong>Fix:</strong></p>
        <div class="code-block-wrapper">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code># Diagnose the error
jq . scripts/ralph/prd.json 2&gt;&amp;1 | head -5
# Shows: parse error at line X, column Y

# View around the error
sed -n 'X-2,X+2p' scripts/ralph/prd.json

# Common fixes:
# - Missing comma after object in array
# - Trailing comma before closing bracket
# - Unescaped quotes in string

# Validate JSON before committing (add as git hook)
# .git/hooks/pre-commit
#!/bin/bash
for f in scripts/ralph/*.json; do
  jq . "$f" &gt; /dev/null 2&gt;&amp;1 || { echo "Invalid JSON: $f"; exit 1; }
done</code></pre>
        </div>
      </div>
    </details>

    <details class="troubleshoot">
      <summary>AGENTS.md Has Conflicting Patterns</summary>
      <div>
        <p><strong>Symptom:</strong> AGENTS.md says both "use API routes" and "use server actions" for forms. Contradictory advice.</p>
        <p><strong>Cause:</strong> Patterns were added incrementally as discoveries, without reviewing for consistency.</p>
        <p><strong>Fix:</strong></p>
        <div class="code-block-wrapper">
          <pre><code># Periodic AGENTS.md review process:

1. Read entire AGENTS.md
2. Look for contradictions
3. Resolve by:
   - Keeping the newer/better pattern
   - Adding context for when each applies
   - Removing outdated patterns

# Example resolution:
# Before (contradictory):
## Forms
- Use API routes for form submission
- Use server actions for forms

# After (contextual):
## Forms
- Server actions: Standard forms (preferred in Next.js 14+)
- API routes: Only when you need streaming or external access</code></pre>
        </div>
      </div>
    </details>

    <details class="troubleshoot">
      <summary>New Team Member Can't Onboard</summary>
      <div>
        <p><strong>Symptom:</strong> State files exist but new developer can't make sense of them. Progress.txt is project-specific shorthand.</p>
        <p><strong>Cause:</strong> State files optimized for continuity of same person, not for onboarding.</p>
        <p><strong>Fix:</strong></p>
        <div class="code-block-wrapper">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code># Add to project root:

# ONBOARDING.md

## For New Developers (Human or AI)

1. **Start here:** Read CLAUDE.md for commands and conventions
2. **Project patterns:** Read AGENTS.md for discovered patterns
3. **Current state:** Read scripts/ralph/prd.json for task status
4. **Recent history:** Read last 3 sessions in progress.txt

## Key Context
- [Brief project description]
- [Major architectural decisions]
- [Non-obvious gotchas]

## Quick Start
```bash
npm install
npm run dev
# Read AGENTS.md before making changes
```</code></pre>
        </div>
      </div>
    </details>

    <details class="troubleshoot">
      <summary>State Files Out of Sync With Code</summary>
      <div>
        <p><strong>Symptom:</strong> prd.json says US-003 is complete, but the feature doesn't exist in code. Or progress.txt mentions files that were deleted.</p>
        <p><strong>Cause:</strong> Manual code changes without state file updates, or state files committed separately from code.</p>
        <p><strong>Fix:</strong></p>
        <div class="code-block-wrapper">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code># Always commit state files WITH related code changes
git add src/feature/*.ts scripts/ralph/prd.json scripts/ralph/progress.txt
git commit -m "feat: US-003 - complete profile page"

# Add verification to session end:
# Check prd.json claims match reality
for story in $(jq -r '.userStories[] | select(.passes==true) | .id' scripts/ralph/prd.json); do
  echo "Verify $story is actually complete..."
  # Add project-specific verification
done</code></pre>
        </div>
      </div>
    </details>

    <h3><span class="bionic">Ter</span>minal <span class="bionic">Out</span>put: <span class="bionic">Hea</span>lthy <span class="bionic">Sta</span>te <span class="bionic">Fil</span>e <span class="bionic">Eco</span>system</h3>

    <p>Here's what a well-maintained filesystem state looks like:</p>

    <div class="code-block-wrapper">
      <pre><code>$ tree scripts/ralph/
scripts/ralph/
+-- prd.json           (2.1K, updated today)
+-- progress.txt       (4.5K, last 5 sessions)
+-- archive/
    +-- progress-202601.md  (15K, old sessions)

$ jq '.userStories | length' scripts/ralph/prd.json
7

$ jq '.userStories | map({id, passes})' scripts/ralph/prd.json
[
  {"id": "US-001", "passes": true},
  {"id": "US-002", "passes": true},
  {"id": "US-003", "passes": true},
  {"id": "US-004", "passes": false},
  {"id": "US-005", "passes": false},
  {"id": "US-006", "passes": false},
  {"id": "US-007", "passes": false}
]

$ head -20 scripts/ralph/progress.txt
# Progress Log
Project: User Dashboard
Started: 2026-01-09

## Patterns
- Forms: Server actions with Zod validation
- Refs: useRef&lt;HTMLElement | null&gt;(null)
- Auth: bcrypt 12 rounds minimum
- Migrations: Always IF NOT EXISTS

## Recent Sessions

### 2026-01-19 - US-003: Profile Page
- Status: COMPLETE
- Files: app/profile/page.tsx, components/ProfileForm.tsx
- Learnings: Image upload uses presigned URLs

$ wc -l AGENTS.md
87 AGENTS.md  # Reasonable size, focused patterns</code></pre>
    </div>

    <hr class="section-divider">

    <div class="related-pages">
      <h3>Related Pages</h3>
      <ul>
        <li><a href="transform-single-to-autonomous.html">Transform: Single to Autonomous</a></li>
        <li><a href="mastery-ralph-complete.html">Ralph Pattern Complete Guide</a></li>
        <li><a href="principles-core.html">Core Principles</a></li>
        <li><a href="architecture-complexity-ladder.html">Complexity Ladder</a></li>
      </ul>
    </div>

    <div class="footer-nav">
      <a href="transform-prompt-to-agent.html" class="nav-prev">
        <span class="nav-direction">&larr; Previous</span>
        <span class="nav-title">Prompt to Agent</span>
      </a>
      <a href="transform-generalist-to-swarm.html" class="nav-next">
        <span class="nav-direction">Next &rarr;</span>
        <span class="nav-title">Generalist to Swarm</span>
      </a>
    </div>

  </div>

  <script>
    function copyCode(btn) {
      const pre = btn.parentElement.querySelector('pre');
      const code = pre.querySelector('code') || pre;
      navigator.clipboard.writeText(code.textContent);
      btn.textContent = 'Copied!';
      setTimeout(() => btn.textContent = 'Copy', 2000);
    }
  </script>
  <script src="../js/copy-code.js"></script>
  <script src="../js/search.js"></script>
  <script src="../js/global-nav.js"></script>
</body>
</html>
