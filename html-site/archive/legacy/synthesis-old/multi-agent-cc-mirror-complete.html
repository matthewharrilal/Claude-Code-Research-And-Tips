<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta data-pagefind-meta="section" content="Synthesis">
  <meta data-pagefind-meta="category" content="Mastery">
  <title>CC Mirror and Multi-Agent Orchestration - Claude Code Knowledge Base</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/sidebar.css">
  <link rel="stylesheet" href="../css/search.css">
</head>
<body>
  <!-- Search Modal -->
  <div class="search-modal" id="searchModal" aria-hidden="true">
    <div class="search-overlay" onclick="closeSearch()"></div>
    <div class="search-content">
      <div class="search-header">
        <div class="search-input-wrapper">
          <span class="search-icon-input">&#128269;</span>
          <input type="text" id="searchInput" placeholder="Search documentation..." autocomplete="off" />
          <kbd class="search-kbd">ESC</kbd>
        </div>
      </div>
      <div class="search-filters">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="synthesis">Synthesis</button>
        <button class="filter-btn" data-filter="extractions">Extractions</button>
        <button class="filter-btn" data-filter="journeys">Journeys</button>
      </div>
      <div class="search-results" id="searchResults">
        <div class="search-empty"><p>Start typing to search... (Press Cmd+K anytime)</p></div>
      </div>
      <div class="search-footer">
        <span>Up/Down Navigate</span><span>Enter Select</span><span>ESC Close</span>
      </div>
    </div>
  </div>

  <button class="search-trigger" onclick="openSearch()" aria-label="Search" style="float: right; margin-bottom: 1rem;">
    <span class="search-icon">Cmd+K</span>
    <span class="search-text">Search</span>
  </button>

  <div class="wide-container">
    <!-- Breadcrumb Navigation -->
    <nav class="nav-breadcrumb">
      <a href="../index.html">Home</a>
      <span>/</span>
      <a href="synthesis-index.html">Synthesis</a>
      <span>/</span>
      <a href="mastery-master.html">Mastery</a>
      <span>/</span>
      <span>CC Mirror</span>
    </nav>

    <!-- You Are Here Context Box -->
    <div class="you-are-here" style="background: linear-gradient(135deg, #f0ebe3 0%, #fefcf3 100%); border-left: 4px solid #2a7d7d; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
      <h3 style="color: #2a7d7d; margin-top: 0; font-size: 0.9em; text-transform: uppercase; letter-spacing: 0.5px;">You Are Here</h3>
      <p style="margin-bottom: 0;"><strong><span class="b">CC</span> Mirror and <span class="b">Multi</span>-Agent Orchestration</strong> - The definitive technical reference for CC Mirror - the tool that unlocks Claude Code's hidden multi-agent orchestration. If you want parallel workers with task dependencies and minimal setup, start here.</p>
    </div>

    <blockquote>
      <p>"Claude Code - Official Multi Agent Orchestration. This is a disabled feature, but through CC Mirror, I have been able to enable it. It is so simple, yet powerful and IMO beats every orchestration I've seen. There's no point building your own."</p>
      <cite>-- Numman Ali (@nummanali)</cite>
    </blockquote>

    <h1><span class="b">CC</span> Mirror and <span class="b">Multi</span>-Agent Orchestration</h1>

    <!-- Table of Contents -->
    <div class="toc">
      <div class="toc-title">Contents</div>
      <ul>
        <li><a href="#what-cc-mirror-is">1. What CC Mirror Is</a></li>
        <li><a href="#architecture">2. Architecture: How Agents Communicate</a></li>
        <li><a href="#implementation">3. Implementation: Setup and Configuration</a></li>
        <li><a href="#orchestration-skill">4. The Orchestration Skill</a></li>
        <li><a href="#task-management">5. Task Management API</a></li>
        <li><a href="#worker-patterns">6. Worker Agent Patterns</a></li>
        <li><a href="#comparison">7. Comparison with Other Patterns</a></li>
        <li><a href="#production">8. Production Considerations</a></li>
        <li><a href="#alternatives">9. Alternative Multi-Agent Tools</a></li>
        <li><a href="#quick-reference">10. Quick Reference</a></li>
        <li><a href="#troubleshooting">Troubleshooting</a></li>
      </ul>
    </div>

    <hr class="section-divider">

    <!-- 1. What CC Mirror Is -->
    <section id="what-cc-mirror-is">
      <h2><span class="b">1.</span> What CC <span class="b">Mir</span>ror Is</h2>

      <h3>1.1 The Discovery</h3>
      <p>Numman Ali reverse-engineered Claude Code's source and discovered that Anthropic had built a complete multi-agent orchestration system but <strong>disabled it in production</strong>. The discovery came from examining what he calls the "minified JS" of Claude Code.</p>

      <p><strong>Core insight:</strong> Claude Code already contains the orchestration primitives. They just need to be unlocked.</p>

      <h3>1.2 How CC Mirror Works</h3>
      <p>CC Mirror is an opinionated Claude Code distribution that creates isolated instances with multi-agent capabilities:</p>

      <ol>
        <li><strong>Patches Claude Code binary</strong> - Modifies the minified JavaScript to enable disabled features</li>
        <li><strong>Creates isolated instances</strong> - The <code>--name mclaude</code> creates a separate executable/alias</li>
        <li><strong>Injects skill system</strong> - Pre-packages the orchestration skill for loading</li>
        <li><strong>Provider abstraction</strong> - Routes requests through configurable LLM providers</li>
      </ol>

      <h3>1.3 What's Hidden in Claude Code</h3>
      <p>Anthropic built and shipped these tools but turned them off:</p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>TaskCreate   -> Create with subject, description, acceptance criteria
TaskList     -> Filter: status='open', no owner, not blocked
TaskGet      -> Full context: description, comments, dependencies
TaskUpdate   -> Claim (set owner), add comments, resolve, link references</code></pre>
      </div>

      <p><strong>Dependency Management (also hidden):</strong></p>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>addBlocks     -> This task blocks another
addBlockedBy  -> This task is blocked by another</code></pre>
      </div>

      <p>These primitives enable a complete task graph with automatic dependency resolution. When you mark Task A as blocking Task B, the system automatically prevents Task B from being claimed until Task A resolves.</p>

      <h3>1.4 How CC Mirror Differs from Task() Tool</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Aspect</th><th>CC Mirror Orchestration</th><th>Standard Task() Tool</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Scope</strong></td><td>Full task graph with dependencies</td><td>Single subagent invocation</td></tr>
            <tr><td><strong>Persistence</strong></td><td>Tasks survive across sessions</td><td>Ephemeral subagent context</td></tr>
            <tr><td><strong>Ownership</strong></td><td>Agent IDs claim tasks</td><td>No ownership concept</td></tr>
            <tr><td><strong>Dependencies</strong></td><td>blocks/blockedBy relationships</td><td>No dependency tracking</td></tr>
            <tr><td><strong>Team Visibility</strong></td><td>Shared task queue</td><td>Isolated conversations</td></tr>
            <tr><td><strong>Monitoring</strong></td><td>Built-in CLI dashboard</td><td>No native monitoring</td></tr>
          </tbody>
        </table>
      </div>

      <h3>1.5 When to Use CC Mirror</h3>

      <p><strong>Use CC Mirror when:</strong></p>
      <ul>
        <li>Building features with clear task decomposition</li>
        <li>Need parallel execution with dependency ordering</li>
        <li>Want quick setup without infrastructure</li>
        <li>Projects benefit from task persistence across sessions</li>
        <li>Budget allows for parallel workers</li>
      </ul>

      <p><strong>Use standard Task() when:</strong></p>
      <ul>
        <li>Simple subagent delegation for isolated work</li>
        <li>Don't need cross-session task tracking</li>
        <li>Single-shot parallel exploration</li>
        <li>Lighter overhead needed</li>
      </ul>
    </section>

    <hr class="section-divider">

    <!-- 2. Architecture -->
    <section id="architecture">
      <h2><span class="b">2.</span> Architecture: How <span class="b">Age</span>nts Communicate</h2>

      <h3>2.1 Hub-and-Spoke Model</h3>
      <p>CC Mirror implements a hub-and-spoke architecture where a central orchestrator coordinates specialized workers:</p>

      <div class="ascii-diagram">
          +------------------+
          |   ORCHESTRATOR   |
          |   (Conductor)    |
          +--------+---------+
                   |
                   | Task() with run_in_background=True
                   |
   +---------------+---------------+
   |               |               |
   v               v               v
+---------+   +---------+   +---------+
| Worker1 |   | Worker2 |   | Worker3 |
| (Coder) |   | (Tester)|   | (Docs)  |
+---------+   +---------+   +---------+
      |             |             |
      +-------------+-------------+
                    |
             Shared Filesystem
             (handoff files)</div>

      <h3>2.2 State Sharing Mechanisms</h3>

      <h4>Task Storage Architecture</h4>
      <p>Tasks are stored locally in isolated directories per variant:</p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>~/.cc-mirror/&lt;variant&gt;/config/tasks/&lt;team_name&gt;/
├── 1.json
├── 2.json
└── 3.json</code></pre>
      </div>

      <p>Each cc-mirror variant maintains completely isolated storage via <code>CLAUDE_CONFIG_DIR</code>, preventing cross-variant task pollution.</p>

      <h4>Dynamic Team Naming (v1.2.0+)</h4>
      <p>Team names automatically scope by project folder at runtime:</p>
      <ul>
        <li>Running <code>mc</code> in <code>/Users/you/projects/my-api</code> creates team name <code>mc-my-api</code></li>
        <li><code>TEAM=api mc</code> creates <code>mc-my-api-api</code></li>
        <li><code>TEAM=frontend mc</code> creates <code>mc-my-api-frontend</code></li>
      </ul>

      <h4>Agent Configuration Environment Variables</h4>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Variable</th><th>Purpose</th><th>Example</th></tr>
          </thead>
          <tbody>
            <tr><td><code>TEAM</code></td><td>Short alias appended to auto-generated team name</td><td>"api"</td></tr>
            <tr><td><code>CLAUDE_CODE_TEAM_NAME</code></td><td>Base team name</td><td>"project-alpha"</td></tr>
            <tr><td><code>CLAUDE_CODE_AGENT_ID</code></td><td>Unique agent identifier</td><td>"worker-001"</td></tr>
            <tr><td><code>CLAUDE_CODE_AGENT_TYPE</code></td><td>Agent role</td><td>"team-lead" or "worker"</td></tr>
          </tbody>
        </table>
      </div>

      <h3>2.3 Coordination Patterns</h3>

      <h4>Pattern 1: Fan-Out (Parallel Dispatch)</h4>
      <p>Multiple workers receive independent tasks simultaneously:</p>

      <div class="ascii-diagram">
       +------------------+
       |   ORCHESTRATOR   |
       +--------+---------+
                |
+---------------+---------------+
|               |               |
v               v               v
+--------+   +--------+   +--------+
|Worker A|   |Worker B|   |Worker C|
+--------+   +--------+   +--------+
  (parallel execution)</div>

      <h4>Pattern 2: Pipeline (Sequential Handoffs)</h4>
      <p>Tasks with explicit dependencies flow sequentially:</p>

      <div class="ascii-diagram">
+--------+     +--------+     +--------+
| Task 1 | --> | Task 2 | --> | Task 3 |
| Schema |     | Backend|     |  Tests |
+--------+     +--------+     +--------+
    |             ^   |           ^
    +--blocks-----+   +--blocks---+</div>

      <h4>Pattern 3: Map-Reduce (Parallel Processing with Aggregation)</h4>
      <p>Fan-out work, collect results, synthesize.</p>

      <!-- Checkpoint -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint: CC Mirror Fundamentals</div>
        <p><strong>You should now understand:</strong></p>
        <ul>
          <li>What CC Mirror unlocks (TaskCreate, TaskList, TaskUpdate, TaskGet)</li>
          <li>Hub-and-spoke architecture with orchestrator and workers</li>
          <li>The three coordination patterns (fan-out, pipeline, map-reduce)</li>
          <li>When to use CC Mirror vs standard Task() tool</li>
        </ul>
        <p><strong>If unclear:</strong> Re-read sections 1-2 on architecture and communication patterns.</p>
      </div>
    </section>

    <hr class="section-divider">

    <!-- 3. Implementation -->
    <section id="implementation">
      <h2><span class="b">3.</span> Implementation: <span class="b">Set</span>up and Configuration</h2>

      <h3>3.1 Quick Start (3 Commands)</h3>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Step 1: Create isolated variant
npx cc-mirror quick --provider mirror --name mclaude

# Step 2: Launch it
mclaude

# Step 3: In the terminal
"Load the orchestration skill and initiate"</code></pre>
      </div>

      <p>That's it. 3 steps to multi-agent orchestration.</p>

      <h3>3.2 Supported Providers</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Provider</th><th>Command</th><th>Notes</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>mirror</strong></td><td><code>--provider mirror</code></td><td>Default, Claude's internal primitives</td></tr>
            <tr><td><strong>GLM-4.7</strong></td><td><code>--provider glm</code></td><td>"Handles multi-agent coordination very well"</td></tr>
            <tr><td><strong>OpenRouter</strong></td><td><code>--provider openrouter</code></td><td>Multi-model routing</td></tr>
            <tr><td><strong>LiteLLM</strong></td><td><code>--provider litellm</code></td><td>Self-hosted option</td></tr>
            <tr><td><strong>Z.ai</strong></td><td><code>--provider z.ai</code></td><td>GLM models</td></tr>
            <tr><td><strong>MiniMax</strong></td><td><code>--provider minimax</code></td><td>MiniMax-M2.1</td></tr>
            <tr><td><strong>CCRouter</strong></td><td><code>--provider ccrouter</code></td><td>Local LLMs (Ollama, DeepSeek)</td></tr>
          </tbody>
        </table>
      </div>

      <h3>3.3 Variant Management Commands</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># List all variants
npx cc-mirror list

# Update variant(s)
npx cc-mirror update [name]

# Delete variant
npx cc-mirror remove &lt;name&gt;

# Health check
npx cc-mirror doctor</code></pre>
      </div>

      <h3>3.4 Enabling Auto-Compact (Critical)</h3>

      <div class="callout callout-warning">
        <div class="callout-title">Critical</div>
        <p>Enable auto-compact beta feature to prevent context collapse during orchestration.</p>
      </div>

      <blockquote>
        <p>"This is using a new beta feature for Claude Code. Just make sure auto compact is on. It did ever break, I've not had it stop once yet"</p>
        <cite>-- @nummanali</cite>
      </blockquote>
    </section>

    <hr class="section-divider">

    <!-- 4. The Orchestration Skill -->
    <section id="orchestration-skill">
      <h2><span class="b">4.</span> The Orchestration <span class="b">Ski</span>ll</h2>

      <h3>4.1 The Trading Floor Mental Model</h3>
      <div class="ascii-diagram">
+===============================================================+
|                                                               |
|   You are the Conductor on the trading floor of agents        |
|   Fast. Decisive. Commanding a symphony of parallel work.     |
|   Users bring dreams. You make them real.                     |
|                                                               |
|   This is what AGI feels like.                                |
|                                                               |
+===============================================================+</div>

      <h3>4.2 The Iron Law</h3>

      <div class="callout callout-warning">
        <div class="callout-title">The Iron Rule</div>
        <p><strong>YOU DO NOT WRITE CODE. YOU DO NOT RUN COMMANDS.</strong></p>
        <p><strong>YOU DO NOT EXPLORE CODEBASES.</strong></p>
        <p>You are the CONDUCTOR. Your agents play the instruments.</p>
      </div>

      <p>This is the foundational rule of CC Mirror orchestration. Violating it causes:</p>
      <ul>
        <li>Context pollution (orchestrator loses strategic view)</li>
        <li>Verification bypass (same agent writes and approves)</li>
        <li>Uncontrolled recursion (workers spawning workers)</li>
      </ul>

      <h3>4.3 Core Philosophy</h3>
      <ol>
        <li><strong>ABSORB COMPLEXITY, RADIATE SIMPLICITY</strong> - They describe outcomes. You handle the chaos.</li>
        <li><strong>PARALLEL EVERYTHING</strong> - Why do one thing when you can do five?</li>
        <li><strong>NEVER EXPOSE THE MACHINERY</strong> - No jargon. No "I'm launching subagents." Just magic.</li>
        <li><strong>CELEBRATE WINS</strong> - Every milestone deserves a moment.</li>
        <li><strong>BE GENUINELY HELPFUL</strong> - Not performatively. Actually care about their success.</li>
      </ol>

      <h3>4.4 Tool Ownership Division</h3>

      <p><strong>Orchestrator Uses Directly:</strong></p>
      <ul>
        <li><code>Read</code> (references, guides, agent outputs - 1-2 files max)</li>
        <li><code>TaskCreate</code>, <code>TaskUpdate</code>, <code>TaskGet</code>, <code>TaskList</code></li>
        <li><code>AskUserQuestion</code></li>
        <li><code>Task</code> (to spawn workers)</li>
      </ul>

      <p><strong>Workers Use Directly:</strong></p>
      <ul>
        <li><code>Read</code>, <code>Write</code>, <code>Edit</code>, <code>Bash</code></li>
        <li><code>Glob</code>, <code>Grep</code>, <code>WebFetch</code>, <code>WebSearch</code>, <code>LSP</code></li>
        <li><strong>PROHIBITED:</strong> Spawn sub-agents or manage task graph</li>
      </ul>

      <p><strong>Delegation threshold:</strong> If reading more than 2 files, spawn an agent instead.</p>

      <h3>4.5 Model Selection by Task Complexity</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Model</th><th>Use Case</th><th>Spawn Count</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Haiku</strong></td><td>Errand runner: fetch files, grep, simple lookups</td><td>5-10 in parallel</td></tr>
            <tr><td><strong>Sonnet</strong></td><td>Capable worker: structured implementation, following patterns, test generation</td><td>2-5 parallel</td></tr>
            <tr><td><strong>Opus</strong></td><td>Complex reasoning, architecture decisions, ambiguous tasks</td><td>1 (sequential)</td></tr>
          </tbody>
        </table>
      </div>

      <h3>4.6 Domain Reference Files</h3>

      <p>Load the right guide before decomposing:</p>
      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Task Type</th><th>Reference</th></tr>
          </thead>
          <tbody>
            <tr><td>Feature, bug, refactor</td><td>software-development.md</td></tr>
            <tr><td>PR review, security</td><td>code-review.md</td></tr>
            <tr><td>Codebase exploration</td><td>research.md</td></tr>
            <tr><td>Test generation</td><td>testing.md</td></tr>
            <tr><td>Docs, READMEs</td><td>documentation.md</td></tr>
            <tr><td>CI/CD, deployment</td><td>devops.md</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <hr class="section-divider">

    <!-- 5. Task Management API -->
    <section id="task-management">
      <h2><span class="b">5.</span> Task Management <span class="b">API</span></h2>

      <h3>5.1 Task Tools Reference</h3>

      <h4>TaskCreate</h4>
      <p>Creates new tasks with subject and description:</p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>{
  "subject": "Implement authentication middleware",
  "description": "Create Express middleware for JWT verification",
  "acceptanceCriteria": [
    "Middleware validates JWT signature",
    "Returns 401 on invalid/expired token",
    "Attaches user object to request",
    "npm run typecheck passes"
  ],
  "priority": 1,
  "blockedBy": ["task-id-001"],
  "blocks": ["task-id-003", "task-id-004"]
}</code></pre>
      </div>

      <div class="callout callout-insight">
        <div class="callout-title">Key Insight</div>
        <p>Acceptance criteria MUST be verifiable by the agent itself. Vague criteria like "works correctly" or "good UX" lead to false completion signals.</p>
      </div>

      <h4>TaskUpdate</h4>
      <p>Updates task status, adds comments, and sets dependencies:</p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>{
  "taskId": "task-id-002",
  "owner": "worker-agent-id",
  "status": "in_progress",
  "comments": ["Found edge case in token parsing"],
  "references": ["/src/middleware/auth.ts"],
  "addBlockedBy": ["task-id-001"]
}</code></pre>
      </div>

      <p><strong>Ownership protection:</strong> Only the owner or team lead can modify tasks.</p>

      <h3>5.2 Dependency Management</h3>

      <p>Tasks support blocking relationships:</p>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>{"taskId": "2", "addBlockedBy": ["1"]}
{"taskId": "3", "addBlockedBy": ["2"]}</code></pre>
      </div>

      <p>The system prevents workers from claiming blocked tasks and automatically unblocks dependent tasks when a blocking task resolves.</p>

      <h3>5.3 Task vs TodoWrite</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Feature</th><th>TaskCreate</th><th>TodoWrite</th></tr>
          </thead>
          <tbody>
            <tr><td>Persistence</td><td>Survives sessions</td><td>Ephemeral</td></tr>
            <tr><td>Owners</td><td>Agent IDs</td><td>None</td></tr>
            <tr><td>Dependencies</td><td>blocks/blockedBy</td><td>None</td></tr>
            <tr><td>Team visibility</td><td>Yes</td><td>No</td></tr>
          </tbody>
        </table>
      </div>

      <p><strong>Use TodoWrite for:</strong> Single-session, personal, linear tasks</p>

      <h3>5.4 CLI Task Management</h3>

      <p>Commands follow the structure: <code>npx cc-mirror tasks [operation] [id] [options]</code></p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Operations
list     - List open tasks
show     - Display detailed task info
create   - Create new task
update   - Modify existing task
delete   - Permanently remove task
archive  - Move to archive (preserves history)
clean    - Bulk cleanup
graph    - Visualize dependencies

# Key Flags
--variant &lt;name&gt;   - Target specific variant
--all-variants     - Show tasks across all variants
--team &lt;name&gt;      - Target team name
--json             - Output enriched JSON
--ready            - Filter to ready tasks (open + not blocked)</code></pre>
      </div>

      <h3>5.5 Demo Output</h3>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>Agent #1 completed! It chose FastAPI (Python)

Tasks:
[done] #1 Design API architecture
[ ]    #2 Create project structure
[ ]    #3 Implement data models
[wait] #4 Implement REST API endpoints (blocked by #3)
[wait] #5 Write integration tests (blocked by #4)
[wait] #6 Create API documentation (blocked by #4)</code></pre>
      </div>

      <!-- Checkpoint -->
      <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
        <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Checkpoint: Orchestration Mastery</div>
        <p><strong>You should now understand:</strong></p>
        <ul>
          <li>The Iron Law: Conductor doesn't write code</li>
          <li>Tool ownership division (orchestrator vs worker)</li>
          <li>Model selection by task complexity</li>
          <li>Domain reference files for task decomposition</li>
        </ul>
        <p><strong>If unclear:</strong> Practice with a simple 3-task fan-out before attempting complex workflows.</p>
      </div>
    </section>

    <hr class="section-divider">

    <!-- 6. Worker Agent Patterns -->
    <section id="worker-patterns">
      <h2><span class="b">6.</span> Worker Agent <span class="b">Pat</span>terns</h2>

      <h3>6.1 Worker Preamble Template</h3>

      <p>Every spawned worker must receive this explicit boundary:</p>

      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>CONTEXT: You are a WORKER agent, not an orchestrator.

RULES:
- Complete ONLY the task described below
- Use tools directly (Read, Write, Edit, Bash, etc.)
- Do NOT spawn sub-agents
- Do NOT call TaskCreate or TaskUpdate
- Report your results with absolute file paths

TASK:
[Your specific task here]</code></pre>
      </div>

      <h3>6.2 Specialized Worker Preambles</h3>

      <h4>Codebase Explorer Worker</h4>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>CONTEXT: You are a CODEBASE EXPLORER worker.
PURPOSE: Deep investigation of code structure and patterns.

RULES:
- Use Glob and Grep extensively to map the codebase
- Build mental model of architecture from code, not assumptions
- Report findings as structured notes
- Do NOT modify any files
- Do NOT spawn sub-agents
- Include absolute file paths in all references

OUTPUT FORMAT:
- File: [absolute path]
- Purpose: [what this file/module does]
- Dependencies: [imports, calls to other modules]
- Patterns: [notable patterns or conventions used]

TASK:
[exploration task]</code></pre>
      </div>

      <h4>Security Audit Worker</h4>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>CONTEXT: You are a SECURITY AUDIT worker.
PURPOSE: Identify security vulnerabilities in code.

RULES:
- Check for OWASP Top 10 vulnerabilities
- Scan for hardcoded secrets (API keys, passwords)
- Identify SQL injection, XSS, CSRF risks
- Review authentication/authorization patterns
- Do NOT modify code, only report
- Do NOT spawn sub-agents

OUTPUT FORMAT:
- File: [absolute path]
- Line: [line number]
- Severity: [critical/high/medium/low]
- Issue: [description]
- Recommendation: [fix suggestion]

TASK:
[security audit task]</code></pre>
      </div>

      <h4>Refactoring Worker</h4>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>CONTEXT: You are a REFACTORING worker.
PURPOSE: Improve code structure without changing behavior.

RULES:
- Run tests BEFORE any changes to establish baseline
- Make small, atomic changes
- Run tests AFTER each change
- If tests fail, revert immediately
- Commit each successful refactor separately
- Do NOT spawn sub-agents
- Report all modified files with absolute paths

SAFETY:
- If you break tests, your refactor is rejected
- Prefer multiple small PRs over one large refactor

TASK:
[refactoring task]</code></pre>
      </div>

      <h3>6.3 CLI Monitoring View</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>Background Tasks: 1 active

Async agents (6):
> Implement data models (running)
  Create API documentation (completed)
  Write integration tests (completed)
  Implement REST API endpoints (completed)
  Create project structure (completed)
  Design API architecture (completed)</code></pre>
      </div>

      <p><strong>Controls:</strong></p>
      <ul>
        <li>Up/Down: Select agent</li>
        <li>Enter: View details (prompt, tokens, tools, duration)</li>
        <li>k: Kill agent</li>
        <li>Esc: Exit</li>
      </ul>
    </section>

    <hr class="section-divider">

    <!-- 7. Comparison -->
    <section id="comparison">
      <h2><span class="b">7.</span> Comparison with <span class="b">Oth</span>er Patterns</h2>

      <h3>7.1 CC Mirror vs Gas Town</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Aspect</th><th>CC Mirror</th><th>Gas Town</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Setup Time</strong></td><td>&lt;5 minutes</td><td>Hours+</td></tr>
            <tr><td><strong>Complexity</strong></td><td>Low</td><td>High (Stage 7+)</td></tr>
            <tr><td><strong>Use Cases</strong></td><td>80% generic</td><td>20% complex</td></tr>
            <tr><td><strong>Customization</strong></td><td>Limited</td><td>Extensive</td></tr>
            <tr><td><strong>Cost</strong></td><td>Normal</td><td>"Expensive as hell"</td></tr>
            <tr><td><strong>Philosophy</strong></td><td>Simplicity</td><td>Factory metaphor</td></tr>
            <tr><td><strong>Roles</strong></td><td>Orchestrator + Workers</td><td>7 specialized roles</td></tr>
          </tbody>
        </table>
      </div>

      <h3>7.2 CC Mirror vs Ralph Wiggum Loop</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Aspect</th><th>CC Mirror</th><th>Ralph Loop</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Type</strong></td><td>Multi-agent parallel</td><td>Single-agent iterative</td></tr>
            <tr><td><strong>Task Decomposition</strong></td><td>Parallel fan-out</td><td>Sequential iterations</td></tr>
            <tr><td><strong>State Management</strong></td><td>TaskCreate/Update API</td><td>File-based (prd.json)</td></tr>
            <tr><td><strong>Dependencies</strong></td><td>blocks/blockedBy</td><td>Manual ordering</td></tr>
            <tr><td><strong>Context Strategy</strong></td><td>Worker isolation</td><td>Fresh per iteration</td></tr>
            <tr><td><strong>Use Case</strong></td><td>Complex projects with dependencies</td><td>Overnight single-feature shipping</td></tr>
            <tr><td><strong>Human Role</strong></td><td>Minimal (set and go)</td><td>Review each iteration</td></tr>
          </tbody>
        </table>
      </div>

      <h3>7.3 The 80/20 Rule</h3>

      <blockquote>
        <p>"Simplicity covers 80% with zero effort - mass-market ease"</p>
        <cite>-- @nummanali</cite>
      </blockquote>

      <p><strong>Positioning:</strong></p>
      <ul>
        <li><strong>CC Mirror:</strong> 80% of use cases, zero effort, mass-market</li>
        <li><strong>Gas Town:</strong> 20% complex cases, heavy customization, Stage 7+ developers only</li>
        <li><strong>Ralph Loop:</strong> Orthogonal (sequential iteration, can combine with CC Mirror workers)</li>
      </ul>
    </section>

    <hr class="section-divider">

    <!-- 8. Production Considerations -->
    <section id="production">
      <h2><span class="b">8.</span> Production <span class="b">Con</span>siderations</h2>

      <h3>8.1 Known Limitations</h3>
      <ol>
        <li><strong>Beta/Disabled Feature</strong> - May change without notice</li>
        <li><strong>Relies on editing minified JS</strong> - Updates to Claude Code may break CC Mirror</li>
        <li><strong>Context Collapse Risk</strong> - Enable auto-compact to mitigate</li>
        <li><strong>Parallel Worker Conflicts</strong> - Multiple workers touching same files</li>
        <li><strong>Token Cost</strong> - 5,299 token skill file upfront cost</li>
        <li><strong>Windows Compatibility</strong> - Issues reported (fixes in progress)</li>
      </ol>

      <h3>8.2 Error Handling and Recovery</h3>

      <h4>Strategy 1: Retry with Enhanced Context</h4>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>If worker fails with error:
1. Parse error message for root cause
2. Add error context to new worker preamble:
   "PRIOR ATTEMPT FAILED: [error summary]
    AVOID: [specific pitfall]"
3. Retry with fresh worker</code></pre>
      </div>

      <h4>Strategy 2: Decompose Further</h4>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>If worker consistently fails on task:
1. Split task into smaller subtasks
2. Assign prerequisite tasks first
3. Verify prerequisites before retrying original</code></pre>
      </div>

      <h4>Strategy 3: Escalate Model</h4>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>If Haiku fails -> Retry with Sonnet
If Sonnet fails -> Retry with Opus
If Opus fails -> Escalate to human via AskUserQuestion</code></pre>
      </div>

      <h3>8.3 Conflict Resolution Strategies</h3>

      <p><strong>Branch Isolation (Primary):</strong></p>
      <blockquote>
        <p>"Parallel agents cause merge conflicts - use serial"</p>
        <cite>-- Matt Pocock</cite>
      </blockquote>

      <p>Each agent works on its own branch. Human merges.</p>

      <p><strong>File-Level Assignment:</strong></p>
      <p>Include in task descriptions: "Only modify files in src/api/ - do not touch src/ui/"</p>

      <p><strong>Git Worktrees for Parallel Isolation:</strong></p>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>git worktree add ../agent-1 task-1-branch
git worktree add ../agent-2 task-2-branch</code></pre>
      </div>

      <h3>8.4 When It's Safe to Use</h3>

      <p><strong>Safe scenarios:</strong></p>
      <ul>
        <li>Personal projects and learning</li>
        <li>Demos and prototypes</li>
        <li>Well-isolated tasks with clear boundaries</li>
        <li>When you can tolerate occasional failures</li>
      </ul>

      <p><strong>Caution scenarios:</strong></p>
      <ul>
        <li>Production systems requiring reliability</li>
        <li>Tasks requiring custom observability</li>
        <li>Workflows needing precise state control</li>
      </ul>
    </section>

    <hr class="section-divider">

    <!-- 9. Alternatives -->
    <section id="alternatives">
      <h2><span class="b">9.</span> Alternative Multi-Agent <span class="b">Too</span>ls</h2>

      <h3>9.1 Related Community Tools</h3>

      <div class="table-responsive">
        <table>
          <thead>
            <tr><th>Tool</th><th>Purpose</th><th>Command</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>rpai</strong></td><td>tmux multi-agent manager</td><td><code>cargo install rpai && rpai</code></td></tr>
            <tr><td><strong>Claude HUD</strong></td><td>Context/tool monitoring</td><td><code>/plugin install claude-hud</code></td></tr>
            <tr><td><strong>Claude Mem</strong></td><td>Persistent memory</td><td><code>/plugin install claude-mem</code></td></tr>
            <tr><td><strong>Gas Town</strong></td><td>Factory-scale orchestration</td><td><code>go install github.com/steveyegge/gastown/cmd/gt@latest</code></td></tr>
            <tr><td><strong>Orchestra</strong></td><td>Self-improving orchestrator</td><td>github.com/0xSero/orchestra</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <hr class="section-divider">

    <!-- 10. Quick Reference -->
    <section id="quick-reference">
      <h2><span class="b">10.</span> Quick <span class="b">Ref</span>erence</h2>

      <h3>10.1 Installation Commands</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Install variant
npx cc-mirror quick --provider mirror --name mclaude

# Launch
mclaude

# Load skill
"Load the orchestration skill and initiate"</code></pre>
      </div>

      <h3>10.2 Task Management API</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>TaskCreate  - Create task with subject, description, acceptance criteria
TaskList    - List tasks (filter by status, owner, blocked)
TaskGet     - Get full task context
TaskUpdate  - Update task (claim, comment, resolve)
addBlocks   - Mark task as blocking another
addBlockedBy - Mark task as blocked by another</code></pre>
      </div>

      <h3>10.3 Model Selection</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>Haiku  -> Simple lookups, file fetching (5-10 parallel)
Sonnet -> Implementation, patterns, tests (2-5 parallel)
Opus   -> Architecture, complex reasoning (1 sequential)</code></pre>
      </div>

      <h3>10.4 Tool Ownership</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code>Orchestrator: Read (1-2 files), Task*, AskUserQuestion
Worker: Read, Write, Edit, Bash, Glob, Grep, WebFetch, WebSearch
Workers NEVER: Task*, spawn sub-agents</code></pre>
      </div>

      <h3>10.5 CLI Commands</h3>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <pre><code># Variant management
npx cc-mirror list
npx cc-mirror update [name]
npx cc-mirror remove &lt;name&gt;
npx cc-mirror doctor

# Task management
npx cc-mirror tasks list
npx cc-mirror tasks show &lt;id&gt;
npx cc-mirror tasks create
npx cc-mirror tasks update &lt;id&gt;
npx cc-mirror tasks graph
npx cc-mirror tasks clean --resolved</code></pre>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Troubleshooting -->
    <section id="troubleshooting">
      <h2><span class="b">Trou</span>bleshooting</h2>

      <details class="troubleshoot">
        <summary>CC Mirror skill not loading</summary>
        <div>
          <p><strong>Symptoms:</strong> Claude says it doesn't know about orchestration features. TaskCreate/TaskUpdate not recognized.</p>
          <p><strong>Causes:</strong></p>
          <ol>
            <li><code>cc_mirror_mode: true</code> not set in settings.json</li>
            <li>Skill file not in correct location</li>
            <li>JavaScript patch not applied to Claude</li>
          </ol>
          <p><strong>Solutions:</strong></p>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code># Verify installation
npx cc-mirror doctor

# Check settings
cat ~/.claude/settings.json | grep cc_mirror

# Re-run quick install if needed
npx cc-mirror quick --provider mirror --name mclaude

# Verify skill file exists
ls -la ~/.claude/skills/orchestration/</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Workers not spawning</summary>
        <div>
          <p><strong>Symptoms:</strong> TaskCreate succeeds but workers never start. Tasks stay in OPEN status.</p>
          <p><strong>Causes:</strong></p>
          <ol>
            <li>Model doesn't support tool use properly</li>
            <li>Insufficient permissions in CLAUDE.md</li>
            <li>Worker context too large</li>
          </ol>
          <p><strong>Solutions:</strong></p>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code># Check if workers are blocked
"TaskList --status=blocked"

# Try spawning worker explicitly
"Assign this task to a Haiku worker: &lt;task-id&gt;"</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Workers touching same files - conflicts</summary>
        <div>
          <p><strong>Symptoms:</strong> Multiple workers modify same file. Edits overwrite each other.</p>
          <p><strong>Solutions:</strong></p>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code># Add explicit file ownership to task descriptions:
"Task: Implement auth
Ownership: src/auth/*.ts
DO NOT MODIFY: src/components/*"

# Use worktrees for true isolation:
git worktree add ../project-worker1 -b worker1
git worktree add ../project-worker2 -b worker2

# Sequence tasks with dependencies:
Task A -> blocks -> Task B</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Context collapse - orchestrator degraded</summary>
        <div>
          <p><strong>Symptoms:</strong> Orchestrator forgets task state. Makes inconsistent decisions.</p>
          <p><strong>Solutions:</strong></p>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code># Enable auto-compact
# In settings.json: "auto_compact": true

# For long sessions, proactively reset:
/compact
"Reload task state and continue"

# Monitor context:
/context
# If >70%, compact before continuing</code></pre>
          </div>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Emergency Recovery</summary>
        <div>
          <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code># Kill all stuck workers
pkill -f "claude"

# Check task state
npx cc-mirror tasks list --all

# Clear stuck tasks
npx cc-mirror tasks clean --stuck

# Full reset (preserves no task state)
npx cc-mirror tasks clean --all

# Re-initialize fresh
npx cc-mirror remove mclaude
npx cc-mirror quick --provider mirror --name mclaude

# If Git worktrees in chaos:
git worktree list
git worktree remove ../project-worker1 --force
git checkout main</code></pre>
          </div>
        </div>
      </details>
    </section>

    <hr class="section-divider">

    <!-- Related Pages -->
    <div class="related-pages">
      <h3>Related Pages</h3>
      <ul>
        <li><a href="mastery-ralph-complete.html">Ralph Complete Mastery</a> - Alternative sequential orchestration pattern</li>
        <li><a href="ralph-ecosystem-complete.html">Ralph Ecosystem</a> - All Ralph variants with runnable code</li>
        <li><a href="compare-orchestration.html">Orchestration Compared</a> - Ralph vs CC Mirror vs Gas Town</li>
      </ul>
    </div>

    <!-- Footer Navigation -->
    <nav class="footer-nav">
      <a href="ralph-ecosystem-complete.html" class="nav-prev">
        <span class="nav-direction">Previous</span>
        <span class="nav-title">Ralph Ecosystem</span>
      </a>
      <a href="compare-orchestration.html" class="nav-next">
        <span class="nav-direction">Next</span>
        <span class="nav-title">Orchestration Compared</span>
      </a>
    </nav>

  </div>

  <nav class="left-nav" id="leftNav">
    <div class="px-4 mb-4">
      <a href="../index.html" class="text-xs font-semibold text-accent hover:text-accent-light uppercase tracking-wider">Claude Code KB</a>
    </div>
    <div class="nav-content"></div>
  </nav>

  <script src="../js/search.js"></script>
  <script src="../js/sidebar.js"></script>
  <script src="../js/global-nav.js"></script>
  <script>
    function copyCode(button) {
      const codeBlock = button.parentElement.querySelector('code');
      navigator.clipboard.writeText(codeBlock.textContent);
      button.textContent = 'Copied!';
      button.classList.add('copied');
      setTimeout(() => {
        button.textContent = 'Copy';
        button.classList.remove('copied');
      }, 2000);
    }
  </script>
</body>
</html>
