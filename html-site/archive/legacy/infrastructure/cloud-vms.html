<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta data-pagefind-meta="chapter" content="Infrastructure">
  <meta data-pagefind-meta="section" content="Infrastructure">
  <title>Cloud VMs for Claude Code - Infrastructure</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/search.css">
  <style>
    .bionic { font-weight: 700; }

    .you-are-here {
      background: linear-gradient(135deg, #f0ebe3 0%, #fefcf3 100%);
      border-left: 4px solid var(--accent);
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 2rem;
    }

    .checkpoint {
      background: #f0ebe3;
      border-left: 4px solid var(--success);
      border-radius: 8px;
      padding: 1.5rem;
      margin: 2rem 0;
    }

    .checkpoint-header {
      color: var(--success);
      font-weight: 600;
      margin-top: 0;
      margin-bottom: 0.75rem;
    }

    .troubleshoot {
      border: 1px solid var(--error);
      border-radius: 8px;
      margin: 1rem 0;
    }

    .troubleshoot summary {
      background: #fef6f5;
      padding: 1rem;
      cursor: pointer;
      color: var(--error);
      font-weight: 600;
    }

    .troubleshoot > div {
      padding: 1rem;
    }

    .milestone {
      background: linear-gradient(90deg, var(--success) 0%, var(--accent) 100%);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      text-align: center;
      margin: 2rem 0;
      font-weight: 600;
    }

    .divider-procedure { border-top: 3px solid var(--accent); margin: 2.5rem 0; }
    .divider-checkpoint { border-top: 3px solid var(--success); margin: 2.5rem 0; }
    .divider-warning { border-top: 3px solid var(--warning); margin: 2.5rem 0; }
    .divider-context { border-top: 3px solid var(--heading); margin: 2.5rem 0; }

    .cost-table {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid var(--border);
      margin: 1.5rem 0;
    }

    .cost-table th {
      background: var(--heading);
      color: white;
    }

    .cost-highlight {
      background: linear-gradient(135deg, #eef6f0 0%, white 100%);
    }

    .why-cloud {
      background: var(--bg-secondary);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 2rem 0;
    }

    .architecture-box {
      background: var(--code-bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1.5rem;
      font-family: 'SF Mono', monospace;
      font-size: 0.85rem;
      overflow-x: auto;
      white-space: pre;
      margin: 1.5rem 0;
    }

    .spec-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
      margin: 1.5rem 0;
    }

    .spec-card {
      background: white;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
    }

    .spec-card .value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent);
    }

    .spec-card .label {
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    .provider-comparison {
      background: white;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }

    .provider-comparison h4 {
      margin-top: 0;
    }

    .recommendation-box {
      background: linear-gradient(135deg, #eef6f0 0%, #e8f5e8 100%);
      border-left: 4px solid var(--success);
      border-radius: 0 12px 12px 0;
      padding: 1.25rem 1.5rem;
      margin: 1.5rem 0;
    }

    .recommendation-box::before {
      content: "Recommended";
      display: block;
      font-weight: 700;
      color: var(--success);
      font-size: 0.85em;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.5rem;
    }

    .warning-box {
      background: #fdf6e9;
      border-left: 4px solid var(--warning);
      border-radius: 0 12px 12px 0;
      padding: 1.25rem 1.5rem;
      margin: 1.5rem 0;
    }

    .warning-box::before {
      content: "Important";
      display: block;
      font-weight: 700;
      color: var(--warning);
      font-size: 0.85em;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.5rem;
    }
  </style>
</head>
<body>
  <!-- Search Modal -->
  <div class="search-modal" id="searchModal" aria-hidden="true">
    <div class="search-overlay" onclick="closeSearch()"></div>
    <div class="search-content">
      <div class="search-header">
        <div class="search-input-wrapper">
          <span class="search-icon-input">üîç</span>
          <input type="text" id="searchInput" placeholder="Search documentation..." autocomplete="off" />
          <kbd class="search-kbd">ESC</kbd>
        </div>
      </div>
      <div class="search-filters">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="ch1">Chapter 1</button>
        <button class="filter-btn" data-filter="ch2">Chapter 2</button>
        <button class="filter-btn" data-filter="ch3">Chapter 3</button>
        <button class="filter-btn" data-filter="ch4">Chapter 4</button>
        <button class="filter-btn" data-filter="ref">Reference</button>
      </div>
      <div class="search-results" id="searchResults">
        <div class="search-empty"><p>Start typing to search... (Press ‚åòK anytime)</p></div>
      </div>
      <div class="search-footer">
        <span>‚Üë‚Üì Navigate</span><span>‚Üµ Select</span><span>ESC Close</span>
      </div>
    </div>
  </div>

  <button class="search-trigger" onclick="openSearch()" aria-label="Search" style="float: right; margin-bottom: 1rem;">
    <span class="search-icon">‚åòK</span>
    <span class="search-text">Search</span>
  </button>

  <div class="container">

    <!-- Breadcrumb Navigation -->
    <nav class="nav-breadcrumb">
      <a href="../index.html">Home</a>
      <span>/</span>
      <a href="index.html">Infrastructure</a>
      <span>/</span>
      Cloud VMs
    </nav>

    <!-- You Are Here Context Box -->
    <div class="you-are-here">
      <strong><span class="bionic">You</span> Are <span class="bionic">Her</span>e:</strong> This page covers <strong><span class="bionic">clo</span>ud VM</strong> setup for <span class="bionic">Cla</span>ude Code - how to provision, configure, and optimize virtual machines for <span class="bionic">rem</span>ote AI development.
      <br><br>
      <strong><span class="bionic">Why</span> This Matters:</strong> A <span class="bionic">clo</span>ud VM gives you an <span class="bionic">alw</span>ays-on development environment that never sleeps. Run <strong>6+ parallel Claude agents</strong> for ~$7/day. Access from <span class="bionic">any</span>where - laptop, phone, tablet. Your <span class="bionic">loc</span>al machine stays clean while heavy AI work happens in the cloud.
      <br><br>
      <strong><span class="bionic">Pre</span>requisites:</strong> Basic terminal/SSH knowledge. Familiarity with Claude Code basics. A cloud provider account (Vultr, DigitalOcean, AWS, etc.).
    </div>

    <h1><span class="bionic">Clo</span>ud VMs for <span class="bionic">Cla</span>ude Code</h1>

    <p class="conversational-lead">
      <span class="bionic">Pio</span>neered by Nader Dabit (@dabit3), cloud VMs unlock the full potential of Claude Code: <span class="bionic">par</span>allel agents, <span class="bionic">mob</span>ile access, and <span class="bionic">24</span>/7 availability. This is the <span class="bionic">ove</span>rview page - see <a href="mobile-cloud-vm.html">Mobile Cloud VM Access</a> for <span class="bionic">pho</span>ne-specific setup.
    </p>

    <hr class="divider-context">

    <!-- Why Cloud VMs Section -->
    <section id="why-cloud">
      <h2><span class="bionic">Why</span> Cloud VMs?</h2>

      <div class="why-cloud">
        <h3><span class="bionic">The</span> Core <span class="bionic">Ben</span>efits</h3>
        <ul>
          <li><strong><span class="bionic">Par</span>allel Agents:</strong> Run 6+ Claude Code instances simultaneously, each on its own branch</li>
          <li><strong><span class="bionic">Alw</span>ays On:</strong> VM runs 24/7 - start tasks before bed, wake up to progress</li>
          <li><strong><span class="bionic">Mob</span>ile Access:</strong> SSH from your phone to check status, answer questions, review work</li>
          <li><strong><span class="bionic">Cle</span>an Local Machine:</strong> Heavy AI workloads don't drain your laptop battery or fan</li>
          <li><strong><span class="bionic">Pay</span> Per Use:</strong> Hourly billing means you only pay when actively coding</li>
        </ul>
      </div>

      <blockquote>
        <strong>"Instead of long periods of intense focus, software development can now just fit into the gaps of your day."</strong>
        <br><em>- Nader Dabit (@dabit3)</em>
      </blockquote>
    </section>

    <hr class="divider-procedure">

    <!-- Architecture Section -->
    <section id="architecture">
      <h2><span class="bionic">Arc</span>hitecture <span class="bionic">Ove</span>rview</h2>

      <div class="architecture-box">+-------------------------------------------------------------+
|  YOUR DEVICE (Phone, Laptop, Tablet)                        |
|  - Termius / Prompt / iTerm (SSH client)                    |
|  - Tailscale VPN (secure mesh network)                      |
|  - Push notification app (Poke, Pushover, ntfy)             |
+-------------------------------------------------------------+
                           |
                    Tailscale VPN
              (encrypted, no ports exposed)
                           |
                           v
+-------------------------------------------------------------+
|  CLOUD VM (Vultr vhf-8c-32gb recommended)                   |
|  +-- Ubuntu 22.04 / 24.04 LTS                               |
|  +-- tmux (persistent terminal sessions)                    |
|  +-- 6x Claude Code agents (parallel tmux windows)          |
|  +-- Git worktrees (branch isolation)                       |
|  +-- PreToolUse hook --> Push notifications                 |
|  +-- Security: fail2ban, nftables, Tailscale-only SSH       |
+-------------------------------------------------------------+</div>

      <p>The architecture separates your <strong><span class="bionic">int</span>erface</strong> (any device with SSH) from your <strong><span class="bionic">com</span>pute</strong> (cloud VM). This means:</p>
      <ul>
        <li>Your phone becomes a legitimate development terminal</li>
        <li>Claude agents continue working even when you disconnect</li>
        <li>Multiple people can connect to the same VM if needed</li>
      </ul>
    </section>

    <hr class="divider-procedure">

    <!-- Cost Analysis Section -->
    <section id="costs">
      <h2><span class="bionic">Cos</span>t <span class="bionic">Ana</span>lysis</h2>

      <p>Cloud VMs are billed <strong><span class="bionic">hou</span>rly</strong>. The key insight: you can <span class="bionic">sto</span>p the VM when not coding and pay nothing. Here's the math:</p>

      <table class="cost-table">
        <thead>
          <tr>
            <th>Provider</th>
            <th>Plan</th>
            <th>Specs</th>
            <th>Hourly</th>
            <th>Daily (24h)</th>
            <th>Monthly</th>
          </tr>
        </thead>
        <tbody>
          <tr class="cost-highlight">
            <td><strong>Vultr</strong></td>
            <td>vhf-8c-32gb</td>
            <td>8 cores, 32GB RAM</td>
            <td>$0.29</td>
            <td><strong>~$7</strong></td>
            <td>~$210</td>
          </tr>
          <tr>
            <td>DigitalOcean</td>
            <td>Premium 8vcpu-32gb</td>
            <td>8 cores, 32GB RAM</td>
            <td>$0.31</td>
            <td>~$7.50</td>
            <td>~$226</td>
          </tr>
          <tr>
            <td>AWS EC2</td>
            <td>m6i.2xlarge</td>
            <td>8 cores, 32GB RAM</td>
            <td>$0.38</td>
            <td>~$9</td>
            <td>~$280</td>
          </tr>
          <tr>
            <td>GCP</td>
            <td>n2-standard-8</td>
            <td>8 cores, 32GB RAM</td>
            <td>$0.39</td>
            <td>~$9.30</td>
            <td>~$285</td>
          </tr>
          <tr>
            <td>Hetzner</td>
            <td>CPX51</td>
            <td>16 cores, 32GB RAM</td>
            <td>$0.07</td>
            <td>~$1.70</td>
            <td>~$50</td>
          </tr>
        </tbody>
      </table>

      <div class="recommendation-box">
        <strong>Vultr vhf-8c-32gb</strong> is the community favorite for Claude Code. The "vhf" (Very High Frequency) tier offers faster single-thread performance, crucial for responsive Claude interactions. US data centers mean low latency. Hourly billing + API access enables iOS Shortcuts automation.
      </div>

      <div class="spec-grid">
        <div class="spec-card">
          <div class="value">~$7</div>
          <div class="label">Per Day (if always on)</div>
        </div>
        <div class="spec-card">
          <div class="value">~$70</div>
          <div class="label">Per Month (10hr/day avg)</div>
        </div>
        <div class="spec-card">
          <div class="value">6+</div>
          <div class="label">Parallel Claude Agents</div>
        </div>
        <div class="spec-card">
          <div class="value">32GB</div>
          <div class="label">RAM for Heavy Workloads</div>
        </div>
      </div>

      <div class="warning-box">
        <strong>Cost trap:</strong> If you leave the VM running 24/7 all month, you'll pay ~$210. Use <code>vm-stop</code> scripts (covered below) to halt when not coding. Most developers average 4-10 hours/day of actual use = $30-70/month.
      </div>
    </section>

    <hr class="divider-procedure">

    <!-- Why Vultr Section -->
    <section id="why-vultr">
      <h2><span class="bionic">Why</span> Vultr <span class="bionic">Spe</span>cifically?</h2>

      <p>Nader Dabit chose Vultr for specific reasons:</p>

      <div class="provider-comparison">
        <h4><span class="bionic">Vul</span>tr Advantages</h4>
        <ul>
          <li><strong><span class="bionic">Hou</span>rly Billing:</strong> Stop VM when not coding, pay only for active hours</li>
          <li><strong><span class="bionic">Hig</span>h Frequency Compute:</strong> "vhf" tier = faster single-thread performance</li>
          <li><strong><span class="bionic">US</span> Presence:</strong> Multiple US data centers for low latency</li>
          <li><strong><span class="bionic">API</span> Access:</strong> iOS Shortcuts can start/stop VMs programmatically</li>
          <li><strong><span class="bionic">Sim</span>ple Pricing:</strong> No surprise egress fees for basic usage</li>
        </ul>
      </div>

      <p><strong><span class="bionic">Alt</span>ernatives worth considering:</strong></p>
      <ul>
        <li><strong>Hetzner</strong> - Much cheaper (~$50/mo), but EU-only data centers = higher latency from US</li>
        <li><strong>DigitalOcean</strong> - Similar pricing, excellent UI, good for beginners</li>
        <li><strong>AWS/GCP</strong> - More expensive, but if your company already has accounts, easier to expense</li>
      </ul>
    </section>

    <hr class="divider-checkpoint">

    <!-- Setup Phase 1 -->
    <section id="setup-provision">
      <h2><span class="bionic">Set</span>up Phase 1: <span class="bionic">Pro</span>vision VM</h2>

      <h3><span class="bionic">Opt</span>ion A: <span class="bionic">Web</span> Console</h3>
      <ol>
        <li>Create account at <a href="https://vultr.com" target="_blank">vultr.com</a></li>
        <li>Click "Deploy" -> "Cloud Compute"</li>
        <li>Select region (e.g., "New Jersey" for US East)</li>
        <li>Choose "Ubuntu 24.04 LTS x64"</li>
        <li>Select plan: <strong>High Frequency > 8 vCPU, 32GB RAM</strong></li>
        <li>Add your SSH key (required for secure access)</li>
        <li>Deploy and note the IP address</li>
      </ol>

      <h3><span class="bionic">Opt</span>ion B: API/<span class="bionic">CLI</span> (for automation)</h3>
      <pre><code># Using Vultr API (for iOS Shortcut automation)
curl -X POST "https://api.vultr.com/v2/instances" \
  -H "Authorization: Bearer $VULTR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "region": "ewr",
    "plan": "vhf-8c-32gb",
    "os_id": 2284,
    "label": "claude-dev",
    "sshkey_id": ["your-key-id"]
  }'</code></pre>

      <div class="checkpoint">
        <h4 class="checkpoint-header">Checkpoint: VM Provisioned</h4>
        <p>You should have:</p>
        <ul>
          <li>A running VM with a public IP address</li>
          <li>SSH key configured for authentication</li>
          <li>Ability to SSH: <code>ssh root@YOUR_IP</code></li>
        </ul>
        <p><strong>Test it:</strong> <code>ssh root@YOUR_IP "echo 'Hello from cloud!'"</code></p>
      </div>
    </section>

    <hr class="divider-procedure">

    <!-- Setup Phase 2 -->
    <section id="setup-security">
      <h2><span class="bionic">Set</span>up Phase 2: <span class="bionic">Sec</span>urity Hardening</h2>

      <p><span class="bionic">Nev</span>er skip this. A compromised VM could run up huge bills or worse.</p>

      <h3><span class="bionic">Cre</span>ate Non-Root User</h3>
      <pre><code># Create a dev user (replace 'devuser' with your preferred name)
adduser devuser
usermod -aG sudo devuser

# Copy SSH keys to new user
mkdir -p /home/devuser/.ssh
cp ~/.ssh/authorized_keys /home/devuser/.ssh/
chown -R devuser:devuser /home/devuser/.ssh
chmod 700 /home/devuser/.ssh
chmod 600 /home/devuser/.ssh/authorized_keys</code></pre>

      <h3><span class="bionic">Ins</span>tall Security Tools</h3>
      <pre><code># Update system
sudo apt update && sudo apt upgrade -y

# Install fail2ban (blocks repeated failed SSH attempts)
sudo apt install -y fail2ban
sudo systemctl enable fail2ban
sudo systemctl start fail2ban</code></pre>

      <h3><span class="bionic">Con</span>figure Firewall (nftables)</h3>
      <pre><code># Configure firewall - allow only Tailscale
sudo nft add table inet filter
sudo nft add chain inet filter input { type filter hook input priority 0 \; }
sudo nft add rule inet filter input iif "lo" accept
sudo nft add rule inet filter input ct state established,related accept
sudo nft add rule inet filter input tcp dport 41641 accept  # Tailscale
sudo nft add rule inet filter input drop</code></pre>

      <div class="warning-box">
        <strong>Public SSH is dangerous.</strong> We'll set up Tailscale next, which creates a private VPN. After Tailscale is working, you can (and should) disable public SSH entirely.
      </div>

      <div class="checkpoint">
        <h4 class="checkpoint-header">Checkpoint: Security Hardened</h4>
        <p>You should have:</p>
        <ul>
          <li>Non-root user with sudo access</li>
          <li>fail2ban running and enabled</li>
          <li>Firewall rules configured (will fully activate after Tailscale)</li>
        </ul>
        <p><strong>Test:</strong> <code>ssh devuser@YOUR_IP</code> - should work with your SSH key</p>
      </div>
    </section>

    <hr class="divider-procedure">

    <!-- Setup Phase 3 -->
    <section id="setup-tailscale">
      <h2><span class="bionic">Set</span>up Phase 3: <span class="bionic">Tai</span>lscale VPN</h2>

      <p><span class="bionic">Tai</span>lscale creates a <span class="bionic">pri</span>vate mesh VPN. Your VM gets a 100.x.x.x address only accessible to devices on your Tailscale network. <strong>No exposed ports, no open endpoints.</strong></p>

      <h3><span class="bionic">Ins</span>tall on VM</h3>
      <pre><code># Install Tailscale
curl -fsSL https://tailscale.com/install.sh | sh

# Authenticate and enable SSH
sudo tailscale up --ssh

# Note your Tailscale IP
tailscale ip -4  # Will show 100.x.x.x</code></pre>

      <h3><span class="bionic">Ins</span>tall on Your Devices</h3>
      <ul>
        <li><strong>Mac/Windows/Linux:</strong> <a href="https://tailscale.com/download" target="_blank">tailscale.com/download</a></li>
        <li><strong>iPhone:</strong> App Store -> "Tailscale"</li>
        <li><strong>Android:</strong> Play Store -> "Tailscale"</li>
      </ul>

      <p>Sign in with the <span class="bionic">sam</span>e account on all devices.</p>

      <h3><span class="bionic">Dis</span>able Public SSH (Critical!)</h3>
      <pre><code># Now that Tailscale works, disable public SSH
sudo ufw allow from 100.64.0.0/10 to any port 22  # Allow Tailscale subnet only
sudo ufw deny 22  # Block public SSH
# Or update nftables to only allow Tailscale IPs</code></pre>

      <div class="checkpoint">
        <h4 class="checkpoint-header">Checkpoint: Tailscale Connected</h4>
        <p>You should have:</p>
        <ul>
          <li>Tailscale running on VM with a 100.x.x.x IP</li>
          <li>Tailscale installed on your phone/laptop</li>
          <li>Ability to SSH via Tailscale IP: <code>ssh devuser@100.x.x.x</code></li>
        </ul>
        <p><strong>Test from phone:</strong> Install Tailscale, sign in, then use Termius to SSH to the 100.x.x.x IP</p>
      </div>
    </section>

    <hr class="divider-procedure">

    <!-- Setup Phase 4 -->
    <section id="setup-devtools">
      <h2><span class="bionic">Set</span>up Phase 4: <span class="bionic">Dev</span>elopment Tools</h2>

      <h3><span class="bionic">Ess</span>ential Packages</h3>
      <pre><code># Essential packages
sudo apt install -y tmux mosh git curl jq nodejs npm zsh

# Optional: Better shell experience
sh -c "$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"</code></pre>

      <h3><span class="bionic">Ins</span>tall Claude Code</h3>
      <pre><code># Option A: npm
npm install -g @anthropic-ai/claude-code

# Option B: Official installer
curl -fsSL https://cli.anthropic.com/install.sh | sh

# Authenticate
claude login</code></pre>

      <h3><span class="bionic">Con</span>figure tmux Auto-Attach</h3>
      <p>Add to <code>~/.zshrc</code> (or <code>~/.bashrc</code>):</p>
      <pre><code># Auto-attach to tmux on SSH login
if [[ -z "$TMUX" ]] && [[ -n "$SSH_CONNECTION" ]]; then
  tmux attach -t main 2>/dev/null || tmux new -s main
fi</code></pre>

      <h3><span class="bionic">tmu</span>x Configuration</h3>
      <p>Create <code>~/.tmux.conf</code>:</p>
      <pre><code># Better prefix (easier on phone keyboard)
set -g prefix C-a
unbind C-b
bind C-a send-prefix

# Quick pane switching
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Mouse support (for phone taps)
set -g mouse on

# Larger scrollback
set -g history-limit 50000

# Status bar showing git branch
set -g status-right '#[fg=yellow]#(cd #{pane_current_path} && git branch --show-current) #[fg=white]| #[fg=cyan]%H:%M'</code></pre>

      <div class="checkpoint">
        <h4 class="checkpoint-header">Checkpoint: Dev Tools Ready</h4>
        <p>You should have:</p>
        <ul>
          <li>tmux, mosh, git, nodejs installed</li>
          <li>Claude Code installed and authenticated</li>
          <li>tmux auto-attaching on SSH login</li>
        </ul>
        <p><strong>Test:</strong> SSH in, run <code>claude --version</code>, verify tmux auto-attached</p>
      </div>
    </section>

    <hr class="divider-procedure">

    <!-- Parallel Agents Section -->
    <section id="parallel-agents">
      <h2><span class="bionic">Run</span>ning 6 <span class="bionic">Par</span>allel Agents</h2>

      <p>The real power: run <span class="bionic">mul</span>tiple Claude agents simultaneously, each working on a different feature branch.</p>

      <h3><span class="bionic">Git</span> Worktrees for <span class="bionic">Iso</span>lation</h3>
      <pre><code># Main repo
cd ~/projects
git clone https://github.com/youruser/your-project.git main
cd main

# Create worktrees for parallel branches
git worktree add ../feature-auth feature/auth
git worktree add ../feature-payments feature/payments
git worktree add ../feature-dashboard feature/dashboard
git worktree add ../feature-api feature/api
git worktree add ../feature-tests feature/tests
git worktree add ../feature-docs feature/docs</code></pre>

      <p>Each <span class="bionic">wor</span>ktree is a separate directory with its own branch. No conflicts, no merge issues.</p>

      <h3><span class="bionic">tmu</span>x Windows for <span class="bionic">Eac</span>h Agent</h3>
      <pre><code># Create tmux session with windows for each agent
tmux new-session -d -s agents -n agent-1 -c ~/projects/feature-auth
tmux new-window -t agents -n agent-2 -c ~/projects/feature-payments
tmux new-window -t agents -n agent-3 -c ~/projects/feature-dashboard
tmux new-window -t agents -n agent-4 -c ~/projects/feature-api
tmux new-window -t agents -n agent-5 -c ~/projects/feature-tests
tmux new-window -t agents -n agent-6 -c ~/projects/feature-docs

# Attach to the session
tmux attach -t agents</code></pre>

      <h3><span class="bionic">Por</span>t Allocation (Avoid Conflicts)</h3>
      <p>If your agents run dev servers, use hash-based port allocation:</p>
      <pre><code># In your startup scripts, allocate ports based on branch name
BRANCH=$(git branch --show-current)
HASH=$(echo "$BRANCH" | md5sum | cut -c1-4)
PORT=$((8000 + 16#$HASH % 1000))
echo "Dev server for $BRANCH on port $PORT"</code></pre>

      <div class="checkpoint">
        <h4 class="checkpoint-header">Checkpoint: Parallel Agents Running</h4>
        <p>You should have:</p>
        <ul>
          <li>Git worktrees created for each feature branch</li>
          <li>tmux session with 6 windows (Ctrl-A + number to switch)</li>
          <li>Claude Code running in each window on different tasks</li>
        </ul>
        <p><strong>Test:</strong> <code>tmux ls</code> shows "agents" session with 6 windows</p>
      </div>
    </section>

    <hr class="divider-procedure">

    <!-- VM Lifecycle Scripts -->
    <section id="lifecycle">
      <h2><span class="bionic">VM</span> <span class="bionic">Lif</span>ecycle Scripts</h2>

      <p><span class="bionic">Sav</span>e money by stopping your VM when not coding. These scripts can be triggered from iOS Shortcuts.</p>

      <h3>vm-start (<code>~/bin/vm-start</code>)</h3>
      <pre><code>#!/bin/bash
INSTANCE_ID="your-instance-id"
curl -X POST "https://api.vultr.com/v2/instances/$INSTANCE_ID/start" \
  -H "Authorization: Bearer $VULTR_API_KEY"
echo "VM starting... allow 30-60 seconds to boot"</code></pre>

      <h3>vm-stop (<code>~/bin/vm-stop</code>)</h3>
      <pre><code>#!/bin/bash
INSTANCE_ID="your-instance-id"
curl -X POST "https://api.vultr.com/v2/instances/$INSTANCE_ID/halt" \
  -H "Authorization: Bearer $VULTR_API_KEY"
echo "VM stopping (saving ~$7/day when not running)"</code></pre>

      <h3>vm-status (<code>~/bin/vm-status</code>)</h3>
      <pre><code>#!/bin/bash
INSTANCE_ID="your-instance-id"
curl -s "https://api.vultr.com/v2/instances/$INSTANCE_ID" \
  -H "Authorization: Bearer $VULTR_API_KEY" | jq '.instance.power_status'</code></pre>

      <p><strong><span class="bionic">iOS</span> Shortcuts:</strong> Create shortcuts that run these curl commands. Siri: "Start my dev server" / "Stop my dev server"</p>
    </section>

    <hr class="divider-warning">

    <!-- Troubleshooting Section -->
    <section id="troubleshooting">
      <h2><span class="bionic">Tro</span>ubleshooting</h2>

      <details class="troubleshoot">
        <summary>SSH connection refused / timeout</summary>
        <div>
          <p><strong>If using public IP:</strong></p>
          <ul>
            <li>Check VM is running: <code>vm-status</code></li>
            <li>Check firewall allows SSH: <code>sudo ufw status</code></li>
            <li>Verify correct IP address in Vultr console</li>
          </ul>
          <p><strong>If using Tailscale:</strong></p>
          <ul>
            <li>Ensure Tailscale is running on both devices: <code>tailscale status</code></li>
            <li>Use Tailscale IP (100.x.x.x), not public IP</li>
            <li>Try <code>tailscale ping YOUR_VM_NAME</code></li>
          </ul>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>tmux session lost after reboot</summary>
        <div>
          <p>tmux sessions don't persist across reboots by default. Options:</p>
          <ul>
            <li><strong>Prevention:</strong> Don't reboot - use <code>halt</code> to stop and Vultr API to start</li>
            <li><strong>Recovery:</strong> Re-create session: <code>tmux new -s agents</code></li>
            <li><strong>Persistence:</strong> Use <a href="https://github.com/tmux-plugins/tmux-resurrect">tmux-resurrect</a> plugin</li>
          </ul>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Claude Code authentication fails</summary>
        <div>
          <ul>
            <li>Re-authenticate: <code>claude logout && claude login</code></li>
            <li>Check API key: <code>echo $ANTHROPIC_API_KEY</code> (should be set)</li>
            <li>Verify internet connectivity: <code>curl -I https://api.anthropic.com</code></li>
          </ul>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>VM costs more than expected</summary>
        <div>
          <ul>
            <li><strong>Running 24/7:</strong> ~$210/month. Use vm-stop when not coding!</li>
            <li><strong>Check Vultr billing:</strong> Console > Billing > Current Usage</li>
            <li><strong>Set up alerts:</strong> Vultr supports billing alerts</li>
            <li><strong>Switch to Hetzner:</strong> ~$50/month if you can tolerate EU latency</li>
          </ul>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>Git worktree conflicts</summary>
        <div>
          <p>Worktrees should be isolated, but if you see conflicts:</p>
          <ul>
            <li><strong>Check worktree status:</strong> <code>git worktree list</code></li>
            <li><strong>Ensure different branches:</strong> Each worktree must be on a unique branch</li>
            <li><strong>Remove stale worktree:</strong> <code>git worktree remove ../feature-name</code></li>
          </ul>
        </div>
      </details>

      <details class="troubleshoot">
        <summary>mosh "Connection refused" or "Server is not responding"</summary>
        <div>
          <ul>
            <li>Install mosh server: <code>sudo apt install mosh</code></li>
            <li>Open UDP ports 60000-61000: <code>sudo ufw allow 60000:61000/udp</code></li>
            <li>For Tailscale: mosh uses UDP, ensure Tailscale allows it</li>
            <li>Alternative: Use regular SSH if mosh is problematic</li>
          </ul>
        </div>
      </details>
    </section>

    <hr class="divider-checkpoint">

    <!-- Milestone -->
    <div class="milestone">
      Cloud VM Setup Complete! Your always-on Claude Code environment is ready.
    </div>

    <!-- Related Pages -->
    <div class="related-pages">
      <h3>Continue Learning</h3>
      <ul>
        <li><a href="mobile-cloud-vm.html"><strong>Mobile Cloud VM Access</strong></a> - Phone-specific setup: Termius, push notifications, iOS Shortcuts</li>
        <li><a href="remote.html">Remote Access Patterns</a> - Deep dive on SSH, Tailscale, tmux configuration</li>
        <li><a href="../patterns/orchestration/ralph-research.html">Ralph Pattern</a> - Run continuous agents that leverage cloud VMs</li>
        <li><a href="../techniques/hooks.html">Hooks</a> - Set up push notifications when Claude needs input</li>
      </ul>
    </div>

    <!-- Footer Navigation -->
    <div class="footer-nav">
      <a href="index.html">Back to Infrastructure</a>
      <a href="mobile-cloud-vm.html">Next: Mobile Access</a>
    </div>

  </div>

  <script src="../js/copy-code.js"></script>
  <script src="../js/search.js"></script>
</body>
</html>
