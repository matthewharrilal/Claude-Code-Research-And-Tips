<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta data-pagefind-meta="chapter" content="Patterns">
  <meta data-pagefind-meta="section" content="Taxonomy">
  <title>Agent Architecture Taxonomy | Claude Code Knowledge Base</title>
  <link rel="stylesheet" href="../../css/style.css">
  <link rel="stylesheet" href="../../css/search.css">
</head>
<body>
  <!-- Search Modal -->
  <div class="search-modal" id="searchModal" aria-hidden="true">
    <div class="search-overlay" onclick="closeSearch()"></div>
    <div class="search-content">
      <div class="search-header">
        <div class="search-input-wrapper">
          <span class="search-icon-input">&#128269;</span>
          <input type="text" id="searchInput" placeholder="Search documentation..." autocomplete="off" />
          <kbd class="search-kbd">ESC</kbd>
        </div>
      </div>
      <div class="search-filters">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="ch1">Chapter 1</button>
        <button class="filter-btn" data-filter="ch2">Chapter 2</button>
        <button class="filter-btn" data-filter="ch3">Chapter 3</button>
        <button class="filter-btn" data-filter="ch4">Chapter 4</button>
        <button class="filter-btn" data-filter="ref">Reference</button>
      </div>
      <div class="search-results" id="searchResults">
        <div class="search-empty"><p>Start typing to search... (Press Cmd+K anytime)</p></div>
      </div>
      <div class="search-footer">
        <span>&#8593;&#8595; Navigate</span><span>&#8629; Select</span><span>ESC Close</span>
      </div>
    </div>
  </div>

  <div class="wide-container">
    <!-- Search Trigger Button -->
    <button class="search-trigger" onclick="openSearch()" aria-label="Search" style="float: right; margin-bottom: 1rem;">
      <span class="search-icon">Cmd+K</span>
      <span class="search-text">Search</span>
    </button>

    <nav class="nav-breadcrumb">
      <a href="../../index.html">Home</a>
      <span>/</span>
      <a href="../index.html">Patterns</a>
      <span>/</span>
      <a href="index.html">Taxonomy</a>
      <span>/</span>
      <strong>Architectures</strong>
    </nav>

    <div class="you-are-here" style="background: linear-gradient(135deg, #f0ebe3 0%, #fefcf3 100%); border-left: 4px solid #2a7d7d; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
      <h3 style="margin-top: 0; color: #2a7d7d;"><strong>You</strong> Are <strong>He</strong>re</h3>
      <p><strong>Thi</strong>s <strong>tax</strong>onomy <strong>cla</strong>ssifies <strong>age</strong>nt <strong>arc</strong>hitectures - the <strong>str</strong>uctural <strong>pat</strong>terns for how <strong>age</strong>nts are <strong>org</strong>anized and <strong>rel</strong>ate to <strong>eac</strong>h <strong>oth</strong>er. It <strong>cov</strong>ers <strong>sin</strong>gle-<strong>age</strong>nt <strong>thr</strong>ough <strong>swa</strong>rm <strong>arc</strong>hitectures.</p>
      <p><strong>Rel</strong>ated:</p>
      <ul style="margin-bottom: 0;">
        <li><a href="orchestration.html">Orchestration</a> - <strong>HO</strong>W <strong>age</strong>nts are <strong>coo</strong>rdinated</li>
        <li><a href="workflows.html">Workflows</a> - <strong>Tas</strong>k <strong>man</strong>agement <strong>pat</strong>terns</li>
      </ul>
    </div>

    <h1><strong>Age</strong>nt <strong>Arc</strong>hitecture <strong>Tax</strong>onomy</h1>

    <p class="conversational-lead">A <strong>com</strong>prehensive <strong>cla</strong>ssification of <strong>age</strong>nt <strong>pat</strong>terns for <strong>Cla</strong>ude <strong>Co</strong>de and <strong>AI</strong>-<strong>ass</strong>isted <strong>dev</strong>elopment. From <strong>sin</strong>gle <strong>int</strong>eractive <strong>ses</strong>sions to <strong>ent</strong>erprise-<strong>sca</strong>le <strong>fac</strong>tory <strong>pat</strong>terns.</p>

    <nav class="toc">
      <div class="toc-title">Table of Contents</div>
      <ul>
        <li><a href="#single-agent">1. Single Agent Patterns</a></li>
        <li><a href="#multi-agent">2. Multi-Agent Patterns</a></li>
        <li><a href="#orchestrator-worker">3. Orchestrator/Worker Separation</a></li>
        <li><a href="#swarm">4. Swarm Architectures</a></li>
        <li><a href="#hierarchies">5. Hierarchical Structures</a></li>
        <li><a href="#comparison">6. Architecture Comparison Matrix</a></li>
        <li><a href="#iron-law">7. The Iron Law of Worker Separation</a></li>
        <li><a href="#communication">8. Communication Patterns</a></li>
        <li><a href="#isolation">9. Isolation Strategies</a></li>
        <li><a href="#deployment">10. Production Deployment Patterns</a></li>
        <li><a href="#decision-tree">Decision Tree</a></li>
      </ul>
    </nav>

    <hr class="section-divider">

    <h2 id="single-agent"><strong>Sin</strong>gle <strong>Age</strong>nt <strong>Pat</strong>terns</h2>

    <div class="pattern-box">
      <h3 class="pattern-title">1.1 Interactive Session Pattern</h3>
      <p>The <strong>bas</strong>eline <strong>pat</strong>tern - <strong>hum</strong>an <strong>int</strong>eracts with a <strong>sin</strong>gle <strong>Cla</strong>ude <strong>Co</strong>de <strong>ins</strong>tance in a <strong>con</strong>versational <strong>loo</strong>p.</p>

      <pre><code>Human <---> Claude Code <---> Codebase
              |
              +---> Tools (Read, Write, Bash, etc.)</code></pre>

      <div class="comparison-table">
        <table>
          <thead>
            <tr>
              <th>Characteristic</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>Interaction</td><td>Synchronous, turn-based</td></tr>
            <tr><td>Context</td><td>Full available to single agent</td></tr>
            <tr><td>Human Role</td><td>Remains in loop for decisions</td></tr>
            <tr><td>Overhead</td><td>No coordination needed</td></tr>
          </tbody>
        </table>
      </div>

      <h4>Use Cases</h4>
      <ul>
        <li><strong>Exp</strong>loratory <strong>dev</strong>elopment</li>
        <li><strong>Deb</strong>ugging <strong>ses</strong>sions</li>
        <li><strong>Cod</strong>e <strong>rev</strong>iew</li>
        <li><strong>Lea</strong>rning and <strong>exp</strong>erimentation</li>
      </ul>

      <p><span class="tag">interactive</span> <span class="tag">single-agent</span> <span class="tag">supervised</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">1.2 Loop-Based Autonomous Pattern (Ralph Wiggum)</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> Geoffrey Huntley, @mattpocockuk, @ryancarson</p>

      <p>A <strong>bas</strong>h <strong>loo</strong>p that <strong>run</strong>s <strong>Cla</strong>ude <strong>Co</strong>de <strong>rep</strong>eatedly with <strong>fre</strong>sh <strong>con</strong>text <strong>unt</strong>il a <strong>com</strong>pletion <strong>con</strong>dition is <strong>me</strong>t.</p>

      <div class="ascii-diagram">
┌─────────────────────────────────────────────────────────────┐
│                    RALPH LOOP PATTERN                       │
├─────────────────────────────────────────────────────────────┤
│  ┌──────────────┐                                           │
│  │  PRD.json    │  ← Task definitions with passes: true/false│
│  │  progress.txt│  ← Append-only learnings log               │
│  └──────┬───────┘                                           │
│         │                                                   │
│         ▼                                                   │
│  ┌──────────────────────────────────────────────────────┐   │
│  │             ITERATION N (Fresh Context)               │   │
│  │  1. Read prd.json, progress.txt                       │   │
│  │  2. Pick next unpassed story                          │   │
│  │  3. Implement feature                                 │   │
│  │  4. Run tests                                         │   │
│  │  5. If passing: commit, update prd.json passes: true  │   │
│  │  6. Append learnings to progress.txt                  │   │
│  │  7. Output PROMISE COMPLETE if all done               │   │
│  └──────────────────────────────────────────────────────┘   │
│         │                                                   │
│         ▼                                                   │
│  ┌──────────────┐                                           │
│  │ All complete?│────YES───► EXIT                           │
│  └──────┬───────┘                                           │
│         │ NO                                                │
│         └──────────────► LOOP (new iteration, fresh context)│
└─────────────────────────────────────────────────────────────┘
      </div>

      <h4>Key Principles</h4>
      <ol>
        <li><strong>Fre</strong>sh <strong>con</strong>text per <strong>ite</strong>ration - <strong>avo</strong>ids <strong>con</strong>text <strong>ro</strong>t</li>
        <li><strong>Ext</strong>ernal <strong>mem</strong>ory - <strong>gi</strong>t <strong>his</strong>tory + progress.txt</li>
        <li><strong>Ver</strong>ifiable <strong>com</strong>pletion - <strong>tes</strong>ts must <strong>pas</strong>s</li>
        <li><strong>Sma</strong>ll <strong>tas</strong>k <strong>siz</strong>ing - each <strong>sto</strong>ry in <strong>on</strong>e <strong>con</strong>text <strong>win</strong>dow</li>
      </ol>

      <p><span class="tag">ralph</span> <span class="tag">loop</span> <span class="tag">autonomous</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">1.3 Subagent-Spawning Pattern</h3>
      <p><strong>Sin</strong>gle <strong>par</strong>ent <strong>age</strong>nt <strong>spa</strong>wns <strong>eph</strong>emeral <strong>chi</strong>ld <strong>age</strong>nts for <strong>spe</strong>cific <strong>tas</strong>ks, then <strong>abs</strong>orbs <strong>the</strong>ir <strong>res</strong>ults.</p>

      <div class="ascii-diagram">
┌────────────────────────────────────────────────────┐
│                 PARENT AGENT                        │
│  (Maintains overall context)                        │
├────────────────────────────────────────────────────┤
│  Task(subagent_type="researcher", ...)              │
│         │                                           │
│         ▼                                           │
│  ┌─────────────────────┐                            │
│  │   CHILD AGENT       │  ← Isolated context        │
│  │   (Short-lived)     │  ← Returns result to       │
│  │   Research files... │    parent                  │
│  └─────────────────────┘                            │
│         │                                           │
│         ▼                                           │
│  Result incorporated into parent context            │
└────────────────────────────────────────────────────┘
      </div>

      <h4>Use Cases</h4>
      <ul>
        <li><strong>Exp</strong>loratory <strong>res</strong>earch that <strong>wou</strong>ld <strong>pol</strong>lute <strong>mai</strong>n <strong>con</strong>text</li>
        <li><strong>Par</strong>allel <strong>inv</strong>estigation of <strong>mul</strong>tiple <strong>app</strong>roaches</li>
        <li><strong>Adv</strong>ersarial <strong>val</strong>idation (critic <strong>cha</strong>llenges <strong>des</strong>ign)</li>
        <li><strong>Spe</strong>cialized <strong>ski</strong>ll <strong>del</strong>egation</li>
      </ul>

      <div class="callout callout-danger">
        <div class="callout-title">Anti-Patterns</div>
        <ul>
          <li>Spawning subagents for simple lookups</li>
          <li>Deep nesting (>2 levels)</li>
          <li>Subagents modifying shared state without coordination</li>
        </ul>
      </div>

      <p><span class="tag">subagent</span> <span class="tag">delegation</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">1.4 Cron-Scheduled Autonomous Pattern</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> @mollycantillon (Personal Panopticon)</p>

      <p><strong>Sch</strong>eduled <strong>Cla</strong>ude <strong>Co</strong>de <strong>inv</strong>ocations that <strong>run</strong> at <strong>spe</strong>cified <strong>tim</strong>es <strong>wit</strong>hout <strong>hum</strong>an <strong>int</strong>ervention.</p>

      <pre><code>0 6 * * * cd ~/trades && claude "Morning brief"
0 22 * * * cd ~/metrics && claude "Daily report"</code></pre>

      <h4>Examples</h4>
      <ul>
        <li><strong>Mor</strong>ning <strong>mar</strong>ket <strong>bri</strong>ef <strong>gen</strong>eration</li>
        <li><strong>Nig</strong>htly <strong>ana</strong>lytics <strong>sum</strong>marization</li>
        <li><strong>Sch</strong>eduled <strong>inb</strong>ox <strong>pro</strong>cessing</li>
        <li><strong>Aut</strong>omated <strong>rep</strong>ort <strong>gen</strong>eration</li>
      </ul>

      <p><strong>Prerequisites:</strong> <code>caffeinate -i</code> to keep system awake</p>

      <p><span class="tag">cron</span> <span class="tag">scheduled</span> <span class="tag">autonomous</span></p>
    </div>

    <hr class="section-divider">

    <h2 id="multi-agent"><strong>Mul</strong>ti-Agent <strong>Pat</strong>terns</h2>

    <div class="pattern-box">
      <h3 class="pattern-title">2.1 Hub-and-Spoke Pattern (CC Mirror)</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> @nummanali</p>

      <p><strong>Cen</strong>tral <strong>orc</strong>hestrator <strong>del</strong>egates to <strong>spe</strong>cialized <strong>wor</strong>kers. <strong>Orc</strong>hestrator <strong>NEV</strong>ER <strong>wri</strong>tes <strong>cod</strong>e <strong>dir</strong>ectly - <strong>onl</strong>y <strong>coo</strong>rdinates.</p>

      <div class="ascii-diagram">
         ┌─────────────────┐
         │   ORCHESTRATOR  │
         │   (Opus 4.5)    │
         └────────┬────────┘
                  │
                  │ Task(description=..., run_in_background=True)
                  │
    ┌─────────────┼─────────────┐
    │             │             │
    ▼             ▼             ▼
┌───────┐   ┌───────┐   ┌───────┐
│ Coder │   │ Tester│   │ Docs  │
│(Sonnet)│   │(Sonnet)│   │(Haiku)│
└───────┘   └───────┘   └───────┘
      </div>

      <div class="comparison-table">
        <table>
          <thead>
            <tr>
              <th>Role</th>
              <th>Tools Used</th>
              <th>Tools NEVER Used</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Orchestrator</strong></td>
              <td>Read (1-2 files), TaskCreate/Update/List/Get, AskUserQuestion, Task</td>
              <td>Write, Edit, Bash, Glob, Grep</td>
            </tr>
            <tr>
              <td><strong>Worker</strong></td>
              <td>Read, Write, Edit, Bash, Glob, Grep, WebFetch, WebSearch, LSP</td>
              <td>Task, TaskCreate, sub-spawning</td>
            </tr>
          </tbody>
        </table>
      </div>

      <p><span class="tag">cc-mirror</span> <span class="tag">hub-and-spoke</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">2.2 Factory Pattern (Gas Town)</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> @steve_yegge</p>

      <p><strong>No</strong>t <strong>jus</strong>t <strong>age</strong>nts, but an <strong>age</strong>nt <strong>fac</strong>tory with a <strong>ful</strong>l "<strong>tow</strong>n" of <strong>spe</strong>cialized <strong>rol</strong>es.</p>

      <pre><code>Gas Town (~/.gt)
├── HQ (town-level management)
├── Rigs (project repos)
│   └── Witness (per-rig observer)
├── Workers
│   ├── Mayor (town coordination)
│   ├── Deacon (monitoring/handshakes)
│   ├── Dogs (quality gates)
│   ├── Refinery (task decomposition)
│   ├── Polecat (named persistent workers)
│   └── Crew (ephemeral workers)
└── Overseer (YOU - human with inbox)</code></pre>

      <div class="comparison-table">
        <table>
          <thead>
            <tr>
              <th>Role</th>
              <th>Function</th>
              <th>Persistence</th>
            </tr>
          </thead>
          <tbody>
            <tr><td><strong>Mayor</strong></td><td>Town-level coordination, resource allocation</td><td>Persistent</td></tr>
            <tr><td><strong>Deacon</strong></td><td>Monitoring, health checks, handshakes</td><td>Persistent</td></tr>
            <tr><td><strong>Dogs</strong></td><td>Quality gates, watchdogs, enforcement</td><td>Persistent</td></tr>
            <tr><td><strong>Refinery</strong></td><td>Task decomposition, story breakdown</td><td>On-demand</td></tr>
            <tr><td><strong>Polecat</strong></td><td>Named persistent workers with expertise</td><td>Persistent</td></tr>
            <tr><td><strong>Crew</strong></td><td>Ephemeral workers for one-off tasks</td><td>Ephemeral</td></tr>
            <tr><td><strong>Witness</strong></td><td>Per-rig observer, audit trail</td><td>Persistent</td></tr>
          </tbody>
        </table>
      </div>

      <blockquote>
        "You just make up features, design them, file the implementation plans, and sling work around to your polecats and crew."
      </blockquote>

      <p><span class="tag">gas-town</span> <span class="tag">factory</span> <span class="tag">enterprise</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">2.5 Domain-Isolated Parallel Pattern (Panopticon)</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> @mollycantillon</p>

      <p><strong>Run</strong> 8 <strong>par</strong>allel <strong>Cla</strong>ude <strong>Co</strong>de <strong>ins</strong>tances, each <strong>own</strong>ing a <strong>lif</strong>e <strong>dom</strong>ain, <strong>ach</strong>ieving "<strong>sel</strong>f-<strong>leg</strong>ibility" <strong>thr</strong>ough <strong>com</strong>prehensive <strong>per</strong>sonal <strong>aut</strong>omation.</p>

      <div class="ascii-diagram">
┌─────────────────────────────────────────────────────────────────┐
│                    PERSONAL PANOPTICON                          │
│              (8 Domain-Isolated Agent Instances)                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ~/nox        ← Company/product development                     │
│  ~/metrics    ← Analytics/data processing                       │
│  ~/email      ← Communications automation                       │
│  ~/growth     ← Marketing/acquisition                           │
│  ~/trades     ← Personal finance/trading                        │
│  ~/health     ← Fitness/sleep/wellness                          │
│  ~/writing    ← Content creation                                │
│  ~/personal   ← Life admin                                      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
      </div>

      <div class="callout callout-insight">
        <div class="callout-title">Unique Value</div>
        <p>Frames multi-agent as personal surveillance reversal - you surveilling yourself across all life domains rather than institutions surveilling you.</p>
      </div>

      <p><span class="tag">panopticon</span> <span class="tag">domain-isolation</span> <span class="tag">life-automation</span></p>
    </div>

    <hr class="section-divider">

    <h2 id="orchestrator-worker"><strong>Orc</strong>hestrator/<strong>Wor</strong>ker <strong>Sep</strong>aration</h2>

    <div class="callout callout-warning">
      <div class="callout-title">The Fundamental Dichotomy</div>
      <p>The most critical architectural pattern in multi-agent systems is the <strong>strict separation between orchestration and execution</strong>.</p>
    </div>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Aspect</th>
            <th>Orchestrator</th>
            <th>Worker</th>
          </tr>
        </thead>
        <tbody>
          <tr><td><strong>Primary Function</strong></td><td>Coordinate, delegate, monitor</td><td>Execute, implement, verify</td></tr>
          <tr><td><strong>Code Writing</strong></td><td>NEVER</td><td>ALWAYS</td></tr>
          <tr><td><strong>Tool Usage</strong></td><td>Task*, Read (minimal)</td><td>Read, Write, Edit, Bash, etc.</td></tr>
          <tr><td><strong>Context Scope</strong></td><td>Project-wide strategy</td><td>Task-specific focus</td></tr>
          <tr><td><strong>Spawning</strong></td><td>Spawns workers</td><td>Never spawns sub-agents</td></tr>
          <tr><td><strong>Model Choice</strong></td><td>Opus (complex reasoning)</td><td>Sonnet/Haiku (execution)</td></tr>
        </tbody>
      </table>
    </div>

    <h3>Orchestrator Responsibilities</h3>
    <ol>
      <li><strong>TAS</strong>K <strong>DEC</strong>OMPOSITION - <strong>Bre</strong>ak <strong>fea</strong>tures into <strong>ato</strong>mic, <strong>ver</strong>ifiable <strong>chu</strong>nks</li>
      <li><strong>WOR</strong>KER <strong>DIS</strong>PATCH - <strong>Sel</strong>ect <strong>app</strong>ropriate <strong>wor</strong>ker <strong>typ</strong>e, <strong>cra</strong>ft <strong>pro</strong>mpts</li>
      <li><strong>PRO</strong>GRESS <strong>MON</strong>ITORING - <strong>Tra</strong>ck <strong>com</strong>pletion, <strong>det</strong>ect <strong>blo</strong>cked <strong>tas</strong>ks</li>
      <li><strong>INT</strong>EGRATION - <strong>Syn</strong>thesize <strong>out</strong>puts, <strong>res</strong>olve <strong>con</strong>flicts</li>
      <li><strong>HUM</strong>AN <strong>INT</strong>ERFACE - <strong>Rep</strong>ort <strong>pro</strong>gress, <strong>esc</strong>alate <strong>dec</strong>isions</li>
    </ol>

    <h3>Worker Responsibilities</h3>
    <ol>
      <li><strong>TAS</strong>K <strong>EXE</strong>CUTION - <strong>Imp</strong>lement <strong>exa</strong>ctly what's <strong>spe</strong>cified</li>
      <li><strong>VER</strong>IFICATION - <strong>Run</strong> <strong>tes</strong>ts <strong>bef</strong>ore <strong>rep</strong>orting <strong>com</strong>plete</li>
      <li><strong>REP</strong>ORTING - <strong>Ret</strong>urn <strong>res</strong>ults with <strong>abs</strong>olute <strong>fil</strong>e <strong>pat</strong>hs</li>
      <li><strong>CON</strong>STRAINTS - <strong>NEV</strong>ER <strong>spa</strong>wn <strong>sub</strong>-<strong>age</strong>nts, <strong>NEV</strong>ER <strong>mod</strong>ify <strong>tas</strong>k <strong>def</strong>initions</li>
    </ol>

    <h3>Model Selection by Role</h3>
    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Model</th>
            <th>Best Role</th>
            <th>Rationale</th>
          </tr>
        </thead>
        <tbody>
          <tr><td><strong>Opus 4.5</strong></td><td>Orchestrator</td><td>Complex reasoning, strategy, ambiguity handling</td></tr>
          <tr><td><strong>Sonnet</strong></td><td>Primary Worker</td><td>Good balance of capability and cost</td></tr>
          <tr><td><strong>Haiku</strong></td><td>Errand Runner</td><td>Fast, cheap lookups and simple transforms</td></tr>
        </tbody>
      </table>
    </div>

    <hr class="section-divider">

    <h2 id="swarm"><strong>Swa</strong>rm <strong>Arc</strong>hitectures</h2>

    <div class="pattern-box">
      <h3 class="pattern-title">4.1 The Infinite Orchestra Pattern</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> @0xSero</p>

      <p>A <strong>sel</strong>f-<strong>imp</strong>roving <strong>orc</strong>hestrator that <strong>run</strong>s <strong>24</strong>/7 in <strong>Doc</strong>ker, with <strong>spe</strong>cialized <strong>wor</strong>ker <strong>pro</strong>files and <strong>con</strong>tinuous <strong>sel</strong>f-<strong>imp</strong>rovement <strong>loo</strong>ps.</p>

      <pre><code>Central Orchestrator
  └─ Monitors idle + activity
  └─ Triggers self-improvement
         │
         ▼
Specialized Workers (Profiles)
  ├─ Coder → Implementation
  ├─ Architect → Design decisions
  ├─ Research → Find solutions
  ├─ Vision → Visual analysis
  ├─ Docs → Documentation
  └─ Memory → Persistent context
         │
         ▼
Docker Container
  └─ 24/7 operation
  └─ Resource limits</code></pre>

      <p><span class="tag">infinite-orchestra</span> <span class="tag">self-improving</span> <span class="tag">docker</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">4.2 Container-Isolated Parallel Pattern (AI-Maestro)</h3>

      <p><strong>Run</strong> <strong>Cla</strong>ude <strong>Co</strong>de <strong>ins</strong>tances in <strong>iso</strong>lated <strong>Doc</strong>ker <strong>con</strong>tainers with <strong>sha</strong>red <strong>vol</strong>umes for <strong>com</strong>munication.</p>

      <div class="ascii-diagram">
┌─────────────────────────────────────────┐
│              AI-Maestro                 │
├─────────────────────────────────────────┤
│  ┌─────────┐ ┌─────────┐ ┌─────────┐   │
│  │Container│ │Container│ │Container│   │
│  │ Claude1 │ │ Claude2 │ │ Claude3 │   │
│  │ Branch A│ │ Branch B│ │ Branch C│   │
│  └─────────┘ └─────────┘ └─────────┘   │
│       │           │           │         │
│          Shared Docker Volume           │
│         (file-based messaging)          │
└─────────────────────────────────────────┘
      </div>

      <h4>Benefits</h4>
      <ul>
        <li><strong>No</strong> <strong>bra</strong>nch/<strong>fil</strong>e <strong>con</strong>flicts</li>
        <li><strong>Per</strong>-<strong>con</strong>tainer <strong>fir</strong>ewalls</li>
        <li><strong>Per</strong>sistent <strong>cac</strong>hes</li>
        <li><strong>Rep</strong>roducibility</li>
      </ul>

      <p><span class="tag">docker</span> <span class="tag">container-isolation</span> <span class="tag">parallel</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">4.3 Git Worktree Swarm Pattern</h3>

      <p><strong>Gi</strong>t <strong>wor</strong>ktrees <strong>cre</strong>ate <strong>iso</strong>lated <strong>wor</strong>king <strong>dir</strong>ectories <strong>sha</strong>ring the <strong>sam</strong>e <strong>rep</strong>o, <strong>ena</strong>bling <strong>par</strong>allel <strong>age</strong>nt <strong>wor</strong>k.</p>

      <pre><code>Main repo: ~/project/
├── .git/           # Shared git database
└── src/            # Main working directory

Worktrees: ~/project-worktrees/
├── feature-a/      # Agent 1's isolated directory
├── feature-b/      # Agent 2's isolated directory
└── bugfix-c/       # Agent 3's isolated directory</code></pre>

      <h4>Worktree + Ralph Combination</h4>
      <pre><code># Spawn parallel Ralph loops in worktrees
for feature in auth payments notifications; do
  git worktree add ../wt-$feature $feature-branch
  (cd ../wt-$feature && ./ralph.sh 20) &
done
wait</code></pre>

      <p><span class="tag">worktree</span> <span class="tag">parallel</span> <span class="tag">git</span></p>
    </div>

    <hr class="section-divider">

    <h2 id="hierarchies"><strong>Hie</strong>rarchical <strong>Str</strong>uctures</h2>

    <div class="pattern-box">
      <h3 class="pattern-title">Two-Level Hierarchy (Orchestrator + Workers)</h3>
      <p>The most common production pattern.</p>

      <div class="ascii-diagram">
          ┌─────────────────────┐
          │   ORCHESTRATOR       │
          │   (Strategic Level)  │
          └──────────┬──────────┘
                     │
     ┌───────────────┼───────────────┐
     │               │               │
     ▼               ▼               ▼
┌─────────┐   ┌─────────┐   ┌─────────┐
│ Worker  │   │ Worker  │   │ Worker  │
│   A     │   │   B     │   │   C     │
└─────────┘   └─────────┘   └─────────┘
      </div>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">Three-Level Hierarchy (Gas Town Model)</h3>

      <div class="ascii-diagram">
                ┌─────────────────────┐
                │     OVERSEER        │  ← Human (inbox-based)
                │    (YOU)            │
                └──────────┬──────────┘
                           │
                ┌──────────┴──────────┐
                │       MAYOR         │  ← Town coordination
                └──────────┬──────────┘
                           │
     ┌─────────────────────┼─────────────────────┐
     │                     │                     │
     ▼                     ▼                     ▼
┌─────────┐         ┌─────────┐         ┌─────────┐
│ DEACON  │         │ REFINERY│         │  DOGS   │
│(Monitor)│         │(Decomp) │         │(Quality)│
└────┬────┘         └────┬────┘         └────┬────┘
     │                   │                   │
     ▼                   ▼                   ▼
┌─────────────┐   ┌─────────────┐   ┌─────────────┐
│  POLECATS   │   │    CREW     │   │  WITNESS    │
│ (Persistent)│   │ (Ephemeral) │   │  (Observe)  │
└─────────────┘   └─────────────┘   └─────────────┘
      </div>
    </div>

    <div class="callout callout-danger">
      <div class="callout-title">N-Level Hierarchies (Anti-Pattern Warning)</div>
      <p><strong>Deep nesting (>2 levels) is generally an anti-pattern because:</strong></p>
      <ul>
        <li>Context passing becomes lossy</li>
        <li>Coordination overhead multiplies</li>
        <li>Debugging becomes extremely difficult</li>
        <li>Latency compounds</li>
      </ul>
      <p><strong>Rule:</strong> If you need 3+ levels, reconsider your decomposition strategy.</p>
    </div>

    <hr class="section-divider">

    <h2 id="comparison"><strong>Arc</strong>hitecture <strong>Com</strong>parison <strong>Mat</strong>rix</h2>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Pattern</th>
            <th>Complexity</th>
            <th>Parallelism</th>
            <th>Context Isolation</th>
            <th>Cost</th>
            <th>Use Case</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Interactive Session</strong></td>
            <td>Low</td>
            <td>None</td>
            <td>N/A</td>
            <td>Low</td>
            <td>Exploration, debugging</td>
          </tr>
          <tr>
            <td><strong>Ralph Loop</strong></td>
            <td>Low-Medium</td>
            <td>None (sequential)</td>
            <td>Per-iteration</td>
            <td>Medium</td>
            <td>Overnight feature shipping</td>
          </tr>
          <tr>
            <td><strong>Subagent Spawning</strong></td>
            <td>Medium</td>
            <td>Limited</td>
            <td>Per-subagent</td>
            <td>Medium</td>
            <td>Research, validation</td>
          </tr>
          <tr>
            <td><strong>Hub-and-Spoke</strong></td>
            <td>Medium-High</td>
            <td>High</td>
            <td>Per-worker</td>
            <td>Medium-High</td>
            <td>Team projects</td>
          </tr>
          <tr>
            <td><strong>Factory (Gas Town)</strong></td>
            <td>Very High</td>
            <td>Very High</td>
            <td>Per-worker</td>
            <td>High</td>
            <td>Enterprise scale</td>
          </tr>
          <tr>
            <td><strong>Panopticon</strong></td>
            <td>High</td>
            <td>High</td>
            <td>Per-domain</td>
            <td>High</td>
            <td>Personal automation</td>
          </tr>
          <tr>
            <td><strong>Worktree Swarm</strong></td>
            <td>Medium</td>
            <td>High</td>
            <td>Per-worktree</td>
            <td>Medium</td>
            <td>Parallel features</td>
          </tr>
          <tr>
            <td><strong>Container Swarm</strong></td>
            <td>High</td>
            <td>Very High</td>
            <td>Per-container</td>
            <td>High</td>
            <td>CI/CD integration</td>
          </tr>
        </tbody>
      </table>
    </div>

    <hr class="section-divider">

    <h2 id="iron-law">The <strong>Iro</strong>n <strong>Law</strong> of <strong>Wor</strong>ker <strong>Sep</strong>aration</h2>

    <div class="callout callout-danger">
      <div class="callout-title">THE IRON LAW</div>
      <p><strong>An agent that ORCHESTRATES must NEVER directly EXECUTE.</strong><br>
      <strong>An agent that EXECUTES must NEVER directly ORCHESTRATE.</strong></p>
      <p>Mixing these roles leads to:</p>
      <ul>
        <li>Context pollution</li>
        <li>Scope creep</li>
        <li>Verification bypass</li>
        <li>Uncontrolled recursion</li>
      </ul>
    </div>

    <h3>Why This Matters</h3>

    <h4>Problem 1: Context Pollution</h4>
    <pre><code>BAD:
  Orchestrator: "I'll just quickly write this function..."
               [Context now filled with code, loses project overview]

GOOD:
  Orchestrator: "Spawning Sonnet worker to implement login function..."
               [Context remains strategic, worker handles details]</code></pre>

    <h4>Problem 2: Verification Bypass</h4>
    <pre><code>BAD:
  Same Agent: Write code → "Looks good" → Mark complete
              [No independent verification]

GOOD:
  Worker: Write code → Commit
  Orchestrator: Spawn tester worker → Verify → Then mark complete</code></pre>

    <h4>Problem 3: Uncontrolled Recursion</h4>
    <pre><code>BAD:
  Worker A → spawns Worker B → spawns Worker C → spawns...
  [Exponential context explosion, coordination nightmare]

GOOD:
  Orchestrator → spawns Worker A (flat)
              → spawns Worker B (flat)
              → spawns Worker C (flat)
  [All workers report directly to orchestrator]</code></pre>

    <h3>Enforcement Patterns</h3>

    <h4>1. Explicit Role Declaration in Prompts</h4>
    <pre><code>CONTEXT: You are a WORKER agent, not an orchestrator.
RULES:
- Do NOT spawn sub-agents
- Do NOT call TaskCreate or TaskUpdate
- Complete ONLY the task described below</code></pre>

    <h4>2. Tool Restriction by Role</h4>
    <pre><code>Orchestrator: Task*, Read (minimal), AskUserQuestion
Worker: Read, Write, Edit, Bash, Glob, Grep, WebFetch, WebSearch</code></pre>

    <h4>3. Model-Based Separation</h4>
    <pre><code>Orchestrator: Opus (expensive, careful use)
Worker: Sonnet (balanced cost/capability)
Errands: Haiku (cheap, fast)</code></pre>

    <hr class="section-divider">

    <h2 id="communication"><strong>Com</strong>munication <strong>Pat</strong>terns</h2>

    <p>See <a href="orchestration.html#communication">Orchestration Taxonomy - Communication Patterns</a> for complete details.</p>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Pattern</th>
            <th>Mechanism</th>
            <th>Best For</th>
          </tr>
        </thead>
        <tbody>
          <tr><td><strong>File-Based Handoffs</strong></td><td>JSON files in shared directory</td><td>Async coordination</td></tr>
          <tr><td><strong>Git-Based Handoffs</strong></td><td>progress.txt, prd.json, commits</td><td>Ralph iterations</td></tr>
          <tr><td><strong>Event-Driven</strong></td><td>File-based event bus</td><td>Complex workflows</td></tr>
          <tr><td><strong>MCP Agent Mail</strong></td><td>Email-like interface</td><td>Natural async</td></tr>
        </tbody>
      </table>
    </div>

    <hr class="section-divider">

    <h2 id="isolation"><strong>Iso</strong>lation <strong>Stra</strong>tegies</h2>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Strategy</th>
            <th>Mechanism</th>
            <th>Isolation Level</th>
          </tr>
        </thead>
        <tbody>
          <tr><td><strong>Directory Isolation</strong></td><td>Each agent owns specific directories</td><td>Medium</td></tr>
          <tr><td><strong>Branch Isolation</strong></td><td>Each agent works on own branch</td><td>Medium</td></tr>
          <tr><td><strong>Worktree Isolation</strong></td><td>Full directory with shared history</td><td>High</td></tr>
          <tr><td><strong>Container Isolation</strong></td><td>Docker containers with volumes</td><td>Maximum</td></tr>
          <tr><td><strong>Context Window Isolation</strong></td><td>Subagent inherently isolated</td><td>High</td></tr>
        </tbody>
      </table>
    </div>

    <hr class="section-divider">

    <h2 id="deployment"><strong>Pro</strong>duction <strong>Dep</strong>loyment <strong>Pat</strong>terns</h2>

    <p>See <a href="deployment.html">Deployment Taxonomy</a> for complete infrastructure patterns.</p>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Scale</th>
            <th>Agents</th>
            <th>Requirements</th>
            <th>Example Pattern</th>
          </tr>
        </thead>
        <tbody>
          <tr><td><strong>Solo</strong></td><td>1-3</td><td>Single machine, tmux</td><td>Ralph Loop</td></tr>
          <tr><td><strong>Team</strong></td><td>3-10</td><td>Shared repo, branch discipline</td><td>Hub-and-Spoke</td></tr>
          <tr><td><strong>Department</strong></td><td>10-50</td><td>Task queues, monitoring</td><td>Gas Town</td></tr>
          <tr><td><strong>Enterprise</strong></td><td>50+</td><td>Container orchestration</td><td>Kubernetes + Custom</td></tr>
        </tbody>
      </table>
    </div>

    <hr class="section-divider">

    <h2 id="decision-tree"><strong>Pat</strong>tern <strong>Dec</strong>ision <strong>Tre</strong>e</h2>

    <div class="ascii-diagram">
START: "I need to automate development work"
  │
  ├─ Single task, one session?
  │   └─ YES → Interactive Session
  │
  ├─ Multiple sequential tasks, overnight?
  │   └─ YES → Ralph Loop
  │
  ├─ Need parallel work on different features?
  │   ├─ Same repo? → Git Worktrees
  │   └─ Different domains? → Panopticon
  │
  ├─ Complex decomposition needed?
  │   ├─ 2-5 workers → Hub-and-Spoke (CC Mirror)
  │   └─ 10+ workers → Factory (Gas Town)
  │
  ├─ Need specialized roles?
  │   ├─ 2-3 roles → Subagent Spawning
  │   └─ 7+ roles → Gas Town with full cast
  │
  └─ CI/CD integration?
      └─ YES → Container-Isolated Parallel
    </div>

    <hr class="section-divider">

    <div class="quick-ref">
      <h3 class="quick-ref-title">Quick Reference Commands</h3>
      <pre><code># Ralph Loop
./ralph.sh 25

# Git Worktree
git worktree add ../feature-branch feature-branch

# CC Mirror
npx cc-mirror quick --provider mirror --name mclaude

# Claude HUD
/plugin install claude-hud

# rpai (tmux manager)
cargo install rpai && rpai

# Gas Town
go install github.com/steveyegge/gastown/cmd/gt@latest</code></pre>
    </div>

    <hr class="section-divider">

    <div class="related-pages">
      <h3>Related Taxonomies</h3>
      <ul>
        <li><a href="orchestration.html">Orchestration Patterns</a> - HOW agents are coordinated</li>
        <li><a href="context-memory.html">Context &amp; Memory</a> - Persistence strategies</li>
        <li><a href="workflows.html">Workflows</a> - Task management</li>
        <li><a href="tools.html">Tools</a> - Hooks, MCP, plugins</li>
        <li><a href="deployment.html">Deployment</a> - Infrastructure patterns</li>
        <li><a href="cross-reference.html">Cross-Reference Index</a> - Master index</li>
      </ul>
    </div>

    <nav class="footer-nav">
      <a href="orchestration.html">Prev: Orchestration</a>
      <a href="context-memory.html">Next: Context &amp; Memory</a>
    </nav>

  </div>
  <script src="../../js/copy-code.js"></script>
  <script src="../../js/search.js"></script>
</body>
</html>
