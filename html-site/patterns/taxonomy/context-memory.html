<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta data-pagefind-meta="chapter" content="Patterns">
  <meta data-pagefind-meta="section" content="Taxonomy">
  <title>Context &amp; Memory Pattern Taxonomy | Claude Code Knowledge Base</title>
  <link rel="stylesheet" href="../../css/style.css">
  <link rel="stylesheet" href="../../css/search.css">
</head>
<body>
  <!-- Search Modal -->
  <div class="search-modal" id="searchModal" aria-hidden="true">
    <div class="search-overlay" onclick="closeSearch()"></div>
    <div class="search-content">
      <div class="search-header">
        <div class="search-input-wrapper">
          <span class="search-icon-input">&#128269;</span>
          <input type="text" id="searchInput" placeholder="Search documentation..." autocomplete="off" />
          <kbd class="search-kbd">ESC</kbd>
        </div>
      </div>
      <div class="search-filters">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="ch1">Chapter 1</button>
        <button class="filter-btn" data-filter="ch2">Chapter 2</button>
        <button class="filter-btn" data-filter="ch3">Chapter 3</button>
        <button class="filter-btn" data-filter="ch4">Chapter 4</button>
        <button class="filter-btn" data-filter="ref">Reference</button>
      </div>
      <div class="search-results" id="searchResults">
        <div class="search-empty"><p>Start typing to search... (Press Cmd+K anytime)</p></div>
      </div>
      <div class="search-footer">
        <span>&#8593;&#8595; Navigate</span><span>&#8629; Select</span><span>ESC Close</span>
      </div>
    </div>
  </div>

  <div class="wide-container">
    <!-- Search Trigger Button -->
    <button class="search-trigger" onclick="openSearch()" aria-label="Search" style="float: right; margin-bottom: 1rem;">
      <span class="search-icon">Cmd+K</span>
      <span class="search-text">Search</span>
    </button>

    <nav class="nav-breadcrumb">
      <a href="../../index.html">Home</a>
      <span>/</span>
      <a href="../index.html">Patterns</a>
      <span>/</span>
      <a href="index.html">Taxonomy</a>
      <span>/</span>
      <strong>Context &amp; Memory</strong>
    </nav>

    <div class="you-are-here" style="background: linear-gradient(135deg, #f0ebe3 0%, #fefcf3 100%); border-left: 4px solid #2a7d7d; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
      <h3 style="margin-top: 0; color: #2a7d7d;"><strong>You</strong> Are <strong>He</strong>re</h3>
      <p><strong>LL</strong>Ms have <strong>no</strong> <strong>per</strong>sistent <strong>mem</strong>ory - <strong>eve</strong>ry <strong>new</strong> <strong>con</strong>versation <strong>sta</strong>rts from <strong>zer</strong>o. <strong>Thi</strong>s <strong>tax</strong>onomy <strong>doc</strong>uments the <strong>com</strong>munity's <strong>sol</strong>utions for <strong>per</strong>sistence, <strong>con</strong>text <strong>man</strong>agement, and <strong>cro</strong>ss-<strong>ses</strong>sion <strong>lea</strong>rning.</p>
      <p><strong>Rel</strong>ated:</p>
      <ul style="margin-bottom: 0;">
        <li><a href="orchestration.html">Orchestration</a> - <strong>Loo</strong>p <strong>pat</strong>terns using <strong>mem</strong>ory</li>
        <li><a href="workflows.html">Workflows</a> - <strong>Tas</strong>k <strong>man</strong>agement <strong>int</strong>egrations</li>
      </ul>
    </div>

    <h1><strong>Con</strong>text &amp; <strong>Mem</strong>ory <strong>Pat</strong>tern <strong>Tax</strong>onomy</h1>

    <p class="conversational-lead">A <strong>com</strong>prehensive <strong>cla</strong>ssification of <strong>mem</strong>ory <strong>per</strong>sistence and <strong>con</strong>text <strong>man</strong>agement <strong>pat</strong>terns for <strong>Cla</strong>ude <strong>Co</strong>de. From <strong>sim</strong>ple <strong>fil</strong>e-<strong>bas</strong>ed <strong>app</strong>roaches to <strong>sop</strong>histicated <strong>mul</strong>ti-<strong>age</strong>nt <strong>mem</strong>ory <strong>arc</strong>hitectures.</p>

    <nav class="toc">
      <div class="toc-title">Table of Contents</div>
      <ul>
        <li><a href="#memory-problem">1. The Memory Problem</a></li>
        <li><a href="#file-based">2. File-Based State Patterns</a></li>
        <li><a href="#git-based">3. Git-Based Memory Patterns</a></li>
        <li><a href="#external">4. External Memory Systems</a></li>
        <li><a href="#context-management">5. Context Management Strategies</a></li>
        <li><a href="#multi-agent-memory">6. Multi-Agent Memory Patterns</a></li>
        <li><a href="#memory-hierarchy">7. Memory Hierarchy (4-Tier)</a></li>
        <li><a href="#tradeoffs">8. Tradeoff Matrix</a></li>
        <li><a href="#decision-tree">Decision Tree</a></li>
      </ul>
    </nav>

    <hr class="section-divider">

    <h2 id="memory-problem">The <strong>Mem</strong>ory <strong>Pro</strong>blem</h2>

    <div class="callout callout-warning">
      <div class="callout-title">The Fundamental Challenge</div>
      <p>LLMs face a fundamental limitation: <strong>no persistent memory across sessions</strong>. Every new conversation starts from zero.</p>
    </div>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Challenge</th>
            <th>Impact</th>
          </tr>
        </thead>
        <tbody>
          <tr><td><strong>Context window limits</strong></td><td>Can't process entire codebases at once</td></tr>
          <tr><td><strong>Session boundaries</strong></td><td>Must re-explain project context each time</td></tr>
          <tr><td><strong>Context rot</strong></td><td>Performance degrades as context fills up</td></tr>
          <tr><td><strong>Token waste</strong></td><td>Repetitive information consumes expensive tokens</td></tr>
          <tr><td><strong>Lossy compaction</strong></td><td>Auto-summary loses important details</td></tr>
        </tbody>
      </table>
    </div>

    <p>The patterns in this taxonomy represent the community's solutions to these challenges.</p>

    <hr class="section-divider">

    <h2 id="file-based"><strong>Fil</strong>e-Based <strong>Sta</strong>te <strong>Pat</strong>terns</h2>

    <p>The simplest and most widely-used persistence pattern. Information survives sessions through filesystem reads.</p>

    <div class="pattern-box">
      <h3 class="pattern-title">2.1 CLAUDE.md Knowledge Base</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> Boris Cherny (Creator), official docs</p>

      <p><strong>Mar</strong>kdown <strong>fil</strong>es <strong>aut</strong>omatically <strong>loa</strong>ded into <strong>con</strong>text at <strong>ses</strong>sion <strong>sta</strong>rt.</p>

      <pre><code>project/
â”œâ”€â”€ CLAUDE.md              # Project-level knowledge (git-checked)
â”œâ”€â”€ CLAUDE.local.md        # Personal/secret config (gitignored)
â””â”€â”€ .claude/
    â””â”€â”€ rules/*.md         # Path-specific rules with frontmatter</code></pre>

      <h4>How It Works</h4>
      <ol>
        <li>Claude Code scans for CLAUDE.md files at startup</li>
        <li>Content injected into system prompt</li>
        <li>Path-targeted rules activate based on file context</li>
        <li>Updates persist via git (CLAUDE.md) or locally (CLAUDE.local.md)</li>
      </ol>

      <h4>When to Use</h4>
      <ul>
        <li>Project standards, coding conventions</li>
        <li>Architecture decisions that shouldn't be repeated</li>
        <li>Tool-specific instructions</li>
        <li>Team knowledge that compounds</li>
      </ul>

      <div class="comparison-table">
        <table>
          <thead>
            <tr>
              <th>Pro</th>
              <th>Con</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>Zero setup</td><td>Can bloat over time</td></tr>
            <tr><td>Git-versioned</td><td>Consumes context window</td></tr>
            <tr><td>Team-shareable</td><td>Must manually prune</td></tr>
            <tr><td>Automatic loading</td><td>No semantic search</td></tr>
          </tbody>
        </table>
      </div>

      <p><span class="tag">claude-md</span> <span class="tag">knowledge-base</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">2.2 progress.txt Append-Only Log</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> Ralph Wiggum pattern (Ryan Carson, Matt Pocock)</p>

      <p><strong>App</strong>end-<strong>onl</strong>y <strong>fil</strong>e for <strong>cro</strong>ss-<strong>ite</strong>ration <strong>lea</strong>rning.</p>

      <div class="callout callout-danger">
        <div class="callout-title">Critical Rule</div>
        <p><strong>NEVER UPDATE</strong> - would overwrite history. Always append new entries.</p>
      </div>

      <pre><code># progress.txt - APPEND ONLY - NEVER EDIT

---
Iteration 1 (2026-01-09 10:00):
- Completed: US-001 - Tool skeleton created
- Learned: Use orange (#FF6B35) for visibility on dark backgrounds
- Next: Consider beat playback timing

---
Iteration 2 (2026-01-09 10:15):
- Completed: US-002 - Category mapping
- Issue encountered: Zod schema needed adjustment
- Pattern discovered: Always use .optional() explicitly</code></pre>

      <h4>What to Log</h4>
      <ul>
        <li>What was completed (reference user story ID)</li>
        <li>What was learned (patterns, gotchas, decisions)</li>
        <li>What blocked or failed</li>
        <li>What to do next</li>
      </ul>

      <p><span class="tag">progress-txt</span> <span class="tag">append-only</span> <span class="tag">ralph</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">2.3 prd.json Structured Task State</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> Ralph pattern, Anthropic best practices</p>

      <p><strong>JSO</strong>N <strong>fil</strong>e <strong>tra</strong>cking <strong>tas</strong>k <strong>com</strong>pletion <strong>sta</strong>te.</p>

      <pre><code>{
  "project": "MyProject",
  "branchName": "ralph/feature-name",
  "userStories": [
    {
      "id": "US-001",
      "title": "Create upsertIncome tool skeleton",
      "acceptanceCriteria": [
        "Zod schema matches PRD",
        "npm run typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    }
  ]
}</code></pre>

      <h4>Why JSON Over Markdown</h4>
      <div class="comparison-table">
        <table>
          <thead>
            <tr>
              <th>Aspect</th>
              <th>JSON</th>
              <th>Markdown</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>Parsing</td><td>Deterministic</td><td>Ambiguous</td></tr>
            <tr><td>Updates</td><td>Structured</td><td>Risk of malformed edits</td></tr>
            <tr><td>State tracking</td><td><code>passes: true/false</code></td><td>Manual checkboxes</td></tr>
            <tr><td>LLM reliability</td><td>Higher</td><td>Lower</td></tr>
          </tbody>
        </table>
      </div>

      <p><span class="tag">prd-json</span> <span class="tag">task-state</span> <span class="tag">ralph</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">2.4 Filesystem as Memory (Panopticon)</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> Molly Cantillon</p>

      <p><strong>Eac</strong>h <strong>dom</strong>ain <strong>ins</strong>tance <strong>own</strong>s a <strong>dir</strong>ectory as <strong>per</strong>sistent <strong>sta</strong>te.</p>

      <pre><code>~/nox        # Company/product - agent reads/writes here
~/metrics    # Analytics data - separate agent
~/email      # Communications - separate agent
~/trades     # Finance - overnight briefs written here
~/health     # Wellness - WHOOP integration logs</code></pre>

      <h4>How It Works</h4>
      <ol>
        <li>Each agent is sandboxed to its directory</li>
        <li>Writes data, briefs, analysis to files</li>
        <li>Other agents read via explicit handoffs</li>
        <li>Cron jobs trigger overnight processing</li>
        <li>Morning: human reads synthesized briefs</li>
      </ol>

      <p><span class="tag">panopticon</span> <span class="tag">filesystem</span> <span class="tag">domain-isolation</span></p>
    </div>

    <hr class="section-divider">

    <h2 id="git-based"><strong>Gi</strong>t-Based <strong>Mem</strong>ory <strong>Pat</strong>terns</h2>

    <p>Git provides distributed, versioned memory that Claude can read through its standard tooling.</p>

    <div class="pattern-box">
      <h3 class="pattern-title">3.1 Commit History as Context</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> Ralph pattern, Boris Cherny</p>

      <p><strong>Gi</strong>t <strong>lo</strong>g <strong>pro</strong>vides <strong>nar</strong>rative of <strong>wha</strong>t <strong>cha</strong>nged and <strong>wh</strong>y.</p>

      <pre><code># Agent can reconstruct project evolution
git log --oneline -20
git diff HEAD~5
git show &lt;commit-hash&gt;</code></pre>

      <h4>How It Works</h4>
      <ol>
        <li>Each iteration commits completed work</li>
        <li>Commit messages encode intent/decisions</li>
        <li>Future agents read log for context</li>
        <li>Can bisect to find when bugs were introduced</li>
      </ol>

      <h4>Best Practices</h4>
      <ul>
        <li>Meaningful commit messages (not "WIP")</li>
        <li>One feature per commit</li>
        <li>Reference PRD/story IDs</li>
        <li>Include "why" not just "what"</li>
      </ul>

      <p><span class="tag">git</span> <span class="tag">commit-history</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">3.2 Git Worktrees for Parallel Isolation</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> 0xSero (Infinite Orchestra), multi-agent patterns</p>

      <p><strong>Mul</strong>tiple <strong>wor</strong>king <strong>dir</strong>ectories <strong>sha</strong>ring <strong>sam</strong>e <strong>gi</strong>t <strong>his</strong>tory.</p>

      <pre><code># Main repo
~/project/
  â”œâ”€â”€ .git/           # Shared git database
  â””â”€â”€ src/            # Main working directory

# Worktrees (parallel agent checkouts)
~/project-worktrees/
  â”œâ”€â”€ feature-a/      # Agent 1's isolated directory
  â”œâ”€â”€ feature-b/      # Agent 2's isolated directory
  â””â”€â”€ bugfix-c/       # Agent 3's isolated directory</code></pre>

      <h4>Worktree + Ralph Combination</h4>
      <pre><code># Spawn parallel Ralph loops in worktrees
for feature in auth payments notifications; do
  git worktree add ../wt-$feature $feature-branch
  (cd ../wt-$feature && ./ralph.sh 20) &amp;
done
wait</code></pre>

      <div class="comparison-table">
        <table>
          <thead>
            <tr>
              <th>Pro</th>
              <th>Con</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>True file isolation</td><td>Worktree management overhead</td></tr>
            <tr><td>Parallel safe</td><td>Merge still required</td></tr>
            <tr><td>Shared history</td><td>Disk space per worktree</td></tr>
            <tr><td>Can run on separate machines</td><td>Requires git expertise</td></tr>
          </tbody>
        </table>
      </div>

      <p><span class="tag">worktrees</span> <span class="tag">parallel</span> <span class="tag">isolation</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">3.3 Branch-Based State Isolation</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> Boris Cherny, Ralph pattern</p>

      <p><strong>Eac</strong>h <strong>fea</strong>ture/<strong>tas</strong>k <strong>get</strong>s its <strong>ow</strong>n <strong>bra</strong>nch.</p>

      <pre><code>BRANCH_NAME=$(jq -r '.branchName' prd.json)
git checkout -b $BRANCH_NAME
# ... work happens ...
git commit -m "Completed US-001"</code></pre>

      <h4>How It Works</h4>
      <ol>
        <li>PRD specifies branch name</li>
        <li>Ralph creates/checks out branch</li>
        <li>All work committed to branch</li>
        <li>PR for review when complete</li>
        <li>Main stays clean</li>
      </ol>

      <p><span class="tag">branches</span> <span class="tag">isolation</span></p>
    </div>

    <hr class="section-divider">

    <h2 id="external"><strong>Ext</strong>ernal <strong>Mem</strong>ory <strong>Sys</strong>tems</h2>

    <p>Beyond files and git, specialized tools provide more sophisticated memory capabilities.</p>

    <div class="pattern-box">
      <h3 class="pattern-title">4.1 Claude-Mem Plugin</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> @thedotmack, shared by Lior Alexander</p>

      <p><strong>Aut</strong>omatic <strong>ses</strong>sion <strong>cap</strong>ture, <strong>sem</strong>antic <strong>com</strong>pression, <strong>ret</strong>rieval <strong>inj</strong>ection.</p>

      <div class="ascii-diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Claude Code Session                        â”‚
â”‚  â””â”€ Lifecycle Hooks                         â”‚
â”‚       â””â”€ Capture events                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Worker Service (port 37777)                â”‚
â”‚  â”œâ”€ SQLite DB (raw data)                    â”‚
â”‚  â”œâ”€ Chroma Vector DB (embeddings)           â”‚
â”‚  â””â”€ Claude Agent SDK (compression)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Future Session                             â”‚
â”‚  â””â”€ Auto-inject relevant context            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      </div>

      <h4>Key Stats</h4>
      <ul>
        <li>Up to <strong>95% fewer tokens</strong> per session</li>
        <li>~20x more tool calls before limit</li>
        <li>Local-only storage (SQLite)</li>
      </ul>

      <h4>Usage</h4>
      <pre><code>// Search for relevant context
search(query = "authentication bug", type = "bugfix", limit = 10)

// Fetch full details (always batch!)
get_observations(ids = [123, 456])</code></pre>

      <h4>Privacy</h4>
      <pre><code>&lt;private&gt;
API_KEY=sk-xxx
DATABASE_PASSWORD=secret
&lt;/private&gt;</code></pre>

      <p><span class="tag">claude-mem</span> <span class="tag">semantic</span> <span class="tag">plugin</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">4.2 Database-Backed Memory</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> Infinite Orchestra (Neo4j), claude-mem (SQLite/Chroma)</p>

      <p><strong>Str</strong>uctured <strong>dat</strong>abase for <strong>que</strong>ryable <strong>per</strong>sistent <strong>sta</strong>te.</p>

      <h4>Options</h4>
      <ul>
        <li><strong>SQLite</strong> - claude-mem, ralph marketer</li>
        <li><strong>Chroma</strong> - vector embeddings</li>
        <li><strong>Neo4j</strong> - graph relationships</li>
        <li><strong>PostgreSQL</strong> - structured data</li>
      </ul>

      <h4>When to Use</h4>
      <ul>
        <li>Multi-project memory</li>
        <li>Cross-session learning</li>
        <li>Large-scale context retrieval</li>
        <li>Team-shared memory</li>
      </ul>

      <p><span class="tag">database</span> <span class="tag">sqlite</span> <span class="tag">vector-db</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">4.3 MCP Server State</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> Boris Cherny, Gas Town</p>

      <p><strong>Ext</strong>ernal <strong>too</strong>ls <strong>acc</strong>essed via <strong>Mod</strong>el <strong>Con</strong>text <strong>Pro</strong>tocol.</p>

      <pre><code>Claude Code â†â†’ MCP Server â†â†’ External System
                              (Slack, BigQuery, Sentry, etc.)</code></pre>

      <h4>Boris's MCP Tools</h4>
      <ul>
        <li>Slack MCP</li>
        <li>BigQuery</li>
        <li>Sentry</li>
      </ul>

      <p><span class="tag">mcp</span> <span class="tag">external-systems</span></p>
    </div>

    <hr class="section-divider">

    <h2 id="context-management"><strong>Con</strong>text <strong>Man</strong>agement <strong>Stra</strong>tegies</h2>

    <div class="callout callout-warning">
      <div class="callout-title">The Context Rot Problem</div>
      <blockquote>"Context rot: LLMs get stupider with more tokens"<br>- @mattpocockuk</blockquote>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">5.1 Fresh Context Per Iteration (Ralph's Clean Slate)</h3>

      <p><strong>Eac</strong>h <strong>ite</strong>ration <strong>spa</strong>wns <strong>NE</strong>W <strong>Cla</strong>ude <strong>ins</strong>tance with <strong>N</strong>O <strong>mem</strong>ory.</p>

      <pre><code>while [ $CURRENT_ITERATION -le $MAX_ITERATIONS ]; do
  echo "Starting Ralph iteration $CURRENT_ITERATION"

  # Fresh instance each time
  claude "Review prd.json and progress.txt..."

  CURRENT_ITERATION=$((CURRENT_ITERATION + 1))
done</code></pre>

      <h4>Why This Works</h4>
      <ul>
        <li>Full context capacity each iteration</li>
        <li>No accumulated confusion</li>
        <li>External files provide continuity</li>
        <li>Quality doesn't degrade over time</li>
      </ul>

      <h4>Continuity Comes From</h4>
      <ul>
        <li>Git history</li>
        <li>prd.json</li>
        <li>progress.txt</li>
        <li>The codebase itself</li>
      </ul>

      <p><span class="tag">fresh-context</span> <span class="tag">ralph</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">5.2 Semantic Compression (Claude-Mem)</h3>

      <p><strong>Cla</strong>ude <strong>sum</strong>marizes <strong>ses</strong>sions into <strong>com</strong>pact <strong>rep</strong>resentations.</p>

      <pre><code>Raw transcript: ~5000 tokens
Semantic summary: ~50-100 tokens
Compression ratio: 50-100x</code></pre>

      <h4>What Gets Preserved</h4>
      <ul>
        <li>Decisions made and why</li>
        <li>Patterns discovered</li>
        <li>Blockers encountered</li>
        <li>Code locations touched</li>
      </ul>

      <p><span class="tag">compression</span> <span class="tag">semantic</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">5.3 Subagent Token Isolation</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> @TendiesOfWisdom, Boris Cherny</p>

      <blockquote>"The feedback loop is everything, but put costly tools like browser control in subagents to protect your main context window tokens"</blockquote>

      <div class="ascii-diagram">
Main Agent Context
â”œâ”€â”€ Task coordination
â”œâ”€â”€ High-level decisions
â””â”€â”€ Small token footprint

Subagent 1 (Playwright)
â”œâ”€â”€ Browser automation
â”œâ”€â”€ Screenshot analysis
â””â”€â”€ Isolated context (not in main)

Subagent 2 (Research)
â”œâ”€â”€ WebSearch results
â”œâ”€â”€ Document parsing
â””â”€â”€ Isolated context (not in main)
      </div>

      <h4>Token Savings</h4>
      <ul>
        <li>Playwright output: 1000s of tokens â†’ 50-token summary</li>
        <li>WebSearch results: 5000 tokens â†’ 100-token extraction</li>
        <li>File reading: entire file â†’ relevant snippet</li>
      </ul>

      <p><span class="tag">subagent</span> <span class="tag">token-optimization</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">5.4 Model Stepping</h3>

      <p><strong>Us</strong>e <strong>che</strong>aper <strong>mod</strong>els for <strong>sim</strong>ple <strong>tas</strong>ks, <strong>exp</strong>ensive for <strong>com</strong>plex.</p>

      <pre><code>MODELS=("claude-haiku" "claude-sonnet" "claude-opus")
MODEL_INDEX=0

# Start cheap
claude --model ${MODELS[$MODEL_INDEX]} "$task"

# Escalate if needed
if grep -q "NEED_STRONGER_MODEL" output.txt; then
  MODEL_INDEX=$((MODEL_INDEX + 1))
fi</code></pre>

      <div class="comparison-table">
        <table>
          <thead>
            <tr>
              <th>Model</th>
              <th>Best Task</th>
            </tr>
          </thead>
          <tbody>
            <tr><td><strong>Haiku</strong></td><td>File lookup, simple grep</td></tr>
            <tr><td><strong>Sonnet</strong></td><td>Implementation, testing</td></tr>
            <tr><td><strong>Opus</strong></td><td>Architecture, complex reasoning</td></tr>
          </tbody>
        </table>
      </div>

      <p><span class="tag">model-stepping</span> <span class="tag">cost-optimization</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">5.5 Token Budget Framework</h3>

      <p><strong>Rec</strong>ommended <strong>all</strong>ocation (100K <strong>eff</strong>ective):</p>

      <pre><code>â”œâ”€â”€ 10K System/CLAUDE.md (fixed)
â”œâ”€â”€ 20K Codebase context (per task)
â”œâ”€â”€ 40K Working memory (implementation)
â”œâ”€â”€ 15K Tool outputs (verification)
â””â”€â”€ 15K Buffer (retries, exploration)</code></pre>

      <p><strong>Task must fit in working memory allocation (40K) or split.</strong></p>

      <h4>Signs of Context Overflow</h4>
      <ul>
        <li>Agent repeats earlier statements</li>
        <li>Agent forgets recent changes</li>
        <li>Quality of output degrades</li>
        <li>Agent "hallucinates" non-existent code</li>
        <li>Agent marks incomplete work as done</li>
      </ul>

      <p><span class="tag">token-budget</span></p>
    </div>

    <hr class="section-divider">

    <h2 id="multi-agent-memory"><strong>Mul</strong>ti-Agent <strong>Mem</strong>ory <strong>Pat</strong>terns</h2>

    <div class="pattern-box">
      <h3 class="pattern-title">6.1 Isolated Domain Memory (Panopticon)</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> Molly Cantillon</p>

      <p><strong>Eac</strong>h <strong>age</strong>nt <strong>own</strong>s its <strong>dir</strong>ectory <strong>exc</strong>lusively.</p>

      <pre><code>~/nox/        â†’ Only NOX agent touches
~/trades/     â†’ Only Finance agent touches
~/health/     â†’ Only Health agent touches</code></pre>

      <h4>Properties</h4>
      <ul>
        <li>Zero cross-contamination</li>
        <li>Complete autonomy</li>
        <li>Filesystem as single source of truth</li>
        <li>No coordination protocol needed</li>
      </ul>

      <p><span class="tag">panopticon</span> <span class="tag">domain-isolation</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">6.2 File-Based Handoffs</h3>

      <p><strong>Exp</strong>licit <strong>JSO</strong>N <strong>fil</strong>es for <strong>age</strong>nt-to-<strong>age</strong>nt <strong>con</strong>text <strong>tra</strong>nsfer.</p>

      <pre><code>// ~/shared/handoff-agent1-to-agent2.json
{
  "from": "agent1",
  "to": "agent2",
  "timestamp": "2026-01-09T10:30:00Z",
  "context": {
    "completed": ["API schema", "Database models"],
    "next_steps": ["Implement REST endpoints"],
    "blockers": [],
    "notes": "Using FastAPI, see docs in /api/README.md"
  }
}</code></pre>

      <h4>Protocol</h4>
      <ol>
        <li>Agent 1 writes handoff file on completion</li>
        <li>Agent 2 polls or watches for file</li>
        <li>Agent 2 reads context, deletes/archives file</li>
        <li>Continues work</li>
      </ol>

      <p><span class="tag">handoff</span> <span class="tag">file-based</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">6.3 Task Graph State (CC Mirror)</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> @nummanali</p>

      <p><strong>Bui</strong>lt-in <strong>tas</strong>k <strong>man</strong>agement with <strong>dep</strong>endencies.</p>

      <pre><code>TaskCreate  â†’ Create with subject, description, criteria
TaskList    â†’ Filter: status='open', no owner, not blocked
TaskGet     â†’ Full context: description, comments, dependencies
TaskUpdate  â†’ Claim, comment, resolve, link references</code></pre>

      <h4>Dependency Management</h4>
      <pre><code>addBlocks     â†’ This task blocks another
addBlockedBy  â†’ This task is blocked by another</code></pre>

      <h4>Visual Output</h4>
      <pre><code>â˜‘ #1 Design API architecture
â˜ #2 Create project structure
â˜ #3 Implement data models
ğŸŸ  #4 Implement REST API endpoints (blocked by #3)
ğŸŸ  #5 Write integration tests (blocked by #4)</code></pre>

      <p><span class="tag">cc-mirror</span> <span class="tag">task-graph</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">6.4 Gas Town Memory Layer (Beads)</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> Steve Yegge</p>

      <p><strong>Gi</strong>t-<strong>bac</strong>ked <strong>uni</strong>versal <strong>dat</strong>a <strong>pla</strong>ne.</p>

      <pre><code>Gas Town (~/.gt)
â”œâ”€â”€ HQ (town-level management)
â”œâ”€â”€ Rigs (project repos)
â”‚   â””â”€â”€ Witness (per-rig observer)
â””â”€â”€ Beads (git-backed data plane)</code></pre>

      <h4>Features</h4>
      <ul>
        <li>~225K lines of Go</li>
        <li>Universal context management</li>
        <li>Git-backed for versioning</li>
        <li>MCP Agent Mail for inter-agent communication</li>
      </ul>

      <p><span class="tag">gas-town</span> <span class="tag">beads</span> <span class="tag">enterprise</span></p>
    </div>

    <hr class="section-divider">

    <h2 id="memory-hierarchy"><strong>Fou</strong>r-Tier <strong>Cla</strong>ude <strong>Co</strong>de <strong>Mem</strong>ory <strong>Hie</strong>rarchy</h2>

    <div class="ascii-diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 1: Enterprise Policy                                      â”‚
â”‚ /Library/Application Support/ClaudeCode/CLAUDE.md               â”‚
â”‚ Organization-wide security policies, compliance requirements     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Layer 2: Project Memory                                          â”‚
â”‚ ./CLAUDE.md or ./.claude/CLAUDE.md                               â”‚
â”‚ Architecture decisions, coding standards, team workflows         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Layer 3: Modular Rules                                           â”‚
â”‚ ./.claude/rules/*.md                                             â”‚
â”‚ Path-specific rules with frontmatter targeting                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Layer 4: Personal + Local                                        â”‚
â”‚ ~/.claude/CLAUDE.md (user global)                                â”‚
â”‚ ./CLAUDE.local.md (project local, gitignored)                    â”‚
â”‚ Agent-specific context, sandbox URLs, test credentials           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    </div>

    <p><strong>Loading order:</strong> Enterprise â†’ Project â†’ Modular Rules â†’ Personal â†’ Local</p>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Layer</th>
            <th>What Goes Here</th>
          </tr>
        </thead>
        <tbody>
          <tr><td><strong>Enterprise</strong></td><td>Security policies, compliance, banned patterns</td></tr>
          <tr><td><strong>Project</strong></td><td>Architecture, stack decisions, team conventions</td></tr>
          <tr><td><strong>Modular Rules</strong></td><td>Path-specific patterns (API rules, test patterns)</td></tr>
          <tr><td><strong>Personal</strong></td><td>Global preferences, aliases, style</td></tr>
          <tr><td><strong>Local</strong></td><td>Secrets, sandbox URLs, personal experiments</td></tr>
        </tbody>
      </table>
    </div>

    <hr class="section-divider">

    <h2 id="tradeoffs"><strong>Tra</strong>deoff <strong>Mat</strong>rices</h2>

    <h3>Memory Pattern Selection</h3>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Pattern</th>
            <th>Setup</th>
            <th>Token Cost</th>
            <th>Persistence</th>
            <th>Queryability</th>
            <th>Multi-Agent</th>
            <th>Best For</th>
          </tr>
        </thead>
        <tbody>
          <tr><td><strong>None</strong></td><td>Zero</td><td>Low</td><td>None</td><td>N/A</td><td>No</td><td>One-off tasks</td></tr>
          <tr><td><strong>CLAUDE.md</strong></td><td>5 min</td><td>Medium</td><td>Session</td><td>No</td><td>Via git</td><td>Standards</td></tr>
          <tr><td><strong>progress.txt</strong></td><td>10 min</td><td>Low</td><td>Permanent</td><td>Text search</td><td>Manual</td><td>Learnings</td></tr>
          <tr><td><strong>prd.json</strong></td><td>30 min</td><td>Very Low</td><td>Permanent</td><td>jq queries</td><td>Via git</td><td>Task state</td></tr>
          <tr><td><strong>Git history</strong></td><td>Built-in</td><td>Very Low</td><td>Permanent</td><td>git log/diff</td><td>Natural</td><td>Code changes</td></tr>
          <tr><td><strong>Worktrees</strong></td><td>15 min</td><td>Very Low</td><td>Permanent</td><td>Per-worktree</td><td>Yes</td><td>Parallel work</td></tr>
          <tr><td><strong>Claude-Mem</strong></td><td>30 min</td><td>Very Low</td><td>Permanent</td><td>Semantic</td><td>Shared DB</td><td>Long projects</td></tr>
          <tr><td><strong>Panopticon</strong></td><td>Hours</td><td>Low</td><td>Permanent</td><td>Per-domain</td><td>Isolated</td><td>Life OS</td></tr>
          <tr><td><strong>Gas Town</strong></td><td>Days</td><td>High</td><td>Permanent</td><td>Beads</td><td>Full support</td><td>Scale</td></tr>
        </tbody>
      </table>
    </div>

    <h3>Context Strategy Selection</h3>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Strategy</th>
            <th>When Context Degrades</th>
            <th>Token Efficiency</th>
            <th>Quality</th>
            <th>Complexity</th>
          </tr>
        </thead>
        <tbody>
          <tr><td><strong>Fresh each iteration</strong></td><td>Never (by design)</td><td>Medium</td><td>Consistent</td><td>Low</td></tr>
          <tr><td><strong>Auto-handoff (90%)</strong></td><td>At threshold</td><td>Medium</td><td>Good</td><td>Low</td></tr>
          <tr><td><strong>Semantic compression</strong></td><td>Gradual</td><td>Very High</td><td>Variable</td><td>Medium</td></tr>
          <tr><td><strong>Subagent isolation</strong></td><td>Never (isolated)</td><td>Very High</td><td>High</td><td>Medium</td></tr>
          <tr><td><strong>Manual pruning</strong></td><td>When pruned</td><td>Medium</td><td>Depends</td><td>Low</td></tr>
        </tbody>
      </table>
    </div>

    <h3>Multi-Agent Memory Coordination</h3>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Approach</th>
            <th>Isolation</th>
            <th>Coordination</th>
            <th>Conflict Risk</th>
            <th>Complexity</th>
          </tr>
        </thead>
        <tbody>
          <tr><td><strong>Separate directories</strong></td><td>Complete</td><td>Manual handoffs</td><td>None</td><td>Low</td></tr>
          <tr><td><strong>Git worktrees</strong></td><td>File-level</td><td>Git merge</td><td>At merge</td><td>Medium</td></tr>
          <tr><td><strong>Shared state dir</strong></td><td>Partial</td><td>Protocol needed</td><td>Medium</td><td>Medium</td></tr>
          <tr><td><strong>Task graph (CC Mirror)</strong></td><td>Logical</td><td>Built-in</td><td>Low</td><td>Medium</td></tr>
          <tr><td><strong>Beads (Gas Town)</strong></td><td>Complete</td><td>Universal</td><td>Low</td><td>High</td></tr>
        </tbody>
      </table>
    </div>

    <hr class="section-divider">

    <h2 id="decision-tree"><strong>Dec</strong>ision <strong>Tre</strong>e</h2>

    <div class="ascii-diagram">
START: Do I need persistent memory?
â”‚
â”œâ”€ NO â†’ Use default Claude Code
â”‚
â””â”€ YES â†’ What kind of persistence?
         â”‚
         â”œâ”€ Project knowledge â†’ CLAUDE.md
         â”‚   â””â”€ Team shared? â†’ Git check it
         â”‚   â””â”€ Personal? â†’ CLAUDE.local.md
         â”‚
         â”œâ”€ Task state â†’ prd.json
         â”‚   â””â”€ Simple tasks? â†’ Flat JSON
         â”‚   â””â”€ Complex dependencies? â†’ CC Mirror TaskCreate
         â”‚
         â”œâ”€ Learnings across iterations â†’ progress.txt
         â”‚   â””â”€ Growing too large? â†’ Periodic archiving
         â”‚
         â”œâ”€ Code history â†’ Git (built-in)
         â”‚   â””â”€ Parallel work? â†’ Worktrees
         â”‚
         â”œâ”€ Semantic memory â†’ Claude-Mem plugin
         â”‚
         â””â”€ Multi-agent?
             â”‚
             â”œâ”€ Isolated domains â†’ Panopticon (directories)
             â”‚
             â”œâ”€ Coordinated tasks â†’ CC Mirror
             â”‚
             â””â”€ Factory scale â†’ Gas Town (Stage 7+)
    </div>

    <hr class="section-divider">

    <div class="quick-ref">
      <h3 class="quick-ref-title">Quick Reference Commands</h3>
      <pre><code># Create CLAUDE.md
echo "# Project Standards" > CLAUDE.md

# Initialize progress.txt
echo "# Progress - APPEND ONLY" > progress.txt

# Create prd.json
echo '{"userStories": []}' > prd.json

# Create worktree for parallel agent
git worktree add ../wt-feature feature-branch

# Check worktree list
git worktree list

# Clean up worktree
git worktree remove ../wt-feature

# Install Claude-Mem
/plugin marketplace add thedotmack/claude-mem
/plugin install claude-mem</code></pre>
    </div>

    <hr class="section-divider">

    <div class="related-pages">
      <h3>Related Taxonomies</h3>
      <ul>
        <li><a href="orchestration.html">Orchestration Patterns</a> - Loop patterns using memory</li>
        <li><a href="architectures.html">Agent Architectures</a> - Structural patterns</li>
        <li><a href="workflows.html">Workflows</a> - Task management</li>
        <li><a href="tools.html">Tools</a> - Hooks, MCP, plugins</li>
        <li><a href="cross-reference.html">Cross-Reference Index</a> - Master index</li>
      </ul>
    </div>

    <nav class="footer-nav">
      <a href="architectures.html">Prev: Architectures</a>
      <a href="workflows.html">Next: Workflows</a>
    </nav>

  </div>
  <script src="../../js/copy-code.js"></script>
  <script src="../../js/search.js"></script>
</body>
</html>
