<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Deployment Architecture Taxonomy | Claude Code Knowledge Base</title>
  <link rel="stylesheet" href="../../css/style.css">
</head>
<body>
  <div class="wide-container">

    <nav class="nav-breadcrumb">
      <a href="../../index.html">Home</a>
      <span>/</span>
      <a href="../index.html">Patterns</a>
      <span>/</span>
      <a href="index.html">Taxonomy</a>
      <span>/</span>
      Deployment
    </nav>

    <div class="you-are-here" style="background: linear-gradient(135deg, #f0ebe3 0%, #fefcf3 100%); border-left: 4px solid #2a7d7d; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
      <h3 style="margin-top: 0; color: #2a7d7d;"><strong>You</strong> Are <strong>He</strong>re</h3>
      <p><strong>Thi</strong>s <strong>tax</strong>onomy <strong>cla</strong>ssifies <strong>inf</strong>rastructure <strong>pat</strong>terns, <strong>san</strong>dboxing <strong>str</strong>ategies, and <strong>exe</strong>cution <strong>env</strong>ironments for <strong>Cla</strong>ude <strong>Co</strong>de. From <strong>loc</strong>al <strong>CLI</strong> to <strong>pro</strong>duction <strong>clo</strong>ud <strong>dep</strong>loyment.</p>
      <p><strong>Rel</strong>ated:</p>
      <ul style="margin-bottom: 0;">
        <li><a href="tools.html">Tools</a> - <strong>Too</strong>l <strong>int</strong>egrations</li>
        <li><a href="orchestration.html">Orchestration</a> - <strong>Pat</strong>terns using <strong>inf</strong>rastructure</li>
      </ul>
    </div>

    <h1><strong>Dep</strong>loyment <strong>Arc</strong>hitecture <strong>Tax</strong>onomy</h1>

    <p class="conversational-lead"><strong>Com</strong>prehensive <strong>cla</strong>ssification of <strong>inf</strong>rastructure <strong>pat</strong>terns, <strong>san</strong>dboxing <strong>str</strong>ategies, and <strong>exe</strong>cution <strong>env</strong>ironments for <strong>Cla</strong>ude <strong>Co</strong>de.</p>

    <nav class="toc">
      <div class="toc-title">Table of Contents</div>
      <ul>
        <li><a href="#overview">1. Deployment Spectrum</a></li>
        <li><a href="#local">2. Local Development</a></li>
        <li><a href="#remote">3. Remote Terminal Access</a></li>
        <li><a href="#container">4. Containerized Execution</a></li>
        <li><a href="#serverless">5. Serverless and Cloud</a></li>
        <li><a href="#browser">6. Browser Automation Infrastructure</a></li>
        <li><a href="#multi-agent-infra">7. Multi-Agent Orchestration Infrastructure</a></li>
        <li><a href="#mobile">8. Mobile and Cross-Device</a></li>
        <li><a href="#sandboxing">9. Sandboxing Strategies</a></li>
        <li><a href="#security">10. Security Architecture</a></li>
        <li><a href="#cost">11. Cost Analysis</a></li>
        <li><a href="#decision-tree">Decision Tree</a></li>
      </ul>
    </nav>

    <hr class="section-divider">

    <h2 id="overview"><strong>Dep</strong>loyment <strong>Spe</strong>ctrum</h2>

    <div class="ascii-diagram">
                    LOCAL <-------------------------------------------> CLOUD
                      |                                                   |
    Direct CLI --------> VM/SSH ----------> Container ----------> Serverless
         |                  |                   |                    |
    Bare metal         Persistent          Isolated            Ephemeral
    Full access        Terminal            Sandboxed           Managed
    No isolation       Manual              Reproducible        Scalable
    </div>

    <h3>Key Dimensions</h3>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Dimension</th>
            <th>Spectrum</th>
          </tr>
        </thead>
        <tbody>
          <tr><td><strong>Isolation</strong></td><td>None -> Process -> Container -> VM -> Cloud Sandbox</td></tr>
          <tr><td><strong>Persistence</strong></td><td>Ephemeral -> Session -> Persistent -> Durable</td></tr>
          <tr><td><strong>Scalability</strong></td><td>Single Instance -> Parallel -> Auto-Scaling</td></tr>
          <tr><td><strong>Network</strong></td><td>Full Access -> Allowlist -> API-Only -> Isolated</td></tr>
          <tr><td><strong>Security</strong></td><td>Permissive -> Gated -> Sandboxed -> Zero-Trust</td></tr>
        </tbody>
      </table>
    </div>

    <hr class="section-divider">

    <h2 id="local"><strong>Loc</strong>al <strong>Dev</strong>elopment</h2>

    <div class="pattern-box">
      <h3 class="pattern-title">Direct Claude Code CLI</h3>
      <p>The simplest deployment pattern - Claude Code running directly on your local machine.</p>

      <div class="ascii-diagram">
+-------------------------------------------------------------+
|  Local Machine                                               |
|  +-------------------------------------------------------------+
|  |  Terminal                                                 |
|  |  └── claude (CLI)                                        |
|  |       ├── Tools: Read, Write, Edit, Bash                |
|  |       ├── File System: Full access                       |
|  |       └── Network: Full access (API calls)               |
|  +-------------------------------------------------------------+
+-------------------------------------------------------------+
      </div>

      <h4>Characteristics</h4>
      <ul>
        <li>Zero setup overhead</li>
        <li>Full file system access</li>
        <li>Interactive permission prompts</li>
        <li>Session-based context</li>
        <li>Single instance typically</li>
      </ul>

      <h4>Commands</h4>
      <pre><code># Basic usage
claude

# With specific model
claude --model claude-opus-4-5-20251101

# Continue previous session
claude --continue

# Headless/scripted mode
claude --print "Review this file" < file.ts</code></pre>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">tmux-Based Local Sessions</h3>
      <p>Persistent terminal sessions for long-running work.</p>

      <div class="ascii-diagram">
+-------------------------------------------------------------+
|  Local Machine                                               |
|  +-------------------------------------------------------------+
|  |  tmux Session ("work")                                   |
|  |  ├── Window 1: Claude Code (main)                       |
|  |  ├── Window 2: Claude Code (feature-1)                  |
|  |  ├── Window 3: Claude Code (feature-2)                  |
|  |  └── Window 4: Monitoring (htop, logs)                  |
|  +-------------------------------------------------------------+
+-------------------------------------------------------------+
      </div>

      <h4>tmux Configuration</h4>
      <pre><code># ~/.tmux.conf
set -g mouse on
set -g history-limit 100000
set -g base-index 1

# Auto-save sessions
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @continuum-restore 'on'
set -g @resurrect-processes 'claude node python'</code></pre>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">Git Worktrees for Parallel Isolation</h3>
      <p>Branch-based parallelization without conflicts.</p>

      <pre><code>Main Repo (~/project/)
├── .git/                  # Shared git database
└── src/                   # Working directory

Worktrees (~/worktrees/)
├── feature-auth/          # Agent 1: Auth feature
│   └── src/
├── feature-payments/      # Agent 2: Payments feature
│   └── src/
└── bugfix-login/          # Agent 3: Bug fix
    └── src/</code></pre>

      <h4>Setup Script</h4>
      <pre><code>#!/bin/bash
BRANCH=$1
TASK=$2
WORKTREE_DIR="../worktrees/$BRANCH"

# Create worktree
git worktree add "$WORKTREE_DIR" -b "$BRANCH" 2>/dev/null || \
git worktree add "$WORKTREE_DIR" "$BRANCH"

# Launch Claude in worktree
cd "$WORKTREE_DIR"
tmux new-window -n "$BRANCH" "claude '$TASK'"</code></pre>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">Ralph Loop Local Execution</h3>
      <p>Autonomous iteration with fresh context per cycle.</p>

      <pre><code>#!/bin/bash
MAX_ITERATIONS=${1:-25}

for (( i=1; i<=MAX_ITERATIONS; i++ )); do
  echo "=== Iteration $i / $MAX_ITERATIONS ==="

  claude "Review plans/prd.json and plans/progress.txt.
    Pick ONE feature with passes: false.
    Implement it. Run tests.
    If passing, mark passes: true and commit.
    Append learnings to progress.txt.
    If ALL complete, output: <promise>COMPLETE</promise>" | tee output.txt

  if grep -q "<promise>COMPLETE</promise>" output.txt; then
    echo "=== PRD Complete! ==="
    break
  fi
done</code></pre>

      <p><span class="tag">ralph</span> <span class="tag">overnight</span> <span class="tag">autonomous</span></p>
    </div>

    <hr class="section-divider">

    <h2 id="remote"><strong>Rem</strong>ote <strong>Ter</strong>minal <strong>Acc</strong>ess</h2>

    <div class="pattern-box">
      <h3 class="pattern-title">Cloud VM with SSH/mosh</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> @dabit3</p>

      <div class="ascii-diagram">
+-------------------------------------------------------------+
|  CLIENT DEVICES                                              |
|  ├── Laptop                                                  |
|  ├── Phone ──────────────────────┐                          |
|  └── Tablet                       │ SSH/mosh                |
+-----------------------------------┘ (Tailscale VPN)         |
                                     |
+-------------------------------------------------------------+
|  CLOUD VM (Hetzner/Vultr/AWS)                               |
|  +-------------------------------------------------------------+
|  │  Security                                                 |
|  │  ├── No public SSH (Tailscale only)                      |
|  │  ├── fail2ban + nftables                                 |
|  │  └── Non-root user                                        |
|  ├─────────────────────────────────────────────────────────|
|  │  tmux Session                                            |
|  │  ├── Window 1: Claude Code (main)                        |
|  │  └── Window 2-6: Parallel agents (worktrees)             |
|  +-------------------------------------------------------------+
+-------------------------------------------------------------+
      </div>

      <h4>Provider Comparison</h4>
      <div class="comparison-table">
        <table>
          <thead>
            <tr>
              <th>Provider</th>
              <th>Tier</th>
              <th>Cost/Month</th>
              <th>Best For</th>
            </tr>
          </thead>
          <tbody>
            <tr><td><strong>Hetzner</strong></td><td>CX31 (4 vCPU, 8GB)</td><td>$13</td><td>Best value (EU)</td></tr>
            <tr><td><strong>Vultr</strong></td><td>vhf-8c-32gb</td><td>~$210 (or $7/day)</td><td>US, hourly billing</td></tr>
            <tr><td><strong>DigitalOcean</strong></td><td>s-4vcpu-8gb</td><td>$48</td><td>Simple UX</td></tr>
            <tr><td><strong>AWS EC2</strong></td><td>t3.xlarge</td><td>$120</td><td>Enterprise</td></tr>
            <tr><td><strong>Oracle Cloud</strong></td><td>Always Free</td><td>$0</td><td>Budget option</td></tr>
          </tbody>
        </table>
      </div>

      <h4>Setup Pattern (Hetzner)</h4>
      <pre><code># 1. Create VM
hcloud server create --name claude-dev --type cx31 --image ubuntu-24.04

# 2. Install Tailscale
curl -fsSL https://tailscale.com/install.sh | sh
tailscale up

# 3. Harden SSH
ufw allow from 100.64.0.0/10  # Tailscale CIDR only
ufw enable

# 4. Install Claude Code
npm install -g @anthropic-ai/claude-code

# 5. Configure tmux auto-attach
echo 'if [[ -z "$TMUX" ]]; then tmux attach -t main 2>/dev/null || tmux new -s main; fi' >> ~/.zshrc</code></pre>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">Home Mac/PC as Always-On Server</h3>
      <p>Zero-cost cloud alternative using home hardware.</p>

      <h4>Requirements</h4>
      <ul>
        <li>Mac/PC that can stay powered on</li>
        <li>Reliable home internet</li>
        <li>Tailscale installed</li>
        <li>Lid open (laptops) or external display (Mac Mini)</li>
      </ul>

      <h4>Keep-Alive Configuration</h4>
      <pre><code># Prevent Mac sleep
caffeinate -i &

# Or via pmset
sudo pmset -a sleep 0 disksleep 0</code></pre>

      <p><strong>Cost:</strong> $0/month (electricity only)</p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">Codespaces and Gitpod</h3>
      <p>Cloud-hosted development environments with browser/SSH access.</p>

      <h4>Setup (.devcontainer/devcontainer.json)</h4>
      <pre><code>{
  "name": "Claude Code Dev",
  "image": "mcr.microsoft.com/devcontainers/base:ubuntu",
  "postCreateCommand": "npm install -g @anthropic-ai/claude-code",
  "customizations": {
    "vscode": {
      "settings": {
        "terminal.integrated.defaultProfile.linux": "zsh"
      }
    }
  },
  "secrets": {
    "ANTHROPIC_API_KEY": {
      "description": "Anthropic API key for Claude Code"
    }
  }
}</code></pre>

      <div class="comparison-table">
        <table>
          <thead>
            <tr>
              <th>Feature</th>
              <th>Codespaces</th>
              <th>Gitpod</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>Free Tier</td><td>60 hrs/month</td><td>50 hrs/month</td></tr>
            <tr><td>Self-Host</td><td>No</td><td>Yes</td></tr>
            <tr><td>GitHub</td><td>Native</td><td>Extension</td></tr>
            <tr><td>GitLab</td><td>No</td><td>Yes</td></tr>
            <tr><td>SSH Access</td><td>Yes</td><td>Yes</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <hr class="section-divider">

    <h2 id="container"><strong>Con</strong>tainerized <strong>Exe</strong>cution</h2>

    <div class="pattern-box">
      <h3 class="pattern-title">Basic Docker Setup</h3>

      <h4>Dockerfile</h4>
      <pre><code>FROM node:20-alpine

# Security hardening
RUN apk add --no-cache dumb-init git
RUN npm install -g @anthropic-ai/claude-code

# Non-root user
RUN addgroup -g 1000 claude && adduser -u 1000 -G claude -D claude
USER claude

WORKDIR /workspace
ENTRYPOINT ["/usr/bin/dumb-init", "--"]
CMD ["claude"]</code></pre>

      <h4>docker-compose.yml</h4>
      <pre><code>version: '3.8'
services:
  claude:
    build: .
    volumes:
      - ./project:/workspace
      - claude-config:/home/claude/.claude
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    read_only: true
    tmpfs:
      - /tmp:size=100M,mode=1777

volumes:
  claude-config:</code></pre>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">Secure Docker with Network Isolation</h3>

      <pre><code>version: '3.8'

services:
  claude:
    build:
      context: .
      dockerfile: Dockerfile.secure
    networks:
      - internal
    volumes:
      - project:/workspace:ro
      - output:/output:rw
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - HTTP_PROXY=http://proxy:8080
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 4G
          pids: 100
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    read_only: true

  proxy:
    image: nginx:alpine
    networks:
      - internal
      - external
    volumes:
      - ./nginx-egress.conf:/etc/nginx/nginx.conf:ro

networks:
  internal:
    internal: true  # No internet
  external:
    driver: bridge

volumes:
  project:
  output:</code></pre>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">Multi-Container Parallel Agents (AI-Maestro)</h3>

      <div class="ascii-diagram">
+-------------------------------------------------------------+
|                      AI-Maestro Orchestrator                 |
|  +-------------------------------------------------------------+
|  |  Agent Pool                                               |
|  |  +-------------+ +-------------+ +-------------+         |
|  |  | Container 1 | | Container 2 | | Container 3 |         |
|  |  | Claude      | | Claude      | | Claude      |         |
|  |  | Branch: A   | | Branch: B   | | Branch: C   |         |
|  |  +-------------+ +-------------+ +-------------+         |
|  |        |               |               |                  |
|  |        +---------------+---------------+                  |
|  |                        |                                  |
|  |            +-----------------------+                     |
|  |            |  Shared Docker Volume |                     |
|  |            |  (file-based messaging)|                     |
|  |            +-----------------------+                     |
|  +-------------------------------------------------------------+
+-------------------------------------------------------------+
      </div>

      <p><span class="tag">ai-maestro</span> <span class="tag">parallel</span> <span class="tag">docker</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">Infinite Orchestra (Self-Improving Docker)</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> @0xSero | <strong>Repo:</strong> github.com/0xSero/orchestra</p>

      <p>Self-improving orchestrator running 24/7 in Docker with specialized worker profiles.</p>

      <pre><code>Central Orchestrator
  └─ Monitors idle + activity
  └─ Triggers self-improvement
         │
         ▼
Specialized Workers (Profiles)
  ├─ vision:     Visual analysis
  ├─ docs:       Documentation research
  ├─ research:   Deep investigation
  ├─ coder:      Implementation
  ├─ memory:     Context persistence
  └─ architect:  System design</code></pre>

      <blockquote>"Set goal to 'improve itself' and it added Docker containerization to prevent destroying the host machine."</blockquote>
    </div>

    <hr class="section-divider">

    <h2 id="serverless"><strong>Ser</strong>verless and <strong>Clo</strong>ud</h2>

    <div class="pattern-box">
      <h3 class="pattern-title">Cloudflare Workers + Claude Agent SDK</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> @johnturner | <strong>Starter:</strong> github.com/craigsdennis/claude-in-the-box</p>

      <div class="ascii-diagram">
+-------------------------------------------------------------+
|  Cloudflare Edge Network                                     |
|  +-------------------------------------------------------------+
|  |  Worker (Stateless Compute)                               |
|  |  ├── Claude Agent SDK                                     |
|  |  ├── Skills (mini-apps)                                   |
|  |  ├── Tool orchestration                                   |
|  |  └── WebSocket for real-time                              |
|  ├─────────────────────────────────────────────────────────|
|  |  Durable Object (Stateful)                                |
|  |  ├── Session persistence                                  |
|  |  ├── Transcript storage                                   |
|  |  └── Resume on sandbox death                              |
|  ├─────────────────────────────────────────────────────────|
|  |  Sandbox (Code Execution)                                 |
|  |  ├── Tier: standard-2 (required for >10s)                |
|  |  ├── Dynamic code writing                                 |
|  |  └── Safe execution environment                           |
|  +-------------------------------------------------------------+
+-------------------------------------------------------------+
      </div>

      <h4>Key Requirements</h4>
      <ul>
        <li><strong>Sandbox Tier:</strong> At least "standard-2" for responses >10 seconds</li>
        <li><strong>Session Persistence:</strong> Save transcript in Durable Object after each method</li>
        <li><strong>Skills:</strong> Package Claude Code skills for production use</li>
      </ul>

      <h4>Workflow</h4>
      <ol>
        <li><strong>Prototype</strong> skills locally with Claude Code desktop</li>
        <li><strong>Test</strong> fast on local machine</li>
        <li><strong>Deploy</strong> unchanged to Cloudflare sandbox</li>
        <li><strong>Run</strong> via Agent SDK in production</li>
      </ol>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">System: Mac as API via Cloudflare</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> @burcs | <strong>Repo:</strong> github.com/ygwyg/system</p>

      <div class="ascii-diagram">
+-------------------------------------------------------------+
|  BRAIN (Cloudflare Worker)                                   |
|  ├── Claude AI for NLP                                       |
|  ├── State in Durable Objects                                |
|  ├── Scheduling (cron/natural language)                      |
|  └── Tool orchestration                                       |
+--------------------------------+----------------------------+
                                 |
                    Cloudflare Tunnel (secure, no ports)
                                 |
                                 ▼
+-------------------------------------------------------------+
|  BODY (Local Mac Bridge)                                     |
|  ├── Express server                                          |
|  ├── AppleScript execution                                   |
|  ├── Safe shell commands (allowlist)                         |
|  └── Raycast extension deep links                            |
+-------------------------------------------------------------+
      </div>

      <h4>Capabilities</h4>
      <ul>
        <li>Play music (Apple Music/Spotify)</li>
        <li>Send texts (iMessages)</li>
        <li>Create Linear issues</li>
        <li>Run Shortcuts</li>
        <li>Execute AppleScript</li>
        <li>Trigger Raycast extensions</li>
        <li>Schedule recurring tasks</li>
      </ul>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">E2B Sandboxed Execution</h3>

      <p>Cloud-based sandboxes for agent code execution.</p>

      <pre><code>from e2b import Sandbox

with Sandbox() as sandbox:
    result = sandbox.run_code(agent_generated_code)
    # Returns to agent for analysis</code></pre>

      <h4>Similar Services</h4>
      <ul>
        <li><strong>Daytona.io</strong> - Claude integration</li>
        <li><strong>Modal</strong> - Serverless compute</li>
        <li><strong>Replit</strong> - Cloud IDE with execution</li>
      </ul>
    </div>

    <hr class="section-divider">

    <h2 id="browser"><strong>Bro</strong>wser <strong>Aut</strong>omation <strong>Inf</strong>rastructure</h2>

    <h3>Claude for Chrome (Local)</h3>
    <div class="ascii-diagram">
Claude Code (MCP Client)
        │
    Binary Protocol (4-byte LE + JSON)
        │
Chrome Extension (MCP Server)
        │
    Local Browser
    </div>

    <h3>Browserbase (Cloud)</h3>
    <p class="pattern-subtitle"><strong>Source:</strong> @pk_iv</p>

    <div class="ascii-diagram">
Claude Code (MCP Client)
        │
    Binary Protocol
        │
Intercepting Server (MCP -> CDP)
        │
Browserbase Cloud Browsers
    </div>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Feature</th>
            <th>Local Chrome</th>
            <th>Browserbase</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>Security</td><td>Cookies exposed</td><td>Isolated</td></tr>
          <tr><td>Parallelism</td><td>One instance</td><td>Multiple</td></tr>
          <tr><td>Production</td><td>No</td><td>Yes</td></tr>
          <tr><td>Claude Aware</td><td>Yes</td><td>No (transparent)</td></tr>
        </tbody>
      </table>
    </div>

    <hr class="section-divider">

    <h2 id="multi-agent-infra"><strong>Mul</strong>ti-<strong>Age</strong>nt <strong>Orc</strong>hestration <strong>Inf</strong>rastructure</h2>

    <div class="pattern-box">
      <h3 class="pattern-title">Personal Panopticon (8 Domain-Isolated Instances)</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> @mollycantillon</p>

      <pre><code>~/nox        # Company/product development
~/metrics    # Analytics/data processing
~/email      # Communications automation
~/growth     # Marketing/acquisition
~/trades     # Personal finance/trading
~/health     # Fitness/sleep/wellness
~/writing    # Content creation
~/personal   # Life admin</code></pre>

      <h4>Setup</h4>
      <pre><code># Keep system awake
caffeinate -i

# Simple alias
alias c='claude'

# Cron jobs for scheduled runs
0 6 * * * cd ~/trades && claude "Generate morning brief" > brief.md</code></pre>

      <blockquote>"Reverse the data asymmetry that institutions have over you - you surveilling yourself across all life domains."</blockquote>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">Gas Town (Agent Factory)</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> @steve_yegge | <strong>Repo:</strong> github.com/steveyegge/gastown</p>

      <pre><code>Gas Town (~/.gt)
├── HQ (Town-Level Management)
│   └── Mayor: Town coordination
├── Rigs (Project Repos)
│   ├── Witness: Per-rig observer
│   └── Beads: Git-backed data plane
└── Workers
    ├── Deacon: Monitoring/handshakes
    ├── Dogs: Quality gates
    ├── Refinery: Task decomposition
    ├── Polecat: Named persistent workers
    └── Crew: Ephemeral workers</code></pre>

      <p><strong>Scale:</strong> ~225,000 lines of Go code, multiple Claude accounts, tmux as primary UI</p>

      <div class="callout callout-danger">
        <div class="callout-title">Warning</div>
        <p>"If you have any doubt whatsoever, then you can't use it."</p>
        <p><strong>Requirements:</strong> Stage 7+ in dev evolution (10+ agents), significant budget, comfort with chaos</p>
      </div>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">rpai: tmux Multi-Agent Manager</h3>
      <p class="pattern-subtitle"><strong>Author:</strong> @radoslav11</p>

      <pre><code>cargo install rpai
rpai  # Run in any tmux session</code></pre>

      <ul>
        <li>Scans tmux panes for running agents</li>
        <li>Status indicators (running/idle/waiting)</li>
        <li>Output preview</li>
        <li>One-click jump to agent pane</li>
      </ul>
    </div>

    <hr class="section-divider">

    <h2 id="mobile"><strong>Mob</strong>ile and <strong>Cro</strong>ss-<strong>Dev</strong>ice</h2>

    <div class="pattern-box">
      <h3 class="pattern-title">Phone SSH Setup (dabit3 Pattern)</h3>

      <div class="ascii-diagram">
+-------------------------------------------------------------+
|  PHONE                                                       |
|  ├── Termius (SSH/mosh client)                               |
|  ├── Tailscale VPN                                           |
|  └── Poke (push notifications)                               |
+--------------------------------+----------------------------+
                                 | Tailscale VPN
                                 ▼
+-------------------------------------------------------------+
|  CLOUD VM ($7/day)                                           |
|  ├── tmux (6 parallel Claude windows)                        |
|  ├── Git worktrees (branch isolation)                        |
|  ├── PreToolUse hook -> Poke webhook                          |
|  └── Security: nftables, fail2ban, no public SSH             |
+-------------------------------------------------------------+
      </div>

      <h4>Push Notification Hook</h4>
      <pre><code>{
  "hooks": {
    "PreToolUse": [{
      "matcher": "AskUserQuestion",
      "hooks": [{
        "type": "command",
        "command": "~/.claude/hooks/notify-mobile.sh"
      }]
    }]
  }
}</code></pre>

      <h4>Workflow</h4>
      <ol>
        <li>Start VM via iOS Shortcut</li>
        <li>Connect via Termius -> Tailscale</li>
        <li>Auto-attach to tmux</li>
        <li>Kick off agents</li>
        <li>Go about your day</li>
        <li>Phone buzzes when agent needs input</li>
        <li>Respond via Termius</li>
        <li>Stop VM when done</li>
      </ol>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">Teleportation (Session Handoff)</h3>

      <h4>Native Claude Code Teleport</h4>
      <pre><code># In terminal Claude session
--teleport
# or just type: &

# Outputs URL like: https://claude.ai/code/session/abc123
# Open URL on any device to continue</code></pre>

      <h4>tmux Teleportation</h4>
      <pre><code># On laptop
tmux attach -t work
# Work for a while, close laptop

# On phone
ssh devuser@vm
# Auto-attaches to existing tmux session
# Continue exactly where you left off</code></pre>
    </div>

    <h3>SSH Clients for Mobile</h3>
    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>App</th>
            <th>Platform</th>
            <th>Cost</th>
            <th>mosh Support</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>Termius</td><td>iOS/Android</td><td>Free/$10mo</td><td>Yes</td></tr>
          <tr><td>Blink Shell</td><td>iOS</td><td>$20</td><td>Yes</td></tr>
          <tr><td>Prompt 3</td><td>iOS</td><td>$25</td><td>No</td></tr>
          <tr><td>Termux</td><td>Android</td><td>Free</td><td>Yes</td></tr>
        </tbody>
      </table>
    </div>

    <hr class="section-divider">

    <h2 id="sandboxing"><strong>San</strong>dboxing <strong>Str</strong>ategies</h2>

    <h3>Sandboxing Levels Overview</h3>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Level</th>
            <th>Isolation</th>
            <th>Performance</th>
            <th>Use Case</th>
          </tr>
        </thead>
        <tbody>
          <tr><td><strong>None</strong></td><td>No isolation</td><td>Full speed</td><td>Trusted, supervised</td></tr>
          <tr><td><strong>Process</strong></td><td>Limited</td><td>Good</td><td>Basic separation</td></tr>
          <tr><td><strong>Container</strong></td><td>Strong</td><td>Good</td><td>Development, CI/CD</td></tr>
          <tr><td><strong>VM</strong></td><td>Maximum</td><td>Overhead</td><td>Untrusted, autonomous</td></tr>
          <tr><td><strong>Cloud Sandbox</strong></td><td>Maximum + Managed</td><td>Variable</td><td>Production serverless</td></tr>
        </tbody>
      </table>
    </div>

    <h3>macOS App Sandbox</h3>
    <pre><code># Run with sandbox profile
sandbox-exec -f ~/.claude/sandbox.sb claude</code></pre>

    <h3>Linux Sandboxing Options</h3>

    <h4>Firejail</h4>
    <pre><code>sudo apt install firejail
firejail --private=~/claude-sandbox --net=none claude</code></pre>

    <h4>Bubblewrap (bwrap)</h4>
    <pre><code>bwrap \
    --ro-bind /usr /usr \
    --bind ~/project /workspace \
    --unshare-net \
    --die-with-parent \
    claude</code></pre>

    <h3>YOLO Mode (--dangerously-skip-permissions)</h3>

    <div class="callout callout-danger">
      <div class="callout-title">Safe YOLO Scenarios</div>
      <ul>
        <li>Isolated VM/container - <strong>Yes</strong></li>
        <li>Disposable cloud instance - <strong>Yes</strong></li>
        <li>CI/CD sandboxed runners - <strong>Conditional</strong></li>
        <li>Local development machine - <strong>No</strong></li>
        <li>Production systems - <strong>Never</strong></li>
        <li>Shared/team machines - <strong>No</strong></li>
      </ul>
    </div>

    <hr class="section-divider">

    <h2 id="security"><strong>Sec</strong>urity <strong>Arc</strong>hitecture</h2>

    <h3>Security Matrix</h3>
    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Deployment</th>
            <th>Network</th>
            <th>Filesystem</th>
            <th>Permissions</th>
            <th>Audit</th>
          </tr>
        </thead>
        <tbody>
          <tr><td><strong>Local CLI</strong></td><td>Full</td><td>Full</td><td>Interactive</td><td>Manual</td></tr>
          <tr><td><strong>Remote SSH</strong></td><td>VPN-only</td><td>Restricted</td><td>Config-based</td><td>Logs</td></tr>
          <tr><td><strong>Docker</strong></td><td>Isolated/Proxy</td><td>Mount-based</td><td>Config-based</td><td>Logs</td></tr>
          <tr><td><strong>Serverless</strong></td><td>Managed</td><td>Ephemeral</td><td>Minimal</td><td>Built-in</td></tr>
          <tr><td><strong>Enterprise</strong></td><td>Zero Trust</td><td>Encrypted</td><td>SSO/RBAC</td><td>SIEM</td></tr>
        </tbody>
      </table>
    </div>

    <h3>Permission Configuration Template</h3>
    <pre><code>{
  "permissions": {
    "tools": {
      "Bash": "ask",
      "Read": "allow",
      "Edit": "allow",
      "Write": "ask",
      "WebFetch": "ask",
      "WebSearch": "ask"
    },
    "commands": {
      "git status": "allow-always",
      "git diff": "allow-always",
      "npm test": "allow-always",
      "rm -rf": "deny-always",
      "git push --force": "deny-always",
      "sudo": "deny-always"
    },
    "paths": {
      "read": ["**/*"],
      "write": ["src/**", "tests/**"],
      "deny": [".env*", "*.pem", "*.key", "node_modules/**"]
    }
  }
}</code></pre>

    <h3>Network Isolation Strategies</h3>
    <pre><code># Level 1: No Network
docker run --network none claude
firejail --net=none claude

# Level 2: API-Only
iptables -A OUTPUT -d api.anthropic.com -p tcp --dport 443 -j ACCEPT
iptables -A OUTPUT -j DROP

# Level 3: Allowlist Domains
{
  "network": {
    "allowedDomains": [
      "api.anthropic.com",
      "github.com",
      "registry.npmjs.org"
    ],
    "mode": "allowlist"
  }
}</code></pre>

    <hr class="section-divider">

    <h2 id="cost"><strong>Cos</strong>t <strong>Ana</strong>lysis</h2>

    <h3>Infrastructure Costs</h3>
    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Setup</th>
            <th>Monthly Cost</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>Local only</td><td>$0</td><td>Electricity only</td></tr>
          <tr><td>Home Mac server</td><td>$0</td><td>Already owned</td></tr>
          <tr><td>Hetzner CX31</td><td>$13</td><td>Best value</td></tr>
          <tr><td>DigitalOcean</td><td>$48</td><td>Simple UX</td></tr>
          <tr><td>Vultr (always-on)</td><td>$210</td><td>US presence</td></tr>
          <tr><td>Vultr (8h/day)</td><td>$70</td><td>Stop when idle</td></tr>
          <tr><td>AWS EC2 Spot</td><td>$12-40</td><td>70-90% cheaper</td></tr>
          <tr><td>Codespaces (free tier)</td><td>$0</td><td>60 hrs/month</td></tr>
        </tbody>
      </table>
    </div>

    <h3>API Costs (Claude Code Usage)</h3>
    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Operation</th>
            <th>Est. Tokens</th>
            <th>Cost @ $15/M</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>Ralph iteration</td><td>3K-15K</td><td>$0.05-0.25</td></tr>
          <tr><td>25 iterations</td><td>75K-375K</td><td>$1.13-5.63</td></tr>
          <tr><td>50 iterations</td><td>150K-750K</td><td>$2.25-11.25</td></tr>
          <tr><td>Daily heavy use</td><td>~500K</td><td>~$7.50</td></tr>
        </tbody>
      </table>
    </div>

    <h3>Cost Optimization Strategies</h3>
    <ol>
      <li><strong>Stop VMs when idle</strong> - Use iOS Shortcuts/cron</li>
      <li><strong>Use Haiku for simple tasks</strong> - 95% cheaper than Opus</li>
      <li><strong>Prompt caching</strong> - 90% savings on repeated context</li>
      <li><strong>Batch API</strong> - 50% discount</li>
      <li><strong>Ralph file-based state</strong> - 60-80% context reduction</li>
      <li><strong>Spot instances</strong> - 70-90% cheaper than on-demand</li>
    </ol>

    <hr class="section-divider">

    <h2 id="decision-tree"><strong>Dec</strong>ision <strong>Tre</strong>e</h2>

    <div class="ascii-diagram">
START: What are you building?
│
├─ Personal dev work (supervised)
│   └─ LOCAL CLI
│       └─ Add tmux for persistence
│
├─ Overnight autonomous tasks
│   ├─ Can use local machine?
│   │   └─ Yes -> LOCAL + RALPH LOOP
│   └─ No -> CLOUD VM + RALPH LOOP
│
├─ Multi-agent parallel work
│   ├─ Same branch conflicts likely?
│   │   └─ Yes -> GIT WORKTREES or DOCKER MULTI-CONTAINER
│   └─ No -> TMUX PARALLEL SESSIONS
│
├─ Team/production deployment
│   ├─ Need code execution sandbox?
│   │   └─ Yes -> CLOUDFLARE SANDBOX or E2B
│   └─ No -> CONTAINERIZED with security controls
│
├─ Mobile-first workflow
│   ├─ Have always-on home Mac?
│   │   └─ Yes -> HOME MAC + TAILSCALE
│   └─ No -> CLOUD VM + TAILSCALE
│
├─ Browser automation needed
│   ├─ Production/parallel?
│   │   └─ Yes -> BROWSERBASE (cloud)
│   └─ No -> LOCAL CHROME MCP
│
└─ Enterprise deployment
    └─ HYBRID: Cloudflare Workers + VPC endpoints + SSO
    </div>

    <hr class="section-divider">

    <div class="quick-ref">
      <h3 class="quick-ref-title">Quick Reference Commands</h3>
      <pre><code># Local
claude
claude --model claude-opus-4-5-20251101
claude --dangerously-skip-permissions  # VM/container only!

# Docker
docker run -it -v ./project:/workspace \
  -e ANTHROPIC_API_KEY=$ANTHROPIC_API_KEY \
  claude-code

# tmux
tmux new -s work
tmux attach -t work

# Git worktrees
git worktree add ../feature-branch feature-branch

# Ralph loop
./ralph.sh 25

# Tailscale
tailscale up
tailscale ip -4</code></pre>
    </div>

    <hr class="section-divider">

    <div class="related-pages">
      <h3>Related Taxonomies</h3>
      <ul>
        <li><a href="tools.html">Tools</a> - Tool integrations</li>
        <li><a href="orchestration.html">Orchestration Patterns</a> - Patterns using infrastructure</li>
        <li><a href="architectures.html">Agent Architectures</a> - Structural patterns</li>
        <li><a href="cross-reference.html">Cross-Reference Index</a> - Master index</li>
      </ul>
    </div>

    <nav class="footer-nav">
      <a href="tools.html">Prev: Tools</a>
      <a href="cross-reference.html">Next: Cross-Reference</a>
    </nav>

  </div>
  <script src="../../js/copy-code.js"></script>
</body>
</html>
