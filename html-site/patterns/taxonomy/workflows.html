<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta data-pagefind-meta="chapter" content="Patterns">
  <meta data-pagefind-meta="section" content="Taxonomy">
  <title>Workflow Pattern Taxonomy | Claude Code Knowledge Base</title>
  <link rel="stylesheet" href="../../css/style.css">
  <link rel="stylesheet" href="../../css/search.css">
</head>
<body>
  <!-- Search Modal -->
  <div class="search-modal" id="searchModal" aria-hidden="true">
    <div class="search-overlay" onclick="closeSearch()"></div>
    <div class="search-content">
      <div class="search-header">
        <div class="search-input-wrapper">
          <span class="search-icon-input">&#128269;</span>
          <input type="text" id="searchInput" placeholder="Search documentation..." autocomplete="off" />
          <kbd class="search-kbd">ESC</kbd>
        </div>
      </div>
      <div class="search-filters">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="ch1">Chapter 1</button>
        <button class="filter-btn" data-filter="ch2">Chapter 2</button>
        <button class="filter-btn" data-filter="ch3">Chapter 3</button>
        <button class="filter-btn" data-filter="ch4">Chapter 4</button>
        <button class="filter-btn" data-filter="ref">Reference</button>
      </div>
      <div class="search-results" id="searchResults">
        <div class="search-empty"><p>Start typing to search... (Press Cmd+K anytime)</p></div>
      </div>
      <div class="search-footer">
        <span>&#8593;&#8595; Navigate</span><span>&#8629; Select</span><span>ESC Close</span>
      </div>
    </div>
  </div>

  <div class="wide-container">
    <!-- Search Trigger Button -->
    <button class="search-trigger" onclick="openSearch()" aria-label="Search" style="float: right; margin-bottom: 1rem;">
      <span class="search-icon">Cmd+K</span>
      <span class="search-text">Search</span>
    </button>

    <nav class="nav-breadcrumb">
      <a href="../../index.html">Home</a>
      <span>/</span>
      <a href="../index.html">Patterns</a>
      <span>/</span>
      <a href="index.html">Taxonomy</a>
      <span>/</span>
      <strong>Workflows</strong>
    </nav>

    <div class="you-are-here" style="background: linear-gradient(135deg, #f0ebe3 0%, #fefcf3 100%); border-left: 4px solid #2a7d7d; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
      <h3 style="margin-top: 0; color: #2a7d7d;"><strong>You</strong> Are <strong>He</strong>re</h3>
      <p><strong>Thi</strong>s <strong>tax</strong>onomy <strong>cla</strong>ssifies <strong>wor</strong>kflow <strong>pat</strong>terns - from <strong>tas</strong>k <strong>man</strong>agement <strong>app</strong>roaches to <strong>ver</strong>ification <strong>str</strong>ategies, <strong>fee</strong>dback <strong>loo</strong>ps, and <strong>sto</strong>p <strong>con</strong>ditions. Use <strong>thi</strong>s to <strong>sel</strong>ect the <strong>rig</strong>ht <strong>wor</strong>kflow for your <strong>tas</strong>k.</p>
      <p><strong>Rel</strong>ated:</p>
      <ul style="margin-bottom: 0;">
        <li><a href="orchestration.html">Orchestration</a> - <strong>Loo</strong>p and <strong>mul</strong>ti-<strong>age</strong>nt <strong>pat</strong>terns</li>
        <li><a href="context-memory.html">Context &amp; Memory</a> - <strong>Per</strong>sistence <strong>str</strong>ategies</li>
      </ul>
    </div>

    <h1><strong>Wor</strong>kflow <strong>Pat</strong>tern <strong>Tax</strong>onomy</h1>

    <p class="conversational-lead"><strong>Com</strong>prehensive <strong>cla</strong>ssification of <strong>AI</strong> <strong>age</strong>nt <strong>wor</strong>kflow <strong>pat</strong>terns. From <strong>PRD</strong>-<strong>dri</strong>ven <strong>dev</strong>elopment to <strong>ver</strong>ification <strong>stra</strong>tegies, <strong>fee</strong>dback <strong>loo</strong>ps, and <strong>err</strong>or <strong>rec</strong>overy.</p>

    <nav class="toc">
      <div class="toc-title">Table of Contents</div>
      <ul>
        <li><a href="#task-management">1. Task Management Approaches</a></li>
        <li><a href="#verification">2. Verification Patterns</a></li>
        <li><a href="#progression">3. Workflow Progression Spectrum</a></li>
        <li><a href="#feedback-loops">4. Feedback Loop Architectures</a></li>
        <li><a href="#stop-conditions">5. Stop Condition Patterns</a></li>
        <li><a href="#task-sizing">6. Task Sizing Heuristics</a></li>
        <li><a href="#error-recovery">7. Error Recovery Workflows</a></li>
        <li><a href="#cost-optimization">8. Cost Optimization Workflows</a></li>
        <li><a href="#hybrid">9. Hybrid Human-AI Workflows</a></li>
        <li><a href="#decision-guide">Decision Guide</a></li>
      </ul>
    </nav>

    <hr class="section-divider">

    <h2 id="task-management"><strong>Tas</strong>k <strong>Man</strong>agement <strong>App</strong>roaches</h2>

    <div class="pattern-box">
      <h3 class="pattern-title">1.1 PRD-Driven Development</h3>
      <p>The <strong>dom</strong>inant <strong>pat</strong>tern for <strong>str</strong>uctured, <strong>mul</strong>ti-<strong>tas</strong>k <strong>aut</strong>onomous <strong>wor</strong>k.</p>

      <h4>prd.json Format (Ryan Carson / Anthropic)</h4>
      <pre><code>{
  "project": "MyProject",
  "branchName": "feature/my-feature",
  "description": "Feature description",
  "userStories": [
    {
      "id": "US-001",
      "title": "Task title",
      "description": "As a [user], I need [what]",
      "acceptanceCriteria": [
        "Criterion 1",
        "Criterion 2",
        "npm run typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    }
  ]
}</code></pre>

      <h4>Matt Pocock's Simplified Format</h4>
      <pre><code>{
  "delete_video_shows_confirmation": {
    "description": "Delete video shows confirmation dialog before deleting",
    "passes": true
  },
  "beats_display": {
    "description": "Beats display as three orange ellipses dots below clip",
    "details": "Add beat to clip, verify 3 orange dots appear",
    "passes": false
  }
}</code></pre>

      <h4>Why JSON Over Markdown</h4>
      <div class="comparison-table">
        <table>
          <thead>
            <tr>
              <th>Aspect</th>
              <th>JSON</th>
              <th>Markdown</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>Parsing</td><td>Deterministic</td><td>Ambiguous</td></tr>
            <tr><td>Updates</td><td>Structured</td><td>Risk of malformed edits</td></tr>
            <tr><td>State tracking</td><td><code>passes: true/false</code></td><td>Manual checkboxes</td></tr>
            <tr><td>LLM reliability</td><td>Higher</td><td>Lower</td></tr>
          </tbody>
        </table>
      </div>

      <h4>Key Principles</h4>
      <ol>
        <li><strong>Tas</strong>ks must be <strong>sma</strong>ll - Completable in one context window</li>
        <li><strong>Acc</strong>eptance <strong>cri</strong>teria must be <strong>ver</strong>ifiable - Agent can check without human</li>
        <li><strong>Alw</strong>ays <strong>inc</strong>lude <strong>typ</strong>echeck - <code>npm run typecheck passes</code> as final criterion</li>
        <li><strong>Dep</strong>endencies <strong>ord</strong>ered <strong>cor</strong>rectly - Schema -> Backend -> Frontend</li>
      </ol>

      <p><span class="tag">prd</span> <span class="tag">json</span> <span class="tag">task-management</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">1.2 Kanban-Style Mental Model</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> Matt Pocock</p>

      <p><strong>Tre</strong>at <strong>tas</strong>ks as <strong>car</strong>ds on a <strong>vir</strong>tual <strong>boa</strong>rd.</p>

      <div class="ascii-diagram">
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│    TODO     │    │    DOING    │    │    DONE     │
├─────────────┤    ├─────────────┤    ├─────────────┤
│  US-003     │    │  US-002     │    │  US-001     │
│  US-004     │    │             │    │             │
│  US-005     │    │             │    │             │
└─────────────┘    └─────────────┘    └─────────────┘
      </div>

      <blockquote>"Pick task from board -> Complete -> Back to board -> All done? Exit : Loop"</blockquote>

      <h4>Implementation</h4>
      <ol>
        <li>Read prd.json</li>
        <li>Find story with <code>passes: false</code> and highest priority</li>
        <li>Skip if blocked by unfinished dependencies</li>
        <li>Implement story</li>
        <li>Run verification</li>
        <li>If pass: set <code>passes: true</code>, commit</li>
        <li>If fail: add notes, try again or move to next</li>
        <li>Repeat until all <code>passes: true</code></li>
      </ol>

      <p><span class="tag">kanban</span> <span class="tag">mental-model</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">1.3 Goal-Conditioned Loops</h3>

      <p><strong>Def</strong>ine the <strong>en</strong>d <strong>sta</strong>te, let <strong>age</strong>nt <strong>loo</strong>p <strong>unt</strong>il it <strong>rea</strong>ches it.</p>

      <h4>The Promise Pattern</h4>
      <pre><code>claude "Build a REST API for todos. When complete, output: &lt;promise&gt;COMPLETE&lt;/promise&gt;"</code></pre>

      <h4>Ralph Wiggum Implementation</h4>
      <pre><code>#!/bin/bash
while :; do
  output=$(claude @prompt.md)
  if echo "$output" | grep -q "&lt;promise&gt;COMPLETE&lt;/promise&gt;"; then
    echo "Goal reached!"
    break
  fi
done</code></pre>

      <h4>jq-Based Loop Condition</h4>
      <pre><code>while jq '.tasks[] | select(.passes == false)' prd.json | grep -q .; do
  claude @prompt.md
done</code></pre>

      <h4>Key Principles</h4>
      <ol>
        <li><strong>Cle</strong>ar <strong>sto</strong>p <strong>con</strong>dition - Explicit signal (promise tag, JSON state)</li>
        <li><strong>Ma</strong>x <strong>ite</strong>rations - Safety backstop to prevent runaway</li>
        <li><strong>Fre</strong>sh <strong>con</strong>text per <strong>ite</strong>ration - Avoid context rot</li>
        <li><strong>Ext</strong>ernal <strong>sta</strong>te <strong>per</strong>sistence - Files, not LLM memory</li>
      </ol>

      <p><span class="tag">goal-conditioned</span> <span class="tag">loop</span> <span class="tag">promise</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">1.4 Phase-Based Development</h3>

      <p><strong>Bre</strong>ak <strong>lar</strong>ge <strong>fea</strong>tures into <strong>seq</strong>uential <strong>pha</strong>ses with <strong>gat</strong>es.</p>

      <pre><code>{
  "epic": "User Authentication System",
  "phases": [
    {
      "phase": 1,
      "name": "Database Foundation",
      "prd_file": "plans/auth-phase1.json",
      "estimated_iterations": 5,
      "gate": ["Schema exists", "Migrations run"]
    },
    {
      "phase": 2,
      "name": "Backend Logic",
      "prd_file": "plans/auth-phase2.json",
      "blockedBy": "phase1",
      "gate": ["All API endpoints return expected status codes"]
    },
    {
      "phase": 3,
      "name": "Frontend Integration",
      "prd_file": "plans/auth-phase3.json",
      "blockedBy": "phase2",
      "gate": ["E2E login flow passes"]
    }
  ],
  "total_budget": "$50"
}</code></pre>

      <h4>When to Use</h4>
      <ul>
        <li>Features requiring 10+ iterations</li>
        <li>Cross-cutting concerns (auth, payments)</li>
        <li>Team handoffs between phases</li>
        <li>Budget tracking per phase</li>
      </ul>

      <p><span class="tag">phase-based</span> <span class="tag">gates</span> <span class="tag">epic</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">1.5 TaskCreate (Native Multi-Agent)</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> CC Mirror (@nummanali)</p>

      <p><strong>Cla</strong>ude <strong>Co</strong>de's <strong>bui</strong>lt-in <strong>tas</strong>k <strong>man</strong>agement for <strong>mul</strong>ti-<strong>age</strong>nt <strong>coo</strong>rdination.</p>

      <pre><code>TaskCreate  → Create with blockedBy/blocks relationships
TaskList    → View all tasks across agents
TaskGet     → Get specific task details
TaskUpdate  → Update status, addBlocks, addBlockedBy</code></pre>

      <h4>Visual Output</h4>
      <pre><code>Tasks:
 #1 Design API architecture
 #2 Create project structure
 #3 Implement data models
 #4 Implement REST endpoints (blocked by #3)
 #5 Write integration tests (blocked by #4)</code></pre>

      <h4>When to Use</h4>
      <ul>
        <li>Multiple agents working in parallel</li>
        <li>Complex dependency graphs</li>
        <li>Formal project management</li>
        <li>Team visibility requirements</li>
      </ul>

      <p><span class="tag">task-create</span> <span class="tag">cc-mirror</span> <span class="tag">multi-agent</span></p>
    </div>

    <hr class="section-divider">

    <h2 id="verification"><strong>Ver</strong>ification <strong>Pat</strong>terns</h2>

    <h3>Verification Hierarchy</h3>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Priority</th>
            <th>Method</th>
            <th>Use Case</th>
            <th>Tool</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>1</td><td>Type checking</td><td>Always</td><td><code>npm run typecheck</code></td></tr>
          <tr><td>2</td><td>Unit tests</td><td>Logic verification</td><td><code>npm test</code>, <code>pytest</code></td></tr>
          <tr><td>3</td><td>Integration tests</td><td>API verification</td><td><code>npm run test:integration</code></td></tr>
          <tr><td>4</td><td>E2E tests</td><td>Full flow</td><td>Playwright, Cypress</td></tr>
          <tr><td>5</td><td>CI green</td><td>All commits</td><td>GitHub Actions</td></tr>
          <tr><td>6</td><td>Browser automation</td><td>UI verification</td><td>Playwright MCP</td></tr>
          <tr><td>7</td><td>Manual spot-check</td><td>Milestones</td><td>Human review</td></tr>
        </tbody>
      </table>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">2.1 Test-Driven Verification</h3>

      <pre><code>{
  "acceptanceCriteria": [
    "npm run typecheck passes",
    "npm run test passes",
    "npm run lint passes"
  ]
}</code></pre>

      <blockquote>"Without verification, Ralph produces garbage."<br>- @mattpocockuk</blockquote>

      <blockquote>"Keep CI green. If you don't, you're hamstringing future agent runs with bad code, and they'll need to bisect to find bugs."<br>- @mattpocockuk</blockquote>

      <p><span class="tag">test-driven</span> <span class="tag">ci</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">2.2 Browser Verification (Playwright MCP)</h3>

      <pre><code>{
  "acceptanceCriteria": [
    "Navigate to /users",
    "Click filter dropdown",
    "Select 'Active'",
    "Confirm list shows only active users",
    "Take screenshot for verification"
  ]
}</code></pre>

      <blockquote>"Claude's tendency to mark features complete without proper testing... did much better at verifying end-to-end once explicitly prompted to use browser automation tools"<br>- Anthropic Best Practices</blockquote>

      <h4>Wes Winder Stack</h4>
      <div class="comparison-table">
        <table>
          <thead>
            <tr>
              <th>Component</th>
              <th>Role</th>
            </tr>
          </thead>
          <tbody>
            <tr><td><strong>Opus 4.5</strong></td><td>Strong reasoning model</td></tr>
            <tr><td><strong>Ralph Wiggum</strong></td><td>Iterative loop persistence</td></tr>
            <tr><td><strong>Playwright</strong></td><td>Real-world browser verification</td></tr>
          </tbody>
        </table>
      </div>

      <p><span class="tag">playwright</span> <span class="tag">browser</span> <span class="tag">mcp</span></p>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">2.3 Negative Verification</h3>

      <p><strong>Alw</strong>ays <strong>inc</strong>lude "don't <strong>bre</strong>ak" <strong>cri</strong>teria:</p>

      <pre><code>{
  "negativeCriteria": [
    "Does not modify files outside {directory}",
    "Does not add new dependencies without approval note",
    "Does not increase bundle size > 5KB",
    "Does not break existing public API",
    "Does not log sensitive data",
    "No console errors"
  ]
}</code></pre>

      <p><span class="tag">negative</span> <span class="tag">constraints</span></p>
    </div>

    <hr class="section-divider">

    <h2 id="progression"><strong>Wor</strong>kflow <strong>Pro</strong>gression <strong>Spe</strong>ctrum</h2>

    <div class="ascii-diagram">
┌─────────────────────────────────────────────────────────────────────────┐
│                    WORKFLOW PROGRESSION SPECTRUM                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  SINGLE-SHOT ──► INTERACTIVE ──► AUTONOMOUS ──► MULTI-AGENT ──► SWARM  │
│                                                                          │
│  ┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────┐   ┌────────┐│
│  │One prompt│   │Back-and- │   │Ralph     │   │CC Mirror │   │Gas Town││
│  │One task  │   │forth     │   │loops     │   │TaskCreate│   │Factory ││
│  │Immediate │   │dialogue  │   │Overnight │   │Parallel  │   │10+ agen││
│  │result    │   │Human-    │   │operations│   │agents    │   │ts      ││
│  │          │   │guided    │   │          │   │          │   │        ││
│  └──────────┘   └──────────┘   └──────────┘   └──────────┘   └────────┘│
│                                                                          │
│  Low complexity                                        High complexity   │
│  High oversight                                        Low oversight     │
│  Low cost                                              High cost         │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
    </div>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Level</th>
            <th>Pattern</th>
            <th>When to Use</th>
          </tr>
        </thead>
        <tbody>
          <tr><td><strong>Single-Shot</strong></td><td>One prompt, one response</td><td>Simple, well-defined tasks, bug fixes</td></tr>
          <tr><td><strong>Interactive</strong></td><td>Back-and-forth dialogue</td><td>Exploration, design decisions, code review</td></tr>
          <tr><td><strong>Autonomous</strong></td><td>Ralph loops</td><td>Well-defined features, overnight work</td></tr>
          <tr><td><strong>Multi-Agent</strong></td><td>CC Mirror, parallel work</td><td>Large features with independent parts</td></tr>
          <tr><td><strong>Swarm</strong></td><td>Gas Town factory</td><td>Enterprise-scale, dedicated infrastructure</td></tr>
        </tbody>
      </table>
    </div>

    <hr class="section-divider">

    <h2 id="feedback-loops"><strong>Fee</strong>dback <strong>Loo</strong>p <strong>Arc</strong>hitectures</h2>

    <div class="pattern-box">
      <h3 class="pattern-title">4.1 Tight Loop (Within Iteration)</h3>

      <pre><code>Code Change → Typecheck → Fix → Typecheck → Pass → Commit</code></pre>

      <ul>
        <li>Immediate feedback</li>
        <li>Same context window</li>
        <li>Quick corrections</li>
      </ul>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">4.2 Medium Loop (Across Iterations)</h3>

      <pre><code>Iteration 1: Attempt task → Fail → Log to progress.txt
Iteration 2: Read progress.txt → Try different approach → Pass</code></pre>

      <ul>
        <li>Fresh context</li>
        <li>Learned from history</li>
        <li>Pattern recognition</li>
      </ul>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">4.3 Loose Loop (Across Sessions)</h3>

      <pre><code>Session 1: Build foundation → Checkpoint
Session 2: Continue from checkpoint → Build features
Session 3: Complete and ship</code></pre>

      <ul>
        <li>Long-running projects</li>
        <li>Human checkpoints between</li>
        <li>Major milestone reviews</li>
      </ul>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">4.4 Self-Critique Loop (Ralph Marketer)</h3>

      <pre><code>DISCOVER → LEARN → RESEARCH → IDEATE → WRITE → CRITIQUE
                                                   ↓
                                          "Would founder publish?"
                                                   ↓
                                            No → ITERATE
                                            Yes → PUBLISH</code></pre>

      <ul>
        <li>Quality gate before completion</li>
        <li>Subjective evaluation</li>
        <li>Domain-specific criteria</li>
      </ul>
    </div>

    <hr class="section-divider">

    <h2 id="stop-conditions"><strong>Sto</strong>p <strong>Con</strong>dition <strong>Pat</strong>terns</h2>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Pattern</th>
            <th>Implementation</th>
            <th>Use Case</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Promise Tag</strong></td>
            <td><code>grep -q "&lt;promise&gt;COMPLETE&lt;/promise&gt;"</code></td>
            <td>Agent-determined completion</td>
          </tr>
          <tr>
            <td><strong>JSON State Check</strong></td>
            <td><code>jq '.tasks[] | select(.passes == false)'</code></td>
            <td>Task-based completion</td>
          </tr>
          <tr>
            <td><strong>Max Iterations</strong></td>
            <td><code>while [ $i -le $MAX ]</code></td>
            <td>Safety backstop</td>
          </tr>
          <tr>
            <td><strong>Budget Cap</strong></td>
            <td><code>if [ $TOKENS -gt $MAX_TOKENS ]</code></td>
            <td>Cost control</td>
          </tr>
          <tr>
            <td><strong>Stuck Detection</strong></td>
            <td>Same commit 3+ times</td>
            <td>Progress monitoring</td>
          </tr>
          <tr>
            <td><strong>Time-Based</strong></td>
            <td><code>if [ $ELAPSED -gt $MAX_SECONDS ]</code></td>
            <td>Time-boxed work</td>
          </tr>
        </tbody>
      </table>
    </div>

    <h3>Stuck Detection Example</h3>
    <pre><code>STUCK_THRESHOLD=3
if [ "$CURRENT_COMMIT" = "$LAST_COMMIT" ]; then
  STUCK_COUNT=$((STUCK_COUNT + 1))
  if [ $STUCK_COUNT -ge $STUCK_THRESHOLD ]; then
    echo "Stuck - intervention needed"
    exit 1
  fi
fi</code></pre>

    <hr class="section-divider">

    <h2 id="task-sizing"><strong>Tas</strong>k <strong>Siz</strong>ing <strong>Heu</strong>ristics</h2>

    <div class="callout callout-insight">
      <div class="callout-title">The Golden Rule</div>
      <p>"Each story must be completable in ONE iteration (~one context window)"</p>
    </div>

    <div class="callout callout-insight">
      <div class="callout-title">The 2-3 Sentence Test</div>
      <p>"If you can't describe the task in 2-3 sentences, it's too big."</p>
    </div>

    <h3>Right-Sized Tasks</h3>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Size</th>
            <th>Lines of Code</th>
            <th>Files</th>
            <th>Iterations</th>
            <th>Example</th>
          </tr>
        </thead>
        <tbody>
          <tr><td><strong>XS</strong></td><td>1-20</td><td>1</td><td>1</td><td>Add column, fix typo</td></tr>
          <tr><td><strong>S</strong></td><td>20-100</td><td>1-2</td><td>1</td><td>New component, endpoint</td></tr>
          <tr><td><strong>M</strong></td><td>100-300</td><td>2-5</td><td>1-2</td><td>Feature piece, integration</td></tr>
          <tr><td><strong>L</strong></td><td>300-1000</td><td>5-10</td><td>3-5</td><td>Small feature, refactor</td></tr>
          <tr><td><strong>XL</strong></td><td>1000+</td><td>10+</td><td>5+</td><td>Full feature (MUST SPLIT)</td></tr>
        </tbody>
      </table>
    </div>

    <h3>Cognitive Load Factors</h3>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Factor</th>
            <th>Weight</th>
            <th>Example</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>Novel patterns</td><td>3x</td><td>First time using a library</td></tr>
          <tr><td>Cross-boundary</td><td>2x</td><td>Frontend + Backend + DB</td></tr>
          <tr><td>Undocumented</td><td>2x</td><td>Legacy code without tests</td></tr>
          <tr><td>State complexity</td><td>2x</td><td>Concurrent operations</td></tr>
          <tr><td>External API</td><td>1.5x</td><td>Third-party service calls</td></tr>
          <tr><td>Standard CRUD</td><td>1x</td><td>Simple data operations</td></tr>
        </tbody>
      </table>
    </div>

    <p><strong>Formula:</strong> <code>Effective Size = Base Size * max(Cognitive Weights)</code></p>

    <h3>Split Triggers</h3>
    <p>Split task if:</p>
    <ul>
      <li><strong>> 40K tokens</strong> estimated for implementation</li>
      <li><strong>> 10 files</strong> need modification</li>
      <li><strong>> 5 test runs</strong> expected</li>
      <li><strong>> 3 MCP tool sequences</strong> required</li>
      <li>Can't describe in 2-3 sentences</li>
    </ul>

    <hr class="section-divider">

    <h2 id="error-recovery"><strong>Err</strong>or <strong>Rec</strong>overy <strong>Wor</strong>kflows</h2>

    <div class="pattern-box">
      <h3 class="pattern-title">7.1 Test Failure Recovery</h3>

      <pre><code>run_with_test_recovery() {
  local test_failures=0

  while [ $test_failures -lt $MAX_TEST_RETRIES ]; do
    claude @prompt.md

    if npm run test 2>&amp;1 | grep -q "passed"; then
      return 0
    else
      test_failures=$((test_failures + 1))
      echo "Test failure $test_failures/$MAX_TEST_RETRIES"
      npm run test 2>&amp;1 | tail -20 >> progress.txt
    fi
  done

  return 1
}</code></pre>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">7.2 Git Rollback Recovery</h3>

      <pre><code># Reset to last known good
git log --oneline -10
git reset --hard &lt;good-commit&gt;

# Clear progress
echo "# Resetting from bad state" > progress.txt

# Update PRD
# Manually set passes: false on unfinished items

# Resume
./ralph.sh 10</code></pre>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">7.3 Rollback Decision Tree</h3>

      <ol>
        <li><strong>Test failure after code change?</strong>
          <ul>
            <li>Revert last commit: <code>git reset --hard HEAD~1</code></li>
            <li>Retry same story with fresh context</li>
          </ul>
        </li>
        <li><strong>Multiple failures on same story (3+)?</strong>
          <ul>
            <li>Split story into smaller pieces</li>
            <li>Add notes to progress.txt about blocker</li>
            <li>Move to next unblocked story</li>
          </ul>
        </li>
        <li><strong>Context degradation detected?</strong>
          <ul>
            <li>Save progress to checkpoint</li>
            <li>Kill current session</li>
            <li>Start fresh with checkpoint context</li>
          </ul>
        </li>
        <li><strong>Budget exceeded?</strong>
          <ul>
            <li>Stop loop</li>
            <li>Document incomplete work</li>
            <li>Notify human for review</li>
          </ul>
        </li>
      </ol>
    </div>

    <hr class="section-divider">

    <h2 id="cost-optimization"><strong>Cos</strong>t <strong>Opt</strong>imization <strong>Wor</strong>kflows</h2>

    <h3>Token Usage Per Iteration</h3>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Activity</th>
            <th>Approximate Tokens</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>PRD read</td><td>500-2000</td></tr>
          <tr><td>Progress read</td><td>200-1000</td></tr>
          <tr><td>Task implementation</td><td>2000-10000</td></tr>
          <tr><td>Verification</td><td>500-2000</td></tr>
          <tr><td>Commit/update</td><td>200-500</td></tr>
        </tbody>
      </table>
    </div>

    <p><strong>Per iteration estimate:</strong> 3,000-15,000 tokens</p>

    <h3>Cost Estimates</h3>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Iterations</th>
            <th>Tokens (est.)</th>
            <th>Cost @ $15/M</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>10</td><td>30K-150K</td><td>$0.45-$2.25</td></tr>
          <tr><td>25</td><td>75K-375K</td><td>$1.13-$5.63</td></tr>
          <tr><td>50</td><td>150K-750K</td><td>$2.25-$11.25</td></tr>
          <tr><td>100</td><td>300K-1.5M</td><td>$4.50-$22.50</td></tr>
        </tbody>
      </table>
    </div>

    <h3>Cost Optimization Strategies</h3>
    <ol>
      <li><strong>Subagents for expensive tools</strong> - Playwright, MCP in subagents</li>
      <li><strong>Compact PRD</strong> - Only active stories</li>
      <li><strong>Prune progress.txt</strong> - Archive old learnings</li>
      <li><strong>Right-size tasks</strong> - Fewer iterations needed</li>
      <li><strong>Set max-iterations</strong> - Prevent runaway</li>
      <li><strong>Model stepping</strong> - Start cheap, escalate if needed</li>
      <li><strong>Off-peak scheduling</strong> - Run overnight</li>
    </ol>

    <hr class="section-divider">

    <h2 id="hybrid"><strong>Hyb</strong>rid <strong>Hum</strong>an-<strong>AI</strong> <strong>Wor</strong>kflows</h2>

    <div class="pattern-box">
      <h3 class="pattern-title">9.1 HOTL Ralph (Human On The Loop)</h3>

      <p><strong>Sin</strong>gle-<strong>ite</strong>ration <strong>var</strong>iant with <strong>hum</strong>an <strong>rev</strong>iew:</p>

      <pre><code>#!/bin/bash
# ralph-once.sh

claude "Review plans/prd.json and plans/progress.txt.
  Pick ONE feature marked passes: false.
  Implement it.
  Run tests.
  If passing, mark passes: true and commit.
  Append learnings to progress.txt."

# Human review
echo "=== Changes made ==="
git diff HEAD~1 --stat

read -p "Continue? (y/n) " -n 1 -r
if [[ $REPLY =~ ^[Yy]$ ]]; then
  ./ralph-once.sh
fi</code></pre>

      <h4>When to Use HOTL</h4>
      <ul>
        <li>Security-sensitive code</li>
        <li>Learning a new codebase</li>
        <li>Training the PRD format</li>
        <li>Debugging stuck loops</li>
      </ul>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">9.2 Planning + Execution Separation</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> Codex</p>

      <h4>Phase 1: Human-Guided Planning</h4>
      <ul>
        <li>Define architecture</li>
        <li>Set acceptance criteria</li>
        <li>Create PRD</li>
      </ul>

      <h4>Phase 2: Autonomous Execution</h4>
      <ul>
        <li>Ralph loops</li>
        <li>Overnight operation</li>
        <li>Minimal intervention</li>
      </ul>

      <h4>Phase 3: Human Review</h4>
      <ul>
        <li>Code review</li>
        <li>Merge approval</li>
        <li>Production deployment</li>
      </ul>
    </div>

    <div class="pattern-box">
      <h3 class="pattern-title">9.3 Mobile Monitoring Workflow</h3>
      <p class="pattern-subtitle"><strong>Source:</strong> Nader Dabit</p>

      <pre><code>{
  "hooks": {
    "PreToolUse": [{
      "matcher": "AskUserQuestion",
      "hooks": [{
        "type": "command",
        "command": "~/.claude/hooks/notify.sh"
      }]
    }]
  }
}</code></pre>

      <p>Agent runs autonomously, human receives push notifications when intervention needed.</p>
    </div>

    <hr class="section-divider">

    <h2 id="decision-guide"><strong>Dec</strong>ision <strong>Gui</strong>de</h2>

    <h3>Workflow Selection Matrix</h3>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Scenario</th>
            <th>Recommended Workflow</th>
            <th>Key Factors</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>Simple bug fix</td><td>Single-shot</td><td>Clear solution, low risk</td></tr>
          <tr><td>Explore codebase</td><td>Interactive</td><td>Discovery, learning</td></tr>
          <tr><td>Well-defined feature</td><td>Ralph loop</td><td>Clear criteria, testable</td></tr>
          <tr><td>Multi-component feature</td><td>PRD phases</td><td>Dependencies, milestones</td></tr>
          <tr><td>Team collaboration</td><td>CC Mirror + TaskCreate</td><td>Coordination, visibility</td></tr>
          <tr><td>Enterprise migration</td><td>Gas Town</td><td>Scale, resources</td></tr>
          <tr><td>Security-sensitive</td><td>HOTL Ralph</td><td>Human review required</td></tr>
          <tr><td>Time-sensitive</td><td>Parallel Ralph</td><td>Speed over efficiency</td></tr>
          <tr><td>Budget-constrained</td><td>Model stepping</td><td>Cost optimization</td></tr>
        </tbody>
      </table>
    </div>

    <h3>Red Flags - When NOT to Use Autonomous Workflows</h3>

    <ol>
      <li><strong>Subjective tasks</strong> - "Make this pretty" has no verifiable completion</li>
      <li><strong>Security-critical code</strong> - Needs human review</li>
      <li><strong>Ambiguous requirements</strong> - "Build something cool" wastes tokens</li>
      <li><strong>One-shot operations</strong> - No loop needed</li>
      <li><strong>Exploratory work</strong> - Use HOTL or interactive</li>
      <li><strong>Design decisions</strong> - Agent implements, humans decide</li>
      <li><strong>Complex debugging</strong> - Often needs human intuition</li>
      <li><strong>Legacy code without tests</strong> - No verification possible</li>
      <li><strong>Third-party API integrations</strong> - Often need manual testing</li>
      <li><strong>Production deployments</strong> - Always review before shipping</li>
    </ol>

    <hr class="section-divider">

    <div class="quick-ref">
      <h3 class="quick-ref-title">Quick Reference</h3>
      <h4>Minimal Ralph Setup</h4>
      <pre><code>project/
├── plans/
│   ├── ralph.sh         # Loop script
│   ├── prompt.md        # Instructions
│   ├── prd.json         # Tasks
│   └── progress.txt     # Learnings
└── CLAUDE.md            # Context</code></pre>

      <h4>Pre-Flight Checklist</h4>
      <ul>
        <li>Tasks are small enough (2-3 sentence rule)</li>
        <li>Dependencies ordered correctly (schema -> backend -> frontend)</li>
        <li>Acceptance criteria are verifiable</li>
        <li>Tests exist or will be created</li>
        <li>Git branch created</li>
        <li>progress.txt initialized</li>
        <li>Max iterations set</li>
        <li>Verification commands work</li>
      </ul>
    </div>

    <hr class="section-divider">

    <div class="related-pages">
      <h3>Related Taxonomies</h3>
      <ul>
        <li><a href="orchestration.html">Orchestration Patterns</a> - Loop and multi-agent patterns</li>
        <li><a href="context-memory.html">Context &amp; Memory</a> - Persistence strategies</li>
        <li><a href="architectures.html">Agent Architectures</a> - Structural patterns</li>
        <li><a href="tools.html">Tools</a> - Hooks, MCP, plugins</li>
        <li><a href="cross-reference.html">Cross-Reference Index</a> - Master index</li>
      </ul>
    </div>

    <nav class="footer-nav">
      <a href="context-memory.html">Prev: Context &amp; Memory</a>
      <a href="tools.html">Next: Tools</a>
    </nav>

  </div>
  <script src="../../js/copy-code.js"></script>
  <script src="../../js/search.js"></script>
</body>
</html>
