<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cost Optimization Guide | Claude Code Knowledge Base</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <div class="wide-container">
    <nav class="nav-breadcrumb">
      <a href="../index.html">Home</a>
      <span>/</span>
      <a href="index.html">Comparisons</a>
      <span>/</span>
      Cost Optimization
    </nav>

    <h1><span class="bionic">Cos</span>t-Optimized <span class="bionic">Arc</span>hitecture <span class="bionic">Des</span>ign</h1>

    <!-- You Are Here Context Box -->
    <div class="you-are-here" style="background: linear-gradient(135deg, #f0ebe3 0%, #fefcf3 100%); border-left: 4px solid #2a7d7d; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
      <strong style="color: #2a7d7d;">You Are Here:</strong> This is a comprehensive guide to <strong>balancing cost vs capability</strong> when building AI agent systems. Learn which model to use when, how to reduce token consumption, and budget engineering strategies. <em>The winning formula: Fresh context + Tiered models + Early exit + Verification.</em>
    </div>

    <!-- Table of Contents -->
    <div class="toc">
      <div class="toc-title">On This Page</div>
      <ul>
        <li><a href="#cost-factors">Cost Factors</a></li>
        <li><a href="#model-selection">Model Selection Strategy</a></li>
        <li><a href="#cost-patterns">Cost-Saving Patterns</a></li>
        <li><a href="#pattern-analysis">Per-Pattern Cost Analysis</a></li>
        <li><a href="#calculator">Cost Calculator</a></li>
        <li><a href="#budget">Budget Engineering</a></li>
        <li><a href="#roi">ROI Analysis</a></li>
        <li><a href="#real-world">Real-World Cost Reports</a></li>
        <li><a href="#checklists">Cost Optimization Checklists</a></li>
        <li><a href="#advanced">Advanced Strategies</a></li>
      </ul>
    </div>

    <hr class="section-divider">

    <!-- Cost Factors -->
    <h2 id="cost-factors"><span class="bionic">Cos</span>t <span class="bionic">Fac</span>tors</h2>

    <p>Understanding the four primary cost vectors is essential for optimization:</p>

    <h3>1. Model Selection</h3>
    <p>The most impactful cost lever. Price differential is dramatic:</p>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Model</th>
            <th>Input (per 1M tokens)</th>
            <th>Output (per 1M tokens)</th>
            <th>Cost Multiplier</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Claude 3.5 Haiku</strong></td>
            <td>$0.25</td>
            <td>$1.25</td>
            <td>1x (baseline)</td>
          </tr>
          <tr>
            <td><strong>Claude Sonnet 4</strong></td>
            <td>$3.00</td>
            <td>$15.00</td>
            <td>12x</td>
          </tr>
          <tr>
            <td><strong>Claude Opus 4.5</strong></td>
            <td>$15.00</td>
            <td>$75.00</td>
            <td style="color: var(--error);"><strong>60x</strong></td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="callout callout-warning">
      <div class="callout-title">Key Insight</div>
      <p>Opus output is <strong>60x more expensive</strong> than Haiku output. A 1000-token response costs $0.00125 with Haiku vs $0.075 with Opus.</p>
    </div>

    <h3>2. Token Usage (Context Size)</h3>
    <p>Context accumulation is the silent cost killer:</p>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Context State</th>
            <th>Token Range</th>
            <th>Cost Implication</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td style="color: var(--success);"><strong>Fresh context</strong></td>
            <td>0-20K</td>
            <td>Optimal efficiency</td>
          </tr>
          <tr>
            <td><strong>Working context</strong></td>
            <td>20K-100K</td>
            <td>Normal operation</td>
          </tr>
          <tr>
            <td style="color: var(--warning);"><strong>Heavy context</strong></td>
            <td>100K-150K</td>
            <td>Diminishing returns</td>
          </tr>
          <tr>
            <td style="color: var(--error);"><strong>Context rot zone</strong></td>
            <td>150K-200K</td>
            <td>Quality degrades, waste increases</td>
          </tr>
        </tbody>
      </table>
    </div>

    <h3>3. Iteration Count</h3>
    <p>More iterations = more cost, but relationship isn't linear:</p>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Iterations</th>
            <th>Typical Use Case</th>
            <th>Cost Curve</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>1-5</td><td>Simple features</td><td>Linear</td></tr>
          <tr><td>5-15</td><td>Standard features</td><td>Linear + overhead</td></tr>
          <tr><td>15-30</td><td>Complex features</td><td>Sublinear (learning compounds)</td></tr>
          <tr><td>30-50+</td><td>Large systems</td><td>Variable (depends on verification)</td></tr>
        </tbody>
      </table>
    </div>

    <div class="callout callout-insight">
      <div class="callout-title">Insight</div>
      <p>Good planning upfront reduces iterations by 50-80%.</p>
    </div>

    <h3>4. Parallelism</h3>
    <p>Parallel agents multiply costs but can reduce calendar time:</p>

    <pre><code>Sequential (1 agent, 10 tasks):
Time: 10 hours | Cost: 10 agent-hours

Parallel (5 agents, 10 tasks):
Time: 2 hours | Cost: 10 agent-hours (same total)

BUT: Parallel often requires coordination overhead (+10-20%)</code></pre>

    <hr class="section-divider">

    <!-- Model Selection Strategy -->
    <h2 id="model-selection"><span class="bionic">Mod</span>el <span class="bionic">Sel</span>ection <span class="bionic">Str</span>ategy</h2>

    <h3>When to Use Opus 4.5</h3>
    <p><strong>Opus is the premium tier ($15/$75 per 1M tokens)</strong></p>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Use Case</th>
            <th>Why Opus</th>
            <th>Cost Justification</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Complex reasoning</strong></td>
            <td>Multi-step logic, nuanced decisions</td>
            <td>Fewer retries save money</td>
          </tr>
          <tr>
            <td><strong>Orchestration decisions</strong></td>
            <td>Task decomposition, dependency planning</td>
            <td>Architecture errors expensive to fix</td>
          </tr>
          <tr>
            <td><strong>Architecture planning</strong></td>
            <td>System design, technology choices</td>
            <td>Bad architecture = massive rework</td>
          </tr>
          <tr>
            <td><strong>Quality-critical work</strong></td>
            <td>Security review, production debugging</td>
            <td>Bugs in production cost more than Opus</td>
          </tr>
          <tr>
            <td><strong>Ambiguous requirements</strong></td>
            <td>Clarifying vague specs</td>
            <td>Misunderstanding wastes entire iterations</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="decision-point">
      <strong>Rule of Thumb:</strong> If a mistake at this step would cascade into expensive rework, use Opus.
    </div>

    <h3>When to Use Sonnet</h3>
    <p><strong>Sonnet is the workhorse tier ($3/$15 per 1M tokens)</strong></p>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Use Case</th>
            <th>Why Sonnet</th>
            <th>Cost Justification</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>General implementation</strong></td>
            <td>Writing code to spec</td>
            <td>Fast, capable, cost-effective</td>
          </tr>
          <tr>
            <td><strong>Worker tasks</strong></td>
            <td>Following established patterns</td>
            <td>Clear instructions don't need Opus</td>
          </tr>
          <tr>
            <td><strong>Most coding work</strong></td>
            <td>Features, bug fixes, refactoring</td>
            <td>Sweet spot of capability/cost</td>
          </tr>
          <tr>
            <td><strong>Test generation</strong></td>
            <td>Writing test cases</td>
            <td>Pattern-following task</td>
          </tr>
          <tr>
            <td><strong>Code review</strong></td>
            <td>Reviewing PRs, suggesting improvements</td>
            <td>Good judgment, not maximum reasoning</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="recommendation">
      <strong>Default Choice:</strong> Start with Sonnet. Only upgrade to Opus if Sonnet fails or task requires complex reasoning.
    </div>

    <h3>When to Use Haiku</h3>
    <p><strong>Haiku is the efficiency tier ($0.25/$1.25 per 1M tokens)</strong></p>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Use Case</th>
            <th>Why Haiku</th>
            <th>Cost Justification</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Simple tasks</strong></td>
            <td>File lookups, greps, formatting</td>
            <td>No reasoning required</td>
          </tr>
          <tr>
            <td><strong>Testing/verification</strong></td>
            <td>Running tests, checking status</td>
            <td>Pass/fail determination</td>
          </tr>
          <tr>
            <td><strong>High-volume work</strong></td>
            <td>Bulk operations, repetitive tasks</td>
            <td>Volume makes cost critical</td>
          </tr>
          <tr>
            <td><strong>Errand running</strong></td>
            <td>Fetch files, simple transformations</td>
            <td>CC Mirror's "spawn 5-10 in parallel"</td>
          </tr>
          <tr>
            <td><strong>Health checks</strong></td>
            <td>Monitoring, status polling</td>
            <td>Simple queries</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="callout callout-success">
      <div class="callout-title">The Haiku Army</div>
      <p>For embarrassingly parallel tasks, 10 Haiku workers often outperform 1 Opus at <strong>1/60th the cost</strong>.</p>
    </div>

    <h3>Model Selection by Role (Gas Town Framework)</h3>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Role</th>
            <th>Recommended Model</th>
            <th>Hourly Cost Est.</th>
            <th>Rationale</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Mayor</strong> (coordination)</td>
            <td>Opus 4.5</td>
            <td>$15-20</td>
            <td>Complex cross-rig decisions</td>
          </tr>
          <tr>
            <td><strong>Refinery</strong> (decomposition)</td>
            <td>Opus 4.5</td>
            <td>$15-20</td>
            <td>Task breakdown is architectural</td>
          </tr>
          <tr>
            <td><strong>Dogs</strong> (quality gates)</td>
            <td>Sonnet</td>
            <td>$5-8</td>
            <td>Review requires judgment</td>
          </tr>
          <tr>
            <td><strong>Polecat</strong> (named workers)</td>
            <td>Sonnet</td>
            <td>$5-10</td>
            <td>Implementation work</td>
          </tr>
          <tr>
            <td><strong>Witness</strong> (observation)</td>
            <td>Haiku</td>
            <td>$1-3</td>
            <td>Logging, status tracking</td>
          </tr>
          <tr>
            <td><strong>Deacon</strong> (health checks)</td>
            <td>Haiku</td>
            <td>$1-2</td>
            <td>Simple monitoring</td>
          </tr>
          <tr>
            <td><strong>Crew</strong> (ephemeral)</td>
            <td>Haiku</td>
            <td>$0.50-2</td>
            <td>Quick, isolated tasks</td>
          </tr>
        </tbody>
      </table>
    </div>

    <hr class="section-divider">

    <!-- Cost-Saving Patterns -->
    <h2 id="cost-patterns"><span class="bionic">Cos</span>t-Saving <span class="bionic">Pat</span>terns</h2>

    <h3>Pattern 1: Fresh Context (Ralph Wiggum)</h3>
    <p>The Ralph pattern uses fresh context per iteration rather than growing conversations.</p>

    <pre><code>Traditional long session:
+-- Iteration 1: 10K context
+-- Iteration 5: 50K context (5x input cost)
+-- Iteration 10: 100K context (10x input cost)
+-- Quality degrading, more retries needed

Ralph fresh context:
+-- Iteration 1: 10K context
+-- Iteration 5: 10K context (same cost)
+-- Iteration 10: 10K context (same cost)
+-- Quality maintained, fewer retries</code></pre>

    <div class="callout callout-success">
      <div class="callout-title">Savings: 50-60%</div>
      <p>Long session (10 iterations, growing context): ~$5-10<br>
      Ralph (10 iterations, fresh context): ~$2-4</p>
    </div>

    <h3>Pattern 2: Worker Model Selection</h3>
    <p>Tiered model selection for orchestrated systems:</p>

    <pre><code>orchestrator: opus (planning, coordination)
    +-- workers: sonnet (implementation)
            +-- verification: haiku (testing)</code></pre>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Workflow</th>
            <th>Cost</th>
            <th>Savings</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>All-Opus workflow</td><td>$100 (baseline)</td><td>-</td></tr>
          <tr><td>Tiered workflow</td><td>$35</td><td style="color: var(--success);">-65%</td></tr>
          <tr><td>Aggressive Haiku use</td><td>$20</td><td style="color: var(--success);">-80%</td></tr>
        </tbody>
      </table>
    </div>

    <h3>Pattern 3: Early Exit (Promise Pattern)</h3>
    <p>Stop when done, don't iterate unnecessarily:</p>

    <pre><code>if grep -q "&lt;promise&gt;COMPLETE&lt;/promise&gt;" output.txt; then
  echo "Done early!"
  break
fi</code></pre>

    <div class="callout callout-success">
      <div class="callout-title">Savings: 30-40%</div>
      <p>Without early exit: Always runs MAX_ITERATIONS<br>
      With early exit: Average 60-70% of MAX_ITERATIONS</p>
    </div>

    <h3>Pattern 4: Prompt Caching</h3>
    <p>Anthropic's prompt caching provides 90% discount on cached content:</p>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Model</th>
            <th>Cache Write (per 1M)</th>
            <th>Cache Read (per 1M)</th>
            <th>Savings</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>Haiku</td><td>$0.30</td><td>$0.03</td><td style="color: var(--success);">90%</td></tr>
          <tr><td>Sonnet</td><td>$3.75</td><td>$0.30</td><td style="color: var(--success);">90%</td></tr>
          <tr><td>Opus</td><td>$18.75</td><td>$1.50</td><td style="color: var(--success);">90%</td></tr>
        </tbody>
      </table>
    </div>

    <p><strong>Best for:</strong> Large system prompts (1000+ tokens), repeated similar requests</p>

    <h3>Pattern 5: Batches API</h3>
    <p><strong>50% discount</strong> for non-urgent workloads. Best for bulk document processing, overnight analysis, test generation at scale.</p>

    <h3>Pattern 6: Subagent Token Isolation</h3>
    <p>Protect main context from expensive operations:</p>

    <pre><code>Main Agent (lean)
    |
    +-- Subagent: Browser Automation
        +-- (High token cost stays isolated)
        +-- Returns: Summary only</code></pre>

    <blockquote>
      <p>"The feedback loop is everything, but put costly tools like browser control in subagents to protect your main context window tokens"</p>
      <footer>-- @TendiesOfWisdom</footer>
    </blockquote>

    <p><strong>Savings:</strong> 50-70% for browser/MCP-heavy workflows</p>

    <h3>Pattern 7: Output Length Control</h3>
    <p>Output tokens cost 5x more than input for most models. Set limits and request concise responses.</p>
    <p><strong>Savings:</strong> 50-80% on output tokens</p>

    <hr class="section-divider">

    <!-- Per-Pattern Cost Analysis -->
    <h2 id="pattern-analysis"><span class="bionic">Per</span>-Pattern <span class="bionic">Cos</span>t <span class="bionic">Ana</span>lysis</h2>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Pattern</th>
            <th>Typical Cost</th>
            <th>Duration</th>
            <th>Best For</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Basic Ralph (10 iter)</strong></td>
            <td>$2-5</td>
            <td>30-60 min</td>
            <td>Single features</td>
          </tr>
          <tr>
            <td><strong>Extended Ralph (25 iter)</strong></td>
            <td>$8-15</td>
            <td>2-4 hours</td>
            <td>Complex features</td>
          </tr>
          <tr>
            <td><strong>Overnight Ralph (50 iter)</strong></td>
            <td>$20-50</td>
            <td>6-12 hours</td>
            <td>Full components</td>
          </tr>
          <tr>
            <td><strong>CC Mirror (5 workers)</strong></td>
            <td>$5-15</td>
            <td>30-60 min</td>
            <td>Team coordination</td>
          </tr>
          <tr>
            <td><strong>CC Mirror (full team)</strong></td>
            <td>$15-40</td>
            <td>1-3 hours</td>
            <td>Complex projects</td>
          </tr>
          <tr>
            <td><strong>Gas Town (minimal)</strong></td>
            <td>$50-100/day</td>
            <td>Continuous</td>
            <td>Solo founder</td>
          </tr>
          <tr>
            <td><strong>Gas Town (full)</strong></td>
            <td>$200-500/day</td>
            <td>Continuous</td>
            <td>Teams, agencies</td>
          </tr>
        </tbody>
      </table>
    </div>

    <h3>Cost vs Complexity Visualization</h3>
    <div class="ascii-diagram">+---------------------------------------------------------------------+
|                      COST vs COMPLEXITY                             |
+---------------------------------------------------------------------+
|                                                                     |
|  $$$$$  +---------------------------------------+                   |
|         |                        Gas Town       |                   |
|  $$$$   |                        (Full)         |                   |
|         |                                       |                   |
|  $$$    |              Gas Town                 |                   |
|         |              (Minimal)   Orchestra    |                   |
|  $$     |    CC Mirror            /             |                   |
|         |    (Full)    /                        |                   |
|  $      |    CC Mirror/    Ralph (Extended)     |                   |
|         |    (3-cmd)       /                    |                   |
|  cents  |  Ralph (Basic)  /                     |                   |
|         +---------------------------------------+                   |
|         SIMPLE ---------------------------------> COMPLEX           |
|                                                                     |
+---------------------------------------------------------------------+</div>

    <hr class="section-divider">

    <!-- Cost Calculator -->
    <h2 id="calculator"><span class="bionic">Cos</span>t <span class="bionic">Cal</span>culator</h2>

    <h3>Formula</h3>
    <pre><code>Total Cost = Context Cost + Iteration Cost + Parallelism Overhead

Where:
  Context Cost = tokens_per_iteration x model_rate x iterations
  Iteration Cost = (setup_tokens + task_tokens + verification_tokens) x model_rate
  Parallelism Overhead = worker_count x coordination_tokens x model_rate</code></pre>

    <h3>Quick Estimation Table</h3>
    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Variable</th>
            <th>Haiku</th>
            <th>Sonnet</th>
            <th>Opus</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Cost per 1K input tokens</td>
            <td>$0.00025</td>
            <td>$0.003</td>
            <td>$0.015</td>
          </tr>
          <tr>
            <td>Cost per 1K output tokens</td>
            <td>$0.00125</td>
            <td>$0.015</td>
            <td>$0.075</td>
          </tr>
          <tr>
            <td>Typical iteration cost</td>
            <td>$0.05-0.20</td>
            <td>$0.50-2.00</td>
            <td>$2.00-5.00</td>
          </tr>
          <tr>
            <td>Worker-hour estimate</td>
            <td>$1-3</td>
            <td>$5-10</td>
            <td>$15-20</td>
          </tr>
        </tbody>
      </table>
    </div>

    <h3>Worked Example: 10-Iteration Ralph Loop</h3>
    <p><strong>Scenario:</strong> Building a REST API feature</p>

    <pre><code>Per iteration:
- Input: 8K tokens (prd.json, progress.txt, code context)
- Output: 2K tokens (implementation, commit)
- Model: Sonnet

Cost per iteration:
- Input: 8K x $0.003/1K = $0.024
- Output: 2K x $0.015/1K = $0.030
- Total: $0.054

10 iterations: $0.54

With overhead (tools, verification): ~$1-2 total</code></pre>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Model</th>
            <th>10-Iteration Cost</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>Haiku</td><td style="color: var(--success);">~$0.15-0.30</td></tr>
          <tr><td>Sonnet</td><td>~$1-2</td></tr>
          <tr><td>Opus</td><td style="color: var(--error);">~$6-10</td></tr>
        </tbody>
      </table>
    </div>

    <hr class="section-divider">

    <!-- Budget Engineering -->
    <h2 id="budget"><span class="bionic">Bud</span>get <span class="bionic">Eng</span>ineering</h2>

    <h3>Setting Limits</h3>
    <pre><code># Always set a safety backstop
MAX_ITERATIONS=25  # Never more than this
./ralph.sh $MAX_ITERATIONS</code></pre>

    <h3>Alert Thresholds</h3>
    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Level</th>
            <th>Trigger</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td style="color: var(--warning);"><strong>Warning</strong></td>
            <td>50% of daily budget</td>
            <td>Log, continue</td>
          </tr>
          <tr>
            <td style="color: var(--error);"><strong>Critical</strong></td>
            <td>80% of daily budget</td>
            <td>Alert (Slack/email)</td>
          </tr>
          <tr>
            <td><strong>Pause</strong></td>
            <td>95% of daily budget</td>
            <td>Pause non-critical work</td>
          </tr>
          <tr>
            <td style="color: var(--error);"><strong>Shutdown</strong></td>
            <td>100% of daily budget</td>
            <td>Stop all work</td>
          </tr>
        </tbody>
      </table>
    </div>

    <h3>Budget Tiers by Use Case</h3>
    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>User Type</th>
            <th>Monthly Budget</th>
            <th>Recommended Setup</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Hobbyist</strong></td>
            <td>$20-50</td>
            <td>Pro subscription, occasional API</td>
          </tr>
          <tr>
            <td><strong>Solo dev</strong></td>
            <td>$100-300</td>
            <td>Ralph loops, Sonnet-heavy</td>
          </tr>
          <tr>
            <td><strong>Power user</strong></td>
            <td>$500-1000</td>
            <td>CC Mirror, tiered models</td>
          </tr>
          <tr>
            <td><strong>Team</strong></td>
            <td>$1000-3000</td>
            <td>Gas Town minimal, shared infra</td>
          </tr>
          <tr>
            <td><strong>Agency</strong></td>
            <td>$3000-10000</td>
            <td>Gas Town full, multi-project</td>
          </tr>
        </tbody>
      </table>
    </div>

    <hr class="section-divider">

    <!-- ROI Analysis -->
    <h2 id="roi"><span class="bionic">ROI</span> <span class="bionic">Ana</span>lysis</h2>

    <h3>Investment vs Return</h3>
    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Investment</th>
            <th>Setup Cost</th>
            <th>Ongoing Cost</th>
            <th>Return</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Ralph setup</strong></td>
            <td>1 hour</td>
            <td>~$2-10/feature</td>
            <td>Overnight shipping capability</td>
          </tr>
          <tr>
            <td><strong>CC Mirror</strong></td>
            <td>5 minutes</td>
            <td>~$5-20/session</td>
            <td>3-5x parallelism</td>
          </tr>
          <tr>
            <td><strong>Gas Town</strong></td>
            <td>Hours/days</td>
            <td>$200-500/day</td>
            <td>10+ agent orchestration</td>
          </tr>
          <tr>
            <td><strong>Prompt caching</strong></td>
            <td>30 minutes</td>
            <td>-90% on cached</td>
            <td>Major savings at scale</td>
          </tr>
        </tbody>
      </table>
    </div>

    <h3>Value Multiplication</h3>
    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Pattern</th>
            <th>Cost</th>
            <th>Developer Time Saved</th>
            <th>Value Multiplier</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Ralph overnight</td>
            <td>$20</td>
            <td>8 hours</td>
            <td style="color: var(--success);"><strong>40x</strong> at $100/hr</td>
          </tr>
          <tr>
            <td>CC Mirror parallel</td>
            <td>$15</td>
            <td>4 hours</td>
            <td style="color: var(--success);"><strong>27x</strong> at $100/hr</td>
          </tr>
          <tr>
            <td>Haiku army for bulk</td>
            <td>$5</td>
            <td>2 hours</td>
            <td style="color: var(--success);"><strong>40x</strong> at $100/hr</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="callout callout-insight">
      <div class="callout-title">The Fundamental Equation</div>
      <pre style="margin: 0; background: transparent; border: none; padding: 0;"><code>If AI_cost < (Developer_hourly_rate x Hours_saved x Quality_factor)
Then: Use AI</code></pre>
    </div>

    <hr class="section-divider">

    <!-- Real-World Cost Reports -->
    <h2 id="real-world"><span class="bionic">Rea</span>l-World <span class="bionic">Cos</span>t <span class="bionic">Rep</span>orts</h2>

    <h3>Community Data Points</h3>
    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Source</th>
            <th>Setup</th>
            <th>Usage</th>
            <th>Reported Cost</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>@arvidkahl</td>
            <td>Ralph loops</td>
            <td>50 iterations</td>
            <td>$50-100+</td>
          </tr>
          <tr>
            <td>@dabit3</td>
            <td>Cloud VM + API</td>
            <td>Mobile setup</td>
            <td>~$7/day (VM) + API</td>
          </tr>
          <tr>
            <td>@steve_yegge</td>
            <td>Gas Town</td>
            <td>Production</td>
            <td>"Multiple Claude accounts"</td>
          </tr>
          <tr>
            <td>Pro subscription</td>
            <td>Claude.ai</td>
            <td>Interactive</td>
            <td>$20/month</td>
          </tr>
        </tbody>
      </table>
    </div>

    <h3>Cost Reduction Case Study: Code Review Pipeline</h3>
    <pre><code>Unoptimized:
- Full codebase context: 100K tokens
- Opus for everything: $1.50/review
- 50 PRs/week = $75/week = $300/month

Optimized:
- Git diff only: 5K tokens
- Tiered: Haiku for lint, Sonnet for logic, Opus for architecture
- Prompt caching for instructions
- $0.05-0.10/review
- 50 PRs/week = $5/week = $20/month

Savings: 93% ($280/month)</code></pre>

    <hr class="section-divider">

    <!-- Cost Optimization Checklists -->
    <h2 id="checklists"><span class="bionic">Cos</span>t <span class="bionic">Opt</span>imization <span class="bionic">Che</span>cklists</h2>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">

      <div class="pattern-box">
        <h4 style="margin-top: 0;">Daily Optimization</h4>
        <ul style="margin-bottom: 0;">
          <li>Start with correct model for task (default: Sonnet)</li>
          <li>Use Claude HUD to monitor context usage</li>
          <li>Compact or reset before hitting 80% context</li>
          <li>Keep responses concise (set max_tokens limits)</li>
          <li>Stop VMs when not in use</li>
          <li>Check for early exit conditions</li>
        </ul>
      </div>

      <div class="pattern-box">
        <h4 style="margin-top: 0;">Weekly Review</h4>
        <ul style="margin-bottom: 0;">
          <li>Review Anthropic Console usage dashboard</li>
          <li>Identify most expensive sessions/tasks</li>
          <li>Consider batching for bulk work</li>
          <li>Update CLAUDE.md with learned patterns</li>
          <li>Evaluate if subscription tier is appropriate</li>
          <li>Archive completed PRD files</li>
        </ul>
      </div>

      <div class="pattern-box">
        <h4 style="margin-top: 0;">Per-Project Setup</h4>
        <ul style="margin-bottom: 0;">
          <li>Set up prompt caching for large system prompts</li>
          <li>Configure appropriate model defaults in CLAUDE.md</li>
          <li>Create cost-aware slash commands</li>
          <li>Set up subagent patterns for expensive tools</li>
          <li>Establish verification loops</li>
          <li>Define early exit conditions</li>
        </ul>
      </div>

      <div class="pattern-box">
        <h4 style="margin-top: 0;">Before Expensive Work</h4>
        <ul style="margin-bottom: 0;">
          <li>Is this the right model tier?</li>
          <li>Can this be parallelized with cheaper models?</li>
          <li>Is the task well-defined? (vague = expensive)</li>
          <li>Are verification steps in place?</li>
          <li>Is there an early exit condition?</li>
          <li>Has similar work been cached?</li>
        </ul>
      </div>
    </div>

    <hr class="section-divider">

    <!-- Advanced Strategies -->
    <h2 id="advanced"><span class="bionic">Adv</span>anced <span class="bionic">Str</span>ategies</h2>

    <h3>Dynamic Model Routing</h3>
    <p>Automatically select model based on task complexity. Start cheap, escalate on failure.</p>

    <h3>Semantic Caching</h3>
    <p>Cache semantically similar queries, not just exact matches.</p>

    <h3>Token Compression</h3>
    <p>Use structured formats (JSON) instead of prose for data-heavy prompts. Savings: 40-50%.</p>

    <hr class="section-divider">

    <!-- Summary -->
    <h2><span class="bionic">Top</span> 10 <span class="bionic">Cos</span>t <span class="bionic">Opt</span>imization <span class="bionic">Str</span>ategies</h2>

    <div class="comparison-table">
      <table>
        <thead>
          <tr>
            <th>Rank</th>
            <th>Strategy</th>
            <th>Potential Savings</th>
            <th>Effort</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>1</td><td><strong>Model selection</strong> (Haiku/Sonnet over Opus)</td><td style="color: var(--success);">60-95%</td><td>Low</td></tr>
          <tr><td>2</td><td><strong>Prompt caching</strong> for large system prompts</td><td style="color: var(--success);">90% on cached</td><td>Low</td></tr>
          <tr><td>3</td><td><strong>Batches API</strong> for bulk work</td><td style="color: var(--success);">50%</td><td>Medium</td></tr>
          <tr><td>4</td><td><strong>Output length limits</strong></td><td style="color: var(--success);">50-80%</td><td>Low</td></tr>
          <tr><td>5</td><td><strong>Subagent delegation</strong> for expensive tools</td><td style="color: var(--success);">50-70%</td><td>Medium</td></tr>
          <tr><td>6</td><td><strong>Fresh context</strong> (Ralph pattern)</td><td style="color: var(--success);">60-80%</td><td>Medium</td></tr>
          <tr><td>7</td><td><strong>Early exit conditions</strong></td><td style="color: var(--success);">30-40%</td><td>Low</td></tr>
          <tr><td>8</td><td><strong>Concise prompts</strong></td><td style="color: var(--success);">10-50%</td><td>Low</td></tr>
          <tr><td>9</td><td><strong>Context monitoring</strong> (Claude HUD)</td><td style="color: var(--success);">20-30%</td><td>Low</td></tr>
          <tr><td>10</td><td><strong>Model fallback cascade</strong></td><td style="color: var(--success);">40-60%</td><td>Medium</td></tr>
        </tbody>
      </table>
    </div>

    <hr class="section-divider">

    <!-- Philosophy -->
    <h2>The <span class="bionic">Phi</span>losophy: <span class="bionic">Cos</span>t as a <span class="bionic">Fea</span>ture</h2>

    <blockquote>
      <p>"If you care about costs, don't use this."</p>
      <footer>-- Steve Yegge on Gas Town</footer>
    </blockquote>

    <p>But for most of us, cost matters. The key is <strong>intentional spending</strong>:</p>

    <ol>
      <li><strong>Know your break-even:</strong> Developer time saved vs API cost</li>
      <li><strong>Right-size models:</strong> Don't use Opus where Haiku suffices</li>
      <li><strong>Invest in infrastructure:</strong> Caching, monitoring, batching pay dividends</li>
      <li><strong>Accept imperfection:</strong> Some rework is cheaper than over-engineering</li>
      <li><strong>Measure and iterate:</strong> Track costs, optimize what matters</li>
    </ol>

    <div class="recommendation">
      <strong>The winning formula:</strong>
      <pre style="margin: 0; background: transparent; border: none; padding: 8px 0 0 0;"><code>Fresh context + Tiered models + Early exit + Verification = Maximum value per dollar</code></pre>
    </div>

    <!-- Related Pages -->
    <div class="related-pages">
      <h3>Related Comparisons</h3>
      <ul>
        <li><a href="architecture.html">Agent Architecture Compared</a> - Single, Subagents, Swarm, Hierarchical</li>
        <li><a href="orchestration.html">Orchestration Approaches Compared</a> - Ralph, PRD-Ralph, CC Mirror, Gas Town</li>
        <li><a href="memory.html">Memory Approaches Compared</a> - progress.txt, Git, AGENTS.md, Claude-Mem</li>
        <li><a href="observability.html">Observability Patterns</a> - Monitoring, debugging, alerts</li>
      </ul>
    </div>

    <!-- Footer Navigation -->
    <nav class="footer-nav">
      <a href="memory.html">Previous: Memory Comparison</a>
      <a href="observability.html">Next: Observability Patterns</a>
    </nav>

  </div>

  
  <script src="../js/copy-code.js"></script>
</body>
</html>
