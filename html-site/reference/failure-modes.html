<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Failure Modes Catalog | Claude Code Reference</title>
  <link rel="stylesheet" href="../css/style.css">
  <style>
    /* Reference-specific styles */
    .search-box {
      width: 100%;
      padding: 16px 20px;
      font-size: 1.1em;
      border: 2px solid var(--border);
      border-radius: 12px;
      background: white;
      margin-bottom: 24px;
    }
    .search-box:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(42, 125, 125, 0.1);
    }
    .failure-category {
      margin: 32px 0;
    }
    .failure-category-title {
      background: var(--heading);
      color: white;
      padding: 16px 20px;
      border-radius: 12px 12px 0 0;
      margin: 0;
      font-size: 1.3em;
    }
    .failure-list {
      border: 1px solid var(--border);
      border-top: none;
      border-radius: 0 0 12px 12px;
    }
    .troubleshoot {
      border: none;
      border-bottom: 1px solid var(--border);
      margin: 0;
      border-radius: 0;
    }
    .troubleshoot:last-child {
      border-bottom: none;
      border-radius: 0 0 12px 12px;
    }
    .troubleshoot summary {
      background: white;
      padding: 16px 20px;
      cursor: pointer;
      color: var(--error);
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
      list-style: none;
    }
    .troubleshoot summary:hover {
      background: #fdf0ef;
    }
    .troubleshoot summary::-webkit-details-marker {
      display: none;
    }
    .troubleshoot summary::after {
      content: '+';
      font-size: 1.4em;
      color: var(--error);
      font-weight: 400;
    }
    .troubleshoot[open] summary::after {
      content: '-';
    }
    .troubleshoot[open] summary {
      border-bottom: 1px solid var(--border);
      background: #fdf0ef;
    }
    .troubleshoot-content {
      padding: 20px 24px;
      background: white;
    }
    .severity-badge {
      font-size: 0.7em;
      padding: 3px 8px;
      border-radius: 4px;
      text-transform: uppercase;
      font-weight: 600;
      margin-left: 12px;
    }
    .severity-critical {
      background: var(--error);
      color: white;
    }
    .severity-high {
      background: var(--warning);
      color: white;
    }
    .severity-medium {
      background: #ddd;
      color: #666;
    }
    .symptom-list {
      background: #fdf6e9;
      border-radius: 8px;
      padding: 16px 20px;
      margin: 16px 0;
    }
    .symptom-list-title {
      font-weight: 600;
      color: var(--warning);
      margin-bottom: 8px;
    }
    .recovery-steps {
      background: #eef6f0;
      border-left: 4px solid var(--success);
      padding: 16px 20px;
      border-radius: 0 8px 8px 0;
      margin: 16px 0;
    }
    .recovery-steps-title {
      font-weight: 600;
      color: var(--success);
      margin-bottom: 8px;
    }
    .prevention-box {
      background: #e8f4f4;
      border-left: 4px solid var(--accent);
      padding: 16px 20px;
      border-radius: 0 8px 8px 0;
      margin: 16px 0;
    }
    .prevention-box-title {
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 8px;
    }
    .quick-jump {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 20px 0;
    }
    .quick-jump a {
      background: var(--code-bg);
      padding: 8px 14px;
      border-radius: 6px;
      font-size: 0.9em;
      border: 1px solid var(--border);
    }
    .quick-jump a:hover {
      background: var(--accent);
      color: white;
      text-decoration: none;
      border-color: var(--accent);
    }
    .bionic { font-weight: 700; }
  </style>
</head>
<body>
  <div class="container">

    <nav class="nav-breadcrumb">
      <a href="../index.html">Home</a>
      <span>/</span>
      <a href="index.html">Reference</a>
      <span>/</span>
      Failure Modes
    </nav>

    <!-- You Are Here Context Box -->
    <div class="you-are-here" style="background: linear-gradient(135deg, #f0ebe3 0%, #fefcf3 100%); border-left: 4px solid #2a7d7d; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
      <h3 style="margin-top: 0; color: var(--accent);"><span class="bionic">You</span> Are <span class="bionic">Her</span>e</h3>
      <p><strong><span class="bionic">Sit</span>uation:</strong> Something broke, or you want to prevent failures before they happen.</p>
      <p><strong><span class="bionic">Thi</span>s page:</strong> A comprehensive, searchable catalog of every known Claude Code failure mode, with symptoms, causes, recovery steps, and prevention strategies.</p>
      <p><strong><span class="bionic">How</span> to use:</strong> Search for your error message, or browse by category. Each failure mode has expandable details with recovery steps.</p>
    </div>

    <h1><span class="bionic">Fai</span>lure <span class="bionic">Mod</span>es <span class="bionic">Cat</span>alog</h1>

    <p class="conversational-lead">
      <span class="bionic">Eve</span>rything that can go <span class="bionic">wro</span>ng, why it <span class="bionic">hap</span>pens, and how to <span class="bionic">rec</span>over. This is your <span class="bionic">eme</span>rgency reference.
    </p>

    <!-- Search Box -->
    <input type="text" class="search-box" id="failureSearch" placeholder="Search failures... (e.g., 'context', 'infinite loop', 'deleted files')">

    <!-- Quick Jump Navigation -->
    <div class="quick-jump">
      <a href="#context-window">Context Window</a>
      <a href="#orchestration">Orchestration</a>
      <a href="#memory-state">Memory/State</a>
      <a href="#verification">Verification</a>
      <a href="#security">Security</a>
      <a href="#cost">Cost/Resources</a>
      <a href="#ralph-loop">Ralph Loop</a>
      <a href="#multi-agent">Multi-Agent</a>
      <a href="#file-system">File System</a>
    </div>

    <hr class="section-divider">

    <!-- CATEGORY 1: Context Window Failures -->
    <div class="failure-category" id="context-window">
      <h2 class="failure-category-title">1. Context Window Failures</h2>
      <div class="failure-list">

        <details class="troubleshoot">
          <summary>
            Quality Degrades After 30+ Minutes
            <span class="severity-badge severity-high">High</span>
          </summary>
          <div class="troubleshoot-content">
            <div class="symptom-list">
              <div class="symptom-list-title">What You See</div>
              <ul>
                <li>Claude forgets earlier instructions</li>
                <li>Responses become generic or repetitive</li>
                <li>Errors start compounding</li>
                <li>Claude claims it did something it didn't</li>
                <li>CLAUDE.md directives being ignored</li>
                <li>Truncated code outputs (functions cut off mid-definition)</li>
              </ul>
            </div>

            <p><strong>Root Cause:</strong> Context window filled beyond 60-70% capacity. Performance degradation begins at this point.</p>

            <table>
              <tr><th>Context Level</th><th>Quality Impact</th></tr>
              <tr><td>0-50%</td><td>Full capability</td></tr>
              <tr><td>50-70%</td><td>Slight degradation possible</td></tr>
              <tr><td>70-85%</td><td>Noticeable quality loss</td></tr>
              <tr><td>85-95%</td><td>Significant degradation, instructions forgotten</td></tr>
              <tr><td>95%+</td><td>Failure mode - hallucinations, contradictions, amnesia</td></tr>
            </table>

            <div class="recovery-steps">
              <div class="recovery-steps-title">Recovery Steps</div>
              <ol>
                <li>Save current state to external files immediately</li>
                <li>Document what you were working on</li>
                <li>Run <code>/compact</code> if you want to try salvaging the session</li>
                <li>If quality doesn't improve, run <code>/reset</code> or start fresh session</li>
                <li>Load context from saved files</li>
              </ol>
            </div>

            <div class="prevention-box">
              <div class="prevention-box-title">Prevention</div>
              <ul>
                <li>Use Ralph pattern (fresh context each iteration)</li>
                <li>Keep sessions under 30 minutes for complex work</li>
                <li>Use external memory (prd.json, progress.txt)</li>
                <li>Run <code>/compact</code> proactively at 60-70% usage</li>
                <li>Monitor context with Claude HUD plugin</li>
              </ul>
            </div>

            <div class="gotcha-block">
              <strong>If you skip recovery:</strong> Errors compound exponentially. Each bad output feeds the next iteration, leading to circular revisions and wasted tokens.
            </div>
          </div>
        </details>

        <details class="troubleshoot">
          <summary>
            Claude References Files That Don't Exist
            <span class="severity-badge severity-critical">Critical</span>
          </summary>
          <div class="troubleshoot-content">
            <div class="symptom-list">
              <div class="symptom-list-title">What You See</div>
              <ul>
                <li>Claude claims to have read a file that doesn't exist</li>
                <li>File paths are fabricated or mixed up</li>
                <li>Claude describes contents that don't match the actual file</li>
              </ul>
            </div>

            <p><strong>Root Cause:</strong> Context exhaustion causing hallucinations. The model is filling gaps with training data patterns rather than actual file contents.</p>

            <pre><code># Verify the file exists
ls -la /path/to/claimed/file

# Compare Claude's description with actual contents
cat /path/to/file.ts | head -50</code></pre>

            <div class="recovery-steps">
              <div class="recovery-steps-title">Recovery Steps</div>
              <ol>
                <li><strong>STOP</strong> the current task immediately</li>
                <li>Do NOT commit any changes from this session</li>
                <li>Reset session: <code>/reset</code></li>
                <li>Re-read the actual files you need</li>
                <li>Continue with fresh context</li>
              </ol>
            </div>

            <div class="prevention-box">
              <div class="prevention-box-title">Prevention</div>
              <ul>
                <li>Always have Claude read files explicitly before working on them</li>
                <li>Don't rely on "as we discussed" or memory of previous reads</li>
                <li>Use explicit file references in prompts</li>
              </ul>
            </div>

            <div class="gotcha-block">
              <strong>If you skip recovery:</strong> Claude will continue building on false assumptions, creating code that references non-existent functions, types, or modules.
            </div>
          </div>
        </details>

        <details class="troubleshoot">
          <summary>
            API Error 400 / Context Limit Exceeded
            <span class="severity-badge severity-critical">Critical</span>
          </summary>
          <div class="troubleshoot-content">
            <div class="symptom-list">
              <div class="symptom-list-title">What You See</div>
              <ul>
                <li><code>API Error 400</code> messages</li>
                <li>Claude becomes "completely unusable"</li>
                <li>Requests fail to process</li>
              </ul>
            </div>

            <p><strong>Root Cause:</strong> Conversation has exceeded maximum context window (200K tokens).</p>

            <div class="recovery-steps">
              <div class="recovery-steps-title">Recovery Steps</div>
              <ol>
                <li>You cannot continue this session</li>
                <li>Save any uncommitted work: <code>git stash</code></li>
                <li>Exit Claude Code: <code>exit</code></li>
                <li>Start fresh session</li>
                <li>Load essential context only</li>
              </ol>
            </div>

            <div class="prevention-box">
              <div class="prevention-box-title">Prevention</div>
              <ul>
                <li>Never work more than 2-3 hours without fresh context</li>
                <li>Use Ralph pattern for long-running work</li>
                <li>Compact proactively, not reactively</li>
                <li>Use .claudeignore to exclude unnecessary files</li>
              </ul>
            </div>

            <div class="gotcha-block">
              <strong>If you skip recovery:</strong> The session is unrecoverable. Any continued attempts will fail with the same error.
            </div>
          </div>
        </details>

        <details class="troubleshoot">
          <summary>
            Compaction Lost Critical Instructions
            <span class="severity-badge severity-high">High</span>
          </summary>
          <div class="troubleshoot-content">
            <div class="symptom-list">
              <div class="symptom-list-title">What You See</div>
              <ul>
                <li>Post-compaction behavior changes</li>
                <li>Specific instructions no longer followed</li>
                <li>Context from early conversation lost</li>
                <li>Edge cases suddenly forgotten</li>
              </ul>
            </div>

            <p><strong>Root Cause:</strong> Compaction is lossy. The model must decide what's "important" without knowing your actual priorities.</p>

            <div class="recovery-steps">
              <div class="recovery-steps-title">Recovery Steps</div>
              <ol>
                <li>Re-state critical instructions explicitly</li>
                <li>Reference CLAUDE.md again if it contains the instructions</li>
                <li>If behavior is significantly degraded, start fresh session</li>
              </ol>
            </div>

            <div class="prevention-box">
              <div class="prevention-box-title">Prevention</div>
              <ul>
                <li>Maintain external state manually (reflection files, progress logs)</li>
                <li>Use explicit instruction files (CLAUDE.md) that survive compaction</li>
                <li>Compact proactively at 60-70% rather than waiting for auto-compact at 95%</li>
                <li>Review behavior immediately after compaction</li>
              </ul>
            </div>
          </div>
        </details>

        <details class="troubleshoot">
          <summary>
            Filling Context with Entire Codebase
            <span class="severity-badge severity-high">High</span>
          </summary>
          <div class="troubleshoot-content">
            <div class="symptom-list">
              <div class="symptom-list-title">What You See</div>
              <ul>
                <li>Claude reads thousands of files</li>
                <li>Context fills immediately</li>
                <li>No room left for actual work</li>
                <li>Simple tasks become impossible</li>
              </ul>
            </div>

            <p><strong>Root Cause:</strong> Over-eager exploration. "Read all files in src/" consumes entire context budget.</p>

            <pre><code># Count files that would be read
find src/ -type f | wc -l

# Estimate token count
find src/ -type f -exec cat {} \; | wc -c
# Divide by 4 for rough token estimate</code></pre>

            <div class="recovery-steps">
              <div class="recovery-steps-title">Recovery Steps</div>
              <ol>
                <li>Reset session immediately</li>
                <li>Be specific about which files to read</li>
                <li>Use targeted prompts: "Read src/index.ts and src/config.ts"</li>
              </ol>
            </div>

            <div class="prevention-box">
              <div class="prevention-box-title">.claudeignore Example</div>
              <pre><code>node_modules/
dist/
build/
.next/
.cache/
*.log
coverage/
__pycache__/
*.pyc
.git/</code></pre>
            </div>
          </div>
        </details>

      </div>
    </div>

    <!-- CATEGORY 2: Orchestration Failures -->
    <div class="failure-category" id="orchestration">
      <h2 class="failure-category-title">2. Orchestration Failures</h2>
      <div class="failure-list">

        <details class="troubleshoot">
          <summary>
            Workers Spawning Workers (Recursive Explosion)
            <span class="severity-badge severity-critical">Critical</span>
          </summary>
          <div class="troubleshoot-content">
            <div class="symptom-list">
              <div class="symptom-list-title">What You See</div>
              <ul>
                <li>Subagent depth exceeds 2-3 levels</li>
                <li>Context usage spikes unexpectedly</li>
                <li>Tasks taking 10x longer than expected</li>
                <li>Runaway API costs</li>
                <li>Agents lose sight of original task</li>
              </ul>
            </div>

            <p><strong>Root Cause:</strong> Workers not properly restricted. A worker agent spawns subagents, which spawn more subagents, creating exponential context explosion.</p>

            <div class="recovery-steps">
              <div class="recovery-steps-title">Recovery Steps</div>
              <ol>
                <li>Kill all Claude processes: <code>pkill -f claude</code></li>
                <li>Review what was actually accomplished</li>
                <li>Revert incomplete changes: <code>git checkout -- .</code></li>
                <li>Restart with proper worker preamble</li>
              </ol>
            </div>

            <div class="prevention-box">
              <div class="prevention-box-title">Worker Preamble Pattern</div>
              <pre><code>CONTEXT: You are a WORKER agent, not an orchestrator.

RULES:
- Complete ONLY the task described below
- Use tools directly (Read, Write, Edit, Bash, etc.)
- Do NOT spawn sub-agents
- Do NOT call TaskCreate or TaskUpdate
- Report your results with absolute file paths</code></pre>
            </div>

            <div class="gotcha-block">
              <strong>If you skip recovery:</strong> Costs will continue escalating. One documented case hit $47,000 from an 11-day recursive loop.
            </div>
          </div>
        </details>

        <details class="troubleshoot">
          <summary>
            Orchestrator Writing Code Directly
            <span class="severity-badge severity-high">High</span>
          </summary>
          <div class="troubleshoot-content">
            <div class="symptom-list">
              <div class="symptom-list-title">What You See</div>
              <ul>
                <li>Orchestrator gets distracted by implementation details</li>
                <li>Role confusion between planning and execution</li>
                <li>Scope creep within orchestrator context</li>
                <li>Orchestrator context filling with file contents</li>
              </ul>
            </div>

            <p><strong>Root Cause:</strong> Mixing concerns. The orchestrator should think at the coordination level, not get lost in file edits.</p>

            <div class="prevention-box">
              <div class="prevention-box-title">CC Mirror Principle</div>
              <pre><code>YOU DO NOT WRITE CODE. YOU DO NOT RUN COMMANDS.
YOU DO NOT EXPLORE CODEBASES.
You are the CONDUCTOR. Your agents play the instruments.</code></pre>
            </div>

            <table>
              <tr><th>Orchestrator Uses</th><th>Workers Use</th></tr>
              <tr><td>TaskCreate, TaskList, TaskGet, TaskUpdate</td><td>Read, Write, Edit, Bash</td></tr>
              <tr><td>AskUserQuestion, Task (to spawn workers)</td><td>Glob, Grep, WebFetch, WebSearch</td></tr>
              <tr><td>Read (references only, 1-2 max)</td><td>LSP</td></tr>
            </table>
          </div>
        </details>

        <details class="troubleshoot">
          <summary>
            Agents Run Indefinitely (No Completion Detection)
            <span class="severity-badge severity-high">High</span>
          </summary>
          <div class="troubleshoot-content">
            <div class="symptom-list">
              <div class="symptom-list-title">What You See</div>
              <ul>
                <li>Agents run for hours without completing</li>
                <li>API budget draining with no visible progress</li>
                <li>No clear stopping point</li>
                <li>Infinite loops consuming tokens</li>
              </ul>
            </div>

            <p><strong>Root Cause:</strong> No explicit completion criteria. Without knowing when to stop, agents have no way to know the task is done.</p>

            <div class="recovery-steps">
              <div class="recovery-steps-title">Recovery Steps</div>
              <ol>
                <li>Interrupt the loop: <code>Ctrl+C</code></li>
                <li>Force kill if needed: <code>pkill -9 -f claude</code></li>
                <li>Add completion signal to prompt</li>
                <li>Restart with proper termination conditions</li>
              </ol>
            </div>

            <div class="prevention-box">
              <div class="prevention-box-title">Completion Promise Pattern</div>
              <pre><code>if grep -q "&lt;promise&gt;COMPLETE&lt;/promise&gt;" output.txt; then
  echo "Done!"
  break
fi</code></pre>
              <p>Or use testable completion criteria:</p>
              <ul>
                <li>All PRD items have <code>passes: true</code></li>
                <li>Tests pass: <code>npm test</code> exits 0</li>
                <li>Build succeeds: <code>npm run build</code> exits 0</li>
              </ul>
            </div>
          </div>
        </details>

      </div>
    </div>

    <!-- CATEGORY 3: Memory/State Failures -->
    <div class="failure-category" id="memory-state">
      <h2 class="failure-category-title">3. Memory/State Failures</h2>
      <div class="failure-list">

        <details class="troubleshoot">
          <summary>
            Progress Lost Between Iterations
            <span class="severity-badge severity-high">High</span>
          </summary>
          <div class="troubleshoot-content">
            <div class="symptom-list">
              <div class="symptom-list-title">What You See</div>
              <ul>
                <li>Each iteration starts from scratch</li>
                <li>Learnings not carried forward</li>
                <li>Same mistakes repeated</li>
                <li>Patterns discovered but forgotten</li>
              </ul>
            </div>

            <p><strong>Root Cause:</strong> No external memory. State exists only in conversation context, which resets each iteration.</p>

            <div class="prevention-box">
              <div class="prevention-box-title">The Three Core Files</div>
              <ol>
                <li><strong>progress.txt</strong> - Append-only learning log</li>
                <li><strong>prd.json</strong> - Task state with <code>passes: true/false</code></li>
                <li><strong>CLAUDE.md</strong> - Project context and conventions</li>
              </ol>
            </div>
          </div>
        </details>

        <details class="troubleshoot">
          <summary>
            progress.txt Being Overwritten (Not Appended)
            <span class="severity-badge severity-medium">Medium</span>
          </summary>
          <div class="troubleshoot-content">
            <div class="symptom-list">
              <div class="symptom-list-title">What You See</div>
              <ul>
                <li>Previous entries disappearing</li>
                <li>Only most recent iteration preserved</li>
                <li>Historical context lost</li>
                <li>Patterns not compounding</li>
              </ul>
            </div>

            <p><strong>Root Cause:</strong> Agent updating instead of appending. The word "append" was not explicit enough in the prompt.</p>

            <div class="recovery-steps">
              <div class="recovery-steps-title">Recovery Steps</div>
              <ol>
                <li>Restore from git: <code>git checkout HEAD~1 -- progress.txt</code></li>
                <li>Add current iteration's learnings manually</li>
                <li>Update prompt to be explicit about appending</li>
              </ol>
            </div>

            <div class="prevention-box">
              <div class="prevention-box-title">Use Explicit Language</div>
              <pre><code>APPEND to progress.txt (never update or overwrite previous entries):</code></pre>
              <p><strong>Critical rule:</strong> APPEND ONLY. Never edit previous entries.</p>
            </div>
          </div>
        </details>

        <details class="troubleshoot">
          <summary>
            PRD Status Not Matching Reality
            <span class="severity-badge severity-high">High</span>
          </summary>
          <div class="troubleshoot-content">
            <div class="symptom-list">
              <div class="symptom-list-title">What You See</div>
              <ul>
                <li>Tasks marked <code>passes: true</code> but code is broken</li>
                <li>Tasks marked <code>passes: false</code> but actually working</li>
                <li>Agent confused about what's left to do</li>
                <li>Circular work on "completed" tasks</li>
              </ul>
            </div>

            <p><strong>Root Cause:</strong> PRD updates not tied to verification. Agent marked tasks complete without running tests.</p>

            <div class="prevention-box">
              <div class="prevention-box-title">Require Verification</div>
              <pre><code>"acceptanceCriteria": [
  "Feature implemented",
  "npm run typecheck passes",  // &lt;-- ALWAYS
  "npm run test passes"        // &lt;-- ALWAYS
]</code></pre>
            </div>
          </div>
        </details>

      </div>
    </div>

    <!-- CATEGORY 4: Verification Failures -->
    <div class="failure-category" id="verification">
      <h2 class="failure-category-title">4. Verification Failures</h2>
      <div class="failure-list">

        <details class="troubleshoot">
          <summary>
            Tests Pass But Shouldn't
            <span class="severity-badge severity-high">High</span>
          </summary>
          <div class="troubleshoot-content">
            <div class="symptom-list">
              <div class="symptom-list-title">What You See</div>
              <ul>
                <li>Claude reports tests pass</li>
                <li>But tests are broken, not running, or trivially passing</li>
                <li>Exit codes ignored</li>
                <li>Test framework not installed</li>
                <li>Tests in wrong directory</li>
              </ul>
            </div>

            <p><strong>Root Cause:</strong> Exit code not verified. Claude saw output and assumed success.</p>

            <div class="prevention-box">
              <div class="prevention-box-title">Always Verify Exit Code</div>
              <pre><code>npm test 2>&1 | tail -20
echo "Exit code: $?"</code></pre>
            </div>
          </div>
        </details>

        <details class="troubleshoot">
          <summary>
            Features Marked Complete Without Testing
            <span class="severity-badge severity-high">High</span>
          </summary>
          <div class="troubleshoot-content">
            <div class="symptom-list">
              <div class="symptom-list-title">What You See</div>
              <ul>
                <li>Tasks marked "done" without verification</li>
                <li>No test output in logs</li>
                <li>Features fail in production</li>
                <li>End-to-end paths broken</li>
              </ul>
            </div>

            <p><strong>Root Cause:</strong> Claude's tendency to optimistically mark features complete. "It compiles" is treated as "it works."</p>

            <blockquote>
              "Claude's tendency to mark features complete without proper testing... did much better at verifying end-to-end once explicitly prompted to use browser automation tools"
              <cite>- Anthropic</cite>
            </blockquote>

            <div class="prevention-box">
              <div class="prevention-box-title">Visual Verification</div>
              <pre><code>"acceptanceCriteria": [
  "Feature implemented",
  "Verify at localhost:3000/feature using Playwright screenshot",
  "npm run test passes with exit code 0"
]</code></pre>
            </div>
          </div>
        </details>

      </div>
    </div>

    <!-- CATEGORY 5: Security Failures -->
    <div class="failure-category" id="security">
      <h2 class="failure-category-title">5. Security Failures</h2>
      <div class="failure-list">

        <details class="troubleshoot">
          <summary>
            Catastrophic File Deletion
            <span class="severity-badge severity-critical">Critical</span>
          </summary>
          <div class="troubleshoot-content">
            <div class="symptom-list">
              <div class="symptom-list-title">What You See</div>
              <ul>
                <li>Entire directories deleted</li>
                <li>Home folder wiped</li>
                <li>Production database dropped</li>
                <li>Critical files gone</li>
              </ul>
            </div>

            <p><strong>Documented incidents:</strong></p>
            <ul>
              <li><code>rm -rf tests/ patches/ plan/ ~/</code> - Deleted user's entire home folder</li>
              <li><code>rmdir /s /q d:\</code> - Deleted entire D: drive</li>
              <li>Replit deleting production database with 1,200+ executives' data</li>
            </ul>

            <p><strong>Root Cause:</strong> <code>--dangerously-skip-permissions</code> used without safeguards. No blocklist for destructive commands.</p>

            <div class="recovery-steps">
              <div class="recovery-steps-title">Recovery Steps</div>
              <ol>
                <li><strong>STOP</strong> - Do not continue the session</li>
                <li>Check backups immediately</li>
                <li>For git-tracked files: <code>git checkout -- .</code></li>
                <li>For untracked files: Check Time Machine / backup</li>
                <li>For databases: Restore from backup</li>
              </ol>
            </div>

            <div class="prevention-box">
              <div class="prevention-box-title">NEVER Whitelist These Commands</div>
              <ul>
                <li><code>rm -rf</code></li>
                <li><code>sudo *</code></li>
                <li><code>git push --force</code></li>
                <li><code>git reset --hard</code></li>
                <li><code>find . -delete</code></li>
              </ul>
            </div>

            <div class="gotcha-block">
              <strong>If you skip recovery:</strong> Data loss is permanent. There is no "undo" for deleted files outside version control.
            </div>
          </div>
        </details>

        <details class="troubleshoot">
          <summary>
            Credentials Exposed in Context
            <span class="severity-badge severity-critical">Critical</span>
          </summary>
          <div class="troubleshoot-content">
            <div class="symptom-list">
              <div class="symptom-list-title">What You See</div>
              <ul>
                <li>API keys visible in conversation</li>
                <li>Passwords in logs</li>
                <li><code>.env</code> contents displayed</li>
                <li>Secrets in git history</li>
              </ul>
            </div>

            <p><strong>Root Cause:</strong> No <code>.claudeignore</code>. Sensitive files readable by Claude.</p>

            <div class="recovery-steps">
              <div class="recovery-steps-title">Recovery Steps</div>
              <ol>
                <li>Rotate ALL exposed credentials immediately</li>
                <li>Remove secrets from git history: <code>git filter-branch</code></li>
                <li>Add files to .claudeignore</li>
                <li>Never cat .env in Claude Code</li>
              </ol>
            </div>

            <div class="prevention-box">
              <div class="prevention-box-title">Required .claudeignore</div>
              <pre><code>.env*
*.pem
*.key
credentials.json
secrets/
.aws/
.ssh/
*.keychain</code></pre>
            </div>
          </div>
        </details>

      </div>
    </div>

    <!-- CATEGORY 6: Cost/Resource Failures -->
    <div class="failure-category" id="cost">
      <h2 class="failure-category-title">6. Cost/Resource Failures</h2>
      <div class="failure-list">

        <details class="troubleshoot">
          <summary>
            $500+ Bill for Simple Feature
            <span class="severity-badge severity-critical">Critical</span>
          </summary>
          <div class="troubleshoot-content">
            <div class="symptom-list">
              <div class="symptom-list-title">What You See</div>
              <ul>
                <li>API costs far exceed expectations</li>
                <li>Token usage in millions</li>
                <li>Budget blown in hours</li>
                <li>"Expensive as hell" outcomes</li>
              </ul>
            </div>

            <p><strong>Documented incidents:</strong></p>
            <ul>
              <li>$47,000 from 11-day recursive loop</li>
              <li>3.2 million tokens on circular revisions</li>
              <li>$500+ bills on simple features</li>
            </ul>

            <div class="recovery-steps">
              <div class="recovery-steps-title">Recovery Steps</div>
              <ol>
                <li>Kill all Claude processes: <code>pkill -f claude</code></li>
                <li>Check Anthropic dashboard immediately</li>
                <li>Set hard budget limits</li>
                <li>Review what caused high usage</li>
              </ol>
            </div>

            <div class="prevention-box">
              <div class="prevention-box-title">Always Set Limits</div>
              <pre><code># Always set iteration limits
MAX_ITERATIONS=${1:-25}

# Use timeouts
timeout 3600 ./ralph.sh 50  # 1 hour max</code></pre>
            </div>

            <table>
              <tr><th>Model</th><th>Input</th><th>Output</th><th>Relative Cost</th></tr>
              <tr><td>Haiku</td><td>$0.25/1M</td><td>$1.25/1M</td><td>1x</td></tr>
              <tr><td>Sonnet</td><td>$3/1M</td><td>$15/1M</td><td>12x</td></tr>
              <tr><td>Opus</td><td>$15/1M</td><td>$75/1M</td><td>60x</td></tr>
            </table>
          </div>
        </details>

        <details class="troubleshoot">
          <summary>
            Rate Limit Errors
            <span class="severity-badge severity-medium">Medium</span>
          </summary>
          <div class="troubleshoot-content">
            <div class="symptom-list">
              <div class="symptom-list-title">What You See</div>
              <ul>
                <li><code>rate_limit</code> errors</li>
                <li>API requests rejected</li>
                <li>Agent stuck waiting</li>
                <li>Workflow blocked</li>
              </ul>
            </div>

            <p><strong>Root Cause:</strong> Exceeding API rate limits. Heavy automation, account sharing, or 24/7 operation.</p>

            <div class="prevention-box">
              <div class="prevention-box-title">Rate Limit Handling</div>
              <pre><code>RATE_LIMIT_SLEEP=5

if grep -q "rate_limit" output.txt; then
  echo "Rate limited, waiting..."
  sleep 60
fi

sleep $RATE_LIMIT_SLEEP  # Always pause between iterations</code></pre>
            </div>
          </div>
        </details>

      </div>
    </div>

    <!-- CATEGORY 7: Ralph Loop Failures -->
    <div class="failure-category" id="ralph-loop">
      <h2 class="failure-category-title">7. Ralph Loop Failures</h2>
      <div class="failure-list">

        <details class="troubleshoot">
          <summary>
            Completion Promise Never Found
            <span class="severity-badge severity-high">High</span>
          </summary>
          <div class="troubleshoot-content">
            <div class="symptom-list">
              <div class="symptom-list-title">What You See</div>
              <ul>
                <li>Loop runs to max iterations every time</li>
                <li>Tasks are actually complete but loop continues</li>
                <li>Massive token consumption</li>
                <li>Never terminates naturally</li>
              </ul>
            </div>

            <p><strong>Root Cause:</strong> Completion promise either not outputted by Claude or not detected by script.</p>

            <div class="prevention-box">
              <div class="prevention-box-title">Fix</div>
              <ul>
                <li>Ensure completion promise format is exact: <code>&lt;promise&gt;COMPLETE&lt;/promise&gt;</code></li>
                <li>Test detection pattern before running overnight</li>
                <li>Include timeout as safety: <code>timeout 3600 ./ralph.sh 50</code></li>
              </ul>
            </div>
          </div>
        </details>

        <details class="troubleshoot">
          <summary>
            Stuck Loop (Same Commit for 3+ Iterations)
            <span class="severity-badge severity-medium">Medium</span>
          </summary>
          <div class="troubleshoot-content">
            <div class="symptom-list">
              <div class="symptom-list-title">What You See</div>
              <ul>
                <li>No new commits for multiple iterations</li>
                <li>Same task being worked on repeatedly</li>
                <li>Agent making no visible progress</li>
                <li>Token consumption without output</li>
              </ul>
            </div>

            <p><strong>Root Cause:</strong> Task is blocked, broken, or has unsatisfiable criteria.</p>

            <div class="recovery-steps">
              <div class="recovery-steps-title">Recovery Steps</div>
              <ol>
                <li>Set <code>passes: false</code> on problematic story</li>
                <li>Add notes field with context about what's blocking</li>
                <li>Reduce acceptance criteria scope</li>
                <li>Consider manual intervention to unblock</li>
              </ol>
            </div>

            <div class="prevention-box">
              <div class="prevention-box-title">Stuck Detection Script</div>
              <pre><code>STUCK_THRESHOLD=3
LAST_COMMIT=""
STUCK_COUNT=0

CURRENT_COMMIT=$(git rev-parse HEAD 2>/dev/null)

if [ "$CURRENT_COMMIT" = "$LAST_COMMIT" ]; then
  STUCK_COUNT=$((STUCK_COUNT + 1))
  if [ $STUCK_COUNT -ge $STUCK_THRESHOLD ]; then
    echo "WARNING: Stuck for $STUCK_COUNT iterations"
    exit 1
  fi
else
  STUCK_COUNT=0
  LAST_COMMIT=$CURRENT_COMMIT
fi</code></pre>
            </div>
          </div>
        </details>

      </div>
    </div>

    <!-- CATEGORY 8: Multi-Agent Failures -->
    <div class="failure-category" id="multi-agent">
      <h2 class="failure-category-title">8. Multi-Agent Coordination Failures</h2>
      <div class="failure-list">

        <details class="troubleshoot">
          <summary>
            Merge Conflicts Between Parallel Agents
            <span class="severity-badge severity-high">High</span>
          </summary>
          <div class="troubleshoot-content">
            <div class="symptom-list">
              <div class="symptom-list-title">What You See</div>
              <ul>
                <li>Git conflicts at merge time</li>
                <li>File corruption</li>
                <li>Race conditions on shared files</li>
                <li>Work overwritten</li>
              </ul>
            </div>

            <blockquote>
              "If both agents work on the same file, all hell breaks loose. They'll overwrite each other's edits and manipulate the other agent's context."
            </blockquote>

            <div class="prevention-box">
              <div class="prevention-box-title">Use Git Worktrees</div>
              <pre><code># Worktree isolation
git worktree add ../wt-feature1 feature1-branch
git worktree add ../wt-feature2 feature2-branch</code></pre>
            </div>
          </div>
        </details>

        <details class="troubleshoot">
          <summary>
            Error Amplification (17x in Independent Agents)
            <span class="severity-badge severity-critical">Critical</span>
          </summary>
          <div class="troubleshoot-content">
            <div class="symptom-list">
              <div class="symptom-list-title">What You See</div>
              <ul>
                <li>Small errors multiply across agents</li>
                <li>Downstream decisions based on bad data</li>
                <li>4.4x to 17.2x error amplification</li>
                <li>Quality collapse</li>
              </ul>
            </div>

            <p><strong>Root Cause:</strong> Independent agents amplify errors because they don't share context for error correction. Research shows "independent agents amplify errors 17.2x, while centralized coordination contains this to 4.4x."</p>

            <div class="prevention-box">
              <div class="prevention-box-title">Use Centralized Coordination</div>
              <ul>
                <li>Use hub-and-spoke (CC Mirror) over fully decentralized</li>
                <li>Add verification at every handoff point</li>
                <li>Implement "circuit breakers" for error detection</li>
              </ul>
            </div>
          </div>
        </details>

      </div>
    </div>

    <!-- CATEGORY 9: File System Failures -->
    <div class="failure-category" id="file-system">
      <h2 class="failure-category-title">9. File System Failures</h2>
      <div class="failure-list">

        <details class="troubleshoot">
          <summary>
            Infinite Loop in Compaction (Bug)
            <span class="severity-badge severity-critical">Critical</span>
          </summary>
          <div class="troubleshoot-content">
            <div class="symptom-list">
              <div class="symptom-list-title">What You See</div>
              <ul>
                <li>Claude stuck attempting to "compact" conversations</li>
                <li>No progress on any task</li>
                <li>System basically unusable</li>
                <li>Cannot complete multi-step tasks</li>
              </ul>
            </div>

            <p><strong>Root Cause:</strong> Claude Code v1.0.83 bug causing infinite compaction attempts. (GitHub Issue #6004)</p>

            <div class="recovery-steps">
              <div class="recovery-steps-title">Recovery Steps</div>
              <ol>
                <li>Force kill: <code>pkill -9 -f claude</code></li>
                <li>Update Claude Code to latest version</li>
                <li>Restart with fresh session</li>
              </ol>
            </div>
          </div>
        </details>

        <details class="troubleshoot">
          <summary>
            200GB+ Disk Usage from Debug Logs
            <span class="severity-badge severity-high">High</span>
          </summary>
          <div class="troubleshoot-content">
            <div class="symptom-list">
              <div class="symptom-list-title">What You See</div>
              <ul>
                <li>Disk space filling rapidly</li>
                <li><code>.claude/debug</code> directory massive</li>
                <li>Individual files 20GB+</li>
                <li>System slowdown</li>
              </ul>
            </div>

            <p><strong>Root Cause:</strong> Performance monitoring infinite recursive logging loop. (GitHub Issue #16093 - "42GB from just 481 conversations over 7 days")</p>

            <div class="recovery-steps">
              <div class="recovery-steps-title">Recovery Steps</div>
              <ol>
                <li>Delete debug logs: <code>rm -rf ~/.claude/debug/*</code></li>
                <li>Update Claude Code</li>
                <li>Monitor disk usage</li>
              </ol>
            </div>

            <pre><code># Check debug directory size
du -sh ~/.claude/debug/

# Find large files
find ~/.claude/debug -size +1G</code></pre>
          </div>
        </details>

      </div>
    </div>

    <hr class="section-divider">

    <!-- Golden Rules -->
    <div class="recommendation">
      <h3 style="margin-top: 0;">The Golden Rules of Failure Prevention</h3>
      <ol>
        <li><strong>Fresh context beats extended sessions.</strong> When in doubt, start over.</li>
        <li><strong>External state beats internal memory.</strong> If it's not in a file, it doesn't exist.</li>
        <li><strong>Verification is non-negotiable.</strong> If you can't test it, don't mark it done.</li>
        <li><strong>Iteration limits are insurance.</strong> Always set max iterations.</li>
        <li><strong>Model matching saves money.</strong> Haiku for lookups, Sonnet for code, Opus for architecture.</li>
        <li><strong>Isolation prevents chaos.</strong> Worktrees for parallel agents.</li>
        <li><strong>Permissions prevent disasters.</strong> Blocklist destructive commands.</li>
        <li><strong>Backups save careers.</strong> Git commit often. Stash before experiments.</li>
      </ol>
    </div>

    <!-- Related Pages -->
    <div class="related-pages">
      <h3>Related Reference Pages</h3>
      <ul>
        <li><a href="war-stories.html">War Stories</a> - Real-world production incidents</li>
        <li><a href="edge-cases.html">Edge Cases</a> - Platform-specific issues and anti-patterns</li>
        <li><a href="cost-analysis.html">Cost Analysis</a> - Token economics and optimization</li>
      </ul>
    </div>

    <!-- Footer Navigation -->
    <div class="footer-nav">
      <a href="../index.html">Back to Home</a>
      <a href="war-stories.html">Next: War Stories</a>
    </div>

  </div>

  <script>
    // Simple search functionality
    document.getElementById('failureSearch').addEventListener('input', function(e) {
      const query = e.target.value.toLowerCase();
      const categories = document.querySelectorAll('.failure-category');

      categories.forEach(category => {
        const failures = category.querySelectorAll('.troubleshoot');
        let hasMatch = false;

        failures.forEach(failure => {
          const text = failure.textContent.toLowerCase();
          if (text.includes(query) || query === '') {
            failure.style.display = 'block';
            hasMatch = true;
          } else {
            failure.style.display = 'none';
          }
        });

        // Hide category if no matches
        if (!hasMatch && query !== '') {
          category.style.display = 'none';
        } else {
          category.style.display = 'block';
        }
      });
    });
  </script>
  <script src="../js/copy-code.js"></script>
</body>
</html>
