<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orchestration Patterns - Claude Code Knowledge Base</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div class="container">
        <nav class="nav-breadcrumb">
            <a href="../index.html">Home</a>
            <span>/</span>
            <a href="orchestration-master.html">Extractions</a>
            <span>/</span>
            Orchestration Patterns
        </nav>

        <h1><span class="bionic">Orc</span>hestration <span class="bionic">Pat</span>terns</h1>

        <div class="you-are-here">
            <strong>You Are Here:</strong> This page consolidates all orchestration patterns for running Claude Code at scale. These patterns represent the evolution from single-session usage to autonomous agent factories. Start with Ralph if you're new, then explore CC Mirror for native orchestration, and Gas Town for the factory vision.
        </div>

        <nav class="toc">
            <div class="toc-title">Table of Contents</div>
            <ul>
                <li><a href="#ralph">Ralph Wiggum Loop Pattern</a></li>
                <li><a href="#cc-mirror">CC Mirror - Native Orchestration</a></li>
                <li><a href="#gas-town">Gas Town - Agent Factory</a></li>
                <li><a href="#multi-agent">Multi-Agent Coordination</a></li>
                <li><a href="#panopticon">Personal Panopticon</a></li>
                <li><a href="#task-decomposition">Task Decomposition Patterns</a></li>
            </ul>
        </nav>

        <hr class="section-divider">

        <section id="ralph">
            <h2><span class="bionic">Ral</span>ph Wiggum <span class="bionic">Lo</span>op Pattern</h2>

            <div class="pattern-box">
                <div class="pattern-title">The Core Loop</div>
                <div class="pattern-subtitle">Origin: Geoffrey Huntley, evolved by Ryan Carson, Matt Pocock</div>
                <pre><code>while :; do cat PROMPT.md | claude-code ; done</code></pre>
                <p>Claude iterates autonomously until it finds a "completion promise" in the codebase, then exits. Each loop starts with fresh context, using external files for state persistence.</p>
            </div>

            <h3><span class="bionic">Wh</span>y It Works</h3>
            <ul>
                <li><strong>Fresh context per iteration:</strong> Avoids context rot from long sessions</li>
                <li><strong>External state persistence:</strong> PRD.json, progress.txt, git history carry continuity</li>
                <li><strong>Goal-conditioned autonomy:</strong> Runs until verifiable completion criteria met</li>
                <li><strong>Self-healing:</strong> Failed iterations restart clean</li>
            </ul>

            <h3><span class="bionic">Fil</span>e Structure</h3>
            <div class="file-listing">
                <div class="file-listing-header">Ralph Project Structure</div>
                <div class="file-item">
                    <span class="file-name">PROMPT.md</span>
                    <span class="file-desc">Static instructions piped to each iteration</span>
                </div>
                <div class="file-item">
                    <span class="file-name">prd.json</span>
                    <span class="file-desc">Dynamic task state with passes: true/false</span>
                </div>
                <div class="file-item">
                    <span class="file-name">progress.txt</span>
                    <span class="file-desc">Append-only learning log</span>
                </div>
                <div class="file-item">
                    <span class="file-name">.claude/hooks/stop-hook.sh</span>
                    <span class="file-desc">Loop continuation logic</span>
                </div>
            </div>

            <h3><span class="bionic">Imp</span>lementation Variants</h3>

            <details>
                <summary>Basic Ralph (10 minutes)</summary>
                <div>
                    <pre><code># Create project structure
mkdir ralph-project && cd ralph-project
git init

# Create PROMPT.md
cat > PROMPT.md << 'EOF'
# Project: [Your Project Name]

## Completion Promise
When you see this file exists: COMPLETE.md
Exit with: "COMPLETE - All tasks finished"

## Tasks
1. [Your first task]
2. [Your second task]

## Rules
- Commit after each task
- Update progress.txt with learnings
- Run tests before marking complete
EOF

# Run the loop
while :; do cat PROMPT.md | claude-code ; done</code></pre>
                </div>
            </details>

            <details>
                <summary>Production Ralph (30 minutes)</summary>
                <div>
                    <pre><code># prd.json structure
{
  "project": "Feature Implementation",
  "completion_file": "COMPLETE.md",
  "tasks": [
    {"id": 1, "desc": "Create user model", "passes": false},
    {"id": 2, "desc": "Add authentication", "passes": false},
    {"id": 3, "desc": "Write tests", "passes": false}
  ],
  "constraints": {
    "max_iterations": 50,
    "test_command": "npm test",
    "typecheck_command": "npm run typecheck"
  }
}

# Enhanced loop with iteration limit
ITER=0
while [ $ITER -lt 50 ] && [ ! -f COMPLETE.md ]; do
  cat PROMPT.md | claude-code
  ITER=$((ITER + 1))
  echo "Iteration $ITER complete" >> progress.txt
done</code></pre>
                </div>
            </details>

            <div class="callout callout-warning">
                <div class="callout-title">Gotcha: Token Burn</div>
                <p>Ralph loops without good planning burn tokens on brute force. Invest upfront in clear PRD structure and task decomposition.</p>
            </div>

            <div class="related-pages">
                <h4>Key Sources</h4>
                <ul>
                    <li>Geoffrey Huntley - Original Ralph concept (ghuntley.com/ralph/)</li>
                    <li>Ryan Carson - Production implementation details</li>
                    <li>Matt Pocock - Video breakdowns and refinements</li>
                    <li>Arvid Kahl - Comprehensive guide</li>
                </ul>
            </div>
        </section>

        <hr class="section-divider">

        <section id="cc-mirror">
            <h2><span class="bionic">CC</span> Mirror - <span class="bionic">Nat</span>ive Orchestration</h2>

            <div class="pattern-box">
                <div class="pattern-title">The Hidden Feature</div>
                <div class="pattern-subtitle">Author: Numman Ali (@nummanali)</div>
                <p>Claude Code has native multi-agent orchestration hidden behind a feature flag. CC Mirror unlocks this by mirroring the skill structure and configuration patterns that enable it.</p>
            </div>

            <h3><span class="bionic">Wh</span>at CC Mirror Enables</h3>
            <ul>
                <li><strong>Native subagent spawning:</strong> Claude can launch parallel agents</li>
                <li><strong>Context isolation:</strong> Each subagent has clean context</li>
                <li><strong>Result aggregation:</strong> Parent collects and synthesizes outputs</li>
                <li><strong>Skill-based routing:</strong> Tasks routed to specialized agents</li>
            </ul>

            <h3><span class="bionic">Arc</span>hitecture</h3>
            <div class="ascii-diagram">
┌─────────────────────────────────────────────────┐
│  Main Claude Session (Orchestrator)              │
│  ├── Task Analysis                               │
│  ├── Decomposition into subtasks                 │
│  └── Spawns subagents                            │
└─────────────────────────────────────────────────┘
              │
    ┌─────────┼─────────┐
    ▼         ▼         ▼
┌───────┐ ┌───────┐ ┌───────┐
│Agent 1│ │Agent 2│ │Agent 3│
│(skill)│ │(skill)│ │(skill)│
└───────┘ └───────┘ └───────┘
    │         │         │
    └─────────┼─────────┘
              ▼
┌─────────────────────────────────────────────────┐
│  Result Aggregation & Synthesis                  │
└─────────────────────────────────────────────────┘
            </div>

            <h3><span class="bionic">Set</span>up</h3>
            <pre><code># Clone CC Mirror
git clone https://github.com/numman-ali/cc-mirror

# Copy skill structure to your project
cp -r cc-mirror/.claude/skills ~/.claude/

# Configure settings
# Add to ~/.claude/settings.json:
{
  "orchestration": {
    "enabled": true,
    "maxParallelAgents": 5
  }
}</code></pre>

            <div class="callout callout-insight">
                <div class="callout-title">Key Insight</div>
                <p>CC Mirror doesn't add new capabilities - it unlocks what's already there. Anthropic built multi-agent orchestration but gated it. CC Mirror provides the configuration to enable it.</p>
            </div>

            <div class="comparison-table">
                <table>
                    <thead>
                        <tr>
                            <th>Aspect</th>
                            <th>Without CC Mirror</th>
                            <th>With CC Mirror</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Multi-agent</td>
                            <td>Manual tmux sessions</td>
                            <td>Native orchestration</td>
                        </tr>
                        <tr>
                            <td>Context isolation</td>
                            <td>Manual worktrees</td>
                            <td>Automatic per agent</td>
                        </tr>
                        <tr>
                            <td>Result aggregation</td>
                            <td>Manual merge</td>
                            <td>Automatic synthesis</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <hr class="section-divider">

        <section id="gas-town">
            <h2><span class="bionic">Gas</span> Town - <span class="bionic">Age</span>nt Factory</h2>

            <div class="pattern-box">
                <div class="pattern-title">The Factory Vision</div>
                <div class="pattern-subtitle">Author: Steve Yegge (@steve_yegge)</div>
                <blockquote>"Claude Code is the world's biggest fuckin' ant. Everyone is focused on making their ant run longer... when nature prefers colonies."</blockquote>
            </div>

            <h3><span class="bionic">Gas</span> Town Architecture</h3>
            <div class="ascii-diagram">
┌─────────────────────────────────────────────────────────┐
│  THE MAYOR (Orchestrator)                                │
│  └── Takes natural language feature requests             │
└─────────────────────────────────────────────────────────┘
              │
              ▼
┌─────────────────────────────────────────────────────────┐
│  THE DEACON (Spec Creator)                               │
│  └── Transforms requests into structured specs           │
└─────────────────────────────────────────────────────────┘
              │
              ▼
┌─────────────────────────────────────────────────────────┐
│  THE DOGS (Workers)                                      │
│  ├── Pick up Beads (tasks) from queue                   │
│  ├── Execute implementation                              │
│  └── Submit completed work                               │
└─────────────────────────────────────────────────────────┘
              │
              ▼
┌─────────────────────────────────────────────────────────┐
│  THE REFINERY (Quality Control)                          │
│  └── Reviews, tests, approves or rejects                 │
└─────────────────────────────────────────────────────────┘
            </div>

            <h3><span class="bionic">Key</span> Concepts</h3>

            <div class="card-grid">
                <div class="card">
                    <div class="card-title">Beads</div>
                    <div class="card-description">Atomic task units. JSON specs describing one piece of work with clear acceptance criteria.</div>
                </div>
                <div class="card">
                    <div class="card-title">Idea Compiler</div>
                    <div class="card-description">Gas Town as a whole - you input ideas, it outputs working software.</div>
                </div>
                <div class="card">
                    <div class="card-title">Desire Paths</div>
                    <div class="card-description">Watch what agents try to do, then make those paths real. Emergent behavior over top-down design.</div>
                </div>
            </div>

            <h3><span class="bionic">Phi</span>losophy</h3>
            <ul>
                <li><strong>Throughput over perfection:</strong> Some bugs fixed 2-3 times. That's fine.</li>
                <li><strong>Human as PM:</strong> You think about features, AI thinks about implementation.</li>
                <li><strong>Boring technology advantage:</strong> Go > TypeScript for AI-generated code readability.</li>
                <li><strong>Colonies over individuals:</strong> Many specialized agents > one powerful agent.</li>
            </ul>

            <div class="callout callout-danger">
                <div class="callout-title">Prerequisite</div>
                <p>Gas Town is Stage 8 tooling. If you have any doubt about running parallel agents at scale, you're not ready. Master Stages 5-7 first.</p>
            </div>
        </section>

        <hr class="section-divider">

        <section id="multi-agent">
            <h2><span class="bionic">Mul</span>ti-Agent <span class="bionic">Coo</span>rdination</h2>

            <div class="problem-statement">
                Multi-agent systems fail at rates between 41-86.7% in production. Specification problems (41.77%) and coordination failures (36.94%) cause nearly 79% of all breakdowns.
            </div>

            <h3><span class="bionic">Pra</span>ctical Patterns</h3>

            <h4>Git Worktrees for Isolation</h4>
            <pre><code># Create isolated workspaces for parallel agents
git worktree add ../project-feature-auth feature/auth
git worktree add ../project-feature-ui feature/ui

# Each agent works in its own worktree
# No conflicts, no overwrites
# Merge when ready</code></pre>

            <h4>tmux Multi-Session Layout</h4>
            <pre><code>#!/bin/bash
# create-agent-layout.sh
SESSION="agents"

tmux new-session -d -s $SESSION -n "agent-1"
for i in {2..6}; do
  tmux new-window -t $SESSION -n "agent-$i"
done

# Use rpai for monitoring
cargo install rpai
rpai  # TUI dashboard for all agents</code></pre>

            <h3><span class="bionic">Coo</span>rdination Patterns</h3>
            <table>
                <thead>
                    <tr>
                        <th>Pattern</th>
                        <th>Use When</th>
                        <th>Risk</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Independent Workers</td>
                        <td>Tasks have no dependencies</td>
                        <td>Error amplification (17.2x)</td>
                    </tr>
                    <tr>
                        <td>Centralized Coordinator</td>
                        <td>Tasks need sequencing</td>
                        <td>Bottleneck, single point of failure</td>
                    </tr>
                    <tr>
                        <td>Pipeline</td>
                        <td>Output of one feeds next</td>
                        <td>Blocking, cascade failures</td>
                    </tr>
                    <tr>
                        <td>Adversarial Review</td>
                        <td>Need quality validation</td>
                        <td>Slower, higher cost</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <hr class="section-divider">

        <section id="panopticon">
            <h2><span class="bionic">Per</span>sonal Panopticon</h2>

            <div class="pattern-box">
                <div class="pattern-title">The Life Operating System</div>
                <div class="pattern-subtitle">Author: Molly Cantillon (@mollycantillon)</div>
                <blockquote>"The feeling is hard to name. It is the violent gap between how blind you were and how obvious everything feels now with an observer that reads all the feeds, catches what you've unconsciously dropped, notices patterns across domains you'd kept stubbornly separate, and—crucially—tells you what to do about it."</blockquote>
            </div>

            <h3><span class="bionic">Arc</span>hitecture</h3>
            <pre><code>~/
├── finances/         # Financial agent domain
│   ├── CLAUDE.md     # Domain-specific context
│   └── data/         # Bank feeds, transactions
├── health/           # Health agent domain
│   ├── CLAUDE.md
│   └── data/         # WHOOP, health logs
├── work/             # Work agent domain
│   ├── CLAUDE.md
│   └── data/         # Calendar, tasks
└── relationships/    # Relationships domain
    ├── CLAUDE.md
    └── data/         # Contact logs, reminders</code></pre>

            <h3><span class="bionic">Key</span> Principles</h3>
            <ul>
                <li><strong>Domain isolation:</strong> Each life area runs independently</li>
                <li><strong>Cross-domain synthesis:</strong> Patterns emerge across domains</li>
                <li><strong>Regular briefs:</strong> Agents produce actionable summaries</li>
                <li><strong>Meta-level preservation:</strong> Keep judgment above the system</li>
            </ul>

            <div class="callout callout-warning">
                <div class="callout-title">Goodhart Warning</div>
                <p>"When WHOOP says recovered but you feel like death—notice the gap. Keep a 'meta-level outside the system' that can argue with the brief. Be ready to delete ~/health tomorrow if it stops serving."</p>
            </div>
        </section>

        <hr class="section-divider">

        <section id="task-decomposition">
            <h2><span class="bionic">Tas</span>k Decomposition</h2>

            <h3><span class="bionic">The</span> 8 Core Principles</h3>
            <ol>
                <li><strong>Context as constraint:</strong> More context isn't always better</li>
                <li><strong>External state over internal memory:</strong> Files > conversation history</li>
                <li><strong>Fresh context per iteration:</strong> Reset beats accumulation</li>
                <li><strong>Verification as quality multiplier:</strong> Build tests into workflow</li>
                <li><strong>Specification as artifact:</strong> PRD outlives code</li>
                <li><strong>Breadth for AI, depth for human:</strong> AI explores options, human chooses</li>
                <li><strong>Kanban over phases:</strong> Flexible task boards beat rigid plans</li>
                <li><strong>Compounding knowledge:</strong> Update CLAUDE.md after learning</li>
            </ol>

            <h3><span class="bionic">Tas</span>k Sizing</h3>
            <table>
                <thead>
                    <tr>
                        <th>Size</th>
                        <th>Iterations</th>
                        <th>Example</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Small</td>
                        <td>1-2</td>
                        <td>Add a function, fix a bug</td>
                    </tr>
                    <tr>
                        <td>Medium</td>
                        <td>3-5</td>
                        <td>New endpoint with tests</td>
                    </tr>
                    <tr>
                        <td>Large</td>
                        <td>6-15</td>
                        <td>New feature module</td>
                    </tr>
                    <tr>
                        <td>Epic</td>
                        <td>15+</td>
                        <td>Decompose further!</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <hr class="section-divider">

        <div class="related-pages">
            <h3>Related Pages</h3>
            <ul>
                <li><a href="techniques-master.html">Techniques (Hooks, MCP, Skills)</a></li>
                <li><a href="tooling-master.html">Tooling (tmux, rpai, claude-mem)</a></li>
                <li><a href="philosophy-master.html">Philosophy (Boris Cherny, Vibe Coding)</a></li>
            </ul>
        </div>

        <nav class="footer-nav">
            <a href="../index.html">Back to Home</a>
            <a href="techniques-master.html">Next: Techniques</a>
        </nav>
    </div>
</body>
</html>
