<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ryan Carson's Ralph Loop | Claude Code Documentation</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Lucide Icons CDN -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- GSAP for scroll-sync -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

  <!-- Tailwind Config with Design Tokens -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'bg-base': '#ffffff',
            'bg-subtle': '#fafafa',
            'bg-muted': '#f4f4f5',
            'text-primary': '#18181b',
            'text-secondary': '#3f3f46',
            'text-muted': '#71717a',
            'accent': '#0D9373',
            'accent-light': '#10b981',
            'accent-bg': '#ecfdf5',
            'border': '#e4e4e7',
            // Activity Zone content type colors (Original 6)
            'az-invariant': '#3b82f6',    // Blue
            'az-effect': '#f59e0b',       // Amber
            'az-composition': '#8b5cf6',  // Purple
            'az-frontier': '#ef4444',     // Red
            'az-warstory': '#10b981',     // Green
            'az-alternative': '#6b7280',  // Gray
            // Activity Zone generative content types (New 10)
            'az-inversion': '#4f46e5',    // Indigo
            'az-constraint': '#8b5cf6',   // Violet
            'az-gradient': '#f43f5e',     // Rose
            'az-horizon': '#06b6d4',      // Cyan
            'az-violation': '#f97316',    // Orange
            'az-tradeoff': '#f59e0b',     // Amber
            'az-analogy': '#d946ef',      // Fuchsia
            'az-expertise': '#10b981',    // Emerald
            'az-minimal': '#84cc16',      // Lime
            'az-inflection': '#eab308',   // Yellow
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
            mono: ['Fira Code', 'monospace'],
          },
        },
      },
    }
  </script>

  <style>
    /* Base Styles */
    * {
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
      scroll-padding-top: 80px;
    }

    [id] {
      scroll-margin-top: 80px;
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: #ffffff;
      color: #18181b;
      line-height: 1.7;
    }

    /* Three Panel Layout */
    .three-panel-layout {
      min-height: 100vh;
      position: relative;
    }

    /* Header */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 56px;
      background: #ffffff;
      border-bottom: 1px solid #e4e4e7;
      z-index: 100;
      display: flex;
      align-items: center;
      padding: 0 24px;
    }

    /* Left Navigation - 240px fixed */
    .left-nav {
      position: fixed;
      top: 56px;
      left: 0;
      width: 240px;
      height: calc(100vh - 56px);
      border-right: 1px solid #e4e4e7;
      background: #ffffff;
      overflow-y: auto;
      padding: 16px 0;
      z-index: 40;
    }

    .nav-section {
      padding: 0 12px;
      margin-bottom: 8px;
    }

    .nav-section-header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      font-size: 14px;
      font-weight: 500;
      color: #3f3f46;
      cursor: pointer;
      border-radius: 6px;
      transition: background 0.15s;
    }

    .nav-section-header:hover {
      background: #f4f4f5;
    }

    .nav-section-header.active {
      color: #0D9373;
      background: #ecfdf5;
    }

    .nav-item {
      display: block;
      padding: 6px 12px 6px 44px;
      font-size: 14px;
      color: #71717a;
      text-decoration: none;
      border-radius: 6px;
      transition: all 0.15s;
    }

    .nav-item:hover {
      color: #3f3f46;
      background: #f4f4f5;
    }

    .nav-item.active {
      color: #0D9373;
      background: #ecfdf5;
    }

    .nav-children {
      display: none;
      overflow: hidden;
    }

    .nav-children.expanded {
      display: block;
    }

    .nav-chevron {
      transition: transform 0.2s;
    }

    .nav-section.expanded .nav-chevron {
      transform: rotate(90deg);
    }

    /* Main Content - Flexible, margins for fixed sidebars */
    .main-content {
      margin-left: 240px;
      margin-right: 480px;
      margin-top: 56px;
      padding: 48px 48px;
      min-width: 400px;
    }

    /* Activity Zone - 480px fixed */
    .activity-zone {
      position: fixed;
      top: 56px;
      right: 0;
      width: 480px;
      height: calc(100vh - 56px);
      border-left: 1px dashed #e4e4e7;
      background: #fafafa;
      overflow-y: auto;
      padding: 24px 20px;
      z-index: 40;
    }

    /* Responsive: Hide Activity Zone below 1400px */
    @media (max-width: 1400px) {
      .activity-zone {
        display: none;
      }
      .main-content {
        margin-right: 0;
        padding: 40px 32px;
      }
    }

    /* Responsive: Hide Left Nav below 768px */
    @media (max-width: 768px) {
      .left-nav {
        display: none;
      }
      .left-nav.open {
        display: block;
        position: fixed;
        top: 56px;
        left: 0;
        right: 0;
        bottom: 0;
        background: #ffffff;
        z-index: 50;
        overflow-y: auto;
      }
      .main-content {
        margin-left: 0;
        padding: 24px 16px;
        min-width: auto;
      }
    }

    /* Resizer */
    .resizer {
      position: fixed;
      top: 56px;
      right: 480px;
      width: 6px;
      height: calc(100vh - 56px);
      cursor: col-resize;
      background: transparent;
      z-index: 50;
      transition: background 0.15s ease;
    }

    .resizer:hover {
      background: rgba(13, 147, 115, 0.15);
    }

    .resizer.active {
      background: rgba(13, 147, 115, 0.25);
    }

    body.resizing {
      user-select: none;
      cursor: col-resize !important;
    }

    body.resizing * {
      cursor: col-resize !important;
    }

    @media (max-width: 1400px) {
      .resizer {
        display: none;
      }
    }

    /* Activity Zone Items */
    .activity-item {
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      background: #ffffff;
      border: 1px solid #e4e4e7;
      font-size: 14px;
      line-height: 1.6;
      opacity: 0.5;
      transition: all 0.3s ease;
    }

    .activity-item.active {
      opacity: 1;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .activity-item:hover {
      opacity: 1;
    }

    .activity-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    /* Activity Zone content type borders */
    .activity-item.invariant { border-left: 4px solid #3b82f6; }
    .activity-item.effect { border-left: 4px solid #f59e0b; }
    .activity-item.composition { border-left: 4px solid #8b5cf6; }
    .activity-item.frontier { border-left: 4px solid #ef4444; }
    .activity-item.warstory { border-left: 4px solid #10b981; }
    .activity-item.alternative { border-left: 4px solid #6b7280; }
    .activity-item.inversion { border-left: 4px solid #4f46e5; }
    .activity-item.constraint { border-left: 4px solid #8b5cf6; }
    .activity-item.gradient { border-left: 4px solid #f43f5e; }
    .activity-item.horizon { border-left: 4px solid #06b6d4; }
    .activity-item.violation { border-left: 4px solid #f97316; }
    .activity-item.tradeoff { border-left: 4px solid #f59e0b; }
    .activity-item.analogy { border-left: 4px solid #d946ef; }
    .activity-item.expertise { border-left: 4px solid #10b981; }
    .activity-item.minimal { border-left: 4px solid #84cc16; }
    .activity-item.inflection { border-left: 4px solid #eab308; }

    /* Main Content Components */
    .section-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      background: #0D9373;
      color: #ffffff;
      font-size: 14px;
      font-weight: 600;
      border-radius: 50%;
      margin-right: 12px;
    }

    .section-title {
      font-size: 24px;
      font-weight: 600;
      color: #18181b;
      margin-bottom: 20px;
      margin-top: 56px;
      display: flex;
      align-items: center;
    }

    .section-title:first-child {
      margin-top: 0;
    }

    /* Essence Box */
    .essence-box {
      background: linear-gradient(135deg, #18181b 0%, #27272a 100%);
      border-radius: 12px;
      padding: 32px;
      margin-bottom: 40px;
    }

    .essence-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #10b981;
      margin-bottom: 12px;
    }

    .essence-text {
      font-size: 22px;
      font-weight: 500;
      color: #ffffff;
      line-height: 1.4;
    }

    /* Core Abstraction Box */
    .core-abstraction {
      background: #fafafa;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 40px;
    }

    .core-philosophy {
      font-size: 16px;
      color: #3f3f46;
      margin-bottom: 16px;
      font-style: italic;
    }

    .core-code {
      background: #18181b;
      border-radius: 8px;
      padding: 16px 20px;
      margin-bottom: 16px;
      overflow-x: auto;
    }

    .core-code code {
      font-family: 'Fira Code', monospace;
      font-size: 15px;
      color: #10b981;
      white-space: nowrap;
    }

    .core-anchor {
      font-size: 14px;
      color: #71717a;
      text-align: center;
    }

    /* Design Decision Box */
    .decision-box {
      background: #ffffff;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
    }

    .decision-why {
      font-size: 16px;
      font-weight: 600;
      color: #0D9373;
      margin-bottom: 12px;
    }

    .decision-reasoning {
      font-size: 14px;
      color: #3f3f46;
      margin-bottom: 16px;
    }

    .decision-implication {
      background: #f4f4f5;
      border-radius: 8px;
      padding: 16px;
    }

    .decision-implication-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      color: #71717a;
      margin-bottom: 8px;
    }

    /* Code Blocks */
    .code-block {
      background: #18181b;
      border-radius: 8px;
      padding: 16px 20px;
      margin-bottom: 24px;
      position: relative;
      overflow-x: auto;
    }

    .code-block pre {
      margin: 0;
      font-family: 'Fira Code', monospace;
      font-size: 13px;
      color: #e4e4e7;
      line-height: 1.6;
    }

    .code-block .comment { color: #6b7280; }
    .code-block .keyword { color: #c084fc; }
    .code-block .string { color: #10b981; }
    .code-block .variable { color: #60a5fa; }

    .copy-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: #3f3f46;
      color: #ffffff;
      border: none;
      border-radius: 4px;
      padding: 6px 10px;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: background 0.15s;
    }

    .copy-btn:hover {
      background: #52525b;
    }

    /* Path Steps */
    .path-container {
      background: #fafafa;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 40px;
    }

    .path-step {
      display: flex;
      gap: 16px;
      margin-bottom: 16px;
    }

    .path-step:last-child {
      margin-bottom: 0;
    }

    .path-number {
      flex-shrink: 0;
      width: 24px;
      height: 24px;
      background: #0D9373;
      color: #ffffff;
      font-size: 12px;
      font-weight: 600;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .path-content {
      flex: 1;
      font-size: 14px;
      color: #3f3f46;
    }

    .path-content code {
      background: #e4e4e7;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 13px;
    }

    /* Gotcha Box */
    .gotcha-box {
      background: #fffbeb;
      border: 1px solid #fcd34d;
      border-left: 4px solid #f59e0b;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .gotcha-title {
      font-weight: 600;
      color: #92400e;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .gotcha-detail {
      font-size: 14px;
      color: #78350f;
      margin-bottom: 8px;
    }

    .gotcha-detail strong {
      color: #92400e;
    }

    /* What's Hard Box */
    .hard-box {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-left: 4px solid #ef4444;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .hard-title {
      font-weight: 600;
      color: #991b1b;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .hard-detail {
      font-size: 14px;
      color: #7f1d1d;
      margin-bottom: 8px;
    }

    /* When To Use Grid */
    .when-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 40px;
    }

    @media (max-width: 900px) {
      .when-grid {
        grid-template-columns: 1fr;
      }
    }

    .when-use {
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      border-radius: 12px;
      padding: 24px;
    }

    .when-not {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: 12px;
      padding: 24px;
    }

    .when-title {
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .when-use .when-title { color: #166534; }
    .when-not .when-title { color: #991b1b; }

    .when-item {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      font-size: 14px;
    }

    .when-use .when-item { color: #166534; }
    .when-not .when-item { color: #991b1b; }

    /* Mobile Menu Button */
    .mobile-menu-btn {
      display: none;
      padding: 8px;
      background: none;
      border: none;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .mobile-menu-btn {
        display: flex;
      }
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: #fafafa;
    }

    ::-webkit-scrollbar-thumb {
      background: #d4d4d8;
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #a1a1aa;
    }

    /* Keyboard shortcut hint */
    .kbd {
      display: inline-flex;
      align-items: center;
      padding: 2px 6px;
      background: #f4f4f5;
      border: 1px solid #e4e4e7;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 12px;
      color: #71717a;
    }

    /* Source Attribution */
    .source-attribution {
      background: #f4f4f5;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 32px;
      font-size: 13px;
      color: #71717a;
    }

    .source-attribution a {
      color: #0D9373;
      text-decoration: none;
    }

    .source-attribution a:hover {
      text-decoration: underline;
    }

    /* Diagram */
    .architecture-diagram {
      background: #18181b;
      border-radius: 8px;
      padding: 24px;
      margin-bottom: 24px;
      overflow-x: auto;
    }

    .architecture-diagram pre {
      margin: 0;
      font-family: 'Fira Code', monospace;
      font-size: 12px;
      color: #10b981;
      line-height: 1.4;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle menu">
      <i data-lucide="menu" class="w-5 h-5 text-text-secondary"></i>
    </button>
    <div class="flex items-center gap-3">
      <i data-lucide="terminal" class="w-5 h-5 text-accent"></i>
      <span class="font-semibold text-text-primary">Claude Code</span>
    </div>
    <div class="flex-1 flex justify-center">
      <button class="flex items-center gap-2 px-4 py-2 bg-bg-muted rounded-lg text-text-muted text-sm hover:bg-border transition-colors">
        <i data-lucide="search" class="w-4 h-4"></i>
        <span>Search documentation...</span>
        <span class="kbd">Cmd+K</span>
      </button>
    </div>
    <div class="flex items-center gap-4">
      <a href="#" class="text-sm text-text-muted hover:text-text-primary transition-colors">Support</a>
      <button class="p-2 hover:bg-bg-muted rounded-lg transition-colors" aria-label="Toggle theme">
        <i data-lucide="sun" class="w-4 h-4 text-text-muted"></i>
      </button>
    </div>
  </header>

  <div class="three-panel-layout">
    <!-- Left Navigation -->
    <nav class="left-nav" id="leftNav">
      <div class="nav-content"></div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">

      <!-- Source Attribution -->
      <div class="source-attribution">
        <strong>Source:</strong> <a href="https://x.com/ryancarson/status/2008950489904472501" target="_blank">@ryancarson</a> (Ryan Carson) - 2026-01-07
        <br>
        <strong>Based on:</strong> Geoffrey Huntley's original Ralph pattern (<a href="https://ghuntley.com/ralph/" target="_blank">ghuntley.com/ralph</a>)
        <br>
        <strong>Engagement:</strong> 2K likes, 203K views, 3.5K bookmarks
      </div>

      <!-- Section 1: ESSENCE -->
      <section id="essence" data-activity="essence">
        <div class="essence-box">
          <div class="essence-label">Essence (15 words)</div>
          <div class="essence-text">Fresh-context iterations implement PRD stories one-by-one until all pass - shipped a feature in 14 iterations.</div>
        </div>
      </section>

      <!-- Section 2: CORE ABSTRACTION + IMPLEMENTATION -->
      <section id="core-abstraction" data-activity="core">
        <h2 class="section-title">
          <span class="section-number">2</span>
          The Core Abstraction
        </h2>

        <div class="core-abstraction">
          <div class="core-philosophy">"Long AI coding sessions hit context limits and degrade. Ralph breaks features into atomic stories, runs fresh instances per story, and uses external memory (git, files) for continuity."</div>

          <div class="core-code">
            <button class="copy-btn" onclick="copyCode(this, './scripts/ralph/ralph.sh 25')">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <code>./scripts/ralph/ralph.sh 25  # max 25 iterations</code>
          </div>

          <div class="core-anchor">Each iteration: fresh Claude instance. No memory of previous work. Continuity through files.</div>
        </div>

        <p class="text-text-secondary mb-6">
          <strong>Why fresh context?</strong> Each iteration spawns a NEW Claude/Amp instance with NO memory of previous work. This is counterintuitive - surely accumulated context is valuable? No. After ~80K tokens, LLM quality degrades. "Context rot" means the model forgets early instructions, contradicts itself, loses track of goals.
        </p>

        <p class="text-text-secondary mb-6">
          <strong>How does progress persist?</strong> Through external memory:
        </p>
        <ul class="list-disc list-inside text-text-secondary mb-6 space-y-2">
          <li><strong>Git history</strong> - Code changes persist across iterations</li>
          <li><strong>prd.json</strong> - Task status (passes: true/false)</li>
          <li><strong>progress.txt</strong> - Learnings, patterns, gotchas discovered</li>
        </ul>

        <h3 class="font-semibold text-lg mb-4 mt-8" id="architecture">Architecture Diagram</h3>

        <div class="architecture-diagram">
          <pre>
PRD.md  -->  prd.json  -->  Ralph Loop  -->  Shipped Feature
                              |
            +-------------------------------------------+
            |  Iteration 1 (fresh Amp/Claude)          |
            |  --> Pick next story (passes: false)     |
            |  --> Read progress.txt for learnings     |
            |  --> Implement                           |
            |  --> Test (typecheck/npm)                |
            |  --> Commit if passing                   |
            |  --> Update prd.json (passes: true)      |
            |  --> APPEND to progress.txt              |
            +-------------------------------------------+
                            | repeat
            +-------------------------------------------+
            |  Iteration N                             |
            |  --> All stories pass?                   |
            |  --> &lt;promise&gt;COMPLETE&lt;/promise&gt;         |
            +-------------------------------------------+
          </pre>
        </div>
      </section>

      <!-- Section 3: DESIGN DECISIONS -->
      <section id="why-fresh-context" data-activity="decisions">
        <h2 class="section-title">
          <span class="section-number">3</span>
          Design Decisions
        </h2>

        <div class="decision-box">
          <div class="decision-why">WHY FRESH CONTEXT PER ITERATION?</div>
          <div class="decision-reasoning">
            LLMs degrade with context length. At 80K tokens, quality drops - instructions get lost, the model contradicts itself. This is "context rot" - a fundamental limitation of transformer attention.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Each iteration gets peak Claude capability. Don't try to extend sessions. If iteration 20 produces worse code than iteration 5, your context is rotting. The fix is to restart, not debug.
            </div>
          </div>
        </div>

        <div class="decision-box" id="why-json-prd">
          <div class="decision-why">WHY JSON FOR PRD (NOT MARKDOWN)?</div>
          <div class="decision-reasoning">
            JSON is structured and machine-readable. Claude can directly modify <code>passes: true/false</code> without parsing ambiguity. Markdown PRDs require interpretation; JSON PRDs are explicit.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Write your PRD in Markdown for humans, then convert to prd.json for Ralph. The JSON schema enforces structure: id, title, acceptanceCriteria[], priority, passes.
            </div>
          </div>
        </div>

        <div class="decision-box" id="why-small-stories">
          <div class="decision-why">WHY MUST STORIES BE SMALL?</div>
          <div class="decision-reasoning">
            Each story must complete in ONE iteration (one context window). If a story is too big, Claude loses track mid-task and produces broken code. Small stories = verifiable units = reliable progress.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              <strong>Rule of thumb:</strong> If you can't describe it in 2-3 sentences, it's too big.<br><br>
              <strong>Right-sized:</strong> "Add a database column + migration", "Add a UI component to an existing page"<br>
              <strong>Too big:</strong> "Build the entire dashboard", "Add authentication"
            </div>
          </div>
        </div>

        <div class="decision-box" id="why-dependency-order">
          <div class="decision-why">WHY DEPENDENCY ORDERING MATTERS?</div>
          <div class="decision-reasoning">
            Wrong order = blocked iterations. If a UI component depends on a schema that doesn't exist yet, the iteration fails. Schema -> backend -> UI is the natural flow.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Order your prd.json by priority: 1. Schema/database changes (migrations), 2. Server actions / backend logic, 3. UI components that use the backend, 4. Dashboard/summary views that aggregate.
            </div>
          </div>
        </div>
      </section>

      <!-- Section 4: FILE STRUCTURE -->
      <section id="file-structure" data-activity="files">
        <h2 class="section-title">
          <span class="section-number">4</span>
          The File Structure
        </h2>

        <div class="code-block">
          <button class="copy-btn" onclick="copyCodeBlock(this)">
            <i data-lucide="copy" class="w-3 h-3"></i>
            Copy
          </button>
          <pre>your-project/
<span class="comment">├── scripts/ralph/           # The Ralph system</span>
│   ├── ralph.sh             <span class="comment"># The loop engine (chmod +x)</span>
│   ├── prompt.md            <span class="comment"># Instructions for each iteration</span>
│   ├── prd.json             <span class="comment"># Task tracking with passes: true/false</span>
│   └── progress.txt         <span class="comment"># Append-only learnings log</span>
│
<span class="comment">├── tasks/                   # PRD source files</span>
│   └── prd-feature.md       <span class="comment"># Human-readable PRD (convert to JSON)</span>
│
<span class="comment">└── ~/.config/amp/           # Amp-specific config (optional)</span>
    ├── settings.json        <span class="comment"># Auto-handoff configuration</span>
    └── skills/
        ├── prd/             <span class="comment"># PRD generation skill</span>
        └── ralph/           <span class="comment"># JSON conversion skill</span></pre>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8" id="ralph-sh">ralph.sh - The Loop Engine</h3>

        <div class="code-block">
          <button class="copy-btn" onclick="copyCodeBlock(this)">
            <i data-lucide="copy" class="w-3 h-3"></i>
            Copy
          </button>
          <pre><span class="comment">#!/bin/bash</span>
<span class="comment"># scripts/ralph/ralph.sh</span>
<span class="comment"># Ryan Carson's Ralph Loop Implementation</span>
<span class="keyword">set</span> -e

<span class="variable">MAX_ITERATIONS</span>=<span class="variable">${1:-10}</span>
<span class="variable">CURRENT_ITERATION</span>=1

<span class="variable">PRD_FILE</span>=<span class="string">"scripts/ralph/prd.json"</span>
<span class="variable">PROGRESS_FILE</span>=<span class="string">"scripts/ralph/progress.txt"</span>
<span class="variable">PROMPT_FILE</span>=<span class="string">"scripts/ralph/prompt.md"</span>

<span class="comment"># Validate files exist</span>
<span class="keyword">if</span> [ ! -f <span class="string">"$PRD_FILE"</span> ]; <span class="keyword">then</span>
  <span class="keyword">echo</span> <span class="string">"ERROR: PRD file not found at $PRD_FILE"</span>
  <span class="keyword">exit</span> 1
<span class="keyword">fi</span>

<span class="comment"># Create feature branch from PRD</span>
<span class="variable">BRANCH_NAME</span>=$(jq -r <span class="string">'.branchName'</span> $PRD_FILE)
git checkout main && git pull
git checkout -b $BRANCH_NAME 2>/dev/null || git checkout $BRANCH_NAME

<span class="keyword">echo</span> <span class="string">"=========================================="</span>
<span class="keyword">echo</span> <span class="string">" RALPH WIGGUM LOOP"</span>
<span class="keyword">echo</span> <span class="string">" Max iterations: $MAX_ITERATIONS"</span>
<span class="keyword">echo</span> <span class="string">" PRD file: $PRD_FILE"</span>
<span class="keyword">echo</span> <span class="string">" Branch: $BRANCH_NAME"</span>
<span class="keyword">echo</span> <span class="string">"=========================================="</span>

<span class="keyword">while</span> [ $CURRENT_ITERATION -le $MAX_ITERATIONS ]; <span class="keyword">do</span>
  <span class="keyword">echo</span> <span class="string">""</span>
  <span class="keyword">echo</span> <span class="string">"=== Iteration $CURRENT_ITERATION of $MAX_ITERATIONS ==="</span>
  <span class="keyword">echo</span> <span class="string">"Time: $(date +%H:%M:%S)"</span>

  <span class="comment"># Run Claude/Amp with the prompt</span>
  OUTPUT=$(cat <span class="string">"$PROMPT_FILE"</span> | amp 2>&1 | tee /dev/stderr) || <span class="keyword">true</span>

  <span class="comment"># Check for completion signal</span>
  <span class="keyword">if</span> <span class="keyword">echo</span> <span class="string">"$OUTPUT"</span> | grep -q <span class="string">"&lt;promise&gt;COMPLETE&lt;/promise&gt;"</span>; <span class="keyword">then</span>
    <span class="keyword">echo</span> <span class="string">""</span>
    <span class="keyword">echo</span> <span class="string">"=========================================="</span>
    <span class="keyword">echo</span> <span class="string">" ALL STORIES COMPLETE!"</span>
    <span class="keyword">echo</span> <span class="string">" Total iterations: $CURRENT_ITERATION"</span>
    <span class="keyword">echo</span> <span class="string">"=========================================="</span>
    <span class="keyword">exit</span> 0
  <span class="keyword">fi</span>

  <span class="variable">CURRENT_ITERATION</span>=$((CURRENT_ITERATION + 1))
  sleep 2
<span class="keyword">done</span>

<span class="keyword">echo</span> <span class="string">""</span>
<span class="keyword">echo</span> <span class="string">"=========================================="</span>
<span class="keyword">echo</span> <span class="string">" MAX ITERATIONS REACHED"</span>
<span class="keyword">echo</span> <span class="string">" Check prd.json for incomplete stories"</span>
<span class="keyword">echo</span> <span class="string">"=========================================="</span>
<span class="keyword">exit</span> 1</pre>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8" id="prompt-md">prompt.md - Agent Instructions</h3>

        <div class="code-block">
          <button class="copy-btn" onclick="copyCodeBlock(this)">
            <i data-lucide="copy" class="w-3 h-3"></i>
            Copy
          </button>
          <pre><span class="comment"># Ralph Agent Instructions</span>

<span class="comment">## Your Task</span>

1. Read `scripts/ralph/prd.json`
2. Read `scripts/ralph/progress.txt` (check Codebase Patterns first)
3. Pick highest priority story where `passes: false`
4. Implement that ONE story
5. Run typecheck and tests: `npm run typecheck && npm test`
6. Commit: `git commit -m "feat: [ID] - [Title]"`
7. Update prd.json: set `passes: true` for completed story
8. APPEND learnings to progress.txt (DO NOT overwrite)

<span class="comment">## Stop Condition</span>

If ALL stories have `passes: true`, reply with:
&lt;promise&gt;COMPLETE&lt;/promise&gt;

Otherwise, end your response normally (loop will restart you).</pre>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8" id="prd-json">prd.json - Task Board Schema</h3>

        <div class="code-block">
          <button class="copy-btn" onclick="copyCodeBlock(this)">
            <i data-lucide="copy" class="w-3 h-3"></i>
            Copy
          </button>
          <pre>{
  <span class="string">"project"</span>: <span class="string">"Untangle"</span>,
  <span class="string">"branchName"</span>: <span class="string">"ralph/legal-agent-income-upsert"</span>,
  <span class="string">"description"</span>: <span class="string">"Legal Agent Income Upsert Tool"</span>,
  <span class="string">"userStories"</span>: [
    {
      <span class="string">"id"</span>: <span class="string">"US-001"</span>,
      <span class="string">"title"</span>: <span class="string">"Create upsertIncome tool skeleton with input schema"</span>,
      <span class="string">"description"</span>: <span class="string">"As a developer, I need the tool skeleton with Zod schema"</span>,
      <span class="string">"acceptanceCriteria"</span>: [
        <span class="string">"Zod schema matches PRD specifications"</span>,
        <span class="string">"npm run typecheck passes"</span>,
        <span class="string">"npm run test passes"</span>
      ],
      <span class="string">"priority"</span>: 1,
      <span class="string">"passes"</span>: <span class="keyword">false</span>,
      <span class="string">"notes"</span>: <span class="string">"Follow patterns in src/tools/"</span>
    },
    {
      <span class="string">"id"</span>: <span class="string">"US-002"</span>,
      <span class="string">"title"</span>: <span class="string">"Add category mapping for income types"</span>,
      <span class="string">"acceptanceCriteria"</span>: [
        <span class="string">"Map income categories to database enums"</span>,
        <span class="string">"npm run typecheck passes"</span>
      ],
      <span class="string">"priority"</span>: 2,
      <span class="string">"passes"</span>: <span class="keyword">false</span>
    }
  ]
}</pre>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8" id="progress-txt">progress.txt - Learnings Log</h3>

        <div class="code-block">
          <button class="copy-btn" onclick="copyCodeBlock(this)">
            <i data-lucide="copy" class="w-3 h-3"></i>
            Copy
          </button>
          <pre><span class="comment"># Progress Log - Ralph Session</span>
<span class="comment"># This file is APPEND-ONLY. Each iteration adds learnings.</span>

<span class="comment">## Codebase Patterns Discovered</span>
- Use Zod .optional() for nullable database fields
- Follow naming convention: src/tools/[toolName].ts
- Tests live in __tests__/tools/[toolName].test.ts

<span class="comment">## [2026-01-07 14:32] - US-001 Complete</span>
- Created upsertIncome.ts skeleton
- Used existing createExpense.ts as template
- Pattern: validateInput -> transform -> upsert -> return

<span class="comment">## [2026-01-07 14:35] - US-002 Complete</span>
- Added INCOME_CATEGORIES constant
- Gotcha: database uses snake_case, TypeScript uses camelCase</pre>
        </div>
      </section>

      <!-- Section 5: PATH OF A TASK -->
      <section id="path" data-activity="path">
        <h2 class="section-title">
          <span class="section-number">5</span>
          The Path of a Task
        </h2>

        <p class="text-text-secondary mb-6">
          Follow a single user story (US-001) through one complete iteration:
        </p>

        <div class="path-container">
          <div class="path-step">
            <div class="path-number">1</div>
            <div class="path-content"><strong>[T+0:00]</strong> <code>ralph.sh</code> starts iteration. Echo: "=== Iteration 1 of 25 ==="</div>
          </div>
          <div class="path-step">
            <div class="path-number">2</div>
            <div class="path-content"><strong>[T+0:05]</strong> Amp/Claude loads <code>prompt.md</code>. Token cost: ~500 tokens for prompt.</div>
          </div>
          <div class="path-step">
            <div class="path-number">3</div>
            <div class="path-content"><strong>[T+0:10]</strong> Agent reads <code>prd.json</code>. Identifies US-001 has <code>passes: false</code>. Selects it (highest priority incomplete).</div>
          </div>
          <div class="path-step">
            <div class="path-number">4</div>
            <div class="path-content"><strong>[T+0:15]</strong> Agent reads <code>progress.txt</code>. Notes codebase patterns discovered by previous iterations.</div>
          </div>
          <div class="path-step">
            <div class="path-number">5</div>
            <div class="path-content"><strong>[T+0:20]</strong> Agent implements US-001. Creates files, modifications as needed. Follows acceptance criteria as checklist.</div>
          </div>
          <div class="path-step">
            <div class="path-number">6</div>
            <div class="path-content"><strong>[T+1:00]</strong> Agent runs verification: <code>npm run typecheck && npm test</code>. Duration: 30-90 seconds depending on task complexity.</div>
          </div>
          <div class="path-step">
            <div class="path-number">7</div>
            <div class="path-content"><strong>[T+1:30]</strong> Tests pass. Agent updates <code>prd.json</code>: sets <code>US-001.passes = true</code>.</div>
          </div>
          <div class="path-step">
            <div class="path-number">8</div>
            <div class="path-content"><strong>[T+1:35]</strong> Agent appends to <code>progress.txt</code>: timestamp, what was done, patterns discovered.</div>
          </div>
          <div class="path-step">
            <div class="path-number">9</div>
            <div class="path-content"><strong>[T+1:40]</strong> Agent commits: <code>git commit -m "feat: US-001 - Create upsertIncome tool skeleton"</code></div>
          </div>
          <div class="path-step">
            <div class="path-number">10</div>
            <div class="path-content"><strong>[T+1:45]</strong> Iteration ends. Check: Are all stories complete? No -> Loop continues to next iteration.</div>
          </div>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8" id="annotated-output">Annotated Console Output</h3>

        <div class="code-block">
          <pre><span class="comment"># Starting the Ralph loop</span>
$ ./scripts/ralph/ralph.sh 25

==========================================
 RALPH WIGGUM LOOP
 Max iterations: 25                  <span class="comment"># Your safety limit</span>
 PRD file: scripts/ralph/prd.json    <span class="comment"># Found your task list</span>
 Branch: ralph/legal-agent-income    <span class="comment"># Working branch</span>
==========================================

=== Iteration 1 of 25 ===

Reading scripts/ralph/prd.json...
Found 6 user stories                 <span class="comment"># Total tasks</span>
  ✓ 0 complete
  ○ 6 remaining

Selecting: US-001                    <span class="comment"># First incomplete</span>
  "Create upsertIncome tool skeleton"

[Working on US-001...]               <span class="comment"># 30-90 seconds</span>

Running: npm run typecheck
✓ Typecheck passed

Running: npm run test
✓ All tests passed

Updating prd.json...
  US-001: passes = true              <span class="comment"># Marked done!</span>

Committing changes...
  [ralph/legal-agent 7a3f8c2] feat: US-001 - Create upsertIncome tool skeleton

<span class="comment"># ... iterations 2-6 ...</span>

=== Iteration 7 of 25 ===

Found 6 user stories
  ✓ 6 complete                       <span class="comment"># All done!</span>
  ○ 0 remaining

&lt;promise&gt;COMPLETE&lt;/promise&gt;          <span class="comment"># Exit signal</span>

==========================================
 ALL STORIES COMPLETE!
 Total iterations: 7
==========================================</pre>
        </div>

        <p class="text-text-secondary mt-6 mb-6">
          <strong>Timing Expectations:</strong> Each iteration: 30-90 seconds. Simple task: 30-45s. Complex task: 60-90s. Full 6-story feature: 5-15 minutes. Overnight run (25 iterations): 20-45 minutes.
        </p>
      </section>

      <!-- Section 6: GOTCHAS -->
      <section id="gotchas" data-activity="gotchas">
        <h2 class="section-title">
          <span class="section-number">6</span>
          Gotchas
        </h2>

        <p class="text-text-secondary mb-6">
          Real problems you'll hit, with concrete numbers and fixes:
        </p>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            #1: Story Too Large
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Iteration never completes, context overflow mid-story</div>
          <div class="gotcha-detail"><strong>Threshold:</strong> If description > 3 sentences, it's too big</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Split into smaller stories. "Build auth" -> "Add users table", "Add middleware", "Add login form"</div>
          <div class="gotcha-detail"><strong>Time to fix:</strong> 15 min planning time</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            #2: Missing Typecheck in Criteria
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Agent marks complete but code is broken</div>
          <div class="gotcha-detail"><strong>Cause:</strong> No verification step in acceptance criteria</div>
          <div class="gotcha-detail"><strong>Fix:</strong> ALWAYS include "npm run typecheck passes" as final criterion</div>
          <div class="gotcha-detail"><strong>Time to fix:</strong> 5 min</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            #3: Context Rot in Late Iterations
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Late iterations produce worse code than early ones</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Stories too large, context filling up</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Make stories smaller, rely on fresh context per iteration</div>
          <div class="gotcha-detail"><strong>Time to fix:</strong> Design time (rethink PRD)</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            #4: Weak Acceptance Criteria
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Agent marks pass without proper verification</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Criteria like "works correctly" or "good UX"</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Make criteria specific and testable. "Filter dropdown has options: All, Cold, Friend"</div>
          <div class="gotcha-detail"><strong>Time to fix:</strong> 10 min</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            #5: Frontend Without Browser Check
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> "Done" but UI is visually broken</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Tests pass but no visual verification</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Add Playwright MCP, dev-browser skill. "Verify at localhost:3000"</div>
          <div class="gotcha-detail"><strong>Time to fix:</strong> 30 min setup</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            #6: Non-Idempotent Migration
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Migration runs multiple times, breaks DB</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Agent creates migration without checking if table exists</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Add migration safeguards, manual SQL review before running</div>
          <div class="gotcha-detail"><strong>Time to fix:</strong> 15 min</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            #7: Duplicate Detection False Positive
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Agent asks about duplicates, blocks progress</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Agent confused by similar-looking code</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Add confirmation in acceptance criteria or notes</div>
          <div class="gotcha-detail"><strong>Time to fix:</strong> 5 min</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            #8: E2E Test Environment Issues
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Tests fail due to ports, DB state</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Environment not reset between runs</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Document environment requirements, reset script before Ralph</div>
          <div class="gotcha-detail"><strong>Time to fix:</strong> 20 min</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            #9: progress.txt Overwritten
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Agent updates instead of appends, losing learnings</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Model interprets "update" as "replace"</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Use "APPEND" in CAPS in prompt.md. The capitalization matters.</div>
          <div class="gotcha-detail"><strong>Time to fix:</strong> 2 min</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            #10: Max Iterations Too Low
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Loop stops before completion</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Safety limit reached before all stories done</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Increase max iterations. Start with 25 for complex features.</div>
          <div class="gotcha-detail"><strong>Time to fix:</strong> 1 min</div>
        </div>
      </section>

      <!-- Section 7: WHAT'S HARD -->
      <section id="hard" data-activity="hard">
        <h2 class="section-title">
          <span class="section-number">7</span>
          What's Hard
        </h2>

        <p class="text-text-secondary mb-6">
          These are fundamental tensions, not bugs to fix:
        </p>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Story Sizing is an Art
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Too big = failure. Too small = overhead. There's no formula - it's a skill you develop.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Context overflow (too big) OR iterations faster than useful work (too small).</div>
          <div class="hard-detail"><strong>Coping strategy:</strong> Start conservative (smaller stories). Review progress.txt after runs to see what worked. Expect to get better over time.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Verification Gap
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Tests pass != code works. Especially for UI. The agent can't see what humans see.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> "Complete" tasks that look broken in the browser.</div>
          <div class="hard-detail"><strong>Coping strategy:</strong> Add browser verification (Playwright). Accept that some domains (design, UX) aren't fully Ralph-suitable. Use HOTL variant for subjective tasks.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Context Window Pressure
          </div>
          <div class="hard-detail"><strong>The tension:</strong> More features in a PRD = bigger context per iteration = worse performance.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Quality drops as PRD grows beyond 15-20 stories.</div>
          <div class="hard-detail"><strong>Coping strategy:</strong> Keep stories atomic. Rely on external memory. Consider splitting into multiple PRDs for large features.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Cost Accumulation
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Each iteration costs tokens. Long runs add up. A 25-iteration run is not free.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Surprise bills at end of month.</div>
          <div class="hard-detail"><strong>Coping strategy:</strong> Monitor costs. Set budget alerts. Right-size max iterations (don't use 100 if 15 will do). Estimate $0.50-$1.50 per iteration.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Dependency Ordering
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Wrong order = blocked iterations. Schema -> backend -> UI is critical but easy to get wrong.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Iterations fail because they depend on code that doesn't exist yet.</div>
          <div class="hard-detail"><strong>Coping strategy:</strong> Careful upfront planning. Review story order before running. Use priority field to enforce order.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Lost Learning
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Discoveries in one iteration can be lost in next. Fresh context means starting over.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Same mistakes repeated across iterations.</div>
          <div class="hard-detail"><strong>Coping strategy:</strong> progress.txt discipline. Explicitly document patterns. Move permanent learnings to AGENTS.md between runs.</div>
        </div>
      </section>

      <!-- Section 8: WHEN TO USE -->
      <section id="when" data-activity="when">
        <h2 class="section-title">
          <span class="section-number">8</span>
          When to Use / When Not
        </h2>

        <div class="when-grid">
          <div class="when-use">
            <div class="when-title">
              <i data-lucide="check" class="w-5 h-5"></i>
              USE RALPH WHEN
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span><strong>Feature development with clear completion:</strong> Not for open-ended exploration</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span><strong>5-30 stories in PRD:</strong> Sweet spot for Ralph</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span><strong>Have typecheck + tests:</strong> Need feedback loop</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span><strong>Overnight runs:</strong> Want AFK development</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span><strong>Budget $5-50:</strong> Per-iteration costs accumulate</span>
            </div>
          </div>

          <div class="when-not">
            <div class="when-title">
              <i data-lucide="x" class="w-5 h-5"></i>
              DON'T USE RALPH WHEN
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span><strong>Single small task:</strong> Manual Claude session (loop overhead not worth it)</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span><strong>Ambiguous requirements:</strong> Manual iteration (need human judgment)</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span><strong>Complex multi-agent:</strong> CC Mirror, Gas Town (Ralph is single-agent)</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span><strong>Real-time interaction:</strong> Manual sessions (Ralph is batch-oriented)</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span><strong>No tests/types:</strong> Add tests first (loop without feedback fails)</span>
            </div>
          </div>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8" id="graduation">Graduation Path</h3>

        <div class="path-container">
          <div class="path-step">
            <div class="path-number">0</div>
            <div class="path-content"><strong>Level 0-2:</strong> Manual Claude sessions. Learning basics.</div>
          </div>
          <div class="path-step">
            <div class="path-number">3</div>
            <div class="path-content"><strong>Level 3:</strong> Simple bash loops. <code>while :; do cat PROMPT.md | claude; done</code></div>
          </div>
          <div class="path-step">
            <div class="path-number">4</div>
            <div class="path-content"><strong>Level 4:</strong> <strong>Ralph with PRD (YOU ARE HERE)</strong>. Structured task tracking, external memory.</div>
          </div>
          <div class="path-step">
            <div class="path-number">5</div>
            <div class="path-content"><strong>Level 5:</strong> Ralph + Playwright browser verification. Visual feedback loop.</div>
          </div>
          <div class="path-step">
            <div class="path-number">6</div>
            <div class="path-content"><strong>Level 6:</strong> CC Mirror multi-agent. Parallel execution, task distribution.</div>
          </div>
          <div class="path-step">
            <div class="path-number">7</div>
            <div class="path-content"><strong>Level 7+:</strong> Gas Town factory scale. Mayor + Deacon + Dogs + Refinery.</div>
          </div>
        </div>
      </section>

    </main>

    <!-- Resizer -->
    <div class="resizer" data-resizer="activity-zone" aria-label="Resize activity panel"></div>

    <!-- Activity Zone - 29 Items -->
    <aside class="activity-zone" id="activityZone">
      <div class="text-xs font-semibold text-text-muted uppercase tracking-wider mb-4">Operational Intelligence</div>

      <!-- ========== ESSENCE SECTION (3 items) ========== -->

      <!-- AZ-INV-1: Shared with Panopticon -->
      <div class="activity-item invariant" data-section="essence">
        <div class="activity-label" style="color: #3b82f6;">
          <i data-lucide="link-2" class="w-4 h-4"></i>
          Invariant Connection
        </div>
        <div class="font-medium text-text-primary mb-2">Shared with Panopticon: External Memory</div>
        <div class="text-text-secondary text-sm">
          Ralph's git + prd.json + progress.txt mirrors Panopticon's filesystem-as-memory.<br><br>
          <strong>The invariant:</strong> External state > internal memory. Both patterns discovered the same truth independently.
        </div>
      </div>

      <!-- AZ-WAR-1: 14 Iterations -->
      <div class="activity-item warstory" data-section="essence">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">Ryan Carson: 14 iterations, ~$10-15</div>
        <div class="text-text-secondary text-sm">
          Untangle Legal Agent Income Upsert. 6 user stories, ran overnight.<br><br>
          "Learnings compound. By iteration 10, Ralph knew our patterns. Tool skeleton → category mapping → duplicate detection → database ops → UI → validation."
        </div>
      </div>

      <!-- AZ-MIN-1: Minimal Pattern -->
      <div class="activity-item minimal" data-section="essence">
        <div class="activity-label" style="color: #84cc16;">
          <i data-lucide="minimize-2" class="w-4 h-4"></i>
          Minimal Pattern
        </div>
        <div class="font-medium text-text-primary mb-2">The irreducible Ralph</div>
        <div class="text-text-secondary text-sm">
          <code style="background: #f4f4f5; padding: 2px 6px; border-radius: 4px; font-size: 12px;">while :; do cat PROMPT.md | claude; done</code><br><br>
          <strong>Essential:</strong> The loop. Fresh context.<br>
          <strong>Everything else:</strong> Refinement for reliability, tracking, learnings.
        </div>
      </div>

      <!-- ========== CORE SECTION (4 items) ========== -->

      <!-- AZ-INVL-1: What if context didn't degrade? -->
      <div class="activity-item inversion" data-section="core">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if context DIDN'T degrade?</div>
        <div class="text-text-secondary text-sm">
          <strong>You'd design:</strong> One long session per feature, no external files, no restarts.<br>
          <strong>Why this fails:</strong> 80K token context rot is transformer physics, not a bug.<br>
          <strong>Hidden constraint revealed:</strong> Ralph IS the constraint made visible.
        </div>
      </div>

      <!-- AZ-FAIL-1: Failure Gradient -->
      <div class="activity-item gradient" data-section="core">
        <div class="activity-label" style="color: #f43f5e;">
          <i data-lucide="trending-down" class="w-4 h-4"></i>
          Failure Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">How context degrades (invisibly)</div>
        <div class="text-text-secondary text-sm">
          <strong>100% → 90%</strong> (40-60K): Subtle drift, you won't notice<br>
          <strong>90% → 70%</strong> (60-80K): Repetition, compression<br>
          <strong>70% → 50%</strong> (80-100K): Instructions forgotten<br>
          <strong>50% → CLIFF</strong> (100K+): Hallucinations, amnesia<br><br>
          <em>Critical: The gradient is invisible until the cliff.</em>
        </div>
      </div>

      <!-- AZ-ANAL-1: Stateless Servers -->
      <div class="activity-item analogy" data-section="core">
        <div class="activity-label" style="color: #d946ef;">
          <i data-lucide="git-compare" class="w-4 h-4"></i>
          Analogical Bridge
        </div>
        <div class="font-medium text-text-primary mb-2">Ralph = Stateless Web Servers</div>
        <div class="text-text-secondary text-sm">
          HTTP stateless → Fresh context per iteration<br>
          Database → prd.json, progress.txt, git<br>
          Session cookie → Files read at iteration start<br>
          Horizontal scaling → Parallel Ralph loops<br><br>
          <em>If you've designed stateless services, you already understand Ralph.</em>
        </div>
      </div>

      <!-- AZ-INV-2: Shared with Matt Pocock -->
      <div class="activity-item invariant" data-section="core">
        <div class="activity-label" style="color: #3b82f6;">
          <i data-lucide="link-2" class="w-4 h-4"></i>
          Invariant Connection
        </div>
        <div class="font-medium text-text-primary mb-2">Shared with Matt Pocock: Kanban Mental Model</div>
        <div class="text-text-secondary text-sm">
          Both Ryan Carson and Matt Pocock view prd.json as a kanban board. Pick from incomplete column, move to done.<br><br>
          <strong>The invariant:</strong> Task tracking needs a single source of truth. Different implementations, same concept.
        </div>
      </div>

      <!-- ========== DECISIONS SECTION (5 items) ========== -->

      <!-- AZ-CONST-1: Context Windows Constraint -->
      <div class="activity-item constraint" data-section="decisions">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="link-2" class="w-4 h-4"></i>
          Constraint Chain
        </div>
        <div class="font-medium text-text-primary mb-2">One constraint → FIVE decisions</div>
        <div class="text-text-secondary text-sm">
          <strong>ROOT:</strong> Context finite (200K) → Quality degrades as context fills<br>
          → Fresh context beats extended sessions<br>
          → State must persist externally (files)<br>
          → Each iteration must be self-contained<br>
          → Tasks must complete in one context window<br>
          → Verification must be automatable
        </div>
      </div>

      <!-- AZ-VIOL-1: If you rely on Claude remembering -->
      <div class="activity-item violation" data-section="decisions">
        <div class="activity-label" style="color: #f97316;">
          <i data-lucide="alert-octagon" class="w-4 h-4"></i>
          Violation Chain
        </div>
        <div class="font-medium text-text-primary mb-2">If you rely on "Claude remembering"</div>
        <div class="text-text-secondary text-sm">
          <strong>IF:</strong> You rely on memory instead of files<br>
          <strong>THEN:</strong> Next iteration has no knowledge of previous<br>
          <strong>THEN:</strong> Same mistakes repeated<br>
          <strong>THEN:</strong> No velocity increase over time<br>
          <strong>FINALLY:</strong> Iteration 20 is as slow as iteration 1<br><br>
          <em>The fix: "If it's not in a file, it doesn't exist."</em>
        </div>
      </div>

      <!-- AZ-TRADE-1: Task Size Dilemma -->
      <div class="activity-item tradeoff" data-section="decisions">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="scale" class="w-4 h-4"></i>
          Trade-Off Tension
        </div>
        <div class="font-medium text-text-primary mb-2">The Task Size Dilemma</div>
        <div class="text-text-secondary text-sm">
          <strong>Very small:</strong> Safe, but spawn overhead dominates<br>
          <strong>Medium:</strong> Balanced, but judgment required<br>
          <strong>Large:</strong> Efficient, but context collapse risk<br><br>
          <em>Heuristic: If task description > code change, you've decomposed too far.</em>
        </div>
      </div>

      <!-- AZ-SOE-1: PRD Discipline -->
      <div class="activity-item effect" data-section="decisions">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="zap" class="w-4 h-4"></i>
          Second-Order Effect
        </div>
        <div class="font-medium text-text-primary mb-2">PRD Discipline Improvement</div>
        <div class="text-text-secondary text-sm">
          Using Ralph forces better story writing. Too big fails. Too vague fails.<br><br>
          <strong>The effect:</strong> Your PRD skills improve as a side effect of using Ralph. Bad stories = immediate feedback.
        </div>
      </div>

      <!-- AZ-SOE-2: Test Coverage Incentive -->
      <div class="activity-item effect" data-section="decisions">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="zap" class="w-4 h-4"></i>
          Second-Order Effect
        </div>
        <div class="font-medium text-text-primary mb-2">Test Coverage Incentive</div>
        <div class="text-text-secondary text-sm">
          Without tests, Ralph produces garbage. The loop has no feedback.<br><br>
          <strong>The effect:</strong> Users add tests because Ralph makes testlessness painful. Testing becomes mandatory by natural selection.
        </div>
      </div>

      <!-- ========== FILES SECTION (4 items) ========== -->

      <!-- AZ-EXP-1: Expertise Gradient -->
      <div class="activity-item expertise" data-section="files">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
          Expertise Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">How deep is your understanding?</div>
        <div class="text-text-secondary text-sm">
          <strong>Beginner:</strong> "What files do I need?" → The 4 files<br>
          <strong>Intermediate:</strong> "Why these files?" → Each serves ONE purpose<br>
          <strong>Advanced:</strong> "What's minimal?" → Just loop + prompt<br>
          <strong>Staff:</strong> "When add more?" → Dr. Ralph, HOTL gates<br>
          <strong>Expert:</strong> "Cross-pattern?" → prd.json = Gas Town inbox
        </div>
      </div>

      <!-- AZ-COMP-1: Ralph + Playwright -->
      <div class="activity-item composition" data-section="files">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="layers" class="w-4 h-4"></i>
          Composition Case
        </div>
        <div class="font-medium text-text-primary mb-2">Ralph + Playwright</div>
        <div class="text-text-secondary text-sm">
          <strong>Works:</strong> Visual verification catches UI bugs that tests miss.<br>
          <strong>Danger:</strong> Browser context consumes tokens. Put Playwright in subagents to protect main context.
        </div>
      </div>

      <!-- AZ-COMP-2: Ralph + PRD Skill -->
      <div class="activity-item composition" data-section="files">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="layers" class="w-4 h-4"></i>
          Composition Case
        </div>
        <div class="font-medium text-text-primary mb-2">Ralph + PRD Skill</div>
        <div class="text-text-secondary text-sm">
          <strong>Works:</strong> Amp skill generates properly-sized stories from natural language. "Create PRD for [feature]" → prd.json<br>
          <strong>Benefit:</strong> Automates the hardest part - task decomposition.
        </div>
      </div>

      <!-- AZ-COMP-3: Anti-Composition -->
      <div class="activity-item composition" data-section="files">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="x-circle" class="w-4 h-4"></i>
          Anti-Composition
        </div>
        <div class="font-medium text-text-primary mb-2">Ralph + Parallel Execution</div>
        <div class="text-text-secondary text-sm">
          <strong>Fails:</strong> Ralph is a single-agent loop. Running multiple Ralph instances on same codebase causes merge conflicts.<br>
          <strong>Alternative:</strong> Use CC Mirror for parallel execution.
        </div>
      </div>

      <!-- ========== PATH SECTION (4 items) ========== -->

      <!-- AZ-TIME-1: Time Horizon Shift -->
      <div class="activity-item horizon" data-section="path">
        <div class="activity-label" style="color: #06b6d4;">
          <i data-lucide="clock" class="w-4 h-4"></i>
          Time Horizon Shift
        </div>
        <div class="font-medium text-text-primary mb-2">How judgment evolves with iterations</div>
        <div class="text-text-secondary text-sm">
          <strong>Iteration 3:</strong> "progress.txt feels like overhead"<br>
          <strong>Iteration 8:</strong> "Claude is repeating solved mistakes!"<br>
          <strong>Iteration 15:</strong> "progress.txt is why late iterations are FASTER"<br>
          <strong>Iteration 30:</strong> "This is institutional memory"<br><br>
          <em>Don't judge Ralph by iteration 2.</em>
        </div>
      </div>

      <!-- AZ-VIOL-2: Skip tests -->
      <div class="activity-item violation" data-section="path">
        <div class="activity-label" style="color: #f97316;">
          <i data-lucide="alert-octagon" class="w-4 h-4"></i>
          Violation Chain
        </div>
        <div class="font-medium text-text-primary mb-2">If you skip tests (Step 6)</div>
        <div class="text-text-secondary text-sm">
          <strong>IF:</strong> Skip "run typecheck and tests"<br>
          <strong>THEN:</strong> Claude marks tasks done without verification<br>
          <strong>THEN:</strong> Broken code enters git<br>
          <strong>THEN:</strong> Future iterations inherit broken foundation<br>
          <strong>FINALLY:</strong> Morning reveals 20 bad commits<br><br>
          <em>One unverified task at iteration 5 → 15 iterations on broken foundation</em>
        </div>
      </div>

      <!-- AZ-WAR-2: Jest to Vitest -->
      <div class="activity-item warstory" data-section="path">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">Arvid Kahl: Jest to Vitest Migration</div>
        <div class="text-text-secondary text-sm">
          Full test suite migrated via Ralph. Days of manual work in minutes.<br><br>
          "Each story: migrate one test file. Pass criteria: npm test passes. 40 iterations, zero human intervention."
        </div>
      </div>

      <!-- AZ-INV-3: CI/CD Pattern -->
      <div class="activity-item invariant" data-section="path">
        <div class="activity-label" style="color: #3b82f6;">
          <i data-lucide="link-2" class="w-4 h-4"></i>
          Invariant Connection
        </div>
        <div class="font-medium text-text-primary mb-2">CI/CD Pattern: Test Before Merge</div>
        <div class="text-text-secondary text-sm">
          Ralph's typecheck requirement mirrors CI gates. No merge without green tests.<br><br>
          <strong>The invariant:</strong> Feedback loops are non-negotiable. Whether human or agent, verification before progress.
        </div>
      </div>

      <!-- ========== GOTCHAS SECTION (4 items) ========== -->

      <!-- AZ-INFL-1: progress.txt Inflection -->
      <div class="activity-item inflection" data-section="gotchas">
        <div class="activity-label" style="color: #eab308;">
          <i data-lucide="activity" class="w-4 h-4"></i>
          Inflection Point
        </div>
        <div class="font-medium text-text-primary mb-2">When progress.txt flips from help to hurt</div>
        <div class="text-text-secondary text-sm">
          <strong>0-10KB:</strong> Pure benefit (learnings compound)<br>
          <strong>10-20KB:</strong> Diminishing returns (more to read)<br>
          <strong>20-30KB:</strong> Neutral (reading cost = thinking benefit)<br>
          <strong>30KB+:</strong> Net negative (context wasted on history)<br><br>
          <strong>THE INFLECTION:</strong> ~20KB<br>
          <em>Detection: Late iterations worse than early? Check file size.</em>
        </div>
      </div>

      <!-- AZ-INVL-2: Why CAPS for APPEND -->
      <div class="activity-item inversion" data-section="gotchas">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">Why CAPS for "APPEND"?</div>
        <div class="text-text-secondary text-sm">
          <strong>What if "update" meant "append"?</strong><br>
          Then you wouldn't need CAPS. But models interpret "update" as "replace" by default.<br><br>
          <strong>Why CAPS matters:</strong> Models pay attention to formatting emphasis. "append" gets ignored. "APPEND" gets followed.<br>
          <em>Hidden constraint: Model instruction following has quirks. The workaround IS the interface.</em>
        </div>
      </div>

      <!-- AZ-FRONT-1: Optimal compaction -->
      <div class="activity-item frontier" data-section="gotchas">
        <div class="activity-label" style="color: #ef4444;">
          <i data-lucide="flask-conical" class="w-4 h-4"></i>
          Research Frontier
        </div>
        <div class="font-medium text-text-primary mb-2">UNSOLVED: Optimal compaction window</div>
        <div class="text-text-secondary text-sm">
          When should progress.txt be compacted? After N iterations? After K bytes?<br><br>
          Optimal varies by project. No automation yet. Community opportunity.
        </div>
      </div>

      <!-- AZ-WAR-3: Story Too Large -->
      <div class="activity-item warstory" data-section="gotchas">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">Story Too Large Failure</div>
        <div class="text-text-secondary text-sm">
          User tried "build entire auth system" as one story. Infinite loop - never completed.<br><br>
          <strong>Fix:</strong> Split into 5 stories (users table, middleware, login form, sessions, logout). Succeeded in 8 iterations.
        </div>
      </div>

      <!-- ========== HARD SECTION (3 items) ========== -->

      <!-- AZ-TRADE-2: Context Rot vs Memory Loss -->
      <div class="activity-item tradeoff" data-section="hard">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="scale" class="w-4 h-4"></i>
          Trade-Off Tension
        </div>
        <div class="font-medium text-text-primary mb-2">Context Rot vs. Memory Loss</div>
        <div class="text-text-secondary text-sm">
          <strong>THE DILEMMA:</strong><br>
          Extended session: Rich context, but quality degrades at 80K<br>
          Fresh context: Peak quality, but must reconstruct state<br><br>
          <strong>WHY NO PERFECT ANSWER:</strong><br>
          progress.txt is lossy - you choose what to write. Each iteration "forgets" 90% of the prior.<br><br>
          <em>Accept that fresh > rot. Invest in better hygiene, not longer sessions.</em>
        </div>
      </div>

      <!-- AZ-EXP-2: Task Decomposition Understanding -->
      <div class="activity-item expertise" data-section="hard">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
          Expertise Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">Task Decomposition Understanding</div>
        <div class="text-text-secondary text-sm">
          <strong>Beginner:</strong> "How small should tasks be?" → Fit in one context<br>
          <strong>Intermediate:</strong> "What's too small?" → When description > code change<br>
          <strong>Advanced:</strong> "How do I improve?" → Review progress.txt after runs<br>
          <strong>Staff:</strong> "Is there a formula?" → No. It's a skill, not a formula.<br>
          <strong>Expert:</strong> "Invisible errors?" → Tasks with hidden dependencies
        </div>
      </div>

      <!-- AZ-FRONT-2: Auto dependency ordering -->
      <div class="activity-item frontier" data-section="hard">
        <div class="activity-label" style="color: #ef4444;">
          <i data-lucide="flask-conical" class="w-4 h-4"></i>
          Research Frontier
        </div>
        <div class="font-medium text-text-primary mb-2">UNSOLVED: Automatic Dependency Ordering</div>
        <div class="text-text-secondary text-sm">
          Can the agent figure out story order from code analysis?<br><br>
          <strong>Current state:</strong> Partial in some variants. Human ordering still required for reliability.
        </div>
      </div>

      <!-- ========== WHEN SECTION (2 items) ========== -->

      <!-- AZ-INVL-3: What if used for "make it pretty" -->
      <div class="activity-item inversion" data-section="when">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if you used Ralph for "make it pretty"?</div>
        <div class="text-text-secondary text-sm">
          No acceptance criteria → no verification → false "done"<br>
          Claude claims complete → you disagree → frustration<br>
          Overnight run produces 10 "improvements" you hate<br><br>
          <strong>Why this fails:</strong> Ralph requires VERIFIABLE completion.<br>
          <em>"Pretty" is not verifiable. "Passes Lighthouse score 90" is.</em>
        </div>
      </div>

      <!-- AZ-ALT-1: Alternative Paths -->
      <div class="activity-item alternative" data-section="when">
        <div class="activity-label" style="color: #6b7280;">
          <i data-lucide="arrow-right" class="w-4 h-4"></i>
          Alternative Paths
        </div>
        <div class="font-medium text-text-primary mb-2">If Ralph isn't right for your use case</div>
        <div class="text-text-secondary text-sm">
          <strong>Need parallelism?</strong> → CC Mirror<br>
          <strong>Need human review gates?</strong> → HOTL Ralph<br>
          <strong>Need content, not code?</strong> → Ralph Wiggum Marketer<br>
          <strong>Need debugging?</strong> → Single Claude session<br>
          <strong>Need factory scale?</strong> → Gas Town
        </div>
      </div>

    </aside>
  </div>

  <script>
    /**
     * PanelResizer - Handles draggable panel dividers
     */
    class PanelResizer {
      constructor(resizerEl, config = {}) {
        this.resizer = resizerEl;
        this.config = {
          storageKey: 'panel-activity-zone-width',
          minWidth: 280,
          maxWidth: 900,
          defaultWidth: 480,
          ...config
        };

        this.isResizing = false;
        this.startX = 0;
        this.startWidth = 0;

        this.activityZone = document.querySelector('.activity-zone');
        this.mainContent = document.querySelector('.main-content');

        this.onMouseDown = this.onMouseDown.bind(this);
        this.onMouseMove = this.onMouseMove.bind(this);
        this.onMouseUp = this.onMouseUp.bind(this);

        this.init();
      }

      init() {
        this.restoreWidth();
        this.resizer.addEventListener('mousedown', this.onMouseDown);
      }

      onMouseDown(e) {
        if (e.button !== 0) return;

        this.isResizing = true;
        this.startX = e.clientX;
        this.startWidth = this.activityZone.offsetWidth;

        this.resizer.classList.add('active');
        document.body.classList.add('resizing');

        document.addEventListener('mousemove', this.onMouseMove);
        document.addEventListener('mouseup', this.onMouseUp);

        e.preventDefault();
      }

      onMouseMove(e) {
        if (!this.isResizing) return;

        const delta = this.startX - e.clientX;
        const newWidth = this.startWidth + delta;

        const constrainedWidth = Math.max(
          this.config.minWidth,
          Math.min(this.config.maxWidth, newWidth)
        );

        this.activityZone.style.width = constrainedWidth + 'px';
        this.mainContent.style.marginRight = constrainedWidth + 'px';
        this.resizer.style.right = constrainedWidth + 'px';
      }

      onMouseUp(e) {
        if (!this.isResizing) return;

        this.isResizing = false;

        this.resizer.classList.remove('active');
        document.body.classList.remove('resizing');

        document.removeEventListener('mousemove', this.onMouseMove);
        document.removeEventListener('mouseup', this.onMouseUp);

        this.saveWidth();
      }

      saveWidth() {
        const width = this.activityZone.offsetWidth;
        localStorage.setItem(this.config.storageKey, JSON.stringify({
          width,
          timestamp: Date.now()
        }));
      }

      restoreWidth() {
        try {
          const stored = localStorage.getItem(this.config.storageKey);
          if (stored) {
            const { width } = JSON.parse(stored);
            if (width >= this.config.minWidth && width <= this.config.maxWidth) {
              this.activityZone.style.width = width + 'px';
              this.mainContent.style.marginRight = width + 'px';
              this.resizer.style.right = width + 'px';
            }
          }
        } catch (e) {
          console.warn('Failed to restore panel width:', e);
        }
      }

      destroy() {
        this.resizer.removeEventListener('mousedown', this.onMouseDown);
        document.removeEventListener('mousemove', this.onMouseMove);
        document.removeEventListener('mouseup', this.onMouseUp);
      }
    }

    // Auto-initialize resizers
    document.addEventListener('DOMContentLoaded', () => {
      const resizers = document.querySelectorAll('[data-resizer]');
      resizers.forEach(resizer => new PanelResizer(resizer));
    });

    // Initialize Lucide icons
    lucide.createIcons();

    // Navigation toggle
    function toggleSection(header) {
      const section = header.closest('.nav-section');
      section.classList.toggle('expanded');
      const children = section.querySelector('.nav-children');
      children.classList.toggle('expanded');
    }

    // Mobile menu toggle
    function toggleMobileMenu() {
      const nav = document.getElementById('leftNav');
      nav.classList.toggle('open');
    }

    // Copy functionality
    function copyCode(btn, text) {
      navigator.clipboard.writeText(text).then(() => {
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i data-lucide="check" class="w-3 h-3"></i> Copied!';
        lucide.createIcons();
        setTimeout(() => {
          btn.innerHTML = originalText;
          lucide.createIcons();
        }, 2000);
      });
    }

    function copyCodeBlock(btn) {
      const codeBlock = btn.closest('.code-block');
      const pre = codeBlock.querySelector('pre');
      const text = pre.textContent;
      copyCode(btn, text);
    }

    // Scroll-sync with GSAP ScrollTrigger
    gsap.registerPlugin(ScrollTrigger);

    const sections = document.querySelectorAll('[data-activity]');
    const activityItems = document.querySelectorAll('.activity-item');

    sections.forEach(section => {
      ScrollTrigger.create({
        trigger: section,
        start: 'top 40%',
        end: 'bottom 40%',
        onEnter: () => activateSection(section.dataset.activity),
        onEnterBack: () => activateSection(section.dataset.activity),
      });
    });

    function activateSection(sectionName) {
      activityItems.forEach(item => {
        if (item.dataset.section === sectionName) {
          item.classList.add('active');
          gsap.to(item, {
            opacity: 1,
            y: -2,
            boxShadow: '0 4px 12px rgba(0,0,0,0.08)',
            duration: 0.3,
            ease: 'power2.out'
          });
        } else {
          item.classList.remove('active');
          gsap.to(item, {
            opacity: 0.5,
            y: 0,
            boxShadow: 'none',
            duration: 0.3,
            ease: 'power2.out'
          });
        }
      });

      // Update nav active state
      document.querySelectorAll('.nav-section-header').forEach(header => {
        header.classList.remove('active');
      });
      const activeNav = document.querySelector(`[data-section="${sectionName}"] .nav-section-header`);
      if (activeNav) {
        activeNav.classList.add('active');
      }
    }

    // Initialize first section as active
    activateSection('essence');

    // Smooth scroll for nav links
    document.querySelectorAll('.nav-item').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const target = document.querySelector(link.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          document.querySelectorAll('.nav-item').forEach(l => l.classList.remove('active'));
          link.classList.add('active');
        }
      });
    });

    // Brushing interaction - hover activity item highlights related content
    activityItems.forEach(item => {
      item.addEventListener('mouseenter', () => {
        const sectionName = item.dataset.section;
        const relatedSection = document.querySelector(`[data-activity="${sectionName}"]`);
        if (relatedSection) {
          relatedSection.style.backgroundColor = 'rgba(13, 147, 115, 0.05)';
          relatedSection.style.transition = 'background-color 0.3s ease';
        }
      });

      item.addEventListener('mouseleave', () => {
        const sectionName = item.dataset.section;
        const relatedSection = document.querySelector(`[data-activity="${sectionName}"]`);
        if (relatedSection) {
          relatedSection.style.backgroundColor = '';
        }
      });
    });
  </script>
<script src="../../js/global-nav.js"></script>
</body>
</html>
