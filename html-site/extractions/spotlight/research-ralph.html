<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta data-pagefind-meta="section" content="Extractions">
  <meta data-pagefind-meta="category" content="Orchestration">
  <title>Ralph Wiggum Pattern - Comprehensive Research Compendium - Claude Code Knowledge Base</title>
  <link rel="stylesheet" href="../../css/style.css">
  <link rel="stylesheet" href="../../css/sidebar.css">
  <link rel="stylesheet" href="../../css/search.css">
</head>
<body>
  <!-- Search Modal -->
  <div class="search-modal" id="searchModal" aria-hidden="true">
    <div class="search-overlay" onclick="closeSearch()"></div>
    <div class="search-content">
      <div class="search-header">
        <div class="search-input-wrapper">
          <span class="search-icon-input">&#128269;</span>
          <input type="text" id="searchInput" placeholder="Search documentation..." autocomplete="off" />
          <kbd class="search-kbd">ESC</kbd>
        </div>
      </div>
      <div class="search-filters">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="synthesis">Synthesis</button>
        <button class="filter-btn" data-filter="extractions">Extractions</button>
      </div>
      <div class="search-results" id="searchResults">
        <div class="search-empty"><p>Start typing to search... (Press Cmd+K anytime)</p></div>
      </div>
      <div class="search-footer">
        <span>Up/Down Navigate</span><span>Enter Select</span><span>ESC Close</span>
      </div>
    </div>
  </div>

  <button class="search-trigger" onclick="openSearch()" aria-label="Search" style="float: right; margin-bottom: 1rem;">
    <span class="search-icon">Cmd+K</span>
    <span class="search-text">Search</span>
  </button>

  <div class="wide-container">
    <!-- Breadcrumb Navigation -->
    <nav class="nav-breadcrumb">
      <a href="../../index.html">Home</a>
      <span>/</span>
      <a href="../extractions-index.html">Extractions</a>
      <span>/</span>
      <span>Spotlight</span>
      <span>/</span>
      <span>Ralph Research</span>
    </nav>

    <!-- You Are Here Context Box -->
    <div class="you-are-here" style="background: linear-gradient(135deg, #f0ebe3 0%, #fefcf3 100%); border-left: 4px solid #2a7d7d; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
      <h3 style="color: #2a7d7d; margin-top: 0; font-size: 0.9em; text-transform: uppercase; letter-spacing: 0.5px;">You Are Here</h3>
      <p style="margin-bottom: 0;">This is the <strong>canonical Ralph Wiggum pattern research compendium</strong> - exhaustive compilation of the iterative AI agent loop pattern. Use this as the definitive reference when implementing Ralph loops, understanding variants, or troubleshooting issues. This document is THE complete source.</p>
    </div>

    <h1>Ralph Wiggum Pattern - Comprehensive Research Compendium</h1>
    <p class="subtitle" style="color: #5c4b3a; font-size: 1.1em; margin-top: -0.5rem;">The Definitive Reference for Iterative AI Agent Loops</p>

    <p class="conversational-lead">
      <strong>Original Creator:</strong> Geoffrey Huntley (<a href="https://ghuntley.com/ralph/">ghuntley.com/ralph/</a>) | <strong>Named After:</strong> Ralph Wiggum from The Simpsons
    </p>

    <!-- Table of Contents -->
    <div class="toc">
      <div class="toc-title">Contents</div>
      <ul>
        <li><a href="#origin">Origin & Philosophy</a> - Why "Ralph Wiggum"</li>
        <li><a href="#core-mechanism">Core Mechanism</a> - The fundamental loop</li>
        <li><a href="#official-plugin">Official Plugin</a> - Anthropic's implementation</li>
        <li><a href="#bash-scripts">Bash Implementations</a> - Ryan Carson, Matt Pocock</li>
        <li><a href="#prd-strategies">PRD Strategies</a> - Task file templates</li>
        <li><a href="#task-sizing">Task Sizing</a> - The critical factor</li>
        <li><a href="#verification">Verification</a> - Feedback loops</li>
        <li><a href="#variants">Ralph Variants</a> - Forks and extensions</li>
        <li><a href="#integrations">Integration Combos</a> - With Playwright, CC Mirror</li>
        <li><a href="#edge-cases">Edge Cases & Debugging</a> - Common issues</li>
        <li><a href="#cost-analysis">Cost Analysis</a> - Token usage</li>
        <li><a href="#expert-tips">Expert Tips</a> - Community wisdom</li>
        <li><a href="#when-to-use">When to Use</a> - Good vs poor candidates</li>
      </ul>
    </div>

    <hr class="section-divider divider-context">

    <!-- Origin Section -->
    <section id="origin">
      <h2>Origin & Philosophy</h2>

      <p>Named after <strong>Ralph Wiggum</strong> from The Simpsons - the simple-minded child who persists in tasks regardless of obstacles. The pattern embodies:</p>

      <ul>
        <li><strong>Persistence over perfection</strong></li>
        <li><strong>Failures are data, not stops</strong></li>
        <li><strong>Eventually consistent completion</strong></li>
      </ul>

      <blockquote style="border-left: 3px solid #2a7d7d; padding-left: 1rem; margin: 1.5rem 0; font-style: italic; color: #5c4b3a; font-size: 1.1em;">
        "It's a 'we learn from failure'-centric approach. You define your goal condition and let the agent loop over and over until it has verifiably reached that promised goal."
        <cite style="display: block; margin-top: 0.5rem; font-size: 0.9em;">- @arvidkahl</cite>
      </blockquote>

      <blockquote style="border-left: 3px solid #2a7d7d; padding-left: 1rem; margin: 1.5rem 0; font-style: italic; color: #5c4b3a;">
        "It might take 2 minutes or a day. But the loop continues to experiment and look at prior work to ultimately get there."
        <cite style="display: block; margin-top: 0.5rem; font-size: 0.9em;">- @arvidkahl</cite>
      </blockquote>

      <div class="callout callout-insight">
        <div class="callout-title">The Foundational Insight</div>
        <p>"Deterministically bad" failures are predictable and informative. Operator skill (prompting) matters more than model capability alone.</p>
      </div>
    </section>

    <hr class="section-divider divider-procedure">

    <!-- Core Mechanism Section -->
    <section id="core-mechanism">
      <h2>Core Mechanism</h2>

      <h3>The Fundamental Loop</h3>
      <p>At its absolute simplest:</p>
      <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; position: relative; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
        <button class="copy-btn" onclick="copyCode(this)" style="position: absolute; top: 0.5rem; right: 0.5rem; background: #2a7d7d; color: white; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer;">Copy</button>
        <pre style="margin: 0; overflow-x: auto;"><code>while :; do cat PROMPT.md | claude ; done</code></pre>
      </div>
      <p>Everything else is scaffolding around this pattern.</p>

      <h3>How It Works</h3>
      <div class="ascii-diagram">
1. Start with fresh context
         |
2. Read task state from files
   (prd.json, progress.txt, git history)
         |
3. Pick highest priority incomplete task
         |
4. Implement task
         |
5. Run verification (tests, typecheck)
         |
6. If pass: commit, update prd.json
   If fail: log learnings, try again
         |
7. Append to progress.txt
         |
8. Check completion condition
   All done? -> Output promise -> EXIT
   Not done? -> Loop continues
      </div>

      <h3>The Fresh Context Principle</h3>
      <p><strong>Critical:</strong> Each iteration spawns a NEW Claude instance with NO memory of previous work.</p>

      <p>Continuity comes entirely from:</p>
      <ul>
        <li><strong>Git history</strong> - Code changes persist</li>
        <li><strong>prd.json</strong> - Task status (passes: true/false)</li>
        <li><strong>progress.txt</strong> - Learnings, patterns, gotchas</li>
        <li><strong>File system</strong> - The codebase itself</li>
      </ul>

      <p>This avoids:</p>
      <ul>
        <li>Context window overflow</li>
        <li>"Context rot" (LLMs get stupider with more tokens)</li>
        <li>Lossy compaction that loses detail</li>
      </ul>
    </section>

    <hr class="section-divider divider-procedure">

    <!-- Official Plugin Section -->
    <section id="official-plugin">
      <h2>Official Plugin Implementation</h2>

      <p><strong>Source:</strong> <code>github.com/anthropics/claude-code/tree/main/plugins/ralph-wiggum</code></p>

      <h3>Quick Start</h3>
      <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; position: relative; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
        <button class="copy-btn" onclick="copyCode(this)" style="position: absolute; top: 0.5rem; right: 0.5rem; background: #2a7d7d; color: white; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer;">Copy</button>
        <pre style="margin: 0; overflow-x: auto;"><code>/ralph-loop "Build a REST API for todos. Requirements: CRUD operations, input validation, tests. Output &lt;promise&gt;COMPLETE&lt;/promise&gt; when done." --completion-promise "COMPLETE" --max-iterations 50</code></pre>
      </div>

      <h3>Commands</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Command</th><th>Purpose</th></tr>
        </thead>
        <tbody>
          <tr><td><code>/ralph-loop "&lt;prompt&gt;" --max-iterations &lt;n&gt; --completion-promise "&lt;text&gt;"</code></td><td>Start autonomous loop</td></tr>
          <tr><td><code>/cancel-ralph</code></td><td>Cancel active loop</td></tr>
        </tbody>
      </table>

      <h3>How the Plugin Works</h3>
      <ol>
        <li>You run <code>/ralph-loop</code> command ONCE with your task description</li>
        <li>Claude Code automatically:
          <ul>
            <li>Works on the task</li>
            <li>Tries to exit</li>
            <li><strong>Stop hook</strong> blocks the exit</li>
            <li>Stop hook feeds the SAME prompt back</li>
            <li>Repeats until completion</li>
          </ul>
        </li>
      </ol>

      <h3>Prompt Writing Best Practices</h3>

      <h4>1. Clear Completion Criteria</h4>
      <div class="callout callout-warning">
        <div class="callout-title">Bad</div>
        <p><code>Build a todo API and make it good.</code></p>
      </div>
      <div class="callout callout-success">
        <div class="callout-title">Good</div>
        <pre style="background: transparent; margin: 0;">Build a REST API for todos.

When complete:
- All CRUD endpoints working
- Input validation in place
- Tests passing (coverage > 80%)
- README with API docs
- Output: &lt;promise&gt;COMPLETE&lt;/promise&gt;</pre>
      </div>

      <h4>2. Self-Correction Instructions</h4>
      <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; position: relative; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
        <button class="copy-btn" onclick="copyCode(this)" style="position: absolute; top: 0.5rem; right: 0.5rem; background: #2a7d7d; color: white; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer;">Copy</button>
        <pre style="margin: 0; overflow-x: auto;"><code>Implement feature X following TDD:
1. Write failing tests
2. Implement feature
3. Run tests
4. If any fail, debug and fix
5. Refactor if needed
6. Repeat until all green
7. Output: &lt;promise&gt;COMPLETE&lt;/promise&gt;</code></pre>
      </div>
    </section>

    <hr class="section-divider divider-procedure">

    <!-- Bash Scripts Section -->
    <section id="bash-scripts">
      <h2>Bash Implementations</h2>

      <h3>Ryan Carson's Implementation</h3>
      <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; position: relative; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
        <button class="copy-btn" onclick="copyCode(this)" style="position: absolute; top: 0.5rem; right: 0.5rem; background: #2a7d7d; color: white; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer;">Copy</button>
        <pre style="margin: 0; overflow-x: auto;"><code>#!/bin/bash
MAX_ITERATIONS=${1:-10}
CURRENT_ITERATION=1

PRD_FILE="prd.json"
PROGRESS_FILE="progress.txt"

# Create feature branch
BRANCH_NAME=$(jq -r '.branchName' $PRD_FILE)
git checkout main && git pull
git checkout -b $BRANCH_NAME || git checkout $BRANCH_NAME

while [ $CURRENT_ITERATION -le $MAX_ITERATIONS ]; do
  echo "Starting Ralph iteration $CURRENT_ITERATION"

  amp @prompt.md

  # Check completion
  if grep -q "&lt;promise&gt;COMPLETE&lt;/promise&gt;" amp_output.txt; then
    echo "All stories complete!"
    break
  fi

  CURRENT_ITERATION=$((CURRENT_ITERATION + 1))
done</code></pre>
      </div>

      <h3>Matt Pocock's Implementation</h3>
      <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; position: relative; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
        <button class="copy-btn" onclick="copyCode(this)" style="position: absolute; top: 0.5rem; right: 0.5rem; background: #2a7d7d; color: white; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer;">Copy</button>
        <pre style="margin: 0; overflow-x: auto;"><code>#!/bin/bash
set -e

MAX_ITERATIONS=$1

for (( i=1; i<=$MAX_ITERATIONS; i++ )); do
  echo "Iteration $i / $MAX_ITERATIONS"

  claude "Review plans/prd.json and plans/progress.txt.
    Mark the right PRD items as passes: true.
    Append your progress to progress.txt.
    Make a git commit of that feature.
    Only work on a single feature.
    If PRD is complete, output PROMISE COMPLETE HERE." | tee output.txt

  if grep -q "PROMISE COMPLETE HERE" output.txt; then
    break
  fi
done</code></pre>
      </div>

      <h3>Maurice Kleine's jq Loop Condition</h3>
      <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; position: relative; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
        <button class="copy-btn" onclick="copyCode(this)" style="position: absolute; top: 0.5rem; right: 0.5rem; background: #2a7d7d; color: white; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer;">Copy</button>
        <pre style="margin: 0; overflow-x: auto;"><code>while jq '.tasks[] | select(.passes == false)' claude-tasks.json | grep -q .; do
  claude --chrome -p echo "[YOUR PROMPT]"
done</code></pre>
      </div>
    </section>

    <hr class="section-divider divider-procedure">

    <!-- PRD Strategies Section -->
    <section id="prd-strategies">
      <h2>PRD Strategies & Templates</h2>

      <h3>Why JSON over Markdown?</h3>
      <p>Per Matt Pocock: "Just copied Anthropic's approach"</p>
      <ul>
        <li><strong>Structured</strong> - easier for LLM to parse/update</li>
        <li><strong>Machine-readable</strong> - can be processed by jq, scripts</li>
        <li><strong>Explicit state</strong> - <code>passes: true/false</code> is unambiguous</li>
      </ul>

      <h3>Basic prd.json Template</h3>
      <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; position: relative; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
        <button class="copy-btn" onclick="copyCode(this)" style="position: absolute; top: 0.5rem; right: 0.5rem; background: #2a7d7d; color: white; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer;">Copy</button>
        <pre style="margin: 0; overflow-x: auto;"><code>{
  "project": "Project Name",
  "branchName": "ralph/feature-name",
  "description": "Feature description",
  "userStories": [
    {
      "id": "US-001",
      "title": "Task title",
      "description": "As a [user], I need [what]",
      "acceptanceCriteria": [
        "Criterion 1",
        "Criterion 2",
        "npm run typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    }
  ]
}</code></pre>
      </div>

      <h3>Story Ordering: Dependencies First</h3>
      <ol>
        <li>Schema/database changes (migrations)</li>
        <li>Server actions / backend logic</li>
        <li>UI components that use the backend</li>
        <li>Dashboard/summary views that aggregate</li>
      </ol>

      <h3>Acceptance Criteria: Must Be Verifiable</h3>
      <div class="callout callout-success">
        <div class="callout-title">Good (verifiable)</div>
        <ul style="margin-bottom: 0;">
          <li>"Add investorType column with default 'cold'"</li>
          <li>"Filter dropdown has options: All, Cold, Friend"</li>
          <li>"npm run typecheck passes"</li>
          <li>"Verify in browser using dev-browser skill"</li>
        </ul>
      </div>
      <div class="callout callout-warning">
        <div class="callout-title">Bad (vague)</div>
        <ul style="margin-bottom: 0;">
          <li>"Works correctly"</li>
          <li>"Good UX"</li>
          <li>"Handles edge cases"</li>
        </ul>
      </div>

      <p><strong>Always include:</strong> <code>"npm run typecheck passes"</code> as final criterion.</p>
    </section>

    <hr class="section-divider divider-procedure">

    <!-- Task Sizing Section -->
    <section id="task-sizing">
      <h2>Task Sizing - The Critical Factor</h2>

      <blockquote style="border-left: 3px solid #c49052; padding-left: 1rem; margin: 1.5rem 0; color: #5c4b3a;">
        "Context rot: LLMs get stupider with more tokens"
        <cite style="display: block; margin-top: 0.5rem; font-size: 0.9em;">- @mattpocockuk</cite>
      </blockquote>

      <h3>The Golden Rule</h3>
      <p><strong>Each task must be completable in ONE iteration (~one context window)</strong></p>

      <h3>Right-Sized Tasks</h3>
      <ul>
        <li>Add a database column + migration</li>
        <li>Add a UI component to an existing page</li>
        <li>Update a server action with new logic</li>
        <li>Add a filter dropdown to a list</li>
        <li>Write tests for one module</li>
        <li>Implement one API endpoint</li>
      </ul>

      <h3>Too Big (Split These)</h3>
      <ul>
        <li>"Build the entire dashboard" - Split: schema, queries, UI, filters</li>
        <li>"Add authentication" - Split: schema, middleware, login UI, sessions</li>
        <li>"Refactor the API" - Split: one story per endpoint</li>
        <li>"Create e-commerce flow" - Split: cart, checkout, payment, confirmation</li>
      </ul>

      <div class="callout callout-insight">
        <div class="callout-title">Rule of Thumb</div>
        <p>"If you can't describe it in 2-3 sentences, it's too big." - @ryancarson</p>
      </div>
    </section>

    <hr class="section-divider divider-procedure">

    <!-- Verification Section -->
    <section id="verification">
      <h2>Feedback Loops & Verification</h2>

      <blockquote style="border-left: 3px solid #c97065; padding-left: 1rem; margin: 1.5rem 0; color: #5c4b3a;">
        "Without verification, Ralph produces garbage."
        <cite style="display: block; margin-top: 0.5rem; font-size: 0.9em;">- @mattpocockuk</cite>
      </blockquote>

      <h3>Verification Hierarchy</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Priority</th><th>Method</th><th>Use Case</th></tr>
        </thead>
        <tbody>
          <tr><td>1</td><td>Type checking</td><td><code>pnpm typecheck</code> - Always</td></tr>
          <tr><td>2</td><td>Unit tests</td><td><code>pnpm test</code> - For logic</td></tr>
          <tr><td>3</td><td>CI green</td><td>Every commit must pass</td></tr>
          <tr><td>4</td><td>Browser automation</td><td>Playwright MCP for UI</td></tr>
          <tr><td>5</td><td>Manual spot-check</td><td>Human review at milestones</td></tr>
        </tbody>
      </table>

      <div class="callout callout-warning">
        <div class="callout-title">Keep CI Green</div>
        <p>"If you don't do this, you're hamstringing future agent runs with bad code, and they'll need to bisect to find bugs. Super nasty." - @mattpocockuk</p>
      </div>
    </section>

    <hr class="section-divider divider-procedure">

    <!-- Variants Section -->
    <section id="variants">
      <h2>Ralph Variants & Forks</h2>

      <table class="comparison-table">
        <thead>
          <tr><th>Variant</th><th>Author</th><th>Purpose</th></tr>
        </thead>
        <tbody>
          <tr><td><strong>Marathon Ralph</strong></td><td>@gruckion</td><td>Full SDLC with E2E tests</td></tr>
          <tr><td><strong>Dr. Ralph</strong></td><td>@MikeEndale</td><td>Multi-phase with confidence thresholds</td></tr>
          <tr><td><strong>Lisa</strong></td><td>@petruarakiss</td><td>Logging + progress tracking</td></tr>
          <tr><td><strong>Zeroshot</strong></td><td>@covibes</td><td>"Next gen" version</td></tr>
          <tr><td><strong>Ralph Marketer</strong></td><td>@koylanai</td><td>Self-critiquing content loop</td></tr>
          <tr><td><strong>Ralph Orchestrator</strong></td><td>@mikeyobrien</td><td>Multi-agent coordination</td></tr>
          <tr><td><strong>Rate-Limited Ralph</strong></td><td>@ghuntley</td><td>API rate limit handling</td></tr>
        </tbody>
      </table>

      <h3>Ralph Marketer (Notable Innovation)</h3>
      <p>Key innovation: <strong>Separation of Discovery vs Synthesis</strong> - Don't let AI discover (hallucinates). Pre-populate SQLite DB with content, then AI synthesizes.</p>
      <div class="ascii-diagram">
DISCOVER -> LEARN -> RESEARCH -> IDEATE -> WRITE -> CRITIQUE
                                                       |
                                              "Would founder publish?"
                                                       |
                                                No -> ITERATE
                                               Yes -> PUBLISH
      </div>
    </section>

    <hr class="section-divider divider-procedure">

    <!-- Integrations Section -->
    <section id="integrations">
      <h2>Integration Combos</h2>

      <h3>Opus 4.5 + Ralph + Playwright = "AGI"</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Component</th><th>Role</th></tr>
        </thead>
        <tbody>
          <tr><td><strong>Opus 4.5</strong></td><td>Strong underlying model for reasoning</td></tr>
          <tr><td><strong>Ralph Wiggum</strong></td><td>Iterative loop that persists through failures</td></tr>
          <tr><td><strong>Playwright</strong></td><td>Browser automation for real-world verification</td></tr>
        </tbody>
      </table>

      <div class="callout callout-warning">
        <div class="callout-title">Critical Optimization</div>
        <p>"The feedback loop is everything, but put costly tools like browser control in subagents to protect your main context window tokens" - @TendiesOfWisdom</p>
      </div>

      <h3>Ralph + CC Mirror Orchestration</h3>
      <ol>
        <li>Use CC Mirror for task decomposition</li>
        <li>Each agent uses Ralph for its assigned task</li>
        <li>TaskCreate/TaskUpdate for coordination</li>
        <li>Parallel Ralph loops on separate branches</li>
      </ol>
    </section>

    <hr class="section-divider divider-warning">

    <!-- Edge Cases Section -->
    <section id="edge-cases">
      <h2>Edge Cases & Debugging</h2>

      <h3>Common Failure Modes</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Problem</th><th>Symptom</th><th>Fix</th></tr>
        </thead>
        <tbody>
          <tr><td>Stories Too Large</td><td>Context overflow, broken code</td><td>Split into smaller stories (2-3 sentence rule)</td></tr>
          <tr><td>Weak Tests</td><td>Errors compound across iterations</td><td>Require typecheck + tests in every acceptance criteria</td></tr>
          <tr><td>No Browser Verification</td><td>UI changes claimed complete but broken</td><td>Add Playwright verification to acceptance criteria</td></tr>
          <tr><td>Non-Idempotent Migrations</td><td>Database in inconsistent state</td><td>Test migrations, add rollback capability</td></tr>
        </tbody>
      </table>

      <h3>Debugging Commands</h3>
      <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; position: relative; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
        <button class="copy-btn" onclick="copyCode(this)" style="position: absolute; top: 0.5rem; right: 0.5rem; background: #2a7d7d; color: white; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer;">Copy</button>
        <pre style="margin: 0; overflow-x: auto;"><code># Check progress.txt history
tail -50 progress.txt

# Review git history
git log --oneline -20

# Inspect prd.json state
jq '.userStories[] | select(.passes == false)' prd.json</code></pre>
      </div>

      <h3>Recovery from Bad State</h3>
      <div class="code-block" style="background: #f0ebe3; border-radius: 6px; padding: 1rem; position: relative; font-family: 'SF Mono', Monaco, monospace; margin: 1rem 0;">
        <button class="copy-btn" onclick="copyCode(this)" style="position: absolute; top: 0.5rem; right: 0.5rem; background: #2a7d7d; color: white; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer;">Copy</button>
        <pre style="margin: 0; overflow-x: auto;"><code># Reset to last known good
git log --oneline -10
git reset --hard &lt;good-commit&gt;

# Clear progress
echo "# Resetting from bad state" > progress.txt

# Update PRD - manually set passes: false on unfinished items

# Resume
./ralph.sh 10</code></pre>
      </div>
    </section>

    <hr class="section-divider divider-procedure">

    <!-- Cost Analysis Section -->
    <section id="cost-analysis">
      <h2>Cost Analysis</h2>

      <h3>Token Usage Per Iteration</h3>
      <ul>
        <li>PRD read: ~500-2000 tokens</li>
        <li>Progress read: ~200-1000 tokens</li>
        <li>Task implementation: ~2000-10000 tokens</li>
        <li>Verification: ~500-2000 tokens</li>
        <li>Commit/update: ~200-500 tokens</li>
      </ul>
      <p><strong>Per iteration estimate:</strong> 3,000-15,000 tokens</p>

      <h3>Cost Estimates</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Iterations</th><th>Tokens (est.)</th><th>Cost @ $15/M</th></tr>
        </thead>
        <tbody>
          <tr><td>10</td><td>30K-150K</td><td>$0.45-$2.25</td></tr>
          <tr><td>25</td><td>75K-375K</td><td>$1.13-$5.63</td></tr>
          <tr><td>50</td><td>150K-750K</td><td>$2.25-$11.25</td></tr>
          <tr><td>100</td><td>300K-1.5M</td><td>$4.50-$22.50</td></tr>
        </tbody>
      </table>

      <h3>Cost Optimization</h3>
      <ol>
        <li><strong>Use subagents for expensive tools</strong> (Playwright, etc.)</li>
        <li><strong>Keep PRD compact</strong> - only active stories</li>
        <li><strong>Prune progress.txt periodically</strong> - archive old learnings</li>
        <li><strong>Right-size tasks</strong> - fewer iterations needed</li>
        <li><strong>Set max-iterations</strong> - prevent runaway</li>
      </ol>
    </section>

    <hr class="section-divider divider-procedure">

    <!-- Expert Tips Section -->
    <section id="expert-tips">
      <h2>Expert Tips Collection</h2>

      <blockquote style="border-left: 3px solid #2a7d7d; padding-left: 1rem; margin: 1.5rem 0; font-style: italic; color: #5c4b3a;">
        "Ralph puts you in the seat of the requirements gatherer... instead of focusing on how it's going to be done, just focus on what it needs to do and how it should behave once complete."
        <cite style="display: block; margin-top: 0.5rem; font-size: 0.9em;">- @mattpocockuk</cite>
      </blockquote>

      <blockquote style="border-left: 3px solid #2a7d7d; padding-left: 1rem; margin: 1.5rem 0; font-style: italic; color: #5c4b3a;">
        "Adjust the PRD, set passes to 'false', run Ralph again"
        <cite style="display: block; margin-top: 0.5rem; font-size: 0.9em;">- @mattpocockuk (for handling wrong decisions)</cite>
      </blockquote>

      <blockquote style="border-left: 3px solid #c49052; padding-left: 1rem; margin: 1.5rem 0; font-style: italic; color: #5c4b3a;">
        "A word of warning that it doesn't take the place of good planning and context engineering phases... why burn tokens on brute force"
        <cite style="display: block; margin-top: 0.5rem; font-size: 0.9em;">- @seltzergenius</cite>
      </blockquote>

      <blockquote style="border-left: 3px solid #6b9b7a; padding-left: 1rem; margin: 1.5rem 0; font-style: italic; color: #5c4b3a;">
        "Iteration > Perfection - Don't aim for perfect on first try; let the loop refine work"
        <cite style="display: block; margin-top: 0.5rem; font-size: 0.9em;">- Official Plugin Docs</cite>
      </blockquote>
    </section>

    <hr class="section-divider divider-checkpoint">

    <!-- When to Use Section -->
    <section id="when-to-use">
      <h2>When to Use Ralph</h2>

      <h3>Good Candidates</h3>
      <ul>
        <li>Well-defined goals with verifiable completion</li>
        <li>Mechanical, repetitive tasks</li>
        <li>Migrations (e.g., Jest to Vitest)</li>
        <li>Architecture implementation</li>
        <li>Feature development with clear specs</li>
        <li>Tasks with automatic verification (tests, linters)</li>
        <li>Greenfield projects where you can walk away</li>
        <li>Overnight work on well-scoped features</li>
      </ul>

      <h3>Poor Candidates</h3>
      <ul>
        <li>Ambiguous/subjective tasks ("make this pretty")</li>
        <li>Security-sensitive code requiring human review</li>
        <li>Tasks without clear success criteria</li>
        <li>One-shot operations</li>
        <li>Production debugging requiring human judgment</li>
        <li>Tasks requiring design decisions</li>
        <li>Exploratory work without defined end state</li>
      </ul>
    </section>

    <!-- Synthesis -->
    <div class="milestone" style="background: linear-gradient(90deg, #6b9b7a 0%, #2a7d7d 100%); color: white; padding: 1rem 1.5rem; border-radius: 8px; text-align: center; margin: 2rem 0;">
      Fresh context per iteration. External memory via git/files. Small verifiable tasks. Failures as data. Verification mandatory. Eventual consistency over perfect first attempts.
    </div>

    <!-- Pre-Flight Checklist -->
    <div class="checkpoint" style="background: #f0ebe3; border-left: 4px solid #6b9b7a; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
      <div class="checkpoint-header" style="color: #6b9b7a; font-weight: 600;">Pre-Flight Checklist</div>
      <ul style="list-style: none; padding-left: 0;">
        <li>[ ] Tasks are small enough (2-3 sentence rule)</li>
        <li>[ ] Dependencies ordered correctly</li>
        <li>[ ] Acceptance criteria are verifiable</li>
        <li>[ ] Tests exist or will be created</li>
        <li>[ ] Git branch created</li>
        <li>[ ] progress.txt initialized</li>
        <li>[ ] Max iterations set</li>
        <li>[ ] Verification commands work (npm test, etc.)</li>
      </ul>
    </div>

    <!-- Related Pages -->
    <div class="related-pages" style="margin-top: 2rem; padding: 1rem; background: #f9f6f0; border-radius: 8px;">
      <h4 style="margin-top: 0;">Related Documents</h4>
      <ul>
        <li><a href="ralph-implementation.html">Ralph Implementation Guide</a> - Ryan Carson's production setup</li>
        <li><a href="ralph-compounding.html">Ralph Compounding Runs</a> - Learning across sessions</li>
        <li><a href="../../synthesis/mastery-ralph-complete.html">Ralph Mastery Guide</a> - Synthesized best practices</li>
        <li><a href="research-gastown.html">Gas Town Research</a> - Alternative orchestration pattern</li>
      </ul>
    </div>

    <!-- Footer Navigation -->
    <div class="footer-nav" style="display: flex; justify-content: space-between; margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #e0d5c5;">
      <a href="ccswarm-rust.html">Prev: CCSwarm Rust</a>
      <a href="research-gastown.html">Next: Gas Town Research</a>
    </div>

  </div>

  <script src="../../js/copy-code.js"></script>
  <script src="../../js/search.js"></script>
  <script>
    function copyCode(button) {
      const codeBlock = button.parentElement.querySelector('code');
      navigator.clipboard.writeText(codeBlock.textContent);
      button.textContent = 'Copied!';
      setTimeout(() => button.textContent = 'Copy', 2000);
    }
  </script>
<script src="../../js/global-nav.js"></script>
</body>
</html>
