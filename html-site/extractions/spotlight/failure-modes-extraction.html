<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Failure Modes Catalog | Claude Code Documentation</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Lucide Icons CDN -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- GSAP for scroll-sync -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

  <!-- Tailwind Config with Design Tokens -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'bg-base': '#ffffff',
            'bg-subtle': '#fafafa',
            'bg-muted': '#f4f4f5',
            'text-primary': '#18181b',
            'text-secondary': '#3f3f46',
            'text-muted': '#71717a',
            'accent': '#0D9373',
            'accent-light': '#10b981',
            'accent-bg': '#ecfdf5',
            'border': '#e4e4e7',
            // Activity Zone content type colors (Original 6)
            'az-invariant': '#3b82f6',    // Blue
            'az-effect': '#f59e0b',       // Amber
            'az-composition': '#8b5cf6',  // Purple
            'az-frontier': '#ef4444',     // Red
            'az-warstory': '#10b981',     // Green
            'az-alternative': '#6b7280',  // Gray
            // Activity Zone generative content types (New 10)
            'az-inversion': '#4f46e5',    // Indigo
            'az-constraint': '#8b5cf6',   // Violet
            'az-gradient': '#f43f5e',     // Rose
            'az-horizon': '#06b6d4',      // Cyan
            'az-violation': '#f97316',    // Orange
            'az-tradeoff': '#f59e0b',     // Amber
            'az-analogy': '#d946ef',      // Fuchsia
            'az-expertise': '#10b981',    // Emerald
            'az-minimal': '#84cc16',      // Lime
            'az-inflection': '#eab308',   // Yellow
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
            mono: ['Fira Code', 'monospace'],
          },
        },
      },
    }
  </script>

  <style>
    /* Base Styles */
    * {
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
      scroll-padding-top: 80px;
    }

    [id] {
      scroll-margin-top: 80px;
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: #ffffff;
      color: #18181b;
      line-height: 1.7;
    }

    /* Three Panel Layout */
    .three-panel-layout {
      min-height: 100vh;
      position: relative;
    }

    /* Header */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 56px;
      background: #ffffff;
      border-bottom: 1px solid #e4e4e7;
      z-index: 100;
      display: flex;
      align-items: center;
      padding: 0 24px;
    }

    /* Left Navigation - 240px fixed */
    .left-nav {
      position: fixed;
      top: 56px;
      left: 0;
      width: 240px;
      height: calc(100vh - 56px);
      border-right: 1px solid #e4e4e7;
      background: #ffffff;
      overflow-y: auto;
      padding: 16px 0;
      z-index: 40;
    }

    .nav-section {
      padding: 0 12px;
      margin-bottom: 8px;
    }

    .nav-section-header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      font-size: 14px;
      font-weight: 500;
      color: #3f3f46;
      cursor: pointer;
      border-radius: 6px;
      transition: background 0.15s;
    }

    .nav-section-header:hover {
      background: #f4f4f5;
    }

    .nav-section-header.active {
      color: #0D9373;
      background: #ecfdf5;
    }

    .nav-item {
      display: block;
      padding: 6px 12px 6px 44px;
      font-size: 14px;
      color: #71717a;
      text-decoration: none;
      border-radius: 6px;
      transition: all 0.15s;
    }

    .nav-item:hover {
      color: #3f3f46;
      background: #f4f4f5;
    }

    .nav-item.active {
      color: #0D9373;
      background: #ecfdf5;
    }

    .nav-children {
      display: none;
      overflow: hidden;
    }

    .nav-children.expanded {
      display: block;
    }

    .nav-chevron {
      transition: transform 0.2s;
    }

    .nav-section.expanded .nav-chevron {
      transform: rotate(90deg);
    }

    /* Main Content - Flexible, margins for fixed sidebars */
    .main-content {
      margin-left: 240px;
      margin-right: 480px;
      margin-top: 56px;
      padding: 48px 48px;
      min-width: 400px;
    }

    /* Activity Zone - 480px fixed */
    .activity-zone {
      position: fixed;
      top: 56px;
      right: 0;
      width: 480px;
      height: calc(100vh - 56px);
      border-left: 1px dashed #e4e4e7;
      background: #fafafa;
      overflow-y: auto;
      padding: 24px 20px;
      z-index: 40;
    }

    /* Responsive: Hide Activity Zone below 1400px */
    @media (max-width: 1400px) {
      .activity-zone {
        display: none;
      }
      .main-content {
        margin-right: 0;
        padding: 40px 32px;
      }
    }

    /* Responsive: Hide Left Nav below 768px */
    @media (max-width: 768px) {
      .left-nav {
        display: none;
      }
      .left-nav.open {
        display: block;
        position: fixed;
        top: 56px;
        left: 0;
        right: 0;
        bottom: 0;
        background: #ffffff;
        z-index: 50;
        overflow-y: auto;
      }
      .main-content {
        margin-left: 0;
        padding: 24px 16px;
        min-width: auto;
      }
    }

    /* Resizer */
    .resizer {
      position: fixed;
      top: 56px;
      right: 480px;
      width: 6px;
      height: calc(100vh - 56px);
      cursor: col-resize;
      background: transparent;
      z-index: 50;
      transition: background 0.15s ease;
    }

    .resizer:hover {
      background: rgba(13, 147, 115, 0.15);
    }

    .resizer.active {
      background: rgba(13, 147, 115, 0.25);
    }

    body.resizing {
      user-select: none;
      cursor: col-resize !important;
    }

    body.resizing * {
      cursor: col-resize !important;
    }

    @media (max-width: 1400px) {
      .resizer {
        display: none;
      }
    }

    /* Activity Zone Items */
    .activity-item {
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      background: #ffffff;
      border: 1px solid #e4e4e7;
      font-size: 14px;
      line-height: 1.6;
      opacity: 0.5;
      transition: all 0.3s ease;
    }

    .activity-item.active {
      opacity: 1;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .activity-item:hover {
      opacity: 1;
    }

    .activity-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    /* Activity Zone content type borders */
    .activity-item.invariant { border-left: 4px solid #3b82f6; }
    .activity-item.effect { border-left: 4px solid #f59e0b; }
    .activity-item.composition { border-left: 4px solid #8b5cf6; }
    .activity-item.frontier { border-left: 4px solid #ef4444; }
    .activity-item.warstory { border-left: 4px solid #10b981; }
    .activity-item.alternative { border-left: 4px solid #6b7280; }
    .activity-item.inversion { border-left: 4px solid #4f46e5; }
    .activity-item.constraint { border-left: 4px solid #8b5cf6; }
    .activity-item.gradient { border-left: 4px solid #f43f5e; }
    .activity-item.horizon { border-left: 4px solid #06b6d4; }
    .activity-item.violation { border-left: 4px solid #f97316; }
    .activity-item.tradeoff { border-left: 4px solid #f59e0b; }
    .activity-item.analogy { border-left: 4px solid #d946ef; }
    .activity-item.expertise { border-left: 4px solid #10b981; }
    .activity-item.minimal { border-left: 4px solid #84cc16; }
    .activity-item.inflection { border-left: 4px solid #eab308; }

    /* Main Content Components */
    .section-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      background: #0D9373;
      color: #ffffff;
      font-size: 14px;
      font-weight: 600;
      border-radius: 50%;
      margin-right: 12px;
    }

    .section-title {
      font-size: 24px;
      font-weight: 600;
      color: #18181b;
      margin-bottom: 20px;
      margin-top: 56px;
      display: flex;
      align-items: center;
    }

    .section-title:first-child {
      margin-top: 0;
    }

    /* Essence Box */
    .essence-box {
      background: linear-gradient(135deg, #18181b 0%, #27272a 100%);
      border-radius: 12px;
      padding: 32px;
      margin-bottom: 40px;
    }

    .essence-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #ef4444;
      margin-bottom: 12px;
    }

    .essence-text {
      font-size: 22px;
      font-weight: 500;
      color: #ffffff;
      line-height: 1.4;
    }

    /* Core Abstraction Box */
    .core-abstraction {
      background: #fafafa;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 40px;
    }

    .core-philosophy {
      font-size: 16px;
      color: #3f3f46;
      margin-bottom: 16px;
      font-style: italic;
    }

    .core-code {
      background: #18181b;
      border-radius: 8px;
      padding: 16px 20px;
      margin-bottom: 16px;
      overflow-x: auto;
    }

    .core-code code {
      font-family: 'Fira Code', monospace;
      font-size: 15px;
      color: #ef4444;
      white-space: nowrap;
    }

    .core-anchor {
      font-size: 14px;
      color: #71717a;
      text-align: center;
    }

    /* Failure Category Box */
    .failure-category {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-left: 4px solid #ef4444;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .failure-category-title {
      font-weight: 600;
      color: #991b1b;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .failure-category-detail {
      font-size: 14px;
      color: #7f1d1d;
      margin-bottom: 8px;
    }

    /* Design Decision Box */
    .decision-box {
      background: #ffffff;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
    }

    .decision-why {
      font-size: 16px;
      font-weight: 600;
      color: #0D9373;
      margin-bottom: 12px;
    }

    .decision-reasoning {
      font-size: 14px;
      color: #3f3f46;
      margin-bottom: 16px;
    }

    .decision-implication {
      background: #f4f4f5;
      border-radius: 8px;
      padding: 16px;
    }

    .decision-implication-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      color: #71717a;
      margin-bottom: 8px;
    }

    /* Code Blocks */
    .code-block {
      background: #18181b;
      border-radius: 8px;
      padding: 16px 20px;
      margin-bottom: 24px;
      position: relative;
      overflow-x: auto;
    }

    .code-block pre {
      margin: 0;
      font-family: 'Fira Code', monospace;
      font-size: 13px;
      color: #e4e4e7;
      line-height: 1.6;
    }

    .code-block .comment { color: #6b7280; }
    .code-block .keyword { color: #c084fc; }
    .code-block .string { color: #10b981; }
    .code-block .variable { color: #60a5fa; }

    .copy-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: #3f3f46;
      color: #ffffff;
      border: none;
      border-radius: 4px;
      padding: 6px 10px;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: background 0.15s;
    }

    .copy-btn:hover {
      background: #52525b;
    }

    /* Path Steps */
    .path-container {
      background: #fafafa;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 40px;
    }

    .path-step {
      display: flex;
      gap: 16px;
      margin-bottom: 16px;
    }

    .path-step:last-child {
      margin-bottom: 0;
    }

    .path-number {
      flex-shrink: 0;
      width: 24px;
      height: 24px;
      background: #0D9373;
      color: #ffffff;
      font-size: 12px;
      font-weight: 600;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .path-content {
      flex: 1;
      font-size: 14px;
      color: #3f3f46;
    }

    .path-content code {
      background: #e4e4e7;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 13px;
    }

    /* Gotcha Box */
    .gotcha-box {
      background: #fffbeb;
      border: 1px solid #fcd34d;
      border-left: 4px solid #f59e0b;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .gotcha-title {
      font-weight: 600;
      color: #92400e;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .gotcha-detail {
      font-size: 14px;
      color: #78350f;
      margin-bottom: 8px;
    }

    .gotcha-detail strong {
      color: #92400e;
    }

    /* What's Hard Box */
    .hard-box {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-left: 4px solid #ef4444;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .hard-title {
      font-weight: 600;
      color: #991b1b;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .hard-detail {
      font-size: 14px;
      color: #7f1d1d;
      margin-bottom: 8px;
    }

    /* When To Use Grid */
    .when-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 40px;
    }

    @media (max-width: 900px) {
      .when-grid {
        grid-template-columns: 1fr;
      }
    }

    .when-use {
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      border-radius: 12px;
      padding: 24px;
    }

    .when-not {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: 12px;
      padding: 24px;
    }

    .when-title {
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .when-use .when-title { color: #166534; }
    .when-not .when-title { color: #991b1b; }

    .when-item {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      font-size: 14px;
    }

    .when-use .when-item { color: #166534; }
    .when-not .when-item { color: #991b1b; }

    /* Mobile Menu Button */
    .mobile-menu-btn {
      display: none;
      padding: 8px;
      background: none;
      border: none;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .mobile-menu-btn {
        display: flex;
      }
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: #fafafa;
    }

    ::-webkit-scrollbar-thumb {
      background: #d4d4d8;
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #a1a1aa;
    }

    /* Keyboard shortcut hint */
    .kbd {
      display: inline-flex;
      align-items: center;
      padding: 2px 6px;
      background: #f4f4f5;
      border: 1px solid #e4e4e7;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 12px;
      color: #71717a;
    }

    /* Severity badges */
    .severity-badge {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .severity-p0 {
      background: #fef2f2;
      color: #991b1b;
    }

    .severity-p1 {
      background: #fffbeb;
      color: #92400e;
    }

    .severity-p2 {
      background: #f0f9ff;
      color: #0369a1;
    }

    /* Triage table */
    .triage-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 24px;
    }

    .triage-table th,
    .triage-table td {
      border: 1px solid #e4e4e7;
      padding: 12px;
      text-align: left;
      font-size: 14px;
    }

    .triage-table th {
      background: #fafafa;
      font-weight: 600;
    }

    .triage-table tr:hover {
      background: #fafafa;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle menu">
      <i data-lucide="menu" class="w-5 h-5 text-text-secondary"></i>
    </button>
    <div class="flex items-center gap-3">
      <i data-lucide="alert-octagon" class="w-5 h-5 text-red-500"></i>
      <span class="font-semibold text-text-primary">Claude Code</span>
    </div>
    <div class="flex-1 flex justify-center">
      <button class="flex items-center gap-2 px-4 py-2 bg-bg-muted rounded-lg text-text-muted text-sm hover:bg-border transition-colors">
        <i data-lucide="search" class="w-4 h-4"></i>
        <span>Search documentation...</span>
        <span class="kbd">Cmd+K</span>
      </button>
    </div>
    <div class="flex items-center gap-4">
      <a href="#" class="text-sm text-text-muted hover:text-text-primary transition-colors">Support</a>
      <button class="p-2 hover:bg-bg-muted rounded-lg transition-colors" aria-label="Toggle theme">
        <i data-lucide="sun" class="w-4 h-4 text-text-muted"></i>
      </button>
    </div>
  </header>

  <div class="three-panel-layout">
    <!-- Left Navigation -->
    <nav class="left-nav" id="leftNav">
      <div class="nav-content"></div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">

      <!-- Section 1: ESSENCE -->
      <section id="essence" data-activity="essence">
        <div class="essence-box">
          <div class="essence-label">Essence (15 words)</div>
          <div class="essence-text">Nine failure categories with symptoms, root causes, and copy-paste recovery scripts for Claude Code.</div>
        </div>
      </section>

      <!-- Section 2: CORE ABSTRACTION + IMPLEMENTATION -->
      <section id="core-abstraction" data-activity="core">
        <h2 class="section-title">
          <span class="section-number">2</span>
          The Failure Taxonomy
        </h2>

        <div class="core-abstraction">
          <div class="core-philosophy">"Everything that can go wrong, why it happens, and how to recover."</div>

          <div class="core-code">
            <button class="copy-btn" onclick="copyCode(this, 'Symptom -> Category -> Root Cause -> Recovery')">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <code>Symptom -> Category -> Root Cause -> Recovery</code>
          </div>

          <div class="core-anchor">That's the diagnostic framework. Pattern-match your symptom, trace to root cause, apply recovery.</div>
        </div>

        <p class="text-text-secondary mb-6">
          Every failure in Claude Code falls into one of nine categories. Each category has distinct symptoms, shared root causes, and proven recovery procedures. Context failures are most common (~40%), security failures most dangerous, cost failures most expensive.
        </p>

        <div class="failure-category">
          <div class="failure-category-title">
            <span class="severity-badge severity-p0">P0</span>
            1. Context Window Failures
          </div>
          <div class="failure-category-detail"><strong>Symptoms:</strong> Quality degrades, forgotten instructions, hallucinations, truncated outputs</div>
          <div class="failure-category-detail"><strong>Root cause:</strong> Token accumulation beyond 60-70% capacity</div>
          <div class="failure-category-detail"><strong>Recovery:</strong> /compact, /reset, or fresh session</div>
        </div>

        <div class="failure-category">
          <div class="failure-category-title">
            <span class="severity-badge severity-p0">P0</span>
            2. Orchestration Failures
          </div>
          <div class="failure-category-detail"><strong>Symptoms:</strong> Workers spawning workers, orchestrator writing code, infinite loops</div>
          <div class="failure-category-detail"><strong>Root cause:</strong> Role confusion, missing worker preambles</div>
          <div class="failure-category-detail"><strong>Recovery:</strong> Kill processes, add strict role separation</div>
        </div>

        <div class="failure-category">
          <div class="failure-category-title">
            <span class="severity-badge severity-p1">P1</span>
            3. Memory/State Failures
          </div>
          <div class="failure-category-detail"><strong>Symptoms:</strong> Progress lost, files overwritten instead of appended, PRD drift</div>
          <div class="failure-category-detail"><strong>Root cause:</strong> In-context only memory, no external persistence</div>
          <div class="failure-category-detail"><strong>Recovery:</strong> Use progress.txt, prd.json, CLAUDE.md</div>
        </div>

        <div class="failure-category">
          <div class="failure-category-title">
            <span class="severity-badge severity-p1">P1</span>
            4. Verification Failures
          </div>
          <div class="failure-category-detail"><strong>Symptoms:</strong> "Tests pass" but don't run, features marked complete without testing</div>
          <div class="failure-category-detail"><strong>Root cause:</strong> Exit codes not verified, optimistic marking</div>
          <div class="failure-category-detail"><strong>Recovery:</strong> Always include <code>echo "Exit code: $?"</code></div>
        </div>

        <div class="failure-category">
          <div class="failure-category-title">
            <span class="severity-badge severity-p0">P0</span>
            5. Security Failures
          </div>
          <div class="failure-category-detail"><strong>Symptoms:</strong> Catastrophic deletions, credential exposure, path traversal</div>
          <div class="failure-category-detail"><strong>Root cause:</strong> Missing blocklists, no .claudeignore</div>
          <div class="failure-category-detail"><strong>Recovery:</strong> Blocklist dangerous commands, rotate credentials</div>
        </div>

        <div class="failure-category">
          <div class="failure-category-title">
            <span class="severity-badge severity-p0">P0</span>
            6. Cost Failures
          </div>
          <div class="failure-category-detail"><strong>Symptoms:</strong> $500+ bills, rate limits, runaway loops</div>
          <div class="failure-category-detail"><strong>Root cause:</strong> No iteration limits, wrong model selection</div>
          <div class="failure-category-detail"><strong>Recovery:</strong> Set MAX_ITERATIONS, use Haiku for lookups</div>
        </div>

        <div class="failure-category">
          <div class="failure-category-title">
            <span class="severity-badge severity-p1">P1</span>
            7. Ralph Loop Failures
          </div>
          <div class="failure-category-detail"><strong>Symptoms:</strong> Completion never detected, tasks too complex, stuck loops</div>
          <div class="failure-category-detail"><strong>Root cause:</strong> Missing completion signal, wrong task sizing</div>
          <div class="failure-category-detail"><strong>Recovery:</strong> Add &lt;promise&gt;COMPLETE&lt;/promise&gt;, split tasks</div>
        </div>

        <div class="failure-category">
          <div class="failure-category-title">
            <span class="severity-badge severity-p1">P1</span>
            8. Multi-Agent Coordination
          </div>
          <div class="failure-category-detail"><strong>Symptoms:</strong> Merge conflicts, deadlocks, 17x error amplification</div>
          <div class="failure-category-detail"><strong>Root cause:</strong> No isolation, independent agents amplifying errors</div>
          <div class="failure-category-detail"><strong>Recovery:</strong> Use git worktrees, centralize coordination</div>
        </div>

        <div class="failure-category">
          <div class="failure-category-title">
            <span class="severity-badge severity-p2">P2</span>
            9. File System Failures
          </div>
          <div class="failure-category-detail"><strong>Symptoms:</strong> Infinite compaction loops, 200GB debug logs</div>
          <div class="failure-category-detail"><strong>Root cause:</strong> Software bugs in Claude Code versions</div>
          <div class="failure-category-detail"><strong>Recovery:</strong> Update Claude Code, clear debug directory</div>
        </div>
      </section>

      <!-- Section 3: DESIGN DECISIONS -->
      <section id="why-nine-categories" data-activity="decisions">
        <h2 class="section-title">
          <span class="section-number">3</span>
          Design Decisions
        </h2>

        <div class="decision-box">
          <div class="decision-why">WHY 9 CATEGORIES (NOT FEWER/MORE)?</div>
          <div class="decision-reasoning">
            Each category represents a distinct failure mode that requires different diagnostic approaches and recovery procedures. Context failures need fresh sessions. Security failures need credential rotation. Merging would lose this specificity.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              When diagnosing a failure, identify the category FIRST. Each category has a specific recovery playbook. Context issues don't need credential rotation; security issues don't need compaction.
            </div>
          </div>
        </div>

        <div class="decision-box" id="why-context-first">
          <div class="decision-why">WHY CONTEXT FAILURES FIRST?</div>
          <div class="decision-reasoning">
            Context window issues account for approximately 40% of all Claude Code failures. They're also the most insidious because quality degrades gradually. You might not notice until you've committed broken code.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              When something goes wrong, check context first. If you've been working 30+ minutes on complex tasks, context rot is the likely culprit. <code>/compact</code> or reset before investigating other causes.
            </div>
          </div>
        </div>

        <div class="decision-box" id="why-playbooks">
          <div class="decision-why">WHY INCLUDE RECOVERY PLAYBOOKS?</div>
          <div class="decision-reasoning">
            Diagnosis without action is useless. Every failure mode includes a tested recovery procedure. The goal isn't just understanding what went wrong but getting back to productive work quickly.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Copy-paste the recovery scripts. They're designed to work immediately. Don't spend time debugging the debugger. Run the script, verify recovery, resume work.
            </div>
          </div>
        </div>

        <div class="decision-box">
          <div class="decision-why">WHY SEVERITY INDICATORS (P0/P1/P2)?</div>
          <div class="decision-reasoning">
            Triage for production incidents. P0 means stop everything. P2 means schedule a fix. Without severity, you might spend an hour on a P2 while a P0 burns money in the background.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              P0 = Data/money at risk. Stop immediately. P1 = Progress blocked. Fix before continuing. P2 = Quality degraded. Fix when convenient.
            </div>
          </div>
        </div>
      </section>

      <!-- Section 4: FILE STRUCTURE -->
      <section id="file-structure" data-activity="files">
        <h2 class="section-title">
          <span class="section-number">4</span>
          Recovery Scripts
        </h2>

        <div class="code-block">
          <button class="copy-btn" onclick="copyCodeBlock(this)">
            <i data-lucide="copy" class="w-3 h-3"></i>
            Copy
          </button>
          <pre>~/claude-recovery/
<span class="comment">├── diagnostics/              # Identify the problem</span>
│   ├── check-context-level.sh    <span class="comment"># Estimate context usage</span>
│   ├── check-agent-depth.sh      <span class="comment"># Detect recursive spawning</span>
│   ├── check-stuck-loop.sh       <span class="comment"># Detect iteration stalls</span>
│   └── check-cost-runaway.sh     <span class="comment"># Token consumption alerts</span>
<span class="comment">├── recovery/                 # Fix the problem</span>
│   ├── context-overflow.sh       <span class="comment"># Save state, reset, restore</span>
│   ├── infinite-loop.sh          <span class="comment"># Force kill, check progress</span>
│   ├── cost-runaway.sh           <span class="comment"># Kill all, review usage</span>
│   ├── file-corruption.sh        <span class="comment"># Git-based recovery</span>
│   └── multi-agent-chaos.sh      <span class="comment"># Worktree cleanup</span>
<span class="comment">├── prevention/               # Avoid the problem</span>
│   ├── pre-session-checklist.sh  <span class="comment"># Run before starting</span>
│   ├── claudeignore-template     <span class="comment"># Sensitive file exclusions</span>
│   └── blocklist.json            <span class="comment"># Dangerous commands</span>
└── logs/
    └── incident-template.md      <span class="comment"># Post-mortem format</span></pre>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8" id="diagnostic-scripts">Diagnostic Scripts</h3>

        <div class="code-block">
          <button class="copy-btn" onclick="copyCodeBlock(this)">
            <i data-lucide="copy" class="w-3 h-3"></i>
            Copy
          </button>
          <pre><span class="comment">#!/bin/bash</span>
<span class="comment"># check-context-level.sh - Estimate context usage</span>

<span class="comment"># Check conversation length (rough proxy)</span>
<span class="keyword">if</span> [ -f output.txt ]; <span class="keyword">then</span>
  LINES=$(wc -l < output.txt)
  <span class="keyword">if</span> [ "$LINES" -gt 500 ]; <span class="keyword">then</span>
    <span class="keyword">echo</span> <span class="string">"WARNING: Long conversation ($LINES lines)"</span>
    <span class="keyword">echo</span> <span class="string">"Consider /compact or fresh session"</span>
  <span class="keyword">fi</span>
<span class="keyword">fi</span>

<span class="comment"># Check for quality degradation signals</span>
<span class="keyword">if</span> grep -q <span class="string">"I apologize"</span> output.txt 2>/dev/null; <span class="keyword">then</span>
  <span class="keyword">echo</span> <span class="string">"Possible context rot detected"</span>
<span class="keyword">fi</span></pre>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8" id="recovery-scripts">Context Overflow Recovery</h3>

        <div class="code-block">
          <button class="copy-btn" onclick="copyCodeBlock(this)">
            <i data-lucide="copy" class="w-3 h-3"></i>
            Copy
          </button>
          <pre><span class="comment">#!/bin/bash</span>
<span class="comment"># context-overflow.sh - Full recovery procedure</span>

<span class="comment"># 1. Save current state</span>
git add -A && git stash
<span class="keyword">echo</span> <span class="string">"State saved to git stash"</span>

<span class="comment"># 2. Document what you were working on</span>
<span class="keyword">echo</span> <span class="string">"Working on: $1"</span> > /tmp/recovery-notes.txt

<span class="comment"># 3. Kill current session</span>
pkill -f claude 2>/dev/null || true

<span class="comment"># 4. Start fresh session</span>
<span class="keyword">echo</span> <span class="string">"Starting fresh Claude session..."</span>
<span class="keyword">echo</span> <span class="string">"Run: claude"</span>
<span class="keyword">echo</span> <span class="string">"Then: git stash pop"</span></pre>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8">.claudeignore Template</h3>

        <div class="code-block">
          <button class="copy-btn" onclick="copyCodeBlock(this)">
            <i data-lucide="copy" class="w-3 h-3"></i>
            Copy
          </button>
          <pre><span class="comment"># .claudeignore - REQUIRED for every project</span>

<span class="comment"># Secrets (CRITICAL)</span>
.env*
*.pem
*.key
credentials.json
secrets/
.aws/
.ssh/
*.keychain

<span class="comment"># Build outputs (save context)</span>
node_modules/
dist/
build/
.next/
.cache/
coverage/
__pycache__/
*.pyc

<span class="comment"># Logs and debug</span>
*.log
.claude/debug/
.git/</pre>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8">Command Blocklist</h3>

        <div class="code-block">
          <button class="copy-btn" onclick="copyCodeBlock(this)">
            <i data-lucide="copy" class="w-3 h-3"></i>
            Copy
          </button>
          <pre>{
  <span class="string">"permissions"</span>: {
    <span class="string">"blockedPatterns"</span>: [
      <span class="string">"rm -rf"</span>,
      <span class="string">"rmdir /s"</span>,
      <span class="string">"find . -delete"</span>,
      <span class="string">"git push --force"</span>,
      <span class="string">"git reset --hard"</span>,
      <span class="string">"sudo rm"</span>,
      <span class="string">"chmod -R 777"</span>
    ]
  }
}</pre>
        </div>
      </section>

      <!-- Section 5: PATH OF A TASK -->
      <section id="path" data-activity="path">
        <h2 class="section-title">
          <span class="section-number">5</span>
          Path of Recovery: Context Overflow
        </h2>

        <p class="text-text-secondary mb-6">
          Follow a context overflow failure through diagnosis to recovery:
        </p>

        <div class="path-container">
          <div class="path-step">
            <div class="path-number">1</div>
            <div class="path-content"><strong>[T+0min] SYMPTOM DETECTED</strong><br>Claude ignores CLAUDE.md directive, produces generic output</div>
          </div>
          <div class="path-step">
            <div class="path-number">2</div>
            <div class="path-content"><strong>[T+1min] INITIAL DIAGNOSIS</strong><br>Check: How long has session been running? If >30min with complex work, likely context issue</div>
          </div>
          <div class="path-step">
            <div class="path-number">3</div>
            <div class="path-content"><strong>[T+2min] VERIFY HYPOTHESIS</strong><br>Check Claude HUD if available. Look for context indicator >70%</div>
          </div>
          <div class="path-step">
            <div class="path-number">4</div>
            <div class="path-content"><strong>[T+3min] SAVE STATE</strong><br><code>git add -A && git stash</code><br>Document current task in /tmp/recovery-notes.txt</div>
          </div>
          <div class="path-step">
            <div class="path-number">5</div>
            <div class="path-content"><strong>[T+5min] ATTEMPT RECOVERY</strong><br>Run <code>/compact</code>. Test: Does quality improve?</div>
          </div>
          <div class="path-step">
            <div class="path-number">6</div>
            <div class="path-content"><strong>[T+7min] IF RECOVERY FAILED</strong><br>Run <code>/reset</code>. If still bad: <code>exit && claude</code> (fresh session)</div>
          </div>
          <div class="path-step">
            <div class="path-number">7</div>
            <div class="path-content"><strong>[T+10min] RESTORE CONTEXT</strong><br><code>git stash pop</code>. Re-read essential files.</div>
          </div>
          <div class="path-step">
            <div class="path-number">8</div>
            <div class="path-content"><strong>[T+12min] VERIFY RECOVERY</strong><br>Test: Claude follows CLAUDE.md directives?<br>If yes: Resume work. If no: Escalate to fresh environment.</div>
          </div>
        </div>

        <p class="text-text-secondary mt-6">
          <strong>Total recovery time:</strong> 12 minutes. <strong>If you skip steps 4-7:</strong> You'll spend 2+ hours debugging code that was generated from a rotted context.
        </p>
      </section>

      <!-- Section 6: GOTCHAS -->
      <section id="gotchas" data-activity="gotchas">
        <h2 class="section-title">
          <span class="section-number">6</span>
          Gotchas
        </h2>

        <p class="text-text-secondary mb-6">
          Surprises that catch even experienced users:
        </p>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            1. Compaction is lossy (5 min fix)
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Post-compaction behavior changes, edge cases forgotten</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Model decides what's "important" without your priorities</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Re-state critical instructions after compaction. Use CLAUDE.md for must-survive content.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            2. Workers spawn workers ($47K incident)
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Runaway API costs, nested agent depth >2</div>
          <div class="gotcha-detail"><strong>Cause:</strong> No worker preamble blocking subagent creation</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Always include: "Do NOT spawn sub-agents" in worker prompts</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            3. Orchestrator writes code (10 min fix)
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Orchestrator context filled with file contents</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Role confusion, mixing planning and execution</div>
          <div class="gotcha-detail"><strong>Fix:</strong> CC Mirror principle: "YOU DO NOT WRITE CODE. You are the CONDUCTOR."</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            4. Tests "pass" but don't run (1 min fix)
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Exit code 0 but tests never executed</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Output seen, exit code not verified</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Add <code>echo "Exit code: $?"</code> after ALL test commands</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            5. progress.txt overwritten (2 min fix)
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Historical learnings lost, only latest iteration preserved</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Agent interprets "update" as "replace"</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Use explicit language: "APPEND to progress.txt (never overwrite)"</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            6. $47K from recursive loop (PREVENTION ONLY)
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> 11-day unmonitored loop accumulated massive costs</div>
          <div class="gotcha-detail"><strong>Cause:</strong> No MAX_ITERATIONS, no timeout, no monitoring</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Always set MAX_ITERATIONS. Use <code>timeout 3600 ./ralph.sh 50</code></div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            7. Claude references fake files (5 min fix)
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Fabricated file paths, descriptions don't match reality</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Context exhaustion causing hallucinations</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Reset session immediately. Do NOT commit changes from this session.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            8. 200GB debug logs (5 min fix)
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Disk space filling rapidly, system slowdown</div>
          <div class="gotcha-detail"><strong>Cause:</strong> GitHub Issue #16093 - infinite recursive logging</div>
          <div class="gotcha-detail"><strong>Fix:</strong> <code>rm -rf ~/.claude/debug/*</code> and update Claude Code</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            9. PRD says "done" but broken (10 min fix)
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Tasks marked complete, code doesn't work</div>
          <div class="gotcha-detail"><strong>Cause:</strong> No verification before marking</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Require test output in acceptance criteria. Always include "npm test passes"</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            10. Merge conflicts between agents (30 min fix)
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Parallel agents overwrite each other's work</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Same files edited without isolation</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Use git worktrees: <code>git worktree add ../wt-feature feature-branch</code></div>
        </div>
      </section>

      <!-- Section 7: WHAT'S HARD -->
      <section id="hard" data-activity="hard">
        <h2 class="section-title">
          <span class="section-number">7</span>
          What's Hard
        </h2>

        <p class="text-text-secondary mb-6">
          Fundamental tensions that can't be fixed, only managed:
        </p>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Context vs. Capability
          </div>
          <div class="hard-detail"><strong>The tension:</strong> More context enables more capability, but context accumulation causes degradation. You need context to work effectively, but too much context makes work ineffective.</div>
          <div class="hard-detail"><strong>Why no solution:</strong> This is fundamental to transformer attention. At 200K tokens, some information MUST be lost.</div>
          <div class="hard-detail"><strong>Coping strategy:</strong> Fresh context per task. External memory (files) instead of in-context memory. Accept that some re-reading is the cost of quality.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Automation vs. Control
          </div>
          <div class="hard-detail"><strong>The tension:</strong> More automation enables "ship while you sleep" but increases risk of runaway failures. Less automation is safer but slower.</div>
          <div class="hard-detail"><strong>Why no solution:</strong> Autonomy inherently includes the possibility of autonomous mistakes.</div>
          <div class="hard-detail"><strong>Coping strategy:</strong> Iteration limits, human checkpoints, layered verification. Match automation level to risk level.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Speed vs. Verification
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Verification takes time. Skipping verification is faster but allows errors to compound. Every test run costs tokens and time.</div>
          <div class="hard-detail"><strong>Why no solution:</strong> Verification is inherently a tradeoff against velocity.</div>
          <div class="hard-detail"><strong>Coping strategy:</strong> Risk-proportional verification. Full E2E for production. Typecheck-only for exploration. Never skip exit codes.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Parallelism vs. Coordination
          </div>
          <div class="hard-detail"><strong>The tension:</strong> More agents = faster completion but more conflicts. Research shows independent agents amplify errors 17x.</div>
          <div class="hard-detail"><strong>Why no solution:</strong> Coordination overhead scales with agent count. Perfect coordination costs more than sequential execution.</div>
          <div class="hard-detail"><strong>Coping strategy:</strong> Worktrees for isolation. Hub-and-spoke (CC Mirror) over fully distributed. Verification at every handoff.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Trust vs. Skepticism
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Blind trust fails catastrophically. Constant skepticism exhausts and slows. You can't verify everything but you can't trust everything.</div>
          <div class="hard-detail"><strong>Why no solution:</strong> No system can be both fully trusted and fully autonomous.</div>
          <div class="hard-detail"><strong>Coping strategy:</strong> Calibrated trust based on task risk. Trust lookups, verify writes. Trust tests, verify production. Build trust through repeated success.</div>
        </div>
      </section>

      <!-- Section 8: WHEN TO USE / WHEN NOT -->
      <section id="when" data-activity="when">
        <h2 class="section-title">
          <span class="section-number">8</span>
          When to Use / When Not
        </h2>

        <p class="text-text-secondary mb-6">
          This failure catalog is a <strong>diagnostic and recovery resource</strong>, not a learning or setup guide. Use it when things go wrong, not when things are working.
        </p>

        <!-- Decision Criteria Grid -->
        <h3 class="font-semibold text-lg mb-4">Decision Criteria Grid</h3>

        <div class="when-grid">
          <div class="when-use">
            <div class="when-title">
              <i data-lucide="check" class="w-5 h-5"></i>
              USE THIS CATALOG WHEN
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span><strong>Active incident:</strong> Something broke and you need to diagnose it NOW</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span><strong>Quality degradation:</strong> Output quality dropped after 30+ minutes of work</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span><strong>Cost anomaly:</strong> API costs spiking unexpectedly or runaway billing</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span><strong>Agent chaos:</strong> Workers spawning workers or infinite loops</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span><strong>Proactive prevention:</strong> Setting up blocklists, .claudeignore before problems occur</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span><strong>Post-mortem:</strong> Understanding why something failed after recovery</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span><strong>Architecture hardening:</strong> Adding safety rails to existing workflows</span>
            </div>
          </div>

          <div class="when-not">
            <div class="when-title">
              <i data-lucide="x" class="w-5 h-5"></i>
              DON'T USE THIS CATALOG WHEN
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span><strong>Learning basics:</strong> Use <a href="../../synthesis/staff-engineer-mental-model.html" class="text-accent hover:underline">claude-code-mastery.md</a> instead</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span><strong>Setting up patterns:</strong> Use <a href="../../synthesis/mastery-ralph-complete.html" class="text-accent hover:underline">mastery-ralph-complete</a> or <a href="../../synthesis/mastery-gastown-complete.html" class="text-accent hover:underline">mastery-gastown-complete</a></span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span><strong>Comparing architectures:</strong> Use <a href="../../synthesis/compare-architecture.html" class="text-accent hover:underline">compare-architecture</a> documents</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span><strong>Account/billing issues:</strong> Contact <a href="https://console.anthropic.com" target="_blank" class="text-accent hover:underline">Anthropic Support</a></span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span><strong>Known bugs:</strong> Search <a href="https://github.com/anthropics/claude-code/issues" target="_blank" class="text-accent hover:underline">GitHub Issues</a> first</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span><strong>Everything working fine:</strong> Don't fix what isn't broken</span>
            </div>
          </div>
        </div>

        <!-- Situation-Based Decision Matrix -->
        <h3 class="font-semibold text-lg mb-4 mt-8">Situation-Based Decision Matrix</h3>

        <table class="triage-table">
          <thead>
            <tr>
              <th>Your Situation</th>
              <th>Use This Catalog?</th>
              <th>Alternative Resource</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Claude ignoring CLAUDE.md directives</td>
              <td><span class="severity-badge severity-p0" style="background:#f0fdf4;color:#166534;">YES</span> - Context failure</td>
              <td>Section 1 (Context Window Failures)</td>
            </tr>
            <tr>
              <td>$500+ surprise bill</td>
              <td><span class="severity-badge severity-p0" style="background:#f0fdf4;color:#166534;">YES</span> - Cost failure</td>
              <td>Section 6 (Cost Failures)</td>
            </tr>
            <tr>
              <td>Want to learn Ralph pattern</td>
              <td><span class="severity-badge severity-p0" style="background:#fef2f2;color:#991b1b;">NO</span></td>
              <td><a href="../../synthesis/mastery-ralph-complete.html" class="text-accent hover:underline">mastery-ralph-complete.html</a></td>
            </tr>
            <tr>
              <td>Agent stuck in infinite loop</td>
              <td><span class="severity-badge severity-p0" style="background:#f0fdf4;color:#166534;">YES</span> - Ralph Loop failure</td>
              <td>Section 7 (Ralph Loop Failures)</td>
            </tr>
            <tr>
              <td>Choosing between Ralph vs Gas Town</td>
              <td><span class="severity-badge severity-p0" style="background:#fef2f2;color:#991b1b;">NO</span></td>
              <td><a href="../../synthesis/compare-orchestration.html" class="text-accent hover:underline">compare-orchestration.html</a></td>
            </tr>
            <tr>
              <td>Parallel agents overwriting files</td>
              <td><span class="severity-badge severity-p0" style="background:#f0fdf4;color:#166534;">YES</span> - Multi-agent coordination</td>
              <td>Section 8 (Multi-Agent Coordination)</td>
            </tr>
            <tr>
              <td>First time using Claude Code</td>
              <td><span class="severity-badge severity-p0" style="background:#fef2f2;color:#991b1b;">NO</span></td>
              <td><a href="../../synthesis/staff-engineer-mental-model.html" class="text-accent hover:underline">staff-engineer-mental-model.html</a></td>
            </tr>
            <tr>
              <td>rm -rf deleted important files</td>
              <td><span class="severity-badge severity-p0" style="background:#f0fdf4;color:#166534;">YES</span> - Security failure</td>
              <td>Section 5 (Security Failures)</td>
            </tr>
          </tbody>
        </table>

        <!-- Triage Priority -->
        <h3 class="font-semibold text-lg mb-4 mt-8">Triage Priority (Symptom to Category)</h3>

        <table class="triage-table">
          <thead>
            <tr>
              <th>Symptom</th>
              <th>First Check</th>
              <th>Severity</th>
              <th>Recovery Time</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Data or money at risk</td>
              <td>Security/Cost failures</td>
              <td><span class="severity-badge severity-p0">P0</span></td>
              <td>Immediate action required</td>
            </tr>
            <tr>
              <td>Work lost or files deleted</td>
              <td>Security/Memory failures</td>
              <td><span class="severity-badge severity-p0">P0</span></td>
              <td>Minutes if git; hours if not</td>
            </tr>
            <tr>
              <td>Progress stalled, loops</td>
              <td>Ralph/Orchestration failures</td>
              <td><span class="severity-badge severity-p1">P1</span></td>
              <td>10-30 minutes</td>
            </tr>
            <tr>
              <td>Quality degraded</td>
              <td>Context failures</td>
              <td><span class="severity-badge severity-p1">P1</span></td>
              <td>5-15 minutes</td>
            </tr>
            <tr>
              <td>Verification failing</td>
              <td>Verification failures</td>
              <td><span class="severity-badge severity-p2">P2</span></td>
              <td>2-5 minutes</td>
            </tr>
            <tr>
              <td>Disk space filling</td>
              <td>File System failures</td>
              <td><span class="severity-badge severity-p2">P2</span></td>
              <td>5 minutes</td>
            </tr>
          </tbody>
        </table>

        <!-- Alternative Approaches -->
        <h3 class="font-semibold text-lg mb-4 mt-8">Alternative Approaches to Consider</h3>

        <div class="decision-box">
          <div class="decision-why">INSTEAD OF: Debugging in a degraded session</div>
          <div class="decision-reasoning">
            When context is rotted, debugging within the same session compounds the problem. The model's diagnostic capabilities are compromised by the same context pollution causing the original issue.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">Better Approach</div>
            <div class="text-text-secondary text-sm">
              Save state with <code>git stash</code>, start a fresh session, then diagnose. Fresh context means accurate diagnosis.
            </div>
          </div>
        </div>

        <div class="decision-box">
          <div class="decision-why">INSTEAD OF: Fixing failures one by one</div>
          <div class="decision-reasoning">
            Multiple failures often share root causes. Fixing symptoms individually misses the underlying pattern and leads to whack-a-mole debugging.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">Better Approach</div>
            <div class="text-text-secondary text-sm">
              Categorize all symptoms first, then identify if they share a root cause (e.g., context rot causes both hallucinations AND forgotten instructions). Fix the root, not the leaves.
            </div>
          </div>
        </div>

        <div class="decision-box">
          <div class="decision-why">INSTEAD OF: Prevention paralysis (too many safeguards)</div>
          <div class="decision-reasoning">
            Spending 30%+ of time on prevention slows development more than occasional failures. Over-engineering safety nets creates its own complexity failures.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">Better Approach</div>
            <div class="text-text-secondary text-sm">
              Apply the 80/20 rule: <code>.claudeignore</code> + command blocklist + fresh context per task covers 80% of failures with 20% effort. Add more only when specific failures recur.
            </div>
          </div>
        </div>

        <!-- Related Resources Navigation -->
        <h3 class="font-semibold text-lg mb-4 mt-8">Related Resources Navigation</h3>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; margin-bottom: 24px;">
          <div class="decision-box" style="margin-bottom: 0;">
            <div class="decision-why" style="font-size: 14px;">For Pattern Setup</div>
            <div class="text-text-secondary text-sm mb-2">Learn how to implement patterns correctly (prevents failures)</div>
            <a href="../../synthesis/mastery-ralph-complete.html" class="text-accent hover:underline text-sm block">Ralph Pattern Complete Guide</a>
            <a href="../../synthesis/mastery-gastown-complete.html" class="text-accent hover:underline text-sm block">Gas Town Complete Guide</a>
            <a href="../../synthesis/mastery-ccmirror-complete.html" class="text-accent hover:underline text-sm block">CC Mirror Complete Guide</a>
          </div>

          <div class="decision-box" style="margin-bottom: 0;">
            <div class="decision-why" style="font-size: 14px;">For Architecture Decisions</div>
            <div class="text-text-secondary text-sm mb-2">Compare patterns before choosing (avoids wrong-tool failures)</div>
            <a href="../../synthesis/compare-architecture.html" class="text-accent hover:underline text-sm block">Architecture Comparison</a>
            <a href="../../synthesis/compare-orchestration.html" class="text-accent hover:underline text-sm block">Orchestration Comparison</a>
            <a href="../../synthesis/compare-cost.html" class="text-accent hover:underline text-sm block">Cost Comparison</a>
          </div>

          <div class="decision-box" style="margin-bottom: 0;">
            <div class="decision-why" style="font-size: 14px;">For Anti-Patterns Deep Dive</div>
            <div class="text-text-secondary text-sm mb-2">Understand what NOT to do (complementary to failure catalog)</div>
            <a href="../../synthesis/principles-anti-patterns.html" class="text-accent hover:underline text-sm block">Anti-Patterns Guide</a>
            <a href="../../synthesis/principles-core.html" class="text-accent hover:underline text-sm block">Core Principles</a>
            <a href="../../synthesis/debugging-agent-failures.html" class="text-accent hover:underline text-sm block">Debugging Agent Failures</a>
          </div>

          <div class="decision-box" style="margin-bottom: 0;">
            <div class="decision-why" style="font-size: 14px;">For Error-Specific Deep Dives</div>
            <div class="text-text-secondary text-sm mb-2">Detailed coverage of specific error types</div>
            <a href="../../synthesis/error-taxonomy-recovery.html" class="text-accent hover:underline text-sm block">Error Taxonomy & Recovery</a>
            <a href="../../synthesis/cross-pattern-migration.html" class="text-accent hover:underline text-sm block">Cross-Pattern Migration</a>
            <a href="../../synthesis/technical-context-management-advanced.html" class="text-accent hover:underline text-sm block">Advanced Context Management</a>
          </div>
        </div>

        <!-- Golden Rules -->
        <div class="gotcha-box" style="background: #f0fdf4; border-color: #bbf7d0; border-left-color: #10b981;">
          <div class="gotcha-title" style="color: #166534;">
            <i data-lucide="lightbulb" class="w-4 h-4"></i>
            Golden Rules for Using This Catalog
          </div>
          <div class="gotcha-detail" style="color: #166534;"><strong>Rule 1:</strong> Categorize FIRST, then recover. Wrong category = wrong recovery = wasted time.</div>
          <div class="gotcha-detail" style="color: #166534;"><strong>Rule 2:</strong> When in doubt, save state and start fresh. 5 minutes of recovery beats 2 hours of debugging rotted context.</div>
          <div class="gotcha-detail" style="color: #166534;"><strong>Rule 3:</strong> Prevention is cheaper than recovery. Implement .claudeignore and blocklists BEFORE your first P0 incident.</div>
          <div class="gotcha-detail" style="color: #166534;"><strong>Rule 4:</strong> Document incidents for learning. Each failure you survive teaches the next prevention pattern.</div>
        </div>
      </section>

    </main>

    <!-- Resizer -->
    <div class="resizer" data-resizer="activity-zone" aria-label="Resize activity panel"></div>

    <!-- Activity Zone -->
    <aside class="activity-zone" id="activityZone">
      <div class="text-xs font-semibold text-text-muted uppercase tracking-wider mb-4">Operational Intelligence</div>

      <!-- ESSENCE SECTION -->
      <div class="activity-item invariant" data-section="essence">
        <div class="activity-label" style="color: #3b82f6;">
          <i data-lucide="link" class="w-4 h-4"></i>
          Invariant Connection
        </div>
        <div class="font-medium text-text-primary mb-2">Shared with Ralph: Fresh Context Principle</div>
        <div class="text-text-secondary text-sm">
          Both failure modes and Ralph pattern emphasize "fresh context > extended sessions." Context rot is why Ralph exists. The failure catalog documents what happens when you violate this invariant.
        </div>
      </div>

      <div class="activity-item invariant" data-section="essence">
        <div class="activity-label" style="color: #3b82f6;">
          <i data-lucide="link" class="w-4 h-4"></i>
          Invariant Connection
        </div>
        <div class="font-medium text-text-primary mb-2">Shared with Panopticon: Domain Isolation</div>
        <div class="text-text-secondary text-sm">
          Multi-agent failures show isolation prevents cascade - same principle as Molly's Panopticon where each domain (health, finance, career) has its own Claude instance. Isolation is universal protection.
        </div>
      </div>

      <div class="activity-item invariant" data-section="essence">
        <div class="activity-label" style="color: #3b82f6;">
          <i data-lucide="link" class="w-4 h-4"></i>
          Invariant Connection
        </div>
        <div class="font-medium text-text-primary mb-2">Shared with Core Principles: Verification Non-Negotiable</div>
        <div class="text-text-secondary text-sm">
          Verification failures all trace to unchecked exit codes. This is the #4 core principle made tangible. Every "tests pass but broken" failure is a verification principle violation.
        </div>
      </div>

      <!-- CORE SECTION -->
      <div class="activity-item effect" data-section="core">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="sparkles" class="w-4 h-4"></i>
          Second-Order Effect
        </div>
        <div class="font-medium text-text-primary mb-2">Failure Compounding</div>
        <div class="text-text-secondary text-sm">
          Context failures cascade: degradation leads to hallucinations, which leads to incorrect code, which pollutes context further. One failure at 70% context accelerates to catastrophic at 90%.<br><br>
          <em>This is why early detection matters more than fast recovery.</em>
        </div>
      </div>

      <div class="activity-item effect" data-section="core">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="sparkles" class="w-4 h-4"></i>
          Second-Order Effect
        </div>
        <div class="font-medium text-text-primary mb-2">Prevention-Detection-Correction Cycle</div>
        <div class="text-text-secondary text-sm">
          Each failure teaches prevention patterns that reduce future failures. The catalog itself is an emergent property of enough failures happening to enough people. Your failures contribute to collective immunity.
        </div>
      </div>

      <div class="activity-item warstory" data-section="core">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">The $47,000 Loop</div>
        <div class="text-text-secondary text-sm">
          Recursive agent loop ran for 11 days unmonitored. No MAX_ITERATIONS, no timeout, no cost alerts. Now iteration limits are mandatory in every serious deployment. One expensive lesson, universal protection.
        </div>
      </div>

      <div class="activity-item warstory" data-section="core">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">Home Folder Deletion</div>
        <div class="text-text-secondary text-sm">
          <code>rm -rf ~/</code> executed without blocklist. User lost everything outside git. Now command blocklists are standard. The prevention cost nothing; the recovery cost everything.
        </div>
      </div>

      <div class="activity-item warstory" data-section="core">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="user" class="w-4 h-4"></i>
          War Story
        </div>
        <div class="font-medium text-text-primary mb-2">18 Million Token Circular Revision</div>
        <div class="text-text-secondary text-sm">
          Context overflow led to 3.2M token circular revision loop. Claude kept "fixing" code that was fine, creating new bugs, then fixing those. 18M tokens total. Taught the importance of fresh context per task.
        </div>
      </div>

      <!-- DECISIONS SECTION -->
      <div class="activity-item constraint" data-section="decisions">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="link-2" class="w-4 h-4"></i>
          Constraint Chain
        </div>
        <div class="font-medium text-text-primary mb-2">Why These 9 Categories Exist</div>
        <div class="text-text-secondary text-sm">
          <strong>ROOT:</strong> Claude sessions are stateless<br>
          -> State must persist externally<br>
          -> External state can desync (Memory failures)<br>
          -> Claude can't verify its own output (Verification failures)<br>
          -> More context = more complexity (Context failures)<br>
          -> Automation = autonomous mistakes (Orchestration failures)
        </div>
      </div>

      <div class="activity-item inversion" data-section="decisions">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if context was infinite?</div>
        <div class="text-text-secondary text-sm">
          You'd still need verification (can't trust output). Still need coordination (multiple agents conflict). Still need cost limits (API has pricing). Context isn't the only constraint. The other 8 categories would still exist.
        </div>
      </div>

      <div class="activity-item tradeoff" data-section="decisions">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="scale" class="w-4 h-4"></i>
          Trade-Off Tension
        </div>
        <div class="font-medium text-text-primary mb-2">Diagnostic Specificity vs. Simplicity</div>
        <div class="text-text-secondary text-sm">
          <strong>More categories:</strong> Better targeting, but harder to navigate<br>
          <strong>Fewer categories:</strong> Simpler, but recovery less precise<br><br>
          <em>9 is the Goldilocks zone - specific enough to act, simple enough to remember.</em>
        </div>
      </div>

      <!-- FILES SECTION -->
      <div class="activity-item analogy" data-section="files">
        <div class="activity-label" style="color: #d946ef;">
          <i data-lucide="git-compare" class="w-4 h-4"></i>
          Analogical Bridge
        </div>
        <div class="font-medium text-text-primary mb-2">Failure Recovery = Production Incident Response</div>
        <div class="text-text-secondary text-sm">
          <strong>On-call rotation</strong> = Pre-session checklist<br>
          <strong>Runbooks</strong> = Recovery playbooks<br>
          <strong>Post-mortems</strong> = incident-template.md<br>
          <strong>Monitoring</strong> = Claude HUD<br><br>
          <em>If you know incident response, you already know failure recovery.</em>
        </div>
      </div>

      <div class="activity-item composition" data-section="files">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="layers" class="w-4 h-4"></i>
          Composition Case
        </div>
        <div class="font-medium text-text-primary mb-2">Worktree Isolation Prevents Multi-Agent Failures</div>
        <div class="text-text-secondary text-sm">
          <strong>Git worktrees + parallel agents = safe parallelism</strong><br>
          Worktrees prevent file conflicts, merge chaos, context pollution. One pattern, multiple failure categories prevented.
        </div>
      </div>

      <div class="activity-item composition" data-section="files">
        <div class="activity-label" style="color: #8b5cf6;">
          <i data-lucide="layers" class="w-4 h-4"></i>
          Anti-Composition
        </div>
        <div class="font-medium text-text-primary mb-2">Ignoring Context + Skipping Verification</div>
        <div class="text-text-secondary text-sm">
          Two failures that multiply: Bad code from degraded context gets committed without checking. Each failure makes the other worse. Never skip both in the same session.
        </div>
      </div>

      <!-- PATH SECTION -->
      <div class="activity-item gradient" data-section="path">
        <div class="activity-label" style="color: #f43f5e;">
          <i data-lucide="trending-down" class="w-4 h-4"></i>
          Failure Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">Context Overflow Progressive Degradation</div>
        <div class="text-text-secondary text-sm">
          <strong>10%:</strong> Occasional forgotten instruction, may self-correct<br>
          <strong>50%:</strong> Quality noticeably worse, /compact time<br>
          <strong>90%:</strong> Hallucinations frequent, /reset required<br>
          <strong>100%:</strong> Session unusable, external intervention only<br><br>
          <em>Recovery gets harder as you wait. Act at 50%, not 90%.</em>
        </div>
      </div>

      <div class="activity-item violation" data-section="path">
        <div class="activity-label" style="color: #f97316;">
          <i data-lucide="alert-octagon" class="w-4 h-4"></i>
          Violation Chain
        </div>
        <div class="font-medium text-text-primary mb-2">If You Skip "Save State" (Step 4)</div>
        <div class="text-text-secondary text-sm">
          <strong>IF:</strong> Skip git stash before reset<br>
          <strong>THEN:</strong> Uncommitted work lost<br>
          <strong>THEN:</strong> Must recreate from memory<br>
          <strong>THEN:</strong> Recreated code has bugs<br>
          <strong>FINALLY:</strong> 2 hours to restore 30 minutes of work<br><br>
          <em>The 30-second stash saves hours.</em>
        </div>
      </div>

      <div class="activity-item horizon" data-section="path">
        <div class="activity-label" style="color: #06b6d4;">
          <i data-lucide="clock" class="w-4 h-4"></i>
          Time Horizon Shift
        </div>
        <div class="font-medium text-text-primary mb-2">Recovery Cost by Session Length</div>
        <div class="text-text-secondary text-sm">
          <strong>Single session:</strong> Low cost, just restart (5 min)<br>
          <strong>Full day of work:</strong> Medium cost, lost progress (1 hr)<br>
          <strong>Production system:</strong> High cost, user impact (hours)<br>
          <strong>Long-running autonomous:</strong> Critical, unattended failure (days?)<br><br>
          <em>Prevention value scales with session length.</em>
        </div>
      </div>

      <!-- GOTCHAS SECTION -->
      <div class="activity-item inflection" data-section="gotchas">
        <div class="activity-label" style="color: #eab308;">
          <i data-lucide="activity" class="w-4 h-4"></i>
          Inflection Point
        </div>
        <div class="font-medium text-text-primary mb-2">Prevention Investment Sweet Spot</div>
        <div class="text-text-secondary text-sm">
          <strong>0-5% time on prevention:</strong> Too little, failures dominate<br>
          <strong>5-15% time on prevention:</strong> Sweet spot, high ROI<br>
          <strong>15-30% time on prevention:</strong> Diminishing returns<br>
          <strong>30%+ time on prevention:</strong> Prevention paralysis<br><br>
          <strong>THE INFLECTION:</strong> ~15% prevention investment is optimal
        </div>
      </div>

      <div class="activity-item inversion" data-section="gotchas">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">Why APPEND in CAPS?</div>
        <div class="text-text-secondary text-sm">
          <strong>What if lowercase worked?</strong> Then you wouldn't need the workaround.<br><br>
          Models pay attention to formatting emphasis. "append" gets ignored; "APPEND" gets followed. The workaround IS the interface when working with probabilistic systems.
        </div>
      </div>

      <div class="activity-item frontier" data-section="gotchas">
        <div class="activity-label" style="color: #ef4444;">
          <i data-lucide="flask-conical" class="w-4 h-4"></i>
          Research Frontier
        </div>
        <div class="font-medium text-text-primary mb-2">UNSOLVED: Automatic Context Degradation Detection</div>
        <div class="text-text-secondary text-sm">
          Manual monitoring required. Claude HUD helps but isn't automatic. No built-in alerts when context crosses 70%. Community tools attempt this but none are reliable. This remains an open problem.
        </div>
      </div>

      <div class="activity-item frontier" data-section="gotchas">
        <div class="activity-label" style="color: #ef4444;">
          <i data-lucide="flask-conical" class="w-4 h-4"></i>
          Research Frontier
        </div>
        <div class="font-medium text-text-primary mb-2">UNSOLVED: Cost Prediction Before Execution</div>
        <div class="text-text-secondary text-sm">
          No way to estimate task cost before running. Token estimation tools exist but accuracy is low. You can't know if a task will cost $0.50 or $50 until you run it. Theoretical problem with no practical solution yet.
        </div>
      </div>

      <!-- HARD SECTION -->
      <div class="activity-item tradeoff" data-section="hard">
        <div class="activity-label" style="color: #f59e0b;">
          <i data-lucide="scale" class="w-4 h-4"></i>
          Trade-Off Tension
        </div>
        <div class="font-medium text-text-primary mb-2">The Fundamental Dilemma</div>
        <div class="text-text-secondary text-sm">
          Every tension in "What's Hard" is a manifestation of one meta-tension:<br><br>
          <strong>Capability requires risk.</strong><br><br>
          More context = more capability = more failure modes. More automation = more throughput = more autonomous mistakes. This is physics, not engineering.
        </div>
      </div>

      <div class="activity-item expertise" data-section="hard">
        <div class="activity-label" style="color: #10b981;">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
          Expertise Gradient
        </div>
        <div class="font-medium text-text-primary mb-2">Failure Handling Skill Progression</div>
        <div class="text-text-secondary text-sm">
          <strong>Novice:</strong> Can reset session, loses work<br>
          <strong>Intermediate:</strong> Diagnoses common failures, saves state<br>
          <strong>Advanced:</strong> Prevents most failures proactively<br>
          <strong>Staff:</strong> Designs systems that minimize failure surface<br>
          <strong>Expert:</strong> Writes the documentation you're reading
        </div>
      </div>

      <div class="activity-item minimal" data-section="hard">
        <div class="activity-label" style="color: #84cc16;">
          <i data-lucide="minimize-2" class="w-4 h-4"></i>
          Minimal Pattern
        </div>
        <div class="font-medium text-text-primary mb-2">Simplest Failure Prevention That Works</div>
        <div class="text-text-secondary text-sm">
          <code style="background: #f4f4f5; padding: 2px 6px; border-radius: 4px; font-size: 12px;">claude; exit; claude</code><br><br>
          <strong>What's included:</strong> Fresh context per task<br>
          <strong>What's removed:</strong> Loops, parallelism, automation<br>
          <strong>When appropriate:</strong> Learning, low-stakes work, exploring
        </div>
      </div>

      <!-- WHEN SECTION -->
      <div class="activity-item alternative" data-section="when">
        <div class="activity-label" style="color: #6b7280;">
          <i data-lucide="arrow-right" class="w-4 h-4"></i>
          Alternative Paths
        </div>
        <div class="font-medium text-text-primary mb-2">If This Catalog Doesn't Help</div>
        <div class="text-text-secondary text-sm">
          <strong>Billing/account issues:</strong> Anthropic Support (console.anthropic.com)<br>
          <strong>Known bugs:</strong> GitHub Issues search (github.com/anthropics)<br>
          <strong>Real-time help:</strong> Community Discord channels<br>
          <strong>Version-specific:</strong> Release notes for your Claude Code version
        </div>
      </div>

      <div class="activity-item alternative" data-section="when">
        <div class="activity-label" style="color: #6b7280;">
          <i data-lucide="arrow-right" class="w-4 h-4"></i>
          Related Documents
        </div>
        <div class="text-text-secondary text-sm">
          <strong>Setup patterns (not debugging):</strong> mastery-ralph-complete.md<br>
          <strong>Architecture decisions:</strong> compare-architecture.md<br>
          <strong>Cost optimization:</strong> compare-cost.md<br>
          <strong>Anti-patterns deep dive:</strong> principles-anti-patterns.md
        </div>
      </div>

      <div class="activity-item violation" data-section="when">
        <div class="activity-label" style="color: #f97316;">
          <i data-lucide="alert-octagon" class="w-4 h-4"></i>
          Violation Chain
        </div>
        <div class="font-medium text-text-primary mb-2">If You Debug Without This Catalog</div>
        <div class="text-text-secondary text-sm">
          <strong>IF:</strong> Skip symptom-category matching<br>
          <strong>THEN:</strong> Apply wrong recovery procedure<br>
          <strong>THEN:</strong> Problem persists or worsens<br>
          <strong>THEN:</strong> Frustration leads to session reset<br>
          <strong>FINALLY:</strong> Lost 2 hours that 10 minutes of diagnosis would have saved
        </div>
      </div>

      <div class="activity-item inversion" data-section="when">
        <div class="activity-label" style="color: #4f46e5;">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          Inversion Lens
        </div>
        <div class="font-medium text-text-primary mb-2">What if failures never happened?</div>
        <div class="text-text-secondary text-sm">
          You'd still need to understand the system to use it well. The failure modes reveal the underlying architecture. Context failures teach context limits. Orchestration failures teach role separation.<br><br>
          <em>This catalog is also a learning tool, not just a debugging tool.</em>
        </div>
      </div>

    </aside>
  </div>

  <script>
    /**
     * PanelResizer - Handles draggable panel dividers
     */
    class PanelResizer {
      constructor(resizerEl, config = {}) {
        this.resizer = resizerEl;
        this.config = {
          storageKey: 'panel-activity-zone-width',
          minWidth: 280,
          maxWidth: 900,
          defaultWidth: 480,
          ...config
        };

        this.isResizing = false;
        this.startX = 0;
        this.startWidth = 0;

        this.activityZone = document.querySelector('.activity-zone');
        this.mainContent = document.querySelector('.main-content');

        this.onMouseDown = this.onMouseDown.bind(this);
        this.onMouseMove = this.onMouseMove.bind(this);
        this.onMouseUp = this.onMouseUp.bind(this);

        this.init();
      }

      init() {
        this.restoreWidth();
        this.resizer.addEventListener('mousedown', this.onMouseDown);
      }

      onMouseDown(e) {
        if (e.button !== 0) return;

        this.isResizing = true;
        this.startX = e.clientX;
        this.startWidth = this.activityZone.offsetWidth;

        this.resizer.classList.add('active');
        document.body.classList.add('resizing');

        document.addEventListener('mousemove', this.onMouseMove);
        document.addEventListener('mouseup', this.onMouseUp);

        e.preventDefault();
      }

      onMouseMove(e) {
        if (!this.isResizing) return;

        const delta = this.startX - e.clientX;
        const newWidth = this.startWidth + delta;

        const constrainedWidth = Math.max(
          this.config.minWidth,
          Math.min(this.config.maxWidth, newWidth)
        );

        this.activityZone.style.width = constrainedWidth + 'px';
        this.mainContent.style.marginRight = constrainedWidth + 'px';
        this.resizer.style.right = constrainedWidth + 'px';
      }

      onMouseUp(e) {
        if (!this.isResizing) return;

        this.isResizing = false;

        this.resizer.classList.remove('active');
        document.body.classList.remove('resizing');

        document.removeEventListener('mousemove', this.onMouseMove);
        document.removeEventListener('mouseup', this.onMouseUp);

        this.saveWidth();
      }

      saveWidth() {
        const width = this.activityZone.offsetWidth;
        localStorage.setItem(this.config.storageKey, JSON.stringify({
          width,
          timestamp: Date.now()
        }));
      }

      restoreWidth() {
        try {
          const stored = localStorage.getItem(this.config.storageKey);
          if (stored) {
            const { width } = JSON.parse(stored);
            if (width >= this.config.minWidth && width <= this.config.maxWidth) {
              this.activityZone.style.width = width + 'px';
              this.mainContent.style.marginRight = width + 'px';
              this.resizer.style.right = width + 'px';
            }
          }
        } catch (e) {
          console.warn('Failed to restore panel width:', e);
        }
      }

      destroy() {
        this.resizer.removeEventListener('mousedown', this.onMouseDown);
        document.removeEventListener('mousemove', this.onMouseMove);
        document.removeEventListener('mouseup', this.onMouseUp);
      }
    }

    // Auto-initialize resizers
    document.addEventListener('DOMContentLoaded', () => {
      const resizers = document.querySelectorAll('[data-resizer]');
      resizers.forEach(resizer => new PanelResizer(resizer));
    });

    // Initialize Lucide icons
    lucide.createIcons();

    // Navigation toggle
    function toggleSection(header) {
      const section = header.closest('.nav-section');
      section.classList.toggle('expanded');
      const children = section.querySelector('.nav-children');
      children.classList.toggle('expanded');
    }

    // Mobile menu toggle
    function toggleMobileMenu() {
      const nav = document.getElementById('leftNav');
      nav.classList.toggle('open');
    }

    // Copy functionality
    function copyCode(btn, text) {
      navigator.clipboard.writeText(text).then(() => {
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i data-lucide="check" class="w-3 h-3"></i> Copied!';
        lucide.createIcons();
        setTimeout(() => {
          btn.innerHTML = originalText;
          lucide.createIcons();
        }, 2000);
      });
    }

    function copyCodeBlock(btn) {
      const codeBlock = btn.closest('.code-block');
      const pre = codeBlock.querySelector('pre');
      const text = pre.textContent;
      copyCode(btn, text);
    }

    // Scroll-sync with GSAP ScrollTrigger
    gsap.registerPlugin(ScrollTrigger);

    const sections = document.querySelectorAll('[data-activity]');
    const activityItems = document.querySelectorAll('.activity-item');

    sections.forEach(section => {
      ScrollTrigger.create({
        trigger: section,
        start: 'top 40%',
        end: 'bottom 40%',
        onEnter: () => activateSection(section.dataset.activity),
        onEnterBack: () => activateSection(section.dataset.activity),
      });
    });

    function activateSection(sectionName) {
      activityItems.forEach(item => {
        if (item.dataset.section === sectionName) {
          item.classList.add('active');
          gsap.to(item, {
            opacity: 1,
            y: -2,
            boxShadow: '0 4px 12px rgba(0,0,0,0.08)',
            duration: 0.3,
            ease: 'power2.out'
          });
        } else {
          item.classList.remove('active');
          gsap.to(item, {
            opacity: 0.5,
            y: 0,
            boxShadow: 'none',
            duration: 0.3,
            ease: 'power2.out'
          });
        }
      });

      // Update nav active state
      document.querySelectorAll('.nav-section-header').forEach(header => {
        header.classList.remove('active');
      });
      const activeNav = document.querySelector(`[data-section="${sectionName}"] .nav-section-header`);
      if (activeNav) {
        activeNav.classList.add('active');
      }
    }

    // Initialize first section as active
    activateSection('essence');

    // Smooth scroll for nav links
    document.querySelectorAll('.nav-item').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const target = document.querySelector(link.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          document.querySelectorAll('.nav-item').forEach(l => l.classList.remove('active'));
          link.classList.add('active');
        }
      });
    });

    // Brushing interaction
    activityItems.forEach(item => {
      item.addEventListener('mouseenter', () => {
        const sectionName = item.dataset.section;
        const relatedSection = document.querySelector(`[data-activity="${sectionName}"]`);
        if (relatedSection) {
          relatedSection.style.backgroundColor = 'rgba(239, 68, 68, 0.05)';
          relatedSection.style.transition = 'background-color 0.3s ease';
        }
      });

      item.addEventListener('mouseleave', () => {
        const sectionName = item.dataset.section;
        const relatedSection = document.querySelector(`[data-activity="${sectionName}"]`);
        if (relatedSection) {
          relatedSection.style.backgroundColor = '';
        }
      });
    });
  </script>
<script src="../../js/global-nav.js"></script>
</body>
</html>
