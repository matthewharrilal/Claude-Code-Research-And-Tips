
<!--
═══════════════════════════════════════════════════════════════════════════════
INLINE THREADING HEADER — Phase 2B
File: docs-spa/content/pages/grammar-plugins/content.html
Tier: C | Batch: 12 | Generated: 2026-02-06

1. WHY THIS EXISTS
Rendered HTML content page for the grammar-plugins synthesis document.

3. STATUS
ACTIVE

5. BUILT ON
Extracted from synthesis/grammar-plugins.md by content extraction scripts.

8. CONSUMED BY
docs-spa/app/(docs)/synthesis/grammar-plugins/page.tsx renders this content via dangerouslySetInnerHTML.

═══════════════════════════════════════════════════════════════════════════════
END INLINE THREADING HEADER
═══════════════════════════════════════════════════════════════════════════════
-->

      <!-- Section 1: ESSENCE -->
      <section id="essence" data-activity="essence">
        <div class="essence-box">
          <div class="essence-label">Essence (15 words)</div>
          <div class="essence-text">Plugins package commands, skills, hooks, and agents into installable extensions that expand Claude Code's vocabulary.</div>
        </div>
      </section>

      <!-- Section 2: CORE ABSTRACTION -->
      <section id="core-abstraction" data-activity="core">
        <h2 class="section-title">
          <span class="section-number">2</span>
          The Core Abstraction
        </h2>

        <div class="core-abstraction">
          <div class="core-philosophy">"A plugin is a pre-packaged capability that extends Claude Code's vocabulary."</div>

          <div class="core-code">
            <button class="copy-btn" onclick="copyCode(this, 'plugin := { manifest, commands[], skills[], hooks[], agents[], scripts[] }')">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <code>plugin := { manifest, commands[], skills[], hooks[], agents[], scripts[] }</code>
          </div>

          <div class="core-anchor">That's the grammar. Plugins contain capabilities; capabilities compose with the core.</div>
        </div>

        <p class="text-text-secondary mb-6">
          Think of plugins as vocabulary expansion packs. Claude Code has a base vocabulary (Read, Write, Edit, Bash). Plugins add new words (commands), new instruction sets (skills), new event handlers (hooks), and new specialized workers (agents).
        </p>

        <h3 class="font-semibold text-lg mb-4 mt-8" id="hierarchy">The Hierarchy</h3>

        <div class="hierarchy-diagram">
          <div><strong>Plugin</strong> (container)</div>
          <div class="hierarchy-item">Commands (user-triggered actions)</div>
          <div class="hierarchy-item">Skills (knowledge/instruction sets)</div>
          <div class="hierarchy-item">Hooks (event-driven handlers)</div>
          <div class="hierarchy-item">Agents (specialized workers)</div>
          <div class="hierarchy-item">Scripts (setup/support utilities)</div>
        </div>

        <table class="content-table">
          <thead>
            <tr>
              <th>Primitive</th>
              <th>Nature</th>
              <th>Scope</th>
              <th>Trigger</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Plugin</strong></td>
              <td>Package of capabilities</td>
              <td>Full lifecycle</td>
              <td>Installation</td>
            </tr>
            <tr>
              <td><strong>Skill</strong></td>
              <td>Instruction set</td>
              <td>Single purpose</td>
              <td>Query relevance</td>
            </tr>
            <tr>
              <td><strong>Hook</strong></td>
              <td>Event handler</td>
              <td>Specific event</td>
              <td>Lifecycle event</td>
            </tr>
            <tr>
              <td><strong>Command</strong></td>
              <td>User action</td>
              <td>Atomic task</td>
              <td><code>/command</code></td>
            </tr>
            <tr>
              <td><strong>Agent</strong></td>
              <td>Isolated worker</td>
              <td>Scoped task</td>
              <td>Task tool</td>
            </tr>
            <tr>
              <td><strong>MCP Server</strong></td>
              <td>External tool</td>
              <td>Data/Action bridge</td>
              <td>Tool call</td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- Section 3: DESIGN DECISIONS -->
      <section id="why-manifest" data-activity="decisions">
        <h2 class="section-title">
          <span class="section-number">3</span>
          Design Decisions
        </h2>

        <div class="decision-box">
          <div class="decision-why">WHY A MANIFEST?</div>
          <div class="decision-reasoning">
            The manifest (<code>plugin.json</code>) declares what a plugin contains without requiring Claude to scan directories. It's the contract between plugin and system.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Every capability must be declared in the manifest. If it's not in <code>plugin.json</code>, it doesn't exist to Claude Code. Commands without manifest entries are invisible.
            </div>
          </div>
        </div>

        <div class="decision-box" id="why-hooks">
          <div class="decision-why">WHY LIFECYCLE HOOKS?</div>
          <div class="decision-reasoning">
            Hooks let plugins react to system events without modifying core behavior. PreToolUse, PostToolUse, SessionStart, SessionEnd, Stop - these are the extension points where plugins can inject behavior.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              To extend Claude Code, you don't modify Claude Code. You register hooks that fire at defined lifecycle points. This is the same pattern as browser extensions, VS Code extensions, and Git hooks.
            </div>
          </div>
        </div>

        <div class="decision-box" id="why-composition">
          <div class="decision-why">WHY COMPOSITION RULES?</div>
          <div class="decision-reasoning">
            Without formal composition rules, plugins would conflict unpredictably. The grammar defines how plugins combine with loops, hooks, workers, other plugins, MCP servers, and skills.
          </div>
          <div class="decision-implication">
            <div class="decision-implication-label">What this means for you</div>
            <div class="text-text-secondary text-sm">
              Before combining two plugins or a plugin with a pattern, check the composition rules. Plugin + Loop? Plugin + Hook? Plugin + MCP? Each has a defined pattern and known gotchas.
            </div>
          </div>
        </div>
      </section>

      <!-- Section 4: PLUGIN TYPES -->
      <section id="plugin-types" data-activity="types">
        <h2 class="section-title">
          <span class="section-number">4</span>
          Plugin Types Taxonomy
        </h2>

        <p class="text-text-secondary mb-6">
          Plugins fall into 6 categories based on their primary function. Each has a distinct grammar pattern showing how it hooks into Claude Code.
        </p>

        <div class="plugin-type-grid" id="visualization-plugins">
          <div class="plugin-type-card">
            <div class="plugin-type-title">
              <i data-lucide="activity" class="w-5 h-5 text-accent"></i>
              Visualization Plugins
            </div>
            <div class="plugin-type-desc">Extend observability and feedback. Run passively via hooks without modifying workflow.</div>
            <div class="plugin-type-example">hook(PostToolUse) -&gt; render(status)</div>
          </div>

          <div class="plugin-type-card" id="memory-plugins">
            <div class="plugin-type-title">
              <i data-lucide="database" class="w-5 h-5 text-accent"></i>
              Memory Plugins
            </div>
            <div class="plugin-type-desc">Extend persistence and context. Capture via hooks, store externally, inject on session start.</div>
            <div class="plugin-type-example">hook(SessionStart) -&gt; inject(context)</div>
          </div>

          <div class="plugin-type-card" id="workflow-plugins">
            <div class="plugin-type-title">
              <i data-lucide="git-branch" class="w-5 h-5 text-accent"></i>
              Workflow Plugins
            </div>
            <div class="plugin-type-desc">Extend operational patterns. User-initiated via command, spawn agents, verify output.</div>
            <div class="plugin-type-example">command -&gt; orchestrate(agents) -&gt; commit</div>
          </div>

          <div class="plugin-type-card">
            <div class="plugin-type-title">
              <i data-lucide="server" class="w-5 h-5 text-accent"></i>
              Tool Plugins (MCP)
            </div>
            <div class="plugin-type-desc">Extend capabilities through external tools. Configured declaratively, run as separate process.</div>
            <div class="plugin-type-example">configure(settings.json) -&gt; spawn(server)</div>
          </div>

          <div class="plugin-type-card">
            <div class="plugin-type-title">
              <i data-lucide="shield" class="w-5 h-5 text-accent"></i>
              Security Plugins
            </div>
            <div class="plugin-type-desc">Extend safety mechanisms. Intercept before execution, pattern-based analysis, gate-keeping.</div>
            <div class="plugin-type-example">hook(PreToolUse) -&gt; analyze -&gt; allow|block</div>
          </div>

          <div class="plugin-type-card">
            <div class="plugin-type-title">
              <i data-lucide="palette" class="w-5 h-5 text-accent"></i>
              Output Style Plugins
            </div>
            <div class="plugin-type-desc">Extend communication patterns. SessionStart injection, modify response style.</div>
            <div class="plugin-type-example">hook(SessionStart) -&gt; inject(personality)</div>
          </div>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8">Plugin Ecosystem Examples</h3>

        <table class="content-table">
          <thead>
            <tr>
              <th>Plugin</th>
              <th>Category</th>
              <th>Key Feature</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Claude HUD</strong></td>
              <td>Visualization</td>
              <td>Real-time context bar</td>
            </tr>
            <tr>
              <td><strong>Claude-Mem</strong></td>
              <td>Memory</td>
              <td>Persistent semantic memory</td>
            </tr>
            <tr>
              <td><strong>Ralph Wiggum</strong></td>
              <td>Workflow</td>
              <td>Stop hook loop continuation</td>
            </tr>
            <tr>
              <td><strong>Code-Review</strong></td>
              <td>Workflow</td>
              <td>5 parallel review agents</td>
            </tr>
            <tr>
              <td><strong>Security-Guidance</strong></td>
              <td>Security</td>
              <td>PreToolUse vulnerability scan</td>
            </tr>
            <tr>
              <td><strong>Explanatory-Output</strong></td>
              <td>Style</td>
              <td>Educational mode with explanations</td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- Section 5: COMPOSITION RULES -->
      <section id="composition" data-activity="composition">
        <h2 class="section-title">
          <span class="section-number">5</span>
          Plugin Composition Rules
        </h2>

        <p class="text-text-secondary mb-6">
          The grammar defines 6 rules for how plugins compose with other primitives. Each rule has a pattern and known interactions.
        </p>

        <div class="composition-rule">
          <div class="composition-rule-title">Rule 1: Plugin + Loop</div>
          <p class="text-text-secondary text-sm mb-3">Plugins can run within iterative loops (like Ralph).</p>
          <div class="composition-pattern">while-loop(plugin-invoke -&gt; process -&gt; commit)</div>
          <p class="text-text-secondary text-sm mt-3"><strong>Example:</strong> Each Ralph iteration invokes code-simplifier before committing.</p>
        </div>

        <div class="composition-rule">
          <div class="composition-rule-title">Rule 2: Plugin + Hook</div>
          <p class="text-text-secondary text-sm mb-3">Plugins can be triggered by lifecycle hooks.</p>
          <div class="composition-pattern">hook(event) -&gt; plugin-invoke</div>
          <p class="text-text-secondary text-sm mt-3"><strong>Example:</strong> PostToolUse triggers prettier on every Edit.</p>
        </div>

        <div class="composition-rule">
          <div class="composition-rule-title">Rule 3: Plugin + Worker</div>
          <p class="text-text-secondary text-sm mb-3">Plugins provide agents that workers can utilize.</p>
          <div class="composition-pattern">orchestrator -&gt; spawn(worker with plugin-agent)</div>
          <p class="text-text-secondary text-sm mt-3"><strong>Example:</strong> Code-review spawns 5 specialized agents in parallel.</p>
        </div>

        <div class="composition-rule">
          <div class="composition-rule-title">Rule 4: Plugin + Plugin</div>
          <p class="text-text-secondary text-sm mb-3">Plugins can compose with other plugins via output/input chaining.</p>
          <div class="composition-pattern">plugin-A.output -&gt; plugin-B.input</div>
          <p class="text-text-secondary text-sm mt-3"><strong>Example:</strong> claude-mem:recall -&gt; code-review:review -&gt; claude-mem:store</p>
        </div>

        <div class="composition-rule">
          <div class="composition-rule-title">Rule 5: Plugin + MCP</div>
          <p class="text-text-secondary text-sm mb-3">Plugins can leverage MCP servers for external capabilities.</p>
          <div class="composition-pattern">plugin-command -&gt; mcp-tool -&gt; process-result</div>
          <p class="text-text-secondary text-sm mt-3"><strong>Example:</strong> browser-test plugin uses browserbase MCP for screenshots.</p>
        </div>

        <div class="composition-rule">
          <div class="composition-rule-title">Rule 6: Plugin + Skill</div>
          <p class="text-text-secondary text-sm mb-3">Plugins can package and auto-invoke skills based on query matching.</p>
          <div class="composition-pattern">query-match -&gt; skill-load -&gt; guided-execution</div>
          <p class="text-text-secondary text-sm mt-3"><strong>Example:</strong> Frontend-design skill loads automatically on UI work.</p>
        </div>
      </section>

      <!-- Section 6: EXTENSION POINTS -->
      <section id="extension-points" data-activity="extension">
        <h2 class="section-title">
          <span class="section-number">6</span>
          Extension Points
        </h2>

        <p class="text-text-secondary mb-6">
          Claude Code exposes 5 lifecycle hooks where plugins can inject behavior. Each hook provides specific data and enables specific use cases.
        </p>

        <div class="extension-point">
          <div class="extension-point-title">
            <i data-lucide="shield" class="w-5 h-5"></i>
            PreToolUse
          </div>
          <div class="extension-point-purpose">Intercept before tool execution</div>
          <div class="extension-point-cases">
            <strong>Use cases:</strong> Security gates, validation, logging, rate limiting<br>
            <strong>Data available:</strong> <code>$TOOL_NAME</code>, <code>$EVENT_DATA</code><br>
            <strong>Can:</strong> allow, block, modify, warn
          </div>
        </div>

        <div class="extension-point">
          <div class="extension-point-title">
            <i data-lucide="check-circle" class="w-5 h-5"></i>
            PostToolUse
          </div>
          <div class="extension-point-purpose">React after tool execution</div>
          <div class="extension-point-cases">
            <strong>Use cases:</strong> Formatting, linting, notifications, metrics<br>
            <strong>Data available:</strong> <code>$TOOL_NAME</code>, <code>$FILE</code>, <code>$EVENT_DATA</code><br>
            <strong>Can:</strong> transform output, log, notify
          </div>
        </div>

        <div class="extension-point">
          <div class="extension-point-title">
            <i data-lucide="play" class="w-5 h-5"></i>
            SessionStart
          </div>
          <div class="extension-point-purpose">Initialize session state</div>
          <div class="extension-point-cases">
            <strong>Use cases:</strong> Context loading, personality injection, environment setup<br>
            <strong>Can:</strong> inject context, modify behavior, load state
          </div>
        </div>

        <div class="extension-point">
          <div class="extension-point-title">
            <i data-lucide="save" class="w-5 h-5"></i>
            SessionEnd
          </div>
          <div class="extension-point-purpose">Cleanup and persistence</div>
          <div class="extension-point-cases">
            <strong>Use cases:</strong> State saving, summary generation, cleanup<br>
            <strong>Can:</strong> persist state, generate summaries, cleanup temp files
          </div>
        </div>

        <div class="extension-point">
          <div class="extension-point-title">
            <i data-lucide="stop-circle" class="w-5 h-5"></i>
            Stop
          </div>
          <div class="extension-point-purpose">Intercept exit attempts</div>
          <div class="extension-point-cases">
            <strong>Use cases:</strong> Loop continuation (Ralph), completion verification<br>
            <strong>Can:</strong> allow exit, restart with new prompt, continue execution
          </div>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8">Plugin Directory Structure</h3>

        <div class="code-block">
          <button class="copy-btn" onclick="copyCodeBlock(this)">
            <i data-lucide="copy" class="w-3 h-3"></i>
            Copy
          </button>
          <pre>my-plugin/
<span class="comment">├── .claude-plugin/</span>
│   └── plugin.json              <span class="comment"># Manifest (required)</span>
<span class="comment">├── commands/</span>
│   ├── init.md                  <span class="comment"># Initialization command</span>
│   ├── run.md                   <span class="comment"># Main command</span>
│   └── status.md                <span class="comment"># Status check</span>
<span class="comment">├── skills/</span>
│   └── main/
│       └── SKILL.md             <span class="comment"># Primary skill</span>
<span class="comment">├── agents/</span>
│   ├── worker.md                <span class="comment"># Worker agent</span>
│   └── reviewer.md              <span class="comment"># Review agent</span>
<span class="comment">├── hooks/</span>
│   ├── hooks.json               <span class="comment"># Hook configuration</span>
│   └── post-edit.sh             <span class="comment"># Hook scripts</span>
<span class="comment">├── scripts/</span>
│   └── setup.js                 <span class="comment"># Setup scripts</span>
└── templates/
    └── config.json              <span class="comment"># Templates</span></pre>
        </div>
      </section>

      <!-- Section 7: GOTCHAS -->
      <section id="gotchas" data-activity="gotchas">
        <h2 class="section-title">
          <span class="section-number">7</span>
          Gotchas
        </h2>

        <p class="text-text-secondary mb-6">
          Real problems you'll hit when working with plugins, with fixes.
        </p>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Plugin Not Found After Installation
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> <code>/plugin-name:command</code> returns "command not found"</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Marketplace not added, or plugin not properly installed</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Run <code>/plugin marketplace add [author]/[repo]</code>, then <code>/plugin install [name]</code>, then restart session.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Hook Not Firing
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> PostToolUse or PreToolUse hook configured but never executes</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Matcher misconfigured - must match exact tool name (Edit, Write, Bash, Read)</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Test with simple echo first. Check matcher matches exact tool name. Use <code>*</code> for catch-all.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            MCP Server Won't Start
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> MCP tools not appearing, or "server not found" errors</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Missing dependencies, wrong command path, or env vars not set</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Test server manually with <code>npx -y @package/server-name</code>. Verify env vars with <code>echo $VAR_NAME</code>.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Plugin Conflicts
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Two plugins trying to handle the same hook, unexpected behavior</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Multiple plugins registered for same lifecycle event without coordination</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Search for conflicting hooks with <code>grep -r "PostToolUse" ~/.claude/plugins/</code>. Disable one or sequence intentionally.</div>
        </div>

        <div class="gotcha-box">
          <div class="gotcha-title">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Skill Not Auto-Loading
          </div>
          <div class="gotcha-detail"><strong>Symptom:</strong> Plugin skill exists but doesn't activate on relevant queries</div>
          <div class="gotcha-detail"><strong>Cause:</strong> Trigger keywords not matching, or skill file missing</div>
          <div class="gotcha-detail"><strong>Fix:</strong> Verify skill has triggers in plugin.json. Test with explicit load: "Load the [skill-name] skill".</div>
        </div>
      </section>

      <!-- Section 8: WHEN TO USE -->
      <section id="when" data-activity="when">
        <h2 class="section-title">
          <span class="section-number">8</span>
          When to Use / When Not
        </h2>

        <div class="when-grid">
          <div class="when-use">
            <div class="when-title">
              <i data-lucide="check" class="w-5 h-5"></i>
              USE PLUGINS WHEN
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Capability is reusable across projects (not one-off)</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Behavior should be consistent regardless of CLAUDE.md</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Need to share capability with team or community</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Capability requires lifecycle hooks (pre/post tool use)</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Want versioning and updates separate from project</span>
            </div>
          </div>

          <div class="when-not">
            <div class="when-title">
              <i data-lucide="x" class="w-5 h-5"></i>
              DON'T USE PLUGINS WHEN
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Project-specific behavior - use CLAUDE.md instead</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>One-time automation - use a shell script instead</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Simple tool access - use MCP server directly</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Experimental/unstable - iterate in CLAUDE.md first</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Only used by you, only on one project - overhead not worth it</span>
            </div>
          </div>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8">Quick Reference: Installation Syntax</h3>

        <div class="code-block">
          <button class="copy-btn" onclick="copyCodeBlock(this)">
            <i data-lucide="copy" class="w-3 h-3"></i>
            Copy
          </button>
          <pre><span class="comment"># Add a marketplace</span>
/plugin marketplace add [author]/[repo]

<span class="comment"># Install from marketplace</span>
/plugin install [plugin-name]@[marketplace-name]

<span class="comment"># Direct CLI installation</span>
claude plugin install [plugin-name]

<span class="comment"># Invoke a plugin command</span>
/[plugin-name]:[command]

<span class="comment"># Natural language invocation</span>
"Use the code simplifier agent to clean up this code"</pre>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8">Quick Reference: Hook Configuration</h3>

        <div class="code-block">
          <button class="copy-btn" onclick="copyCodeBlock(this)">
            <i data-lucide="copy" class="w-3 h-3"></i>
            Copy
          </button>
          <pre>{
  <span class="string">"hooks"</span>: {
    <span class="string">"PostToolUse"</span>: [{
      <span class="string">"matcher"</span>: <span class="string">"Edit"</span>,
      <span class="string">"hooks"</span>: [{
        <span class="string">"type"</span>: <span class="string">"command"</span>,
        <span class="string">"command"</span>: <span class="string">"prettier --write $FILE"</span>
      }]
    }]
  }
}</pre>
        </div>
      </section>

    