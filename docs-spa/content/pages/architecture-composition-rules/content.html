

      <!-- Section 1: ESSENCE -->
      <section id="essence" data-activity="essence">
        <div class="essence-box">
          <div class="essence-label">Essence (15 words)</div>
          <div class="essence-text">Primitives combine through operators into patterns. Wrong combinations break. Right combinations unlock emergent capability.</div>
        </div>
      </section>

      <!-- Section 2: CORE ABSTRACTION -->
      <section id="core-abstraction" data-activity="core">
        <h2 class="section-title">
          <span class="section-number">2</span>
          The Core Abstraction
        </h2>

        <div class="core-abstraction">
          <div class="core-philosophy">"Patterns aren't monoliths. They're compositions of primitives with operators."</div>

          <div class="core-code">
            <button class="copy-btn" onclick="copyCode(this, 'Pattern = Primitive1 + Primitive2 + ... | Operator')">
              <i data-lucide="copy" class="w-3 h-3"></i>
              Copy
            </button>
            <code>Pattern = Primitive1 + Primitive2 + ... | Operator</code>
          </div>

          <div class="core-anchor">Every pattern decomposes to this. Understand primitives and operators, understand everything.</div>
        </div>

        <p class="text-text-secondary mb-6">
          Ralph, CC Mirror, Gas Town, and Panopticon aren't magic. They're combinations of the same building blocks: loops, state files, agents, hooks, and isolation boundaries. The difference is HOW they're combined.
        </p>

        <p class="text-text-secondary mb-6">
          This document is a grammar for agent orchestration. Learn the vocabulary (primitives), the syntax (operators), and the valid sentences (compositions). Then you can write your own patterns instead of copying others.
        </p>

        <h3 class="font-semibold text-lg mb-4 mt-8">The Primitive Inventory</h3>

        <div class="code-block">
          <button class="copy-btn" onclick="copyCodeBlock(this)">
            <i data-lucide="copy" class="w-3 h-3"></i>
            Copy
          </button>
          <pre><span class="comment"># Control Flow Primitives</span>
<span class="variable">Bash Loop</span>      <span class="comment"># while :; do ... done</span>
<span class="variable">Fresh Context</span>  <span class="comment"># New Claude per iteration</span>
<span class="variable">Stop Hook</span>      <span class="comment"># Intercepts exit, restarts</span>
<span class="variable">Completion</span>     <span class="comment"># &lt;promise&gt;COMPLETE&lt;/promise&gt;</span>

<span class="comment"># State Primitives</span>
<span class="variable">JSON Tasks</span>     <span class="comment"># prd.json with passes: true/false</span>
<span class="variable">File State</span>     <span class="comment"># progress.txt (append-only)</span>
<span class="variable">Git Memory</span>     <span class="comment"># Commits persist across resets</span>
<span class="variable">CLAUDE.md</span>      <span class="comment"># Static project context</span>

<span class="comment"># Agent Primitives</span>
<span class="variable">Orchestrator</span>   <span class="comment"># Coordinates, no tools</span>
<span class="variable">Worker</span>         <span class="comment"># Executes, no spawning</span>
<span class="variable">Subagent</span>       <span class="comment"># Task() for isolated context</span>
<span class="variable">TaskAPI</span>        <span class="comment"># TaskCreate, TaskUpdate, blockedBy</span>

<span class="comment"># Isolation Primitives</span>
<span class="variable">Directory</span>      <span class="comment"># Separate filesystem per domain</span>
<span class="variable">Git Worktree</span>   <span class="comment"># Parallel branches without conflicts</span>
<span class="variable">Docker</span>         <span class="comment"># Full process isolation</span>
<span class="variable">tmux Pane</span>      <span class="comment"># Visual monitoring</span></pre>
        </div>
      </section>

      <!-- Section 3: COMPOSITION EQUATIONS -->
      <section id="equation-ralph" data-activity="equations">
        <h2 class="section-title">
          <span class="section-number">3</span>
          Composition Equations
        </h2>

        <p class="text-text-secondary mb-6">
          Each major pattern can be expressed as an equation of primitives. This isn't metaphor - it's literally what they're made of.
        </p>

        <div class="equation-box">
          <div class="equation-title">
            <i data-lucide="repeat" class="w-5 h-5"></i>
            Ralph = Loop + JSON Tasks + File State + Git Memory
          </div>
          <div class="equation-formula">
while(!complete) {
  FreshContext()
  + ReadState(prd.json, progress.txt, git.log)
  + Execute(next_task)
  + Verify(tests, typecheck)
  + UpdateState(prd.json, progress.txt)
  + Commit()
  + CheckCompletion()
}</div>
          <div class="equation-why">
            <strong>Why it works:</strong> External memory (files, git) compensates for context reset. Each iteration benefits from accumulated learnings without context rot.
          </div>
        </div>

        <div class="equation-box" id="equation-ccmirror">
          <div class="equation-title">
            <i data-lucide="users" class="w-5 h-5"></i>
            CC Mirror = Orchestrator + Workers + Task API
          </div>
          <div class="equation-formula">
Orchestrator(TaskAPI) {
  TaskCreate(tasks[])
  + SetDependencies(blockedBy[])
  + for task in unblocked:
      Worker(task, tools=[Read,Write,Edit,Bash])
  + TaskUpdate(status)
}</div>
          <div class="equation-why">
            <strong>Why it works:</strong> Clear separation between coordination (orchestrator) and execution (workers). Workers can't spawn, preventing recursion. Task dependencies auto-schedule work.
          </div>
        </div>

        <div class="equation-box" id="equation-gastown">
          <div class="equation-title">
            <i data-lucide="factory" class="w-5 h-5"></i>
            Gas Town = Factory + Specialized Roles + Beads + tmux
          </div>
          <div class="equation-formula">
Factory {
  Mayor(coordination)
  + Deacon(monitoring)
  + Dogs(quality_gates)
  + for rig in rigs:
      Witness(rig, observation)
      + Refinery(rig, decomposition)
      + Polecat[](rig, persistent_workers)
      + Crew[](rig, ephemeral_workers)
  + Beads(shared_context)
  + AgentMail(communication)
  + Overseer(human_decisions)
}</div>
          <div class="equation-why">
            <strong>Why it works:</strong> Role specialization prevents overload. Factory can scale workers indefinitely. Beads provides shared context. Human stays in loop via inbox.
          </div>
        </div>

        <div class="equation-box">
          <div class="equation-title">
            <i data-lucide="eye" class="w-5 h-5"></i>
            Panopticon = Isolated Directories + Cron + Subagents
          </div>
          <div class="equation-formula">
for domain in domains:
  IsolatedDirectory(domain)
  + Cron(scheduled_pulls)
  + while(running):
      Claude(domain_tasks)
      + Subagent(specific_tasks)
      + FileHandoff(cross_domain_data)
      + Checkpoint(notify_human)</div>
          <div class="equation-why">
            <strong>Why it works:</strong> Domain isolation prevents context pollution. Cron provides automation. File handoffs enable cross-domain awareness without context bloat.
          </div>
        </div>
      </section>

      <!-- Section 4: OPERATORS -->
      <section id="operators" data-activity="operators">
        <h2 class="section-title">
          <span class="section-number">4</span>
          The 6 Composition Operators
        </h2>

        <p class="text-text-secondary mb-6">
          Operators define HOW primitives combine. Using the wrong operator breaks the pattern.
        </p>

        <div class="operator-box">
          <div class="operator-header">
            <div class="operator-symbol">A -&gt; B</div>
            <div class="operator-name">Sequential</div>
          </div>
          <div class="operator-description">
            Complete A before starting B. Used when order matters or state must be consistent.
          </div>
          <div class="code-block" style="margin-bottom: 0;">
            <pre><span class="comment"># Example: Ralph iteration</span>
Read_State() <span class="operator">-&gt;</span> Execute_Task() <span class="operator">-&gt;</span> Verify() <span class="operator">-&gt;</span> Commit() <span class="operator">-&gt;</span> Update_State()

<span class="comment"># Bash implementation</span>
task_a <span class="operator">&amp;&amp;</span> task_b <span class="operator">&amp;&amp;</span> task_c</pre>
          </div>
        </div>

        <div class="operator-box">
          <div class="operator-header">
            <div class="operator-symbol">A || B</div>
            <div class="operator-name">Parallel</div>
          </div>
          <div class="operator-description">
            Execute A and B concurrently. Requires independence and isolation. Increases throughput at cost of complexity.
          </div>
          <div class="code-block" style="margin-bottom: 0;">
            <pre><span class="comment"># Example: Parallel Ralph with worktrees</span>
(cd wt-feature-a &amp;&amp; ./ralph.sh) <span class="operator">&amp;</span>
(cd wt-feature-b &amp;&amp; ./ralph.sh) <span class="operator">&amp;</span>
(cd wt-feature-c &amp;&amp; ./ralph.sh) <span class="operator">&amp;</span>
wait</pre>
          </div>
        </div>

        <div class="operator-box">
          <div class="operator-header">
            <div class="operator-symbol">A { B }</div>
            <div class="operator-name">Nested</div>
          </div>
          <div class="operator-description">
            B runs within A's scope. Used for subagent isolation. Protects main context from expensive operations.
          </div>
          <div class="code-block" style="margin-bottom: 0;">
            <pre><span class="comment"># Example: Playwright verification in subagent</span>
MainAgent {
  Implement(ui_task)
  <span class="operator">Subagent</span>(Playwright) {
    Navigate(url)
    Screenshot()
    Assert(visual_state)
  }
  MarkComplete(if_verified)
}</pre>
          </div>
        </div>

        <div class="operator-box">
          <div class="operator-header">
            <div class="operator-symbol">X ? A : B</div>
            <div class="operator-name">Conditional</div>
          </div>
          <div class="operator-description">
            Choose path based on condition. Used for error recovery, model selection, or optimization.
          </div>
          <div class="code-block" style="margin-bottom: 0;">
            <pre><span class="comment"># Example: Ralph completion check</span>
<span class="keyword">if</span> grep -q <span class="string">"COMPLETE"</span> output.txt; <span class="keyword">then</span>
  <span class="keyword">break</span>  <span class="comment"># Exit loop</span>
<span class="keyword">else</span>
  <span class="keyword">continue</span>  <span class="comment"># Next iteration</span>
<span class="keyword">fi</span></pre>
          </div>
        </div>

        <div class="operator-box">
          <div class="operator-header">
            <div class="operator-symbol">while(!done) { A }</div>
            <div class="operator-name">Iterative</div>
          </div>
          <div class="operator-description">
            Repeat until termination. MUST have explicit completion condition, max iterations, and external memory.
          </div>
          <div class="code-block" style="margin-bottom: 0;">
            <pre><span class="comment"># Example: Bounded Ralph loop</span>
<span class="keyword">for</span> i <span class="keyword">in</span> $(seq 1 $MAX_ITERATIONS); <span class="keyword">do</span>
  claude @prompt.md
  <span class="comment"># Check for completion signal</span>
<span class="keyword">done</span></pre>
          </div>
        </div>

        <div class="operator-box">
          <div class="operator-header">
            <div class="operator-symbol">A -&gt; spawn(B)</div>
            <div class="operator-name">Delegation</div>
          </div>
          <div class="operator-description">
            A creates B for subtask. Parent can't see child's context. Child can't spawn (prevents recursion).
          </div>
          <div class="code-block" style="margin-bottom: 0;">
            <pre><span class="comment"># Example: Orchestrator spawns workers</span>
Orchestrator <span class="operator">-&gt;</span> spawn(Worker(task_1))
Orchestrator <span class="operator">-&gt;</span> spawn(Worker(task_2))
<span class="comment"># Workers return results via Task output</span></pre>
          </div>
        </div>
      </section>

      <!-- Section 5: VALID COMPOSITIONS -->
      <section id="valid" data-activity="valid">
        <h2 class="section-title">
          <span class="section-number">5</span>
          Valid Compositions
        </h2>

        <p class="text-text-secondary mb-6">
          Not everything composes. Here's what works and why.
        </p>

        <h3 class="font-semibold text-lg mb-4">Compatibility Matrix</h3>

        <div class="matrix-container">
          <table class="matrix-table">
            <tbody><tr>
              <th></th>
              <th>Loop</th>
              <th>Tasks</th>
              <th>Subagent</th>
              <th>Worktree</th>
              <th>Docker</th>
              <th>Hooks</th>
              <th>Memory</th>
            </tr>
            <tr>
              <th>Loop</th>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
            </tr>
            <tr>
              <th>Tasks</th>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="caution">C</td>
              <td class="caution">C</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
            </tr>
            <tr>
              <th>Subagent</th>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="caution">C</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
            </tr>
            <tr>
              <th>Worktree</th>
              <td class="works">Y</td>
              <td class="caution">C</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
            </tr>
            <tr>
              <th>Docker</th>
              <td class="works">Y</td>
              <td class="caution">C</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
            </tr>
            <tr>
              <th>Hooks</th>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
            </tr>
            <tr>
              <th>Memory</th>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
              <td class="works">Y</td>
            </tr>
          </tbody></table>
        </div>
        <p class="text-sm text-text-muted mb-8">Y = Works well | C = Works with caveats (see documentation)</p>

        <h3 class="font-semibold text-lg mb-4">Composition Tiers</h3>

        <div class="tier-box">
          <div class="tier-header">
            <div class="tier-badge">TIER 1</div>
            <div>
              <div class="tier-title">Solo Developer (Quick Win)</div>
              <div class="tier-effort">1 hour setup | Single agent cost</div>
            </div>
          </div>
          <div class="code-block" style="margin-bottom: 0;">
            <pre><span class="variable">Ralph</span> = Loop + JSON + Git
<span class="comment"># Overnight feature development for one dev</span></pre>
          </div>
        </div>

        <div class="tier-box">
          <div class="tier-header">
            <div class="tier-badge">TIER 2</div>
            <div>
              <div class="tier-title">Power User (Medium Lift)</div>
              <div class="tier-effort">Half-day setup | Moderate cost (subagent overhead)</div>
            </div>
          </div>
          <div class="code-block" style="margin-bottom: 0;">
            <pre><span class="variable">Ralph + Playwright</span> = Loop + Browser + Subagents
<span class="variable">CC Mirror</span> = Orchestrator + Workers + Tasks
<span class="comment"># UI verification, multi-agent coordination</span></pre>
          </div>
        </div>

        <div class="tier-box">
          <div class="tier-header">
            <div class="tier-badge">TIER 3</div>
            <div>
              <div class="tier-title">Agent Factory (Deep Dive)</div>
              <div class="tier-effort">Days of setup | High cost (multiple accounts)</div>
            </div>
          </div>
          <div class="code-block" style="margin-bottom: 0;">
            <pre><span class="variable">Gas Town</span> = 7 Roles + Beads + tmux + Mail
<span class="variable">Parallel Ralph</span> = Worktrees + Multiple Loops
<span class="comment"># Maximum throughput, factory-scale</span></pre>
          </div>
        </div>
      </section>

      <!-- Section 6: ANTI-PATTERNS -->
      <section id="antipatterns" data-activity="antipatterns">
        <h2 class="section-title">
          <span class="section-number">6</span>
          Invalid Compositions (Anti-patterns)
        </h2>

        <p class="text-text-secondary mb-6">
          These break. Learn why so you don't reinvent failed experiments.
        </p>

        <div class="antipattern-box">
          <div class="antipattern-title">
            <i data-lucide="alert-octagon" class="w-4 h-4"></i>
            Subagent Recursion
          </div>
          <div class="antipattern-code">
Worker {
  Subagent {
    Subagent {    // INFINITE RECURSION
      ...
    }
  }
}</div>
          <div class="antipattern-why"><strong>Why it breaks:</strong> Unbounded context growth. Each level spawns more. Eventually hits limits or costs explode.</div>
          <div class="antipattern-fix"><strong>Fix:</strong> Workers NEVER spawn. Only orchestrators spawn.</div>
        </div>

        <div class="antipattern-box">
          <div class="antipattern-title">
            <i data-lucide="alert-octagon" class="w-4 h-4"></i>
            Loop Without External Memory
          </div>
          <div class="antipattern-code">
while true; do
  claude "Continue working"  // NO STATE BETWEEN ITERATIONS
done</div>
          <div class="antipattern-why"><strong>Why it breaks:</strong> Each iteration starts from zero. No learning. No progress tracking. Repeats same mistakes.</div>
          <div class="antipattern-fix"><strong>Fix:</strong> Add prd.json, progress.txt, git commits. External memory compensates for context reset.</div>
        </div>

        <div class="antipattern-box">
          <div class="antipattern-title">
            <i data-lucide="alert-octagon" class="w-4 h-4"></i>
            Parallel Without Isolation
          </div>
          <div class="antipattern-code">
Terminal 1: claude "Edit src/auth.ts"
Terminal 2: claude "Edit src/auth.ts"  // CONFLICT</div>
          <div class="antipattern-why"><strong>Why it breaks:</strong> Race conditions. Overwrites. Broken state. One agent's work destroys another's.</div>
          <div class="antipattern-fix"><strong>Fix:</strong> Use git worktrees. Or serialize access. Or file-level locking.</div>
        </div>

        <div class="antipattern-box">
          <div class="antipattern-title">
            <i data-lucide="alert-octagon" class="w-4 h-4"></i>
            Orchestrator With Tools
          </div>
          <div class="antipattern-code">
Orchestrator {
  Write(file)     // WRONG - should delegate
  Edit(file)      // WRONG - should delegate
  spawn(Worker)
}</div>
          <div class="antipattern-why"><strong>Why it breaks:</strong> Orchestrator context fills with tool output. Loses coordination capacity. Becomes unfocused.</div>
          <div class="antipattern-fix"><strong>Fix:</strong> Orchestrator ONLY uses TaskCreate, TaskUpdate, Task(). Workers do implementation.</div>
        </div>

        <div class="antipattern-box">
          <div class="antipattern-title">
            <i data-lucide="alert-octagon" class="w-4 h-4"></i>
            Loop Without Termination
          </div>
          <div class="antipattern-code">
while true; do
  claude @prompt.md
done
// NO EXIT CONDITION</div>
          <div class="antipattern-why"><strong>Why it breaks:</strong> Runs forever. Consumes unlimited tokens. No completion signal.</div>
          <div class="antipattern-fix"><strong>Fix:</strong> Add completion promise. Add max iterations. Add stuck detection.</div>
        </div>

        <div class="antipattern-box">
          <div class="antipattern-title">
            <i data-lucide="alert-octagon" class="w-4 h-4"></i>
            Context Pollution
          </div>
          <div class="antipattern-code">
claude "
  Fix the auth bug AND
  Update the marketing copy AND
  Analyze financial data AND
  Generate workout plan
"</div>
          <div class="antipattern-why"><strong>Why it breaks:</strong> Unrelated concerns bloat context. Model gets confused. Quality degrades.</div>
          <div class="antipattern-fix"><strong>Fix:</strong> Isolate domains (directories, sessions). One domain per context.</div>
        </div>
      </section>

      <!-- Section 7: WHAT'S HARD -->
      <section id="hard" data-activity="hard">
        <h2 class="section-title">
          <span class="section-number">7</span>
          What's Hard
        </h2>

        <p class="text-text-secondary mb-6">
          These are fundamental tensions in composition, not bugs to fix.
        </p>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Isolation vs. Coordination
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Strong isolation (worktrees, containers) prevents interference but makes coordination harder. Shared state enables coordination but creates conflicts.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Parallel agents step on each other (weak isolation), OR agents can't share context (strong isolation).</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Use Beads-style shared data plane. File handoffs for cross-agent communication. Accept that some re-work is the cost of parallelism.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Operator Selection
          </div>
          <div class="hard-detail"><strong>The tension:</strong> Sequential is safe but slow. Parallel is fast but complex. Nested is clean but costly. No operator is universally right.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> Sequential bottlenecks at scale. Parallel race conditions. Nested context explosion.</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Start sequential, parallelize only proven bottlenecks. Use nested for expensive isolation. Profile before optimizing.</div>
        </div>

        <div class="hard-box">
          <div class="hard-title">
            <i data-lucide="flame" class="w-4 h-4"></i>
            Composition Debugging
          </div>
          <div class="hard-detail"><strong>The tension:</strong> When a composition fails, which primitive broke? Which operator was wrong? The more components, the harder to diagnose.</div>
          <div class="hard-detail"><strong>Symptoms:</strong> "It just doesn't work" without clear failure signal. Output is garbage but all primitives seem fine.</div>
          <div class="hard-detail"><strong>Mitigation:</strong> Build incrementally. Test primitives in isolation first. Add one component at a time. Keep compositions minimal.</div>
        </div>
      </section>

      <!-- Section 8: DECISION TREE -->
      <section id="decision" data-activity="decision">
        <h2 class="section-title">
          <span class="section-number">8</span>
          Composition Decision Tree
        </h2>

        <p class="text-text-secondary mb-6">
          Start here. Answer questions to find your pattern.
        </p>

        <div class="path-container">
          <div class="path-step">
            <div class="path-number">Q</div>
            <div class="path-content"><strong>What are you building?</strong></div>
          </div>
          <div class="path-step">
            <div class="path-number">1</div>
            <div class="path-content">
              <strong>Single feature, well-defined completion?</strong><br>
              <span class="text-accent font-medium">Use: RALPH</span> - Loop + JSON + Git<br>
              <span class="text-text-muted">Effort: Quick Win (1 hour)</span>
            </div>
          </div>
          <div class="path-step">
            <div class="path-number">2</div>
            <div class="path-content">
              <strong>Multiple features, need parallelization?</strong><br>
              Same repo, no file conflicts? <span class="text-accent font-medium">Use: PARALLEL RALPH</span> - Worktrees + Multiple Loops<br>
              Need task dependencies? <span class="text-accent font-medium">Use: CC MIRROR</span> - Orchestrator + Workers + Task API
            </div>
          </div>
          <div class="path-step">
            <div class="path-number">3</div>
            <div class="path-content">
              <strong>UI-heavy work?</strong><br>
              <span class="text-accent font-medium">Use: RALPH + PLAYWRIGHT</span> - Loop + Browser Subagent<br>
              <span class="text-text-muted">Note: Subagent isolates high token cost</span>
            </div>
          </div>
          <div class="path-step">
            <div class="path-number">4</div>
            <div class="path-content">
              <strong>Multi-domain life automation?</strong><br>
              <span class="text-accent font-medium">Use: PANOPTICON</span> - Isolated Dirs + Cron + Handoffs<br>
              <span class="text-text-muted">Note: Domain isolation prevents context pollution</span>
            </div>
          </div>
          <div class="path-step">
            <div class="path-number">5</div>
            <div class="path-content">
              <strong>Maximum throughput, cost no object?</strong><br>
              Stage 7+ developer? <span class="text-accent font-medium">Use: GAS TOWN</span> - Factory + Roles + Beads + tmux<br>
              Stage 5-6 developer? <span class="text-accent font-medium">Use: CC MIRROR</span> - 80% of value, 10% of effort
            </div>
          </div>
        </div>

        <div class="when-grid">
          <div class="when-use">
            <div class="when-title">
              <i data-lucide="check" class="w-5 h-5"></i>
              COMPOSE PATTERNS WHEN
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Base pattern is insufficient for your needs</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>Components are in the compatibility matrix</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>You understand each primitive in isolation</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>You can articulate why each operator choice</span>
            </div>
            <div class="when-item">
              <i data-lucide="check" class="w-4 h-4 flex-shrink-0"></i>
              <span>You have debugged simpler versions first</span>
            </div>
          </div>

          <div class="when-not">
            <div class="when-title">
              <i data-lucide="x" class="w-5 h-5"></i>
              DON'T COMPOSE WHEN
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>A simpler pattern already solves your problem</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>You're copying without understanding</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>Components aren't in compatibility matrix</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>You can't debug the simpler version</span>
            </div>
            <div class="when-item">
              <i data-lucide="x" class="w-4 h-4 flex-shrink-0"></i>
              <span>"More complex = better" is your reasoning</span>
            </div>
          </div>
        </div>

        <h3 class="font-semibold text-lg mb-4 mt-8">Quick Reference: Composition Formulas</h3>

        <div class="code-block">
          <button class="copy-btn" onclick="copyCodeBlock(this)">
            <i data-lucide="copy" class="w-3 h-3"></i>
            Copy
          </button>
          <pre><span class="comment"># Pattern Equations (Memorize These)</span>

<span class="variable">Ralph</span>          = while(!complete) { Fresh + State + Execute + Verify + Commit }
<span class="variable">CC Mirror</span>      = Orchestrator(TaskAPI) { spawn(Workers) }
<span class="variable">Gas Town</span>       = Factory { Mayor + Roles[] + Beads + Mail + Human }
<span class="variable">Panopticon</span>     = Domains[] { Cron + Claude + Handoffs }
<span class="variable">Orchestra</span>      = Docker { while(true) { if(idle) improve() else work() } }
<span class="variable">Ralph+Play</span>     = Ralph { Subagent(Playwright.verify()) }
<span class="variable">Parallel Ralph</span> = Worktrees[] { Ralph(worktree) } + Merge</pre>
        </div>
      </section>

    