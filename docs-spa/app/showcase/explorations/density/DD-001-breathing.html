<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DD-001: Density Breathing</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

  <style>
    /* ═══════════════════════════════════════════════════════════════════════════
       LOCKED DESIGN TOKENS — From DESIGN-TOKEN-SUMMARY.md
       ═══════════════════════════════════════════════════════════════════════════ */
    :root {
      /* Colors */
      --color-primary: #E83025;
      --color-background: #FEF9F5;
      --color-text: #1A1A1A;
      --color-text-secondary: #666666;
      --color-border: #E0D5C5;
      --color-border-subtle: #F0EBE3;

      /* Typography */
      --font-display: 'Instrument Serif', Georgia, serif;
      --font-body: 'Inter', system-ui, sans-serif;
      --font-mono: 'JetBrains Mono', 'SF Mono', monospace;

      /* Geometry — LOCKED */
      --border-radius: 0;
      --box-shadow: none;

      /* Spacing */
      --space-1: 4px;
      --space-2: 8px;
      --space-3: 12px;
      --space-4: 16px;
      --space-5: 20px;
      --space-6: 24px;
      --space-8: 32px;
      --space-10: 40px;
      --space-12: 48px;
      --space-16: 64px;

      /* Callout Accents */
      --accent-blue: #4A90D9;
      --accent-green: #4A9D6B;
      --accent-coral: #C97065;
      --accent-amber: #D97706;
      --accent-purple: #7C3AED;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-body);
      background: var(--color-background);
      color: var(--color-text);
      line-height: 1.6;
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       EXPLORATION HEADER
       ═══════════════════════════════════════════════════════════════════════════ */
    .exploration-header {
      border-bottom: 3px solid var(--color-primary);
      padding: var(--space-6);
      background: white;
      margin-bottom: var(--space-12);
    }

    .exploration-id {
      font-family: var(--font-mono);
      font-size: 11px;
      color: var(--color-primary);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: var(--space-2);
    }

    .exploration-title {
      font-family: var(--font-display);
      font-size: 32px;
      font-style: italic;
      margin-bottom: var(--space-3);
    }

    .exploration-hypothesis {
      font-size: 14px;
      color: var(--color-text-secondary);
      max-width: 600px;
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       PAGE CONTAINER
       ═══════════════════════════════════════════════════════════════════════════ */
    .page-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 0 var(--space-6);
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       BREATHING RHYTHM SECTIONS
       The core experiment: alternating INHALE (dense) and EXHALE (sparse)
       ═══════════════════════════════════════════════════════════════════════════ */

    /* EXHALE sections: Sparse, welcoming, expansive */
    .section-exhale {
      padding: 92px var(--space-6);
      margin-bottom: var(--space-8);
    }

    /* INHALE sections: Dense, information-rich, compressed */
    .section-inhale {
      padding: var(--space-6);
      margin-bottom: var(--space-8);
    }

    /* Visual rhythm indicator (diagnostic only, could be removed in production) */
    .breath-indicator {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--color-border);
      text-transform: uppercase;
      letter-spacing: 0.2em;
      margin-bottom: var(--space-4);
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       COMPONENT STYLES (Authentic KortAI)
       ═══════════════════════════════════════════════════════════════════════════ */

    /* HEADINGS */
    h2 {
      font-family: var(--font-display);
      font-size: 28px;
      font-style: italic;
      margin-bottom: var(--space-4);
    }

    h3 {
      font-family: var(--font-display);
      font-size: 20px;
      margin-bottom: var(--space-3);
    }

    p {
      margin-bottom: var(--space-4);
      max-width: 65ch;
    }

    /* ESSENCE CALLOUT — The Archivist of Axioms */
    .callout-essence {
      border-left: 4px solid var(--accent-amber);
      background: rgba(217, 119, 6, 0.05);
      padding: var(--space-6) var(--space-5);
      margin-bottom: var(--space-6);
    }

    .callout-essence__label {
      font-family: var(--font-body);
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--accent-amber);
      margin-bottom: var(--space-3);
    }

    .callout-essence__content {
      font-family: var(--font-display);
      font-size: 18px;
      font-style: italic;
      line-height: 1.7;
      color: var(--color-text);
    }

    /* CODE SNIPPET — The Precise Transcriptionist */
    .code-snippet {
      background: #1E1E1E;
      margin-bottom: var(--space-6);
    }

    .code-snippet__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-2) var(--space-4);
      background: rgba(255,255,255,0.05);
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .code-snippet__filename {
      font-family: var(--font-mono);
      font-size: 12px;
      color: #888;
    }

    .code-snippet__copy {
      font-family: var(--font-body);
      font-size: 11px;
      color: var(--color-primary);
      padding: var(--space-1) var(--space-2);
      border: 1px solid var(--color-primary);
      background: transparent;
      cursor: pointer;
    }

    .code-snippet__content {
      padding: var(--space-4);
      font-family: var(--font-mono);
      font-size: 13px;
      line-height: 1.6;
      color: #F5F0EB;
      overflow-x: auto;
    }

    .code-snippet__content .comment { color: #6A9955; }
    .code-snippet__content .keyword { color: #569CD6; }
    .code-snippet__content .string { color: #CE9178; }
    .code-snippet__content .function { color: #DCDCAA; }
    .code-snippet__content .variable { color: #9CDCFE; }

    /* TIP CALLOUT — The Seasoned Colleague */
    .callout-tip {
      border-left: 4px solid var(--accent-green);
      background: rgba(74, 157, 107, 0.05);
      padding: var(--space-5) var(--space-5);
      margin-bottom: var(--space-6);
    }

    .callout-tip__label {
      font-family: var(--font-body);
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--accent-green);
      margin-bottom: var(--space-2);
    }

    .callout-tip__content {
      font-size: 14px;
    }

    /* GOTCHA CALLOUT — The Vigilant Sentinel */
    .callout-gotcha {
      border-left: 4px solid var(--color-primary);
      background: rgba(232, 48, 37, 0.05);
      padding: var(--space-5) var(--space-5);
      margin-bottom: var(--space-6);
    }

    .callout-gotcha__label {
      font-family: var(--font-body);
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--color-primary);
      margin-bottom: var(--space-2);
    }

    .callout-gotcha__content {
      font-size: 14px;
    }

    /* INFO CALLOUT — The Senior Concierge */
    .callout-info {
      border-left: 4px solid var(--accent-blue);
      background: rgba(74, 144, 217, 0.05);
      padding: var(--space-5) var(--space-5);
      margin-bottom: var(--space-6);
    }

    .callout-info__label {
      font-family: var(--font-body);
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--accent-blue);
      margin-bottom: var(--space-2);
    }

    .callout-info__content {
      font-size: 14px;
    }

    /* FILE TREE — The Methodical Surveyor */
    .file-tree {
      border-left: 4px solid var(--accent-blue);
      background: var(--color-background);
      border: 1px solid var(--color-border-subtle);
      border-left: 4px solid var(--accent-blue);
      padding: var(--space-4);
      margin-bottom: var(--space-6);
    }

    .file-tree__label {
      font-family: var(--font-body);
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--accent-blue);
      margin-bottom: var(--space-3);
    }

    .file-tree__content {
      font-family: var(--font-mono);
      font-size: 13px;
      line-height: 1.7;
      white-space: pre;
    }

    .file-tree__content .folder { color: var(--accent-blue); }
    .file-tree__content .file { color: var(--color-text); }

    /* DENSE COMPONENT GRID — For INHALE sections */
    .dense-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-4);
      margin-bottom: var(--space-6);
    }

    @media (max-width: 768px) {
      .dense-grid {
        grid-template-columns: 1fr;
      }
    }

    .dense-card {
      border: 1px solid var(--color-border-subtle);
      padding: var(--space-4);
    }

    .dense-card__title {
      font-family: var(--font-display);
      font-size: 16px;
      font-style: italic;
      margin-bottom: var(--space-2);
    }

    .dense-card__content {
      font-size: 13px;
      color: var(--color-text-secondary);
    }

    /* DECISION MATRIX — The Impartial Cartographer */
    .decision-matrix {
      border-left: 4px solid var(--color-primary);
      margin-bottom: var(--space-6);
    }

    .decision-matrix__header {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr;
      gap: var(--space-4);
      padding: var(--space-3) var(--space-4);
      background: rgba(232, 48, 37, 0.05);
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .decision-matrix__row {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr;
      gap: var(--space-4);
      padding: var(--space-3) var(--space-4);
      border-bottom: 1px solid var(--color-border-subtle);
      font-size: 14px;
    }

    .decision-matrix__row:last-child {
      border-bottom: none;
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       BREATHING RHYTHM DEMONSTRATION
       Pattern: EXHALE → INHALE → EXHALE → INHALE → EXHALE
       ═══════════════════════════════════════════════════════════════════════════ */
  </style>
</head>
<body>

  <!-- EXPLORATION HEADER -->
  <header class="exploration-header">
    <div class="exploration-id">DD-001 — Density Exploration</div>
    <h1 class="exploration-title">Density Breathing</h1>
    <p class="exploration-hypothesis">
      <strong>Hypothesis:</strong> Pages can "breathe" with alternating dense and sparse sections
      that feel organic, like inhale/exhale cycles. Applying R-3 Breathing Framework.
    </p>
  </header>

  <main class="page-container">

    <!-- ═══════════════════════════════════════════════════════════════════════
         EXHALE 1: Opening — Low density, welcoming, user attention gathered
         ═══════════════════════════════════════════════════════════════════════ -->
    <section class="section-exhale">
      <div class="breath-indicator">↓ EXHALE — SPARSE</div>

      <h2>Understanding Authentication Flows</h2>
      <p>
        Authentication is the foundation of secure applications. Before implementing tokens,
        session management, or OAuth flows, you need to understand the core mental model.
      </p>

      <div class="callout-essence">
        <div class="callout-essence__label">Essence</div>
        <div class="callout-essence__content">
          Authentication answers one question: "Who are you?" Authorization answers a different
          question: "What can you do?" Never conflate the two — this is the source of most
          security vulnerabilities.
        </div>
      </div>
    </section>


    <!-- ═══════════════════════════════════════════════════════════════════════
         INHALE 1: Dense information — Technical depth, high content density
         ═══════════════════════════════════════════════════════════════════════ -->
    <section class="section-inhale">
      <div class="breath-indicator">↑ INHALE — DENSE</div>

      <h3>Token-Based Authentication</h3>

      <div class="code-snippet">
        <div class="code-snippet__header">
          <span class="code-snippet__filename">auth/middleware.ts</span>
          <button class="code-snippet__copy">Copy</button>
        </div>
        <div class="code-snippet__content">
<span class="keyword">import</span> { <span class="variable">NextRequest</span>, <span class="variable">NextResponse</span> } <span class="keyword">from</span> <span class="string">'next/server'</span>;
<span class="keyword">import</span> { <span class="function">verifyToken</span> } <span class="keyword">from</span> <span class="string">'./jwt'</span>;

<span class="keyword">export async function</span> <span class="function">authMiddleware</span>(<span class="variable">req</span>: <span class="variable">NextRequest</span>) {
  <span class="keyword">const</span> <span class="variable">token</span> = <span class="variable">req</span>.<span class="function">cookies</span>.<span class="function">get</span>(<span class="string">'auth-token'</span>);

  <span class="keyword">if</span> (!<span class="variable">token</span>) {
    <span class="keyword">return</span> <span class="variable">NextResponse</span>.<span class="function">redirect</span>(<span class="string">'/login'</span>);
  }

  <span class="keyword">try</span> {
    <span class="keyword">const</span> <span class="variable">payload</span> = <span class="keyword">await</span> <span class="function">verifyToken</span>(<span class="variable">token</span>);
    <span class="comment">// Attach user to request context</span>
    <span class="variable">req</span>.<span class="variable">user</span> = <span class="variable">payload</span>;
    <span class="keyword">return</span> <span class="variable">NextResponse</span>.<span class="function">next</span>();
  } <span class="keyword">catch</span> (<span class="variable">error</span>) {
    <span class="keyword">return</span> <span class="variable">NextResponse</span>.<span class="function">redirect</span>(<span class="string">'/login?error=invalid_token'</span>);
  }
}
        </div>
      </div>

      <div class="dense-grid">
        <div class="callout-tip">
          <div class="callout-tip__label">Tip</div>
          <div class="callout-tip__content">
            Store tokens in HTTP-only cookies rather than localStorage. This prevents XSS attacks
            from accessing tokens directly.
          </div>
        </div>

        <div class="callout-gotcha">
          <div class="callout-gotcha__label">Gotcha</div>
          <div class="callout-gotcha__content">
            Token expiration must be checked on every request. A "valid signature" doesn't mean
            "valid session" — the token could be expired.
          </div>
        </div>
      </div>

      <div class="file-tree">
        <div class="file-tree__label">Project Structure</div>
        <div class="file-tree__content"><span class="folder">auth/</span>
├── <span class="file">middleware.ts</span>      <span class="comment"># Request interception</span>
├── <span class="file">jwt.ts</span>             <span class="comment"># Token signing/verification</span>
├── <span class="file">providers.ts</span>       <span class="comment"># OAuth provider configs</span>
└── <span class="folder">strategies/</span>
    ├── <span class="file">credentials.ts</span> <span class="comment"># Username/password</span>
    └── <span class="file">oauth.ts</span>       <span class="comment"># Social login</span></div>
      </div>
    </section>


    <!-- ═══════════════════════════════════════════════════════════════════════
         EXHALE 2: Recovery space — Low density, absorption time
         ═══════════════════════════════════════════════════════════════════════ -->
    <section class="section-exhale">
      <div class="breath-indicator">↓ EXHALE — SPARSE</div>

      <h2>Choosing an Authentication Strategy</h2>
      <p>
        There's no universally correct authentication strategy. The right choice depends on your
        application's security requirements, user experience goals, and operational constraints.
      </p>
    </section>


    <!-- ═══════════════════════════════════════════════════════════════════════
         INHALE 2: Decision information — Structured comparison, high density
         ═══════════════════════════════════════════════════════════════════════ -->
    <section class="section-inhale">
      <div class="breath-indicator">↑ INHALE — DENSE</div>

      <h3>Strategy Comparison</h3>

      <div class="decision-matrix">
        <div class="decision-matrix__header">
          <span>Strategy</span>
          <span>Security</span>
          <span>Complexity</span>
          <span>Best For</span>
        </div>
        <div class="decision-matrix__row">
          <span>JWT Tokens</span>
          <span>Medium</span>
          <span>Low</span>
          <span>APIs, SPAs</span>
        </div>
        <div class="decision-matrix__row">
          <span>Session Cookies</span>
          <span>High</span>
          <span>Medium</span>
          <span>Traditional web</span>
        </div>
        <div class="decision-matrix__row">
          <span>OAuth 2.0</span>
          <span>High</span>
          <span>High</span>
          <span>Third-party auth</span>
        </div>
        <div class="decision-matrix__row">
          <span>Passkeys</span>
          <span>Very High</span>
          <span>Medium</span>
          <span>Modern apps</span>
        </div>
      </div>

      <div class="dense-grid">
        <div class="dense-card">
          <div class="dense-card__title">JWT Considerations</div>
          <div class="dense-card__content">
            Stateless but cannot be revoked. Set short expiration times (15-30 min) and use
            refresh token rotation.
          </div>
        </div>
        <div class="dense-card">
          <div class="dense-card__title">Session Considerations</div>
          <div class="dense-card__content">
            Requires server-side storage but enables immediate revocation. Consider Redis for
            distributed environments.
          </div>
        </div>
        <div class="dense-card">
          <div class="dense-card__title">OAuth Considerations</div>
          <div class="dense-card__content">
            Delegates authentication but adds dependency on external providers. Always support
            fallback authentication.
          </div>
        </div>
        <div class="dense-card">
          <div class="dense-card__title">Passkey Considerations</div>
          <div class="dense-card__content">
            Phishing-resistant and user-friendly but requires WebAuthn support. Not yet
            universal across all browsers.
          </div>
        </div>
      </div>

      <div class="callout-info">
        <div class="callout-info__label">Note</div>
        <div class="callout-info__content">
          Most production applications combine multiple strategies: OAuth for social login,
          credentials for enterprise users, and passkeys for security-conscious users.
        </div>
      </div>
    </section>


    <!-- ═══════════════════════════════════════════════════════════════════════
         EXHALE 3: Closing — Low density, completion, resolution
         ═══════════════════════════════════════════════════════════════════════ -->
    <section class="section-exhale">
      <div class="breath-indicator">↓ EXHALE — SPARSE</div>

      <h2>Next Steps</h2>
      <p>
        With authentication fundamentals understood, you're ready to implement your chosen
        strategy. The following guides dive deeper into each approach.
      </p>

      <div class="callout-essence">
        <div class="callout-essence__label">Key Takeaway</div>
        <div class="callout-essence__content">
          The best authentication system is the one your users don't notice. Invisible security
          is the highest form of the craft.
        </div>
      </div>
    </section>

  </main>

  <!--
    ═══════════════════════════════════════════════════════════════════════════
    BREATHING PATTERN SUMMARY
    ═══════════════════════════════════════════════════════════════════════════

    EXHALE 1 (Opening):     92px padding, 1-2 components, low density
    INHALE 1 (Technical):   24px padding, 5+ components, high density
    EXHALE 2 (Recovery):    92px padding, 1-2 components, low density
    INHALE 2 (Decision):    24px padding, 8+ components, high density
    EXHALE 3 (Closing):     92px padding, 2 components, low density

    The rhythm is: sparse → dense → sparse → dense → sparse
    This creates a PULSE pattern from R-3 research.
    ═══════════════════════════════════════════════════════════════════════════
  -->

</body>
</html>
