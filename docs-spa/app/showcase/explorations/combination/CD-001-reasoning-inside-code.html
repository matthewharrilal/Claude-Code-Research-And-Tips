<!-- ===============================================================================
INLINE THREADING HEADER -- CD Phase
File: explorations/combination/CD-001-reasoning-inside-code.html
Tier: A | Generated: 2026-02-11

1. WHY THIS EXISTS
Combination exploration testing how CRESCENDO density + NARRATIVE ARC organization
+ F-PATTERN + BENTO axis work together on a super-heavy composite page. The page
contains 3 heavy components (Code Snippet, Reasoning, Core Abstraction) and must
demonstrate the velocity rule (T2) can be honored even with extreme heavy-component
density.

2. QUESTION IT ANSWERS
Can a page with 3 heavy component types (Code, Reasoning, Core Abstraction) honor
the velocity rule by interleaving FAST callouts, while the CRESCENDO density builds
from sparse to dense, and F-Pattern transitions to Bento Grid at the peak via a
BRIDGE element?

3. STATUS
v1

4. BUILT ON
| Dependency | Relationship |
|------------|-------------|
| AD-002-f-pattern.html | F-Pattern axis reference (primary axis) |
| AD-003-bento-grid.html | Bento Grid axis reference (peak section) |
| OD-002-narrative.html | Paired OD exploration (NARRATIVE ARC) |
| CD-CONVENTION-SPEC.md | Convention rules for CD CSS |
| research-package-cd-001.md | Research input (R-5, AD-F, OD-F, DD-F) |

5. MUST HONOR
Soul Pieces #1-#5: border-radius: 0, box-shadow: none, no drop-shadow,
Instrument Serif italic for Essence/Core ONLY, muted earth tones.
ANTI-PHYSICAL identity. 3-category borders only (1px, 3px, 4px).

6. CONSUMED BY
| Consumer | How Used |
|----------|----------|
| CD-SYNTHESIS.md | Cross-CD analysis |
| HANDOFF-CD-TO-MIGRATION.md | Migration stage input |

7. KEY FINDINGS PRODUCED
CD-F-001 through CD-F-004

===============================================================================
RESEARCH APPLICATION RECORD (RAR) -- CD-001 Reasoning Inside Code
===============================================================================

1. EXPLORATION ID: CD-001
2. PATTERN: F-Pattern + Bento Grid (COMPOUND)
3. PAIRED OD: OD-002 Narrative (Freytag arc, CRESCENDO)
4. DENSITY: CRESCENDO (sparse to dense)
5. AXIS TYPE: F-Pattern vertical descent + Bento grid containers at peak
6. FINDING RANGE: CD-F-001 through CD-F-004
7. 3-WAY HYPOTHESIS: F-Pattern provides vertical descent spine. Bento Grid
   containers hold heavy composites at CRESCENDO peak. BRIDGE transition
   (prose paragraph) connects the two axis patterns.
8. R-5 APPLIED: H2 (contrast creates harmony), T2 (velocity mismatch rule),
   N1 (components stack not nest), N2 (composite components pre-composed),
   N3 (re-sequence instead of nesting), N4 (depth limit = 1), G2 (container
   signal), G3 (visual weight balance), A4 (orphaned heavy), S5 (teaching
   moment sequence), Recipe 2 (Deep Dive)
9. AD-F APPLIED: AD-F-004 (3-way unification), AD-F-005 (F-scan CRESCENDO),
   AD-F-008 (proportional equivalence), AD-F-009 (bento contains islands),
   AD-F-023 (ATTENTION TOPOLOGY), AD-F-024 (sequential not simultaneous),
   AD-F-025 (transition grammar: F to Bento = Bridge)
10. ANTI-PATTERNS AVOIDED: Code Wall (A2), Orphaned Heavy (A4), Same-Velocity
    Stacking, 2px Border Epidemic, Traffic Light, Semi-Transparent Backgrounds

=============================================================================== -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CD-001: Reasoning Inside Code</title>

  <!-- Google Fonts: Instrument Serif, Inter, JetBrains Mono -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

  <style>
    /* =======================================================================
       :root -- ALL tokens from CD-CONVENTION-SPEC.md Section 10
       INHERITED FROM: AD-CONV Section 10
       ======================================================================= */
    :root {
      /* Colors -- LOCKED */
      --color-primary: #E83025;
      --color-background: #FEF9F5;
      --color-text: #1A1A1A;
      --color-text-secondary: #666666;
      --color-border: #E0D5C5;
      --color-border-subtle: #F0EBE3;

      /* Zone backgrounds (PULSE / WAVE differentiation) */
      --color-zone-sparse: #FEF9F5;
      --color-zone-dense: #FFFFFF;
      --color-zone-breathing: #FAF5ED;

      /* Typography -- LOCKED */
      --font-display: 'Instrument Serif', Georgia, serif;
      --font-body: 'Inter', system-ui, sans-serif;
      --font-mono: 'JetBrains Mono', 'SF Mono', monospace;

      /* Type Scale -- 5-level cascade (~1.5x ratio) */
      --type-page: 2.5rem;
      --type-section: 1.625rem;
      --type-subsection: 1.375rem;
      --type-body: 1rem;
      --type-code: 0.875rem;
      --type-meta: 0.75rem;

      /* Geometry -- LOCKED */
      --border-radius: 0;
      --box-shadow: none;

      /* Spacing Scale */
      --space-1: 4px;
      --space-2: 8px;
      --space-3: 12px;
      --space-4: 16px;
      --space-5: 20px;
      --space-6: 24px;
      --space-8: 32px;
      --space-10: 40px;
      --space-12: 48px;
      --space-16: 64px;
      --space-20: 80px;

      /* Gestalt Semantic Aliases */
      --space-within: var(--space-2);
      --space-between: var(--space-8);
      --space-chapter: var(--space-16);

      /* Callout Accents -- LOCKED */
      --accent-blue: #4A90D9;
      --accent-green: #4A9D6B;
      --accent-coral: #C97065;
      --accent-amber: #D97706;
      --accent-purple: #7C3AED;

      /* Standardized Border */
      --border-left-width: 4px;

      /* Solid Offset (EXT-CREATIVE-001) */
      --offset-x: 4px;
      --offset-y: 4px;
      --offset-color: #1A1A1A;

      /* Syntax Highlighting (dark background) -- LOCKED */
      --syntax-keyword: #E83025;
      --syntax-string: #6B9B7A;
      --syntax-comment: #666666;
      --syntax-function: #4A7C9B;
      --syntax-type: #C97065;
      --syntax-number: #D97706;
      --syntax-punctuation: #E0D5C5;
    }

    /* =======================================================================
       Reset and Soul Enforcement
       ======================================================================= */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    /* Enforce sharp edges globally -- Soul Piece #1 */
    *:where(:not(input, button, select)) {
      border-radius: 0;
    }

    /* =======================================================================
       Base Typography
       ======================================================================= */
    body {
      font-family: var(--font-body);
      font-size: var(--type-body);
      line-height: 1.7;
      color: var(--color-text);
      background: var(--color-background);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    h1, h2, h3, h4, h5, h6 {
      font-family: var(--font-display);
      line-height: 1.2;
    }

    h1 { font-size: var(--type-page); }
    h2 { font-size: var(--type-section); }
    h3 {
      font-size: var(--type-subsection);
      font-style: italic;
    }

    p {
      max-width: 70ch;
      margin-bottom: var(--space-4);
      overflow-wrap: break-word;
    }

    a {
      color: var(--color-primary);
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }

    /* =======================================================================
       Selection -- Soul Piece branded
       ======================================================================= */
    ::selection {
      background: var(--color-primary);
      color: var(--color-background);
    }

    /* =======================================================================
       Focus -- WCAG compliant
       ======================================================================= */
    *:focus-visible {
      outline: 3px solid var(--color-primary);
      outline-offset: 2px;
    }

    /* =======================================================================
       Skip Link -- Accessibility
       ======================================================================= */
    .skip-link {
      position: absolute;
      top: -100%;
      left: 0;
      background: var(--color-primary);
      color: var(--color-background);
      padding: var(--space-2) var(--space-4);
      z-index: 1000;
      font-family: var(--font-body);
      font-size: 14px;
      text-decoration: none;
    }
    .skip-link:focus {
      top: 0;
    }

    /* =======================================================================
       Header -- Full-bleed dark (C-16, REINFORCED)
       ======================================================================= */
    header {
      background: var(--color-text);
      color: var(--color-background);
      border-bottom: 3px solid var(--color-primary);
    }

    .header-inner {
      max-width: 1100px;
      margin: 0 auto;
      padding: var(--space-16) var(--space-8);
    }

    .meta-line {
      font-family: var(--font-body);
      font-size: var(--type-meta);
      font-weight: 500;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--color-text-secondary);
      margin-bottom: var(--space-2);
      display: flex;
      align-items: center;
      gap: var(--space-4);
      flex-wrap: wrap;
    }

    .version-badge {
      display: inline-block;
      font-family: var(--font-mono);
      font-size: var(--type-meta);
      font-weight: 500;
      letter-spacing: 0.05em;
      padding: 2px 8px;
      border: 1px solid var(--color-text-secondary);
      color: var(--color-text-secondary);
    }

    header h1 {
      font-family: var(--font-display);
      font-size: var(--type-page);
      color: var(--color-background);
      margin-bottom: var(--space-4);
      line-height: 1.15;
    }

    header .subtitle {
      font-family: var(--font-body);
      font-size: var(--type-body);
      font-weight: 400;
      color: var(--color-text-secondary);
      max-width: 70ch;
      line-height: 1.7;
    }

    /* =======================================================================
       Page Container
       ======================================================================= */
    .page-container {
      max-width: 1100px;
      margin: 0 auto;
      padding: var(--space-12) var(--space-6);
    }

    /* =======================================================================
       Content Sections -- CRESCENDO zones
       ======================================================================= */
    .section-zone {
      padding: var(--space-12) var(--space-6);
      max-width: 1100px;
      margin: 0 auto;
      width: 100%;
    }

    /* CRESCENDO spacing: Opening=SPARSE, Rising=MEDIUM, Building=HIGH, Peak=PEAK, Resolution=SPARSE-MEDIUM */
    .section-zone--opening {
      background: var(--color-zone-sparse);
      padding-top: var(--space-16);
      padding-bottom: var(--space-16);
    }

    .section-zone--rising {
      background: var(--color-zone-dense);
      padding-top: var(--space-12);
      padding-bottom: var(--space-12);
    }

    /* CRESCENDO compression: Building section has tighter spacing */
    .section-zone--building {
      background: var(--color-zone-dense);
      padding-top: var(--space-8);
      padding-bottom: var(--space-8);
    }

    /* Peak zone: maximum density */
    .section-zone--peak {
      background: var(--color-zone-dense);
      padding-top: var(--space-6);
      padding-bottom: var(--space-8);
    }

    .section-zone--resolution {
      background: var(--color-zone-sparse);
      padding-top: var(--space-16);
      padding-bottom: var(--space-16);
    }

    /* =======================================================================
       Breathing Zones -- Between CRESCENDO sections
       ======================================================================= */
    .breathing-zone {
      background: var(--color-zone-breathing);
      padding: var(--space-12) var(--space-6);
      border-top: 3px solid var(--color-border);
      border-bottom: 3px solid var(--color-border);
    }

    .breathing-zone__inner {
      max-width: 1100px;
      margin: 0 auto;
    }

    /* Tightening breathing for CRESCENDO compression */
    .breathing-zone--tight {
      padding: var(--space-6) var(--space-6);
    }

    /* Releasing breathing after CRESCENDO peak */
    .breathing-zone--release {
      padding: var(--space-16) var(--space-6);
    }

    /* =======================================================================
       Content Block
       ======================================================================= */
    .content-block {
      margin-bottom: var(--space-between);
    }

    .content-block:last-child {
      margin-bottom: 0;
    }

    /* =======================================================================
       F-Pattern Left-Spine Heading Hierarchy
       AD-F-005: F-scan CRESCENDO mapping
       ======================================================================= */
    .section-zone h2 {
      font-family: var(--font-display);
      font-size: var(--type-section);
      border-left: var(--border-left-width) solid var(--color-primary);
      padding-left: var(--space-4);
      margin-bottom: var(--space-6);
      color: var(--color-text);
    }

    .section-zone h3 {
      font-family: var(--font-display);
      font-size: var(--type-subsection);
      font-style: italic;
      margin-bottom: var(--space-4);
      color: var(--color-text);
    }

    .section-zone h4 {
      font-family: var(--font-body);
      font-size: var(--type-body);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: var(--space-3);
      color: var(--color-text);
    }

    /* =======================================================================
       Code Block Theme -- Dark (OD convention Section 3)
       ======================================================================= */
    pre {
      background: var(--color-text);
      color: var(--color-background);
      border: 3px solid var(--color-border);
      padding: var(--space-6) var(--space-8);
      font-family: var(--font-mono);
      font-size: var(--type-code);
      line-height: 1.5;
      overflow-x: auto;
      margin-bottom: var(--space-8);
    }

    pre code {
      background: none;
      border: none;
      padding: 0;
      font-size: inherit;
    }

    /* Syntax highlighting tokens */
    .kw { color: var(--syntax-keyword); }
    .st { color: var(--syntax-string); }
    .cm { color: var(--syntax-comment); }
    .fn { color: var(--syntax-function); }
    .ty { color: var(--syntax-type); }
    .nu { color: var(--syntax-number); }
    .pu { color: var(--syntax-punctuation); }

    /* Inline code */
    code:not(pre code) {
      font-family: var(--font-mono);
      font-size: 0.9em;
      background: var(--color-border-subtle);
      padding: 2px 6px;
      border: 1px solid var(--color-border);
    }

    /* =======================================================================
       Callout System -- 5 accent variants
       Family DNA: 2-zone (label + body), border-left: 4px solid
       ======================================================================= */
    .callout {
      border-left: var(--border-left-width) solid var(--accent-blue);
      padding: var(--space-6) var(--space-5);
      margin: var(--space-6) 0;
      background: var(--color-zone-sparse);
    }

    .callout__label {
      font-family: var(--font-mono);
      font-size: var(--type-meta);
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      margin-bottom: var(--space-2);
    }

    .callout__body {
      font-family: var(--font-body);
      font-size: var(--type-body);
      line-height: 1.7;
    }

    /* Accent variants */
    .callout--note { border-left-color: var(--accent-blue); }
    .callout--note .callout__label { color: var(--accent-blue); }

    .callout--tip { border-left-color: var(--accent-green); }
    .callout--tip .callout__label { color: var(--accent-green); }

    .callout--gotcha { border-left-color: var(--accent-coral); }
    .callout--gotcha .callout__label { color: var(--accent-coral); }

    .callout--caution { border-left-color: var(--accent-amber); }
    .callout--caution .callout__label { color: var(--accent-amber); }

    .callout--essence {
      border-left-color: var(--accent-purple);
    }
    .callout--essence .callout__label { color: var(--accent-purple); }
    .callout--essence .callout__body {
      font-family: var(--font-display);
      font-style: italic;
    }

    /* =======================================================================
       Reasoning Component
       H2: Contrast Creates Harmony -- dark technical + light deliberative
       Framed component (G2): bordered thought container
       ======================================================================= */
    .reasoning {
      border: 3px solid var(--color-border);
      padding: var(--space-8);
      margin: var(--space-8) 0;
      background: var(--color-zone-sparse);
    }

    .reasoning__header {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      margin-bottom: var(--space-6);
      padding-bottom: var(--space-4);
      border-bottom: 1px solid var(--color-border);
    }

    .reasoning__icon {
      font-family: var(--font-mono);
      font-size: var(--type-meta);
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--accent-amber);
      border: 1px solid var(--accent-amber);
      padding: var(--space-1) var(--space-3);
    }

    .reasoning__title {
      font-family: var(--font-display);
      font-size: var(--type-subsection);
      font-style: italic;
      color: var(--color-text);
    }

    .reasoning__body p {
      margin-bottom: var(--space-4);
    }

    .reasoning__body p:last-child {
      margin-bottom: 0;
    }

    /* =======================================================================
       Core Abstraction Component (N2: Pre-composed composite)
       Essence quote zone + Code proof zone
       ======================================================================= */
    .core-abstraction {
      border: 3px solid var(--color-primary);
      margin: var(--space-8) 0;
      background: var(--color-zone-dense);
    }

    .core-abstraction__essence {
      padding: var(--space-8);
      border-bottom: 3px solid var(--color-primary);
      background: var(--color-zone-sparse);
    }

    .core-abstraction__label {
      font-family: var(--font-mono);
      font-size: var(--type-meta);
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--accent-purple);
      margin-bottom: var(--space-3);
    }

    .core-abstraction__quote {
      font-family: var(--font-display);
      font-style: italic;
      font-size: var(--type-section);
      line-height: 1.4;
      color: var(--color-text);
      max-width: 55ch;
    }

    .core-abstraction__proof {
      padding: 0;
    }

    .core-abstraction__proof pre {
      border: none;
      margin-bottom: 0;
    }

    /* =======================================================================
       CRESCENDO Density Meter
       ======================================================================= */
    .density-meter {
      display: flex;
      gap: var(--space-1);
      margin-bottom: var(--space-6);
    }

    .density-meter__segment {
      height: var(--space-2);
      flex: 1;
      background: var(--color-border-subtle);
      border: 1px solid var(--color-border);
    }

    .density-meter__segment--filled {
      background: var(--color-primary);
      border-color: var(--color-primary);
    }

    .density-meter__label {
      font-family: var(--font-mono);
      font-size: var(--type-meta);
      color: var(--color-text-secondary);
      letter-spacing: 0.05em;
      text-transform: uppercase;
      margin-bottom: var(--space-1);
    }

    .section-indicator {
      font-family: var(--font-mono);
      font-size: var(--type-meta);
      font-weight: 500;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--color-text-secondary);
      margin-bottom: var(--space-4);
      padding-bottom: var(--space-2);
      border-bottom: 1px solid var(--color-border-subtle);
    }

    /* =======================================================================
       Bento Grid -- AD-F-009: Grid cells as islands
       Used at CRESCENDO peak for heavy component containment
       ======================================================================= */
    .bento-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-6);
      margin: var(--space-8) 0;
    }

    .bento-cell {
      border: 3px solid var(--color-border);
      padding: var(--space-6);
      background: var(--color-zone-dense);
    }

    .bento-cell--primary {
      grid-column: 1 / -1;
    }

    .bento-cell__label {
      font-family: var(--font-mono);
      font-size: var(--type-meta);
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--color-text-secondary);
      margin-bottom: var(--space-4);
      padding-bottom: var(--space-2);
      border-bottom: 1px solid var(--color-border-subtle);
    }

    .bento-cell pre {
      margin-bottom: 0;
    }

    /* =======================================================================
       Essence Pullquote -- Bridge transition element
       AD-F-025: F-Pattern to Bento = Bridge
       ======================================================================= */
    .essence-pullquote {
      border-left: var(--border-left-width) solid var(--accent-purple);
      padding: var(--space-8) var(--space-6);
      margin: var(--space-between) 0;
      background: var(--color-zone-sparse);
    }

    .essence-pullquote p {
      font-family: var(--font-display);
      font-style: italic;
      font-size: var(--type-section);
      line-height: 1.4;
      color: var(--color-text);
      max-width: 55ch;
    }

    .essence-pullquote cite {
      display: block;
      font-family: var(--font-mono);
      font-size: var(--type-meta);
      font-style: normal;
      color: var(--color-text-secondary);
      margin-top: var(--space-3);
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    /* =======================================================================
       Lists
       ======================================================================= */
    ul, ol {
      padding-left: var(--space-6);
      margin-bottom: var(--space-4);
    }

    li {
      margin-bottom: var(--space-2);
      max-width: 70ch;
    }

    /* =======================================================================
       Tables
       ======================================================================= */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: var(--space-8);
      display: block;
      overflow-x: auto;
    }

    th {
      font-family: var(--font-body);
      font-size: var(--type-meta);
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      text-align: left;
      padding: var(--space-3) var(--space-4);
      border-bottom: 3px solid var(--color-border);
      color: var(--color-text-secondary);
    }

    td {
      font-family: var(--font-body);
      font-size: var(--type-body);
      padding: var(--space-3) var(--space-4);
      border-bottom: 1px solid var(--color-border-subtle);
      vertical-align: top;
    }

    th, td {
      border-left: none;
      border-right: none;
    }

    /* =======================================================================
       Page Footer -- Visual ending
       ======================================================================= */
    .page-footer {
      background: var(--color-text);
      border-top: 3px solid var(--color-primary);
      padding: var(--space-8) var(--space-6);
    }

    .page-footer__inner {
      max-width: 1100px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .page-footer__id {
      font-family: var(--font-mono);
      font-size: var(--type-meta);
      color: var(--color-text-secondary);
      letter-spacing: 0.1em;
      text-transform: uppercase;
    }

    .page-footer__rule {
      width: 48px;
      height: 3px;
      background: var(--color-primary);
    }

    /* =======================================================================
       Screen Reader Only
       ======================================================================= */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }

    /* =======================================================================
       Reduced Motion -- Prophylactic
       ======================================================================= */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
    }

    /* =======================================================================
       Responsive -- Binary collapse at 768px
       ======================================================================= */
    @media (max-width: 768px) {
      .bento-grid {
        grid-template-columns: 1fr;
      }

      .section-zone {
        padding: var(--space-8) var(--space-4);
      }

      .section-zone--opening,
      .section-zone--resolution {
        padding-top: var(--space-12);
        padding-bottom: var(--space-12);
      }

      header h1 {
        font-size: calc(var(--type-page) * 0.8);
      }

      .header-inner {
        padding: var(--space-12) var(--space-4);
      }

      .breathing-zone {
        padding: var(--space-8) var(--space-4);
      }

      .reasoning {
        padding: var(--space-6);
      }

      .core-abstraction__essence {
        padding: var(--space-6);
      }

      .bento-cell {
        padding: var(--space-4);
      }

      .page-footer__inner {
        flex-direction: column;
        gap: var(--space-4);
        text-align: center;
      }

      .essence-pullquote p {
        font-size: var(--type-subsection);
      }

      .meta-line {
        flex-direction: column;
        align-items: flex-start;
        gap: var(--space-2);
      }
    }

    /* =======================================================================
       Print Styles
       ======================================================================= */
    @media print {
      body {
        background: white;
        color: black;
      }
      .skip-link {
        display: none;
      }
      header {
        background: white;
        color: black;
        border-bottom-color: black;
      }
      header h1,
      header .subtitle {
        color: black;
      }
      pre {
        background: #f5f5f5;
        color: black;
        border-color: #ccc;
      }
    }
  </style>
</head>

<body>
  <!-- Skip Link -- Accessibility -->
  <a href="#main-content" class="skip-link">Skip to content</a>

  <!-- =====================================================================
       HEADER -- Full-bleed dark
       CRESCENDO: SPARSE entry point (Opening)
       F-Pattern: First horizontal scan (broadest content)
       ===================================================================== -->
  <header>
    <div class="header-inner">
      <div class="meta-line">
        <span>EXPLORATION CD-001</span>
        <span>COMBINATION: DEEP DIVE</span>
        <span class="version-badge">v1</span>
      </div>
      <h1>Reasoning Inside Code</h1>
      <p class="subtitle">
        Understanding authentication middleware: how token validation actually works.
        A deep-dive teaching page exploring how reasoning about code can be embedded
        alongside code examples without creating a code-wall anti-pattern --
        demonstrating CRESCENDO density, F-Pattern descent, and Bento Grid containment.
      </p>
    </div>
  </header>

  <!-- Main Content -->
  <main id="main-content">

    <!-- =================================================================
         SECTION 1: OPENING (SPARSE)
         CRESCENDO position: LOW -- orient the reader
         F-Pattern: Full horizontal scan territory
         Components: Info Callout + prose
         ================================================================= -->
    <section aria-label="Opening -- What this page covers" class="section-zone section-zone--opening">

      <div class="section-indicator">Opening -- Context</div>
      <div class="density-meter__label">Density: 1 / 5</div>
      <div class="density-meter" aria-label="Content density: sparse, 1 of 5">
        <div class="density-meter__segment density-meter__segment--filled"></div>
        <div class="density-meter__segment"></div>
        <div class="density-meter__segment"></div>
        <div class="density-meter__segment"></div>
        <div class="density-meter__segment"></div>
      </div>

      <h2>Authentication Middleware from First Principles</h2>

      <div class="content-block">
        <p>
          Every API request that reaches your server carries a claim: "I am
          allowed to do this." Authentication middleware is the mechanism that
          interrogates that claim before the request touches your business logic.
          The middleware sits between the raw HTTP request and your route
          handlers, acting as a gatekeeper that either passes the request through
          or rejects it.
        </p>
        <p>
          This page walks through token validation middleware from basic concepts
          to full implementation. The density of information increases as you
          scroll -- we start with orientation, build through analysis of competing
          approaches, and arrive at a complete, production-ready implementation.
        </p>
      </div>

      <!-- Info Callout -- A6: Context start (not code start) -->
      <!-- DD-F-014: Max 2 callouts per viewport -->
      <aside class="callout callout--note">
        <div class="callout__label">Context</div>
        <div class="callout__body">
          <p>
            This exploration uses authentication middleware as a teaching vehicle.
            The patterns demonstrated -- chain-of-trust validation, layered
            extraction, and fail-fast rejection -- apply to any middleware pipeline,
            not just authentication. The code examples use Node.js with Express,
            but the architectural principles are framework-agnostic.
          </p>
        </div>
      </aside>

    </section>

    <!-- Breathing Zone: Opening to Rising (32px standard) -->
    <div class="breathing-zone">
      <div class="breathing-zone__inner">
        <div class="essence-pullquote">
          <p>
            The middleware does not trust the request. It trusts the process
            of verification.
          </p>
          <cite>Chain-of-trust principle</cite>
        </div>
      </div>
    </div>

    <!-- =================================================================
         SECTION 2: RISING (MEDIUM)
         CRESCENDO position: MEDIUM -- first code contact
         F-Pattern: Second horizontal scan (shorter, filtering)
         Components: Code Snippet (short) + Tip Callout
         Velocity: SLOW (Code) + FAST (Tip) -- T2 honored
         ================================================================= -->
    <section aria-label="Rising -- Basic token check" class="section-zone section-zone--rising">

      <div class="section-indicator">Rising -- First Contact</div>
      <div class="density-meter__label">Density: 2 / 5</div>
      <div class="density-meter" aria-label="Content density: medium, 2 of 5">
        <div class="density-meter__segment density-meter__segment--filled"></div>
        <div class="density-meter__segment density-meter__segment--filled"></div>
        <div class="density-meter__segment"></div>
        <div class="density-meter__segment"></div>
        <div class="density-meter__segment"></div>
      </div>

      <h2>The Simplest Token Check</h2>

      <div class="content-block">
        <p>
          Before analyzing competing approaches, start with the simplest possible
          middleware: extract the token from the <code>Authorization</code> header,
          verify it exists, and pass it forward. This is the skeleton that every
          more complex implementation builds on.
        </p>
      </div>

      <!-- Code Snippet: SHORT (12 lines) -- CRESCENDO rising, not peak -->
      <div class="content-block">
<pre><code><span class="cm">// The simplest auth middleware -- extract and verify existence</span>
<span class="kw">function</span> <span class="fn">authMiddleware</span>(<span class="ty">req</span>, <span class="ty">res</span>, <span class="ty">next</span>) {
  <span class="kw">const</span> authHeader = <span class="ty">req</span>.headers[<span class="st">'authorization'</span>];

  <span class="kw">if</span> (!authHeader || !authHeader.<span class="fn">startsWith</span>(<span class="st">'Bearer '</span>)) {
    <span class="kw">return</span> <span class="ty">res</span>.<span class="fn">status</span>(<span class="nu">401</span>).<span class="fn">json</span>({ <span class="st">error</span>: <span class="st">'Missing or malformed token'</span> });
  }

  <span class="kw">const</span> token = authHeader.<span class="fn">slice</span>(<span class="nu">7</span>);
  <span class="ty">req</span>.token = token;
  <span class="fn">next</span>();
}</code></pre>
      </div>

      <!-- Tip Callout -- T2: FAST after SLOW (velocity buffer) -->
      <!-- G3: 1 heavy + 1 light before next heavy -->
      <aside class="callout callout--tip">
        <div class="callout__label">Tip</div>
        <div class="callout__body">
          <p>
            The <code>.slice(7)</code> call removes the <code>"Bearer "</code>
            prefix (7 characters including the space). This is a common
            pattern but fragile -- it assumes the prefix is always exactly
            <code>"Bearer "</code> with one space. Production code should use a
            regex or explicit split to handle edge cases like extra whitespace.
          </p>
        </div>
      </aside>

      <div class="content-block">
        <p>
          This skeleton works, but it only checks that a token <em>exists</em>.
          It does not verify the token is valid, unexpired, or belongs to a real
          user. The question becomes: how do you layer verification on top of
          extraction?
        </p>
      </div>

    </section>

    <!-- Breathing Zone: Rising to Building (24px -- CRESCENDO compression) -->
    <div class="breathing-zone breathing-zone--tight">
      <div class="breathing-zone__inner">
        <div class="essence-pullquote">
          <p>
            Extraction without verification is an open door with a doorman
            who checks if you have a key -- but never asks if the key fits.
          </p>
          <cite>Authentication middleware reasoning</cite>
        </div>
      </div>
    </div>

    <!-- =================================================================
         SECTION 3: BUILDING (HIGH)
         CRESCENDO position: HIGH -- Reasoning analyzes two approaches
         F-Pattern: Vertical descent beginning (left-spine scanning)
         Components: Reasoning + Code + Code (with Tip between)
         Velocity: SLOW (Reasoning) + FAST (Tip) + SLOW (Code) + FAST (Tip) + SLOW (Code) -- T2 honored
         G2: Framed (Reasoning) needs non-framed (Tip) before next framed
         ================================================================= -->
    <section aria-label="Building -- Analyzing two auth approaches" class="section-zone section-zone--building">

      <div class="section-indicator">Building -- Analysis</div>
      <div class="density-meter__label">Density: 3 / 5</div>
      <div class="density-meter" aria-label="Content density: high, 3 of 5">
        <div class="density-meter__segment density-meter__segment--filled"></div>
        <div class="density-meter__segment density-meter__segment--filled"></div>
        <div class="density-meter__segment density-meter__segment--filled"></div>
        <div class="density-meter__segment"></div>
        <div class="density-meter__segment"></div>
      </div>

      <h2>Session Tokens vs JSON Web Tokens</h2>

      <div class="content-block">
        <p>
          Two dominant approaches exist for token-based authentication: server-side
          session tokens (opaque strings stored in a database) and JSON Web Tokens
          (self-contained signed payloads). Each imposes a fundamentally different
          architecture on your middleware.
        </p>
      </div>

      <!-- Reasoning Component: SLOW -- Analyzing two approaches -->
      <!-- H2: Contrast creates harmony (deliberative analysis + technical code) -->
      <div class="reasoning">
        <div class="reasoning__header">
          <span class="reasoning__icon">Reasoning</span>
          <span class="reasoning__title">Which approach serves the middleware pipeline?</span>
        </div>
        <div class="reasoning__body">
          <p>
            <strong>Session tokens</strong> require a database lookup on every
            request. The middleware extracts the opaque token, queries the session
            store, and either finds a valid session or rejects. This means the
            middleware has a hard dependency on the database -- if the database is
            down, authentication fails for all requests, even if the user's session
            is valid.
          </p>
          <p>
            <strong>JWTs</strong> are self-contained: the token itself carries the
            user's identity and claims, signed by the server. The middleware
            verifies the signature and expiration locally -- no database round-trip.
            But this comes at a cost: a JWT cannot be revoked before expiration
            without maintaining a blocklist, which reintroduces the database
            dependency.
          </p>
          <p>
            The decision hinges on a tradeoff: <strong>latency per request</strong>
            (sessions lose -- database lookup on every call) versus
            <strong>revocation capability</strong> (JWTs lose -- no instant
            invalidation). For middleware design, the question is whether you can
            tolerate the revocation gap.
          </p>
        </div>
      </div>

      <!-- Tip Callout -- T2: FAST after SLOW (Reasoning) before next SLOW (Code) -->
      <!-- G2: Non-framed component between two framed components -->
      <aside class="callout callout--tip">
        <div class="callout__label">Tip</div>
        <div class="callout__body">
          <p>
            In practice, most production systems use a hybrid: JWTs for
            short-lived access tokens (5-15 minutes) and session tokens (stored
            in a database) for long-lived refresh tokens. The middleware validates
            the JWT; the refresh endpoint validates the session. This pattern gives
            you the latency benefit of JWTs with the revocation capability of
            sessions.
          </p>
        </div>
      </aside>

      <div class="content-block">
        <h3>Session-Based Middleware</h3>
        <p>
          The session approach requires a store lookup. Here the middleware queries
          a session store and attaches the user object to the request:
        </p>
      </div>

      <!-- Code Snippet: Session approach (15 lines) -->
      <div class="content-block">
<pre><code><span class="cm">// Session-based auth middleware -- database lookup required</span>
<span class="kw">async function</span> <span class="fn">sessionAuth</span>(<span class="ty">req</span>, <span class="ty">res</span>, <span class="ty">next</span>) {
  <span class="kw">const</span> token = <span class="fn">extractToken</span>(<span class="ty">req</span>);
  <span class="kw">if</span> (!token) {
    <span class="kw">return</span> <span class="ty">res</span>.<span class="fn">status</span>(<span class="nu">401</span>).<span class="fn">json</span>({ <span class="st">error</span>: <span class="st">'No token provided'</span> });
  }

  <span class="kw">const</span> session = <span class="kw">await</span> <span class="ty">sessionStore</span>.<span class="fn">get</span>(token);
  <span class="kw">if</span> (!session || session.expiresAt < <span class="ty">Date</span>.<span class="fn">now</span>()) {
    <span class="kw">return</span> <span class="ty">res</span>.<span class="fn">status</span>(<span class="nu">401</span>).<span class="fn">json</span>({ <span class="st">error</span>: <span class="st">'Invalid or expired session'</span> });
  }

  <span class="ty">req</span>.user = session.user;
  <span class="ty">req</span>.sessionId = token;
  <span class="fn">next</span>();
}</code></pre>
      </div>

      <!-- Tip Callout -- T2: FAST between two SLOW (Code blocks) -->
      <!-- N3: Instead of nesting tip inside code, place it between -->
      <aside class="callout callout--tip">
        <div class="callout__label">Tip</div>
        <div class="callout__body">
          <p>
            Notice the <code>await</code> keyword: session validation is
            inherently asynchronous because it requires I/O. This means every
            request pays the cost of at least one database round-trip. For
            high-throughput APIs, this latency compounds. Consider connection
            pooling and caching strategies to mitigate.
          </p>
        </div>
      </aside>

      <div class="content-block">
        <h3>JWT-Based Middleware</h3>
        <p>
          The JWT approach verifies the signature locally, avoiding the database
          dependency entirely for the validation step:
        </p>
      </div>

      <!-- Code Snippet: JWT approach (18 lines) -->
      <div class="content-block">
<pre><code><span class="cm">// JWT-based auth middleware -- local verification, no DB call</span>
<span class="kw">const</span> jwt = <span class="fn">require</span>(<span class="st">'jsonwebtoken'</span>);

<span class="kw">function</span> <span class="fn">jwtAuth</span>(<span class="ty">req</span>, <span class="ty">res</span>, <span class="ty">next</span>) {
  <span class="kw">const</span> token = <span class="fn">extractToken</span>(<span class="ty">req</span>);
  <span class="kw">if</span> (!token) {
    <span class="kw">return</span> <span class="ty">res</span>.<span class="fn">status</span>(<span class="nu">401</span>).<span class="fn">json</span>({ <span class="st">error</span>: <span class="st">'No token provided'</span> });
  }

  <span class="kw">try</span> {
    <span class="kw">const</span> decoded = jwt.<span class="fn">verify</span>(token, <span class="ty">process</span>.env.<span class="st">JWT_SECRET</span>);
    <span class="ty">req</span>.user = decoded;
    <span class="fn">next</span>();
  } <span class="kw">catch</span> (err) {
    <span class="kw">const</span> message = err.name === <span class="st">'TokenExpiredError'</span>
      ? <span class="st">'Token expired'</span>
      : <span class="st">'Invalid token'</span>;
    <span class="kw">return</span> <span class="ty">res</span>.<span class="fn">status</span>(<span class="nu">401</span>).<span class="fn">json</span>({ <span class="st">error</span>: message });
  }
}</code></pre>
      </div>

    </section>

    <!-- Breathing Zone: Building to Peak (16px -- maximum CRESCENDO compression) -->
    <!-- AD-F-025: F-Pattern to Bento = BRIDGE (needs intermediary element) -->
    <div class="breathing-zone breathing-zone--tight">
      <div class="breathing-zone__inner">
        <div class="essence-pullquote">
          <p>
            Each middleware link validates one claim. The chain holds because
            no single link trusts any other -- each proves its own truth.
          </p>
          <cite>The chain-of-trust principle -- CD-001 core abstraction</cite>
        </div>
      </div>
    </div>

    <!-- =================================================================
         SECTION 4: PEAK (PEAK/DENSE)
         CRESCENDO position: PEAK -- Core Abstraction + full implementation
         F-Pattern to Bento Grid transition: BRIDGE (essence pullquote above)
         Components: Core Abstraction (composite) + Code in Bento cells
         Bento: Contains heavy components in grid cells
         S5: Essence -> Core Abstraction -> Code -> Tip (teaching moment)
         ================================================================= -->
    <section aria-label="Peak -- The chain of trust" class="section-zone section-zone--peak">

      <div class="section-indicator">Peak -- Core Teaching</div>
      <div class="density-meter__label">Density: 5 / 5</div>
      <div class="density-meter" aria-label="Content density: peak, 5 of 5">
        <div class="density-meter__segment density-meter__segment--filled"></div>
        <div class="density-meter__segment density-meter__segment--filled"></div>
        <div class="density-meter__segment density-meter__segment--filled"></div>
        <div class="density-meter__segment density-meter__segment--filled"></div>
        <div class="density-meter__segment density-meter__segment--filled"></div>
      </div>

      <h2>The Chain of Trust</h2>

      <!-- Core Abstraction: N2 pre-composed (Essence + Code proof) -->
      <!-- S5: Teaching Moment Sequence starts here -->
      <div class="core-abstraction">
        <div class="core-abstraction__essence">
          <div class="core-abstraction__label">Core Abstraction</div>
          <p class="core-abstraction__quote">
            Each middleware link validates one claim and one claim only. The chain
            holds not because any single link is unbreakable, but because no link
            trusts any other. Every layer proves its own truth independently.
          </p>
        </div>
        <div class="core-abstraction__proof">
<pre><code><span class="cm">// The chain-of-trust middleware pattern</span>
<span class="cm">// Each function validates ONE claim, then passes to the next</span>

<span class="cm">// Link 1: Extract -- does the token exist?</span>
<span class="kw">function</span> <span class="fn">extractToken</span>(<span class="ty">req</span>, <span class="ty">res</span>, <span class="ty">next</span>) {
  <span class="kw">const</span> header = <span class="ty">req</span>.headers[<span class="st">'authorization'</span>];
  <span class="kw">if</span> (!header?.startsWith(<span class="st">'Bearer '</span>)) {
    <span class="kw">return</span> <span class="ty">res</span>.<span class="fn">status</span>(<span class="nu">401</span>).<span class="fn">json</span>({ <span class="st">error</span>: <span class="st">'Missing token'</span> });
  }
  <span class="ty">req</span>.token = header.<span class="fn">slice</span>(<span class="nu">7</span>);
  <span class="fn">next</span>();
}

<span class="cm">// Link 2: Verify -- is the token structurally valid?</span>
<span class="kw">function</span> <span class="fn">verifyToken</span>(<span class="ty">req</span>, <span class="ty">res</span>, <span class="ty">next</span>) {
  <span class="kw">try</span> {
    <span class="ty">req</span>.claims = jwt.<span class="fn">verify</span>(<span class="ty">req</span>.token, <span class="ty">SECRET</span>);
    <span class="fn">next</span>();
  } <span class="kw">catch</span> {
    <span class="kw">return</span> <span class="ty">res</span>.<span class="fn">status</span>(<span class="nu">401</span>).<span class="fn">json</span>({ <span class="st">error</span>: <span class="st">'Invalid token'</span> });
  }
}

<span class="cm">// Link 3: Authorize -- does the user have permission?</span>
<span class="kw">function</span> <span class="fn">requireRole</span>(...roles) {
  <span class="kw">return</span> (<span class="ty">req</span>, <span class="ty">res</span>, <span class="ty">next</span>) => {
    <span class="kw">if</span> (!roles.<span class="fn">includes</span>(<span class="ty">req</span>.claims.role)) {
      <span class="kw">return</span> <span class="ty">res</span>.<span class="fn">status</span>(<span class="nu">403</span>).<span class="fn">json</span>({ <span class="st">error</span>: <span class="st">'Insufficient permissions'</span> });
    }
    <span class="fn">next</span>();
  };
}

<span class="cm">// Chain: extract -> verify -> authorize -> handler</span>
app.<span class="fn">get</span>(<span class="st">'/admin/users'</span>,
  extractToken,
  verifyToken,
  <span class="fn">requireRole</span>(<span class="st">'admin'</span>),
  adminController.listUsers
);</code></pre>
        </div>
      </div>

      <!-- Tip Callout -- A4: Decompression after heavy Core Abstraction -->
      <!-- S5: Teaching Moment continues (Core Abstraction -> Tip) -->
      <aside class="callout callout--tip">
        <div class="callout__label">Tip</div>
        <div class="callout__body">
          <p>
            The chain-of-trust pattern makes each middleware function independently
            testable. You can unit test <code>extractToken</code> without a valid
            JWT, test <code>verifyToken</code> without a role check, and test
            <code>requireRole</code> with pre-built claims objects. This
            decomposition is not just an architectural convenience -- it is the
            reason chain-of-trust middleware is debuggable in production.
          </p>
        </div>
      </aside>

      <!-- BRIDGE element: Prose paragraph transitions from F-Pattern to Bento -->
      <!-- AD-F-025: F to Bento needs intermediary (prose bridge) -->
      <div class="content-block">
        <h3>Full Implementation in Context</h3>
        <p>
          The chain-of-trust principle scales to production through two additional
          concerns: error handling and token refresh. The bento layout below
          contains the complete implementation, with each cell isolating a
          different responsibility.
        </p>
      </div>

      <!-- Bento Grid: AD-F-009 cells as islands, containing heavy components -->
      <!-- AD-F-024: Sequential not simultaneous -- one pattern per viewport area -->
      <div class="bento-grid">

        <!-- Bento Cell 1: Full-width primary -- Complete middleware chain -->
        <div class="bento-cell bento-cell--primary">
          <div class="bento-cell__label">Complete Middleware Chain</div>
<pre><code><span class="kw">const</span> jwt = <span class="fn">require</span>(<span class="st">'jsonwebtoken'</span>);

<span class="kw">const</span> <span class="ty">AUTH_CONFIG</span> = {
  secret: <span class="ty">process</span>.env.<span class="st">JWT_SECRET</span>,
  issuer: <span class="ty">process</span>.env.<span class="st">JWT_ISSUER</span> || <span class="st">'auth-service'</span>,
  algorithms: [<span class="st">'HS256'</span>],
};

<span class="kw">function</span> <span class="fn">extractToken</span>(<span class="ty">req</span>, <span class="ty">res</span>, <span class="ty">next</span>) {
  <span class="kw">const</span> header = <span class="ty">req</span>.headers[<span class="st">'authorization'</span>];
  <span class="kw">if</span> (!header || !header.<span class="fn">startsWith</span>(<span class="st">'Bearer '</span>)) {
    <span class="kw">return</span> <span class="ty">res</span>.<span class="fn">status</span>(<span class="nu">401</span>).<span class="fn">json</span>({
      <span class="st">error</span>: <span class="st">'MISSING_TOKEN'</span>,
      <span class="st">message</span>: <span class="st">'Authorization header required'</span>,
    });
  }
  <span class="ty">req</span>.token = header.<span class="fn">slice</span>(<span class="nu">7</span>);
  <span class="fn">next</span>();
}

<span class="kw">function</span> <span class="fn">verifyToken</span>(<span class="ty">req</span>, <span class="ty">res</span>, <span class="ty">next</span>) {
  <span class="kw">try</span> {
    <span class="ty">req</span>.claims = jwt.<span class="fn">verify</span>(<span class="ty">req</span>.token, <span class="ty">AUTH_CONFIG</span>.secret, {
      issuer: <span class="ty">AUTH_CONFIG</span>.issuer,
      algorithms: <span class="ty">AUTH_CONFIG</span>.algorithms,
    });
    <span class="fn">next</span>();
  } <span class="kw">catch</span> (err) {
    <span class="kw">const</span> code = err.name === <span class="st">'TokenExpiredError'</span>
      ? <span class="st">'TOKEN_EXPIRED'</span> : <span class="st">'INVALID_TOKEN'</span>;
    <span class="kw">return</span> <span class="ty">res</span>.<span class="fn">status</span>(<span class="nu">401</span>).<span class="fn">json</span>({ <span class="st">error</span>: code });
  }
}</code></pre>
        </div>

        <!-- Bento Cell 2: Role authorization -->
        <div class="bento-cell">
          <div class="bento-cell__label">Role Authorization</div>
<pre><code><span class="kw">function</span> <span class="fn">requireRole</span>(...roles) {
  <span class="kw">return</span> (<span class="ty">req</span>, <span class="ty">res</span>, <span class="ty">next</span>) => {
    <span class="kw">const</span> userRole = <span class="ty">req</span>.claims?.role;
    <span class="kw">if</span> (!userRole) {
      <span class="kw">return</span> <span class="ty">res</span>.<span class="fn">status</span>(<span class="nu">403</span>).<span class="fn">json</span>({
        <span class="st">error</span>: <span class="st">'NO_ROLE'</span>,
      });
    }
    <span class="kw">if</span> (!roles.<span class="fn">includes</span>(userRole)) {
      <span class="kw">return</span> <span class="ty">res</span>.<span class="fn">status</span>(<span class="nu">403</span>).<span class="fn">json</span>({
        <span class="st">error</span>: <span class="st">'FORBIDDEN'</span>,
      });
    }
    <span class="fn">next</span>();
  };
}</code></pre>
        </div>

        <!-- Bento Cell 3: Route composition -->
        <div class="bento-cell">
          <div class="bento-cell__label">Route Composition</div>
<pre><code><span class="cm">// Compose middleware chain</span>
<span class="kw">const</span> <span class="fn">authenticate</span> = [
  extractToken,
  verifyToken,
];

<span class="cm">// Public route: no auth</span>
app.<span class="fn">get</span>(<span class="st">'/health'</span>, healthCheck);

<span class="cm">// Authenticated route</span>
app.<span class="fn">get</span>(<span class="st">'/profile'</span>,
  ...<span class="fn">authenticate</span>,
  profileController.get
);

<span class="cm">// Role-restricted route</span>
app.<span class="fn">get</span>(<span class="st">'/admin/users'</span>,
  ...<span class="fn">authenticate</span>,
  <span class="fn">requireRole</span>(<span class="st">'admin'</span>),
  adminController.list
);</code></pre>
        </div>

      </div>

    </section>

    <!-- Breathing Zone: Peak to Resolution (48px -- CRESCENDO release) -->
    <div class="breathing-zone breathing-zone--release">
      <div class="breathing-zone__inner">
        <div class="essence-pullquote">
          <p>
            A middleware chain is a proof by induction: if each link holds, the
            chain holds. If any link fails, everything after it never executes.
          </p>
          <cite>Chain-of-trust -- CD-001 synthesis</cite>
        </div>
      </div>
    </div>

    <!-- =================================================================
         SECTION 5: RESOLUTION (SPARSE-MEDIUM)
         CRESCENDO position: LOW-MEDIUM -- exhale after peak
         F-Pattern: Return to broader scanning
         Components: Tip Callout (summary) + table
         A7: No anxiety ending -- end with practical guidance
         ================================================================= -->
    <section aria-label="Resolution -- Summary and takeaway" class="section-zone section-zone--resolution">

      <div class="section-indicator">Resolution -- Takeaway</div>
      <div class="density-meter__label">Density: 1 / 5</div>
      <div class="density-meter" aria-label="Content density: sparse, 1 of 5">
        <div class="density-meter__segment density-meter__segment--filled"></div>
        <div class="density-meter__segment"></div>
        <div class="density-meter__segment"></div>
        <div class="density-meter__segment"></div>
        <div class="density-meter__segment"></div>
      </div>

      <h2>What to Carry Forward</h2>

      <div class="content-block">
        <p>
          The chain-of-trust pattern is not specific to authentication. Any
          pipeline that processes a request through sequential validation steps
          benefits from the same decomposition: each step validates one claim,
          rejects early on failure, and enriches the request object for downstream
          consumers.
        </p>
      </div>

      <!-- Tip Callout -- Summary (positive ending, A7 honored) -->
      <aside class="callout callout--tip">
        <div class="callout__label">In Practice</div>
        <div class="callout__body">
          <p>
            When building middleware chains, start with the three-link pattern
            (extract, verify, authorize) and add links only when a new validation
            concern emerges. Each link should be independently testable. If you
            find yourself passing context between links through anything other
            than the request object, the chain abstraction is breaking down.
          </p>
        </div>
      </aside>

      <div class="content-block">
        <h3>Middleware Decision Reference</h3>
        <div style="overflow-x: auto;">
        <table>
          <thead>
            <tr>
              <th>Concern</th>
              <th>Session Tokens</th>
              <th>JWTs</th>
              <th>Hybrid</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Latency per request</td>
              <td>Database round-trip</td>
              <td>Local verification</td>
              <td>Local (access) + DB (refresh)</td>
            </tr>
            <tr>
              <td>Revocation</td>
              <td>Immediate (delete session)</td>
              <td>Delayed (wait for expiry)</td>
              <td>Near-immediate (short-lived access)</td>
            </tr>
            <tr>
              <td>Scaling</td>
              <td>Bound to session store</td>
              <td>Stateless -- scales freely</td>
              <td>Stateless access, stateful refresh</td>
            </tr>
            <tr>
              <td>Complexity</td>
              <td>Simple</td>
              <td>Moderate</td>
              <td>Higher (two token types)</td>
            </tr>
          </tbody>
        </table>
        </div>
      </div>

      <!-- Final Essence -- Capstone -->
      <aside class="callout callout--essence">
        <div class="callout__label">Essence</div>
        <div class="callout__body">
          <p>
            Middleware that reasons about trust does not trust its reasoning.
            It trusts only the chain -- and the chain holds because each
            link holds independently.
          </p>
        </div>
      </aside>

    </section>

  </main>

  <!-- Page Footer -- Visual ending (C-02, C-04) -->
  <footer class="page-footer">
    <div class="page-footer__inner">
      <span class="page-footer__id">CD-001 -- Reasoning Inside Code</span>
      <div class="page-footer__rule"></div>
      <span class="page-footer__id">Exploration Complete</span>
    </div>
  </footer>

</body>
</html>

<!-- =====================================================================
     CD FINDINGS -- CD-001 Reasoning Inside Code
     ===================================================================== -->

<!-- CD-F-001: CRESCENDO Velocity Interleaving
Finding: A page with 3 heavy component types (Code Snippet, Reasoning, Core
Abstraction) can honor the velocity rule (T2) by systematically interleaving
FAST callouts (Tip, Info) between every pair of SLOW components. The pattern
is: SLOW + FAST + SLOW + FAST + SLOW, creating a rhythm where the reader
never encounters two consecutive heavy components without a decompression
buffer.
Evidence: Section 3 (Building) places Tip callouts between Reasoning and
Code Snippet, and between the two Code Snippets. Section 4 (Peak) places a
Tip callout immediately after the Core Abstraction before the Bento grid.
Chain Impact: Establishes a reusable velocity interleaving pattern for any
page with 3+ heavy component types. Migration can apply this pattern to
existing deep-dive documentation pages.
-->

<!-- CD-F-002: F-Pattern to Bento Bridge Transition
Finding: The F-Pattern vertical descent spine transitions cleanly to a Bento
Grid layout when a BRIDGE element (prose paragraph or essence pullquote) is
placed between them. Without the bridge, the switch from single-column
F-descent to multi-cell grid is jarring. The bridge serves as a cognitive
handoff point where the reader shifts from vertical scanning to spatial
exploration.
Evidence: Between Section 3 (F-Pattern) and Section 4 (Bento Grid), an
essence pullquote breathing zone acts as the bridge. Within Section 4, a
prose paragraph ("The chain-of-trust principle scales to production...")
introduces the bento grid explicitly before it appears.
Chain Impact: Validates AD-F-025 transition grammar (F to Bento = Bridge)
in a real composite page. Migration pages combining F-Pattern and Bento
Grid sections MUST include a bridge element at the transition boundary.
-->

<!-- CD-F-003: Core Abstraction Contains the CRESCENDO Peak
Finding: The Core Abstraction component (N2: pre-composed Essence + Code
proof) is the natural vessel for a CRESCENDO peak. Its two-zone structure
(serif quote in sparse zone + code in dense zone) creates a micro-CRESCENDO
within the macro-CRESCENDO of the page. The component itself embodies the
density transition, making it the ideal climax container.
Evidence: Section 4 (Peak) uses Core Abstraction as the first heavy component,
with its essence zone providing the teaching principle and its code zone
providing the proof. The density meter reads 5/5 and the component's internal
structure mirrors the page's density arc.
Chain Impact: Establishes Core Abstraction as the preferred climax component
for CRESCENDO pages. When a page needs a "peak teaching moment," use Core
Abstraction -- do not construct ad-hoc Essence + Code pairs (N2 anti-pattern).
-->

<!-- CD-F-004: Bento Grid as Heavy-Component Containment
Finding: Bento Grid cells serve as containment vessels for heavy components
at CRESCENDO peak density. By placing Code Snippets in individual grid cells
(each with its own label and boundary), the page prevents the "code wall"
anti-pattern (A2) even when presenting 3 code blocks in proximity. The grid
structure provides visual breathing between heavy components through cell
borders and gaps, without requiring interleaved light components.
Evidence: Section 4 uses a 3-cell bento grid (1 full-width primary + 2
half-width secondary). Each cell contains a complete code block but the grid
gaps and cell borders provide structural separation. The total code across
all 3 cells exceeds 40 lines, but no single cell exceeds 35 lines.
Chain Impact: Validates AD-F-009 (bento cells as islands) for code-heavy
pages. Migration can use bento grids to present multiple related code blocks
without triggering the code wall anti-pattern. Grid gaps serve as implicit
breathing zones.
-->
