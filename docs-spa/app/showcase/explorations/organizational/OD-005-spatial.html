<!-- ═══════════════════════════════════════════════════════════════════════
     OD-005: Spatial/Hub-Spoke Structure
     Organizational Exploration — Map-Based Documentation Navigation

     Hypothesis: "What if documentation was organized spatially — as a
     hub-and-spoke map where users navigate between territory zones —
     rather than linearly?"
     Density Pairing: WAVE (primary) + ISLANDS (secondary)
     DD Sources: DD-003 (ISLANDS), DD-006 (FRACTAL — mandatory DD-F-006)
     Research: R1-001, R1-003, R1-007, R1-008, R1-016, R1-018, R1-019

     Applied Research:
       R1-001 (Density Rhythm) — Hub=sparse overview, Spoke=dense detail, WAVE
       R1-003 (Viewport Principle) — Hub is one viewport, each spoke is scrollable
       R1-007 (Callout Positioning) — Callouts follow content they reference
       R1-008 (Callout Scarcity) — Max 2 callouts per spoke section
       R1-016 (Typography-First Hierarchy) — Size > Weight > Color
       R1-018 (Pull Quotes) — Essence pullquote at spoke transitions
       R1-019 (Tech Spec Aesthetic) — Sharp edges, mono accents
       R3-006 (WAVE) — Hub(sparse) → Spoke(dense) → Hub(sparse return) oscillation
       R3-047 (ISLANDS/Density Contrast) — Each spoke is a self-contained content island
       R3-036 / DD-F-006 (FRACTAL) — Self-similar at 4 scales

     External Research Applied:
       EXT-SPAT-001 (Hub-and-Spoke ISLANDS) — Square tiles in CSS Grid
       EXT-SPAT-002 (Breadcrumbs as WAVE Trigger) — Triangle separators (▸)
       EXT-SPAT-003 (7-Column Magazine Grid) — Content + sidebar layout
       EXT-SPAT-004 (Named Grid Areas) — Semantic zones
       EXT-SPAT-005 (Cartographic Hierarchy) — Figure-ground, type hierarchy
       EXT-SPAT-008 (Screen Reader Accessibility) — Skip links, ARIA landmarks
       EXT-SPAT-009 (Alternation for Rhythm) — Content block → gap → Content block
       EXT-SPAT-010 (Islands Architecture) — 95% static, 5% interactive
       EXT-SPAT-011 (Natural Reading Rhythms) — 40-60 word paragraphs
       EXT-SPAT-012 (ECS Modular Entities) — Each spoke = modular entity

     Anti-Patterns Avoided:
       DD-F-015 Traffic-light — no green+red adjacent
       DD-F-016 — no decorative borders without function
       DD-F-017 — no visual noise
       DD-F-018 — no false hierarchy
       R5-A1 Callout Cacophony — max 2 callouts per section
       R5-A5 Temperature Whiplash — gradual temperature transitions

     DD-F-006 Fractal Compliance:
       PAGE SCALE: Hub(sparse) → Spoke(dense) → Hub(sparse return) WAVE oscillation
       SECTION SCALE: Within each spoke, intro(sparse) → content(dense) → exit(sparse)
       COMPONENT SCALE: Territory card label(sparse) → expanded content(dense)
       CHARACTER SCALE: Code comments(sparse) → code logic(dense)
     ═══════════════════════════════════════════════════════════════════════ -->

<!-- ═══════════════════════════════════════════════════════════════════════
     INLINE THREADING HEADER — OD Execution Phase
     File: docs-spa/app/showcase/explorations/organizational/OD-005-spatial.html
     Tier: B | Stage: 3 (Organization OD) | Generated: 2026-02-07
     ═══════════════════════════════════════════════════════════════════════

1. WHY THIS EXISTS
OD-005-spatial.html is the fifth organizational exploration, testing the
hypothesis that hub-and-spoke spatial organization creates natural WAVE
density oscillation: users depart from a sparse hub map into dense spoke
content, then return to the sparse hub. Each spoke is a self-contained
ISLAND (DD-003). The WAVE pattern (R3-006) is primary; ISLANDS (R3-047)
is secondary. Content topic: React Component Architecture across 6
territory zones.

2. THE QUESTION THIS ANSWERS
"Can a spatial hub-and-spoke structure create natural WAVE density rhythm
(sparse hub → dense spoke → sparse return) while maintaining DD-F-006
fractal self-similarity at all four structural scales?"

3. STATUS
ACTIVE — INCLUDE (v3 re-enriched, Wave 5 audit PASS). 35/40. Soul compliance 100%.
Wave 5: Core soul 9/10 PASS. OD-AP-003 FAIL (5 rgba callout bgs). Standards 17/17 (best).
v3: 6 EXT-SPAT findings (013-018) applied. 6 builder discoveries, 260 lines changed.
HIGH spirit violation RESOLVED (hover transform → border-color assertion).
Soul checklist: 10/10 PASS. Research application rate: 6/6 (100%).

4. SOUL ALIGNMENT
  Soul Piece                     | Implementation                      | Evidence
  -------------------------------|-------------------------------------|--------
  1. Sharp Edges                 | --border-radius: 0 in :root        | Line ~130
  2. No Shadows                  | --box-shadow: none; solid offset    | Lines ~131, hub tiles
  3. Serif = Wisdom              | Instrument Serif for titles,        | Throughout
                                 | territory names, breadcrumbs        |
  4. Callout Family DNA          | 5 callout types, 2-zone (label+body)| CSS callout section
                                 | 4px left border, 5 color variants  |
  5. Squares Signal System       | Square territory markers, no radius | .territory-tile

5. BUILT ON
  Source                          | Role                              | Key Values Taken                                  | Path
  --------------------------------|-----------------------------------|---------------------------------------------------|-----
  DD-003-islands.html             | ISLANDS density pattern            | Self-contained content blocks, isolation gaps      | explorations/density/DD-003-islands.html
  DD-006-fractal.html             | DD-F-006 fractal (mandatory)       | 4-scale self-similarity constraint                 | explorations/density/DD-006-fractal.html
  DD-001-breathing.html           | WAVE reference                     | Oscillating dense/sparse breathing rhythm          | explorations/density/DD-001-breathing.html
  OD-001-conversational.html      | OD series patterns                 | Callout system, code block system, header format   | explorations/organizational/OD-001-conversational.html
  OD-002-narrative.html           | Spoke content structure            | Narrative beat layout, act headers                 | explorations/organizational/OD-002-narrative.html
  MASTER-SOUL-SYNTHESIS.md        | Soul authority (T1 LOCKED)         | 5 soul pieces, 6 Universal Rules                   | perceptual-audit-v2/synthesis/MASTER-SOUL-SYNTHESIS.md
  DESIGN-TOKEN-SUMMARY.md         | Locked token source (T1 LOCKED)    | Complete :root block (colors, fonts, geometry)     | perceptual-audit-v2/synthesis/DESIGN-TOKEN-SUMMARY.md

6. MUST HONOR
  Constraint                      | Source                              | Consequence if Violated
  --------------------------------|-------------------------------------|-------------------------------------
  DD-F-006 fractal at 4 scales    | DD-006-fractal.html                 | Exploration INVALID
  WAVE oscillation (hub/spoke)    | R3-006 + DD-001-breathing.html      | Core hypothesis fails
  ISLANDS isolation               | R3-047 + DD-003-islands.html        | Spokes bleed into each other
  border-radius: 0 everywhere     | DESIGN-TOKEN-SUMMARY.md             | Soul violation
  box-shadow: none everywhere     | DESIGN-TOKEN-SUMMARY.md             | Soul violation
  Max 2 callouts per section      | R5-T4                               | Callout cacophony anti-pattern

7. WHAT BREAKS IF THIS CHANGES
BLAST RADIUS: LOW-MEDIUM (fifth OD artifact)
  - OD-CHECKPOINT.md (OD-005 state row)
  - RESEARCH-ACTIVE.md (findings marked APPLIED via this file)
  - Future OD-006 (may reference OD-005 lessons)
  - organizational-patterns.md (will catalog SPATIAL pattern)

8. CONSUMED BY
  Consumer                                                        | How It Uses This File
  ----------------------------------------------------------------|-------------------------------------
  OD-CHECKPOINT.md                                                 | Tracks OD-005 status, score
  RESEARCH-ACTIVE.md                                               | Findings marked APPLIED
  (Future) organizational-patterns.md                              | Will extract SPATIAL pattern definition
  (Future) OD-SYNTHESIS.md                                         | Will synthesize across all OD explorations
  builder-2b                                                       | v3 re-enrichment (Wave 2)
  scribe-2                                                         | Provenance chain update (Wave 2)

9. RESEARCH DEBT
  RD-1: No quantitative WAVE measurement (sparse ratio vs dense ratio)
  RD-2: Breadcrumb accessibility needs screen reader testing
  RD-3: CSS Grid named areas not supported in all browsers (fallback needed)
  RD-4: Scroll-driven animations are Chromium-only (fallback provided)

10. DIAGNOSTIC QUESTIONS
  Q1: Does the :root block match DESIGN-TOKEN-SUMMARY.md exactly?
  Q2: Are all 4 fractal scales demonstrated?
  Q3: Do all callouts follow content (R1-007)?
  Q4: Is the 2-callout-per-section limit honored?
  Q5: Does the hub show sparse overview before dense spoke content?
  Q6: Does each spoke create a density WAVE (sparse intro → dense body → sparse exit)?
  Q7: Are spokes visually isolated as ISLANDS?
  Q8: Do breadcrumbs use triangle separators (EXT-SPAT-002)?

     ═══════════════════════════════════════════════════════════════════════
     END INLINE THREADING HEADER
     ═══════════════════════════════════════════════════════════════════════ -->

<!-- Score Iteration 1: Innovation: 7 / Utility: 8 / Soul: 8 / Execution: 8 = 31/40 (convention spec + spirit fix) -->
<!-- Score Iteration 2: Innovation: 8 / Utility: 9 / Soul: 9 / Execution: 9 = 35/40 (WAVE indicator + comprehensive a11y + enhanced reduced-motion) -->
<!-- Applied EXT-SPAT-013: Flat hover via border-color assertion (replaces transform-translate spirit violation) -->
<!-- Applied EXT-SPAT-014: CSS Spatial Navigation with grid role + arrow-key handler -->
<!-- Applied EXT-SPAT-015: Three-Level Gestalt spacing (8px/32px/64px) for breathable WAVE islands -->
<!-- Applied EXT-SPAT-016: Zone token renaming (hub-bg -> zone-sparse, spoke-bg -> zone-dense, transition-bg -> zone-breathing) -->
<!-- Applied EXT-SPAT-017: Dark header as spatial landmark anchor (#1A1A1A bg) -->
<!-- Applied EXT-SPAT-018: WAVE density indicator (scroll-driven zone markers, fixed sidebar) -->
<!-- Applied OD-F-005: Spatial Mapping IS WAVE + ISLANDS identity made explicit via zone tokens + header metadata -->
<!-- Applied OD-F-AP-001: Eliminated ALL Category 1 borders < 3px (2px -> 3px structural, 2px -> 1px separator) -->
<!-- Applied OD-F-007: 48px+ spacing between mode transitions (spoke-divider margin: 80px) -->
<!-- Applied R1-028: WAI-ARIA grid/gridcell roles on territory grid + keyboard navigation -->
<!-- Fixes: territory-tile hover transform REMOVED (spirit violation), solid offset opacity: 1 enforced -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OD-005: Spatial/Hub-Spoke Structure</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' fill='%23E83025'/><text x='50%25' y='50%25' dominant-baseline='central' text-anchor='middle' fill='white' font-family='serif' font-size='20'>K</text></svg>">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

  <style>
    /* ═══════════════════════════════════════════════════════════════════════════
       LOCKED DESIGN TOKENS — From DESIGN-TOKEN-SUMMARY.md
       DD-006 Lessons: Fractal self-similarity at all scales
       DD-003 Lessons: Content islands with isolation gaps
       OD-005 Specific: WAVE oscillation via hub-spoke spatial navigation
       ═══════════════════════════════════════════════════════════════════════════ */
    :root {
      /* Colors */
      --color-primary: #E83025;
      --color-background: #FEF9F5;
      --color-text: #1A1A1A;
      --color-text-secondary: #666666;
      --color-border: #E0D5C5;
      --color-border-subtle: #F0EBE3;

      /* Zone backgrounds (PULSE / WAVE differentiation) — EXT-SPAT-016 */
      --color-zone-sparse: #FEF9F5;   /* questions, hubs, sparse zones */
      --color-zone-dense: #FFFFFF;    /* answers, spokes, dense zones */
      --color-zone-breathing: #FAF5ED;/* chapter dividers, mode transitions */

      /* Typography — EXT-CREATIVE-002 Typographic Cascade */
      --font-display: 'Instrument Serif', Georgia, serif;
      --font-body: 'Inter', system-ui, sans-serif;
      --font-mono: 'JetBrains Mono', 'SF Mono', monospace;

      /* Type Scale — 5-level cascade (~1.5x ratio) per OD-CONVENTION-SPEC */
      --type-page: 2.5rem;         /* 40px */
      --type-section: 1.625rem;    /* 26px */
      --type-subsection: 1.375rem; /* 22px */
      --type-body: 1rem;           /* 16px */
      --type-code: 0.875rem;       /* 14px */
      --type-meta: 0.75rem;        /* 12px */

      /* Geometry — LOCKED */
      --border-radius: 0;
      --box-shadow: none;

      /* Spacing — Three-Level Gestalt (EXT-CONV-003 + EXT-DENSITY-001) */
      --space-within: 8px;
      --space-between: 32px;
      --space-chapter: 64px;

      /* Legacy spacing (compatibility) */
      --space-1: 4px;
      --space-2: 8px;
      --space-3: 12px;
      --space-4: 16px;
      --space-5: 20px;
      --space-6: 24px;
      --space-8: 32px;
      --space-10: 40px;
      --space-12: 48px;
      --space-16: 64px;
      --space-20: 80px;

      /* Gestalt Semantic Aliases (EXT-CONV-003 + EXT-SPAT-015) */
      --space-within: var(--space-2);    /* 8px */
      --space-between: var(--space-8);   /* 32px */
      --space-chapter: var(--space-16);  /* 64px */

      /* Callout Accents */
      --accent-blue: #4A90D9;
      --accent-green: #4A9D6B;
      --accent-coral: #C97065;
      --accent-amber: #D97706;
      --accent-purple: #7C3AED;

      /* Standardized Border */
      --border-left-width: 4px;

      /* Solid Offset (EXT-CREATIVE-001) — depth without box-shadow */
      --offset-x: 4px;
      --offset-y: 4px;
      --offset-color: #1A1A1A;
    }

    ::selection {
      background: var(--color-primary);
      color: var(--color-background);
    }

    *:focus-visible {
      outline: 3px solid var(--color-primary);
      outline-offset: 2px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-body);
      background: var(--color-background);
      color: var(--color-text);
      line-height: 1.7;
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       SCROLL-TRIGGERED REVEAL — EXT-CREATIVE-004
       CSS scroll-driven animations (Chromium), static fallback elsewhere
       ═══════════════════════════════════════════════════════════════════════════ */
    @keyframes arrive {
      from {
        opacity: 0;
        transform: translateY(16px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .reveal {
      animation: arrive 0.5s ease-out both;
      animation-timeline: view();
      animation-range: entry 10% entry 40%;
    }

    .reveal-delay-1 {
      animation: arrive 0.5s ease-out both;
      animation-timeline: view();
      animation-range: entry 15% entry 45%;
    }

    .reveal-delay-2 {
      animation: arrive 0.5s ease-out both;
      animation-timeline: view();
      animation-range: entry 20% entry 50%;
    }

    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
      .reveal, .reveal-delay-1, .reveal-delay-2 {
        opacity: 1;
        transform: none;
      }
    }

    @supports not (animation-timeline: view()) {
      .reveal, .reveal-delay-1, .reveal-delay-2 {
        opacity: 1;
        transform: none;
      }
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       SKIP LINK — EXT-SPAT-008 Screen Reader Accessibility
       ═══════════════════════════════════════════════════════════════════════════ */
    .skip-link {
      position: absolute;
      top: -100%;
      left: 0;
      background: var(--color-primary);
      color: var(--color-background);
      padding: 8px 16px;
      z-index: 1000;
      font-family: var(--font-body);
      font-size: 14px;
      text-decoration: none;
      border: none;
    }

    .skip-link:focus {
      top: 0;
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       EXPLORATION HEADER — Dark background (EXT-SPAT-017 Spatial Landmark)
       R1-019 (Tech Spec Aesthetic): monospace ID, sharp edges
       Full-bleed header with inner wrapper matching page width
       OD-CONVENTION-SPEC Section 4: Full-bleed dark header
       ═══════════════════════════════════════════════════════════════════════════ */
    .exploration-header {
      border-bottom: 3px solid var(--color-primary);
      padding: var(--space-16) var(--space-8);
      background: var(--color-text); /* EXT-SPAT-017: Dark header as spatial landmark */
      color: #FAFAF5;
      margin-bottom: var(--space-chapter);
    }

    .exploration-header__inner {
      max-width: 860px;
      margin: 0 auto;
      padding: 0 var(--space-6);
    }

    .exploration-id {
      font-family: var(--font-mono);
      font-size: var(--type-meta);
      font-weight: 500;
      color: var(--color-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.15em;
      margin-bottom: var(--space-2);
    }

    .exploration-title {
      font-family: var(--font-display);
      font-size: var(--type-page);
      font-style: italic;
      color: #FAFAF5;
      margin-bottom: var(--space-4);
      line-height: 1.15;
    }

    .exploration-hypothesis {
      font-size: var(--type-body);
      color: var(--color-text-secondary);
      max-width: 70ch;
      line-height: 1.6;
    }

    .exploration-meta {
      display: flex;
      gap: var(--space-6);
      margin-top: var(--space-4);
      font-family: var(--font-mono);
      font-size: var(--type-meta);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--color-text-secondary);
      flex-wrap: wrap;
    }

    .exploration-meta span {
      display: flex;
      align-items: center;
      gap: var(--space-1);
    }

    .exploration-meta__value {
      color: var(--color-primary);
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       PAGE CONTAINER — 860px per convention spec
       ═══════════════════════════════════════════════════════════════════════════ */
    .page-container {
      max-width: 860px;
      margin: 0 auto;
      padding: 0 var(--space-6);
      padding-bottom: var(--space-20);
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       WAVE VISUALIZATION — Density diagram showing hub-spoke oscillation
       DD-005 lesson: visualization at top explains the concept
       ═══════════════════════════════════════════════════════════════════════════ */
    .wave-visualization {
      margin: var(--space-8) 0;
      padding: var(--space-6);
      background: white;
      border-left: var(--border-left-width) solid var(--color-primary);
    }

    .wave-visualization__title {
      font-family: var(--font-mono);
      font-size: var(--type-meta);
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--color-text-secondary);
      margin-bottom: var(--space-5);
    }

    .wave-diagram {
      display: flex;
      align-items: flex-end;
      gap: 3px;
      height: 100px;
      padding-bottom: var(--space-4);
      border-bottom: 3px solid var(--color-border); /* Cat 1: structural */
    }

    .wave-bar {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      height: 100%;
    }

    .wave-bar__fill {
      width: 100%;
    }

    /* WAVE pattern: sparse → dense → sparse → dense → sparse... */
    .wave-bar--hub   .wave-bar__fill { height: 18px; background: var(--color-border); }
    .wave-bar--s1    .wave-bar__fill { height: 85px; background: var(--color-primary); }
    .wave-bar--gap1  .wave-bar__fill { height: 12px; background: var(--color-border-subtle); }
    .wave-bar--s2    .wave-bar__fill { height: 78px; background: var(--color-text-secondary); }
    .wave-bar--gap2  .wave-bar__fill { height: 12px; background: var(--color-border-subtle); }
    .wave-bar--s3    .wave-bar__fill { height: 82px; background: var(--color-text-secondary); }
    .wave-bar--gap3  .wave-bar__fill { height: 12px; background: var(--color-border-subtle); }
    .wave-bar--s4    .wave-bar__fill { height: 72px; background: var(--color-text-secondary); }
    .wave-bar--gap4  .wave-bar__fill { height: 12px; background: var(--color-border-subtle); }
    .wave-bar--s5    .wave-bar__fill { height: 76px; background: var(--color-text-secondary); }
    .wave-bar--gap5  .wave-bar__fill { height: 12px; background: var(--color-border-subtle); }
    .wave-bar--s6    .wave-bar__fill { height: 70px; background: var(--color-text-secondary); }
    .wave-bar--end   .wave-bar__fill { height: 18px; background: var(--color-border); }

    .wave-labels {
      display: flex;
      justify-content: space-between;
      margin-top: var(--space-3);
      font-family: var(--font-mono);
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--color-text-secondary);
    }

    .wave-annotation {
      margin-top: var(--space-4);
      padding-top: var(--space-3);
      border-top: 1px solid var(--color-border-subtle);
      font-size: 12px;
      color: var(--color-text-secondary);
    }

    .wave-annotation code {
      font-family: var(--font-mono);
      font-size: 11px;
      background: var(--color-border-subtle);
      padding: 1px 4px;
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       HUB — TERRITORY MAP (SPARSE ZONE)
       EXT-SPAT-001: Square tiles in CSS Grid, generous gaps
       EXT-SPAT-005: Cartographic hierarchy, figure-ground separation
       DD-F-006 PAGE SCALE: Hub = sparse overview
       ═══════════════════════════════════════════════════════════════════════════ */
    .hub {
      margin: var(--space-12) 0 var(--space-20) 0;
    }

    .hub__heading {
      font-family: var(--font-display);
      font-size: var(--type-section);
      font-style: italic;
      margin-bottom: var(--space-3);
    }

    .hub__subtitle {
      font-size: 14px;
      color: var(--color-text-secondary);
      margin-bottom: var(--space-8);
      max-width: 55ch;
    }

    .territory-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--space-6);
    }

    .territory-tile {
      border: 3px solid var(--color-text);
      padding: var(--space-5);
      background: white;
      text-decoration: none;
      color: inherit;
      display: block;
      position: relative;
      /* EXT-SPAT-013: Flat hover via border-color + background assertion */
      transition: border-color 0.15s, background-color 0.15s;
    }

    .territory-tile:hover {
      border-color: var(--color-primary);
      background-color: var(--color-border-subtle);
    }

    /* EXT-CREATIVE-001: Solid offset depth — static, no animation */
    .territory-tile::after {
      content: '';
      position: absolute;
      top: var(--offset-y);
      left: var(--offset-x);
      width: 100%;
      height: 100%;
      border: 3px solid var(--offset-color);
      z-index: -1;
      pointer-events: none;
      opacity: 1; /* identity-delta-wave1: fully opaque, no float illusion */
    }

    .territory-tile__marker {
      width: 8px;
      height: 8px;
      background: var(--color-primary);
      margin-bottom: var(--space-3);
      /* Soul Piece 5: Squares Signal System — no border-radius */
    }

    .territory-tile__name {
      font-family: var(--font-display);
      font-size: 20px;
      font-style: italic;
      margin-bottom: var(--space-2);
      line-height: 1.2;
    }

    .territory-tile__description {
      font-size: 13px;
      color: var(--color-text-secondary);
      line-height: 1.5;
      margin-bottom: var(--space-3);
    }

    .territory-tile__badge {
      font-family: var(--font-mono);
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--color-primary);
      border: 1px solid var(--color-primary);
      padding: 2px 8px;
      display: inline-block;
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       SPOKE SECTIONS — Dense content zones (ISLANDS)
       EXT-SPAT-003: Content + sidebar layout (3fr 1fr)
       EXT-SPAT-004: Named grid areas (doctrine, examples, references)
       EXT-SPAT-012: Each spoke = modular entity
       DD-F-006 SECTION SCALE: intro(sparse) → content(dense) → exit(sparse)
       ═══════════════════════════════════════════════════════════════════════════ */
    .spoke {
      padding: var(--space-12) 0;
      scroll-margin-top: var(--space-4);
    }

    /* 80px+ island isolation between spokes (EXT-SPAT-009) */
    .spoke-divider {
      height: 1px; /* Cat 2: data separator */
      background: var(--color-border);
      margin: var(--space-20) 0;
    }

    /* Breadcrumbs — EXT-SPAT-002: Triangle separators, current in Serif */
    .breadcrumb {
      font-family: var(--font-mono);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--color-text-secondary);
      margin-bottom: var(--space-4);
    }

    .breadcrumb a {
      color: var(--color-text-secondary);
      text-decoration: none;
    }

    .breadcrumb a:hover {
      color: var(--color-primary);
    }

    .breadcrumb__separator {
      margin: 0 var(--space-2);
      color: var(--color-border);
    }

    .breadcrumb__current {
      font-family: var(--font-display);
      font-style: italic;
      font-size: 13px;
      text-transform: none;
      letter-spacing: 0;
      color: var(--color-text);
    }

    /* Spoke header — territory name, large serif */
    .spoke__heading {
      font-family: var(--font-display);
      font-size: var(--type-section);
      font-style: italic;
      margin-bottom: var(--space-3);
      padding-bottom: var(--space-3);
      border-bottom: 3px solid var(--color-primary);
      line-height: 1.2;
    }

    .spoke__intro {
      font-size: 15px;
      color: var(--color-text-secondary);
      max-width: 60ch;
      margin-bottom: var(--space-8);
      line-height: 1.7;
    }

    /* Spoke content grid — EXT-SPAT-003: Content (3fr) + Sidebar (1fr) */
    .spoke-grid {
      display: grid;
      grid-template-columns: 3fr 1fr;
      grid-template-areas:
        "doctrine references";
      gap: var(--space-8);
    }

    .spoke-content {
      grid-area: doctrine;
    }

    .spoke-sidebar {
      grid-area: references;
    }

    @media (max-width: 768px) {
      .spoke-grid {
        grid-template-columns: 1fr;
        grid-template-areas:
          "doctrine"
          "references";
      }
    }

    /* Content sections within spokes */
    .spoke-section {
      margin-bottom: var(--space-8);
    }

    .spoke-section__heading {
      font-family: var(--font-display);
      font-size: var(--type-subsection);
      font-style: italic;
      margin-bottom: var(--space-3);
    }

    .spoke-section p {
      max-width: 65ch;
      margin-bottom: var(--space-4);
      font-size: 15px;
      line-height: 1.7;
    }

    /* Sidebar reference panel */
    .sidebar-panel {
      border-left: var(--border-left-width) solid var(--color-border);
      padding-left: var(--space-4);
      position: sticky;
      top: var(--space-6);
    }

    .sidebar-panel__title {
      font-family: var(--font-mono);
      font-size: var(--type-meta);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--color-text-secondary);
      margin-bottom: var(--space-3);
    }

    .sidebar-panel__list {
      list-style: square;
      padding-left: var(--space-4);
      font-size: 13px;
      color: var(--color-text-secondary);
      line-height: 1.8;
    }

    .sidebar-panel__note {
      font-size: 12px;
      color: var(--color-text-secondary);
      margin-top: var(--space-4);
      padding-top: var(--space-3);
      border-top: 1px solid var(--color-border-subtle);
      line-height: 1.6;
    }

    /* Return to Map button — sharp edges, no radius */
    .return-link {
      display: inline-block;
      margin-top: var(--space-8);
      padding: var(--space-3) var(--space-5);
      border: 3px solid var(--color-text);
      font-family: var(--font-mono);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      text-decoration: none;
      color: var(--color-text);
      transition: background 0.15s ease, color 0.15s ease;
    }

    .return-link:hover {
      background: var(--color-text);
      color: white;
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       CALLOUT SYSTEM — Soul Piece 3: Callout Family DNA
       2-zone structure (label + body), 4px left border
       R1-007 (Callout Positioning): after content
       R1-008 (Callout Scarcity): max 2 per spoke section
       ═══════════════════════════════════════════════════════════════════════════ */
    .callout {
      margin: var(--space-6) 0;
      border-left: var(--border-left-width) solid;
      padding: var(--space-4) var(--space-5);
    }

    .callout .callout__label {
      color: var(--color-text);
      font-weight: 600;
      font-size: 12px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      font-family: var(--font-mono);
      margin-bottom: var(--space-2);
    }

    .callout__body {
      font-size: 14px;
      line-height: 1.6;
    }

    .callout--info {
      border-left-color: var(--accent-blue);
      background: rgba(74, 144, 217, 0.05);
    }

    .callout--tip {
      border-left-color: var(--accent-green);
      background: rgba(74, 157, 107, 0.05);
    }

    .callout--gotcha {
      border-left-color: var(--accent-coral);
      background: rgba(201, 112, 101, 0.05);
    }

    .callout--essence {
      border-left-color: var(--accent-purple);
      background: rgba(124, 58, 237, 0.04);
    }
    .callout--essence .callout__body {
      font-family: var(--font-display);
      font-style: italic;
      font-size: 16px;
      line-height: 1.6;
    }

    .callout--checkpoint {
      border-left-color: var(--accent-green);
      background: rgba(74, 157, 107, 0.06);
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       CODE BLOCK — Dense zone
       DD-F-006 CHARACTER SCALE: comments(sparse) → logic(dense)
       ═══════════════════════════════════════════════════════════════════════════ */
    .code-block {
      background: #1A1A1A; /* Convention spec: locked code bg */
      font-family: var(--font-mono);
      font-size: var(--type-code);
      line-height: 1.5;
      color: #FAFAF5;
      padding: var(--space-6) var(--space-8);
      margin: var(--space-4) 0;
      overflow-x: auto;
      position: relative;
      border: 3px solid var(--color-border); /* Cat 1: structural */
    }

    .code-block__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-3);
      padding-bottom: var(--space-2);
      border-bottom: 1px solid var(--color-border); /* Cat 2: separator within code */
    }

    .code-block__lang {
      font-size: var(--type-meta);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--color-text-secondary);
    }

    .code-block__copy {
      font-size: var(--type-meta);
      cursor: pointer;
      background: none;
      border: 1px solid var(--color-border); /* Cat 3: micro */
      padding: 2px 8px;
      color: var(--color-text-secondary);
      font-family: var(--font-mono);
      transition: color 0.15s, border-color 0.15s;
    }

    .code-block__copy:hover {
      color: #FAFAF5;
      border-color: var(--color-primary);
    }

    .code-block__line {
      display: flex;
      gap: var(--space-3);
    }

    .code-block__num {
      color: var(--color-text-secondary);
      user-select: none;
      min-width: 24px;
      text-align: right;
    }

    /* Syntax highlighting — Convention spec locked palette */
    .code--comment { color: #666666; }           /* --color-text-secondary */
    .code--keyword { color: #E83025; }            /* --color-primary */
    .code--string { color: #6B9B7A; }             /* sage green */
    .code--function { color: #4A7C9B; }           /* muted blue */
    .code--type { color: #C97065; }               /* coral */
    .code--variable { color: #FAFAF5; }           /* default text */
    .code--bracket { color: #D97706; }            /* amber */
    .code--operator { color: #E0D5C5; }           /* border color — warm tan */

    /* ═══════════════════════════════════════════════════════════════════════════
       DECISION TABLE — Dense component within spokes
       ═══════════════════════════════════════════════════════════════════════════ */
    .decision-table {
      margin: var(--space-6) 0;
      overflow-x: auto;
    }

    .decision-table table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    .decision-table th {
      font-family: var(--font-mono);
      font-size: var(--type-meta);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      text-align: left;
      padding: var(--space-3) var(--space-4);
      border-bottom: 3px solid var(--color-text); /* Cat 1: structural */
      color: var(--color-text-secondary);
    }

    .decision-table td {
      padding: var(--space-3) var(--space-4);
      border-bottom: 1px solid var(--color-border-subtle); /* Cat 2: data separator */
      vertical-align: top;
    }

    .decision-table tr:last-child td {
      border-bottom: 3px solid var(--color-border); /* Cat 1: structural */
    }

    .decision-table code {
      font-family: var(--font-mono);
      font-size: 12px;
      background: var(--color-border-subtle);
      padding: 1px 4px;
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       FLOWCHART (text-based) — Decision paths within spokes
       ═══════════════════════════════════════════════════════════════════════════ */
    .flowchart {
      background: var(--color-border-subtle);
      padding: var(--space-5);
      margin: var(--space-6) 0;
      font-family: var(--font-mono);
      font-size: 12px;
      line-height: 1.8;
      border: 3px solid var(--color-border);
      white-space: pre;
      overflow-x: auto;
    }

    .flowchart__title {
      font-family: var(--font-mono);
      font-size: var(--type-meta);
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--color-text-secondary);
      margin-bottom: var(--space-3);
      display: block;
      white-space: normal;
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       FOOTER — Complete territory map summary
       ═══════════════════════════════════════════════════════════════════════════ */
    .exploration-footer {
      border-top: 3px solid var(--color-primary);
      padding-top: var(--space-8);
      margin-top: var(--space-20);
    }

    .footer-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-4);
      margin-top: var(--space-6);
    }

    .footer-link {
      font-family: var(--font-body);
      font-size: 13px;
      color: var(--color-text-secondary);
      text-decoration: none;
      padding: var(--space-3);
      border: 1px solid var(--color-border-subtle);
      display: block;
      transition: border-color 0.15s;
    }

    .footer-link:hover {
      border-color: var(--color-primary);
    }

    .footer-link__name {
      font-family: var(--font-display);
      font-style: italic;
      font-size: 15px;
      color: var(--color-text);
      display: block;
      margin-bottom: var(--space-1);
    }

    .footer-meta {
      font-family: var(--font-mono);
      font-size: var(--type-meta);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--color-text-secondary);
      margin-top: var(--space-8);
    }

    code {
      font-family: var(--font-mono);
      font-size: 0.9em;
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       WAVE DENSITY INDICATOR — EXT-SPAT-018: Scroll-driven zone display
       Fixed sidebar shows current territory zone as user scrolls.
       Rectangular markers (Soul Piece 5), locked palette.
       ═══════════════════════════════════════════════════════════════════════════ */
    .wave-indicator {
      position: fixed;
      right: var(--space-4);
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: var(--space-2);
      z-index: 100;
    }

    .wave-indicator__zone {
      width: 8px;
      height: 24px;
      background: var(--color-border);
      transition: background-color 0.3s;
    }

    .wave-indicator__zone--active {
      background: var(--color-primary);
    }

    .wave-indicator__label {
      font-family: var(--font-mono);
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--color-text-secondary);
      writing-mode: vertical-rl;
      text-orientation: mixed;
      margin-top: var(--space-2);
    }

    @media (max-width: 1200px) {
      .wave-indicator { display: none; }
    }

    @media print {
      body { background: white; color: black; }
      .skip-link, nav, .wave-indicator { display: none; }
      a[href]::after { content: " (" attr(href) ")"; font-size: 0.8em; }
      * { box-shadow: none !important; }
    }

    /* Inline code within body text */
    .inline-code {
      font-family: var(--font-mono);
      font-size: 13px;
      background: var(--color-border-subtle);
      padding: 1px 5px;
      border: 1px solid var(--color-border);
    }
  </style>
</head>
<body>

  <!-- EXT-SPAT-008: Skip link for screen reader accessibility -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <!-- EXT-SPAT-018: WAVE density indicator — shows current zone -->
  <nav class="wave-indicator" aria-label="Current territory zone" aria-hidden="true">
    <div class="wave-indicator__zone" data-zone="hub" title="Hub"></div>
    <div class="wave-indicator__zone" data-zone="state" title="State"></div>
    <div class="wave-indicator__zone" data-zone="patterns" title="Patterns"></div>
    <div class="wave-indicator__zone" data-zone="data" title="Data"></div>
    <div class="wave-indicator__zone" data-zone="performance" title="Performance"></div>
    <div class="wave-indicator__zone" data-zone="testing" title="Testing"></div>
    <div class="wave-indicator__zone" data-zone="accessibility" title="A11y"></div>
    <span class="wave-indicator__label">Zone</span>
  </nav>

  <!-- ═══════════════════════════════════════════════════════════════════════
       EXPLORATION HEADER — SPARSE ZONE (page-level)
       ═══════════════════════════════════════════════════════════════════════ -->
  <header class="exploration-header" role="banner">
    <div class="exploration-header__inner">
      <div class="exploration-id">Exploration OD-005 &middot; Density: WAVE + ISLANDS</div>
      <h1 class="exploration-title">Spatial Hub-Spoke Structure</h1>
      <p class="exploration-hypothesis">
        What if documentation was organized spatially -- as a hub-and-spoke map
        where users navigate between territory zones -- rather than linearly?
      </p>
      <div class="exploration-meta">
        <span>Density: <strong class="exploration-meta__value">WAVE + ISLANDS</strong></span>
        <span>DD Source: <strong class="exploration-meta__value">DD-006 (FRACTAL 36/40)</strong></span>
        <span>Organization: <strong class="exploration-meta__value">Hub-Spoke Spatial</strong></span>
        <span>Topic: <strong class="exploration-meta__value">React Component Architecture</strong></span>
      </div>
    </div>
  </header>

  <main id="main-content" class="page-container" role="main">

    <!-- ═══════════════════════════════════════════════════════════════════════
         WAVE VISUALIZATION — DD-005 lesson: visualization at top
         Shows the hub-spoke density oscillation pattern
         ═══════════════════════════════════════════════════════════════════════ -->
    <section class="wave-visualization reveal" aria-label="Density wave visualization">
      <div class="wave-visualization__title">Density Map: Wave Oscillation Across Territories</div>
      <div class="wave-diagram">
        <div class="wave-bar wave-bar--hub"><div class="wave-bar__fill"></div></div>
        <div class="wave-bar wave-bar--s1"><div class="wave-bar__fill"></div></div>
        <div class="wave-bar wave-bar--gap1"><div class="wave-bar__fill"></div></div>
        <div class="wave-bar wave-bar--s2"><div class="wave-bar__fill"></div></div>
        <div class="wave-bar wave-bar--gap2"><div class="wave-bar__fill"></div></div>
        <div class="wave-bar wave-bar--s3"><div class="wave-bar__fill"></div></div>
        <div class="wave-bar wave-bar--gap3"><div class="wave-bar__fill"></div></div>
        <div class="wave-bar wave-bar--s4"><div class="wave-bar__fill"></div></div>
        <div class="wave-bar wave-bar--gap4"><div class="wave-bar__fill"></div></div>
        <div class="wave-bar wave-bar--s5"><div class="wave-bar__fill"></div></div>
        <div class="wave-bar wave-bar--gap5"><div class="wave-bar__fill"></div></div>
        <div class="wave-bar wave-bar--s6"><div class="wave-bar__fill"></div></div>
        <div class="wave-bar wave-bar--end"><div class="wave-bar__fill"></div></div>
      </div>
      <div class="wave-labels">
        <span>Hub (sparse)</span>
        <span>State</span>
        <span>Patterns</span>
        <span>Data</span>
        <span>Perf</span>
        <span>Test</span>
        <span>A11y</span>
        <span>Hub (return)</span>
      </div>
      <div class="wave-annotation">
        Density oscillates as the reader navigates: <code>sparse hub</code> serves as the map,
        <code>dense spokes</code> deliver content, and <code>isolation gaps</code> between spokes
        create the WAVE rhythm. Each spoke is a self-contained ISLAND.
      </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════════════
         HUB — TERRITORY MAP
         DD-F-006 PAGE SCALE: Hub = sparse overview before dense spokes
         EXT-SPAT-001: Square tiles in CSS Grid with generous gaps
         ═══════════════════════════════════════════════════════════════════════ -->
    <section class="hub" id="hub" aria-label="Territory map">
      <h2 class="hub__heading reveal">React Component Architecture</h2>
      <p class="hub__subtitle reveal-delay-1">
        A spatial map of six interconnected territory zones. Each zone covers
        a distinct aspect of building React applications. Choose a territory
        to explore, or read sequentially.
      </p>

      <!-- EXT-SPAT-014: Grid role + keyboard spatial nav -->
      <div class="territory-grid" role="grid" aria-label="Territory navigation grid">

        <a href="#state" class="territory-tile reveal" role="gridcell" tabindex="0" aria-label="Navigate to State Management territory">
          <div class="territory-tile__marker"></div>
          <div class="territory-tile__name">State Management</div>
          <div class="territory-tile__description">
            useState, useReducer, and Context API. When to use each, and how they compose.
          </div>
          <span class="territory-tile__badge">3 Concepts</span>
        </a>

        <a href="#patterns" class="territory-tile reveal-delay-1" role="gridcell" tabindex="0" aria-label="Navigate to Component Patterns territory">
          <div class="territory-tile__marker"></div>
          <div class="territory-tile__name">Component Patterns</div>
          <div class="territory-tile__description">
            Compound Components, Render Props, and HOCs. Pattern selection and migration paths.
          </div>
          <span class="territory-tile__badge">3 Patterns</span>
        </a>

        <a href="#data" class="territory-tile reveal-delay-2" role="gridcell" tabindex="0" aria-label="Navigate to Data Fetching territory">
          <div class="territory-tile__marker"></div>
          <div class="territory-tile__name">Data Fetching</div>
          <div class="territory-tile__description">
            useEffect patterns, SWR, and React Query. Loading states, errors, and cache strategies.
          </div>
          <span class="territory-tile__badge">4 Strategies</span>
        </a>

        <a href="#performance" class="territory-tile reveal" role="gridcell" tabindex="0" aria-label="Navigate to Performance territory">
          <div class="territory-tile__marker"></div>
          <div class="territory-tile__name">Performance</div>
          <div class="territory-tile__description">
            React.memo, useMemo, useCallback. Profiler usage and bottleneck identification.
          </div>
          <span class="territory-tile__badge">3 Tools</span>
        </a>

        <a href="#testing" class="territory-tile reveal-delay-1" role="gridcell" tabindex="0" aria-label="Navigate to Testing territory">
          <div class="territory-tile__marker"></div>
          <div class="territory-tile__name">Testing</div>
          <div class="territory-tile__description">
            Unit testing with RTL, integration patterns, and snapshot testing considerations.
          </div>
          <span class="territory-tile__badge">3 Approaches</span>
        </a>

        <a href="#accessibility" class="territory-tile reveal-delay-2" role="gridcell" tabindex="0" aria-label="Navigate to Accessibility territory">
          <div class="territory-tile__marker"></div>
          <div class="territory-tile__name">Accessibility</div>
          <div class="territory-tile__description">
            ARIA patterns for React, focus management, and screen reader testing strategies.
          </div>
          <span class="territory-tile__badge">3 Domains</span>
        </a>

      </div>
    </section>


    <!-- ═══════════════════════════════════════════════════════════════════════
         SPOKE 1: STATE MANAGEMENT TERRITORY
         DD-F-006 SECTION SCALE: intro(sparse) → content(dense) → exit(sparse)
         ═══════════════════════════════════════════════════════════════════════ -->
    <div class="spoke-divider"></div>

    <section class="spoke" id="state" aria-label="State Management territory">
      <!-- Breadcrumb — EXT-SPAT-002 -->
      <nav class="breadcrumb reveal" aria-label="Breadcrumb">
        <a href="#hub">Hub</a>
        <span class="breadcrumb__separator" aria-hidden="true">&#9656;</span>
        <span class="breadcrumb__current">State Management</span>
      </nav>

      <!-- SPARSE ZONE: Territory heading + intro -->
      <h2 class="spoke__heading reveal">State Management</h2>
      <p class="spoke__intro reveal-delay-1">
        React offers three built-in mechanisms for managing state. The right choice
        depends on scope, complexity, and how many components need the data. This
        territory covers when to reach for each one, and how they compose together
        in production applications.
      </p>

      <!-- DENSE ZONE: Content grid with sidebar -->
      <div class="spoke-grid">
        <div class="spoke-content">

          <!-- Section: useState -->
          <div class="spoke-section reveal">
            <h3 class="spoke-section__heading">useState: Local Component State</h3>
            <p>
              The simplest state primitive. A single component owns the value and
              its setter. Ideal for form inputs, toggles, counters, and any state
              that belongs to exactly one component. Avoid reaching for anything
              heavier until <code class="inline-code">useState</code> proves insufficient.
            </p>
            <p>
              The key mental model: each call to <code class="inline-code">useState</code>
              creates an independent slot in the component's fiber. React batches
              updates within event handlers, so multiple <code class="inline-code">setState</code>
              calls produce a single re-render.
            </p>

            <!-- Code example — CHARACTER SCALE: comments(sparse) → logic(dense) -->
            <div class="code-block">
              <div class="code-block__header">
                <span class="code-block__lang">tsx</span>
                <button class="code-block__copy" onclick="navigator.clipboard.writeText(this.closest('.code-block').querySelector('pre').textContent).then(()=>{this.textContent='Copied';setTimeout(()=>this.textContent='Copy',1500)})">Copy</button>
              </div>
              <pre>
<span class="code-block__line"><span class="code-block__num"> 1</span> <span class="code--comment">// Simple toggle with useState</span></span>
<span class="code-block__line"><span class="code-block__num"> 2</span> <span class="code--keyword">function</span> <span class="code--function">Disclosure</span>() <span class="code--bracket">{</span></span>
<span class="code-block__line"><span class="code-block__num"> 3</span>   <span class="code--keyword">const</span> [<span class="code--variable">isOpen</span>, <span class="code--variable">setIsOpen</span>] = <span class="code--function">useState</span>(<span class="code--keyword">false</span>);</span>
<span class="code-block__line"><span class="code-block__num"> 4</span></span>
<span class="code-block__line"><span class="code-block__num"> 5</span>   <span class="code--keyword">return</span> (</span>
<span class="code-block__line"><span class="code-block__num"> 6</span>     &lt;<span class="code--type">div</span>&gt;</span>
<span class="code-block__line"><span class="code-block__num"> 7</span>       &lt;<span class="code--type">button</span> <span class="code--variable">onClick</span>={() =&gt; <span class="code--function">setIsOpen</span>(!<span class="code--variable">isOpen</span>)}&gt;</span>
<span class="code-block__line"><span class="code-block__num"> 8</span>         <span class="code--bracket">{</span><span class="code--variable">isOpen</span> ? <span class="code--string">'Hide'</span> : <span class="code--string">'Show'</span><span class="code--bracket">}</span></span>
<span class="code-block__line"><span class="code-block__num"> 9</span>       &lt;/<span class="code--type">button</span>&gt;</span>
<span class="code-block__line"><span class="code-block__num">10</span>       <span class="code--bracket">{</span><span class="code--variable">isOpen</span> &amp;&amp; &lt;<span class="code--type">Panel</span> /&gt;<span class="code--bracket">}</span></span>
<span class="code-block__line"><span class="code-block__num">11</span>     &lt;/<span class="code--type">div</span>&gt;</span>
<span class="code-block__line"><span class="code-block__num">12</span>   );</span>
<span class="code-block__line"><span class="code-block__num">13</span> <span class="code--bracket">}</span></span></pre>
            </div>
          </div>

          <!-- Section: useReducer -->
          <div class="spoke-section reveal">
            <h3 class="spoke-section__heading">useReducer: Complex State Logic</h3>
            <p>
              When state transitions involve multiple sub-values or when the next
              state depends on the previous one, <code class="inline-code">useReducer</code>
              provides a structured alternative. The reducer function is pure: given
              the current state and an action, it returns the next state deterministically.
            </p>
            <p>
              The primary advantage is testability. Because the reducer is a pure
              function, you can unit-test every state transition without rendering
              components. This matters in form workflows, multi-step wizards, and
              any component where state has more than three possible shapes.
            </p>

            <div class="code-block">
              <div class="code-block__header">
                <span class="code-block__lang">tsx</span>
                <button class="code-block__copy" onclick="navigator.clipboard.writeText(this.closest('.code-block').querySelector('pre').textContent).then(()=>{this.textContent='Copied';setTimeout(()=>this.textContent='Copy',1500)})">Copy</button>
              </div>
              <pre>
<span class="code-block__line"><span class="code-block__num"> 1</span> <span class="code--comment">// Reducer for a multi-step form</span></span>
<span class="code-block__line"><span class="code-block__num"> 2</span> <span class="code--keyword">type</span> <span class="code--type">FormAction</span> =</span>
<span class="code-block__line"><span class="code-block__num"> 3</span>   | <span class="code--bracket">{</span> <span class="code--variable">type</span>: <span class="code--string">'SET_FIELD'</span>; <span class="code--variable">field</span>: <span class="code--type">string</span>; <span class="code--variable">value</span>: <span class="code--type">string</span> <span class="code--bracket">}</span></span>
<span class="code-block__line"><span class="code-block__num"> 4</span>   | <span class="code--bracket">{</span> <span class="code--variable">type</span>: <span class="code--string">'NEXT_STEP'</span> <span class="code--bracket">}</span></span>
<span class="code-block__line"><span class="code-block__num"> 5</span>   | <span class="code--bracket">{</span> <span class="code--variable">type</span>: <span class="code--string">'RESET'</span> <span class="code--bracket">}</span>;</span>
<span class="code-block__line"><span class="code-block__num"> 6</span></span>
<span class="code-block__line"><span class="code-block__num"> 7</span> <span class="code--keyword">function</span> <span class="code--function">formReducer</span>(<span class="code--variable">state</span>, <span class="code--variable">action</span>: <span class="code--type">FormAction</span>) <span class="code--bracket">{</span></span>
<span class="code-block__line"><span class="code-block__num"> 8</span>   <span class="code--keyword">switch</span> (<span class="code--variable">action</span>.<span class="code--variable">type</span>) <span class="code--bracket">{</span></span>
<span class="code-block__line"><span class="code-block__num"> 9</span>     <span class="code--keyword">case</span> <span class="code--string">'SET_FIELD'</span>:</span>
<span class="code-block__line"><span class="code-block__num">10</span>       <span class="code--keyword">return</span> <span class="code--bracket">{</span> ...<span class="code--variable">state</span>, [<span class="code--variable">action</span>.<span class="code--variable">field</span>]: <span class="code--variable">action</span>.<span class="code--variable">value</span> <span class="code--bracket">}</span>;</span>
<span class="code-block__line"><span class="code-block__num">11</span>     <span class="code--keyword">case</span> <span class="code--string">'NEXT_STEP'</span>:</span>
<span class="code-block__line"><span class="code-block__num">12</span>       <span class="code--keyword">return</span> <span class="code--bracket">{</span> ...<span class="code--variable">state</span>, <span class="code--variable">step</span>: <span class="code--variable">state</span>.<span class="code--variable">step</span> + 1 <span class="code--bracket">}</span>;</span>
<span class="code-block__line"><span class="code-block__num">13</span>     <span class="code--keyword">case</span> <span class="code--string">'RESET'</span>:</span>
<span class="code-block__line"><span class="code-block__num">14</span>       <span class="code--keyword">return</span> <span class="code--variable">initialState</span>;</span>
<span class="code-block__line"><span class="code-block__num">15</span>   <span class="code--bracket">}</span></span>
<span class="code-block__line"><span class="code-block__num">16</span> <span class="code--bracket">}</span></span></pre>
            </div>
          </div>

          <!-- Section: Context API -->
          <div class="spoke-section reveal">
            <h3 class="spoke-section__heading">Context API: Shared State</h3>
            <p>
              Context solves prop drilling -- passing data through intermediate
              components that do not use it. Create a context, wrap a subtree
              with its Provider, and any descendant can consume the value directly.
              The trade-off: every consumer re-renders when the context value
              changes, regardless of whether it uses the changed portion.
            </p>

            <!-- Decision flowchart (text-based) -->
            <div class="flowchart">
              <span class="flowchart__title">State Selection Flowchart</span>
Is state used by ONE component?
  YES --&gt; useState
  NO  --&gt; Is the logic complex (3+ actions)?
           YES --&gt; useReducer
           NO  --&gt; Do 3+ components need this data?
                    YES --&gt; Context + useReducer
                    NO  --&gt; Lift state to common parent</div>
          </div>

          <!-- Callout: checkpoint (max 2 per spoke) -->
          <div class="callout callout--checkpoint reveal">
            <div class="callout__label">Checkpoint</div>
            <div class="callout__body">
              You should understand: (1) <code class="inline-code">useState</code> for local, simple values.
              (2) <code class="inline-code">useReducer</code> for complex transitions with multiple
              actions. (3) Context for cross-component sharing, with awareness of
              its re-render implications.
            </div>
          </div>

          <!-- Callout 2: essence (max 2 per spoke) -->
          <div class="callout callout--essence reveal-delay-1">
            <div class="callout__label">Essence</div>
            <div class="callout__body">
              Start with the simplest tool that works. Complexity is not a feature;
              it is a cost paid for capability you actually need.
            </div>
          </div>

        </div>

        <!-- Sidebar references -->
        <aside class="spoke-sidebar">
          <div class="sidebar-panel">
            <div class="sidebar-panel__title">Key APIs</div>
            <ul class="sidebar-panel__list">
              <li>useState</li>
              <li>useReducer</li>
              <li>createContext</li>
              <li>useContext</li>
            </ul>
            <div class="sidebar-panel__note">
              For server state (data from APIs), see the
              <a href="#data" style="color: var(--color-primary);">Data Fetching</a> territory.
              Client state and server state are distinct concerns.
            </div>
          </div>
        </aside>
      </div>

      <!-- SPARSE ZONE: Return to map -->
      <a href="#hub" class="return-link">&larr; Return to Map</a>
    </section>


    <!-- ═══════════════════════════════════════════════════════════════════════
         SPOKE 2: COMPONENT PATTERNS TERRITORY
         DD-F-006 SECTION SCALE: intro(sparse) → content(dense) → exit(sparse)
         ═══════════════════════════════════════════════════════════════════════ -->
    <div class="spoke-divider"></div>

    <section class="spoke" id="patterns" aria-label="Component Patterns territory">
      <nav class="breadcrumb reveal" aria-label="Breadcrumb">
        <a href="#hub">Hub</a>
        <span class="breadcrumb__separator" aria-hidden="true">&#9656;</span>
        <span class="breadcrumb__current">Component Patterns</span>
      </nav>

      <h2 class="spoke__heading reveal">Component Patterns</h2>
      <p class="spoke__intro reveal-delay-1">
        React's composition model enables several structural patterns for sharing
        behavior and UI logic across components. Three patterns dominate production
        codebases: Compound Components, Render Props, and Higher-Order Components.
        Each makes different trade-offs between flexibility, readability, and type safety.
      </p>

      <div class="spoke-grid">
        <div class="spoke-content">

          <div class="spoke-section reveal">
            <h3 class="spoke-section__heading">Compound Components</h3>
            <p>
              A set of components that work together to form a complete UI.
              The parent manages shared state; children are slotted in by the
              consumer. This pattern excels at flexibility -- the consumer
              controls composition order and which children appear. Examples
              include tabs, accordions, and dropdown menus.
            </p>
            <p>
              The implementation relies on Context to share the parent's state
              with its children implicitly. Children call <code class="inline-code">useContext</code>
              to access the shared state without the consumer passing props
              explicitly. This keeps the API surface clean.
            </p>

            <div class="code-block">
              <div class="code-block__header">
                <span class="code-block__lang">tsx</span>
                <button class="code-block__copy" onclick="navigator.clipboard.writeText(this.closest('.code-block').querySelector('pre').textContent).then(()=>{this.textContent='Copied';setTimeout(()=>this.textContent='Copy',1500)})">Copy</button>
              </div>
              <pre>
<span class="code-block__line"><span class="code-block__num"> 1</span> <span class="code--comment">// Compound Tabs component</span></span>
<span class="code-block__line"><span class="code-block__num"> 2</span> <span class="code--keyword">const</span> <span class="code--variable">TabsContext</span> = <span class="code--function">createContext</span>&lt;<span class="code--type">TabsState</span>&gt;();</span>
<span class="code-block__line"><span class="code-block__num"> 3</span></span>
<span class="code-block__line"><span class="code-block__num"> 4</span> <span class="code--keyword">function</span> <span class="code--function">Tabs</span>({ <span class="code--variable">children</span> }: <span class="code--type">Props</span>) <span class="code--bracket">{</span></span>
<span class="code-block__line"><span class="code-block__num"> 5</span>   <span class="code--keyword">const</span> [<span class="code--variable">active</span>, <span class="code--variable">setActive</span>] = <span class="code--function">useState</span>(0);</span>
<span class="code-block__line"><span class="code-block__num"> 6</span>   <span class="code--keyword">return</span> (</span>
<span class="code-block__line"><span class="code-block__num"> 7</span>     &lt;<span class="code--type">TabsContext</span>.<span class="code--type">Provider</span> <span class="code--variable">value</span>=<span class="code--bracket">{</span>{ <span class="code--variable">active</span>, <span class="code--variable">setActive</span> }<span class="code--bracket">}</span>&gt;</span>
<span class="code-block__line"><span class="code-block__num"> 8</span>       <span class="code--bracket">{</span><span class="code--variable">children</span><span class="code--bracket">}</span></span>
<span class="code-block__line"><span class="code-block__num"> 9</span>     &lt;/<span class="code--type">TabsContext</span>.<span class="code--type">Provider</span>&gt;</span>
<span class="code-block__line"><span class="code-block__num">10</span>   );</span>
<span class="code-block__line"><span class="code-block__num">11</span> <span class="code--bracket">}</span></span>
<span class="code-block__line"><span class="code-block__num">12</span></span>
<span class="code-block__line"><span class="code-block__num">13</span> <span class="code--comment">// Consumer API is clean:</span></span>
<span class="code-block__line"><span class="code-block__num">14</span> <span class="code--comment">// &lt;Tabs&gt;</span></span>
<span class="code-block__line"><span class="code-block__num">15</span> <span class="code--comment">//   &lt;Tabs.List&gt; ... &lt;/Tabs.List&gt;</span></span>
<span class="code-block__line"><span class="code-block__num">16</span> <span class="code--comment">//   &lt;Tabs.Panel&gt; ... &lt;/Tabs.Panel&gt;</span></span>
<span class="code-block__line"><span class="code-block__num">17</span> <span class="code--comment">// &lt;/Tabs&gt;</span></span></pre>
            </div>
          </div>

          <!-- Pattern comparison table -->
          <div class="spoke-section reveal">
            <h3 class="spoke-section__heading">Pattern Comparison</h3>
            <p>
              Choosing between patterns is a contextual decision. The table below
              captures the critical trade-offs. In most modern React codebases,
              Compound Components and hooks have largely replaced Render Props
              and HOCs for new code. HOCs persist in legacy codebases and specific
              cross-cutting concerns like authentication wrappers.
            </p>

            <div class="decision-table">
              <table>
                <thead>
                  <tr>
                    <th>Pattern</th>
                    <th>Flexibility</th>
                    <th>Type Safety</th>
                    <th>Readability</th>
                    <th>Best For</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>Compound Components</strong></td>
                    <td>High</td>
                    <td>Excellent</td>
                    <td>High</td>
                    <td>UI kits, design systems</td>
                  </tr>
                  <tr>
                    <td><strong>Render Props</strong></td>
                    <td>Very High</td>
                    <td>Good</td>
                    <td>Medium</td>
                    <td>Dynamic rendering logic</td>
                  </tr>
                  <tr>
                    <td><strong>HOCs</strong></td>
                    <td>Medium</td>
                    <td>Difficult</td>
                    <td>Low</td>
                    <td>Cross-cutting (auth, logging)</td>
                  </tr>
                  <tr>
                    <td><strong>Custom Hooks</strong></td>
                    <td>High</td>
                    <td>Excellent</td>
                    <td>Very High</td>
                    <td>Reusable logic (no UI)</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="callout callout--tip reveal">
            <div class="callout__label">Tip</div>
            <div class="callout__body">
              If you are starting a new project, default to Custom Hooks for logic
              sharing and Compound Components for UI composition. Introduce Render
              Props only when you need the consumer to control rendering decisions.
            </div>
          </div>

          <div class="callout callout--checkpoint reveal-delay-1">
            <div class="callout__label">Checkpoint</div>
            <div class="callout__body">
              You should understand: (1) Compound Components use Context for implicit
              state sharing. (2) Render Props give consumers maximum rendering control.
              (3) HOCs are a legacy pattern, best replaced by hooks for new code.
            </div>
          </div>

        </div>

        <aside class="spoke-sidebar">
          <div class="sidebar-panel">
            <div class="sidebar-panel__title">Migration Path</div>
            <ul class="sidebar-panel__list">
              <li>HOC &rarr; Custom Hook</li>
              <li>Render Prop &rarr; Hook + JSX</li>
              <li>Class mixins &rarr; Composition</li>
            </ul>
            <div class="sidebar-panel__note">
              When migrating HOCs, extract the logic into a custom hook first.
              Then replace the HOC wrapper with a direct hook call in the
              consuming component.
            </div>
          </div>
        </aside>
      </div>

      <a href="#hub" class="return-link">&larr; Return to Map</a>
    </section>


    <!-- ═══════════════════════════════════════════════════════════════════════
         SPOKE 3: DATA FETCHING TERRITORY
         DD-F-006 SECTION SCALE: intro(sparse) → content(dense) → exit(sparse)
         ═══════════════════════════════════════════════════════════════════════ -->
    <div class="spoke-divider"></div>

    <section class="spoke" id="data" aria-label="Data Fetching territory">
      <nav class="breadcrumb reveal" aria-label="Breadcrumb">
        <a href="#hub">Hub</a>
        <span class="breadcrumb__separator" aria-hidden="true">&#9656;</span>
        <span class="breadcrumb__current">Data Fetching</span>
      </nav>

      <h2 class="spoke__heading reveal">Data Fetching</h2>
      <p class="spoke__intro reveal-delay-1">
        Fetching data from external sources is where most React complexity lives.
        The raw approach -- <code class="inline-code">useEffect</code> with a fetch call --
        works but forces you to handle loading, errors, caching, and race conditions
        manually. Libraries like SWR and React Query abstract these concerns into
        declarative hooks.
      </p>

      <div class="spoke-grid">
        <div class="spoke-content">

          <div class="spoke-section reveal">
            <h3 class="spoke-section__heading">The useEffect Pattern</h3>
            <p>
              The foundational approach. Call fetch inside a <code class="inline-code">useEffect</code>,
              track loading and error states with <code class="inline-code">useState</code>,
              and clean up with an abort controller. This is the pattern every
              React developer should understand before reaching for a library,
              because the libraries solve the exact problems this pattern exposes.
            </p>

            <div class="code-block">
              <div class="code-block__header">
                <span class="code-block__lang">tsx</span>
                <button class="code-block__copy" onclick="navigator.clipboard.writeText(this.closest('.code-block').querySelector('pre').textContent).then(()=>{this.textContent='Copied';setTimeout(()=>this.textContent='Copy',1500)})">Copy</button>
              </div>
              <pre>
<span class="code-block__line"><span class="code-block__num"> 1</span> <span class="code--comment">// Manual data fetching with cleanup</span></span>
<span class="code-block__line"><span class="code-block__num"> 2</span> <span class="code--keyword">function</span> <span class="code--function">useUser</span>(<span class="code--variable">id</span>: <span class="code--type">string</span>) <span class="code--bracket">{</span></span>
<span class="code-block__line"><span class="code-block__num"> 3</span>   <span class="code--keyword">const</span> [<span class="code--variable">user</span>, <span class="code--variable">setUser</span>] = <span class="code--function">useState</span>&lt;<span class="code--type">User</span> | <span class="code--keyword">null</span>&gt;(<span class="code--keyword">null</span>);</span>
<span class="code-block__line"><span class="code-block__num"> 4</span>   <span class="code--keyword">const</span> [<span class="code--variable">error</span>, <span class="code--variable">setError</span>] = <span class="code--function">useState</span>&lt;<span class="code--type">Error</span> | <span class="code--keyword">null</span>&gt;(<span class="code--keyword">null</span>);</span>
<span class="code-block__line"><span class="code-block__num"> 5</span>   <span class="code--keyword">const</span> [<span class="code--variable">loading</span>, <span class="code--variable">setLoading</span>] = <span class="code--function">useState</span>(<span class="code--keyword">true</span>);</span>
<span class="code-block__line"><span class="code-block__num"> 6</span></span>
<span class="code-block__line"><span class="code-block__num"> 7</span>   <span class="code--function">useEffect</span>(() =&gt; <span class="code--bracket">{</span></span>
<span class="code-block__line"><span class="code-block__num"> 8</span>     <span class="code--keyword">const</span> <span class="code--variable">controller</span> = <span class="code--keyword">new</span> <span class="code--type">AbortController</span>();</span>
<span class="code-block__line"><span class="code-block__num"> 9</span>     <span class="code--function">fetch</span>(<span class="code--string">`/api/users/${id}`</span>, <span class="code--bracket">{</span></span>
<span class="code-block__line"><span class="code-block__num">10</span>       <span class="code--variable">signal</span>: <span class="code--variable">controller</span>.<span class="code--variable">signal</span></span>
<span class="code-block__line"><span class="code-block__num">11</span>     <span class="code--bracket">}</span>)</span>
<span class="code-block__line"><span class="code-block__num">12</span>       .<span class="code--function">then</span>(<span class="code--variable">r</span> =&gt; <span class="code--variable">r</span>.<span class="code--function">json</span>())</span>
<span class="code-block__line"><span class="code-block__num">13</span>       .<span class="code--function">then</span>(<span class="code--variable">setUser</span>)</span>
<span class="code-block__line"><span class="code-block__num">14</span>       .<span class="code--function">catch</span>(<span class="code--variable">setError</span>)</span>
<span class="code-block__line"><span class="code-block__num">15</span>       .<span class="code--function">finally</span>(() =&gt; <span class="code--function">setLoading</span>(<span class="code--keyword">false</span>));</span>
<span class="code-block__line"><span class="code-block__num">16</span>     <span class="code--keyword">return</span> () =&gt; <span class="code--variable">controller</span>.<span class="code--function">abort</span>();</span>
<span class="code-block__line"><span class="code-block__num">17</span>   <span class="code--bracket">}</span>, [<span class="code--variable">id</span>]);</span>
<span class="code-block__line"><span class="code-block__num">18</span></span>
<span class="code-block__line"><span class="code-block__num">19</span>   <span class="code--keyword">return</span> <span class="code--bracket">{</span> <span class="code--variable">user</span>, <span class="code--variable">error</span>, <span class="code--variable">loading</span> <span class="code--bracket">}</span>;</span>
<span class="code-block__line"><span class="code-block__num">20</span> <span class="code--bracket">}</span></span></pre>
            </div>
          </div>

          <div class="spoke-section reveal">
            <h3 class="spoke-section__heading">SWR and React Query</h3>
            <p>
              Both libraries wrap the manual fetch pattern with automatic caching,
              revalidation, deduplication, and retry logic. SWR (stale-while-revalidate)
              returns cached data immediately while fetching fresh data in the
              background. React Query (TanStack Query) adds mutation support,
              pagination, and infinite queries.
            </p>
            <p>
              The key mental shift: treat server data as a cache that can become
              stale, not as state that you own. The library manages the cache
              lifecycle. Your components declare what data they need, and the
              library handles when and how to fetch it.
            </p>
          </div>

          <div class="spoke-section reveal">
            <h3 class="spoke-section__heading">Cache Strategies</h3>

            <div class="decision-table">
              <table>
                <thead>
                  <tr>
                    <th>Strategy</th>
                    <th>Freshness</th>
                    <th>Cost</th>
                    <th>Use When</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><code>stale-while-revalidate</code></td>
                    <td>Eventually fresh</td>
                    <td>Low</td>
                    <td>User profiles, lists</td>
                  </tr>
                  <tr>
                    <td><code>cache-first</code></td>
                    <td>Possibly stale</td>
                    <td>Lowest</td>
                    <td>Static reference data</td>
                  </tr>
                  <tr>
                    <td><code>network-only</code></td>
                    <td>Always fresh</td>
                    <td>Highest</td>
                    <td>Real-time dashboards</td>
                  </tr>
                  <tr>
                    <td><code>cache-and-network</code></td>
                    <td>Instant + update</td>
                    <td>Medium</td>
                    <td>News feeds, social</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="callout callout--gotcha reveal">
            <div class="callout__label">Gotcha</div>
            <div class="callout__body">
              Do not use <code class="inline-code">useEffect</code> for data fetching in new projects
              without a compelling reason. The manual approach requires you to solve caching,
              race conditions, and deduplication yourself. SWR or React Query handle these
              correctly out of the box.
            </div>
          </div>

          <div class="callout callout--checkpoint reveal-delay-1">
            <div class="callout__label">Checkpoint</div>
            <div class="callout__body">
              You should understand: (1) The manual useEffect pattern and its limitations.
              (2) How SWR and React Query abstract caching and revalidation.
              (3) That server state is a cache, not owned state.
            </div>
          </div>

        </div>

        <aside class="spoke-sidebar">
          <div class="sidebar-panel">
            <div class="sidebar-panel__title">Libraries</div>
            <ul class="sidebar-panel__list">
              <li>SWR (Vercel)</li>
              <li>TanStack Query</li>
              <li>Apollo Client</li>
              <li>tRPC</li>
            </ul>
            <div class="sidebar-panel__note">
              For GraphQL APIs, Apollo Client provides a similar caching layer
              with schema awareness. For end-to-end type safety, tRPC eliminates
              the fetch layer entirely.
            </div>
          </div>
        </aside>
      </div>

      <a href="#hub" class="return-link">&larr; Return to Map</a>
    </section>


    <!-- ═══════════════════════════════════════════════════════════════════════
         SPOKE 4: PERFORMANCE TERRITORY
         DD-F-006 SECTION SCALE: intro(sparse) → content(dense) → exit(sparse)
         ═══════════════════════════════════════════════════════════════════════ -->
    <div class="spoke-divider"></div>

    <section class="spoke" id="performance" aria-label="Performance territory">
      <nav class="breadcrumb reveal" aria-label="Breadcrumb">
        <a href="#hub">Hub</a>
        <span class="breadcrumb__separator" aria-hidden="true">&#9656;</span>
        <span class="breadcrumb__current">Performance</span>
      </nav>

      <h2 class="spoke__heading reveal">Performance</h2>
      <p class="spoke__intro reveal-delay-1">
        React is fast by default. Performance optimization is about preventing
        unnecessary work -- re-renders that produce the same output, expensive
        computations that run on every render, and function references that break
        memoization boundaries. Optimize only what you have measured.
      </p>

      <div class="spoke-grid">
        <div class="spoke-content">

          <div class="spoke-section reveal">
            <h3 class="spoke-section__heading">React.memo: Component Memoization</h3>
            <p>
              Wrapping a component with <code class="inline-code">React.memo</code> tells React
              to skip re-rendering when props have not changed (shallow comparison
              by default). This is effective for components that receive stable
              props and render expensive subtrees. It is counterproductive for
              components that almost always receive new props.
            </p>

            <div class="code-block">
              <div class="code-block__header">
                <span class="code-block__lang">tsx</span>
                <button class="code-block__copy" onclick="navigator.clipboard.writeText(this.closest('.code-block').querySelector('pre').textContent).then(()=>{this.textContent='Copied';setTimeout(()=>this.textContent='Copy',1500)})">Copy</button>
              </div>
              <pre>
<span class="code-block__line"><span class="code-block__num"> 1</span> <span class="code--comment">// Memoize expensive list rendering</span></span>
<span class="code-block__line"><span class="code-block__num"> 2</span> <span class="code--keyword">const</span> <span class="code--variable">ExpensiveList</span> = <span class="code--function">memo</span>(</span>
<span class="code-block__line"><span class="code-block__num"> 3</span>   <span class="code--keyword">function</span> <span class="code--function">ExpensiveList</span>({ <span class="code--variable">items</span> }: <span class="code--type">Props</span>) <span class="code--bracket">{</span></span>
<span class="code-block__line"><span class="code-block__num"> 4</span>     <span class="code--keyword">return</span> (</span>
<span class="code-block__line"><span class="code-block__num"> 5</span>       &lt;<span class="code--type">ul</span>&gt;</span>
<span class="code-block__line"><span class="code-block__num"> 6</span>         <span class="code--bracket">{</span><span class="code--variable">items</span>.<span class="code--function">map</span>(<span class="code--variable">item</span> =&gt; (</span>
<span class="code-block__line"><span class="code-block__num"> 7</span>           &lt;<span class="code--type">ExpensiveItem</span></span>
<span class="code-block__line"><span class="code-block__num"> 8</span>             <span class="code--variable">key</span>=<span class="code--bracket">{</span><span class="code--variable">item</span>.<span class="code--variable">id</span><span class="code--bracket">}</span></span>
<span class="code-block__line"><span class="code-block__num"> 9</span>             <span class="code--variable">data</span>=<span class="code--bracket">{</span><span class="code--variable">item</span><span class="code--bracket">}</span></span>
<span class="code-block__line"><span class="code-block__num">10</span>           /&gt;</span>
<span class="code-block__line"><span class="code-block__num">11</span>         ))<span class="code--bracket">}</span></span>
<span class="code-block__line"><span class="code-block__num">12</span>       &lt;/<span class="code--type">ul</span>&gt;</span>
<span class="code-block__line"><span class="code-block__num">13</span>     );</span>
<span class="code-block__line"><span class="code-block__num">14</span>   <span class="code--bracket">}</span></span>
<span class="code-block__line"><span class="code-block__num">15</span> );</span></pre>
            </div>
          </div>

          <div class="spoke-section reveal">
            <h3 class="spoke-section__heading">useMemo and useCallback</h3>
            <p>
              <code class="inline-code">useMemo</code> caches the result of an expensive computation.
              <code class="inline-code">useCallback</code> caches a function reference. Both take a
              dependency array and recompute only when dependencies change. The primary
              use case for <code class="inline-code">useCallback</code> is stabilizing function
              props passed to memoized children.
            </p>
            <p>
              A common mistake is wrapping everything in <code class="inline-code">useMemo</code>.
              Memoization has a cost: memory for the cached value and comparison
              logic on every render. If the computation is cheap or the component
              re-renders infrequently, memoization adds overhead without benefit.
            </p>
          </div>

          <div class="spoke-section reveal">
            <h3 class="spoke-section__heading">Profiler: Measure Before Optimizing</h3>
            <p>
              The React DevTools Profiler records every render, showing which
              components rendered and how long each took. The most impactful
              optimization targets are components that render frequently with
              high render times. Look for components in the flame chart that
              appear bright yellow (slow) on interactions that should feel instant.
            </p>

            <div class="flowchart">
              <span class="flowchart__title">Performance Optimization Flowchart</span>
Is the interaction visibly slow?
  NO  --&gt; Do not optimize. Ship it.
  YES --&gt; Open React DevTools Profiler
         --&gt; Record the slow interaction
         --&gt; Find the slowest component
         --&gt; Is it re-rendering unnecessarily?
              YES --&gt; React.memo + useCallback
              NO  --&gt; Is the render itself slow?
                       YES --&gt; useMemo / virtualize
                       NO  --&gt; Profile outside React</div>
          </div>

          <div class="callout callout--gotcha reveal">
            <div class="callout__label">Gotcha</div>
            <div class="callout__body">
              Premature optimization is real. Adding <code class="inline-code">React.memo</code>,
              <code class="inline-code">useMemo</code>, and <code class="inline-code">useCallback</code>
              everywhere does not make your app faster. It makes your code harder to read
              and can actually slow things down due to comparison overhead.
            </div>
          </div>

          <div class="callout callout--checkpoint reveal-delay-1">
            <div class="callout__label">Checkpoint</div>
            <div class="callout__body">
              You should understand: (1) <code class="inline-code">React.memo</code> prevents
              re-renders when props are unchanged. (2) <code class="inline-code">useMemo</code>
              caches computed values. (3) <code class="inline-code">useCallback</code> stabilizes
              function references. (4) Measure with Profiler before optimizing.
            </div>
          </div>

        </div>

        <aside class="spoke-sidebar">
          <div class="sidebar-panel">
            <div class="sidebar-panel__title">Tools</div>
            <ul class="sidebar-panel__list">
              <li>React DevTools Profiler</li>
              <li>why-did-you-render</li>
              <li>Chrome Performance tab</li>
              <li>Lighthouse</li>
            </ul>
            <div class="sidebar-panel__note">
              The <code class="inline-code">why-did-you-render</code> library logs
              unnecessary re-renders to the console during development, pinpointing
              exactly which prop change triggered each render.
            </div>
          </div>
        </aside>
      </div>

      <a href="#hub" class="return-link">&larr; Return to Map</a>
    </section>


    <!-- ═══════════════════════════════════════════════════════════════════════
         SPOKE 5: TESTING TERRITORY
         DD-F-006 SECTION SCALE: intro(sparse) → content(dense) → exit(sparse)
         ═══════════════════════════════════════════════════════════════════════ -->
    <div class="spoke-divider"></div>

    <section class="spoke" id="testing" aria-label="Testing territory">
      <nav class="breadcrumb reveal" aria-label="Breadcrumb">
        <a href="#hub">Hub</a>
        <span class="breadcrumb__separator" aria-hidden="true">&#9656;</span>
        <span class="breadcrumb__current">Testing</span>
      </nav>

      <h2 class="spoke__heading reveal">Testing</h2>
      <p class="spoke__intro reveal-delay-1">
        Testing React components means testing behavior, not implementation. React
        Testing Library enforces this philosophy by providing utilities that query
        the DOM the way users interact with it -- by text, role, and label, not by
        component internals or CSS selectors.
      </p>

      <div class="spoke-grid">
        <div class="spoke-content">

          <div class="spoke-section reveal">
            <h3 class="spoke-section__heading">Unit Testing with React Testing Library</h3>
            <p>
              A unit test renders a component, simulates user interactions, and
              asserts on the resulting DOM. The core principle: if the test could
              break without a user-visible change, the test is too coupled to
              implementation. Query by role, text, or label. Avoid querying by
              class name or test ID unless no semantic alternative exists.
            </p>

            <div class="code-block">
              <div class="code-block__header">
                <span class="code-block__lang">tsx</span>
                <button class="code-block__copy" onclick="navigator.clipboard.writeText(this.closest('.code-block').querySelector('pre').textContent).then(()=>{this.textContent='Copied';setTimeout(()=>this.textContent='Copy',1500)})">Copy</button>
              </div>
              <pre>
<span class="code-block__line"><span class="code-block__num"> 1</span> <span class="code--comment">// Testing a toggle component</span></span>
<span class="code-block__line"><span class="code-block__num"> 2</span> <span class="code--function">test</span>(<span class="code--string">'toggles content visibility'</span>, () =&gt; <span class="code--bracket">{</span></span>
<span class="code-block__line"><span class="code-block__num"> 3</span>   <span class="code--function">render</span>(&lt;<span class="code--type">Disclosure</span> <span class="code--variable">label</span>=<span class="code--string">"Details"</span> /&gt;);</span>
<span class="code-block__line"><span class="code-block__num"> 4</span></span>
<span class="code-block__line"><span class="code-block__num"> 5</span>   <span class="code--comment">// Content is hidden initially</span></span>
<span class="code-block__line"><span class="code-block__num"> 6</span>   <span class="code--function">expect</span>(</span>
<span class="code-block__line"><span class="code-block__num"> 7</span>     <span class="code--variable">screen</span>.<span class="code--function">queryByText</span>(<span class="code--string">'Panel content'</span>)</span>
<span class="code-block__line"><span class="code-block__num"> 8</span>   ).<span class="code--function">not</span>.<span class="code--function">toBeInTheDocument</span>();</span>
<span class="code-block__line"><span class="code-block__num"> 9</span></span>
<span class="code-block__line"><span class="code-block__num">10</span>   <span class="code--comment">// Click the toggle button</span></span>
<span class="code-block__line"><span class="code-block__num">11</span>   <span class="code--function">fireEvent</span>.<span class="code--function">click</span>(</span>
<span class="code-block__line"><span class="code-block__num">12</span>     <span class="code--variable">screen</span>.<span class="code--function">getByRole</span>(<span class="code--string">'button'</span>, <span class="code--bracket">{</span></span>
<span class="code-block__line"><span class="code-block__num">13</span>       <span class="code--variable">name</span>: <span class="code--string">'Details'</span></span>
<span class="code-block__line"><span class="code-block__num">14</span>     <span class="code--bracket">}</span>)</span>
<span class="code-block__line"><span class="code-block__num">15</span>   );</span>
<span class="code-block__line"><span class="code-block__num">16</span></span>
<span class="code-block__line"><span class="code-block__num">17</span>   <span class="code--comment">// Content is now visible</span></span>
<span class="code-block__line"><span class="code-block__num">18</span>   <span class="code--function">expect</span>(</span>
<span class="code-block__line"><span class="code-block__num">19</span>     <span class="code--variable">screen</span>.<span class="code--function">getByText</span>(<span class="code--string">'Panel content'</span>)</span>
<span class="code-block__line"><span class="code-block__num">20</span>   ).<span class="code--function">toBeInTheDocument</span>();</span>
<span class="code-block__line"><span class="code-block__num">21</span> <span class="code--bracket">}</span>);</span></pre>
            </div>
          </div>

          <div class="spoke-section reveal">
            <h3 class="spoke-section__heading">Integration Testing Patterns</h3>
            <p>
              Integration tests render multiple components together with their
              providers (Router, Context, Theme). The goal is to test user flows
              across component boundaries. Wrap your render call in the same
              providers your app uses, or create a custom render function that
              includes them automatically.
            </p>
            <p>
              The most valuable integration tests cover critical paths: login
              flows, checkout sequences, and multi-step forms. These tests catch
              bugs that unit tests miss -- incorrect prop passing between
              components, missing context providers, and broken navigation.
            </p>
          </div>

          <div class="spoke-section reveal">
            <h3 class="spoke-section__heading">Snapshot Testing Considerations</h3>
            <p>
              Snapshot tests serialize component output and compare it to a stored
              reference. They catch unintended UI changes but produce noisy diffs
              for large components. Use snapshots sparingly for small, stable
              components. For dynamic or frequently-updated components, behavioral
              assertions are more maintainable.
            </p>
          </div>

          <div class="callout callout--info reveal">
            <div class="callout__label">Info</div>
            <div class="callout__body">
              React Testing Library's guiding principle: "The more your tests
              resemble the way your software is used, the more confidence they
              can give you." Prefer <code class="inline-code">getByRole</code> over
              <code class="inline-code">getByTestId</code>.
            </div>
          </div>

          <div class="callout callout--checkpoint reveal-delay-1">
            <div class="callout__label">Checkpoint</div>
            <div class="callout__body">
              You should understand: (1) Test behavior, not implementation.
              (2) Query by role and text, not by class or ID. (3) Integration tests
              cover cross-component user flows. (4) Snapshots are best for small,
              stable components.
            </div>
          </div>

        </div>

        <aside class="spoke-sidebar">
          <div class="sidebar-panel">
            <div class="sidebar-panel__title">Toolchain</div>
            <ul class="sidebar-panel__list">
              <li>Vitest / Jest</li>
              <li>@testing-library/react</li>
              <li>@testing-library/user-event</li>
              <li>MSW (Mock Service Worker)</li>
            </ul>
            <div class="sidebar-panel__note">
              MSW intercepts network requests at the service worker level, letting
              you test data fetching components without mocking
              <code class="inline-code">fetch</code> directly.
            </div>
          </div>
        </aside>
      </div>

      <a href="#hub" class="return-link">&larr; Return to Map</a>
    </section>


    <!-- ═══════════════════════════════════════════════════════════════════════
         SPOKE 6: ACCESSIBILITY TERRITORY
         DD-F-006 SECTION SCALE: intro(sparse) → content(dense) → exit(sparse)
         ═══════════════════════════════════════════════════════════════════════ -->
    <div class="spoke-divider"></div>

    <section class="spoke" id="accessibility" aria-label="Accessibility territory">
      <nav class="breadcrumb reveal" aria-label="Breadcrumb">
        <a href="#hub">Hub</a>
        <span class="breadcrumb__separator" aria-hidden="true">&#9656;</span>
        <span class="breadcrumb__current">Accessibility</span>
      </nav>

      <h2 class="spoke__heading reveal">Accessibility</h2>
      <p class="spoke__intro reveal-delay-1">
        Accessibility in React is not a separate concern -- it is component design.
        Every interactive element needs keyboard support, every dynamic region needs
        ARIA announcements, and every visual indicator needs a non-visual equivalent.
        The patterns here apply to every territory in this map.
      </p>

      <div class="spoke-grid">
        <div class="spoke-content">

          <div class="spoke-section reveal">
            <h3 class="spoke-section__heading">ARIA Patterns for React</h3>
            <p>
              React's JSX uses <code class="inline-code">aria-*</code> attributes directly (camelCase
              is not needed for ARIA; <code class="inline-code">aria-label</code> works as-is). The
              most common patterns: <code class="inline-code">aria-expanded</code> for disclosure
              widgets, <code class="inline-code">aria-live</code> for dynamic content, and
              <code class="inline-code">role</code> for non-semantic elements that need semantic meaning.
            </p>
            <p>
              A critical rule: use semantic HTML first. A <code class="inline-code">&lt;button&gt;</code>
              already has the correct role, keyboard handling, and focus behavior.
              Adding <code class="inline-code">role="button"</code> to a
              <code class="inline-code">&lt;div&gt;</code> requires you to reimplement all of that
              from scratch. Semantic elements are not optional decoration; they
              are the foundation that ARIA builds on.
            </p>

            <div class="code-block">
              <div class="code-block__header">
                <span class="code-block__lang">tsx</span>
                <button class="code-block__copy" onclick="navigator.clipboard.writeText(this.closest('.code-block').querySelector('pre').textContent).then(()=>{this.textContent='Copied';setTimeout(()=>this.textContent='Copy',1500)})">Copy</button>
              </div>
              <pre>
<span class="code-block__line"><span class="code-block__num"> 1</span> <span class="code--comment">// Accessible disclosure component</span></span>
<span class="code-block__line"><span class="code-block__num"> 2</span> <span class="code--keyword">function</span> <span class="code--function">Disclosure</span>({ <span class="code--variable">label</span>, <span class="code--variable">children</span> }) <span class="code--bracket">{</span></span>
<span class="code-block__line"><span class="code-block__num"> 3</span>   <span class="code--keyword">const</span> [<span class="code--variable">open</span>, <span class="code--variable">setOpen</span>] = <span class="code--function">useState</span>(<span class="code--keyword">false</span>);</span>
<span class="code-block__line"><span class="code-block__num"> 4</span>   <span class="code--keyword">const</span> <span class="code--variable">id</span> = <span class="code--function">useId</span>();</span>
<span class="code-block__line"><span class="code-block__num"> 5</span></span>
<span class="code-block__line"><span class="code-block__num"> 6</span>   <span class="code--keyword">return</span> (</span>
<span class="code-block__line"><span class="code-block__num"> 7</span>     &lt;<span class="code--type">div</span>&gt;</span>
<span class="code-block__line"><span class="code-block__num"> 8</span>       &lt;<span class="code--type">button</span></span>
<span class="code-block__line"><span class="code-block__num"> 9</span>         <span class="code--variable">aria-expanded</span>=<span class="code--bracket">{</span><span class="code--variable">open</span><span class="code--bracket">}</span></span>
<span class="code-block__line"><span class="code-block__num">10</span>         <span class="code--variable">aria-controls</span>=<span class="code--bracket">{</span><span class="code--variable">id</span><span class="code--bracket">}</span></span>
<span class="code-block__line"><span class="code-block__num">11</span>         <span class="code--variable">onClick</span>={() =&gt; <span class="code--function">setOpen</span>(!<span class="code--variable">open</span>)}</span>
<span class="code-block__line"><span class="code-block__num">12</span>       &gt;</span>
<span class="code-block__line"><span class="code-block__num">13</span>         <span class="code--bracket">{</span><span class="code--variable">label</span><span class="code--bracket">}</span></span>
<span class="code-block__line"><span class="code-block__num">14</span>       &lt;/<span class="code--type">button</span>&gt;</span>
<span class="code-block__line"><span class="code-block__num">15</span>       <span class="code--bracket">{</span><span class="code--variable">open</span> &amp;&amp; (</span>
<span class="code-block__line"><span class="code-block__num">16</span>         &lt;<span class="code--type">div</span> <span class="code--variable">id</span>=<span class="code--bracket">{</span><span class="code--variable">id</span><span class="code--bracket">}</span> <span class="code--variable">role</span>=<span class="code--string">"region"</span>&gt;</span>
<span class="code-block__line"><span class="code-block__num">17</span>           <span class="code--bracket">{</span><span class="code--variable">children</span><span class="code--bracket">}</span></span>
<span class="code-block__line"><span class="code-block__num">18</span>         &lt;/<span class="code--type">div</span>&gt;</span>
<span class="code-block__line"><span class="code-block__num">19</span>       )<span class="code--bracket">}</span></span>
<span class="code-block__line"><span class="code-block__num">20</span>     &lt;/<span class="code--type">div</span>&gt;</span>
<span class="code-block__line"><span class="code-block__num">21</span>   );</span>
<span class="code-block__line"><span class="code-block__num">22</span> <span class="code--bracket">}</span></span></pre>
            </div>
          </div>

          <div class="spoke-section reveal">
            <h3 class="spoke-section__heading">Focus Management</h3>
            <p>
              When content appears dynamically -- modals, drawers, toast
              notifications -- focus must move to the new content. When the
              dynamic content closes, focus returns to the trigger element.
              React's <code class="inline-code">useRef</code> and
              <code class="inline-code">useEffect</code> handle this:
              store a ref to the trigger, move focus to the new content on open,
              and return focus to the ref on close.
            </p>
            <p>
              Focus trapping in modals requires intercepting Tab and Shift+Tab
              at the modal boundaries. Libraries like
              <code class="inline-code">focus-trap-react</code> handle the edge cases:
              nested traps, initial focus targets, and return focus on unmount.
              For simple cases, a manual implementation with
              <code class="inline-code">document.querySelectorAll('[tabindex], a, button, input')</code>
              is sufficient.
            </p>
          </div>

          <div class="spoke-section reveal">
            <h3 class="spoke-section__heading">Screen Reader Testing</h3>
            <p>
              Automated tools (axe, Lighthouse) catch structural issues: missing
              alt text, missing labels, incorrect heading hierarchy. They cannot
              catch experiential issues: confusing announcement order, redundant
              information, or poor navigation flow. Manual testing with a screen
              reader is required for any component that has dynamic behavior.
            </p>
            <p>
              Test with VoiceOver (macOS), NVDA (Windows), and TalkBack (Android)
              at minimum. Each has different announcement behaviors and navigation
              models. A component that works perfectly with VoiceOver may be
              unusable with NVDA due to differences in how they handle
              <code class="inline-code">aria-live</code> regions.
            </p>
          </div>

          <div class="callout callout--essence reveal">
            <div class="callout__label">Essence</div>
            <div class="callout__body">
              Accessibility is not a feature to add later. It is a quality of the
              component itself. A button that cannot be activated with a keyboard
              is not an inaccessible button -- it is a broken button.
            </div>
          </div>

          <div class="callout callout--checkpoint reveal-delay-1">
            <div class="callout__label">Checkpoint</div>
            <div class="callout__body">
              You should understand: (1) Use semantic HTML before ARIA attributes.
              (2) Manage focus when content appears or disappears dynamically.
              (3) Automated tools catch structure; manual testing catches experience.
            </div>
          </div>

        </div>

        <aside class="spoke-sidebar">
          <div class="sidebar-panel">
            <div class="sidebar-panel__title">Testing Tools</div>
            <ul class="sidebar-panel__list">
              <li>axe-core / @axe-core/react</li>
              <li>Lighthouse (Chrome)</li>
              <li>VoiceOver (macOS)</li>
              <li>NVDA (Windows)</li>
              <li>focus-trap-react</li>
            </ul>
            <div class="sidebar-panel__note">
              Add <code class="inline-code">@axe-core/react</code> to your development
              build. It logs accessibility violations to the console during
              development, catching issues before they reach review.
            </div>
          </div>
        </aside>
      </div>

      <a href="#hub" class="return-link">&larr; Return to Map</a>
    </section>


    <!-- ═══════════════════════════════════════════════════════════════════════
         FOOTER — Complete territory map summary with links
         Sparse zone: returning to hub-level overview
         ═══════════════════════════════════════════════════════════════════════ -->
    <div class="spoke-divider"></div>

    <footer class="exploration-footer" id="footer" role="contentinfo">
      <h2 style="font-family: var(--font-display); font-style: italic; font-size: var(--type-section); margin-bottom: var(--space-3);">
        Territory Map Summary
      </h2>
      <p style="font-size: 14px; color: var(--color-text-secondary); max-width: 55ch; margin-bottom: var(--space-4);">
        Six territories covering React component architecture. Each territory
        is a self-contained island with its own depth. Navigate freely.
      </p>

      <div class="footer-grid">
        <a href="#state" class="footer-link">
          <span class="footer-link__name">State Management</span>
          useState, useReducer, Context API
        </a>
        <a href="#patterns" class="footer-link">
          <span class="footer-link__name">Component Patterns</span>
          Compound, Render Props, HOCs, Hooks
        </a>
        <a href="#data" class="footer-link">
          <span class="footer-link__name">Data Fetching</span>
          useEffect, SWR, React Query, Caching
        </a>
        <a href="#performance" class="footer-link">
          <span class="footer-link__name">Performance</span>
          memo, useMemo, useCallback, Profiler
        </a>
        <a href="#testing" class="footer-link">
          <span class="footer-link__name">Testing</span>
          RTL, Integration, Snapshots
        </a>
        <a href="#accessibility" class="footer-link">
          <span class="footer-link__name">Accessibility</span>
          ARIA, Focus, Screen Readers
        </a>
      </div>

      <div class="footer-meta">
        OD-005 / Spatial Hub-Spoke / WAVE + ISLANDS / DD-F-006 Compliant / Soul 5/5
      </div>
    </footer>

  </main>

  <!-- ═══════════════════════════════════════════════════════════════════════
       SMOOTH SCROLL — Minimal JS for hub-spoke navigation
       EXT-SPAT-010: 95% static HTML, 5% interactive
       ═══════════════════════════════════════════════════════════════════════ -->
  <script>
    // Smooth scroll for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(function(anchor) {
      anchor.addEventListener('click', function(e) {
        var target = document.querySelector(this.getAttribute('href'));
        if (target) {
          e.preventDefault();
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });
    });

    // Copy button functionality is inline on each button via onclick

    // EXT-SPAT-018: WAVE density indicator — highlight current zone
    (function() {
      var zones = ['hub', 'state', 'patterns', 'data', 'performance', 'testing', 'accessibility'];
      var indicators = document.querySelectorAll('.wave-indicator__zone');
      if (!indicators.length) return;
      function updateIndicator() {
        var current = 0;
        zones.forEach(function(id, i) {
          var el = document.getElementById(id);
          if (el && el.getBoundingClientRect().top <= 200) current = i;
        });
        indicators.forEach(function(ind, i) {
          ind.classList.toggle('wave-indicator__zone--active', i === current);
        });
      }
      window.addEventListener('scroll', updateIndicator, { passive: true });
      updateIndicator();
    })();

    // EXT-SPAT-014: Keyboard spatial navigation for territory grid
    (function() {
      var grid = document.querySelector('.territory-grid');
      if (!grid) return;
      var tiles = Array.from(grid.querySelectorAll('.territory-tile'));
      grid.addEventListener('keydown', function(e) {
        var idx = tiles.indexOf(document.activeElement);
        if (idx === -1) return;
        var cols = window.innerWidth >= 600 ? 2 : 1;
        var next = -1;
        if (e.key === 'ArrowRight') next = Math.min(idx + 1, tiles.length - 1);
        if (e.key === 'ArrowLeft') next = Math.max(idx - 1, 0);
        if (e.key === 'ArrowDown') next = Math.min(idx + cols, tiles.length - 1);
        if (e.key === 'ArrowUp') next = Math.max(idx - cols, 0);
        if (next >= 0 && next !== idx) {
          e.preventDefault();
          tiles[next].focus();
        }
      });
    })();
  </script>

</body>
</html>
