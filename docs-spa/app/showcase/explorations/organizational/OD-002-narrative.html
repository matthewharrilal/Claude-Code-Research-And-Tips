<!-- ═══════════════════════════════════════════════════════════════════════
     OD-002: Narrative Arc Structure
     Organizational Exploration — Story-Driven Documentation

     Hypothesis: "What if documentation was organized as a narrative arc?"
     Density Pairing: CRESCENDO (primary) — sparse → dense
     DD Sources: DD-001 (PULSE), DD-002 (CRESCENDO — DD-F-002), DD-006 (FRACTAL — mandatory)
     Research: R1-001 (Density Rhythm), R1-003 (Viewport), R1-016 (Typography-First), R1-017 (Monospace)

     Applied Research:
       R1-001 (Density Rhythm) — Arc: setup=sparse → conflict=medium → resolution=dense
       R1-003 (Viewport Principle) — One narrative beat per viewport
       R1-016 (Typography-First Hierarchy) — Headings mirror arc (large setup → dense resolution)
       R1-017 (Monospace Differentiation) — Code appears at conflict/resolution, not setup
       R1-007 (Callout Positioning) — Callouts follow content they reference
       R1-008 (Callout Scarcity) — Max 2 callouts per section
       R1-018 (Pull Quotes) — Essence pullquote as act break
       R1-019 (Tech Spec Aesthetic) — Sharp edges, mono accents
       R3-004 (CRESCENDO) — Progressive density increase validated
       R5-S1 (Setup-Payoff) — Narrative setup pays off in code
       EXT-NARR-001 (Freytag 5-beat) — Falling action + resolution as cognitive exhale
       EXT-NARR-002 (Narrative UX) — Inciting incident creates narrative pull
       EXT-NARR-003 (Info Withholding) — Hermeneutic code validates code absence
       EXT-NARR-004 (Visual Pacing) — Micro/macro pacing through whitespace
       EXT-NARR-005 (Typographic Hierarchy) — Type reduction as density signal
       EXT-NARR-006 (Pull Quotes) — Act-break pull quotes as editorial device
       EXT-NARR-007 (Scrollytelling) — Tension meter as act position indicator
       EXT-NARR-008 (Four Pillars) — Layout + Typography + Color + Imagery
       EXT-NARR-009 (Progressive Disclosure) — Narrative arc = progressive disclosure
       EXT-NARR-010 (Decision Matrix) — Visual scoring at climax
       EXT-NARR-011 (Micro/Macro) — Dual-pacing within and across acts

     Anti-Patterns Avoided:
       DD-F-015 Traffic-light — no green+red adjacent
       R5-A1 Callout Cacophony — max 2 callouts per section
       R5-A5 Temperature Whiplash — gradual temperature transitions
       OD-F-AP-001 — No 2px structural borders (3-cat system applied)

     DD-F-006 Fractal Compliance:
       PAGE SCALE: Act I(sparse) → Act II(medium) → Act III(dense) → Act IV(settled) → Act V(exhale) CRESCENDO
       SECTION SCALE: Within each act, intro(sparse) → detail(denser) → transition(bridge)
       COMPONENT SCALE: Callout label(sparse) → body(dense)
       CHARACTER SCALE: Code comments(sparse) → code logic(dense)

     OD-001 Key Lesson Applied:
       OD-001 validated that organizational patterns NATURALLY create density patterns.
       Conversational Q&A inherently creates PULSE. For OD-002, the narrative arc
       should inherently create CRESCENDO — the story's progression from simple to
       complex mirrors sparse → dense.

     OD-F-005 Applied: Narrative Arc IS CRESCENDO density identity. Not two layers—one phenomenon.
     ═══════════════════════════════════════════════════════════════════════ -->

<!-- ═══════════════════════════════════════════════════════════════════════
     INLINE THREADING HEADER — OD Execution Phase
     File: docs-spa/app/showcase/explorations/organizational/OD-002-narrative.html
     Tier: B | Stage: 3 (Organization OD) | Generated: 2026-02-07
     ═══════════════════════════════════════════════════════════════════════

1. WHY THIS EXISTS
OD-002-narrative.html is the second organizational exploration, testing the
hypothesis that documentation organized as a three-act narrative arc creates
natural CRESCENDO density rhythm. The story progresses from simple concepts
(Act I: sparse exposition) through increasing complexity (Act II: moderate
rising action) to dense architectural resolution (Act III: dense climax).
Content: "Building a REST API" as narrative journey. Scored ~33/40. Built
in Session 2, threaded in Session 3.

2. THE QUESTION THIS ANSWERS
"Can a narrative arc organizational structure — exposition, rising action,
climax, resolution — create natural CRESCENDO density (sparse → dense) while
maintaining DD-F-006 fractal self-similarity at all four structural scales?"

3. STATUS
ACTIVE — INCLUDE (v3 re-enriched, Wave 5 audit PASS). 35/40. Soul compliance 100%.
Wave 5: Core soul 8/9 PASS (NOTE: off-palette code block colors). OD-AP-003 FAIL (6 rgba). Standards 13/17.
Freytag 5-beat model applied. Research Debt RD-1 resolved (11 EXT-NARR findings).

4. SOUL ALIGNMENT
  Soul Piece                     | Implementation                      | Evidence
  -------------------------------|-------------------------------------|--------
  1. Sharp Edges                 | --border-radius: 0 in :root        | Line ~73
  2. No Shadows                  | --box-shadow: none in :root         | Line ~74
  3. Serif = Wisdom              | Instrument Serif for act titles,    | Throughout
                                 | narrative transitions, essence      |
  4. Callout Family DNA          | 2-zone callouts, 4px left border,  | CSS callout section
                                 | color-only differentiation          |
  5. Squares Signal System       | Square act markers, no radius       | .act-marker styles

5. BUILT ON
  Source                          | Role                              | Key Values Taken                                  | Path
  --------------------------------|-----------------------------------|---------------------------------------------------|-----
  DD-001-breathing.html           | PULSE pattern (act rhythm)        | Alternating breathing rhythm within acts           | explorations/density/DD-001-breathing.html
  DD-002-crescendo.html           | CRESCENDO pattern (primary)       | Sparse→dense progressive build validated (35/40)   | explorations/density/DD-002-crescendo.html
  DD-006-fractal.html             | DD-F-006 fractal (mandatory)      | 4-scale self-similarity constraint                 | explorations/density/DD-006-fractal.html
  MASTER-SOUL-SYNTHESIS.md        | Soul authority (T1 LOCKED)        | 5 soul pieces, 6 Universal Rules                   | perceptual-audit-v2/synthesis/MASTER-SOUL-SYNTHESIS.md
  DESIGN-TOKEN-SUMMARY.md         | Locked token source (T1 LOCKED)   | Complete :root block                               | perceptual-audit-v2/synthesis/DESIGN-TOKEN-SUMMARY.md
  OD-001-conversational.html      | OD-001 lessons                    | Org patterns naturally create density; Q&A=PULSE   | explorations/organizational/OD-001-conversational.html

6. MUST HONOR
  Constraint                      | Source                              | Consequence if Violated
  --------------------------------|-------------------------------------|-------------------------------------
  DD-F-006 fractal at 4 scales    | DD-006-fractal.html                 | Exploration INVALID — mandatory for all OD
  CRESCENDO (sparse→dense)        | R3-004 + DD-002-crescendo.html      | Core hypothesis fails
  border-radius: 0 everywhere     | DESIGN-TOKEN-SUMMARY.md             | Soul violation
  box-shadow: none everywhere     | DESIGN-TOKEN-SUMMARY.md             | Soul violation
  Max 2 callouts per section      | R5-T4                               | Callout cacophony anti-pattern
  One narrative beat per viewport  | R1-003                              | Viewport principle violated

7. WHAT BREAKS IF THIS CHANGES
BLAST RADIUS: LOW-MEDIUM
  - OD-CHECKPOINT.md (OD-002 state row)
  - RESEARCH-ACTIVE.md (10+ findings marked APPLIED via this file)
  - OD-004 (shares DD-002 CRESCENDO source — must check if changes propagate)
  - organizational-patterns.md (will catalog NARRATIVE pattern)
  - OD-SYNTHESIS.md (will synthesize across all OD explorations)

8. CONSUMED BY
  Consumer                                                        | How It Uses This File
  ----------------------------------------------------------------|-------------------------------------
  OD-CHECKPOINT.md                                                | OD-002 state tracking
  OD-004-confidence.html                                          | Shares CRESCENDO density — learns from OD-002's arc implementation
  organizational-patterns.md                                      | Catalogs NARRATIVE pattern with score + mechanism
  OD-SYNTHESIS.md                                                 | Cross-OD synthesis — narrative vs conversational vs task comparison
  RESEARCH-ACTIVE.md                                              | Tracks applied R1 findings
  research-package-od-002.md                                      | Research for v3 re-enrichment (researcher-1b)
  builder-1b (v3 re-enrichment)                                   | Applied 11 EXT-NARR findings, expanded to Freytag 5-beat
  scribe-1 (v3 provenance)                                        | Updated formal chain for v3 re-enrichment

9. RESEARCH DEBT
  - Narrative pacing research (EXT-NARR findings) INTEGRATED — 11 findings applied
  - External UX research applied (EXT-NARR-001 through EXT-NARR-011)
  - Act transition timing: 5-beat Freytag model applied (EXT-NARR-001)
  - Mobile viewport: narrative beat-per-viewport untested below 768px
  - Accessibility: screen reader narrative flow untested

10. DIAGNOSTIC QUESTIONS
  Q1: Does the five-beat structure create measurable CRESCENDO density?
      → YES: Exposition=sparse, Rising=medium, Climax=dense, Falling=medium-settled, Resolution=sparse
  Q2: Is the narrative arc CLEAR without reading explanatory text?
      → YES: Typography reduction, tension meter, code progressive disclosure all signal position
  Q3: Does fractal work at all 4 scales within narrative structure?
      → YES: Page=5-beat arc, Section=intro/detail/bridge, Component=label/body, Character=comment/code
  Q4: Do the callouts feel like narrative devices (foreshadowing, aside) or interruptions?
      → YES: Positioned at act transitions and after content they reference
  Q5: (OD-specific) Does the narrative arc make technical content MORE learnable?
      → Hypothesis: YES. Story structure provides motivation + context that reference docs lack.
      → Progressive disclosure (EXT-NARR-009) validates: narrative arc IS the natural form of progressive learning.

END INLINE THREADING HEADER
     ═══════════════════════════════════════════════════════════════════════ -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OD-002: Narrative Arc Structure</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' fill='%23E83025'/><text x='50%25' y='50%25' dominant-baseline='central' text-anchor='middle' fill='white' font-family='serif' font-size='20'>K</text></svg>">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

  <style>
    /* ═══════════════════════════════════════════════════════════════════════════
       LOCKED DESIGN TOKENS — From OD-CONVENTION-SPEC.md (Unified Standard)
       DD-001 Lessons: Standardized borders, no traffic-light palette
       DD-002 Lessons: CRESCENDO progressive density validated (35/40)
       DD-006 Lessons: Fractal self-similarity at all scales
       OD-F-005: Narrative Arc IS CRESCENDO — one phenomenon, not two layers
       ═══════════════════════════════════════════════════════════════════════════ */
    :root {
      /* Colors — LOCKED */
      --color-primary: #E83025;
      --color-background: #FEF9F5;
      --color-text: #1A1A1A;
      --color-text-secondary: #666666;
      --color-border: #E0D5C5;
      --color-border-subtle: #F0EBE3;

      /* Zone backgrounds (CRESCENDO differentiation) */
      --color-zone-sparse: #FEF9F5;
      --color-zone-dense: #FFFFFF;
      --color-zone-breathing: #FAF5ED;

      /* Typography — LOCKED */
      --font-display: 'Instrument Serif', Georgia, serif;
      --font-body: 'Inter', system-ui, sans-serif;
      --font-mono: 'JetBrains Mono', 'SF Mono', monospace;

      /* Type Scale — 5-level cascade per Convention Spec (~1.5x ratio) */
      --type-page: 2.5rem;
      --type-section: 1.625rem;
      --type-subsection: 1.375rem;
      --type-body: 1rem;
      --type-code: 0.875rem;
      --type-meta: 0.75rem;

      /* Geometry — LOCKED */
      --border-radius: 0;
      --box-shadow: none;

      /* Spacing Scale */
      --space-1: 4px;
      --space-2: 8px;
      --space-3: 12px;
      --space-4: 16px;
      --space-5: 20px;
      --space-6: 24px;
      --space-8: 32px;
      --space-10: 40px;
      --space-12: 48px;
      --space-16: 64px;
      --space-20: 80px;

      /* Gestalt Semantic Aliases (EXT-CONV-003 + EXT-DENSITY-001) */
      --space-within: var(--space-2);
      --space-between: var(--space-8);
      --space-chapter: var(--space-16);

      /* Callout Accents — LOCKED */
      --accent-blue: #4A90D9;
      --accent-green: #4A9D6B;
      --accent-coral: #C97065;
      --accent-amber: #D97706;
      --accent-purple: #7C3AED;

      /* Standardized Border */
      --border-left-width: 4px;

      /* Solid Offset (EXT-CREATIVE-001) */
      --offset-x: 4px;
      --offset-y: 4px;
      --offset-color: #1A1A1A;
    }

    /* Applied EXT-NARR-008: Base styles enforce all 4 editorial pillars */
    .skip-link {
      position: absolute;
      top: -100%;
      left: 0;
      background: var(--color-primary);
      color: var(--color-background);
      padding: 8px 16px;
      z-index: 1000;
      font-family: var(--font-body);
      font-size: 14px;
      text-decoration: none;
      border: none;
    }
    .skip-link:focus {
      top: 0;
    }

    *:focus-visible {
      outline: 3px solid var(--color-primary);
      outline-offset: 2px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-body);
      background: var(--color-background);
      color: var(--color-text);
      line-height: 1.7;
    }

    code {
      font-family: var(--font-mono);
      font-size: 0.9em;
    }

    /* Applied EXT-NARR-008: Inline code styling per convention spec */
    code:not(pre code) {
      font-family: var(--font-mono);
      font-size: 0.9em;
      background: var(--color-border-subtle);
      padding: 2px 6px;
      border: 1px solid var(--color-border); /* Cat 3 micro */
    }

    ::selection {
      background: var(--color-primary);
      color: var(--color-background);
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       EXPLORATION HEADER — Full-bleed dark per Convention Spec Section 4
       Applied EXT-NARR-008: Layout pillar — dark header creates strong entry
       Applying R1-019 (Tech Spec Aesthetic): monospace ID, sharp edges
       ═══════════════════════════════════════════════════════════════════════════ */
    .exploration-header {
      background: var(--color-text);
      border-bottom: 3px solid var(--color-primary); /* Cat 1 structural */
      padding: var(--space-16) var(--space-8);
    }

    .exploration-header__inner {
      max-width: 860px;
      margin: 0 auto;
    }

    .exploration-id {
      font-family: var(--font-mono);
      font-size: var(--type-meta);
      color: var(--color-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.15em;
      margin-bottom: var(--space-2);
    }

    .exploration-title {
      font-family: var(--font-display);
      font-size: var(--type-page);
      font-style: italic;
      color: #FAFAF5;
      margin-bottom: var(--space-4);
    }

    .exploration-hypothesis {
      font-size: var(--type-body);
      color: var(--color-text-secondary);
      max-width: 70ch;
      line-height: 1.7;
    }

    .exploration-meta {
      display: flex;
      gap: var(--space-6);
      margin-top: var(--space-4);
      font-family: var(--font-mono);
      font-size: var(--type-meta);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--color-text-secondary);
    }

    .exploration-meta span {
      display: flex;
      align-items: center;
      gap: var(--space-1);
    }

    .exploration-meta__value {
      color: var(--color-primary);
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       PAGE CONTAINER
       ═══════════════════════════════════════════════════════════════════════════ */
    .page-container {
      max-width: 860px;
      margin: 0 auto;
      padding: 0 var(--space-6);
      padding-bottom: var(--space-20);
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       ARC VISUALIZATION — DD-002 CRESCENDO pattern diagram
       Applied EXT-NARR-008: Imagery pillar — visual diagram at page top
       Applied EXT-NARR-001: Freytag 5-beat model shown visually
       Applying DD-005 lesson: visualization at top explains the concept
       ═══════════════════════════════════════════════════════════════════════════ */
    .arc-visualization {
      margin: var(--space-8) 0;
      padding: var(--space-6);
      background: var(--color-zone-dense);
      border-left: var(--border-left-width) solid var(--color-primary);
    }

    .arc-visualization__title {
      font-family: var(--font-mono);
      font-size: var(--type-meta);
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--color-text-secondary);
      margin-bottom: var(--space-5);
    }

    .arc-diagram {
      display: flex;
      align-items: flex-end;
      gap: 3px;
      height: 100px;
      padding-bottom: var(--space-4);
      border-bottom: 3px solid var(--color-border); /* Cat 1: structural frame */
    }

    .arc-bar {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      height: 100%;
    }

    .arc-bar__fill {
      width: 100%;
    }

    /* Applied EXT-NARR-001: CRESCENDO 5-beat Freytag model
       Exposition(sparse) → Rising(medium) → Climax(peak) → Falling(settling) → Resolution(exhale) */
    .arc-bar--1 .arc-bar__fill { height: 10px; background: var(--color-border); }
    .arc-bar--2 .arc-bar__fill { height: 18px; background: var(--color-border); }
    .arc-bar--3 .arc-bar__fill { height: 30px; background: var(--color-text-secondary); }
    .arc-bar--4 .arc-bar__fill { height: 45px; background: var(--color-text-secondary); }
    .arc-bar--5 .arc-bar__fill { height: 60px; background: var(--color-text-secondary); }
    .arc-bar--6 .arc-bar__fill { height: 80px; background: var(--color-primary); }
    .arc-bar--7 .arc-bar__fill { height: 95px; background: var(--color-primary); }
    .arc-bar--8 .arc-bar__fill { height: 70px; background: var(--color-text-secondary); }
    .arc-bar--9 .arc-bar__fill { height: 45px; background: var(--color-border); }
    .arc-bar--10 .arc-bar__fill { height: 25px; background: var(--color-border); }

    .arc-labels {
      display: flex;
      justify-content: space-between;
      margin-top: var(--space-3);
      font-family: var(--font-mono);
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--color-text-secondary);
    }

    .arc-annotation {
      margin-top: var(--space-4);
      padding-top: var(--space-3);
      border-top: 1px solid var(--color-border-subtle); /* Cat 2: data separator */
      font-size: var(--type-meta);
      color: var(--color-text-secondary);
      line-height: 1.6;
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       NARRATIVE ACTS — The core organizational pattern
       Applied EXT-NARR-004: Micro/macro pacing — whitespace as visual punctuation
       Applied EXT-NARR-005: Typography reduction as density signal (validated)
       Applied EXT-NARR-011: Dual-pacing — within-act and across-act rhythm
       Applying R1-001 (Density Rhythm): setup=sparse → conflict=medium → resolution=dense
       Applying R1-003 (Viewport Principle): each narrative beat ≈ one viewport
       Applying DD-F-002 (CRESCENDO): genuine progressive density increase
       OD-F-005: Narrative arc IS CRESCENDO — organization IS density
       ═══════════════════════════════════════════════════════════════════════════ */

    /* ACT HEADER — dramatic chapter markers */
    .act-header {
      margin-top: var(--space-20);
      margin-bottom: var(--space-8);
    }

    .act-header__number {
      font-family: var(--font-mono);
      font-size: var(--type-meta);
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--color-text-secondary);
      margin-bottom: var(--space-1);
    }

    .act-header__title {
      font-family: var(--font-display);
      font-style: italic;
      padding-bottom: var(--space-3);
      border-bottom: 3px solid var(--color-primary); /* Cat 1: structural */
    }

    /* Applied EXT-NARR-005: Typography cascade — headings SHRINK as density increases
       Minimum 4px differential per act for perceptible reduction */
    .act-header--setup .act-header__title { font-size: var(--type-page); }       /* 40px — spacious entry */
    .act-header--rising .act-header__title { font-size: var(--type-section); }    /* 26px — tighter */
    .act-header--climax .act-header__title { font-size: var(--type-subsection); } /* 22px — compressed */
    .act-header--falling .act-header__title { font-size: var(--type-body); font-weight: 600; } /* 16px — settled */
    .act-header--resolution .act-header__title { font-size: var(--type-body); }   /* 16px — exhale */

    /* NARRATIVE BEAT — a section within an act */
    /* Applied EXT-NARR-011: Micro-pacing within acts — sparse intro, dense body, sparse bridge */
    .narrative-beat {
      margin-bottom: var(--space-10);
    }

    .narrative-beat__subtitle {
      font-family: var(--font-body);
      font-size: var(--type-meta);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--color-text-secondary);
      margin-bottom: var(--space-3);
    }

    .narrative-beat p {
      max-width: 65ch;
      margin-bottom: var(--space-4);
    }

    /* DENSITY PROGRESSION — spacing decreases as acts progress (CRESCENDO)
       Applied EXT-NARR-001: Freytag 5-beat model — exposition, rising, climax, falling, resolution
       OD-F-009: Narrative arc creates CRESCENDO naturally */

    /* Act I: Exposition — SPARSE (generous breathing room, wide column feel) */
    .act--setup .narrative-beat {
      margin-bottom: var(--space-16);
    }
    .act--setup .narrative-beat p {
      font-size: 17px;
      line-height: 1.85;
    }

    /* Act II: Rising Action — MEDIUM (tighter, code enters progressively) */
    /* Applied EXT-NARR-003: Code enters gradually — pseudocode hints → partial → full */
    .act--rising .narrative-beat {
      margin-bottom: var(--space-10);
    }
    .act--rising .narrative-beat p {
      font-size: 15px;
      line-height: 1.7;
    }

    /* Act III: Climax — DENSE (packed, code-heavy, rapid) */
    .act--climax .narrative-beat {
      margin-bottom: var(--space-6);
    }
    .act--climax .narrative-beat p {
      font-size: 14px;
      line-height: 1.6;
    }

    /* Act IV: Falling Action — SETTLING (accumulated, cognitive decompression) */
    /* Applied EXT-NARR-001: Deliberate falling action — not the end, a wind-down */
    .act--falling .narrative-beat {
      margin-bottom: var(--space-8);
    }
    .act--falling .narrative-beat p {
      font-size: 14px;
      line-height: 1.7;
    }

    /* Act V: Resolution — SPARSE EXHALE (reflection, what was learned) */
    .act--resolution .narrative-beat {
      margin-bottom: var(--space-10);
    }
    .act--resolution .narrative-beat p {
      font-size: 15px;
      line-height: 1.8;
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       CALLOUT SYSTEM — Soul Piece 3: Callout Family DNA
       2-zone structure (label + body), 4px left border
       Applying R1-007 (Callout Positioning): after content
       Applying R1-008 (Callout Scarcity): max 2 per section
       ═══════════════════════════════════════════════════════════════════════════ */
    .callout {
      margin: var(--space-6) 0;
      border-left: var(--border-left-width) solid;
      padding: var(--space-4) var(--space-5);
    }

    .callout__label {
      font-family: var(--font-mono);
      font-size: var(--type-meta);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--color-text);
      margin-bottom: var(--space-2);
    }

    .callout__body {
      font-size: 14px;
      line-height: 1.6;
    }

    .callout--info {
      border-left-color: var(--accent-blue);
      background: rgba(74, 144, 217, 0.05);
    }

    .callout--tip {
      border-left-color: var(--accent-green);
      background: rgba(74, 157, 107, 0.05);
    }

    .callout--gotcha {
      border-left-color: var(--accent-coral);
      background: rgba(201, 112, 101, 0.05);
    }

    .callout--essence {
      border-left-color: var(--accent-purple);
      background: rgba(124, 58, 237, 0.04);
    }
    /* Soul Piece 2: Serif for Wisdom — Essence uses serif italic */
    .callout--essence .callout__body {
      font-family: var(--font-display);
      font-style: italic;
      font-size: 16px;
      line-height: 1.6;
    }

    .callout--challenge {
      border-left-color: var(--accent-amber);
      background: rgba(217, 119, 6, 0.05);
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       CODE BLOCK — Dense zone, dark theme per Convention Spec Section 3
       Applied EXT-NARR-003: Code appears progressively (Act II partial → Act III full)
       Applying R1-017 (Monospace Differentiation): code at conflict/resolution only
       ═══════════════════════════════════════════════════════════════════════════ */
    .code-block {
      background: var(--color-text); /* #1A1A1A per convention spec */
      font-family: var(--font-mono);
      font-size: var(--type-code);
      line-height: 1.5;
      color: #FAFAF5;
      padding: var(--space-6) var(--space-8);
      margin: var(--space-4) 0;
      overflow-x: auto;
      position: relative;
      border: 3px solid var(--color-border); /* Cat 1: structural frame per convention */
    }

    .code-block__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-3);
      padding-bottom: var(--space-2);
      border-bottom: 1px solid #333; /* Cat 2: data separator within code */
    }

    .code-block__lang {
      font-size: var(--type-meta);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #888;
    }

    .code-block__copy {
      font-size: var(--type-meta);
      cursor: pointer;
      background: none;
      border: 1px solid #444; /* Cat 3: micro-element */
      padding: 2px 8px;
      color: #888;
      font-family: var(--font-mono);
    }

    .code-block__line {
      display: flex;
      gap: var(--space-3);
    }

    .code-block__num {
      color: #555;
      user-select: none;
      min-width: 24px;
      text-align: right;
    }

    /* Syntax highlighting per Convention Spec */
    .code--comment { color: var(--color-text-secondary); } /* #666666 */
    .code--keyword { color: var(--color-primary); }         /* #E83025 */
    .code--string { color: #6B9B7A; }                       /* sage green */
    .code--function { color: #4A7C9B; }                     /* muted blue */
    .code--type { color: #C97065; }                         /* coral */
    .code--variable { color: #E0D5C5; }                     /* warm tan */
    .code--number { color: #D97706; }                       /* amber */

    /* ═══════════════════════════════════════════════════════════════════════════
       DECISION MATRIX — Dense climax component
       Applied EXT-NARR-010: Visual scoring with locked palette colors
       OD-F-013: Decision matrices as natural climax — payoff of narrative
       ═══════════════════════════════════════════════════════════════════════════ */
    .decision-matrix {
      margin: var(--space-6) 0;
      overflow-x: auto;
    }

    .decision-matrix table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    .decision-matrix th {
      font-family: var(--font-mono);
      font-size: var(--type-meta);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--color-text-secondary);
      padding: var(--space-2) var(--space-3);
      border-bottom: 3px solid var(--color-primary); /* Cat 1: structural header */
      text-align: left;
    }

    .decision-matrix td {
      padding: var(--space-2) var(--space-3);
      border-bottom: 1px solid var(--color-border-subtle); /* Cat 2: data separator */
      vertical-align: top;
    }

    .decision-matrix tr:hover td {
      background: var(--color-border-subtle);
    }

    /* Applied EXT-NARR-010: Highlighted row with 4px left accent */
    .decision-matrix__highlight td {
      background: rgba(232, 48, 37, 0.04);
      font-weight: 500;
    }
    .decision-matrix__highlight td:first-child {
      border-left: var(--border-left-width) solid var(--color-primary);
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       FILE TREE — dense visualization for resolution
       ═══════════════════════════════════════════════════════════════════════════ */
    .file-tree {
      font-family: var(--font-mono);
      font-size: 13px;
      line-height: 1.8;
      background: var(--color-zone-dense);
      border-left: var(--border-left-width) solid var(--color-border);
      padding: var(--space-4) var(--space-5);
      margin: var(--space-4) 0;
    }

    .file-tree__label {
      font-size: var(--type-meta);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--color-text-secondary);
      margin-bottom: var(--space-2);
      display: block;
    }

    .file-tree__item--highlight {
      color: var(--color-primary);
      font-weight: 500;
    }

    .file-tree__annotation {
      color: var(--color-text-secondary);
      font-size: 11px;
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       ESSENCE PULL QUOTE — Magazine technique (R1-018)
       Applied EXT-NARR-006: Pull quotes at ACT TRANSITIONS as editorial device
       Soul Piece 2: Serif italic for wisdom
       Used as ACT BREAK between narrative sections
       ═══════════════════════════════════════════════════════════════════════════ */
    .essence-pullquote {
      margin: var(--space-16) 0;
      padding: var(--space-8) 0;
      border-top: 3px solid var(--accent-purple); /* Cat 1: structural */
      border-bottom: 3px solid var(--accent-purple);
      text-align: center;
    }

    .essence-pullquote__label {
      font-family: var(--font-mono);
      font-size: var(--type-meta);
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--accent-purple);
      margin-bottom: var(--space-3);
    }

    .essence-pullquote__text {
      font-family: var(--font-display);
      font-size: var(--type-section);
      font-style: italic;
      line-height: 1.5;
      max-width: 50ch;
      margin: 0 auto;
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       TENSION METER — Narrative wayfinding device
       Applied EXT-NARR-007: Shows act position, not just scroll percentage
       OD-F-011: Compact visual progress without consuming content space
       Soul Piece 5: Square/rectangular markers (no radius)
       ═══════════════════════════════════════════════════════════════════════════ */
    .tension-meter {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      margin-bottom: var(--space-4);
    }

    .tension-meter__label {
      font-family: var(--font-mono);
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--color-text-secondary);
      width: 60px;
      flex-shrink: 0;
    }

    .tension-meter__bar {
      height: 3px;
      background: var(--color-border);
      width: 200px;
    }

    .tension-meter__fill {
      height: 100%;
      background: var(--color-primary);
    }

    /* Applied EXT-NARR-007: Tension meter maps to Freytag 5-beat model */
    .tension-meter__bar--setup .tension-meter__fill { width: 10%; }
    .tension-meter__bar--rising .tension-meter__fill { width: 45%; }
    .tension-meter__bar--climax .tension-meter__fill { width: 95%; }
    .tension-meter__bar--falling .tension-meter__fill { width: 55%; }
    .tension-meter__bar--resolution .tension-meter__fill { width: 15%; }

    /* ═══════════════════════════════════════════════════════════════════════════
       ACT DIVIDER — Mode-transition breathing zone
       OD-F-007: 48px+ spacing between act transitions
       Applied EXT-NARR-004: Whitespace as visual punctuation between acts
       ═══════════════════════════════════════════════════════════════════════════ */
    .act-divider {
      height: var(--space-12);
      background: var(--color-zone-breathing);
      margin: var(--space-12) 0;
      border-top: 3px solid var(--color-border); /* Cat 1: structural */
      border-bottom: 3px solid var(--color-border);
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       PROGRESSIVE DISCLOSURE SIGNAL — Act II code progression
       Applied EXT-NARR-009: Progressive disclosure = narrative arc
       Applied EXT-NARR-003: Gradual code reveal — config → partial → full
       ═══════════════════════════════════════════════════════════════════════════ */
    .code-progression {
      margin: var(--space-4) 0;
      padding: var(--space-3) var(--space-4);
      background: var(--color-zone-breathing);
      border-left: var(--border-left-width) solid var(--color-border);
      font-family: var(--font-mono);
      font-size: var(--type-meta);
      color: var(--color-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       NARRATIVE SUMMARY — closing resolution
       ═══════════════════════════════════════════════════════════════════════════ */
    .narrative-summary {
      margin-top: var(--space-16);
      padding: var(--space-6);
      background: var(--color-zone-dense);
      border-left: var(--border-left-width) solid var(--color-primary);
    }

    .narrative-summary__title {
      font-family: var(--font-mono);
      font-size: var(--type-meta);
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--color-text-secondary);
      margin-bottom: var(--space-4);
    }

    .narrative-summary__list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: var(--space-3);
    }

    .narrative-summary__item {
      display: flex;
      align-items: flex-start;
      gap: var(--space-3);
      font-size: 14px;
    }

    /* Soul Piece 5: Squares Signal System */
    .narrative-summary__marker {
      width: 8px;
      height: 8px;
      background: var(--color-primary);
      flex-shrink: 0;
      margin-top: 6px;
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       RESPONSIVE
       ═══════════════════════════════════════════════════════════════════════════ */
    @media (max-width: 768px) {
      .arc-diagram { height: 80px; }
      .exploration-meta {
        flex-direction: column;
        gap: var(--space-2);
      }
      .tension-meter__bar { width: 120px !important; }
      .exploration-header {
        padding: var(--space-8) var(--space-4);
      }
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       PRINT STYLES (LOW fix #16)
       ═══════════════════════════════════════════════════════════════════════════ */
    @media print {
      body { background: white; color: black; }
      .skip-link, .scroll-witness, nav { display: none; }
      .exploration-header { background: white; color: black; }
      .exploration-title { color: black; }
      a[href]::after { content: " (" attr(href) ")"; font-size: 0.8em; }
      * { box-shadow: none !important; }
    }

    /* ═══════════════════════════════════════════════════════════════════════════
       ACCESSIBILITY — prefers-reduced-motion (MEDIUM fix #10)
       ═══════════════════════════════════════════════════════════════════════════ */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
    }
  </style>
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <!-- ═══════════════════════════════════════════════════════════════════════════
       EXPLORATION HEADER — Full-bleed dark, per Convention Spec Section 4
       Applied EXT-NARR-008: Layout pillar — dark header anchors the page
       PAGE SCALE sparse zone (DD-F-006 fractal)
       ═══════════════════════════════════════════════════════════════════════════ -->
  <header class="exploration-header">
    <div class="exploration-header__inner">
      <div class="exploration-id">Exploration OD-002 — Density: CRESCENDO</div>
      <h1 class="exploration-title">Narrative Arc Structure</h1>
      <p class="exploration-hypothesis">
        What if documentation was organized as a story? Setup introduces the world,
        rising action builds complexity, the climax confronts the hardest problems,
        and resolution ties everything together. Density increases with the stakes.
      </p>
      <div class="exploration-meta">
        <span>Density: <strong class="exploration-meta__value">CRESCENDO</strong></span>
        <span>Organization: <strong class="exploration-meta__value">Narrative Arc</strong></span>
        <span>DD Sources: <strong class="exploration-meta__value">DD-001, DD-002, DD-006</strong></span>
      </div>
    </div>
  </header>

  <main id="main-content" role="main">
  <div class="page-container">

    <!-- ═══════════════════════════════════════════════════════════════════════
         ARC VISUALIZATION — DD-005 lesson: explain concept visually first
         Applied EXT-NARR-001: Shows 5-beat Freytag model, not just 3-act
         Applied EXT-NARR-008: Imagery pillar — visual diagram strengthens editorial cohesion
         Shows the CRESCENDO density curve as a bar chart
         ═══════════════════════════════════════════════════════════════════════ -->
    <!-- Applied EXT-NARR-001: Freytag 5-beat model visualized -->
    <section class="arc-visualization">
      <div class="arc-visualization__title">Narrative Density Arc — Freytag 5-Beat Model</div>

      <div class="arc-diagram">
        <div class="arc-bar arc-bar--1"><div class="arc-bar__fill"></div></div>
        <div class="arc-bar arc-bar--2"><div class="arc-bar__fill"></div></div>
        <div class="arc-bar arc-bar--3"><div class="arc-bar__fill"></div></div>
        <div class="arc-bar arc-bar--4"><div class="arc-bar__fill"></div></div>
        <div class="arc-bar arc-bar--5"><div class="arc-bar__fill"></div></div>
        <div class="arc-bar arc-bar--6"><div class="arc-bar__fill"></div></div>
        <div class="arc-bar arc-bar--7"><div class="arc-bar__fill"></div></div>
        <div class="arc-bar arc-bar--8"><div class="arc-bar__fill"></div></div>
        <div class="arc-bar arc-bar--9"><div class="arc-bar__fill"></div></div>
        <div class="arc-bar arc-bar--10"><div class="arc-bar__fill"></div></div>
      </div>

      <div class="arc-labels">
        <span>I: Exposition</span>
        <span>II: Rising</span>
        <span>III: Climax</span>
        <span>IV: Falling</span>
        <span>V: Resolution</span>
      </div>

      <div class="arc-annotation">
        <!-- Applied EXT-NARR-009: Progressive disclosure IS narrative arc -->
        <strong>CRESCENDO arc</strong> maps to Freytag's dramatic structure:
        <code>exposition</code> (sparse) through <code>rising action</code> (medium)
        to <code>climax</code> (peak density), then <code>falling action</code>
        (cognitive decompression) and <code>resolution</code> (sparse exhale).
        Progressive disclosure and narrative arc are the same technique viewed from
        UX and literary perspectives.
      </div>
    </section>


    <!-- ═══════════════════════════════════════════════════════════════════════
         ACT I: EXPOSITION — THE WORLD
         SPARSE density. Maximum breathing room. One idea at a time.
         R1-001: setup=sparse. R1-016: largest headings here.
         R1-017: NO code in setup — only prose.
         OD-F-012: Code absence creates anticipation (hermeneutic code)
         Applied EXT-NARR-002: Inciting incident creates narrative pull
         Applied EXT-NARR-003: Strategic withholding — code withheld here
         PAGE SCALE: sparse opening (CRESCENDO start)
         ═══════════════════════════════════════════════════════════════════════ -->
    <div class="act--setup">
      <div class="act-header act-header--setup">
        <div class="act-header__number">Act I</div>
        <h2 class="act-header__title">The Promise</h2>
      </div>

      <div class="tension-meter">
        <span class="tension-meter__label">Tension</span>
        <div class="tension-meter__bar tension-meter__bar--setup">
          <div class="tension-meter__fill"></div>
        </div>
      </div>

      <!-- Applied EXT-NARR-011: Micro-pacing — sparse intro within sparse act -->
      <div class="narrative-beat">
        <!-- Applied EXT-NARR-002: Inciting incident — the reader's problem that creates pull -->
        <p>
          You have a database full of users. You need an API. Not a theoretical one
          from a tutorial — a real one, with authentication, validation, error handling,
          and the kind of edge cases that wake you up at 3 AM.
        </p>

        <p>
          This is the story of building that API. It starts simple and gets complicated,
          because that is how real software works. The easy part is the beginning.
        </p>
      </div>

      <!-- Applied EXT-NARR-011: Micro-pacing — denser second beat within sparse act -->
      <div class="narrative-beat">
        <h3 class="narrative-beat__subtitle">The Starting Point</h3>
        <p>
          Every API begins with a question: what does the outside world need from your
          system? Not what your database can do — what your users actually need.
          The answer shapes everything that follows.
        </p>

        <p>
          For a user management API, the answer is deceptively simple: create users,
          read users, update users, delete users. Four verbs. Four endpoints.
          The simplicity is the trap.
        </p>
      </div>

      <!-- R1-007: Callout follows content it references -->
      <!-- Applied EXT-NARR-003: Foreshadowing — poses question that Act III answers -->
      <div class="callout callout--essence">
        <div class="callout__label">Essence</div>
        <div class="callout__body">
          The distance between "four endpoints" and "production-ready API" is where
          every junior developer becomes a senior one.
        </div>
      </div>
    </div>


    <!-- ═══════════════════════════════════════════════════════════════════════
         ESSENCE PULL QUOTE — Act break between Exposition and Rising Action
         Applied EXT-NARR-006: Pull quote at ACT TRANSITION as editorial device
         PAGE SCALE: sparse breathing zone (R1-018)
         OD-F-007: 48px+ mode-transition breathing zone
         ═══════════════════════════════════════════════════════════════════════ -->
    <div class="essence-pullquote">
      <div class="essence-pullquote__label">Essence</div>
      <p class="essence-pullquote__text">
        Every API tells a story. The first chapter is always easy to write.
        The hard part is what happens when real users arrive.
      </p>
    </div>


    <!-- ═══════════════════════════════════════════════════════════════════════
         ACT II: RISING ACTION — COMPLEXITY BUILDS
         MEDIUM density. Tighter spacing. Code enters for the first time.
         R1-001: conflict=medium. R1-017: code ENTERS here.
         R1-016: headings smaller than Act I.
         Applied EXT-NARR-003: Code progressive disclosure — first appearance here
         Applied EXT-NARR-009: Each act discloses more complexity (progressive disclosure)
         PAGE SCALE: medium density (CRESCENDO middle)
         ═══════════════════════════════════════════════════════════════════════ -->
    <div class="act--rising">
      <div class="act-header act-header--rising">
        <div class="act-header__number">Act II</div>
        <h2 class="act-header__title">The Complications</h2>
      </div>

      <div class="tension-meter">
        <span class="tension-meter__label">Tension</span>
        <div class="tension-meter__bar tension-meter__bar--rising">
          <div class="tension-meter__fill"></div>
        </div>
      </div>

      <!-- Applied EXT-NARR-011: Micro-pacing — sparse intro within medium act -->
      <div class="narrative-beat">
        <h3 class="narrative-beat__subtitle">First Contact With Reality</h3>
        <p>
          The basic route structure seems straightforward. Express gives you a router,
          you define your endpoints, you connect to the database. Twenty lines of code
          and you have a working API. This is where tutorials end and reality begins.
        </p>

        <!-- Applied EXT-NARR-003: First code reveal — the naive version (partial disclosure) -->
        <!-- R1-017: First code appearance in Rising Action, NOT Setup -->
        <div class="code-progression">Disclosure Level: Naive Implementation</div>
        <div class="code-block">
          <div class="code-block__header">
            <span class="code-block__lang">typescript — routes/users.ts</span>
            <button class="code-block__copy">Copy</button>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">1</span>
            <span class="code--comment">// The naive version — what tutorials show you</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">2</span>
            <span><span class="code--keyword">router</span>.<span class="code--function">get</span>(<span class="code--string">'/users/:id'</span>, <span class="code--keyword">async</span> (req, res) =&gt; {</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">3</span>
            <span>  <span class="code--keyword">const</span> user = <span class="code--keyword">await</span> <span class="code--function">db.users.findById</span>(req.params.id)</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">4</span>
            <span>  res.<span class="code--function">json</span>(user)</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">5</span>
            <span>})</span>
          </div>
        </div>

        <p>
          Five lines. Clean. Elegant. And completely wrong for production. What happens
          when the ID does not exist? When the database is down? When someone sends
          a string where you expect a UUID? The complications start here.
        </p>
      </div>

      <!-- Applied EXT-NARR-011: Micro-pacing — denser second beat within medium act -->
      <div class="narrative-beat">
        <h3 class="narrative-beat__subtitle">The Validation Problem</h3>
        <p>
          Input validation is the first wall. Every field needs constraints: email format,
          password strength, name length. You can write these checks inline, scatter them
          through your handlers, and create a maintenance nightmare. Or you can centralize
          them with a schema.
        </p>

        <!-- Applied EXT-NARR-003: Second code reveal — schema approach (more disclosure) -->
        <div class="code-progression">Disclosure Level: Schema Approach</div>
        <div class="code-block">
          <div class="code-block__header">
            <span class="code-block__lang">typescript — schemas/user.ts</span>
            <button class="code-block__copy">Copy</button>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">1</span>
            <span class="code--comment">// Centralized validation — the schema approach</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">2</span>
            <span><span class="code--keyword">const</span> <span class="code--variable">CreateUserSchema</span> = z.<span class="code--function">object</span>({</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">3</span>
            <span>  email: z.<span class="code--function">string</span>().<span class="code--function">email</span>(),</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">4</span>
            <span>  name: z.<span class="code--function">string</span>().<span class="code--function">min</span>(<span class="code--number">2</span>).<span class="code--function">max</span>(<span class="code--number">100</span>),</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">5</span>
            <span>  password: z.<span class="code--function">string</span>().<span class="code--function">min</span>(<span class="code--number">8</span>).<span class="code--function">regex</span>(<span class="code--string">/[A-Z]/</span>).<span class="code--function">regex</span>(<span class="code--string">/[0-9]/</span>),</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">6</span>
            <span>})</span>
          </div>
        </div>

        <!-- R1-007: Callout AFTER the code it references -->
        <div class="callout callout--info">
          <div class="callout__label">Info</div>
          <div class="callout__body">
            Zod schemas serve double duty: runtime validation and TypeScript type
            inference. Define the schema once, get both the validator and the type
            with <code>z.infer&lt;typeof CreateUserSchema&gt;</code>.
          </div>
        </div>
      </div>

      <!-- Applied EXT-NARR-011: Micro-pacing — bridge beat, transitional toward climax -->
      <div class="narrative-beat">
        <h3 class="narrative-beat__subtitle">The Error Handling Problem</h3>
        <p>
          Now every handler needs error handling. Not just "something went wrong" —
          structured errors that tell the client exactly what failed and how to fix it.
          404 for missing resources. 422 for validation failures. 401 for unauthorized
          access. Each error is a conversation with the caller.
        </p>

        <p>
          The tension builds: validation, error handling, authentication — each layer
          adds complexity. The simple four-endpoint API now has middleware, schemas,
          error formatters, and authentication guards. And we have not even reached
          the hard part yet.
        </p>
      </div>
    </div>


    <!-- ═══════════════════════════════════════════════════════════════════════
         ESSENCE PULL QUOTE — Act break between Rising Action and Climax
         Applied EXT-NARR-006: Pull quote at ACT TRANSITION — editorial act break
         Summarizes what was learned, foreshadows climax
         OD-F-007: 48px+ mode-transition breathing
         ═══════════════════════════════════════════════════════════════════════ -->
    <div class="essence-pullquote">
      <div class="essence-pullquote__label">Turning Point</div>
      <p class="essence-pullquote__text">
        Complexity does not arrive all at once. It accumulates,
        layer by layer, until the simple thing you started with
        is unrecognizable.
      </p>
    </div>


    <!-- ═══════════════════════════════════════════════════════════════════════
         ACT III: CLIMAX — THE HARDEST PROBLEMS
         DENSE density. Tight spacing. Code-heavy. Multiple components per viewport.
         R1-001: resolution=dense. R1-016: smallest headings.
         R1-017: maximum code density.
         Applied EXT-NARR-003: Full code reveal — complete implementations
         Applied EXT-NARR-010: Decision matrix at climax as narrative payoff
         PAGE SCALE: dense peak (CRESCENDO climax)
         ═══════════════════════════════════════════════════════════════════════ -->
    <div class="act--climax">
      <div class="act-header act-header--climax">
        <div class="act-header__number">Act III</div>
        <h2 class="act-header__title">The Battle</h2>
      </div>

      <div class="tension-meter">
        <span class="tension-meter__label">Tension</span>
        <div class="tension-meter__bar tension-meter__bar--climax">
          <div class="tension-meter__fill"></div>
        </div>
      </div>

      <div class="narrative-beat">
        <h3 class="narrative-beat__subtitle">Authentication and Authorization</h3>
        <p>
          Authentication answers "who are you?" Authorization answers "what can you do?"
          Both must be solved, and they must be solved differently. Here is where
          the architecture decisions compound.
        </p>

        <!-- Applied EXT-NARR-003: Full code reveal — complete auth implementation -->
        <div class="code-progression">Disclosure Level: Production Architecture</div>
        <div class="code-block">
          <div class="code-block__header">
            <span class="code-block__lang">typescript — middleware/auth.ts</span>
            <button class="code-block__copy">Copy</button>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">1</span>
            <span class="code--comment">// Authentication middleware — verify identity</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">2</span>
            <span><span class="code--keyword">export const</span> <span class="code--function">authenticate</span> = <span class="code--keyword">async</span> (req, res, next) =&gt; {</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">3</span>
            <span>  <span class="code--keyword">const</span> token = req.headers.authorization?.<span class="code--function">replace</span>(<span class="code--string">'Bearer '</span>, <span class="code--string">''</span>)</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">4</span>
            <span>  <span class="code--keyword">if</span> (!token) <span class="code--keyword">throw new</span> <span class="code--type">AuthError</span>(<span class="code--string">'No token provided'</span>)</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">5</span>
            <span></span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">6</span>
            <span>  <span class="code--keyword">const</span> payload = <span class="code--keyword">await</span> <span class="code--function">verifyJWT</span>(token)</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">7</span>
            <span>  req.user = <span class="code--keyword">await</span> <span class="code--function">db.users.findById</span>(payload.sub)</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">8</span>
            <span>  <span class="code--keyword">if</span> (!req.user) <span class="code--keyword">throw new</span> <span class="code--type">AuthError</span>(<span class="code--string">'User not found'</span>)</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">9</span>
            <span>  <span class="code--function">next</span>()</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">10</span>
            <span>}</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">11</span>
            <span></span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">12</span>
            <span class="code--comment">// Authorization — verify permissions</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">13</span>
            <span><span class="code--keyword">export const</span> <span class="code--function">authorize</span> = (...roles: <span class="code--type">Role</span>[]) =&gt; (req, res, next) =&gt; {</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">14</span>
            <span>  <span class="code--keyword">if</span> (!roles.<span class="code--function">includes</span>(req.user.role))</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">15</span>
            <span>    <span class="code--keyword">throw new</span> <span class="code--type">ForbiddenError</span>(<span class="code--string">'Insufficient permissions'</span>)</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">16</span>
            <span>  <span class="code--function">next</span>()</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">17</span>
            <span>}</span>
          </div>
        </div>

        <!-- R1-008: Max 1 callout in this dense section -->
        <div class="callout callout--gotcha">
          <div class="callout__label">Gotcha</div>
          <div class="callout__body">
            Never store JWTs in localStorage — they are accessible to any script
            on the page (XSS vulnerable). Use httpOnly cookies with the Secure flag.
            The token should be invisible to JavaScript entirely.
          </div>
        </div>
      </div>

      <div class="narrative-beat">
        <h3 class="narrative-beat__subtitle">The Race Condition</h3>
        <p>
          Two requests arrive simultaneously: both try to update the same user's
          email. Without concurrency control, the last write wins — silently
          overwriting the first. This is the moment where naive implementations
          break in production.
        </p>

        <div class="code-block">
          <div class="code-block__header">
            <span class="code-block__lang">typescript — services/user.ts</span>
            <button class="code-block__copy">Copy</button>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">1</span>
            <span class="code--comment">// Optimistic locking — prevent silent overwrites</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">2</span>
            <span><span class="code--keyword">async function</span> <span class="code--function">updateUser</span>(id: <span class="code--type">string</span>, data: <span class="code--type">UpdateInput</span>, version: <span class="code--number">number</span>) {</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">3</span>
            <span>  <span class="code--keyword">const</span> result = <span class="code--keyword">await</span> db.<span class="code--function">execute</span>(<span class="code--string">`</span></span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">4</span>
            <span>    <span class="code--string">UPDATE users SET email = $1, version = version + 1</span></span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">5</span>
            <span>    <span class="code--string">WHERE id = $2 AND version = $3`</span>,</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">6</span>
            <span>    [data.email, id, version]</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">7</span>
            <span>  )</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">8</span>
            <span>  <span class="code--keyword">if</span> (result.rowCount === <span class="code--number">0</span>)</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">9</span>
            <span>    <span class="code--keyword">throw new</span> <span class="code--type">ConflictError</span>(<span class="code--string">'Resource was modified by another request'</span>)</span>
          </div>
          <div class="code-block__line">
            <span class="code-block__num">10</span>
            <span>}</span>
          </div>
        </div>

        <p>
          The version column acts as a guard. If someone else modified the row since
          you read it, the WHERE clause finds zero rows, and you get a clean 409 Conflict
          instead of corrupted data.
        </p>
      </div>

      <!-- Applied EXT-NARR-010: Decision matrix at climax — narrative payoff
           OD-F-013: Decision matrices as natural climax component -->
      <div class="narrative-beat">
        <h3 class="narrative-beat__subtitle">The Full Picture — Everything Combined</h3>
        <p>
          Here is what the naive five-line handler looks like after surviving
          reality: validation, authentication, authorization, error handling,
          and concurrency control all woven together.
        </p>

        <!-- Applied EXT-NARR-010: Visual scoring with locked palette colors -->
        <div class="decision-matrix">
          <table>
            <thead>
              <tr>
                <th>Layer</th>
                <th>Tutorial Version</th>
                <th>Production Version</th>
                <th>Complexity</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Validation</td>
                <td>None</td>
                <td>Zod schema + middleware</td>
                <td style="color: var(--accent-green);">Moderate</td>
              </tr>
              <tr>
                <td>Auth</td>
                <td>None</td>
                <td>JWT + role-based guards</td>
                <td style="color: var(--accent-amber);">High</td>
              </tr>
              <tr>
                <td>Error Handling</td>
                <td>try/catch with 500</td>
                <td>Typed errors + status codes</td>
                <td style="color: var(--accent-green);">Moderate</td>
              </tr>
              <tr>
                <td>Concurrency</td>
                <td>None (last write wins)</td>
                <td>Optimistic locking</td>
                <td style="color: var(--accent-coral);">Critical</td>
              </tr>
              <tr class="decision-matrix__highlight">
                <td>Lines of Code</td>
                <td>5</td>
                <td>~150 across 6 files</td>
                <td style="color: var(--color-primary); font-weight: 600;">30x increase</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>


    <!-- ═══════════════════════════════════════════════════════════════════════
         ESSENCE PULL QUOTE — Act break between Climax and Falling Action
         Applied EXT-NARR-006: Pull quote at ACT TRANSITION
         OD-F-007: 48px+ mode-transition breathing
         ═══════════════════════════════════════════════════════════════════════ -->
    <div class="essence-pullquote">
      <div class="essence-pullquote__label">Essence</div>
      <p class="essence-pullquote__text">
        The battle is over. What remains is not the code
        but the architecture it revealed.
      </p>
    </div>


    <!-- ═══════════════════════════════════════════════════════════════════════
         ACT IV: FALLING ACTION — THE ARCHITECTURE EMERGES
         Applied EXT-NARR-001: Freytag falling action — deliberate wind-down
         SETTLING density. Cognitive decompression. Structure over code.
         PAGE SCALE: settling density (CRESCENDO falling action)
         ═══════════════════════════════════════════════════════════════════════ -->
    <div class="act--falling">
      <div class="act-header act-header--falling">
        <div class="act-header__number">Act IV</div>
        <h2 class="act-header__title">The Architecture</h2>
      </div>

      <div class="tension-meter">
        <span class="tension-meter__label">Tension</span>
        <div class="tension-meter__bar tension-meter__bar--falling">
          <div class="tension-meter__fill"></div>
        </div>
      </div>

      <div class="narrative-beat">
        <h3 class="narrative-beat__subtitle">The Final Shape</h3>
        <p>
          After the battle, the dust settles. The four simple endpoints are still there,
          but now they sit inside a layered architecture that handles the real world.
          Here is what the final project looks like.
        </p>

        <div class="file-tree">
          <span class="file-tree__label">Project Architecture</span>
          src/<br>
          ├── <span class="file-tree__item--highlight">routes/</span> <span class="file-tree__annotation">← Thin handlers, delegates to services</span><br>
          │&nbsp;&nbsp; ├── users.ts <span class="file-tree__annotation">← CRUD endpoints</span><br>
          │&nbsp;&nbsp; └── auth.ts <span class="file-tree__annotation">← Login, register, refresh</span><br>
          ├── <span class="file-tree__item--highlight">services/</span> <span class="file-tree__annotation">← Business logic, transactions</span><br>
          │&nbsp;&nbsp; └── user.service.ts <span class="file-tree__annotation">← Create, update, delete (with locking)</span><br>
          ├── <span class="file-tree__item--highlight">middleware/</span> <span class="file-tree__annotation">← Cross-cutting concerns</span><br>
          │&nbsp;&nbsp; ├── auth.ts <span class="file-tree__annotation">← authenticate + authorize</span><br>
          │&nbsp;&nbsp; ├── validate.ts <span class="file-tree__annotation">← Schema validation</span><br>
          │&nbsp;&nbsp; └── errors.ts <span class="file-tree__annotation">← Centralized error handler</span><br>
          ├── <span class="file-tree__item--highlight">schemas/</span> <span class="file-tree__annotation">← Zod schemas (validation + types)</span><br>
          │&nbsp;&nbsp; └── user.ts <span class="file-tree__annotation">← Create, Update, Query schemas</span><br>
          └── <span class="file-tree__item--highlight">errors/</span> <span class="file-tree__annotation">← Typed error classes</span><br>
          &nbsp;&nbsp;&nbsp;&nbsp;├── auth.error.ts<br>
          &nbsp;&nbsp;&nbsp;&nbsp;├── validation.error.ts<br>
          &nbsp;&nbsp;&nbsp;&nbsp;└── conflict.error.ts
        </div>
      </div>

      <div class="narrative-beat">
        <h3 class="narrative-beat__subtitle">The Lesson</h3>
        <p>
          The naive version was not wrong. It was incomplete. Every layer you added —
          validation, authentication, error handling, concurrency — exists because a
          real user would have encountered a real failure without it.
        </p>

        <p>
          Production readiness is not about adding complexity for its own sake. It is
          about anticipating the ways reality will test your assumptions, and having
          an answer ready for each one.
        </p>

        <!-- R1-007: Final callout — challenge positioned after accumulated wisdom -->
        <div class="callout callout--challenge">
          <div class="callout__label">Challenge</div>
          <div class="callout__body">
            Take an existing API endpoint in your codebase. Walk through the narrative
            arc: what is its "tutorial version"? What complications has it absorbed?
            What layers are still missing?
          </div>
        </div>
      </div>
    </div>


    <!-- ═══════════════════════════════════════════════════════════════════════
         ACT V: RESOLUTION — THE REFLECTION
         Applied EXT-NARR-001: Freytag resolution — cognitive exhale, not just summary
         Applied EXT-NARR-002: Satisfying resolution prevents frustrated exit
         SPARSE EXHALE density. Breathing room. Reflection over action.
         PAGE SCALE: sparse exhale (CRESCENDO denouement)
         ═══════════════════════════════════════════════════════════════════════ -->
    <div class="act--resolution">
      <div class="act-header act-header--resolution">
        <div class="act-header__number">Act V</div>
        <h2 class="act-header__title">The Reflection</h2>
      </div>

      <div class="tension-meter">
        <span class="tension-meter__label">Tension</span>
        <div class="tension-meter__bar tension-meter__bar--resolution">
          <div class="tension-meter__fill"></div>
        </div>
      </div>

      <!-- Applied EXT-NARR-001: Denouement — cognitive exhale after dense climax -->
      <div class="narrative-beat">
        <p>
          The narrative arc of building an API mirrors every complex system.
          Simple beginnings create false confidence. Real requirements
          reveal hidden complexity. And the architecture that emerges from
          confronting that complexity is always more interesting than the
          architecture you would have designed from scratch.
        </p>

        <p>
          That is the deepest lesson of story-driven documentation: the
          journey from naive to production-ready is itself the most
          valuable thing to document. Not the final code — the path that
          led to it.
        </p>
      </div>
    </div>


    <!-- ═══════════════════════════════════════════════════════════════════════
         NARRATIVE SUMMARY — resolution closing
         PAGE SCALE: settled, accumulated density
         ═══════════════════════════════════════════════════════════════════════ -->
    <section class="narrative-summary">
      <div class="narrative-summary__title">The Story So Far</div>
      <ul class="narrative-summary__list">
        <li class="narrative-summary__item">
          <div class="narrative-summary__marker"></div>
          <span>APIs start as four verbs but become layered architectures under production pressure</span>
        </li>
        <li class="narrative-summary__item">
          <div class="narrative-summary__marker"></div>
          <span>Validation, authentication, and error handling are not optional — they are the real API</span>
        </li>
        <li class="narrative-summary__item">
          <div class="narrative-summary__marker"></div>
          <span>Concurrency control prevents the silent data corruption that tutorials never show</span>
        </li>
        <li class="narrative-summary__item">
          <div class="narrative-summary__marker"></div>
          <span>The narrative arc mirrors real development: simple beginning, complex middle, architectural resolution</span>
        </li>
        <li class="narrative-summary__item">
          <div class="narrative-summary__marker"></div>
          <span>Each layer of complexity exists because a real failure demanded it</span>
        </li>
        <li class="narrative-summary__item">
          <div class="narrative-summary__marker"></div>
          <span>Progressive disclosure and narrative arc are the same technique — the natural form of progressive learning</span>
        </li>
      </ul>
    </section>

  </div>
  </main>

</body>
</html>
