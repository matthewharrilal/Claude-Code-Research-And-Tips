<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ralph - Enhanced Gallery (v2)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* ========================================
       DESIGN TOKENS (8px Grid System)
       ======================================== */
    :root {
      /* Colors - Dark theme with restrained palette */
      --bg-base: #0f1210;
      --bg-elevated: #171c18;
      --bg-surface: #1e241f;
      --bg-highlight: #252b26;

      --text-primary: #e8e6e3;
      --text-secondary: #9d9b98;
      --text-muted: #6b6966;

      --accent-primary: #4ade80;
      --accent-muted: #22c55e;
      --accent-glow: rgba(74, 222, 128, 0.15);

      --border-subtle: #2a302b;
      --border-active: #3d4a3f;

      /* Spacing (8px scale) */
      --space-1: 8px;
      --space-2: 16px;
      --space-3: 24px;
      --space-4: 32px;
      --space-5: 40px;
      --space-6: 48px;

      /* Typography */
      --font-sans: 'Space Grotesk', system-ui, sans-serif;
      --font-mono: 'Geist Mono', 'SF Mono', Monaco, monospace;

      --text-xs: 0.75rem;
      --text-sm: 0.8125rem;
      --text-base: 1rem;
      --text-lg: 1.125rem;
      --text-xl: 1.25rem;
      --text-2xl: 1.5rem;
      --text-3xl: 2rem;

      /* Premium shadows (5-layer system, doubling progression) */
      --shadow-sm:
        0 1px 1px rgba(0,0,0,0.12);
      --shadow-md:
        0 1px 1px rgba(0,0,0,0.12),
        0 2px 2px rgba(0,0,0,0.12),
        0 4px 4px rgba(0,0,0,0.12);
      --shadow-lg:
        0 1px 1px rgba(0,0,0,0.12),
        0 2px 2px rgba(0,0,0,0.12),
        0 4px 4px rgba(0,0,0,0.12),
        0 8px 8px rgba(0,0,0,0.12),
        0 16px 16px rgba(0,0,0,0.12);
      --shadow-glow:
        0 0 0 1px rgba(74, 222, 128, 0.1),
        0 0 20px rgba(74, 222, 128, 0.1);

      /* Transitions */
      --transition-fast: 150ms ease;
      --transition-normal: 250ms ease;
      --transition-slow: 400ms ease;

      /* Border radius */
      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 12px;
    }

    /* ========================================
       BASE STYLES
       ======================================== */
    *, *::before, *::after {
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      margin: 0;
      padding: 0;
      background: var(--bg-base);
      color: var(--text-primary);
      font-family: var(--font-sans);
      font-size: var(--text-base);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }

    /* ========================================
       LAYOUT
       ======================================== */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 var(--space-4);
    }

    /* Navigation */
    .nav-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--space-2) var(--space-4);
      border-bottom: 1px solid var(--border-subtle);
      background: var(--bg-elevated);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .nav-back {
      color: var(--text-secondary);
      text-decoration: none;
      font-size: var(--text-sm);
      display: flex;
      align-items: center;
      gap: var(--space-1);
      transition: color var(--transition-fast);
    }

    .nav-back:hover {
      color: var(--accent-primary);
    }

    .maturity-badge {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 4px 12px;
      border-radius: 999px;
      font-size: var(--text-sm);
      font-weight: 500;
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
    }

    /* ========================================
       HERO ESSENCE (The One-Liner)
       ======================================== */
    .hero-essence {
      background: linear-gradient(180deg, var(--bg-elevated) 0%, var(--bg-base) 100%);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: var(--space-6) var(--space-4);
      margin: var(--space-4) 0;
      text-align: center;
    }

    .hero-code {
      display: inline-flex;
      align-items: center;
      gap: var(--space-3);
      background: var(--bg-base);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      padding: var(--space-3) var(--space-4);
      font-family: var(--font-mono);
      font-size: clamp(1rem, 2.5vw, 1.5rem);
      color: var(--accent-primary);
      margin-bottom: var(--space-3);
      transition: box-shadow var(--transition-normal);
    }

    .hero-code:hover {
      box-shadow: var(--shadow-glow);
    }

    .copy-btn {
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      padding: 6px 12px;
      font-family: var(--font-sans);
      font-size: var(--text-sm);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .copy-btn:hover {
      background: var(--bg-highlight);
      color: var(--accent-primary);
      border-color: var(--accent-primary);
    }

    .copy-btn.copied {
      background: var(--accent-primary);
      color: var(--bg-base);
      border-color: var(--accent-primary);
    }

    .hero-caption {
      color: var(--text-muted);
      font-size: var(--text-base);
      font-style: italic;
    }

    /* ========================================
       VARIANT TABS
       ======================================== */
    .variant-tabs {
      display: flex;
      gap: 2px;
      background: var(--bg-elevated);
      border-radius: var(--radius-md);
      padding: 4px;
      margin: var(--space-3) 0;
    }

    .variant-tab {
      flex: 1;
      padding: var(--space-1) var(--space-2);
      background: none;
      border: none;
      border-radius: var(--radius-sm);
      font-family: var(--font-sans);
      font-size: var(--text-sm);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .variant-tab:hover {
      color: var(--text-primary);
    }

    .variant-tab.active {
      background: var(--bg-surface);
      color: var(--accent-primary);
    }

    .variant-content {
      display: none;
    }

    .variant-content.active {
      display: block;
    }

    .variant-code-block {
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      padding: var(--space-3);
      font-family: var(--font-mono);
      font-size: var(--text-sm);
      margin-bottom: var(--space-3);
      position: relative;
      overflow-x: auto;
    }

    .variant-code-block pre {
      margin: 0;
      color: var(--text-primary);
    }

    .variant-code-block .comment {
      color: var(--text-muted);
    }

    .variant-code-block .copy-btn {
      position: absolute;
      top: var(--space-2);
      right: var(--space-2);
    }

    /* ========================================
       TWO-ZONE LAYOUT (Structure + Activity)
       ======================================== */
    .zones-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-3);
      margin: var(--space-4) 0;
    }

    @media (max-width: 900px) {
      .zones-container {
        grid-template-columns: 1fr;
      }
    }

    /* Zone headers */
    .zone-header {
      font-size: var(--text-sm);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      margin-bottom: var(--space-2);
      padding-bottom: var(--space-1);
      display: flex;
      align-items: center;
      gap: var(--space-1);
    }

    .zone-header-structure {
      border-bottom: 2px solid var(--accent-primary);
    }

    .zone-header-activity {
      border-bottom: 2px dashed var(--text-muted);
    }

    /* ========================================
       STRUCTURED ZONE (No Accordions!)
       All content visible, scroll reveals depth
       ======================================== */
    .structured-zone {
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: var(--space-3);
      box-shadow: var(--shadow-md);
    }

    /* Structure sections - all visible by default */
    .structure-section {
      padding: var(--space-2) 0;
      border-bottom: 1px solid var(--border-subtle);
      transition: all var(--transition-normal);
    }

    .structure-section:last-child {
      border-bottom: none;
    }

    /* Brushing: highlight when related activity hovered */
    .structure-section.highlighted {
      background: var(--accent-glow);
      border-radius: var(--radius-sm);
      padding-left: var(--space-2);
      padding-right: var(--space-2);
      margin-left: calc(-1 * var(--space-2));
      margin-right: calc(-1 * var(--space-2));
    }

    .section-title {
      font-size: var(--text-sm);
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: var(--space-1);
      display: flex;
      align-items: center;
      gap: var(--space-1);
    }

    .section-title .icon {
      color: var(--accent-primary);
      font-size: var(--text-xs);
    }

    .section-content {
      font-size: var(--text-sm);
      color: var(--text-secondary);
      line-height: 1.7;
    }

    /* File structure (visible, not hidden in accordion) */
    .file-tree {
      font-family: var(--font-mono);
      font-size: var(--text-xs);
      background: var(--bg-surface);
      border-radius: var(--radius-sm);
      padding: var(--space-2);
      line-height: 1.8;
    }

    .file-tree .dir {
      color: var(--accent-primary);
    }

    .file-tree .file {
      color: var(--text-secondary);
    }

    .file-tree .comment {
      color: var(--text-muted);
      font-style: italic;
    }

    /* Use/Don't use lists */
    .use-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .use-list li {
      padding: 4px 0;
      display: flex;
      align-items: flex-start;
      gap: var(--space-1);
      font-size: var(--text-sm);
    }

    .use-list .yes {
      color: var(--accent-primary);
    }

    .use-list .no {
      color: #ef4444;
    }

    /* Variants grid */
    .variants-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-1);
    }

    .variant-item {
      padding: 6px var(--space-1);
      background: var(--bg-surface);
      border-radius: var(--radius-sm);
      font-size: var(--text-xs);
      cursor: default;
      transition: all var(--transition-fast);
    }

    .variant-item:hover {
      background: var(--bg-highlight);
    }

    .variant-item strong {
      color: var(--text-primary);
    }

    .variant-item span {
      color: var(--text-muted);
    }

    /* ========================================
       SVG DIAGRAM
       ======================================== */
    .diagram-container {
      background: var(--bg-surface);
      border-radius: var(--radius-md);
      padding: var(--space-3);
      margin-bottom: var(--space-2);
    }

    .diagram-svg {
      width: 100%;
      height: auto;
    }

    /* ========================================
       ACTIVITY ZONE (Fluid, Living Content)
       ======================================== */
    .fluid-zone {
      border: 1px dashed var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: var(--space-3);
      background: var(--bg-base);
    }

    .activity-feed {
      display: flex;
      flex-direction: column;
      gap: var(--space-2);
    }

    .activity-item {
      padding: var(--space-2);
      border-radius: var(--radius-md);
      transition: all var(--transition-normal);
      cursor: default;
    }

    /* Brushing: highlight when hovered */
    .activity-item:hover,
    .activity-item.highlighted {
      background: var(--bg-elevated);
      box-shadow: var(--shadow-sm);
    }

    .activity-header {
      display: flex;
      align-items: center;
      gap: var(--space-1);
      margin-bottom: 4px;
    }

    .activity-icon {
      font-size: var(--text-base);
    }

    .activity-type {
      font-size: var(--text-xs);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
    }

    .activity-content {
      font-size: var(--text-sm);
      color: var(--text-secondary);
      line-height: 1.6;
    }

    .activity-content strong {
      color: var(--text-primary);
    }

    .activity-content em {
      color: var(--accent-primary);
      font-style: normal;
    }

    .activity-meta {
      margin-top: 4px;
      font-size: var(--text-xs);
      color: var(--text-muted);
    }

    /* Connection line indicator (shown on hover) */
    .connection-indicator {
      display: none;
      position: absolute;
      width: 2px;
      background: var(--accent-primary);
      opacity: 0.3;
    }

    /* ========================================
       CONNECTIONS FOOTER
       ======================================== */
    .connections-footer {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-3);
      background: var(--bg-elevated);
      border-radius: var(--radius-lg);
      margin-top: var(--space-4);
    }

    .connection-group {
      display: flex;
      align-items: center;
      gap: var(--space-1);
    }

    .connection-label {
      font-size: var(--text-sm);
      color: var(--text-muted);
    }

    .connection-tag {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      font-size: var(--text-sm);
      color: var(--text-secondary);
      text-decoration: none;
      transition: all var(--transition-fast);
    }

    .connection-tag:hover {
      border-color: var(--accent-primary);
      color: var(--accent-primary);
      box-shadow: var(--shadow-glow);
    }

    .connection-tag.competes {
      border-color: #f59e0b;
    }

    .connection-tag.competes:hover {
      color: #f59e0b;
      box-shadow: 0 0 0 1px rgba(245, 158, 11, 0.1), 0 0 20px rgba(245, 158, 11, 0.1);
    }

    /* ========================================
       VERSION INDICATOR
       ======================================== */
    .version-indicator {
      position: fixed;
      bottom: var(--space-2);
      right: var(--space-2);
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      padding: 4px 8px;
      font-size: var(--text-xs);
      color: var(--text-muted);
    }
  </style>
</head>
<body>
  <!-- Version indicator -->
  <div class="version-indicator">v2: Brushing + No Accordions</div>

  <!-- Navigation -->
  <nav class="nav-header">
    <a href="#" class="nav-back">
      <span>&larr;</span> Patterns
    </a>
    <span class="maturity-badge">
      <span>üå≥</span> Evergreen
    </span>
  </nav>

  <main class="container">
    <!-- Hero Essence -->
    <section class="hero-essence">
      <div class="hero-code">
        <code>while :; do cat PROMPT.md | claude ; done</code>
        <button class="copy-btn" onclick="copyCode(this, 'while :; do cat PROMPT.md | claude ; done')">Copy</button>
      </div>
      <p class="hero-caption">The one-liner. Everything else is scaffolding.</p>
    </section>

    <!-- Variant Tabs -->
    <div class="variant-tabs">
      <button class="variant-tab active" onclick="switchVariant('minimal', this)">Minimal</button>
      <button class="variant-tab" onclick="switchVariant('standard', this)">Standard</button>
      <button class="variant-tab" onclick="switchVariant('production', this)">Production</button>
    </div>

    <!-- Variant Content -->
    <div class="variant-content active" id="variant-minimal">
      <div class="variant-code-block">
        <button class="copy-btn" onclick="copyVariant('minimal')">Copy</button>
        <pre><span class="comment"># Minimal: Just the loop</span>
while :; do cat PROMPT.md | claude ; done</pre>
      </div>
    </div>

    <div class="variant-content" id="variant-standard">
      <div class="variant-code-block">
        <button class="copy-btn" onclick="copyVariant('standard')">Copy</button>
        <pre><span class="comment">#!/bin/bash</span>
<span class="comment"># Standard: With iteration limit and completion detection</span>

MAX_ITERATIONS=${1:-10}

for i in $(seq 1 $MAX_ITERATIONS); do
  echo "=== Iteration $i ==="
  OUTPUT=$(cat PROMPT.md | claude 2>&amp;1 | tee /dev/stderr) || true

  if echo "$OUTPUT" | grep -q "&lt;promise&gt;COMPLETE&lt;/promise&gt;"; then
    echo "Done!"
    exit 0
  fi
  sleep 2
done

echo "Max iterations reached"</pre>
      </div>
    </div>

    <div class="variant-content" id="variant-production">
      <div class="variant-code-block">
        <button class="copy-btn" onclick="copyVariant('production')">Copy</button>
        <pre><span class="comment">#!/bin/bash</span>
<span class="comment"># Production: With stuck detection, rate limiting</span>

set -e
MAX_ITERATIONS=${1:-25}
STUCK_THRESHOLD=3
LAST_COMMIT=""
STUCK_COUNT=0

for i in $(seq 1 $MAX_ITERATIONS); do
  echo "=== Iteration $i ==="

  <span class="comment"># Rate limit check</span>
  if [ -f /tmp/ralph-rate-limited ]; then
    echo "Rate limited, waiting 60s..."
    sleep 60 &amp;&amp; rm /tmp/ralph-rate-limited
  fi

  OUTPUT=$(cat prompt.md | claude --dangerously-skip-permissions 2>&amp;1 | tee /dev/stderr) || true

  <span class="comment"># Stuck detection</span>
  CURRENT_COMMIT=$(git rev-parse HEAD 2>/dev/null || echo "none")
  if [ "$CURRENT_COMMIT" = "$LAST_COMMIT" ]; then
    STUCK_COUNT=$((STUCK_COUNT + 1))
    [ $STUCK_COUNT -ge $STUCK_THRESHOLD ] &amp;&amp; echo "Stuck!" &amp;&amp; exit 1
  else
    STUCK_COUNT=0
    LAST_COMMIT=$CURRENT_COMMIT
  fi

  sleep 5
done</pre>
      </div>
    </div>

    <!-- Two-Zone Layout -->
    <div class="zones-container">
      <!-- Structured Zone (NO ACCORDIONS - all visible) -->
      <div class="structured-zone">
        <h4 class="zone-header zone-header-structure">Structure</h4>

        <!-- Diagram -->
        <div class="diagram-container">
          <svg class="diagram-svg" viewBox="0 0 400 80" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <marker id="arrow" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
                <polygon points="0 0, 8 3, 0 6" fill="#4ade80"/>
              </marker>
              <linearGradient id="boxGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" style="stop-color:#1e241f"/>
                <stop offset="100%" style="stop-color:#171c18"/>
              </linearGradient>
            </defs>

            <!-- Flow boxes -->
            <g transform="translate(5, 25)">
              <!-- Fresh Context -->
              <rect x="0" y="0" width="55" height="30" rx="6" fill="url(#boxGrad)" stroke="#2a302b"/>
              <text x="27.5" y="19" text-anchor="middle" fill="#e8e6e3" font-size="9" font-family="Space Grotesk">Fresh</text>

              <line x1="60" y1="15" x2="75" y2="15" stroke="#4ade80" stroke-width="1.5" marker-end="url(#arrow)"/>

              <!-- Read State -->
              <rect x="80" y="0" width="55" height="30" rx="6" fill="url(#boxGrad)" stroke="#2a302b"/>
              <text x="107.5" y="19" text-anchor="middle" fill="#e8e6e3" font-size="9" font-family="Space Grotesk">Read</text>

              <line x1="140" y1="15" x2="155" y2="15" stroke="#4ade80" stroke-width="1.5" marker-end="url(#arrow)"/>

              <!-- Task -->
              <rect x="160" y="0" width="55" height="30" rx="6" fill="url(#boxGrad)" stroke="#2a302b"/>
              <text x="187.5" y="19" text-anchor="middle" fill="#e8e6e3" font-size="9" font-family="Space Grotesk">Task</text>

              <line x1="220" y1="15" x2="235" y2="15" stroke="#4ade80" stroke-width="1.5" marker-end="url(#arrow)"/>

              <!-- Verify -->
              <rect x="240" y="0" width="55" height="30" rx="6" fill="url(#boxGrad)" stroke="#2a302b"/>
              <text x="267.5" y="19" text-anchor="middle" fill="#e8e6e3" font-size="9" font-family="Space Grotesk">Verify</text>

              <line x1="300" y1="15" x2="315" y2="15" stroke="#4ade80" stroke-width="1.5" marker-end="url(#arrow)"/>

              <!-- Commit -->
              <rect x="320" y="0" width="55" height="30" rx="6" fill="url(#boxGrad)" stroke="#2a302b"/>
              <text x="347.5" y="19" text-anchor="middle" fill="#e8e6e3" font-size="9" font-family="Space Grotesk">Commit</text>
            </g>

            <!-- Loop arrow -->
            <path d="M 380 40 Q 395 40 395 55 Q 395 70 200 70 Q 5 70 5 55 Q 5 40 20 40"
                  fill="none" stroke="#4ade80" stroke-width="1.5" stroke-dasharray="4 2" marker-end="url(#arrow)"/>
            <text x="200" y="65" text-anchor="middle" fill="#4ade80" font-size="8" font-family="Space Grotesk">loop</text>
          </svg>
        </div>

        <!-- File Structure (VISIBLE, not in accordion) -->
        <div class="structure-section" data-link="files">
          <div class="section-title">
            <span class="icon">üìÅ</span> File Structure
          </div>
          <div class="section-content">
            <div class="file-tree">
<span class="dir">scripts/ralph/</span>
‚îú‚îÄ‚îÄ <span class="file">ralph.sh</span> <span class="comment"># The loop</span>
‚îú‚îÄ‚îÄ <span class="file">prompt.md</span> <span class="comment"># Agent instructions</span>
‚îú‚îÄ‚îÄ <span class="file">prd.json</span> <span class="comment"># Task board</span>
‚îî‚îÄ‚îÄ <span class="file">progress.txt</span> <span class="comment"># Learnings log</span>
            </div>
          </div>
        </div>

        <!-- When to Use (VISIBLE) -->
        <div class="structure-section" data-link="when-yes">
          <div class="section-title">
            <span class="icon">‚úì</span> When to Use
          </div>
          <div class="section-content">
            <ul class="use-list">
              <li><span class="yes">‚úì</span> Feature development with clear specs</li>
              <li><span class="yes">‚úì</span> API endpoint implementation</li>
              <li><span class="yes">‚úì</span> Database migrations</li>
              <li><span class="yes">‚úì</span> Refactoring with test coverage</li>
              <li><span class="yes">‚úì</span> Overnight builds</li>
            </ul>
          </div>
        </div>

        <!-- When NOT to Use (VISIBLE) -->
        <div class="structure-section" data-link="when-no">
          <div class="section-title">
            <span class="icon">‚úó</span> When NOT to Use
          </div>
          <div class="section-content">
            <ul class="use-list">
              <li><span class="no">‚úó</span> Subjective tasks ("make it pretty")</li>
              <li><span class="no">‚úó</span> Security-critical code</li>
              <li><span class="no">‚úó</span> Exploratory work</li>
              <li><span class="no">‚úó</span> Legacy code without tests</li>
            </ul>
          </div>
        </div>

        <!-- Variants (VISIBLE grid, not accordion) -->
        <div class="structure-section" data-link="variants">
          <div class="section-title">
            <span class="icon">‚ö°</span> 10 Variants
          </div>
          <div class="section-content">
            <div class="variants-grid">
              <div class="variant-item"><strong>Basic</strong> <span>‚Äî Standard loop</span></div>
              <div class="variant-item"><strong>AFK</strong> <span>‚Äî Overnight, full auto</span></div>
              <div class="variant-item"><strong>HOTL</strong> <span>‚Äî Human review</span></div>
              <div class="variant-item"><strong>Marathon</strong> <span>‚Äî Full SDLC</span></div>
              <div class="variant-item"><strong>Dr. Ralph</strong> <span>‚Äî Confidence gates</span></div>
              <div class="variant-item"><strong>Compounding</strong> <span>‚Äî Archives runs</span></div>
              <div class="variant-item"><strong>Parallel</strong> <span>‚Äî Multi-branch</span></div>
              <div class="variant-item"><strong>Marketer</strong> <span>‚Äî Content gen</span></div>
              <div class="variant-item"><strong>Lisa</strong> <span>‚Äî Enhanced logs</span></div>
              <div class="variant-item"><strong>Rate-Limited</strong> <span>‚Äî Backoff</span></div>
            </div>
          </div>
        </div>

        <!-- Common Failures (VISIBLE) -->
        <div class="structure-section" data-link="failures">
          <div class="section-title">
            <span class="icon">‚ö†Ô∏è</span> Common Failures
          </div>
          <div class="section-content">
            <ul class="use-list">
              <li><span class="no">‚Üí</span> <strong>Stories too large</strong> ‚Äî Split into 2-3 sentence tasks</li>
              <li><span class="no">‚Üí</span> <strong>Weak tests</strong> ‚Äî Add typecheck to all criteria</li>
              <li><span class="no">‚Üí</span> <strong>No browser verify</strong> ‚Äî Add Playwright for UI</li>
              <li><span class="no">‚Üí</span> <strong>Progress overwritten</strong> ‚Äî Use "APPEND" explicitly</li>
              <li><span class="no">‚Üí</span> <strong>Stuck loops</strong> ‚Äî Add stuck detection script</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Activity Zone (Fluid) -->
      <div class="fluid-zone">
        <h4 class="zone-header zone-header-activity">Activity</h4>

        <div class="activity-feed">
          <!-- Quote linking to verification -->
          <div class="activity-item" data-links-to="when-yes,failures">
            <div class="activity-header">
              <span class="activity-icon">üí≠</span>
              <span class="activity-type">Quote</span>
            </div>
            <div class="activity-content">
              "The trick with hooks is you want to fire them <em>BEFORE</em> the loop restarts, not after."
            </div>
            <div class="activity-meta">@mpocock ¬∑ 2h ago</div>
          </div>

          <!-- Connection linking to variants -->
          <div class="activity-item" data-links-to="variants">
            <div class="activity-header">
              <span class="activity-icon">üîó</span>
              <span class="activity-type">Connection</span>
            </div>
            <div class="activity-content">
              <strong>Ralph + Playwright</strong> for E2E testing. Wes Winder calls this combo "AGI" (tongue in cheek).
            </div>
            <div class="activity-meta">Discovered via @weswinder</div>
          </div>

          <!-- Numbers linking to when-yes -->
          <div class="activity-item" data-links-to="when-yes">
            <div class="activity-header">
              <span class="activity-icon">üìä</span>
              <span class="activity-type">Case Study</span>
            </div>
            <div class="activity-content">
              <strong>Real numbers:</strong> Ryan Carson ran <em>14 iterations</em> for a complete feature. Cost ~$10-15. Time: 2 hours autonomous.
            </div>
            <div class="activity-meta">Untangle Legal Agent</div>
          </div>

          <!-- Open question linking to files -->
          <div class="activity-item" data-links-to="files">
            <div class="activity-header">
              <span class="activity-icon">‚ùì</span>
              <span class="activity-type">Open Question</span>
            </div>
            <div class="activity-content">
              How does Ralph interact with <strong>MCP notification servers</strong>? Can we get mobile pings when stuck?
            </div>
            <div class="activity-meta">Investigating</div>
          </div>

          <!-- Insight linking to when-no -->
          <div class="activity-item" data-links-to="when-no,failures">
            <div class="activity-header">
              <span class="activity-icon">üí°</span>
              <span class="activity-type">Core Insight</span>
            </div>
            <div class="activity-content">
              "Given excellent upfront specification, we can already achieve meaningful <em>unattended software production</em> in 2026."
            </div>
            <div class="activity-meta">@anthropic</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Connections Footer -->
    <div class="connections-footer">
      <div class="connection-group">
        <span class="connection-label">Combines with:</span>
        <a href="#" class="connection-tag">Hooks</a>
        <a href="#" class="connection-tag">Playwright</a>
        <a href="#" class="connection-tag">Git Worktrees</a>
        <a href="#" class="connection-tag">CC Mirror</a>
      </div>
      <div class="connection-group" style="margin-left: auto;">
        <span class="connection-label">Competes with:</span>
        <a href="#" class="connection-tag competes">Gas Town</a>
        <a href="#" class="connection-tag competes">Extended Sessions</a>
      </div>
    </div>
  </main>

  <script>
    // ========================================
    // COPY FUNCTIONALITY
    // ========================================
    function copyCode(btn, text) {
      navigator.clipboard.writeText(text);
      btn.textContent = 'Copied!';
      btn.classList.add('copied');
      setTimeout(() => {
        btn.textContent = 'Copy';
        btn.classList.remove('copied');
      }, 2000);
    }

    const variantCode = {
      minimal: 'while :; do cat PROMPT.md | claude ; done',
      standard: `#!/bin/bash
# Standard: With iteration limit and completion detection

MAX_ITERATIONS=\${1:-10}

for i in $(seq 1 $MAX_ITERATIONS); do
  echo "=== Iteration $i ==="
  OUTPUT=$(cat PROMPT.md | claude 2>&1 | tee /dev/stderr) || true

  if echo "$OUTPUT" | grep -q "<promise>COMPLETE</promise>"; then
    echo "Done!"
    exit 0
  fi
  sleep 2
done

echo "Max iterations reached"`,
      production: `#!/bin/bash
# Production: With stuck detection, rate limiting

set -e
MAX_ITERATIONS=\${1:-25}
STUCK_THRESHOLD=3
LAST_COMMIT=""
STUCK_COUNT=0

for i in $(seq 1 $MAX_ITERATIONS); do
  echo "=== Iteration $i ==="

  # Rate limit check
  if [ -f /tmp/ralph-rate-limited ]; then
    echo "Rate limited, waiting 60s..."
    sleep 60 && rm /tmp/ralph-rate-limited
  fi

  OUTPUT=$(cat prompt.md | claude --dangerously-skip-permissions 2>&1 | tee /dev/stderr) || true

  # Stuck detection
  CURRENT_COMMIT=$(git rev-parse HEAD 2>/dev/null || echo "none")
  if [ "$CURRENT_COMMIT" = "$LAST_COMMIT" ]; then
    STUCK_COUNT=$((STUCK_COUNT + 1))
    [ $STUCK_COUNT -ge $STUCK_THRESHOLD ] && echo "Stuck!" && exit 1
  else
    STUCK_COUNT=0
    LAST_COMMIT=$CURRENT_COMMIT
  fi

  sleep 5
done`
    };

    function copyVariant(variant) {
      navigator.clipboard.writeText(variantCode[variant]);
      const btn = event.target;
      btn.textContent = 'Copied!';
      btn.classList.add('copied');
      setTimeout(() => {
        btn.textContent = 'Copy';
        btn.classList.remove('copied');
      }, 2000);
    }

    function switchVariant(variant, btn) {
      document.querySelectorAll('.variant-content').forEach(el => el.classList.remove('active'));
      document.getElementById('variant-' + variant).classList.add('active');
      document.querySelectorAll('.variant-tab').forEach(t => t.classList.remove('active'));
      btn.classList.add('active');
    }

    // ========================================
    // BRUSHING & LINKING
    // ========================================
    document.querySelectorAll('.activity-item[data-links-to]').forEach(item => {
      const links = item.dataset.linksTo.split(',');

      item.addEventListener('mouseenter', () => {
        links.forEach(linkId => {
          const target = document.querySelector(`.structure-section[data-link="${linkId}"]`);
          if (target) {
            target.classList.add('highlighted');
          }
        });
      });

      item.addEventListener('mouseleave', () => {
        document.querySelectorAll('.structure-section.highlighted').forEach(el => {
          el.classList.remove('highlighted');
        });
      });
    });

    // Reverse linking: Structure -> Activity
    document.querySelectorAll('.structure-section[data-link]').forEach(section => {
      const linkId = section.dataset.link;

      section.addEventListener('mouseenter', () => {
        document.querySelectorAll(`.activity-item[data-links-to*="${linkId}"]`).forEach(item => {
          item.classList.add('highlighted');
        });
      });

      section.addEventListener('mouseleave', () => {
        document.querySelectorAll('.activity-item.highlighted').forEach(el => {
          el.classList.remove('highlighted');
        });
      });
    });
  </script>
</body>
</html>
