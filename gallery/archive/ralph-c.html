<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ralph - Direction C (shadcn Style)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/gallery.css">
  <style>
    /* Direction C specific styles */
    .direction-indicator {
      position: fixed;
      top: var(--space-md);
      right: var(--space-md);
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      padding: var(--space-sm) var(--space-md);
      font-size: var(--text-sm);
      color: var(--text-muted);
      z-index: 100;
    }

    .page-header {
      padding: var(--space-lg) 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .page-header .title-area h1 {
      font-size: var(--text-2xl);
      margin-bottom: var(--space-xs);
    }

    .page-header .subtitle {
      color: var(--text-secondary);
      font-size: var(--text-sm);
    }

    /* Hero essence block */
    .hero-essence {
      background: linear-gradient(180deg, var(--bg-code) 0%, var(--bg-secondary) 100%);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-xl);
      padding: var(--space-2xl) var(--space-xl);
      text-align: center;
      margin: var(--space-lg) 0;
      position: relative;
    }

    .hero-code {
      font-family: var(--font-mono);
      font-size: clamp(1.25rem, 3vw, 1.75rem);
      color: var(--accent-primary);
      margin-bottom: var(--space-lg);
      padding: var(--space-lg);
      background: var(--bg-primary);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      position: relative;
    }

    .hero-code .copy-btn {
      position: absolute;
      top: 50%;
      right: var(--space-md);
      transform: translateY(-50%);
    }

    .hero-caption {
      color: var(--text-secondary);
      font-size: var(--text-base);
      font-style: italic;
    }

    /* Variant tabs */
    .variant-tabs {
      display: flex;
      gap: 2px;
      background: var(--bg-code);
      border-radius: var(--radius-md);
      padding: 4px;
      margin: var(--space-lg) 0;
    }

    .variant-tab {
      flex: 1;
      padding: var(--space-sm) var(--space-md);
      background: none;
      border: none;
      border-radius: var(--radius-sm);
      font-family: var(--font-sans);
      font-size: var(--text-sm);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .variant-tab:hover {
      color: var(--text-primary);
    }

    .variant-tab.active {
      background: var(--bg-elevated);
      color: var(--accent-primary);
    }

    /* Variant content */
    .variant-content {
      display: none;
    }

    .variant-content.active {
      display: block;
    }

    .variant-code-block {
      background: var(--bg-code);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      padding: var(--space-lg);
      font-family: var(--font-mono);
      font-size: var(--text-sm);
      margin-bottom: var(--space-lg);
      position: relative;
      overflow-x: auto;
    }

    .variant-code-block pre {
      margin: 0;
      color: var(--text-primary);
    }

    .variant-code-block .comment {
      color: var(--text-muted);
    }

    /* Two-zone layout */
    .zones-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-lg);
      margin: var(--space-lg) 0;
    }

    @media (max-width: 900px) {
      .zones-container {
        grid-template-columns: 1fr;
      }
    }

    /* Structured zone */
    .structured-zone {
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
    }

    .zone-header {
      font-size: var(--text-sm);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      margin-bottom: var(--space-md);
      padding-bottom: var(--space-sm);
      border-bottom: 2px solid var(--accent-primary);
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .zone-header-fluid {
      border-bottom-style: dashed;
      border-bottom-color: var(--border-dashed);
    }

    /* SVG diagram placeholder */
    .diagram-container {
      background: var(--bg-code);
      border: 1px dashed var(--border-dashed);
      border-radius: var(--radius-md);
      padding: var(--space-lg);
      margin-bottom: var(--space-md);
      text-align: center;
    }

    .diagram-svg {
      max-width: 100%;
      height: auto;
    }

    /* Accordion items */
    .accordion-list {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .accordion-item {
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      overflow: hidden;
    }

    .accordion-item summary {
      padding: var(--space-md);
      background: var(--bg-elevated);
      cursor: pointer;
      font-weight: 500;
      font-size: var(--text-sm);
      list-style: none;
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .accordion-item summary::before {
      content: ">";
      font-family: var(--font-mono);
      color: var(--text-muted);
      transition: transform var(--transition-fast);
    }

    .accordion-item[open] summary::before {
      transform: rotate(90deg);
    }

    .accordion-item summary::-webkit-details-marker {
      display: none;
    }

    .accordion-content {
      padding: var(--space-md);
      font-size: var(--text-sm);
      color: var(--text-secondary);
      border-top: 1px solid var(--border-subtle);
    }

    .accordion-content ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .accordion-content li {
      padding: var(--space-xs) 0;
      display: flex;
      align-items: flex-start;
      gap: var(--space-sm);
    }

    /* Fluid zone */
    .fluid-zone {
      border: 1px dashed var(--border-dashed);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      background: var(--bg-primary);
    }

    .activity-feed {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .activity-item {
      padding: var(--space-md);
      border-bottom: 1px dashed var(--border-dashed);
      font-size: var(--text-sm);
    }

    .activity-item:last-child {
      border-bottom: none;
    }

    .activity-icon {
      margin-right: var(--space-sm);
    }

    .activity-content {
      color: var(--text-secondary);
    }

    .activity-content strong {
      color: var(--text-primary);
    }

    .activity-meta {
      margin-top: var(--space-xs);
      font-size: var(--text-xs);
      color: var(--text-muted);
    }

    /* Connections footer */
    .connections-footer {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: var(--space-sm);
      padding: var(--space-lg);
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      margin-top: var(--space-lg);
    }

    .connection-group {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .connection-label {
      font-size: var(--text-sm);
      color: var(--text-muted);
    }

    .connection-tag {
      display: inline-flex;
      align-items: center;
      padding: var(--space-xs) var(--space-sm);
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      font-size: var(--text-sm);
      color: var(--text-secondary);
      text-decoration: none;
      transition: all var(--transition-fast);
    }

    .connection-tag:hover {
      border-color: var(--accent-primary);
      color: var(--accent-primary);
    }

    .connection-tag.competes {
      border-color: var(--warning);
    }

    .connection-tag.competes:hover {
      color: var(--warning);
    }
  </style>
</head>
<body class="direction-c">
  <!-- Direction indicator -->
  <div class="direction-indicator">Direction C: shadcn Style</div>

  <!-- Navigation -->
  <nav class="nav-header">
    <a href="#" class="nav-back">
      <span>&larr;</span> Patterns
    </a>
    <span class="maturity-badge evergreen">
      <span>üå≥</span> Evergreen
    </span>
  </nav>

  <main class="container">
    <!-- Page Header -->
    <header class="page-header">
      <div class="title-area">
        <h1>Ralph</h1>
        <p class="subtitle">The Infinite Loop Pattern</p>
      </div>
    </header>

    <!-- Hero Essence -->
    <section class="hero-essence">
      <div class="hero-code">
        <span>while :; do cat PROMPT.md | claude ; done</span>
        <button class="copy-btn" onclick="copyHeroCode(this)">
          <span>Copy</span>
        </button>
      </div>
      <p class="hero-caption">The one-liner. Everything else is scaffolding.</p>
    </section>

    <!-- Variant Tabs -->
    <div class="variant-tabs">
      <button class="variant-tab active" onclick="switchVariant('minimal', this)">Minimal</button>
      <button class="variant-tab" onclick="switchVariant('standard', this)">Standard</button>
      <button class="variant-tab" onclick="switchVariant('production', this)">Production</button>
    </div>

    <!-- Variant Content -->
    <div class="variant-content active" id="variant-minimal">
      <div class="variant-code-block">
        <button class="copy-btn" onclick="copyVariantCode(this, 'minimal')">
          <span>Copy</span>
        </button>
        <pre><span class="comment"># Minimal: Just the loop</span>
while :; do cat PROMPT.md | claude ; done</pre>
      </div>
    </div>

    <div class="variant-content" id="variant-standard">
      <div class="variant-code-block">
        <button class="copy-btn" onclick="copyVariantCode(this, 'standard')">
          <span>Copy</span>
        </button>
        <pre><span class="comment">#!/bin/bash</span>
<span class="comment"># Standard: With iteration limit and completion detection</span>

MAX_ITERATIONS=${1:-10}

for i in $(seq 1 $MAX_ITERATIONS); do
  echo "=== Iteration $i ==="

  OUTPUT=$(cat PROMPT.md | claude 2>&1 | tee /dev/stderr) || true

  if echo "$OUTPUT" | grep -q "&lt;promise&gt;COMPLETE&lt;/promise&gt;"; then
    echo "Done!"
    exit 0
  fi

  sleep 2
done

echo "Max iterations reached"</pre>
      </div>
    </div>

    <div class="variant-content" id="variant-production">
      <div class="variant-code-block">
        <button class="copy-btn" onclick="copyVariantCode(this, 'production')">
          <span>Copy</span>
        </button>
        <pre><span class="comment">#!/bin/bash</span>
<span class="comment"># Production: With stuck detection, rate limiting, cost awareness</span>

set -e
MAX_ITERATIONS=${1:-25}
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
STUCK_THRESHOLD=3
LAST_COMMIT=""
STUCK_COUNT=0

echo "Starting Ralph (max $MAX_ITERATIONS iterations)"

for i in $(seq 1 $MAX_ITERATIONS); do
  echo "=== Iteration $i ==="

  <span class="comment"># Rate limit check</span>
  if [ -f /tmp/ralph-rate-limited ]; then
    echo "Rate limited, waiting 60s..."
    sleep 60
    rm /tmp/ralph-rate-limited
  fi

  OUTPUT=$(cat "$SCRIPT_DIR/prompt.md" \
    | claude --dangerously-skip-permissions 2>&1 \
    | tee /dev/stderr) || true

  <span class="comment"># Check rate limit response</span>
  if echo "$OUTPUT" | grep -q "rate_limit"; then
    touch /tmp/ralph-rate-limited
    continue
  fi

  <span class="comment"># Check completion</span>
  if echo "$OUTPUT" | grep -q "&lt;promise&gt;COMPLETE&lt;/promise&gt;"; then
    echo "All tasks complete!"
    exit 0
  fi

  <span class="comment"># Stuck detection</span>
  CURRENT_COMMIT=$(git rev-parse HEAD 2>/dev/null || echo "none")
  if [ "$CURRENT_COMMIT" = "$LAST_COMMIT" ]; then
    STUCK_COUNT=$((STUCK_COUNT + 1))
    if [ $STUCK_COUNT -ge $STUCK_THRESHOLD ]; then
      echo "WARNING: Stuck for $STUCK_COUNT iterations"
      exit 1
    fi
  else
    STUCK_COUNT=0
    LAST_COMMIT=$CURRENT_COMMIT
  fi

  sleep 5
done

echo "Max iterations reached"
exit 1</pre>
      </div>
    </div>

    <!-- Two-Zone Layout -->
    <div class="zones-container">
      <!-- Structured Zone -->
      <div class="structured-zone">
        <h4 class="zone-header">
          <span>Structure</span>
        </h4>

        <!-- Diagram -->
        <div class="diagram-container">
          <svg class="diagram-svg" viewBox="0 0 400 60" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                <polygon points="0 0, 10 3.5, 0 7" fill="#4ade80"/>
              </marker>
            </defs>

            <!-- Boxes -->
            <rect x="5" y="20" width="50" height="25" rx="4" fill="#242824" stroke="#333833"/>
            <text x="30" y="37" text-anchor="middle" fill="#9d9b98" font-size="8" font-family="Space Grotesk">Fresh</text>

            <line x1="60" y1="32" x2="75" y2="32" stroke="#4ade80" marker-end="url(#arrowhead)"/>

            <rect x="80" y="20" width="50" height="25" rx="4" fill="#242824" stroke="#333833"/>
            <text x="105" y="37" text-anchor="middle" fill="#9d9b98" font-size="8" font-family="Space Grotesk">Read</text>

            <line x1="135" y1="32" x2="150" y2="32" stroke="#4ade80" marker-end="url(#arrowhead)"/>

            <rect x="155" y="20" width="50" height="25" rx="4" fill="#242824" stroke="#333833"/>
            <text x="180" y="37" text-anchor="middle" fill="#9d9b98" font-size="8" font-family="Space Grotesk">Task</text>

            <line x1="210" y1="32" x2="225" y2="32" stroke="#4ade80" marker-end="url(#arrowhead)"/>

            <rect x="230" y="20" width="50" height="25" rx="4" fill="#242824" stroke="#333833"/>
            <text x="255" y="37" text-anchor="middle" fill="#9d9b98" font-size="8" font-family="Space Grotesk">Verify</text>

            <line x1="285" y1="32" x2="300" y2="32" stroke="#4ade80" marker-end="url(#arrowhead)"/>

            <rect x="305" y="20" width="50" height="25" rx="4" fill="#242824" stroke="#333833"/>
            <text x="330" y="37" text-anchor="middle" fill="#9d9b98" font-size="8" font-family="Space Grotesk">Commit</text>

            <line x1="360" y1="32" x2="375" y2="32" stroke="#4ade80" marker-end="url(#arrowhead)"/>

            <rect x="380" y="20" width="15" height="25" rx="4" fill="#1e221e" stroke="#4ade80"/>
            <text x="387" y="37" text-anchor="middle" fill="#4ade80" font-size="10" font-family="Space Grotesk">‚Ü∫</text>
          </svg>
        </div>

        <!-- Accordions -->
        <div class="accordion-list">
          <details class="accordion-item">
            <summary>File Structure</summary>
            <div class="accordion-content">
              <pre style="font-family: var(--font-mono); font-size: 12px; line-height: 1.6;">
scripts/ralph/
‚îú‚îÄ‚îÄ ralph.sh       # Loop script
‚îú‚îÄ‚îÄ prompt.md      # Agent instructions
‚îú‚îÄ‚îÄ prd.json       # Task board
‚îî‚îÄ‚îÄ progress.txt   # Learnings log</pre>
            </div>
          </details>

          <details class="accordion-item">
            <summary>When to Use</summary>
            <div class="accordion-content">
              <ul>
                <li><span style="color: var(--success);">‚úì</span> Feature development with clear specs</li>
                <li><span style="color: var(--success);">‚úì</span> API endpoint implementation</li>
                <li><span style="color: var(--success);">‚úì</span> Database migrations</li>
                <li><span style="color: var(--success);">‚úì</span> Refactoring with test coverage</li>
                <li><span style="color: var(--success);">‚úì</span> Overnight builds</li>
              </ul>
            </div>
          </details>

          <details class="accordion-item">
            <summary>When NOT to Use</summary>
            <div class="accordion-content">
              <ul>
                <li><span style="color: var(--error);">‚úó</span> Subjective tasks ("make it pretty")</li>
                <li><span style="color: var(--error);">‚úó</span> Security-critical code</li>
                <li><span style="color: var(--error);">‚úó</span> Exploratory work</li>
                <li><span style="color: var(--error);">‚úó</span> Legacy code without tests</li>
              </ul>
            </div>
          </details>

          <details class="accordion-item">
            <summary>Variants (10 total)</summary>
            <div class="accordion-content">
              <ul>
                <li><strong>Basic</strong> ‚Äî Standard loop</li>
                <li><strong>AFK</strong> ‚Äî Overnight, full auto</li>
                <li><strong>HOTL</strong> ‚Äî Human review between</li>
                <li><strong>Marathon</strong> ‚Äî Full SDLC integration</li>
                <li><strong>Dr. Ralph</strong> ‚Äî Confidence thresholds</li>
                <li><strong>Compounding</strong> ‚Äî Archives past runs</li>
                <li><strong>Parallel</strong> ‚Äî Multiple branches</li>
                <li><strong>Marketer</strong> ‚Äî Content generation</li>
                <li><strong>Lisa</strong> ‚Äî Enhanced logging</li>
                <li><strong>Rate-Limited</strong> ‚Äî Backoff strategies</li>
              </ul>
            </div>
          </details>

          <details class="accordion-item">
            <summary>Common Failures</summary>
            <div class="accordion-content">
              <ul>
                <li><strong>Stories too large</strong> ‚Äî Split into 2-3 sentence tasks</li>
                <li><strong>Weak tests</strong> ‚Äî Add typecheck to all criteria</li>
                <li><strong>No browser verify</strong> ‚Äî Add Playwright for UI</li>
                <li><strong>Progress overwritten</strong> ‚Äî Use "APPEND" explicitly</li>
                <li><strong>Stuck loops</strong> ‚Äî Add stuck detection script</li>
              </ul>
            </div>
          </details>
        </div>
      </div>

      <!-- Fluid Zone -->
      <div class="fluid-zone">
        <h4 class="zone-header zone-header-fluid">
          <span>Activity</span>
        </h4>

        <div class="activity-feed">
          <div class="activity-item">
            <span class="activity-icon">üí≠</span>
            <span class="activity-content">
              "The trick with hooks is you want to fire them <strong>BEFORE</strong> the loop restarts, not after."
            </span>
            <div class="activity-meta">@mpocock ¬∑ 2h ago</div>
          </div>

          <div class="activity-item">
            <span class="activity-icon">üîó</span>
            <span class="activity-content">
              <strong>Connection forming:</strong> Ralph + Playwright for E2E testing. Wes Winder calls this combo "AGI" (tongue in cheek).
            </span>
            <div class="activity-meta">Discovered via @weswinder</div>
          </div>

          <div class="activity-item">
            <span class="activity-icon">üìä</span>
            <span class="activity-content">
              <strong>Real numbers:</strong> Ryan Carson ran 14 iterations for a complete feature. Cost ~$10-15. Time: 2 hours autonomous.
            </span>
            <div class="activity-meta">Case study: Untangle Legal Agent</div>
          </div>

          <div class="activity-item">
            <span class="activity-icon">‚ùì</span>
            <span class="activity-content">
              <strong>Open question:</strong> How does Ralph interact with MCP notification servers? Can we get mobile pings when stuck?
            </span>
            <div class="activity-meta">Investigating</div>
          </div>

          <div class="activity-item">
            <span class="activity-icon">üí°</span>
            <span class="activity-content">
              "Given excellent upfront specification, we can already achieve meaningful unattended software production in 2026."
            </span>
            <div class="activity-meta">Core insight</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Connections Footer -->
    <div class="connections-footer">
      <div class="connection-group">
        <span class="connection-label">Combines with:</span>
        <a href="#" class="connection-tag">Hooks</a>
        <a href="#" class="connection-tag">Playwright</a>
        <a href="#" class="connection-tag">Git Worktrees</a>
        <a href="#" class="connection-tag">CC Mirror</a>
      </div>
      <div class="connection-group" style="margin-left: auto;">
        <span class="connection-label">Competes with:</span>
        <a href="#" class="connection-tag competes">Gas Town</a>
        <a href="#" class="connection-tag competes">Extended Sessions</a>
      </div>
    </div>
  </main>

  <script>
    function copyHeroCode(btn) {
      const code = 'while :; do cat PROMPT.md | claude ; done';
      navigator.clipboard.writeText(code);
      btn.querySelector('span').textContent = 'Copied!';
      btn.classList.add('copied');
      setTimeout(() => {
        btn.querySelector('span').textContent = 'Copy';
        btn.classList.remove('copied');
      }, 2000);
    }

    const variantCode = {
      minimal: 'while :; do cat PROMPT.md | claude ; done',
      standard: `#!/bin/bash
# Standard: With iteration limit and completion detection

MAX_ITERATIONS=\${1:-10}

for i in $(seq 1 $MAX_ITERATIONS); do
  echo "=== Iteration $i ==="

  OUTPUT=$(cat PROMPT.md | claude 2>&1 | tee /dev/stderr) || true

  if echo "$OUTPUT" | grep -q "<promise>COMPLETE</promise>"; then
    echo "Done!"
    exit 0
  fi

  sleep 2
done

echo "Max iterations reached"`,
      production: `#!/bin/bash
# Production: With stuck detection, rate limiting, cost awareness

set -e
MAX_ITERATIONS=\${1:-25}
SCRIPT_DIR="$(cd "$(dirname "\${BASH_SOURCE[0]}")" && pwd)"
STUCK_THRESHOLD=3
LAST_COMMIT=""
STUCK_COUNT=0

echo "Starting Ralph (max $MAX_ITERATIONS iterations)"

for i in $(seq 1 $MAX_ITERATIONS); do
  echo "=== Iteration $i ==="

  # Rate limit check
  if [ -f /tmp/ralph-rate-limited ]; then
    echo "Rate limited, waiting 60s..."
    sleep 60
    rm /tmp/ralph-rate-limited
  fi

  OUTPUT=$(cat "$SCRIPT_DIR/prompt.md" \\
    | claude --dangerously-skip-permissions 2>&1 \\
    | tee /dev/stderr) || true

  # Check rate limit response
  if echo "$OUTPUT" | grep -q "rate_limit"; then
    touch /tmp/ralph-rate-limited
    continue
  fi

  # Check completion
  if echo "$OUTPUT" | grep -q "<promise>COMPLETE</promise>"; then
    echo "All tasks complete!"
    exit 0
  fi

  # Stuck detection
  CURRENT_COMMIT=$(git rev-parse HEAD 2>/dev/null || echo "none")
  if [ "$CURRENT_COMMIT" = "$LAST_COMMIT" ]; then
    STUCK_COUNT=$((STUCK_COUNT + 1))
    if [ $STUCK_COUNT -ge $STUCK_THRESHOLD ]; then
      echo "WARNING: Stuck for $STUCK_COUNT iterations"
      exit 1
    fi
  else
    STUCK_COUNT=0
    LAST_COMMIT=$CURRENT_COMMIT
  fi

  sleep 5
done

echo "Max iterations reached"
exit 1`
    };

    function copyVariantCode(btn, variant) {
      navigator.clipboard.writeText(variantCode[variant]);
      btn.querySelector('span').textContent = 'Copied!';
      btn.classList.add('copied');
      setTimeout(() => {
        btn.querySelector('span').textContent = 'Copy';
        btn.classList.remove('copied');
      }, 2000);
    }

    function switchVariant(variant, btn) {
      // Hide all variants
      document.querySelectorAll('.variant-content').forEach(el => el.classList.remove('active'));
      // Show selected
      document.getElementById('variant-' + variant).classList.add('active');
      // Update tab states
      document.querySelectorAll('.variant-tab').forEach(t => t.classList.remove('active'));
      btn.classList.add('active');
    }
  </script>
</body>
</html>
